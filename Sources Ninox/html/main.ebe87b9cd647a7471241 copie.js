/*! For license information please see main.ebe87b9cd647a7471241.js.LICENSE.txt */
var libs=function(e){function t(t){for(var o,s,r=t[0],l=t[1],c=t[2],d=0,p=[];d<r.length;d++)s=r[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&p.push(n[s][0]),n[s]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(h&&h(t);p.length;)p.shift()();return a.push.apply(a,c||[]),i()}function i(){for(var e,t=0;t<a.length;t++){for(var i=a[t],o=!0,s=1;s<i.length;s++){var l=i[s];0!==n[l]&&(o=!1)}o&&(a.splice(t--,1),e=r(r.s=i[0]))}return e}var o={},n={main:0},a=[];function s(e){return r.p+""+({"vendors~pdfjsWorker":"vendors~pdfjsWorker"}[e]||e)+".ebe87b9cd647a7471241.js"}function r(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(e){var t=[],i=n[e];if(0!==i)if(i)t.push(i[2]);else{var o=new Promise((function(t,o){i=n[e]=[t,o]}));t.push(i[2]=o);var a,l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=s(e);var c=new Error;a=function(t){l.onerror=l.onload=null,clearTimeout(d);var i=n[e];if(0!==i){if(i){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",c.name="ChunkLoadError",c.type=o,c.request=a,i[1](c)}n[e]=void 0}};var d=setTimeout((function(){a({type:"timeout",target:l})}),12e4);l.onerror=l.onload=a,document.head.appendChild(l)}return Promise.all(t)},r.m=e,r.c=o,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e};var l=window.webpackJsonplibs=window.webpackJsonplibs||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var h=c;return a.push([0,"defaultVendors~main","css~main"]),i()}({"./node_modules/moment/locale sync recursive ^\\.\\/.*$":function(e,t,i){var o={"./af":"./node_modules/moment/locale/af.js","./af.js":"./node_modules/moment/locale/af.js","./ar":"./node_modules/moment/locale/ar.js","./ar-dz":"./node_modules/moment/locale/ar-dz.js","./ar-dz.js":"./node_modules/moment/locale/ar-dz.js","./ar-kw":"./node_modules/moment/locale/ar-kw.js","./ar-kw.js":"./node_modules/moment/locale/ar-kw.js","./ar-ly":"./node_modules/moment/locale/ar-ly.js","./ar-ly.js":"./node_modules/moment/locale/ar-ly.js","./ar-ma":"./node_modules/moment/locale/ar-ma.js","./ar-ma.js":"./node_modules/moment/locale/ar-ma.js","./ar-sa":"./node_modules/moment/locale/ar-sa.js","./ar-sa.js":"./node_modules/moment/locale/ar-sa.js","./ar-tn":"./node_modules/moment/locale/ar-tn.js","./ar-tn.js":"./node_modules/moment/locale/ar-tn.js","./ar.js":"./node_modules/moment/locale/ar.js","./az":"./node_modules/moment/locale/az.js","./az.js":"./node_modules/moment/locale/az.js","./be":"./node_modules/moment/locale/be.js","./be.js":"./node_modules/moment/locale/be.js","./bg":"./node_modules/moment/locale/bg.js","./bg.js":"./node_modules/moment/locale/bg.js","./bm":"./node_modules/moment/locale/bm.js","./bm.js":"./node_modules/moment/locale/bm.js","./bn":"./node_modules/moment/locale/bn.js","./bn.js":"./node_modules/moment/locale/bn.js","./bo":"./node_modules/moment/locale/bo.js","./bo.js":"./node_modules/moment/locale/bo.js","./br":"./node_modules/moment/locale/br.js","./br.js":"./node_modules/moment/locale/br.js","./bs":"./node_modules/moment/locale/bs.js","./bs.js":"./node_modules/moment/locale/bs.js","./ca":"./node_modules/moment/locale/ca.js","./ca.js":"./node_modules/moment/locale/ca.js","./cs":"./node_modules/moment/locale/cs.js","./cs.js":"./node_modules/moment/locale/cs.js","./cv":"./node_modules/moment/locale/cv.js","./cv.js":"./node_modules/moment/locale/cv.js","./cy":"./node_modules/moment/locale/cy.js","./cy.js":"./node_modules/moment/locale/cy.js","./da":"./node_modules/moment/locale/da.js","./da.js":"./node_modules/moment/locale/da.js","./de":"./node_modules/moment/locale/de.js","./de-at":"./node_modules/moment/locale/de-at.js","./de-at.js":"./node_modules/moment/locale/de-at.js","./de-ch":"./node_modules/moment/locale/de-ch.js","./de-ch.js":"./node_modules/moment/locale/de-ch.js","./de.js":"./node_modules/moment/locale/de.js","./dv":"./node_modules/moment/locale/dv.js","./dv.js":"./node_modules/moment/locale/dv.js","./el":"./node_modules/moment/locale/el.js","./el.js":"./node_modules/moment/locale/el.js","./en-SG":"./node_modules/moment/locale/en-SG.js","./en-SG.js":"./node_modules/moment/locale/en-SG.js","./en-au":"./node_modules/moment/locale/en-au.js","./en-au.js":"./node_modules/moment/locale/en-au.js","./en-ca":"./node_modules/moment/locale/en-ca.js","./en-ca.js":"./node_modules/moment/locale/en-ca.js","./en-gb":"./node_modules/moment/locale/en-gb.js","./en-gb.js":"./node_modules/moment/locale/en-gb.js","./en-ie":"./node_modules/moment/locale/en-ie.js","./en-ie.js":"./node_modules/moment/locale/en-ie.js","./en-il":"./node_modules/moment/locale/en-il.js","./en-il.js":"./node_modules/moment/locale/en-il.js","./en-nz":"./node_modules/moment/locale/en-nz.js","./en-nz.js":"./node_modules/moment/locale/en-nz.js","./eo":"./node_modules/moment/locale/eo.js","./eo.js":"./node_modules/moment/locale/eo.js","./es":"./node_modules/moment/locale/es.js","./es-do":"./node_modules/moment/locale/es-do.js","./es-do.js":"./node_modules/moment/locale/es-do.js","./es-us":"./node_modules/moment/locale/es-us.js","./es-us.js":"./node_modules/moment/locale/es-us.js","./es.js":"./node_modules/moment/locale/es.js","./et":"./node_modules/moment/locale/et.js","./et.js":"./node_modules/moment/locale/et.js","./eu":"./node_modules/moment/locale/eu.js","./eu.js":"./node_modules/moment/locale/eu.js","./fa":"./node_modules/moment/locale/fa.js","./fa.js":"./node_modules/moment/locale/fa.js","./fi":"./node_modules/moment/locale/fi.js","./fi.js":"./node_modules/moment/locale/fi.js","./fo":"./node_modules/moment/locale/fo.js","./fo.js":"./node_modules/moment/locale/fo.js","./fr":"./node_modules/moment/locale/fr.js","./fr-ca":"./node_modules/moment/locale/fr-ca.js","./fr-ca.js":"./node_modules/moment/locale/fr-ca.js","./fr-ch":"./node_modules/moment/locale/fr-ch.js","./fr-ch.js":"./node_modules/moment/locale/fr-ch.js","./fr.js":"./node_modules/moment/locale/fr.js","./fy":"./node_modules/moment/locale/fy.js","./fy.js":"./node_modules/moment/locale/fy.js","./ga":"./node_modules/moment/locale/ga.js","./ga.js":"./node_modules/moment/locale/ga.js","./gd":"./node_modules/moment/locale/gd.js","./gd.js":"./node_modules/moment/locale/gd.js","./gl":"./node_modules/moment/locale/gl.js","./gl.js":"./node_modules/moment/locale/gl.js","./gom-latn":"./node_modules/moment/locale/gom-latn.js","./gom-latn.js":"./node_modules/moment/locale/gom-latn.js","./gu":"./node_modules/moment/locale/gu.js","./gu.js":"./node_modules/moment/locale/gu.js","./he":"./node_modules/moment/locale/he.js","./he.js":"./node_modules/moment/locale/he.js","./hi":"./node_modules/moment/locale/hi.js","./hi.js":"./node_modules/moment/locale/hi.js","./hr":"./node_modules/moment/locale/hr.js","./hr.js":"./node_modules/moment/locale/hr.js","./hu":"./node_modules/moment/locale/hu.js","./hu.js":"./node_modules/moment/locale/hu.js","./hy-am":"./node_modules/moment/locale/hy-am.js","./hy-am.js":"./node_modules/moment/locale/hy-am.js","./id":"./node_modules/moment/locale/id.js","./id.js":"./node_modules/moment/locale/id.js","./is":"./node_modules/moment/locale/is.js","./is.js":"./node_modules/moment/locale/is.js","./it":"./node_modules/moment/locale/it.js","./it-ch":"./node_modules/moment/locale/it-ch.js","./it-ch.js":"./node_modules/moment/locale/it-ch.js","./it.js":"./node_modules/moment/locale/it.js","./ja":"./node_modules/moment/locale/ja.js","./ja.js":"./node_modules/moment/locale/ja.js","./jv":"./node_modules/moment/locale/jv.js","./jv.js":"./node_modules/moment/locale/jv.js","./ka":"./node_modules/moment/locale/ka.js","./ka.js":"./node_modules/moment/locale/ka.js","./kk":"./node_modules/moment/locale/kk.js","./kk.js":"./node_modules/moment/locale/kk.js","./km":"./node_modules/moment/locale/km.js","./km.js":"./node_modules/moment/locale/km.js","./kn":"./node_modules/moment/locale/kn.js","./kn.js":"./node_modules/moment/locale/kn.js","./ko":"./node_modules/moment/locale/ko.js","./ko.js":"./node_modules/moment/locale/ko.js","./ku":"./node_modules/moment/locale/ku.js","./ku.js":"./node_modules/moment/locale/ku.js","./ky":"./node_modules/moment/locale/ky.js","./ky.js":"./node_modules/moment/locale/ky.js","./lb":"./node_modules/moment/locale/lb.js","./lb.js":"./node_modules/moment/locale/lb.js","./lo":"./node_modules/moment/locale/lo.js","./lo.js":"./node_modules/moment/locale/lo.js","./lt":"./node_modules/moment/locale/lt.js","./lt.js":"./node_modules/moment/locale/lt.js","./lv":"./node_modules/moment/locale/lv.js","./lv.js":"./node_modules/moment/locale/lv.js","./me":"./node_modules/moment/locale/me.js","./me.js":"./node_modules/moment/locale/me.js","./mi":"./node_modules/moment/locale/mi.js","./mi.js":"./node_modules/moment/locale/mi.js","./mk":"./node_modules/moment/locale/mk.js","./mk.js":"./node_modules/moment/locale/mk.js","./ml":"./node_modules/moment/locale/ml.js","./ml.js":"./node_modules/moment/locale/ml.js","./mn":"./node_modules/moment/locale/mn.js","./mn.js":"./node_modules/moment/locale/mn.js","./mr":"./node_modules/moment/locale/mr.js","./mr.js":"./node_modules/moment/locale/mr.js","./ms":"./node_modules/moment/locale/ms.js","./ms-my":"./node_modules/moment/locale/ms-my.js","./ms-my.js":"./node_modules/moment/locale/ms-my.js","./ms.js":"./node_modules/moment/locale/ms.js","./mt":"./node_modules/moment/locale/mt.js","./mt.js":"./node_modules/moment/locale/mt.js","./my":"./node_modules/moment/locale/my.js","./my.js":"./node_modules/moment/locale/my.js","./nb":"./node_modules/moment/locale/nb.js","./nb.js":"./node_modules/moment/locale/nb.js","./ne":"./node_modules/moment/locale/ne.js","./ne.js":"./node_modules/moment/locale/ne.js","./nl":"./node_modules/moment/locale/nl.js","./nl-be":"./node_modules/moment/locale/nl-be.js","./nl-be.js":"./node_modules/moment/locale/nl-be.js","./nl.js":"./node_modules/moment/locale/nl.js","./nn":"./node_modules/moment/locale/nn.js","./nn.js":"./node_modules/moment/locale/nn.js","./pa-in":"./node_modules/moment/locale/pa-in.js","./pa-in.js":"./node_modules/moment/locale/pa-in.js","./pl":"./node_modules/moment/locale/pl.js","./pl.js":"./node_modules/moment/locale/pl.js","./pt":"./node_modules/moment/locale/pt.js","./pt-br":"./node_modules/moment/locale/pt-br.js","./pt-br.js":"./node_modules/moment/locale/pt-br.js","./pt.js":"./node_modules/moment/locale/pt.js","./ro":"./node_modules/moment/locale/ro.js","./ro.js":"./node_modules/moment/locale/ro.js","./ru":"./node_modules/moment/locale/ru.js","./ru.js":"./node_modules/moment/locale/ru.js","./sd":"./node_modules/moment/locale/sd.js","./sd.js":"./node_modules/moment/locale/sd.js","./se":"./node_modules/moment/locale/se.js","./se.js":"./node_modules/moment/locale/se.js","./si":"./node_modules/moment/locale/si.js","./si.js":"./node_modules/moment/locale/si.js","./sk":"./node_modules/moment/locale/sk.js","./sk.js":"./node_modules/moment/locale/sk.js","./sl":"./node_modules/moment/locale/sl.js","./sl.js":"./node_modules/moment/locale/sl.js","./sq":"./node_modules/moment/locale/sq.js","./sq.js":"./node_modules/moment/locale/sq.js","./sr":"./node_modules/moment/locale/sr.js","./sr-cyrl":"./node_modules/moment/locale/sr-cyrl.js","./sr-cyrl.js":"./node_modules/moment/locale/sr-cyrl.js","./sr.js":"./node_modules/moment/locale/sr.js","./ss":"./node_modules/moment/locale/ss.js","./ss.js":"./node_modules/moment/locale/ss.js","./sv":"./node_modules/moment/locale/sv.js","./sv.js":"./node_modules/moment/locale/sv.js","./sw":"./node_modules/moment/locale/sw.js","./sw.js":"./node_modules/moment/locale/sw.js","./ta":"./node_modules/moment/locale/ta.js","./ta.js":"./node_modules/moment/locale/ta.js","./te":"./node_modules/moment/locale/te.js","./te.js":"./node_modules/moment/locale/te.js","./tet":"./node_modules/moment/locale/tet.js","./tet.js":"./node_modules/moment/locale/tet.js","./tg":"./node_modules/moment/locale/tg.js","./tg.js":"./node_modules/moment/locale/tg.js","./th":"./node_modules/moment/locale/th.js","./th.js":"./node_modules/moment/locale/th.js","./tl-ph":"./node_modules/moment/locale/tl-ph.js","./tl-ph.js":"./node_modules/moment/locale/tl-ph.js","./tlh":"./node_modules/moment/locale/tlh.js","./tlh.js":"./node_modules/moment/locale/tlh.js","./tr":"./node_modules/moment/locale/tr.js","./tr.js":"./node_modules/moment/locale/tr.js","./tzl":"./node_modules/moment/locale/tzl.js","./tzl.js":"./node_modules/moment/locale/tzl.js","./tzm":"./node_modules/moment/locale/tzm.js","./tzm-latn":"./node_modules/moment/locale/tzm-latn.js","./tzm-latn.js":"./node_modules/moment/locale/tzm-latn.js","./tzm.js":"./node_modules/moment/locale/tzm.js","./ug-cn":"./node_modules/moment/locale/ug-cn.js","./ug-cn.js":"./node_modules/moment/locale/ug-cn.js","./uk":"./node_modules/moment/locale/uk.js","./uk.js":"./node_modules/moment/locale/uk.js","./ur":"./node_modules/moment/locale/ur.js","./ur.js":"./node_modules/moment/locale/ur.js","./uz":"./node_modules/moment/locale/uz.js","./uz-latn":"./node_modules/moment/locale/uz-latn.js","./uz-latn.js":"./node_modules/moment/locale/uz-latn.js","./uz.js":"./node_modules/moment/locale/uz.js","./vi":"./node_modules/moment/locale/vi.js","./vi.js":"./node_modules/moment/locale/vi.js","./x-pseudo":"./node_modules/moment/locale/x-pseudo.js","./x-pseudo.js":"./node_modules/moment/locale/x-pseudo.js","./yo":"./node_modules/moment/locale/yo.js","./yo.js":"./node_modules/moment/locale/yo.js","./zh-cn":"./node_modules/moment/locale/zh-cn.js","./zh-cn.js":"./node_modules/moment/locale/zh-cn.js","./zh-hk":"./node_modules/moment/locale/zh-hk.js","./zh-hk.js":"./node_modules/moment/locale/zh-hk.js","./zh-tw":"./node_modules/moment/locale/zh-tw.js","./zh-tw.js":"./node_modules/moment/locale/zh-tw.js"};function n(e){var t=a(e);return i(t)}function a(e){if(!i.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=a,e.exports=n,n.id="./node_modules/moment/locale sync recursive ^\\.\\/.*$"},"./node_modules/raw-loader/index.js!./node_modules/babel-loader/lib/index.js?!./node_modules/ifdef-loader/ifdef-loader.js?!./src/lib/jqueryui/jquery-ui-i18n.js":function(e,t){e.exports="/*! jQuery UI - v1.10.4 - 2014-01-29\n* http://jqueryui.com\n* Includes: jquery.ui.datepicker-af.js, jquery.ui.datepicker-ar-DZ.js, jquery.ui.datepicker-ar.js, jquery.ui.datepicker-az.js, jquery.ui.datepicker-bg.js, jquery.ui.datepicker-bs.js, jquery.ui.datepicker-ca.js, jquery.ui.datepicker-cs.js, jquery.ui.datepicker-cy-GB.js, jquery.ui.datepicker-da.js, jquery.ui.datepicker-de.js, jquery.ui.datepicker-el.js, jquery.ui.datepicker-en-AU.js, jquery.ui.datepicker-en-GB.js, jquery.ui.datepicker-en-NZ.js, jquery.ui.datepicker-eo.js, jquery.ui.datepicker-es.js, jquery.ui.datepicker-et.js, jquery.ui.datepicker-eu.js, jquery.ui.datepicker-fa.js, jquery.ui.datepicker-fi.js, jquery.ui.datepicker-fo.js, jquery.ui.datepicker-fr-CH.js, jquery.ui.datepicker-fr.js, jquery.ui.datepicker-gl.js, jquery.ui.datepicker-he.js, jquery.ui.datepicker-hi.js, jquery.ui.datepicker-hr.js, jquery.ui.datepicker-hu.js, jquery.ui.datepicker-hy.js, jquery.ui.datepicker-id.js, jquery.ui.datepicker-is.js, jquery.ui.datepicker-it.js, jquery.ui.datepicker-ja.js, jquery.ui.datepicker-ka.js, jquery.ui.datepicker-kk.js, jquery.ui.datepicker-km.js, jquery.ui.datepicker-ko.js, jquery.ui.datepicker-lb.js, jquery.ui.datepicker-lt.js, jquery.ui.datepicker-lv.js, jquery.ui.datepicker-mk.js, jquery.ui.datepicker-ml.js, jquery.ui.datepicker-ms.js, jquery.ui.datepicker-nl-BE.js, jquery.ui.datepicker-nl.js, jquery.ui.datepicker-no.js, jquery.ui.datepicker-pl.js, jquery.ui.datepicker-pt-BR.js, jquery.ui.datepicker-pt.js, jquery.ui.datepicker-rm.js, jquery.ui.datepicker-ro.js, jquery.ui.datepicker-ru.js, jquery.ui.datepicker-sk.js, jquery.ui.datepicker-sl.js, jquery.ui.datepicker-sq.js, jquery.ui.datepicker-sr-SR.js, jquery.ui.datepicker-sr.js, jquery.ui.datepicker-sv.js, jquery.ui.datepicker-ta.js, jquery.ui.datepicker-th.js, jquery.ui.datepicker-tj.js, jquery.ui.datepicker-tr.js, jquery.ui.datepicker-uk.js, jquery.ui.datepicker-vi.js, jquery.ui.datepicker-zh-CN.js, jquery.ui.datepicker-zh-HK.js, jquery.ui.datepicker-zh-TW.js, jquery.ui.datepicker-be.js, jquery.ui.datepicker-fr-CA.js, jquery.ui.datepicker-ky.js, jquery.ui.datepicker-nb.js, jquery.ui.datepicker-nn.js\n* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */\n\n/* Written by Renier Pretorius. */\n(function ($) {\n  $.datepicker.regional['af'] = {\n    closeText: 'Selekteer',\n    prevText: 'Vorige',\n    nextText: 'Volgende',\n    currentText: 'Vandag',\n    monthNames: ['Januarie', 'Februarie', 'Maart', 'April', 'Mei', 'Junie', 'Julie', 'Augustus', 'September', 'Oktober', 'November', 'Desember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mrt', 'Apr', 'Mei', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'],\n    dayNames: ['Sondag', 'Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrydag', 'Saterdag'],\n    dayNamesShort: ['Son', 'Maa', 'Din', 'Woe', 'Don', 'Vry', 'Sat'],\n    dayNamesMin: ['So', 'Ma', 'Di', 'Wo', 'Do', 'Vr', 'Sa'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['af']);\n\n  /* Mohamed Cherif BOUCHELAGHEM -- cherifbouchelaghem@yahoo.fr */\n\n  $.datepicker.regional['ar-DZ'] = {\n    closeText: 'إغلاق',\n    prevText: '&#x3C;السابق',\n    nextText: 'التالي&#x3E;',\n    currentText: 'اليوم',\n    monthNames: ['جانفي', 'فيفري', 'مارس', 'أفريل', 'ماي', 'جوان', 'جويلية', 'أوت', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'],\n    monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],\n    dayNames: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],\n    dayNamesShort: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],\n    dayNamesMin: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],\n    weekHeader: 'أسبوع',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 6,\n    isRTL: true,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ar-DZ']);\n\n  /* Khaled Alhourani -- me@khaledalhourani.com */\n\n  /* NOTE: monthNames are the original months names and they are the Arabic names, not the new months name فبراير - يناير and there isn't any Arabic roots for these months */\n\n  $.datepicker.regional['ar'] = {\n    closeText: 'إغلاق',\n    prevText: '&#x3C;السابق',\n    nextText: 'التالي&#x3E;',\n    currentText: 'اليوم',\n    monthNames: ['كانون الثاني', 'شباط', 'آذار', 'نيسان', 'مايو', 'حزيران', 'تموز', 'آب', 'أيلول', 'تشرين الأول', 'تشرين الثاني', 'كانون الأول'],\n    monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],\n    dayNames: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],\n    dayNamesShort: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],\n    dayNamesMin: ['ح', 'ن', 'ث', 'ر', 'خ', 'ج', 'س'],\n    weekHeader: 'أسبوع',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 6,\n    isRTL: true,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ar']);\n\n  /* Written by Jamil Najafov (necefov33@gmail.com). */\n\n  $.datepicker.regional['az'] = {\n    closeText: 'Bağla',\n    prevText: '&#x3C;Geri',\n    nextText: 'İrəli&#x3E;',\n    currentText: 'Bugün',\n    monthNames: ['Yanvar', 'Fevral', 'Mart', 'Aprel', 'May', 'İyun', 'İyul', 'Avqust', 'Sentyabr', 'Oktyabr', 'Noyabr', 'Dekabr'],\n    monthNamesShort: ['Yan', 'Fev', 'Mar', 'Apr', 'May', 'İyun', 'İyul', 'Avq', 'Sen', 'Okt', 'Noy', 'Dek'],\n    dayNames: ['Bazar', 'Bazar ertəsi', 'Çərşənbə axşamı', 'Çərşənbə', 'Cümə axşamı', 'Cümə', 'Şənbə'],\n    dayNamesShort: ['B', 'Be', 'Ça', 'Ç', 'Ca', 'C', 'Ş'],\n    dayNamesMin: ['B', 'B', 'Ç', 'С', 'Ç', 'C', 'Ş'],\n    weekHeader: 'Hf',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['az']);\n\n  /* Written by Stoyan Kyosev (http://svest.org). */\n\n  $.datepicker.regional['bg'] = {\n    closeText: 'затвори',\n    prevText: '&#x3C;назад',\n    nextText: 'напред&#x3E;',\n    nextBigText: '&#x3E;&#x3E;',\n    currentText: 'днес',\n    monthNames: ['Януари', 'Февруари', 'Март', 'Април', 'Май', 'Юни', 'Юли', 'Август', 'Септември', 'Октомври', 'Ноември', 'Декември'],\n    monthNamesShort: ['Яну', 'Фев', 'Мар', 'Апр', 'Май', 'Юни', 'Юли', 'Авг', 'Сеп', 'Окт', 'Нов', 'Дек'],\n    dayNames: ['Неделя', 'Понеделник', 'Вторник', 'Сряда', 'Четвъртък', 'Петък', 'Събота'],\n    dayNamesShort: ['Нед', 'Пон', 'Вто', 'Сря', 'Чет', 'Пет', 'Съб'],\n    dayNamesMin: ['Не', 'По', 'Вт', 'Ср', 'Че', 'Пе', 'Съ'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['bg']);\n\n  /* Written by Kenan Konjo. */\n\n  $.datepicker.regional['bs'] = {\n    closeText: 'Zatvori',\n    prevText: '&#x3C;',\n    nextText: '&#x3E;',\n    currentText: 'Danas',\n    monthNames: ['Januar', 'Februar', 'Mart', 'April', 'Maj', 'Juni', 'Juli', 'August', 'Septembar', 'Oktobar', 'Novembar', 'Decembar'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['Nedelja', 'Ponedeljak', 'Utorak', 'Srijeda', 'Četvrtak', 'Petak', 'Subota'],\n    dayNamesShort: ['Ned', 'Pon', 'Uto', 'Sri', 'Čet', 'Pet', 'Sub'],\n    dayNamesMin: ['Ne', 'Po', 'Ut', 'Sr', 'Če', 'Pe', 'Su'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['bs']);\n\n  /* Writers: (joan.leon@gmail.com). */\n\n  $.datepicker.regional['ca'] = {\n    closeText: 'Tanca',\n    prevText: 'Anterior',\n    nextText: 'Següent',\n    currentText: 'Avui',\n    monthNames: ['gener', 'febrer', 'març', 'abril', 'maig', 'juny', 'juliol', 'agost', 'setembre', 'octubre', 'novembre', 'desembre'],\n    monthNamesShort: ['gen', 'feb', 'març', 'abr', 'maig', 'juny', 'jul', 'ag', 'set', 'oct', 'nov', 'des'],\n    dayNames: ['diumenge', 'dilluns', 'dimarts', 'dimecres', 'dijous', 'divendres', 'dissabte'],\n    dayNamesShort: ['dg', 'dl', 'dt', 'dc', 'dj', 'dv', 'ds'],\n    dayNamesMin: ['dg', 'dl', 'dt', 'dc', 'dj', 'dv', 'ds'],\n    weekHeader: 'Set',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ca']);\n\n  /* Written by Tomas Muller (tomas@tomas-muller.net). */\n\n  $.datepicker.regional['cs'] = {\n    closeText: 'Zavřít',\n    prevText: '&#x3C;Dříve',\n    nextText: 'Později&#x3E;',\n    currentText: 'Nyní',\n    monthNames: ['leden', 'únor', 'březen', 'duben', 'květen', 'červen', 'červenec', 'srpen', 'září', 'říjen', 'listopad', 'prosinec'],\n    monthNamesShort: ['led', 'úno', 'bře', 'dub', 'kvě', 'čer', 'čvc', 'srp', 'zář', 'říj', 'lis', 'pro'],\n    dayNames: ['neděle', 'pondělí', 'úterý', 'středa', 'čtvrtek', 'pátek', 'sobota'],\n    dayNamesShort: ['ne', 'po', 'út', 'st', 'čt', 'pá', 'so'],\n    dayNamesMin: ['ne', 'po', 'út', 'st', 'čt', 'pá', 'so'],\n    weekHeader: 'Týd',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['cs']);\n\n  /* Written by William Griffiths. */\n\n  $.datepicker.regional['cy-GB'] = {\n    closeText: 'Done',\n    prevText: 'Prev',\n    nextText: 'Next',\n    currentText: 'Today',\n    monthNames: ['Ionawr', 'Chwefror', 'Mawrth', 'Ebrill', 'Mai', 'Mehefin', 'Gorffennaf', 'Awst', 'Medi', 'Hydref', 'Tachwedd', 'Rhagfyr'],\n    monthNamesShort: ['Ion', 'Chw', 'Maw', 'Ebr', 'Mai', 'Meh', 'Gor', 'Aws', 'Med', 'Hyd', 'Tac', 'Rha'],\n    dayNames: ['Dydd Sul', 'Dydd Llun', 'Dydd Mawrth', 'Dydd Mercher', 'Dydd Iau', 'Dydd Gwener', 'Dydd Sadwrn'],\n    dayNamesShort: ['Sul', 'Llu', 'Maw', 'Mer', 'Iau', 'Gwe', 'Sad'],\n    dayNamesMin: ['Su', 'Ll', 'Ma', 'Me', 'Ia', 'Gw', 'Sa'],\n    weekHeader: 'Wy',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['cy-GB']);\n\n  /* Written by Jan Christensen ( deletestuff@gmail.com). */\n\n  $.datepicker.regional['da'] = {\n    closeText: 'Luk',\n    prevText: '&#x3C;Forrige',\n    nextText: 'Næste&#x3E;',\n    currentText: 'Idag',\n    monthNames: ['Januar', 'Februar', 'Marts', 'April', 'Maj', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['Søndag', 'Mandag', 'Tirsdag', 'Onsdag', 'Torsdag', 'Fredag', 'Lørdag'],\n    dayNamesShort: ['Søn', 'Man', 'Tir', 'Ons', 'Tor', 'Fre', 'Lør'],\n    dayNamesMin: ['Sø', 'Ma', 'Ti', 'On', 'To', 'Fr', 'Lø'],\n    weekHeader: 'Uge',\n    dateFormat: 'dd-mm-yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['da']);\n\n  /* Written by Milian Wolff (mail@milianw.de). */\n\n  $.datepicker.regional['de'] = {\n    closeText: 'Schließen',\n    prevText: '&#x3C;Zurück',\n    nextText: 'Vor&#x3E;',\n    currentText: 'Heute',\n    monthNames: ['Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],\n    dayNames: ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'],\n    dayNamesShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],\n    dayNamesMin: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],\n    weekHeader: 'KW',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['de']);\n\n  /* Written by Alex Cicovic (http://www.alexcicovic.com) */\n\n  $.datepicker.regional['el'] = {\n    closeText: 'Κλείσιμο',\n    prevText: 'Προηγούμενος',\n    nextText: 'Επόμενος',\n    currentText: 'Τρέχων Μήνας',\n    monthNames: ['Ιανουάριος', 'Φεβρουάριος', 'Μάρτιος', 'Απρίλιος', 'Μάιος', 'Ιούνιος', 'Ιούλιος', 'Αύγουστος', 'Σεπτέμβριος', 'Οκτώβριος', 'Νοέμβριος', 'Δεκέμβριος'],\n    monthNamesShort: ['Ιαν', 'Φεβ', 'Μαρ', 'Απρ', 'Μαι', 'Ιουν', 'Ιουλ', 'Αυγ', 'Σεπ', 'Οκτ', 'Νοε', 'Δεκ'],\n    dayNames: ['Κυριακή', 'Δευτέρα', 'Τρίτη', 'Τετάρτη', 'Πέμπτη', 'Παρασκευή', 'Σάββατο'],\n    dayNamesShort: ['Κυρ', 'Δευ', 'Τρι', 'Τετ', 'Πεμ', 'Παρ', 'Σαβ'],\n    dayNamesMin: ['Κυ', 'Δε', 'Τρ', 'Τε', 'Πε', 'Πα', 'Σα'],\n    weekHeader: 'Εβδ',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['el']);\n\n  /* Based on the en-GB initialisation. */\n\n  $.datepicker.regional['en-AU'] = {\n    closeText: 'Done',\n    prevText: 'Prev',\n    nextText: 'Next',\n    currentText: 'Today',\n    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n    dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n    dayNamesMin: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['en-AU']);\n\n  /* Written by Stuart. */\n\n  $.datepicker.regional['en-GB'] = {\n    closeText: 'Done',\n    prevText: 'Prev',\n    nextText: 'Next',\n    currentText: 'Today',\n    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n    dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n    dayNamesMin: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['en-GB']);\n\n  /* Based on the en-GB initialisation. */\n\n  $.datepicker.regional['en-NZ'] = {\n    closeText: 'Done',\n    prevText: 'Prev',\n    nextText: 'Next',\n    currentText: 'Today',\n    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n    dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n    dayNamesMin: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['en-NZ']);\n\n  /* Written by Olivier M. (olivierweb@ifrance.com). */\n\n  $.datepicker.regional['eo'] = {\n    closeText: 'Fermi',\n    prevText: '&#x3C;Anta',\n    nextText: 'Sekv&#x3E;',\n    currentText: 'Nuna',\n    monthNames: ['Januaro', 'Februaro', 'Marto', 'Aprilo', 'Majo', 'Junio', 'Julio', 'Aŭgusto', 'Septembro', 'Oktobro', 'Novembro', 'Decembro'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Aŭg', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['Dimanĉo', 'Lundo', 'Mardo', 'Merkredo', 'Ĵaŭdo', 'Vendredo', 'Sabato'],\n    dayNamesShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Ĵaŭ', 'Ven', 'Sab'],\n    dayNamesMin: ['Di', 'Lu', 'Ma', 'Me', 'Ĵa', 'Ve', 'Sa'],\n    weekHeader: 'Sb',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['eo']);\n\n  /* Traducido por Vester (xvester@gmail.com). */\n\n  $.datepicker.regional['es'] = {\n    closeText: 'Cerrar',\n    prevText: '&#x3C;Ant',\n    nextText: 'Sig&#x3E;',\n    currentText: 'Hoy',\n    monthNames: ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'],\n    monthNamesShort: ['ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ogo', 'sep', 'oct', 'nov', 'dic'],\n    dayNames: ['domingo', 'lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado'],\n    dayNamesShort: ['dom', 'lun', 'mar', 'mié', 'juv', 'vie', 'sáb'],\n    dayNamesMin: ['D', 'L', 'M', 'X', 'J', 'V', 'S'],\n    weekHeader: 'Sm',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['es']);\n\n  /* Written by Mart Sõmermaa (mrts.pydev at gmail com). */\n\n  $.datepicker.regional['et'] = {\n    closeText: 'Sulge',\n    prevText: 'Eelnev',\n    nextText: 'Järgnev',\n    currentText: 'Täna',\n    monthNames: ['Jaanuar', 'Veebruar', 'Märts', 'Aprill', 'Mai', 'Juuni', 'Juuli', 'August', 'September', 'Oktoober', 'November', 'Detsember'],\n    monthNamesShort: ['Jaan', 'Veebr', 'Märts', 'Apr', 'Mai', 'Juuni', 'Juuli', 'Aug', 'Sept', 'Okt', 'Nov', 'Dets'],\n    dayNames: ['Pühapäev', 'Esmaspäev', 'Teisipäev', 'Kolmapäev', 'Neljapäev', 'Reede', 'Laupäev'],\n    dayNamesShort: ['Pühap', 'Esmasp', 'Teisip', 'Kolmap', 'Neljap', 'Reede', 'Laup'],\n    dayNamesMin: ['P', 'E', 'T', 'K', 'N', 'R', 'L'],\n    weekHeader: 'näd',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['et']);\n\n  /* Karrikas-ek itzulia (karrikas@karrikas.com) */\n\n  $.datepicker.regional['eu'] = {\n    closeText: 'Egina',\n    prevText: '&#x3C;Aur',\n    nextText: 'Hur&#x3E;',\n    currentText: 'Gaur',\n    monthNames: ['urtarrila', 'otsaila', 'martxoa', 'apirila', 'maiatza', 'ekaina', 'uztaila', 'abuztua', 'iraila', 'urria', 'azaroa', 'abendua'],\n    monthNamesShort: ['urt.', 'ots.', 'mar.', 'api.', 'mai.', 'eka.', 'uzt.', 'abu.', 'ira.', 'urr.', 'aza.', 'abe.'],\n    dayNames: ['igandea', 'astelehena', 'asteartea', 'asteazkena', 'osteguna', 'ostirala', 'larunbata'],\n    dayNamesShort: ['ig.', 'al.', 'ar.', 'az.', 'og.', 'ol.', 'lr.'],\n    dayNamesMin: ['ig', 'al', 'ar', 'az', 'og', 'ol', 'lr'],\n    weekHeader: 'As',\n    dateFormat: 'yy-mm-dd',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['eu']);\n\n  /* Javad Mowlanezhad -- jmowla@gmail.com */\n\n  /* Jalali calendar should supported soon! (Its implemented but I have to test it) */\n\n  $.datepicker.regional['fa'] = {\n    closeText: 'بستن',\n    prevText: '&#x3C;قبلی',\n    nextText: 'بعدی&#x3E;',\n    currentText: 'امروز',\n    monthNames: ['فروردين', 'ارديبهشت', 'خرداد', 'تير', 'مرداد', 'شهريور', 'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'],\n    monthNamesShort: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'],\n    dayNames: ['يکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه', 'جمعه', 'شنبه'],\n    dayNamesShort: ['ی', 'د', 'س', 'چ', 'پ', 'ج', 'ش'],\n    dayNamesMin: ['ی', 'د', 'س', 'چ', 'پ', 'ج', 'ش'],\n    weekHeader: 'هف',\n    dateFormat: 'yy/mm/dd',\n    firstDay: 6,\n    isRTL: true,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['fa']);\n\n  /* Written by Harri Kilpiö (harrikilpio@gmail.com). */\n\n  $.datepicker.regional['fi'] = {\n    closeText: 'Sulje',\n    prevText: '&#xAB;Edellinen',\n    nextText: 'Seuraava&#xBB;',\n    currentText: 'Tänään',\n    monthNames: ['Tammikuu', 'Helmikuu', 'Maaliskuu', 'Huhtikuu', 'Toukokuu', 'Kesäkuu', 'Heinäkuu', 'Elokuu', 'Syyskuu', 'Lokakuu', 'Marraskuu', 'Joulukuu'],\n    monthNamesShort: ['Tammi', 'Helmi', 'Maalis', 'Huhti', 'Touko', 'Kesä', 'Heinä', 'Elo', 'Syys', 'Loka', 'Marras', 'Joulu'],\n    dayNamesShort: ['Su', 'Ma', 'Ti', 'Ke', 'To', 'Pe', 'La'],\n    dayNames: ['Sunnuntai', 'Maanantai', 'Tiistai', 'Keskiviikko', 'Torstai', 'Perjantai', 'Lauantai'],\n    dayNamesMin: ['Su', 'Ma', 'Ti', 'Ke', 'To', 'Pe', 'La'],\n    weekHeader: 'Vk',\n    dateFormat: 'd.m.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['fi']);\n\n  /* Written by Sverri Mohr Olsen, sverrimo@gmail.com */\n\n  $.datepicker.regional['fo'] = {\n    closeText: 'Lat aftur',\n    prevText: '&#x3C;Fyrra',\n    nextText: 'Næsta&#x3E;',\n    currentText: 'Í dag',\n    monthNames: ['Januar', 'Februar', 'Mars', 'Apríl', 'Mei', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Desember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Des'],\n    dayNames: ['Sunnudagur', 'Mánadagur', 'Týsdagur', 'Mikudagur', 'Hósdagur', 'Fríggjadagur', 'Leyardagur'],\n    dayNamesShort: ['Sun', 'Mán', 'Týs', 'Mik', 'Hós', 'Frí', 'Ley'],\n    dayNamesMin: ['Su', 'Má', 'Tý', 'Mi', 'Hó', 'Fr', 'Le'],\n    weekHeader: 'Vk',\n    dateFormat: 'dd-mm-yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['fo']);\n\n  /* Written Martin Voelkle (martin.voelkle@e-tc.ch). */\n\n  $.datepicker.regional['fr-CH'] = {\n    closeText: 'Fermer',\n    prevText: '&#x3C;Préc',\n    nextText: 'Suiv&#x3E;',\n    currentText: 'Courant',\n    monthNames: ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'],\n    monthNamesShort: ['janv.', 'févr.', 'mars', 'avril', 'mai', 'juin', 'juil.', 'août', 'sept.', 'oct.', 'nov.', 'déc.'],\n    dayNames: ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'],\n    dayNamesShort: ['dim.', 'lun.', 'mar.', 'mer.', 'jeu.', 'ven.', 'sam.'],\n    dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],\n    weekHeader: 'Sm',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['fr-CH']);\n\n  /* Written by Keith Wood (kbwood{at}iinet.com.au),\n  \t\t\t  Stéphane Nahmani (sholby@sholby.net),\n  \t\t\t  Stéphane Raimbault <stephane.raimbault@gmail.com> */\n\n  $.datepicker.regional['fr'] = {\n    closeText: 'Fermer',\n    prevText: 'Précédent',\n    nextText: 'Suivant',\n    currentText: 'Aujourd\\'hui',\n    monthNames: ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'],\n    monthNamesShort: ['janv.', 'févr.', 'mars', 'avril', 'mai', 'juin', 'juil.', 'août', 'sept.', 'oct.', 'nov.', 'déc.'],\n    dayNames: ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'],\n    dayNamesShort: ['dim.', 'lun.', 'mar.', 'mer.', 'jeu.', 'ven.', 'sam.'],\n    dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],\n    weekHeader: 'Sem.',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['fr']);\n\n  /* Translated by Jorge Barreiro <yortx.barry@gmail.com>. */\n\n  $.datepicker.regional['gl'] = {\n    closeText: 'Pechar',\n    prevText: '&#x3C;Ant',\n    nextText: 'Seg&#x3E;',\n    currentText: 'Hoxe',\n    monthNames: ['Xaneiro', 'Febreiro', 'Marzo', 'Abril', 'Maio', 'Xuño', 'Xullo', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Decembro'],\n    monthNamesShort: ['Xan', 'Feb', 'Mar', 'Abr', 'Mai', 'Xuñ', 'Xul', 'Ago', 'Set', 'Out', 'Nov', 'Dec'],\n    dayNames: ['Domingo', 'Luns', 'Martes', 'Mércores', 'Xoves', 'Venres', 'Sábado'],\n    dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mér', 'Xov', 'Ven', 'Sáb'],\n    dayNamesMin: ['Do', 'Lu', 'Ma', 'Mé', 'Xo', 'Ve', 'Sá'],\n    weekHeader: 'Sm',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['gl']);\n\n  /* Written by Amir Hardon (ahardon at gmail dot com). */\n\n  $.datepicker.regional['he'] = {\n    closeText: 'סגור',\n    prevText: '&#x3C;הקודם',\n    nextText: 'הבא&#x3E;',\n    currentText: 'היום',\n    monthNames: ['ינואר', 'פברואר', 'מרץ', 'אפריל', 'מאי', 'יוני', 'יולי', 'אוגוסט', 'ספטמבר', 'אוקטובר', 'נובמבר', 'דצמבר'],\n    monthNamesShort: ['ינו', 'פבר', 'מרץ', 'אפר', 'מאי', 'יוני', 'יולי', 'אוג', 'ספט', 'אוק', 'נוב', 'דצמ'],\n    dayNames: ['ראשון', 'שני', 'שלישי', 'רביעי', 'חמישי', 'שישי', 'שבת'],\n    dayNamesShort: ['א\\'', 'ב\\'', 'ג\\'', 'ד\\'', 'ה\\'', 'ו\\'', 'שבת'],\n    dayNamesMin: ['א\\'', 'ב\\'', 'ג\\'', 'ד\\'', 'ה\\'', 'ו\\'', 'שבת'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: true,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['he']);\n\n  /* Written by Michael Dawart. */\n\n  $.datepicker.regional['hi'] = {\n    closeText: 'बंद',\n    prevText: 'पिछला',\n    nextText: 'अगला',\n    currentText: 'आज',\n    monthNames: ['जनवरी ', 'फरवरी', 'मार्च', 'अप्रेल', 'मई', 'जून', 'जूलाई', 'अगस्त ', 'सितम्बर', 'अक्टूबर', 'नवम्बर', 'दिसम्बर'],\n    monthNamesShort: ['जन', 'फर', 'मार्च', 'अप्रेल', 'मई', 'जून', 'जूलाई', 'अग', 'सित', 'अक्ट', 'नव', 'दि'],\n    dayNames: ['रविवार', 'सोमवार', 'मंगलवार', 'बुधवार', 'गुरुवार', 'शुक्रवार', 'शनिवार'],\n    dayNamesShort: ['रवि', 'सोम', 'मंगल', 'बुध', 'गुरु', 'शुक्र', 'शनि'],\n    dayNamesMin: ['रवि', 'सोम', 'मंगल', 'बुध', 'गुरु', 'शुक्र', 'शनि'],\n    weekHeader: 'हफ्ता',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['hi']);\n\n  /* Written by Vjekoslav Nesek. */\n\n  $.datepicker.regional['hr'] = {\n    closeText: 'Zatvori',\n    prevText: '&#x3C;',\n    nextText: '&#x3E;',\n    currentText: 'Danas',\n    monthNames: ['Siječanj', 'Veljača', 'Ožujak', 'Travanj', 'Svibanj', 'Lipanj', 'Srpanj', 'Kolovoz', 'Rujan', 'Listopad', 'Studeni', 'Prosinac'],\n    monthNamesShort: ['Sij', 'Velj', 'Ožu', 'Tra', 'Svi', 'Lip', 'Srp', 'Kol', 'Ruj', 'Lis', 'Stu', 'Pro'],\n    dayNames: ['Nedjelja', 'Ponedjeljak', 'Utorak', 'Srijeda', 'Četvrtak', 'Petak', 'Subota'],\n    dayNamesShort: ['Ned', 'Pon', 'Uto', 'Sri', 'Čet', 'Pet', 'Sub'],\n    dayNamesMin: ['Ne', 'Po', 'Ut', 'Sr', 'Če', 'Pe', 'Su'],\n    weekHeader: 'Tje',\n    dateFormat: 'dd.mm.yy.',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['hr']);\n\n  /* Written by Istvan Karaszi (jquery@spam.raszi.hu). */\n\n  $.datepicker.regional['hu'] = {\n    closeText: 'bezár',\n    prevText: 'vissza',\n    nextText: 'előre',\n    currentText: 'ma',\n    monthNames: ['Január', 'Február', 'Március', 'Április', 'Május', 'Június', 'Július', 'Augusztus', 'Szeptember', 'Október', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Már', 'Ápr', 'Máj', 'Jún', 'Júl', 'Aug', 'Szep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['Vasárnap', 'Hétfő', 'Kedd', 'Szerda', 'Csütörtök', 'Péntek', 'Szombat'],\n    dayNamesShort: ['Vas', 'Hét', 'Ked', 'Sze', 'Csü', 'Pén', 'Szo'],\n    dayNamesMin: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],\n    weekHeader: 'Hét',\n    dateFormat: 'yy.mm.dd.',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['hu']);\n\n  /* Written by Levon Zakaryan (levon.zakaryan@gmail.com)*/\n\n  $.datepicker.regional['hy'] = {\n    closeText: 'Փակել',\n    prevText: '&#x3C;Նախ.',\n    nextText: 'Հաջ.&#x3E;',\n    currentText: 'Այսօր',\n    monthNames: ['Հունվար', 'Փետրվար', 'Մարտ', 'Ապրիլ', 'Մայիս', 'Հունիս', 'Հուլիս', 'Օգոստոս', 'Սեպտեմբեր', 'Հոկտեմբեր', 'Նոյեմբեր', 'Դեկտեմբեր'],\n    monthNamesShort: ['Հունվ', 'Փետր', 'Մարտ', 'Ապր', 'Մայիս', 'Հունիս', 'Հուլ', 'Օգս', 'Սեպ', 'Հոկ', 'Նոյ', 'Դեկ'],\n    dayNames: ['կիրակի', 'եկուշաբթի', 'երեքշաբթի', 'չորեքշաբթի', 'հինգշաբթի', 'ուրբաթ', 'շաբաթ'],\n    dayNamesShort: ['կիր', 'երկ', 'երք', 'չրք', 'հնգ', 'ուրբ', 'շբթ'],\n    dayNamesMin: ['կիր', 'երկ', 'երք', 'չրք', 'հնգ', 'ուրբ', 'շբթ'],\n    weekHeader: 'ՇԲՏ',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['hy']);\n\n  /* Written by Deden Fathurahman (dedenf@gmail.com). */\n\n  $.datepicker.regional['id'] = {\n    closeText: 'Tutup',\n    prevText: '&#x3C;mundur',\n    nextText: 'maju&#x3E;',\n    currentText: 'hari ini',\n    monthNames: ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'Nopember', 'Desember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agus', 'Sep', 'Okt', 'Nop', 'Des'],\n    dayNames: ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'],\n    dayNamesShort: ['Min', 'Sen', 'Sel', 'Rab', 'kam', 'Jum', 'Sab'],\n    dayNamesMin: ['Mg', 'Sn', 'Sl', 'Rb', 'Km', 'jm', 'Sb'],\n    weekHeader: 'Mg',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['id']);\n\n  /* Written by Haukur H. Thorsson (haukur@eskill.is). */\n\n  $.datepicker.regional['is'] = {\n    closeText: 'Loka',\n    prevText: '&#x3C; Fyrri',\n    nextText: 'Næsti &#x3E;',\n    currentText: 'Í dag',\n    monthNames: ['Janúar', 'Febrúar', 'Mars', 'Apríl', 'Maí', 'Júní', 'Júlí', 'Ágúst', 'September', 'Október', 'Nóvember', 'Desember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maí', 'Jún', 'Júl', 'Ágú', 'Sep', 'Okt', 'Nóv', 'Des'],\n    dayNames: ['Sunnudagur', 'Mánudagur', 'Þriðjudagur', 'Miðvikudagur', 'Fimmtudagur', 'Föstudagur', 'Laugardagur'],\n    dayNamesShort: ['Sun', 'Mán', 'Þri', 'Mið', 'Fim', 'Fös', 'Lau'],\n    dayNamesMin: ['Su', 'Má', 'Þr', 'Mi', 'Fi', 'Fö', 'La'],\n    weekHeader: 'Vika',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['is']);\n\n  /* Written by Antonello Pasella (antonello.pasella@gmail.com). */\n\n  $.datepicker.regional['it'] = {\n    closeText: 'Chiudi',\n    prevText: '&#x3C;Prec',\n    nextText: 'Succ&#x3E;',\n    currentText: 'Oggi',\n    monthNames: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],\n    monthNamesShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],\n    dayNames: ['Domenica', 'Lunedì', 'Martedì', 'Mercoledì', 'Giovedì', 'Venerdì', 'Sabato'],\n    dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'],\n    dayNamesMin: ['Do', 'Lu', 'Ma', 'Me', 'Gi', 'Ve', 'Sa'],\n    weekHeader: 'Sm',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['it']);\n\n  /* Written by Kentaro SATO (kentaro@ranvis.com). */\n\n  $.datepicker.regional['ja'] = {\n    closeText: '閉じる',\n    prevText: '&#x3C;前',\n    nextText: '次&#x3E;',\n    currentText: '今日',\n    monthNames: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],\n    monthNamesShort: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],\n    dayNames: ['日曜日', '月曜日', '火曜日', '水曜日', '木曜日', '金曜日', '土曜日'],\n    dayNamesShort: ['日', '月', '火', '水', '木', '金', '土'],\n    dayNamesMin: ['日', '月', '火', '水', '木', '金', '土'],\n    weekHeader: '週',\n    dateFormat: 'yy/mm/dd',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: '年'\n  }; //$.datepicker.setDefaults($.datepicker.regional['ja']);\n\n  /* Written by Lado Lomidze (lado.lomidze@gmail.com). */\n\n  $.datepicker.regional['ka'] = {\n    closeText: 'დახურვა',\n    prevText: '&#x3c; წინა',\n    nextText: 'შემდეგი &#x3e;',\n    currentText: 'დღეს',\n    monthNames: ['იანვარი', 'თებერვალი', 'მარტი', 'აპრილი', 'მაისი', 'ივნისი', 'ივლისი', 'აგვისტო', 'სექტემბერი', 'ოქტომბერი', 'ნოემბერი', 'დეკემბერი'],\n    monthNamesShort: ['იან', 'თებ', 'მარ', 'აპრ', 'მაი', 'ივნ', 'ივლ', 'აგვ', 'სექ', 'ოქტ', 'ნოე', 'დეკ'],\n    dayNames: ['კვირა', 'ორშაბათი', 'სამშაბათი', 'ოთხშაბათი', 'ხუთშაბათი', 'პარასკევი', 'შაბათი'],\n    dayNamesShort: ['კვ', 'ორშ', 'სამ', 'ოთხ', 'ხუთ', 'პარ', 'შაბ'],\n    dayNamesMin: ['კვ', 'ორშ', 'სამ', 'ოთხ', 'ხუთ', 'პარ', 'შაბ'],\n    weekHeader: 'კვირა',\n    dateFormat: 'dd-mm-yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ka']);\n\n  /* Written by Dmitriy Karasyov (dmitriy.karasyov@gmail.com). */\n\n  $.datepicker.regional['kk'] = {\n    closeText: 'Жабу',\n    prevText: '&#x3C;Алдыңғы',\n    nextText: 'Келесі&#x3E;',\n    currentText: 'Бүгін',\n    monthNames: ['Қаңтар', 'Ақпан', 'Наурыз', 'Сәуір', 'Мамыр', 'Маусым', 'Шілде', 'Тамыз', 'Қыркүйек', 'Қазан', 'Қараша', 'Желтоқсан'],\n    monthNamesShort: ['Қаң', 'Ақп', 'Нау', 'Сәу', 'Мам', 'Мау', 'Шіл', 'Там', 'Қыр', 'Қаз', 'Қар', 'Жел'],\n    dayNames: ['Жексенбі', 'Дүйсенбі', 'Сейсенбі', 'Сәрсенбі', 'Бейсенбі', 'Жұма', 'Сенбі'],\n    dayNamesShort: ['жкс', 'дсн', 'ссн', 'срс', 'бсн', 'жма', 'снб'],\n    dayNamesMin: ['Жк', 'Дс', 'Сс', 'Ср', 'Бс', 'Жм', 'Сн'],\n    weekHeader: 'Не',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['kk']);\n\n  /* Written by Chandara Om (chandara.teacher@gmail.com). */\n\n  $.datepicker.regional['km'] = {\n    closeText: 'ធ្វើ​រួច',\n    prevText: 'មុន',\n    nextText: 'បន្ទាប់',\n    currentText: 'ថ្ងៃ​នេះ',\n    monthNames: ['មករា', 'កុម្ភៈ', 'មីនា', 'មេសា', 'ឧសភា', 'មិថុនា', 'កក្កដា', 'សីហា', 'កញ្ញា', 'តុលា', 'វិច្ឆិកា', 'ធ្នូ'],\n    monthNamesShort: ['មករា', 'កុម្ភៈ', 'មីនា', 'មេសា', 'ឧសភា', 'មិថុនា', 'កក្កដា', 'សីហា', 'កញ្ញា', 'តុលា', 'វិច្ឆិកា', 'ធ្នូ'],\n    dayNames: ['អាទិត្យ', 'ចន្ទ', 'អង្គារ', 'ពុធ', 'ព្រហស្បតិ៍', 'សុក្រ', 'សៅរ៍'],\n    dayNamesShort: ['អា', 'ច', 'អ', 'ពុ', 'ព្រហ', 'សុ', 'សៅ'],\n    dayNamesMin: ['អា', 'ច', 'អ', 'ពុ', 'ព្រហ', 'សុ', 'សៅ'],\n    weekHeader: 'សប្ដាហ៍',\n    dateFormat: 'dd-mm-yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['km']);\n\n  /* Written by DaeKwon Kang (ncrash.dk@gmail.com), Edited by Genie. */\n\n  $.datepicker.regional['ko'] = {\n    closeText: '닫기',\n    prevText: '이전달',\n    nextText: '다음달',\n    currentText: '오늘',\n    monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],\n    monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],\n    dayNames: ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'],\n    dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],\n    dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],\n    weekHeader: 'Wk',\n    dateFormat: 'yy-mm-dd',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: '년'\n  }; //$.datepicker.setDefaults($.datepicker.regional['ko']);\n\n  /* Written by Michel Weimerskirch <michel@weimerskirch.net> */\n\n  $.datepicker.regional['lb'] = {\n    closeText: 'Fäerdeg',\n    prevText: 'Zréck',\n    nextText: 'Weider',\n    currentText: 'Haut',\n    monthNames: ['Januar', 'Februar', 'Mäerz', 'Abrëll', 'Mee', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mäe', 'Abr', 'Mee', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],\n    dayNames: ['Sonndeg', 'Méindeg', 'Dënschdeg', 'Mëttwoch', 'Donneschdeg', 'Freideg', 'Samschdeg'],\n    dayNamesShort: ['Son', 'Méi', 'Dën', 'Mët', 'Don', 'Fre', 'Sam'],\n    dayNamesMin: ['So', 'Mé', 'Dë', 'Më', 'Do', 'Fr', 'Sa'],\n    weekHeader: 'W',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['lb']);\n\n  /* @author Arturas Paleicikas <arturas@avalon.lt> */\n\n  $.datepicker.regional['lt'] = {\n    closeText: 'Uždaryti',\n    prevText: '&#x3C;Atgal',\n    nextText: 'Pirmyn&#x3E;',\n    currentText: 'Šiandien',\n    monthNames: ['Sausis', 'Vasaris', 'Kovas', 'Balandis', 'Gegužė', 'Birželis', 'Liepa', 'Rugpjūtis', 'Rugsėjis', 'Spalis', 'Lapkritis', 'Gruodis'],\n    monthNamesShort: ['Sau', 'Vas', 'Kov', 'Bal', 'Geg', 'Bir', 'Lie', 'Rugp', 'Rugs', 'Spa', 'Lap', 'Gru'],\n    dayNames: ['sekmadienis', 'pirmadienis', 'antradienis', 'trečiadienis', 'ketvirtadienis', 'penktadienis', 'šeštadienis'],\n    dayNamesShort: ['sek', 'pir', 'ant', 'tre', 'ket', 'pen', 'šeš'],\n    dayNamesMin: ['Se', 'Pr', 'An', 'Tr', 'Ke', 'Pe', 'Še'],\n    weekHeader: 'SAV',\n    dateFormat: 'yy-mm-dd',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['lt']);\n\n  /* @author Arturas Paleicikas <arturas.paleicikas@metasite.net> */\n\n  $.datepicker.regional['lv'] = {\n    closeText: 'Aizvērt',\n    prevText: 'Iepr.',\n    nextText: 'Nāk.',\n    currentText: 'Šodien',\n    monthNames: ['Janvāris', 'Februāris', 'Marts', 'Aprīlis', 'Maijs', 'Jūnijs', 'Jūlijs', 'Augusts', 'Septembris', 'Oktobris', 'Novembris', 'Decembris'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jūn', 'Jūl', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['svētdiena', 'pirmdiena', 'otrdiena', 'trešdiena', 'ceturtdiena', 'piektdiena', 'sestdiena'],\n    dayNamesShort: ['svt', 'prm', 'otr', 'tre', 'ctr', 'pkt', 'sst'],\n    dayNamesMin: ['Sv', 'Pr', 'Ot', 'Tr', 'Ct', 'Pk', 'Ss'],\n    weekHeader: 'Ned.',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['lv']);\n\n  /* Written by Stojce Slavkovski. */\n\n  $.datepicker.regional['mk'] = {\n    closeText: 'Затвори',\n    prevText: '&#x3C;',\n    nextText: '&#x3E;',\n    currentText: 'Денес',\n    monthNames: ['Јануари', 'Февруари', 'Март', 'Април', 'Мај', 'Јуни', 'Јули', 'Август', 'Септември', 'Октомври', 'Ноември', 'Декември'],\n    monthNamesShort: ['Јан', 'Фев', 'Мар', 'Апр', 'Мај', 'Јун', 'Јул', 'Авг', 'Сеп', 'Окт', 'Ное', 'Дек'],\n    dayNames: ['Недела', 'Понеделник', 'Вторник', 'Среда', 'Четврток', 'Петок', 'Сабота'],\n    dayNamesShort: ['Нед', 'Пон', 'Вто', 'Сре', 'Чет', 'Пет', 'Саб'],\n    dayNamesMin: ['Не', 'По', 'Вт', 'Ср', 'Че', 'Пе', 'Са'],\n    weekHeader: 'Сед',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['mk']);\n\n  /* Written by Saji Nediyanchath (saji89@gmail.com). */\n\n  $.datepicker.regional['ml'] = {\n    closeText: 'ശരി',\n    prevText: 'മുന്നത്തെ',\n    nextText: 'അടുത്തത് ',\n    currentText: 'ഇന്ന്',\n    monthNames: ['ജനുവരി', 'ഫെബ്രുവരി', 'മാര്‍ച്ച്', 'ഏപ്രില്‍', 'മേയ്', 'ജൂണ്‍', 'ജൂലൈ', 'ആഗസ്റ്റ്', 'സെപ്റ്റംബര്‍', 'ഒക്ടോബര്‍', 'നവംബര്‍', 'ഡിസംബര്‍'],\n    monthNamesShort: ['ജനു', 'ഫെബ്', 'മാര്‍', 'ഏപ്രി', 'മേയ്', 'ജൂണ്‍', 'ജൂലാ', 'ആഗ', 'സെപ്', 'ഒക്ടോ', 'നവം', 'ഡിസ'],\n    dayNames: ['ഞായര്‍', 'തിങ്കള്‍', 'ചൊവ്വ', 'ബുധന്‍', 'വ്യാഴം', 'വെള്ളി', 'ശനി'],\n    dayNamesShort: ['ഞായ', 'തിങ്ക', 'ചൊവ്വ', 'ബുധ', 'വ്യാഴം', 'വെള്ളി', 'ശനി'],\n    dayNamesMin: ['ഞാ', 'തി', 'ചൊ', 'ബു', 'വ്യാ', 'വെ', 'ശ'],\n    weekHeader: 'ആ',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ml']);\n\n  /* Written by Mohd Nawawi Mohamad Jamili (nawawi@ronggeng.net). */\n\n  $.datepicker.regional['ms'] = {\n    closeText: 'Tutup',\n    prevText: '&#x3C;Sebelum',\n    nextText: 'Selepas&#x3E;',\n    currentText: 'hari ini',\n    monthNames: ['Januari', 'Februari', 'Mac', 'April', 'Mei', 'Jun', 'Julai', 'Ogos', 'September', 'Oktober', 'November', 'Disember'],\n    monthNamesShort: ['Jan', 'Feb', 'Mac', 'Apr', 'Mei', 'Jun', 'Jul', 'Ogo', 'Sep', 'Okt', 'Nov', 'Dis'],\n    dayNames: ['Ahad', 'Isnin', 'Selasa', 'Rabu', 'Khamis', 'Jumaat', 'Sabtu'],\n    dayNamesShort: ['Aha', 'Isn', 'Sel', 'Rab', 'kha', 'Jum', 'Sab'],\n    dayNamesMin: ['Ah', 'Is', 'Se', 'Ra', 'Kh', 'Ju', 'Sa'],\n    weekHeader: 'Mg',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ms']);\n\n  /* David De Sloovere @DavidDeSloovere */\n\n  $.datepicker.regional['nl-BE'] = {\n    closeText: 'Sluiten',\n    prevText: '←',\n    nextText: '→',\n    currentText: 'Vandaag',\n    monthNames: ['januari', 'februari', 'maart', 'april', 'mei', 'juni', 'juli', 'augustus', 'september', 'oktober', 'november', 'december'],\n    monthNamesShort: ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'],\n    dayNames: ['zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'],\n    dayNamesShort: ['zon', 'maa', 'din', 'woe', 'don', 'vri', 'zat'],\n    dayNamesMin: ['zo', 'ma', 'di', 'wo', 'do', 'vr', 'za'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['nl-BE']);\n\n  /* Written by Mathias Bynens <http://mathiasbynens.be/> */\n\n  $.datepicker.regional.nl = {\n    closeText: 'Sluiten',\n    prevText: '←',\n    nextText: '→',\n    currentText: 'Vandaag',\n    monthNames: ['januari', 'februari', 'maart', 'april', 'mei', 'juni', 'juli', 'augustus', 'september', 'oktober', 'november', 'december'],\n    monthNamesShort: ['jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'],\n    dayNames: ['zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'],\n    dayNamesShort: ['zon', 'maa', 'din', 'woe', 'don', 'vri', 'zat'],\n    dayNamesMin: ['zo', 'ma', 'di', 'wo', 'do', 'vr', 'za'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd-mm-yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional.nl);\n\n  /* Written by Naimdjon Takhirov (naimdjon@gmail.com). */\n\n  $.datepicker.regional['no'] = {\n    closeText: 'Lukk',\n    prevText: '&#xAB;Forrige',\n    nextText: 'Neste&#xBB;',\n    currentText: 'I dag',\n    monthNames: ['januar', 'februar', 'mars', 'april', 'mai', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'desember'],\n    monthNamesShort: ['jan', 'feb', 'mar', 'apr', 'mai', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'des'],\n    dayNamesShort: ['søn', 'man', 'tir', 'ons', 'tor', 'fre', 'lør'],\n    dayNames: ['søndag', 'mandag', 'tirsdag', 'onsdag', 'torsdag', 'fredag', 'lørdag'],\n    dayNamesMin: ['sø', 'ma', 'ti', 'on', 'to', 'fr', 'lø'],\n    weekHeader: 'Uke',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['no']);\n\n  /* Written by Jacek Wysocki (jacek.wysocki@gmail.com). */\n\n  $.datepicker.regional['pl'] = {\n    closeText: 'Zamknij',\n    prevText: '&#x3C;Poprzedni',\n    nextText: 'Następny&#x3E;',\n    currentText: 'Dziś',\n    monthNames: ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'],\n    monthNamesShort: ['Sty', 'Lu', 'Mar', 'Kw', 'Maj', 'Cze', 'Lip', 'Sie', 'Wrz', 'Pa', 'Lis', 'Gru'],\n    dayNames: ['Niedziela', 'Poniedziałek', 'Wtorek', 'Środa', 'Czwartek', 'Piątek', 'Sobota'],\n    dayNamesShort: ['Nie', 'Pn', 'Wt', 'Śr', 'Czw', 'Pt', 'So'],\n    dayNamesMin: ['N', 'Pn', 'Wt', 'Śr', 'Cz', 'Pt', 'So'],\n    weekHeader: 'Tydz',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['pl']);\n\n  /* Written by Leonildo Costa Silva (leocsilva@gmail.com). */\n\n  $.datepicker.regional['pt-BR'] = {\n    closeText: 'Fechar',\n    prevText: '&#x3C;Anterior',\n    nextText: 'Próximo&#x3E;',\n    currentText: 'Hoje',\n    monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],\n    monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],\n    dayNames: ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'],\n    dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],\n    dayNamesMin: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],\n    weekHeader: 'Sm',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['pt-BR']);\n\n  $.datepicker.regional['pt'] = {\n    closeText: 'Fechar',\n    prevText: 'Anterior',\n    nextText: 'Seguinte',\n    currentText: 'Hoje',\n    monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],\n    monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],\n    dayNames: ['Domingo', 'Segunda-feira', 'Terça-feira', 'Quarta-feira', 'Quinta-feira', 'Sexta-feira', 'Sábado'],\n    dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],\n    dayNamesMin: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'],\n    weekHeader: 'Sem',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['pt']);\n\n  /* Written by Yvonne Gienal (yvonne.gienal@educa.ch). */\n\n  $.datepicker.regional['rm'] = {\n    closeText: 'Serrar',\n    prevText: '&#x3C;Suandant',\n    nextText: 'Precedent&#x3E;',\n    currentText: 'Actual',\n    monthNames: ['Schaner', 'Favrer', 'Mars', 'Avrigl', 'Matg', 'Zercladur', 'Fanadur', 'Avust', 'Settember', 'October', 'November', 'December'],\n    monthNamesShort: ['Scha', 'Fev', 'Mar', 'Avr', 'Matg', 'Zer', 'Fan', 'Avu', 'Sett', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Dumengia', 'Glindesdi', 'Mardi', 'Mesemna', 'Gievgia', 'Venderdi', 'Sonda'],\n    dayNamesShort: ['Dum', 'Gli', 'Mar', 'Mes', 'Gie', 'Ven', 'Som'],\n    dayNamesMin: ['Du', 'Gl', 'Ma', 'Me', 'Gi', 'Ve', 'So'],\n    weekHeader: 'emna',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['rm']);\n\n  $.datepicker.regional['ro'] = {\n    closeText: 'Închide',\n    prevText: '&#xAB; Luna precedentă',\n    nextText: 'Luna următoare &#xBB;',\n    currentText: 'Azi',\n    monthNames: ['Ianuarie', 'Februarie', 'Martie', 'Aprilie', 'Mai', 'Iunie', 'Iulie', 'August', 'Septembrie', 'Octombrie', 'Noiembrie', 'Decembrie'],\n    monthNamesShort: ['Ian', 'Feb', 'Mar', 'Apr', 'Mai', 'Iun', 'Iul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Duminică', 'Luni', 'Marţi', 'Miercuri', 'Joi', 'Vineri', 'Sâmbătă'],\n    dayNamesShort: ['Dum', 'Lun', 'Mar', 'Mie', 'Joi', 'Vin', 'Sâm'],\n    dayNamesMin: ['Du', 'Lu', 'Ma', 'Mi', 'Jo', 'Vi', 'Sâ'],\n    weekHeader: 'Săpt',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ro']);\n\n  /* Written by Andrew Stromnov (stromnov@gmail.com). */\n\n  $.datepicker.regional['ru'] = {\n    closeText: 'Закрыть',\n    prevText: '&#x3C;Пред',\n    nextText: 'След&#x3E;',\n    currentText: 'Сегодня',\n    monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\n    monthNamesShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],\n    dayNames: ['воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота'],\n    dayNamesShort: ['вск', 'пнд', 'втр', 'срд', 'чтв', 'птн', 'сбт'],\n    dayNamesMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],\n    weekHeader: 'Нед',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ru']);\n\n  /* Written by Vojtech Rinik (vojto@hmm.sk). */\n\n  $.datepicker.regional['sk'] = {\n    closeText: 'Zavrieť',\n    prevText: '&#x3C;Predchádzajúci',\n    nextText: 'Nasledujúci&#x3E;',\n    currentText: 'Dnes',\n    monthNames: ['január', 'február', 'marec', 'apríl', 'máj', 'jún', 'júl', 'august', 'september', 'október', 'november', 'december'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Máj', 'Jún', 'Júl', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['nedeľa', 'pondelok', 'utorok', 'streda', 'štvrtok', 'piatok', 'sobota'],\n    dayNamesShort: ['Ned', 'Pon', 'Uto', 'Str', 'Štv', 'Pia', 'Sob'],\n    dayNamesMin: ['Ne', 'Po', 'Ut', 'St', 'Št', 'Pia', 'So'],\n    weekHeader: 'Ty',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['sk']);\n\n  /* Written by Jaka Jancar (jaka@kubje.org). */\n\n  /* c = č, s = š z = ž C = Č S = Š Z = Ž */\n\n  $.datepicker.regional['sl'] = {\n    closeText: 'Zapri',\n    prevText: '&#x3C;Prejšnji',\n    nextText: 'Naslednji&#x3E;',\n    currentText: 'Trenutni',\n    monthNames: ['Januar', 'Februar', 'Marec', 'April', 'Maj', 'Junij', 'Julij', 'Avgust', 'September', 'Oktober', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Avg', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['Nedelja', 'Ponedeljek', 'Torek', 'Sreda', 'Četrtek', 'Petek', 'Sobota'],\n    dayNamesShort: ['Ned', 'Pon', 'Tor', 'Sre', 'Čet', 'Pet', 'Sob'],\n    dayNamesMin: ['Ne', 'Po', 'To', 'Sr', 'Če', 'Pe', 'So'],\n    weekHeader: 'Teden',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['sl']);\n\n  /* Written by Flakron Bytyqi (flakron@gmail.com). */\n\n  $.datepicker.regional['sq'] = {\n    closeText: 'mbylle',\n    prevText: '&#x3C;mbrapa',\n    nextText: 'Përpara&#x3E;',\n    currentText: 'sot',\n    monthNames: ['Janar', 'Shkurt', 'Mars', 'Prill', 'Maj', 'Qershor', 'Korrik', 'Gusht', 'Shtator', 'Tetor', 'Nëntor', 'Dhjetor'],\n    monthNamesShort: ['Jan', 'Shk', 'Mar', 'Pri', 'Maj', 'Qer', 'Kor', 'Gus', 'Sht', 'Tet', 'Nën', 'Dhj'],\n    dayNames: ['E Diel', 'E Hënë', 'E Martë', 'E Mërkurë', 'E Enjte', 'E Premte', 'E Shtune'],\n    dayNamesShort: ['Di', 'Hë', 'Ma', 'Më', 'En', 'Pr', 'Sh'],\n    dayNamesMin: ['Di', 'Hë', 'Ma', 'Më', 'En', 'Pr', 'Sh'],\n    weekHeader: 'Ja',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['sq']);\n\n  /* Written by Dejan Dimić. */\n\n  $.datepicker.regional['sr-SR'] = {\n    closeText: 'Zatvori',\n    prevText: '&#x3C;',\n    nextText: '&#x3E;',\n    currentText: 'Danas',\n    monthNames: ['Januar', 'Februar', 'Mart', 'April', 'Maj', 'Jun', 'Jul', 'Avgust', 'Septembar', 'Oktobar', 'Novembar', 'Decembar'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Avg', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNames: ['Nedelja', 'Ponedeljak', 'Utorak', 'Sreda', 'Četvrtak', 'Petak', 'Subota'],\n    dayNamesShort: ['Ned', 'Pon', 'Uto', 'Sre', 'Čet', 'Pet', 'Sub'],\n    dayNamesMin: ['Ne', 'Po', 'Ut', 'Sr', 'Če', 'Pe', 'Su'],\n    weekHeader: 'Sed',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['sr-SR']);\n\n  /* Written by Dejan Dimić. */\n\n  $.datepicker.regional['sr'] = {\n    closeText: 'Затвори',\n    prevText: '&#x3C;',\n    nextText: '&#x3E;',\n    currentText: 'Данас',\n    monthNames: ['Јануар', 'Фебруар', 'Март', 'Април', 'Мај', 'Јун', 'Јул', 'Август', 'Септембар', 'Октобар', 'Новембар', 'Децембар'],\n    monthNamesShort: ['Јан', 'Феб', 'Мар', 'Апр', 'Мај', 'Јун', 'Јул', 'Авг', 'Сеп', 'Окт', 'Нов', 'Дец'],\n    dayNames: ['Недеља', 'Понедељак', 'Уторак', 'Среда', 'Четвртак', 'Петак', 'Субота'],\n    dayNamesShort: ['Нед', 'Пон', 'Уто', 'Сре', 'Чет', 'Пет', 'Суб'],\n    dayNamesMin: ['Не', 'По', 'Ут', 'Ср', 'Че', 'Пе', 'Су'],\n    weekHeader: 'Сед',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['sr']);\n\n  /* Written by Anders Ekdahl ( anders@nomadiz.se). */\n\n  $.datepicker.regional['sv'] = {\n    closeText: 'Stäng',\n    prevText: '&#xAB;Förra',\n    nextText: 'Nästa&#xBB;',\n    currentText: 'Idag',\n    monthNames: ['Januari', 'Februari', 'Mars', 'April', 'Maj', 'Juni', 'Juli', 'Augusti', 'September', 'Oktober', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'Maj', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dec'],\n    dayNamesShort: ['Sön', 'Mån', 'Tis', 'Ons', 'Tor', 'Fre', 'Lör'],\n    dayNames: ['Söndag', 'Måndag', 'Tisdag', 'Onsdag', 'Torsdag', 'Fredag', 'Lördag'],\n    dayNamesMin: ['Sö', 'Må', 'Ti', 'On', 'To', 'Fr', 'Lö'],\n    weekHeader: 'Ve',\n    dateFormat: 'yy-mm-dd',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['sv']);\n\n  /* Written by S A Sureshkumar (saskumar@live.com). */\n\n  $.datepicker.regional['ta'] = {\n    closeText: 'மூடு',\n    prevText: 'முன்னையது',\n    nextText: 'அடுத்தது',\n    currentText: 'இன்று',\n    monthNames: ['தை', 'மாசி', 'பங்குனி', 'சித்திரை', 'வைகாசி', 'ஆனி', 'ஆடி', 'ஆவணி', 'புரட்டாசி', 'ஐப்பசி', 'கார்த்திகை', 'மார்கழி'],\n    monthNamesShort: ['தை', 'மாசி', 'பங்', 'சித்', 'வைகா', 'ஆனி', 'ஆடி', 'ஆவ', 'புர', 'ஐப்', 'கார்', 'மார்'],\n    dayNames: ['ஞாயிற்றுக்கிழமை', 'திங்கட்கிழமை', 'செவ்வாய்க்கிழமை', 'புதன்கிழமை', 'வியாழக்கிழமை', 'வெள்ளிக்கிழமை', 'சனிக்கிழமை'],\n    dayNamesShort: ['ஞாயிறு', 'திங்கள்', 'செவ்வாய்', 'புதன்', 'வியாழன்', 'வெள்ளி', 'சனி'],\n    dayNamesMin: ['ஞா', 'தி', 'செ', 'பு', 'வி', 'வெ', 'ச'],\n    weekHeader: 'Не',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ta']);\n\n  /* Written by pipo (pipo@sixhead.com). */\n\n  $.datepicker.regional['th'] = {\n    closeText: 'ปิด',\n    prevText: '&#xAB;&#xA0;ย้อน',\n    nextText: 'ถัดไป&#xA0;&#xBB;',\n    currentText: 'วันนี้',\n    monthNames: ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'],\n    monthNamesShort: ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'],\n    dayNames: ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'],\n    dayNamesShort: ['อา.', 'จ.', 'อ.', 'พ.', 'พฤ.', 'ศ.', 'ส.'],\n    dayNamesMin: ['อา.', 'จ.', 'อ.', 'พ.', 'พฤ.', 'ศ.', 'ส.'],\n    weekHeader: 'Wk',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['th']);\n\n  /* Written by Abdurahmon Saidov (saidovab@gmail.com). */\n\n  $.datepicker.regional['tj'] = {\n    closeText: 'Идома',\n    prevText: '&#x3c;Қафо',\n    nextText: 'Пеш&#x3e;',\n    currentText: 'Имрӯз',\n    monthNames: ['Январ', 'Феврал', 'Март', 'Апрел', 'Май', 'Июн', 'Июл', 'Август', 'Сентябр', 'Октябр', 'Ноябр', 'Декабр'],\n    monthNamesShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],\n    dayNames: ['якшанбе', 'душанбе', 'сешанбе', 'чоршанбе', 'панҷшанбе', 'ҷумъа', 'шанбе'],\n    dayNamesShort: ['якш', 'душ', 'сеш', 'чор', 'пан', 'ҷум', 'шан'],\n    dayNamesMin: ['Як', 'Дш', 'Сш', 'Чш', 'Пш', 'Ҷм', 'Шн'],\n    weekHeader: 'Хф',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['tj']);\n\n  /* Written by Izzet Emre Erkan (kara@karalamalar.net). */\n\n  $.datepicker.regional['tr'] = {\n    closeText: 'kapat',\n    prevText: '&#x3C;geri',\n    nextText: 'ileri&#x3e',\n    currentText: 'bugün',\n    monthNames: ['Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran', 'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'],\n    monthNamesShort: ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz', 'Tem', 'Ağu', 'Eyl', 'Eki', 'Kas', 'Ara'],\n    dayNames: ['Pazar', 'Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi'],\n    dayNamesShort: ['Pz', 'Pt', 'Sa', 'Ça', 'Pe', 'Cu', 'Ct'],\n    dayNamesMin: ['Pz', 'Pt', 'Sa', 'Ça', 'Pe', 'Cu', 'Ct'],\n    weekHeader: 'Hf',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['tr']);\n\n  /* Written by Maxim Drogobitskiy (maxdao@gmail.com). */\n\n  /* Corrected by Igor Milla (igor.fsp.milla@gmail.com). */\n\n  $.datepicker.regional['uk'] = {\n    closeText: 'Закрити',\n    prevText: '&#x3C;',\n    nextText: '&#x3E;',\n    currentText: 'Сьогодні',\n    monthNames: ['Січень', 'Лютий', 'Березень', 'Квітень', 'Травень', 'Червень', 'Липень', 'Серпень', 'Вересень', 'Жовтень', 'Листопад', 'Грудень'],\n    monthNamesShort: ['Січ', 'Лют', 'Бер', 'Кві', 'Тра', 'Чер', 'Лип', 'Сер', 'Вер', 'Жов', 'Лис', 'Гру'],\n    dayNames: ['неділя', 'понеділок', 'вівторок', 'середа', 'четвер', 'п’ятниця', 'субота'],\n    dayNamesShort: ['нед', 'пнд', 'вів', 'срд', 'чтв', 'птн', 'сбт'],\n    dayNamesMin: ['Нд', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],\n    weekHeader: 'Тиж',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['uk']);\n\n  /* Translated by Le Thanh Huy (lthanhhuy@cit.ctu.edu.vn). */\n\n  $.datepicker.regional['vi'] = {\n    closeText: 'Đóng',\n    prevText: '&#x3C;Trước',\n    nextText: 'Tiếp&#x3E;',\n    currentText: 'Hôm nay',\n    monthNames: ['Tháng Một', 'Tháng Hai', 'Tháng Ba', 'Tháng Tư', 'Tháng Năm', 'Tháng Sáu', 'Tháng Bảy', 'Tháng Tám', 'Tháng Chín', 'Tháng Mười', 'Tháng Mười Một', 'Tháng Mười Hai'],\n    monthNamesShort: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],\n    dayNames: ['Chủ Nhật', 'Thứ Hai', 'Thứ Ba', 'Thứ Tư', 'Thứ Năm', 'Thứ Sáu', 'Thứ Bảy'],\n    dayNamesShort: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],\n    dayNamesMin: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'],\n    weekHeader: 'Tu',\n    dateFormat: 'dd/mm/yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['vi']);\n\n  /* Written by Cloudream (cloudream@gmail.com). */\n\n  $.datepicker.regional['zh-CN'] = {\n    closeText: '关闭',\n    prevText: '&#x3C;上月',\n    nextText: '下月&#x3E;',\n    currentText: '今天',\n    monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\n    monthNamesShort: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\n    dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],\n    dayNamesShort: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],\n    dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],\n    weekHeader: '周',\n    dateFormat: 'yy-mm-dd',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: '年'\n  }; //$.datepicker.setDefaults($.datepicker.regional['zh-CN']);\n\n  /* Written by SCCY (samuelcychan@gmail.com). */\n\n  $.datepicker.regional['zh-HK'] = {\n    closeText: '關閉',\n    prevText: '&#x3C;上月',\n    nextText: '下月&#x3E;',\n    currentText: '今天',\n    monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\n    monthNamesShort: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\n    dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],\n    dayNamesShort: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],\n    dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],\n    weekHeader: '周',\n    dateFormat: 'dd-mm-yy',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: '年'\n  }; //$.datepicker.setDefaults($.datepicker.regional['zh-HK']);\n\n  /* Written by Ressol (ressol@gmail.com). */\n\n  $.datepicker.regional['zh-TW'] = {\n    closeText: '關閉',\n    prevText: '&#x3C;上月',\n    nextText: '下月&#x3E;',\n    currentText: '今天',\n    monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\n    monthNamesShort: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],\n    dayNames: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],\n    dayNamesShort: ['周日', '周一', '周二', '周三', '周四', '周五', '周六'],\n    dayNamesMin: ['日', '一', '二', '三', '四', '五', '六'],\n    weekHeader: '周',\n    dateFormat: 'yy/mm/dd',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: true,\n    yearSuffix: '年'\n  }; //$.datepicker.setDefaults($.datepicker.regional['zh-TW']);\n\n  /* Written by Pavel Selitskas <p.selitskas@gmail.com> */\n\n  $.datepicker.regional['be'] = {\n    closeText: 'Зачыніць',\n    prevText: '&larr;Папяр.',\n    nextText: 'Наст.&rarr;',\n    currentText: 'Сёньня',\n    monthNames: ['Студзень', 'Люты', 'Сакавік', 'Красавік', 'Травень', 'Чэрвень', 'Ліпень', 'Жнівень', 'Верасень', 'Кастрычнік', 'Лістапад', 'Сьнежань'],\n    monthNamesShort: ['Сту', 'Лют', 'Сак', 'Кра', 'Тра', 'Чэр', 'Ліп', 'Жні', 'Вер', 'Кас', 'Ліс', 'Сьн'],\n    dayNames: ['нядзеля', 'панядзелак', 'аўторак', 'серада', 'чацьвер', 'пятніца', 'субота'],\n    dayNamesShort: ['ндз', 'пнд', 'аўт', 'срд', 'чцв', 'птн', 'сбт'],\n    dayNamesMin: ['Нд', 'Пн', 'Аў', 'Ср', 'Чц', 'Пт', 'Сб'],\n    weekHeader: 'Тд',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['be']);\n\n  $.datepicker.regional['fr-CA'] = {\n    closeText: 'Fermer',\n    prevText: 'Précédent',\n    nextText: 'Suivant',\n    currentText: 'Aujourd\\'hui',\n    monthNames: ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'],\n    monthNamesShort: ['janv.', 'févr.', 'mars', 'avril', 'mai', 'juin', 'juil.', 'août', 'sept.', 'oct.', 'nov.', 'déc.'],\n    dayNames: ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'],\n    dayNamesShort: ['dim.', 'lun.', 'mar.', 'mer.', 'jeu.', 'ven.', 'sam.'],\n    dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],\n    weekHeader: 'Sem.',\n    dateFormat: 'yy-mm-dd',\n    firstDay: 0,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['fr-CA']);\n\n  /* Written by Sergey Kartashov (ebishkek@yandex.ru). */\n\n  $.datepicker.regional['ky'] = {\n    closeText: 'Жабуу',\n    prevText: '&#x3c;Мур',\n    nextText: 'Кий&#x3e;',\n    currentText: 'Бүгүн',\n    monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],\n    monthNamesShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],\n    dayNames: ['жекшемби', 'дүйшөмбү', 'шейшемби', 'шаршемби', 'бейшемби', 'жума', 'ишемби'],\n    dayNamesShort: ['жек', 'дүй', 'шей', 'шар', 'бей', 'жум', 'ише'],\n    dayNamesMin: ['Жк', 'Дш', 'Шш', 'Шр', 'Бш', 'Жм', 'Иш'],\n    weekHeader: 'Жум',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['ky']);\n\n  /* Written by Bjørn Johansen (post@bjornjohansen.no). */\n\n  $.datepicker.regional['nb'] = {\n    closeText: 'Lukk',\n    prevText: '&#xAB;Forrige',\n    nextText: 'Neste&#xBB;',\n    currentText: 'I dag',\n    monthNames: ['januar', 'februar', 'mars', 'april', 'mai', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'desember'],\n    monthNamesShort: ['jan', 'feb', 'mar', 'apr', 'mai', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'des'],\n    dayNamesShort: ['søn', 'man', 'tir', 'ons', 'tor', 'fre', 'lør'],\n    dayNames: ['søndag', 'mandag', 'tirsdag', 'onsdag', 'torsdag', 'fredag', 'lørdag'],\n    dayNamesMin: ['sø', 'ma', 'ti', 'on', 'to', 'fr', 'lø'],\n    weekHeader: 'Uke',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['nb']);\n\n  /* Written by Bjørn Johansen (post@bjornjohansen.no). */\n\n  $.datepicker.regional['nn'] = {\n    closeText: 'Lukk',\n    prevText: '&#xAB;Førre',\n    nextText: 'Neste&#xBB;',\n    currentText: 'I dag',\n    monthNames: ['januar', 'februar', 'mars', 'april', 'mai', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'desember'],\n    monthNamesShort: ['jan', 'feb', 'mar', 'apr', 'mai', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'des'],\n    dayNamesShort: ['sun', 'mån', 'tys', 'ons', 'tor', 'fre', 'lau'],\n    dayNames: ['sundag', 'måndag', 'tysdag', 'onsdag', 'torsdag', 'fredag', 'laurdag'],\n    dayNamesMin: ['su', 'må', 'ty', 'on', 'to', 'fr', 'la'],\n    weekHeader: 'Veke',\n    dateFormat: 'dd.mm.yy',\n    firstDay: 1,\n    isRTL: false,\n    showMonthAfterYear: false,\n    yearSuffix: ''\n  }; //$.datepicker.setDefaults($.datepicker.regional['nn']);\n})(jQuery);"},"./node_modules/raw-loader/index.js!./node_modules/babel-loader/lib/index.js?!./node_modules/ifdef-loader/ifdef-loader.js?!./src/lib/jqueryui/jquery.ui.touch-punch.min.js":function(e,t){e.exports='/*\n * jQuery UI Touch Punch 0.2.2\n *\n * Copyright 2011, Dave Furfero\n * Dual licensed under the MIT or GPL Version 2 licenses.\n *\n * Depends:\n *  jquery.ui.widget.js\n *  jquery.ui.mouse.js\n */\n(function (b) {\n  b.support.touch = "ontouchend" in document;\n\n  if (!b.support.touch) {\n    return;\n  }\n\n  var c = b.ui.mouse.prototype,\n      e = c._mouseInit,\n      a;\n\n  function d(g, h) {\n    if (g.originalEvent.touches.length > 1) {\n      return;\n    }\n\n    g.preventDefault();\n    var i = g.originalEvent.changedTouches[0],\n        f = document.createEvent("MouseEvents");\n    f.initMouseEvent(h, true, true, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, false, false, false, false, 0, null);\n    g.target.dispatchEvent(f);\n  }\n\n  c._touchStart = function (g) {\n    var f = this;\n\n    if (a || !f._mouseCapture(g.originalEvent.changedTouches[0])) {\n      return;\n    }\n\n    a = true;\n    f._touchMoved = false;\n    d(g, "mouseover");\n    d(g, "mousemove");\n    d(g, "mousedown");\n  };\n\n  c._touchMove = function (f) {\n    if (!a) {\n      return;\n    }\n\n    this._touchMoved = true;\n    d(f, "mousemove");\n  };\n\n  c._touchEnd = function (f) {\n    if (!a) {\n      return;\n    }\n\n    d(f, "mouseup");\n    d(f, "mouseout");\n\n    if (!this._touchMoved) {\n      d(f, "click");\n    }\n\n    a = false;\n  };\n\n  c._mouseInit = function () {\n    var f = this;\n    f.element.bind("touchstart", b.proxy(f, "_touchStart")).bind("touchmove", b.proxy(f, "_touchMove")).bind("touchend", b.proxy(f, "_touchEnd"));\n    e.call(f);\n  };\n})(jQuery);'},"./node_modules/raw-loader/index.js!./node_modules/babel-loader/lib/index.js?!./node_modules/ifdef-loader/ifdef-loader.js?!./src/lib/setprototypeof/setprototypeof.js":function(e,t){e.exports="if (!Object.setPrototypeOf) {\n  var _call = Function.call.bind(Function.call);\n\n  var setPrototypeOf = function (Object, magic) {\n    var set;\n\n    var setPrototypeOf = function (O, proto) {\n      _call(set, O, proto);\n\n      return O;\n    };\n\n    try {\n      // this works already in Firefox and Safari\n      set = Object.getOwnPropertyDescriptor(Object.prototype, magic).set;\n\n      _call(set, {}, null);\n    } catch (e) {\n      if (Object.prototype !== {}[magic]) {\n        // IE < 11 cannot be shimmed\n        return;\n      } // probably Chrome or some old Mobile stock browser\n\n\n      set = function (proto) {\n        this[magic] = proto;\n      }; // please note that this will **not** work\n      // in those browsers that do not inherit\n      // __proto__ by mistake from Object.prototype\n      // in these cases we should probably throw an error\n      // or at least be informed about the issue\n\n\n      setPrototypeOf.polyfill = setPrototypeOf(setPrototypeOf({}, null), Object.prototype) instanceof Object; // setPrototypeOf.polyfill === true means it works as meant\n      // setPrototypeOf.polyfill === false means it's not 100% reliable\n      // setPrototypeOf.polyfill === undefined\n      // or\n      // setPrototypeOf.polyfill ==  null means it's not a polyfill\n      // which means it works as expected\n      // we can even delete Object.prototype.__proto__;\n    }\n\n    return setPrototypeOf;\n  }(Object, '__proto__');\n\n  Object.defineProperty(Object, 'setPrototypeOf', {\n    configurable: true,\n    enumerable: false,\n    writable: true,\n    value: setPrototypeOf\n  });\n}"},"./node_modules/script-loader/index.js!./src/lib/jqueryui/jquery-ui-i18n.js":function(e,t,i){i("./node_modules/script-loader/addScript.js")(i("./node_modules/raw-loader/index.js!./node_modules/babel-loader/lib/index.js?!./node_modules/ifdef-loader/ifdef-loader.js?!./src/lib/jqueryui/jquery-ui-i18n.js"))},"./node_modules/script-loader/index.js!./src/lib/jqueryui/jquery.ui.touch-punch.min.js":function(e,t,i){i("./node_modules/script-loader/addScript.js")(i("./node_modules/raw-loader/index.js!./node_modules/babel-loader/lib/index.js?!./node_modules/ifdef-loader/ifdef-loader.js?!./src/lib/jqueryui/jquery.ui.touch-punch.min.js"))},"./node_modules/script-loader/index.js!./src/lib/setprototypeof/setprototypeof.js":function(e,t,i){i("./node_modules/script-loader/addScript.js")(i("./node_modules/raw-loader/index.js!./node_modules/babel-loader/lib/index.js?!./node_modules/ifdef-loader/ifdef-loader.js?!./src/lib/setprototypeof/setprototypeof.js"))},"./src/assets/allIcons/icons-facelift.css":function(e,t,i){},"./src/css/database-icons.css":function(e,t,i){},"./src/init.js":function(e,t,o){"use strict";o.r(t);var n=o("./node_modules/react-dom/index.js"),a=o.n(n),s=o("./node_modules/react/index.js"),r=o.n(s),l=o("./src/react/util/Track.ts"),c=o("./src/js/ui/ui-util.js");const d=/^nx_(mac|ipad|iphone)_(1m|1y)_([0-9]+)$/;function h(e){var t,i=(e=e||{}).users||[],o={};for(t=0;t<i.length;t++){var n=p(i[t]);n&&(o[n.id]=n)}var a=e.teams||[],s={};for(t=0;t<a.length;t++){var r=u(a[t],o);r&&(s[r.id]=r)}this.token=e.token&&e.token.token?"USER-"+e.token.token:void 0,this.user=p(e.user)||{id:"#NO-USER-ID#",name:"Anonymous",displayName:"Anonymous",email:"user@example.com"},this.accounts=s,this.users=o}function p(e){if(e&&e.id)return{id:e.id,plan:e.plan,name:e.profile&&e.profile.displayName||e.email||"Anonymous",displayName:e.profile&&e.profile.displayName||e.email||"Anonymous",firstName:e.profile&&e.profile.firstName||e.firstName,lastName:e.profile&&e.profile.lastName||e.lastName,email:e.email||"user@example.com",verified:!!e.verified,isRoot:!!e.isRoot,language:e.profile&&e.profile.language||"en",accounts:{},photo:e.profile&&e.profile.photo||void 0,active:!1!==e.active,experimentT:e.experimentT,passwordExpired:e.passwordExpired,journey:e.journey||{},createdAt:e.createdAt}}function u(e,t){if(e&&e.id&&!e.stoppedAt){var i={id:e.id,name:e.name||locale.unnamed,owner:e.owner,invitations:{},host:e.host,roles:{}};f(i.roles,["admin","editor"]),f(i.roles,e.roles);for(var o=e.users||[],n={},a=0;a<o.length;a++){var s=o[a],r=t[s.user];if(r){var l={id:r.id,name:r.name,email:r.email,firstName:r.firstName,lastName:r.lastName,verified:r.verified,language:r.language,roles:g(s.role),photo:r.photo,active:r.active};r.accounts[i.id]=i,n[r.id]=l,f(i.roles,s.roles||s.role?v(s.role):[])}}i.users=n;var c=e.invitations;if(c)for(var d=0;d<c.length;d++){var h=c[d],p={email:h.recipient,roles:g(h.role),createdAt:new Date(h.createdAt),user:t[h.sender],inviteCode:h.id};i.invitations[p.inviteCode]=p,h.role&&f(i.roles,v(h.role))}return i}}function f(e,t){if(t)for(var i=0;i<t.length;i++){var o=t[i];"string"==typeof o&&o.length&&(e[o]||(e[o]={id:o,caption:m(o)}))}}function m(e){return e}function g(e){if(!e)return{};var t={};"string"==typeof e&&(e=v(e));for(var i=0;i<e.length;i++)t[e[i]]=!0;return t}function v(e){if(!e)return[];for(var t=e.split(","),i=[],o=0;o<t.length;o++){var n=t[o].trim();n&&i.push(n)}return i}function y(e){var t=this;e=e||{},this.config=e,this.isVisible=!1,this.$backplane=$.backplane({close:!!e.dismiss&&$.proxy(this.dismiss,this)}),this.$page=$('<div class="popup">').appendTo(this.$backplane),this.$viewport=$('<div class="popup-viewport">').appendTo(this.$page),this.$pane=$('<div class="popup-pane">').appendTo(this.$viewport),this.$error=null,this.$buttons=[];var i=e.caption;i&&(this.$viewport.css("top","48px"),this.$head=$('<div class="popup-head">').text(i).appendTo(this.$page));var o=e.message;o&&this.$pane.append($("<p>").text(o));var n=e.buttons||[];if(e.dismiss&&n.unshift({caption:locale.cancel,click:$.proxy(this.dismiss,this)}),e.okay&&n.push({caption:"OK",cls:"blue",click:$.proxy(this.okay,this)}),n.length>0){this.$foot=$('<div class="popup-foot popup-foot-'+n.length+'buttons">').appendTo(this.$page),this.$viewport.css("bttom","48px");for(var a=0;a<n.length;a++)!function(e){var i=n[e],o=$('<div class="popup-foot-button popup-foot-button'+e+'">').addClass(i.cls).text(i.caption).appendTo(t.$foot).click((function(){i.click&&(!1!==i.click.apply(t,arguments)&&t.destroy())}));t.$buttons[e]=o}(a)}e.init&&e.init.call(this),this.resize=$.proxy(this.resize,this),this.resize(),$(window).on("resize",this.resize)}h.prototype.getCurrentUser=function(){return this.user},h.prototype.getCurrentAccountUser=function(e){var t=this.accounts[e];if(t){var i=this.user;if(i)return t.users[i.id]}},h.prototype.isAdmin=function(e){var t=this.getCurrentAccountUser(e);return!(!t||!t.roles.admin)},h.prototype.getUser=function(e){return this.users[e]},h.prototype.getUsers=function(){return this.users},h.prototype.getRoles=function(e){var t=this.accounts[e];return t?t.roles:{}},h.prototype.addRole=function(e,t){var i=this.accounts[e];i&&(i.roles[t.id]=t)},h.prototype.getAccountUser=function(e,t){var i=this.accounts[e];if(i)return i.users[t]},h.prototype.getAccount=function(e){return this.accounts[e]},h.prototype.getAccounts=function(){return this.accounts},h.prototype.listAccounts=function(){return util.localeSortBy(this.accounts,"name")},h.prototype.listAccountUsers=function(e){var t=this.accounts[e];return t?util.localeSortBy(t.users,"name"):[]},h.prototype.listInvitations=function(e){var t=this.accounts[e];return t?util.localeSortBy(t.invitations,"email"):[]},h.prototype.getInvitation=function(e,t){var i=this.accounts[e];if(i)return i.invitations[t]},h.prototype.canCreateTestAccount=function(){return!0},h.prototype.canRemoveAccount=function(e){var t=this.accounts[e];return!!t&&t.owner===this.user.id},h.prototype.canInvite=function(e){var t=this.getCurrentAccountUser(e);return!!t&&(!!t.roles.admin&&!!t.verified)},h.prototype.hasOtherAdmins=function(e,t){var i=this.accounts[e];if(!i)return!1;var o=i.users;if(!o[t])return!1;var n=0;for(var a in o){if(o.hasOwnProperty(a))if(a!=t)o[a].roles.admin&&n++}return n>0},h.prototype.getPlan=function(){var e=this.accounts,t=0,i=0,o=0,n=0,a={};for(var s in e)if(e.hasOwnProperty(s)){var r=e[s];if(r.owner===this.user.id){var l=r.users;for(var c in n++,l)if(l.hasOwnProperty(c)){var h=this.users[c];h&&!a[c]&&(a[c]=h,o++,h.plan&&"basic"===h.plan.name?t++:i++)}}}var p,u,f,m=this.user.plan||{},g=m.name||"none",v=m.provider||"none";if("apple"===v){var y=d.exec(m.product);y&&(p=y[1],u=y[2],f=parseInt(y[3]))}return{name:g,provider:v,collaborators:m.collaborators,product:m.product,productDevice:p,productPeriod:u,productCount:f,expiresAt:m.expiresAt&&new Date(m.expiresAt),ownAccountsCount:n,totalUserCount:o,accountableUserCount:i,freeUserCount:t,uniqueUsers:a}},h.prototype.hasPlan=function(e){var t=this.accounts[e];if(!t)return!1;var i=this.users[t.owner];return i&&i.plan&&"none"!==i.plan.name||!1},h.prototype.getOwner=function(e){var t=this.accounts[e];if(!t)return{email:"unknown"};var i=this.users[t.owner];return i||{email:"unknown"}},y.prototype.destroy=function(){$(window).off("resize",this.resize),this.$backplane.close()},y.prototype.dismiss=function(){this.destroy(),"function"==typeof this.config.dismiss&&this.config.dismiss()},y.prototype.okay=function(){this.destroy(),"function"==typeof this.config.okay&&this.config.okay()},y.prototype.resize=function(){var e=this.$pane.height()+(this.$foot?this.$foot.height():0)+(this.$head?this.$head.height():0),t=Math.max(0,window.innerHeight-e);this.$page.css({top:Math.round(t/3),height:e})},y.prototype.error=function(e){e?(this.$error||(this.$error=$('<div class="error-pane">').prependTo(this.$pane)),this.$error.text(String(e)),this.resize()):this.$error&&(this.$error.remove(),this.$error=null)};var b=o("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js");function w(e){return new Promise((t,i)=>{const o=window.open(e,"windowname1","width=800, height=600"),n=setInterval(()=>{if(!o)return console.warn("no window");try{if(o.closed)return clearInterval(n),t(null);if(-1!==o.document.URL.indexOf("userId")){clearInterval(n);const e=o.document.URL.split(/[?&]/).slice(1);if(e.length){const i=e.map(e=>e.split("=")).reduce((e,t)=>(e[t[0]]=decodeURIComponent(t[1]),e),{});t(i)}else i(new Error("Impossible case: no parameters in redirect"));o.close()}}catch(e){}},100)})}const x={dev:"http://localhost:7000",qs:"https://q-ums.ninox.com",prod:"https://ums.ninox.com",server:"/ums"};function T(){this.requestQueue=[],this.reloginCallbacks=[],this.reloginActive=!1;var e=NinoxDocumentInteraction.getUserDefault("nx.server");if(this.baseURL=e?"https://"+e+"/ums":x.prod,!this.baseURL)throw new Error("Invalid configuration: prod");this.apiURL=this.baseURL+"/api",this.signupURL=this.apiURL+"/self/user",this.loginURL=this.apiURL+"/credentials/signin",this.logoutURL=this.apiURL+"/credentials/signout",this.refreshURL=this.apiURL+"/self/session/current",this.createAccountURL=this.apiURL+"/self/team",this.forgotPasswordURL=this.apiURL+"/credentials/requestResetPassword",this.resendVerificationMailURL=this.apiURL+"/user/requestEmailVerification",this.sessionKey="nx.session";var t,i=NinoxDocumentInteraction.getUserDefault(this.sessionKey)||"";if(i)try{t=JSON.parse(i)}catch(e){console.warn("Invalid session object",e)}this.session=t,this.sessionInfo=new h(t),this.session&&location.hash.startsWith("/verification/callback?email=")&&this.sessionInfo.user.email!==window.location.hash.substr(29)&&this.logout(),this.device="app-mac:"+navigator.userAgent,this.isLoggedIn()&&l.c(this.sessionInfo.user)}Object.assign(T.prototype,b.util.events),T.prototype.isLoggedIn=function(){return!!this.session},T.prototype.getToken=function(){return this.sessionInfo?this.sessionInfo.token:void 0},T.prototype.ensureToken=function(e){var t=this;if(t.sessionInfo&&t.sessionInfo.token)return e(void 0,t.sessionInfo.token);t.login((function(i){return i?e(i):t.sessionInfo&&t.sessionInfo.token?e(void 0,t.sessionInfo.token):void e("Login failed.")}))},T.prototype.signup=function(e,t){var i=this,o=this.signupURL,n=JSON.stringify({email:e.email,password:e.password,newsletter:e.newsletter,device:this.device,uuid:cloudFileSystem.clientId(),nxVersion:NINOX_VERSION,language:locale.LOCALE,iadAttributionDetails:e.iadAttributionDetails});$.ajax({type:"POST",url:o,data:n,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{},success:function(e,o,n){var a;i.saveSession(e),l.a(i.sessionInfo.user),t(null,a)},error:function(e,i,o){console.warn(i,o),t(locale.emailAlreadyRegistered)}})},T.prototype.login=function(e,t,i){var o=this,n=this.loginURL,a=JSON.stringify({email:e,password:t,device:this.device,uuid:cloudFileSystem.clientId(),nxVersion:NINOX_VERSION,language:locale.LOCALE});$.ajax({type:"POST",url:n,data:a,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{},success:function(e,t,n){o.saveSession(e),l.c(o.sessionInfo.user),i()},error:function(e,t,o){console.warn(t,o),i(e.responseText)}})},T.prototype.refresh=function(e,t){var i=this,o=this.refreshURL;if(this.session)if(this.reloginActive)e&&e();else{var n={};i.sessionInfo&&i.sessionInfo.token&&(n.authorization="Bearer "+i.sessionInfo.token),$.ajax({type:"GET",url:o,processData:!1,xhrFields:{withCredentials:!0},headers:n,success:function(t,o,n){i.saveSession(t),l.c(i.sessionInfo.user),e&&e()},error:function(o,n,a){console.warn("Cannot get session info.",n,a),o.status>=400&&o.status<500&&!t?i.relogin(e):e&&e()}})}else e&&e()},T.prototype.logout=function(e){var t=this,i=this.logoutURL;if(!this.session)return e();var o=t.sessionInfo.token;this.clearSession(),$.ajax({type:"POST",url:i,data:{device:this.device},processData:!1,xhrFields:{withCredentials:!0},headers:{authorization:"Bearer "+o},success:function(t,i,o){e()},error:function(t,i,o){console.warn(i,o),e()}})},T.prototype.forgotPassword=function(e,t){var i=this.forgotPasswordURL,o=JSON.stringify({email:e.email,device:this.device,uuid:cloudFileSystem.clientId(),nxVersion:NINOX_VERSION,language:locale.LOCALE});$.ajax({type:"POST",url:i,data:o,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{},success:function(e,i,o){t()},error:function(e,i,o){console.warn(i,o),t(locale.emailNotRegistered)}})},T.prototype.changePassword=function(e,t){var i=this;if(!this.session)return t("Not logged in.");var o=this.apiURL+"/self/user/password",n=JSON.stringify({oldPassword:e.oldPassword,newPassword:e.newPassword,device:this.device,uuid:cloudFileSystem.clientId(),nxVersion:NINOX_VERSION,language:locale.LOCALE});$.loading(!0),$.ajax({type:"PUT",url:o,data:n,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{authorization:"Bearer "+i.sessionInfo.token},success:function(e,i,o){$.loading(!1),t(null,o.responseText)},error:function(e,i,o){$.loading(!1),t(e.responseText)}})},T.prototype.changeExpiredPassword=function(e,t){var i=this.apiURL+"/self/user/expired-password",o=JSON.stringify({oldPassword:e.oldPassword,newPassword:e.newPassword,id:e.userId,device:this.device,uuid:cloudFileSystem.clientId,nxVersion:NINOX_VERSION,language:locale.LOCALE});$.loading(!0),$.ajax({type:"PUT",url:i,data:o,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},success:function(e,i,o){$.loading(!1),t(null,o.responseText)},error:function(e,i,o){$.loading(!1),t(e.responseText)}})},T.prototype.resendVerificationMail=function(e,t){var i=this,o=this.resendVerificationMailURL;if(!this.session)return t("Not logged in.");var n=this.getCurrentUser().email,a=JSON.stringify({email:n,device:this.device,uuid:cloudFileSystem.clientId(),nxVersion:NINOX_VERSION,language:locale.LOCALE});$.ajax({type:"POST",url:o,data:a,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{authorization:"Bearer "+i.sessionInfo.token},success:function(e,i,o){t()},error:function(e,i,o){console.warn("verification error -> ",i,o),t(locale.wrongUserPassword)}})},T.prototype.createAccount=function(e,t){var i=this;i.request("POST",this.createAccountURL,{name:e.name,device:this.device},(function(e,o){if(e)return t(e);i.refresh((function(e){t(e,o&&o.id)}))}))},T.prototype.sendReceipt=function(e,t){var i=this;i.request("POST",this.apiURL+"/self/payment/apple",{receipt:e,device:this.device},(function(e,o){if(e)return t(e);i.refresh(t)}))},T.prototype.checkReceipt=function(e,t){this.request("POST",this.apiURL+"/self/payment/checkReceipt",{receipt:e,device:this.device},(function(e,i){if(e)return t(e);t(void 0,i)}))},T.prototype.invite=function(e,t){var i=this,o=e.email,n=e.accountId,a=e.roles&&e.roles.join(", ")||"editor";i.request("POST",this.apiURL+"/self/invitation",{recipient:o,role:a,teamId:n,device:this.device},(function(e){if(e)return t(e);i.refresh(t)}))},T.prototype.cancelInvitation=function(e,t,i){var o=this;o.request("DELETE",this.apiURL+"/self/invitation/"+encodeURIComponent(t),void 0,(function(e){if(e)return i(e);o.refresh(i)}))},T.prototype.resendInvitation=function(e,t,i){var o=this;o.request("PUT",this.apiURL+"/self/invitation/"+encodeURIComponent(t)+":resend",{},(function(e){if(e)return i(e);o.refresh(i)}))},T.prototype.removeAccountUser=function(e,t,i){var o=this;o.request("DELETE",this.apiURL+"/self/team/"+encodeURIComponent(e)+"/member/"+encodeURIComponent(t),void 0,(function(e){if(e)return i(e);o.refresh(i)}))},T.prototype.updateAccountUser=function(e,t,i){var o=this,n=t.roles&&t.roles.join(", ")||"editor";o.request("PUT",this.apiURL+"/self/team/"+encodeURIComponent(e)+"/member/"+encodeURIComponent(t.id),{role:n},(function(e){if(e)return i(e);o.refresh(i)}))},T.prototype.updateUserProfile=function(e,t){var i=this;if(!i.getCurrentUser())return t("Not logged in");i.request("PUT",this.apiURL+"/self/user",e,(function(e){if(e)return t(e);i.refresh(t)}))},T.prototype.updateUserJourney=function(e,t){var i=this;if(!i.getCurrentUser())return t("Not logged in");i.request("POST",this.apiURL+"/self/user/journey",e,(function(e){if(e)return t(e);i.refresh(t)}))},T.prototype.updateAccount=function(e,t){var i=this;if(!i.getCurrentUser())return t("Not logged in");i.request("PUT",this.apiURL+"/self/team/"+encodeURIComponent(e.id),{name:e.name},(function(e){if(e)return t(e);i.refresh(t)}))},T.prototype.changeEmail=function(e,t){const i=this;if(!this.session)return t("Not logged in.");const o=this.apiURL+"/self/user/email",n=JSON.stringify({email:e});$.loading(!0),$.ajax({type:"PUT",url:o,data:n,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{authorization:"Bearer "+i.sessionInfo.token},success:function(e,o,n){$.loading(!1),i.refresh(t)},error:function(e,i,o){$.loading(!1),t(e.responseText)}})},T.prototype.canRemoveAccount=function(e){return this.sessionInfo.canRemoveAccount(e)},T.prototype.removeAccount=function(e,t){var i=this;i.request("DELETE",this.apiURL+"/self/team/"+encodeURIComponent(e),void 0,(function(e){if(e)return t(e);i.refresh(t)}))},T.prototype.saveSession=function(e){b.util.equals(e,this.session)||(this.session=e,this.sessionInfo=new h(e),NinoxDocumentInteraction.setUserDefault(this.sessionKey,JSON.stringify(this.session)),this.trigger("change",e))},T.prototype.clearSession=function(){this.session&&(this.session=void 0,this.sessionInfo=new h({}),NinoxDocumentInteraction.setUserDefault(this.sessionKey,""),this.trigger("change",void 0))},T.prototype.getUserId=function(){if(this.session)return this.sessionInfo.user.id},T.prototype.getUserName=function(){return this.session?this.sessionInfo.user.name||"Anonymous":"Not Logged In"},T.prototype.getAccounts=function(){return this.sessionInfo.getAccounts()},T.prototype.listAccounts=function(){return this.sessionInfo.listAccounts()},T.prototype.getAccount=function(e){return this.sessionInfo.getAccount(e)},T.prototype.getAccountName=function(e){var t=this.sessionInfo.getAccount(e);return t&&t.name||locale.unknown},T.prototype.getFirstAccount=function(){var e=this.sessionInfo.listAccounts();return e.length?e[0]:void 0},T.prototype.getSessionInfo=function(){return this.sessionInfo},T.prototype.getUpgradeURL=function(e){return this.apiURL+"/self/payment:link"},T.prototype.listAccountUsers=function(e){return this.sessionInfo.listAccountUsers(e)},T.prototype.listInvitations=function(e){return this.sessionInfo.listInvitations(e)},T.prototype.getAccountUser=function(e,t){return this.sessionInfo.getAccountUser(e,t)},T.prototype.getCurrentUser=function(){return this.sessionInfo.getCurrentUser()},T.prototype.getCurrentAccountUser=function(e){return this.sessionInfo.getAccountUser(e,this.sessionInfo.getCurrentUser().id)},T.prototype.getInvitation=function(e,t){return this.sessionInfo.getInvitation(e,t)},T.prototype.isAdmin=function(e){return this.sessionInfo.isAdmin(e)},T.prototype.canCreateTestAccount=function(){return this.isLoggedIn()&&this.sessionInfo.canCreateTestAccount()},T.prototype.hasOtherAdmins=function(e,t){return this.isLoggedIn()&&this.sessionInfo.hasOtherAdmins(e,t)},T.prototype.canInvite=function(e){return this.isLoggedIn()&&this.sessionInfo.canInvite(e)},T.prototype.request=function(e,t,i,o){var n=this,a=n.sessionInfo?n.sessionInfo.token:void 0,s=a?"Bearer "+a:void 0,r={};s&&(r.authorization=s);var l=i?JSON.stringify(i):void 0,c=l?"application/json":void 0;$.ajax({type:e,url:t,contentType:c,data:l,headers:r,xhrFields:{withCredentials:!0},processData:!1,success:function(e,t,i){o(void 0,e)},error:function(a,s,r){console.warn(s,r),401===a.status?(n.requestQueue.push([e,t,i,o]),n.relogin()):o("Request error: "+e+" "+t+": "+s+"\n - "+r+":\n "+a.status+" "+a.statusText+"\n "+a.responseText)}})},T.prototype.reloginDialog=function(e){this.reloginDialog_MAC(e)},T.prototype.reloginDialog_IPHONE=function(e){const t=Object(c.g)(),i=e.login(t);function o(t){new y({caption:locale.login+" relogin",dismiss:!0,init:function(){l.f("Relogin","Open");var t=this,i=$("<div>").appendTo(t.$pane),o=t.$loginEmail=$('<input type="email" class="no-barcode">').attr("placeholder",Object(c.f)()?locale.emailOrUserName:locale.email).val(e.email||"");$('<div class="editor-block no-label">').append(o).appendTo(i);var n=t.$loginPassword=$('<input type="password" class="no-barcode">').attr("placeholder",locale.password);$('<div class="editor-block no-label">').append(n).appendTo(i)},buttons:[{caption:locale.login,cls:"blue",click:function(){l.f("Relogin","Click");var e=this,i=e.$loginEmail.val(),o=e.$loginPassword.val();return i?o?(i=i.trim().toLocaleLowerCase(),Object(c.f)()||b.util.isValidEmail(i)?(e.dismiss(),$.loading(!0),void t(i,o,(function(e){$.loading(!1),l.f("Relogin",e?"Error":"Success"),e&&alert(e)}))):$.alert(locale.emailMissing)):$.alert("Password missing"):$.alert("Email missing")}}]})}function n(e){new y({caption:"Ninox Login",dismiss:!0,init:()=>{l.f("Relogin","Open")},buttons:[{caption:locale.ssoLogin,cls:"blue",click:e}]})}t?n(i):o(i)},T.prototype.reloginDialog_MAC=function(e){let t,i,o;function n(){t.close(),e.cancel()}function a(n=!1){const a=e.login(n);if(n)t.close(),a();else{var s=i.val(),r=o.val();if(!s)return $.alert("Email missing");if(!r)return $.alert("Password missing");if(s=s.trim().toLocaleLowerCase(),!b.util.isValidEmail(s))return $.alert(locale.emailMissing);t.close(),$.loading(!0),a(s,r,(function(e){$.loading(!1),e&&alert(e)}))}}Object(c.g)()?t=$.popdown({cls:"small relogin-popup",head:"Log in",closable:!1,buttons:[{caption:locale.cancel,click:n},"-",{caption:locale.ssoLogin||"SSO Login",cls:"blue",click:()=>a(!0)}]}):(t=$.popdown({cls:"small relogin-popup",head:"Log in",closable:!1,buttons:[{caption:locale.cancel,click:n},"-",{caption:locale.login,cls:"blue",click:()=>a(!1)}]}),i=$.input({caption:Object(c.f)()?locale.emailOrUserName:locale.email,type:"email",$container:t.$content,focus:!e.email,val:e.email,enter:function(){o.focus()}}),o=$.input({caption:"Password",type:"password",$container:t.$content,focus:!!e.email,enter:function(){a(!1)}}))},T.prototype.relogin=function(e){var t=this;if(e&&this.reloginCallbacks.push(e),!t.reloginActive){t.reloginActive=!0;var i=t.sessionInfo&&t.sessionInfo.getCurrentUser(),o=i&&i.email||"";t.reloginDialog({email:o,login:(e=!1)=>e?a:s,cancel:n})}function n(){t.clearSession(),t.cancelRequests();var e=t.reloginCallbacks;t.reloginCallbacks=[],setTimeout((function(){for(var t=0;t<e.length;t++)e[t](!1)}),0)}function a(){dbms.getRemoteConnection().samlLogin()}function s(e,i,o){var n=t.loginURL,a=JSON.stringify({email:e,password:i,device:t.device,uuid:cloudFileSystem.clientId(),nxVersion:NINOX_VERSION,language:locale.LOCALE});$.ajax({type:"POST",url:n,data:a,contentType:"application/json",processData:!1,xhrFields:{withCredentials:!0},headers:{},success:function(e,i,n){o(),t.saveSession(e),t.reloginActive=!1;var a=t.reloginCallbacks;t.reloginCallbacks=[],setTimeout((function(){for(var e=0;e<a.length;e++)a[e](!0);t.rerequest()}),0)},error:function(e,i,n){console.warn(i,n),o(locale.wrongUserPassword),t.reloginActive=!1,setTimeout((function(){t.relogin()}),0)}})}},T.prototype.rerequest=function(){var e=this.requestQueue;this.requestQueue=[];for(var t=0;t<e.length;t++){var i=e[t];this.request.apply(this,i)}},T.prototype.cancelRequests=function(){var e=this.requestQueue;this.requestQueue=[];for(var t=0;t<e.length;t++){(0,e[t][3])("Logged out")}},T.prototype.uploadProfileImage=function(e,t){var i=this,o=this.apiURL+"/self/user/photo",n=i.sessionInfo?i.sessionInfo.token:void 0,a=n?"Bearer "+n:void 0,s={};a&&(s.authorization=a);var r=new FormData;r.append("file",e.file);var l=$.progress({caption:"Uploading image...",cancel:h}),c=$.ajax({url:o,type:"POST",headers:s,processData:!1,xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",d,!1),e},success:function(e,o,n){l.close(),i.refresh(),t()},error:function(){l.close(),t("Failed to upload image.")},data:r,cache:!1,contentType:!1});function d(e){var t=e.loaded/e.total;l.update(t)}function h(){c.abort()}},T.prototype.fetchAPIKeys=function(e){var t=this;if(t.isLoggedIn()){var i=t.getUserId();if(i){var o=this.apiURL+"/self/user/"+i+"/tokens";t.request("GET",o,null,n)}else console.warn("No user id")}else console.warn("User not logged in");function n(t,i){return t?e(t):e(null,i)}},T.prototype.deleteAPIKey=function(e,t){var i=this;if(i.isLoggedIn()){var o=i.getUserId();if(o){var n=this.apiURL+"/self/user/"+o+"/tokens/"+e;i.request("DELETE",n,null,a)}else console.warn("No user id")}else console.warn("User not logged in");function a(e,i){return e?t(e):t(null,i)}},T.prototype.generateAPIKey=function(e){var t=this;if(t.isLoggedIn()){var i=t.getUserId();if(i){var o=this.apiURL+"/self/user/"+i+"/tokens";t.request("POST",o,null,n)}else console.warn("No user id")}else console.warn("User not logged in");function n(t,i){return t?e(t):e(null,i)}},T.prototype.getPlanInfo=function(e,t){var i=this;if(!i.isLoggedIn())return t();i.request("GET",this.baseURL+"/api/self/planinfo/"+encodeURIComponent(e),{},t)},T.prototype.samlLogin=function(){const e="APP";"APP"===e?NinoxDocumentInteraction.openBrowser(this.baseURL+`/saml/login?RelayState=${e}`):window.location.href=this.baseURL+`/saml/login?RelayState=${e}`},T.prototype.googleLogin=async function(){const e=this,t="de"===Object(b.getLocale)().LOCALE?"de":"en";let i="https://ninox.com";["qs","alpha"].includes("prod")&&(i="https://q-www.ninox.com");const o="APP",n=`${i}/api/auth/google/${"UA-46256641-1"}/${t}?source=${o}`;if("APP"!==o){let t;try{t=await w(n)}catch(e){throw e}return await new Promise(t=>e.refresh(t,!0)),t}NinoxDocumentInteraction.openBrowser(n)},T.prototype.getServerConfig=function(e){if(!NinoxDocumentInteraction.isOnline())return e(null,{});this.request("GET",this.baseURL+"/server-config",null,(t,i)=>{if(t)return e(t);e(null,i)})},T.prototype.fetchSession=function(e,t){let i=this.refreshURL,o={authorization:`Bearer USER-${e}`};$.ajax({type:"GET",url:i,processData:!1,xhrFields:{withCredentials:!0},headers:o,success:function(e,i,o){t&&t(null,e)},error:function(e,i,o){console.warn("Cannot get session info.",i,o),e.status>=400&&e.status<500&&t(o)}})};var C=o("./node_modules/socket.io-client/dist/socket.io.slim.js"),k=o("./node_modules/underscore/underscore.js");function S(e){this.remoteChanged=$.proxy(this.remoteChanged,this),this.messageReceived=$.proxy(this.messageReceived,this),this.messagesRecieved=$.proxy(this.messagesRecieved,this),this.onMessageRead=$.proxy(this.onMessageRead,this),this.socketConnected=$.proxy(this.socketConnected,this),this.socketDisconnected=$.proxy(this.socketDisconnected,this),this.dbms=e,this.token=null,this.userId=null,this.isAuthenticated=!1,this.socket=null,this.capSize=2,this.messages=[],this.conversations=[],this.msServices={dev:"http://ms.ninoxdb.test",qs:"https://q-ms.ninox.com",prod:"https://ms.ninox.com"},e.getRemoteConnection().on("change",this.remoteChanged),this.remoteChanged()}Object.assign(S.prototype,util.events),S.prototype.connect=function(){this.socket||this.msServices.prod&&(Object(c.f)()||this.dbms.getRemoteConnection().isLoggedIn()&&(this.socket=C(this.msServices.prod,{transports:["websocket"]}),this.socket.on("MESSAGE.PUSH",this.messageReceived),this.socket.on("MESSAGE.FETCH",this.messagesRecieved),this.socket.on("MESSAGE.READ",this.onMessageRead),this.socket.on("connect",this.socketConnected),this.socket.on("disconnect",this.socketDisconnected),this.remoteChanged()))},S.prototype.disconnect=function(){this.socket&&(this.socket.disconnect(),this.socket=null,this.token=null,this.user=null,this.isAuthenticated=!1)},S.prototype.getSessionToken=function(){var e=dbms.getRemoteConnection().getSessionInfo(),t=e&&e.token;return"USER-"===t.substr(0,5)&&(t=t.substr(5)),t},S.prototype.socketConnected=function(){this.remoteChanged()},S.prototype.socketDisconnected=function(){this.token=null,this.user=null,this.isAuthenticated=!1},S.prototype.remoteChanged=function(){this.dbms.getRemoteConnection().isLoggedIn()?this.socket?this.isAuthenticated&&this.token==this.getSessionToken()||this.authenticate():this.connect():this.disconnect()},S.prototype.authenticate=function(){if(this.socket){var e=this,t=this.getSessionToken();e.isAuthenticated=!1,e.socket.emit("CLIENT.AUTHENTICATE",{token:t},(function(i){i?console.log("MessageService.authenticate error",i):(e.token=t,e.isAuthenticated=!0,e.user=e.dbms.getRemoteConnection().session.user.id,e.fetchMessages({user:e.user}))}))}},S.prototype.logout=function(){if(this.socket){var e=this;e.isAuthenticated=!1,e.token=null,e.user=null,e.trigger("logout"),e.socket.emit("CLIENT.LOGOUT",{},(function(e){e&&console.log("MessageService.logout err",e)}))}},S.prototype.getCappedMessages=function(){return this.messages.slice(0,this.capSize)},S.prototype.fetchMessages=function(e){this.socket&&(e.user?(e=Object.assign({start:0,limit:5,sort:"createdAt",filter:{readAt:null,deletedAt:null}},e),this.isAuthenticated&&this.socket.emit("MESSAGE.FETCH",e)):console.error("Not a valid criteria for fetching messages"))},S.prototype.messagesRecieved=function(e){var t=this;e.error?console.warn("Could not fetch messages for user"):e.data.messages&&e.data.messages.length&&(t.messages=e.data.messages,t.trigger("messages",t.getCappedMessages()))},S.prototype.messageReceived=function(e){var t=this;t.messages.unshift(e),t.trigger("message",{message:e,latest:!0})},S.prototype.markMessageAsRead=function(e){if(this.socket){var t=this;t.isAuthenticated&&t.socket.emit("MESSAGE.READ",{id:e})}},S.prototype.onMessageRead=function(e){var t=this,i=t.getCappedMessages();if(t.isAuthenticated){if(e.error)return console.warn("Could not mark message "+o+" as read."),void t.trigger("removeMessageError");var o=e.data.messageId,n=-1;if(k.each(t.messages,(function(e,t){e._id===o&&(n=t)})),-1!==n){t.messages.splice(n,1);var a=t.getCappedMessages(),s=k.last(a),r=k.last(i);i.length===a.length&&s._id!==r._id&&t.trigger("message",{message:s,latest:!1})}}},S.prototype.markMessageAsDeleted=function(e){this.socket&&this.isAuthenticated&&this.socket.emit("MESSAGE.DELETE",{id:e})},S.prototype.sendMessage=function(e){this.socket&&this.isAuthenticated&&this.socket.emit("MESSAGE.PUSH",e)},S.prototype.fetchConversations=function(e,t,i,o){this.socket&&this.isAuthenticated&&this.socket.emit("CONVERSATION.FETCH",{user:e,start:t||0,limit:i||5,sort:o||"latestMessageAt"})},S.prototype.conversationsRecieved=function(e){this.conversations=this.conversations.concat(e),this.trigger("conversations",e)};o("./node_modules/core-js/modules/es.string.replace.js");const _=schemas.RE_FILE_REF;function E(e){this.connection=e;var t=NinoxDocumentInteraction.getUserDefault("nx.server");t?this.baseURL="https://"+t+e.path:e.host?this.baseURL=(e.ssl?"https://":"http://")+e.host+(e.ssl?443==e.port?"":":"+e.port:80==e.port?"":":"+e.port)+e.path:this.baseURL=e.path,/https?\:/.test(this.baseURL)?this.absoluteBaseURL=this.baseURL:this.absoluteBaseURL=window.location.protocol+"//"+window.location.host+this.baseURL,this.dontShowErrors=!!e.dontShowErrors,this.reloginActive=!1,this.requestQueue=[]}function D(e,t){this.root=e,this.dbid=t,this.baseURL=e.baseURL+"/"+encodeURIComponent(t),this.fileModCount=Date.now()}E.prototype.getToken=function(){return dbms.getRemoteConnection().getToken()},E.prototype.getAuthorization=function(){var e=dbms.getRemoteConnection().getToken();return e?"Bearer "+e:""},E.prototype.getDBServer=function(e){return new D(this,e)},E.prototype.loadDatabases=function(e){this.GET(this.baseURL+"/root/databases/list",{},e)},E.prototype.loadAccount=function(e){this.GET(this.baseURL+"/root/account",{},e)},E.prototype.createBackup=function(e,t){this.POST(this.baseURL+"/"+encodeURIComponent(e.dbid)+"/createbackup",void 0,e,t)},E.prototype.listBackups=function(e){this.GET(this.baseURL+"/root/backups/list",{},e)},E.prototype.listSnapshots=function(e){this.GET(this.baseURL+"/root/snapshots/list",{},e)},E.prototype.restoreBackup=function(e,t){this.POST(this.baseURL+"/root/backups/restore",void 0,{id:e},t)},E.prototype.restoreSnapshot=function(e,t,i){this.POST(this.baseURL+"/root/snapshots/restore",void 0,{dbid:e,timestamp:t},i)},E.prototype.removeBackup=function(e,t){this.POST(this.baseURL+"/root/backups/remove",void 0,{id:e},t)},E.prototype.removeSnapshot=function(e,t,i){this.POST(this.baseURL+"/root/snapshots/remove",void 0,{dbid:e,timestamp:t},i)},E.prototype.downloadBackupURL=function(e,t){return this.baseURL+"/root/backups/download/"+encodeURIComponent(t)+"?id="+encodeURIComponent(e)+"&XT="+encodeURIComponent(this.getToken())},E.prototype.createArchive=function(e,t){this.POST(this.baseURL+"/"+encodeURIComponent(e.dbid)+"/createarchive",void 0,e,t)},E.prototype.listArchives=function(e){this.GET(this.baseURL+"/root/databases/listarchives",{},e)},E.prototype.removeArchive=function(e,t){this.POST(this.baseURL+"/root/databases/removearchive",void 0,String(e),t)},E.prototype.downloadArchiveURL=function(e){return this.baseURL+"/root/databases/downloadarchive/"+encodeURIComponent(e.name)},E.prototype.createDatabase=function(e,t){this.POST(this.baseURL+"/root/databases/create",void 0,{dbname:e.dbname||e.name,icon:e.icon,color:e.color},t)},E.prototype.exportArchiveURL=function(e){return this.baseURL+"/"+encodeURIComponent(e)+"/exportarchive"},E.prototype.removeDatabase=function(e,t){this.POST(this.baseURL+"/root/databases/remove",void 0,{dbid:e},t)},E.prototype.loadArchive=function(e,t){this.POST(this.baseURL+"/root/databases/loadarchive",void 0,e,t)},E.prototype.uploadArchive=function(e,t){var i=this.baseURL+"/root/databases/uploadarchive",o=new FormData;o.append("name",e.name),o.append("file",e.file);var n=$.progress({caption:"Uploading Archive File...",cancel:r}),a=$.ajax({url:i,type:"POST",headers:this.getHeaders(),xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",s,!1),e},success:function(e){n.close();try{var i=JSON.parse(e);t(void 0,i)}catch(e){t(e)}},error:function(){n.close(),t("Failed to upload archive.")},data:o,cache:!1,contentType:!1,processData:!1});function s(e){var t=e.loaded/e.total;n.update(t)}function r(){a.abort()}},E.prototype.updateSettings=function(e,t){this.POST(this.baseURL+"/root/settings",void 0,e,t)},E.prototype.backgroundURL=function(e){return this.baseURL+"/root/background.jpg?T="+(e||0)},E.prototype.deleteBackground=function(e){this.DELETE(this.baseURL+"/root/clear-background",{},e)},E.prototype.uploadBackground=function(e,t){var i=this.baseURL+"/root/upload-background",o=new FormData;o.append("file",e.file);var n=$.progress({caption:"Uploading Background Image...",cancel:r}),a=$.ajax({url:i,type:"POST",headers:this.getHeaders(),xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",s,!1),e},success:function(e){n.close(),t()},error:function(){n.close(),t("Failed to upload background image.")},data:o,cache:!1,contentType:!1,processData:!1});function s(e){var t=e.loaded/e.total;n.update(t)}function r(){a.abort()}},E.prototype.exportArchiveURL=function(e){return this.baseURL+"/"+encodeURIComponent(e.dbid)+"/exportarchive?data="+e.data+"&files="+e.files+"&comments="+e.comments+"&history="+e.history+"&messages="+e.messages},D.prototype.getHeaders=function(){return this.root.getHeaders()},D.prototype.uploadBackground=function(e,t){var i=this.baseURL+"/files/background.jpg",o=new FormData;o.append("file",e.file);var n=$.progress({caption:"Uploading Background File...",cancel:r}),a=$.ajax({url:i,type:"POST",headers:this.getHeaders(),xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",s,!1),e},success:function(e){n.close();try{var i=JSON.parse(e);t(void 0,i)}catch(e){t(e)}},error:function(){n.close(),t("Failed to upload image.")},data:o,cache:!1,contentType:!1,processData:!1});function s(e){var t=e.loaded/e.total;n.update(t)}function r(){a.abort()}},D.prototype.loadNodes=function(e,t,i){this.root.POST(this.baseURL+"/json/nodes2",void 0,{nids:e,deps:t},i)},D.prototype.sendCreate=function(e,t,i){this.root.POST(this.baseURL+"/json/create2",void 0,{tid:e,values:t},i)},D.prototype.sendRemove=function(e,t){this.root.POST(this.baseURL+"/json/remove",void 0,[e],t)},D.prototype.sendRemoveAll=function(e,t){this.root.POST(this.baseURL+"/json/remove",void 0,e,t)},D.prototype.sendUpdate=function(e,t,i,o){this.root.POST(this.baseURL+"/json/update2",void 0,{nid:e,fid:t,val:i},o)},D.prototype.sendUpdateNodes=function(e,t){this.root.POST(this.baseURL+"/json/updatenodes",void 0,e,t)},D.prototype.sendDuplicate=function(e,t){this.root.POST(this.baseURL+"/json/duplicate",void 0,{nid:e},t)},D.prototype.sendFind=function(e,t,i){this.root.POST(this.baseURL+"/json/find",void 0,{select:e,find:t},i)},D.prototype.sendSelects=function(e,t){this.root.POST(this.baseURL+"/json/selects",void 0,e,t)},D.prototype.loadCalendar=function(e,t,i){this.root.POST(this.baseURL+"/json/calendar",void 0,{start:e,end:t},i)},D.prototype.loadComments=function(e,t){this.root.POST(this.baseURL+"/json/comments",void 0,{nid:e},t)},D.prototype.postComment=function(e,t,i,o){this.root.POST(this.baseURL+"/json/comment",void 0,{nid:e,cid:t,comment:i},o)},D.prototype.removeComment=function(e,t,i){this.root.POST(this.baseURL+"/json/removecomment",void 0,{nid:e,cid:t},i)},D.prototype.loadFiles=function(e,t){this.root.POST(this.baseURL+"/json/files",void 0,{nid:e},t)},D.prototype.removeFile=function(e,t,i){this.root.POST(this.baseURL+"/files/remove",void 0,{nid:e,file:t},i)},D.prototype.previewURL=function(e,t){if(t)return this.baseURL+"/files/preview/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())},D.prototype.thumbURL1=function(e){if(e){var t=_.exec(e);if(t){var i=t[1],o=t[2],n=t[3];return this.baseURL+"/files/preview/"+encodeURIComponent(i+o)+"/"+encodeURIComponent(n)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())}}},D.prototype.thumbURL2=function(e,t){if(t)return this.baseURL+"/files/preview/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())},D.prototype.thumb2URL1=function(e){if(e){var t=_.exec(e);if(t){var i=t[1],o=t[2],n=t[3];return this.baseURL+"/files/preview/"+encodeURIComponent(i+o)+"/"+encodeURIComponent(n)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())}}},D.prototype.thumb2URL2=function(e,t){if(t)return this.baseURL+"/files/preview/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())},D.prototype.fileURL1=function(e){if(e){var t=_.exec(e);if(t){var i=t[1],o=t[2],n=t[3];return this.baseURL+"/files/download/"+encodeURIComponent(i+o)+"/"+encodeURIComponent(n)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())}}},D.prototype.fileURL2=function(e,t){if(t)return this.baseURL+"/files/download/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())},D.prototype.downloadURL=function(e,t){if(t)return this.baseURL+"/files/download/"+encodeURIComponent(e)+"/"+encodeURIComponent(t)+"?T="+this.fileModCount+"&XT="+encodeURIComponent(this.getToken())},D.prototype.uploadURL=function(e){return this.baseURL+"/files/upload?nid="+encodeURIComponent(e)},D.prototype.loadHistory=function(e){this.root.GET(this.baseURL+"/json/history",void 0,e)},D.prototype.loadNodeHistory=function(e,t){this.root.POST(this.baseURL+"/json/history",void 0,{nid:e},t)},D.prototype.loadViews=function(e){this.root.GET(this.baseURL+"/json/views/list",void 0,e)},D.prototype.saveView=function(e,t){this.root.POST(this.baseURL+"/json/views/update",void 0,e,t)},D.prototype.removeView=function(e,t){this.root.POST(this.baseURL+"/json/views/remove",void 0,e,t)},D.prototype.loadBootstrap=function(e){this.root.GET(this.baseURL+"/json/bootstrap",void 0,(function(t,i){if(t)return e(t);e(void 0,i)}))},D.prototype.loadChanges=function(e,t){this.root.POST(this.baseURL+"/json/changes",{$timeout:4e4},{since:e||0},t)},D.prototype.sendUpdateSchema=function(e,t){this.root.POST(this.baseURL+"/json/updateschema",void 0,e,t)},D.prototype.sendPatchSchema=function(e,t){this.root.POST(this.baseURL+"/json/patchschema",void 0,e,t)},D.prototype.reindex=function(e){this.root.POST(this.baseURL+"/json/reindex",void 0,void 0,e)},D.prototype.reIndexFiles=function(e){this.root.POST(this.baseURL+"/json/reindex-files",void 0,void 0,e)},D.prototype.rebuildThumbs=function(e){this.root.POST(this.baseURL+"/json/rebuild-thumbs",void 0,void 0,e)},D.prototype.clearHistory=function(e){this.root.POST(this.baseURL+"/json/clearhistory",void 0,void 0,e)},D.prototype.setBackground=function(e,t){this.root.POST(this.baseURL+"/settings/background-class",void 0,e,t)},D.prototype.backgroundURL=function(e){return this.baseURL+"/files/background.jpg"+(e?"?_refresh="+Math.floor(1e6*Math.random()):"")},D.prototype.updateSettings=function(e,t){this.root.POST(this.baseURL+"/settings/update",void 0,e,t)},D.prototype.listReports=function(e){this.root.GET(this.baseURL+"/reports/list",void 0,e)},D.prototype.updateReport=function(e,t){this.root.POST(this.baseURL+"/reports/update",void 0,e,t)},D.prototype.removeReport=function(e,t){this.root.POST(this.baseURL+"/reports/remove",void 0,{reportId:e},t)},D.prototype.removeReportFile=function(e,t,i){this.root.POST(this.baseURL+"/reports/removeFile",void 0,{reportId:e,file:t},i)},D.prototype.cleanReportFiles=function(e,t,i){this.root.POST(this.baseURL+"/reports/cleanFiles",void 0,{reportId:e,retain:t},i)},D.prototype.copyReportFiles=function(e,t,i){this.root.POST(this.baseURL+"/reports/copyFiles",void 0,{sourceId:e,targetId:t},i)},D.prototype.reportFileURL=function(e,t){return this.baseURL+"/reports/file?report="+encodeURIComponent(e)+"&file="+encodeURIComponent(t)+"&XT="+encodeURIComponent(this.getToken())},D.prototype.importReportFile=function(e,t,i){var o=this,n=/\.([a-zA-Z0-9]+)$/.exec(t.name);if(!n)return i("Invalid file name: "+t.name);var a=n[1],s=util.createLowerUUID(12)+"."+a,r=new FormData;r.append("file",t);var l=$.progress({caption:"Uploading File...",cancel:h}),c=$.ajax({url:this.baseURL+"/reports/uploadFile?report="+encodeURIComponent(e)+"&file="+encodeURIComponent(s),type:"POST",headers:this.getHeaders(),xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",d,!1),e},success:function(){o.fileModCount++,l.close(),i(void 0,s)},error:function(){o.fileModCount++,l.close(),i("Failed to upload image")},data:r,cache:!1,contentType:!1,processData:!1});function d(e){var t=e.loaded/e.total;l.update(t)}function h(){c.abort()}},D.prototype.importFile=function(e,t,i,o){"function"==typeof i&&(o=i,i=void 0),null==i&&(i=(t.renameTo?t.renameTo:t.name)||"unnamed"),i=i.normalize("NFC");var n=this,a=new FormData;i?a.append("file",t,i):a.append("file",t);var s=$.progress({caption:"Uploading File...",cancel:c}),r=$.ajax({url:this.baseURL+"/files/upload?nid="+encodeURIComponent(e)+(t.renameTo?"&renameTo="+encodeURIComponent(t.renameTo):""),type:"POST",headers:this.getHeaders(),xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",l,!1),e},success:function(){n.fileModCount++,s.close(),o(void 0,i||t.renameTo||t.name)},error:function(){n.fileModCount++,s.close(),o("Failed to upload file")},data:a,cache:!1,contentType:!1,processData:!1});function l(e){var t=e.loaded/e.total;s.update(t)}function c(){r.abort()}},D.prototype.importFileFromURL=function(e,t,i,o){this.fileModCount++,this.root.POST(this.baseURL+"/files/import",void 0,{nid:e,url:t,name:i},o)},D.prototype.renameFile=function(e,t,i,o){this.fileModCount++,this.root.POST(this.baseURL+"/files/rename",void 0,{nid:e,name:t,name2:i},o)},D.prototype.saveFileURL=function(e,t,i){return this.root.baseURL+"/root/savefile?name="+encodeURIComponent(e)+"&ct="+encodeURIComponent(t)+(i?"&isBase64=true":"")+"&XT="+encodeURIComponent(this.getToken())},D.prototype.loadFileURL=function(e,t,i,o){return this.root.absoluteBaseURL+"/root/loadfile/"+encodeURIComponent(t)+"?id="+encodeURIComponent(e)+"&ct="+encodeURIComponent(i)+(o?"&download=1":"")+"&t="+Date.now()+"&XT="+encodeURIComponent(this.getToken())},D.prototype.printSimple=function(e,t){this.root.POST(this.baseURL+"/print/print-simple",void 0,e,t)},D.prototype.printRich=function(e,t){this.root.POST(this.baseURL+"/print/print-rich",void 0,e,t)},D.prototype.syncEvents=function(e,t){this.root.GET(this.baseURL+"/sync/events/"+e,{},t)},D.prototype.syncInit=function(e){this.root.GET(this.baseURL+"/sync/init",{$showProgress:!0,$showProgressTitle:"Loading data..."},e)},D.prototype.syncPull=function(e,t){this.root.GET(this.baseURL+"/sync/pull2/"+e,{},t)},D.prototype.syncPush=function(e,t,i){this.root.POST(this.baseURL+"/sync/push/"+e,void 0,t,i)},D.prototype.getToken=function(){return this.root.getToken()},D.prototype.getAuthorization=function(){return this.root.getAuthorization()},D.prototype.evaluateOnServer=function(e,t,i){this.root.POST(this.baseURL+"/json/evaluate",void 0,{nid:e,exp:t.toString()},i)},D.prototype.sendEmail=function(e,t){this.root.POST(this.baseURL+"/services/sendemail",void 0,e,t)},D.prototype.shareFile=function(e,t,i){this.root.POST(this.baseURL+"/share/file",void 0,{nid:e,file:t},i)},D.prototype.unshareFile=function(e,t,i){this.root.DELETE(this.baseURL+"/share/file/"+encodeURIComponent(e)+"/"+encodeURIComponent(t),{},i)},D.prototype.loadSharedFile=function(e,t,i){this.root.GET(this.baseURL+"/share/file/"+encodeURIComponent(e)+"/"+encodeURIComponent(t),{},i)},D.prototype.shareView=function(e,t,i){this.root.POST(this.baseURL+"/share/view",void 0,{viewid:e,options:t},i)},D.prototype.unshareView=function(e,t){this.root.DELETE(this.baseURL+"/share/view/"+encodeURIComponent(e),{},t)},D.prototype.loadSharedView=function(e,t){this.root.GET(this.baseURL+"/share/view/"+encodeURIComponent(e),{},t)},D.prototype.exportSchemaURL=function(){return this.baseURL+"/exportschema"},D.prototype.importSchema=function(e,t){this.root.POST(this.baseURL+"/importschema",void 0,e,t)},E.prototype.request=function(e,t,i,o,n){var a=this,s=!1,r=null;if(a.reloginActive)a.requestQueue.push([e,t,i,o,n]);else{var l=void 0;if(i){i.contentType&&(l=i.contentType),i.$showProgress&&(s=!0);var c=!0;for(var d in i)if(i.hasOwnProperty(d)&&"contentType"!==d&&"$"!==d[0]){var h=i[d];null!=h&&(t+=(c?"?":"&")+d+"="+encodeURIComponent(String(h)),c=!1)}}s&&(r=$.progress({caption:i.$showProgressTitle,cancel:f}));var p=$.ajax({type:e,url:t,headers:this.getHeaders(),data:null==o?void 0:l?o:JSON.stringify(o),processData:!1,contentType:null==o?void 0:l||"text/plain",timeout:i?i.$timeout:void 0,xhrFields:{withCredentials:!0},xhr:function(){var e=$.ajaxSettings.xhr();return s&&e.upload&&e.upload.addEventListener("progress",u,!1),e},success:function(e,t,i){if(r&&r.close(),e){var o,a=null;try{e=e.replace(/((?:\\\\)*(?:[^\\]))\\u0000/g,"$1"),o=JSON.parse(e)}catch(e){a=e}n(a,o)}else n(void 0,void 0)},error:function(s,l,c){if(r&&r.close(),401===s.status)a.requestQueue.push([e,t,i,o,n]),a.relogin();else{var d=s.responseText||locale.errorServerNotResponding;k.isArray(d)&&(d=0===d.length?locale.unknowError:d.join(", ")),a.dontShowErrors||log(d),n(d)}}})}function u(e){var t=e.loaded/e.total;r.update(t)}function f(){p.abort()}},E.prototype.GET=function(e,t,i){this.request("GET",e,t,void 0,i)},E.prototype.POST=function(e,t,i,o){this.request("POST",e,t,i,o)},E.prototype.PUT=function(e,t,i,o){this.request("PUT",e,t,i,o)},E.prototype.DELETE=function(e,t,i){this.request("DELETE",e,t,void 0,i)},E.prototype.relogin=function(){var e=this;function t(){dbms.getRemoteConnection().relogin(i)}function i(i){i?(e.reloginActive=!1,setTimeout((function(){e.rerequest()}),0)):setTimeout(t,0)}e.reloginActive||(e.reloginActive=!0,setTimeout(t,0))},E.prototype.rerequest=function(){var e=this.requestQueue;this.requestQueue=[];for(var t=0;t<e.length;t++){var i=e[t];this.request.apply(this,i)}},E.prototype.getHeaders=function(){var e=dbms.getRemoteConnection().getToken();return{authorization:e?"Bearer "+e:void 0}};var N=o("./src/js/client/RemoteDB.js");function I(e,t){this.dbms=e,this.id=t.id,this.name=t.name,this.settings={},this.databases={},this.isSyncInProgress=!1,this._syncCallbacks=[],this.isCacheLoaded=!1;var i=dbms.getRemoteConnection().getAccount(this.id);if(i){var o=i.host,n=i.port,a=!1!==i.ssl,s="/"+this.id;n||(n=a?443:80),this.server=new E({host:o,port:n,path:s,ssl:a,dontShowErrors:!0})}}function O(e){this.database=e,this._syncTimeout=null,this._syncTriggered=!1,this._syncRunning=!1,this._syncEnabled=!0,this._changeCount=0,this._lastSync=0,this._runSync=$.proxy(this._runSync,this)}function M(e){return Number(e.from)+"-"+(e.allDay?0:Number(e.to))+":"+(e.allDay?"1":"0")+":"+e.title}Object.assign(I.prototype,util.events),I.prototype.base="remote",I.prototype.drop=function(){},I.prototype.save=function(){},I.prototype.update=function(e){this.name=e.name},I.prototype.listDatabases=function(){return k.filter(util.localeSortBy(this.databases,"name"),(function(e){return e.isOpenable}))},I.prototype.getDatabaseNames=function(){var e={},t=this.databases;for(var i in t){if(t.hasOwnProperty(i))e[t[i].name]=!0}return e},I.prototype.getDatabase=function(e){return this.databases[e]},I.prototype.ensureDatabase=function(e,t){var i=this,o=i.databases[e];if(o)return t(void 0,o);i.sync(!1,(function(){var o=i.databases[e];t(void 0,o)}))},I.prototype.resetSync=function(e){},I.prototype.loadRemoteAccount=function(e){var t=this;return NinoxDocumentInteraction.isOnline()?dbms.getRemoteConnection().getToken()?void t.server.loadAccount(e):e("NOT_SIGNED_ID"):e("OFFLINE")},I.prototype._callSyncCallbacks=function(){console.log("AccountRemote._callSyncCallbacks",this._syncCallbacks.length);var e=this._syncCallbacks;this._syncCallbacks=[];for(var t=0;t<e.length;t++)setTimeout(e[t],0)},I.prototype.sync=function(e,t){var i=this;if(t&&i._syncCallbacks.push(t),!i.isSyncInProgress){i.isSyncInProgress=!0;var o=dbms.getRemoteConnection().getAccount(this.id);if(o&&(i.name=o.name),!i.isCacheLoaded){i.isCacheLoaded=!0;var n=null,a=window.localStorage&&window.localStorage["account."+i.id];if(a)try{n=JSON.parse(a)}catch(e){console.log("Failed to parse cached account",e)}if(n){i.settings=n.settings||{};for(var s=n.databases||[],r={},l=0;l<s.length;l++){var c=s[l],d=c.id;c.isOpenable=i.canOpenDatabase(c),c.account=i.id,c.isStored=!0,r[d]=c}i.databases=r}else console.log("No cached account")}i.trigger("change"),i.loadRemoteAccount((function(e,t){if(e)$.alert(e);else if(t){window.localStorage&&(window.localStorage["account."+i.id]=JSON.stringify(t)),i.settings=t.settings||{};for(var o=t.databases||[],n={},a=0;a<o.length;a++){var s=o[a],r=s.id;s.isOpenable=i.canOpenDatabase(s),s.account=i.id,s.isStored=!0,n[r]=s}i.databases=n}i.isSyncInProgress=!1,i.trigger("change"),i._callSyncCallbacks()}))}},I.prototype.removeStoredDatabase=function(e){},I.prototype.canOpenDatabase=function(e){var t=e.settings;if(!t)return!0;var i=t.rolesOpen;if(!i||!i.length)return!0;var o=dbms.getRemoteConnection().getCurrentAccountUser(this.id);if(o.roles.admin)return!0;for(var n=0;n<i.length;n++){var a=i[n];if(o.roles[a])return!0}return!1},I.prototype.openDatabase=function(e,t){var i=this;if("string"==typeof e){var o=e;if(!(e=i.databases[o]))return t("Database not found: "+o+" in account "+i.id)}if(!i.canOpenDatabase(e))return t("Not authorized.");var n=i.server.getDBServer(e.id),a=new N.a(e,this,n);a.openDatabase(!1,(function(e){if(e)return t(e);window.database=a,t(void 0,a)}))},I.prototype.openAnotherDatabase=function(e,t){var i=this,o=i.databases[e];if(!o)return t("Database not found: "+e);if(!i.canOpenDatabase(o))return t("Not authorized.");var n=i.server.getDBServer(o.id),a=new N.a(o,this,n);a.openDatabase(!0,(function(e){if(e)return t(e);t(void 0,a)}))},I.prototype.createDatabase=function(e,t){var i=this;i.server.createDatabase(e,(function(e,o){i.sync(),t(e,o)}))},I.prototype.renameDatabase=function(e,t,i){var o=this;o.server.getDBServer(e.id).updateSettings(t,(function(e,t){o.sync(),i(e,t)}))},I.prototype.removeDatabase=function(e,t){var i=this;i.server.removeDatabase(e.id,(function(o){o||(delete i.databases[e.id],i.trigger("change")),t(o)}))},I.prototype.duplicateDatabase=function(){},I.prototype.isAdmin=function(){return dbms.getRemoteConnection().isAdmin(this.id)},I.prototype.loadArchive=function(e,t){var i=this;i.server.loadArchive(e,(function(e,o){i.sync(),t(e,o)}))},I.prototype.getRoles=function(){return dbms.getRemoteConnection().getSessionInfo().getRoles(this.id)},I.prototype.createBackup=function(e,t){this.server.createBackup(e,t)},I.prototype.listBackups=function(e){this.server.listBackups(e)},I.prototype.listSnapshots=function(e){this.server.listSnapshots(e)},I.prototype.removeBackup=function(e,t){this.server.removeBackup(e,t)},I.prototype.removeSnapshot=function(e,t,i){this.server.removeSnapshot(e,t,i)},I.prototype.restoreBackup=function(e,t){var i=this;i.server.restoreBackup(e,(function(e){i.sync(),t(e)}))},I.prototype.restoreSnapshot=function(e,t,i){var o=this;o.server.restoreSnapshot(e,t,(function(e){o.sync(!0),i(e)}))},I.prototype.downloadBackupURL=function(e,t){return this.server.downloadBackupURL(e,t)},I.prototype.backgroundURL=function(){return this.server?this.server.backgroundURL(this.settings.backgroundTimestamp||0):void 0},I.prototype.isOwner=function(){var e=dbms.getRemoteConnection();return e.getAccount(this.id).owner===e.getUserId()},I.prototype.getPlan=function(){return dbms.getRemoteConnection().getSessionInfo().getPlan()},I.prototype.getInvitations=function(){return dbms.getRemoteConnection().listInvitations(this.id)},I.prototype.getMembers=function(){return dbms.getRemoteConnection().listAccountUsers(this.id)},I.prototype.getOwnerId=function(){return dbms.getRemoteConnection().getAccount(this.id).owner},I.prototype.getCurrentUser=function(){return dbms.getRemoteConnection().getCurrentUser()},I.prototype.getCurrentUserId=function(){const e=this.getCurrentUser();return e?e.id:void 0},I.prototype.isRootUser=function(){return dbms.getRemoteConnection().getSessionInfo().user.isRoot},O.prototype.settingsChanged=function(){this._syncEnabled=!0,this.triggerSync()},O.prototype.init=function(){this.database.on("create",void 0,this.nodeCreated,this),this.database.on("change",void 0,this.nodeChanged,this),this.database.on("remove",void 0,this.nodeRemoved,this),this.database.on("schema",void 0,this.schemaChanged,this),this.triggerSync()},O.prototype.destroy=function(){this.database.off("create",void 0,this.nodeCreated,this),this.database.off("change",void 0,this.nodeChanged,this),this.database.off("remove",void 0,this.nodeRemoved,this),this.database.off("schema",void 0,this.schemaChanged,this)},O.prototype.nodeCreated=function(e,t,i){this.triggerSync()},O.prototype.nodeChanged=function(e,t){this.triggerSync()},O.prototype.nodeRemoved=function(e,t){this.triggerSync()},O.prototype.schemaChanged=function(e,t,i){!1===t&&!0===i&&this.triggerFullResync()},O.prototype.triggerFullResync=function(){this.triggerSync()},O.prototype.triggerSync=function(){!this._syncTriggered&&this._syncEnabled&&(this._syncTriggered=!0,this._syncRunning||this._syncTimeout||(this._syncTimeout=setTimeout(this._runSync,Math.max(1e3,this._lastSync-Date.now()+1e4))))},O.prototype._runSync=function(){var e=this,t=e.database;if(e._syncTriggered&&!e._syncRunning){e._syncTriggered=!1,e._syncRunning=!0,e._syncTimeout=null;var i="db."+t.getUniqueID(),o="true"===NinoxDocumentInteraction.getUserDefault(i+".calendar.syncEnabled"),n=NinoxDocumentInteraction.getUserDefault(i+".calendar.syncStorage")||"local",a=parseInt(NinoxDocumentInteraction.getUserDefault(i+".calendar.syncBeyond")||"1"),s=parseInt(NinoxDocumentInteraction.getUserDefault(i+".calendar.syncAhead")||"3");if(e._syncEnabled=o,!o)return T();e._fullResync;e._fullResync=!1;e._nodesToSync;e._nodesToSync={};e._nodesToRemove;e._nodesToRemove={},e._changeCount=0;var r=util.clone(e._syncedNodes),l=null,c=w(),d=new Date,h=d.getFullYear(),p=d.getMonth(),u=(d.getDate(),new Date(h,p-a,1)),f=new Date(h,p+s,0),m=new Date(h,p-2*a,1),g=new Date(h,p+2*s,0);v((function(e){if(e)return T(e);y((function(e,t){if(e)return T(e);x()}))}))}function v(e){NinoxCalendar.enableCalendarSync((function(i,o){return i?e(i):o?void NinoxCalendar.loadCalendar(n,"Ninox "+t.name,(function(t,i){if(!i)return e("Failed to create calendar.\n"+(t||""));l=i,e()})):e(locale.noCalendarAccess)}))}function y(e){console.log("CalendarSync.runFullResync"),t.loadCalendarFromTo(u,f,(function(i,o){console.log("    nids loaded: "+o.length);var n={},a=[];if(o)for(var s=0;s<o.length;s++){var r=o[s];n[r]||(a.push(r),n[r]=!0)}o=a,console.log("    nids deduplicated",o.length),t.loadNodes2(o,c,(function(){console.log("    nodes loaded"),t.filterReadable(void 0,o,(async function(t){try{console.log("    nids filtered",t.length);var i=Date.now(),o=await NinoxCalendar.loadEvents(l,m,g),n=Date.now();console.log("    old events loaded: "+o.length+" in "+(n-i)+"ms");var a=util.arrayToSet(o,M);const f=(await Promise.all(t.map(e=>b(e)))).reduce((e,t)=>e.concat(t),[]);console.log("    new events loaded",f.length);var s=util.arrayToSet(f,M),r=util.setDiff(a,s),c=util.setDiff(s,a),d=0;for(var h in r)if(r.hasOwnProperty(h)){var p=r[h];console.log("Remove event: "+h),NinoxCalendar.removeEvent(l,p.id),d++}for(var h in c)if(c.hasOwnProperty(h)){var u=c[h];console.log("Add event: "+h),await NinoxCalendar.addEvent(l,u.from,u.to,u.allDay,u.title),d++}e(void 0,d>0)}catch(t){e(t)}}))}))}))}async function b(e){var i=t.loadNodeSync(e);if(!i)return[];var o=t.typeOf(e);if(!o)return[];var n,a,s=[];for(var r in o.fields)if(o.fields.hasOwnProperty(r)){var l=o.fields[r];if(l.dateCalendar)if("date"===l.base||"datx"===l.base){if("number"==typeof(n=i[r])&&!isNaN(n)){var c=new Date(n);if("datx"===l.base&&(c=new Date(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate())),l.dateYearly&&(c.setYear(h),c.getTime()>f.getTime()&&c.setYear(h-1)),c.setHours(0),c.setMinutes(0),c.setSeconds(0),c.setMilliseconds(0),a=locale.unnamed,l.dateCalendarFormatExp){var d=await l.dateCalendarFormatExp.promise(t,i).catch(()=>{});a=l.dateCalendarFormatExp.returnType.format(d)}else a=o.caption+": "+o.format(i);s.push({title:a,from:c,to:c,allDay:1})}}else if("appointment"===l.base&&(n=i[r])){var p=n.split("/");if(2===p.length){var u=parseInt(p[0]),m=u+parseInt(p[1]),g=new Date(u),v=new Date(m);a=locale.unnamed,a=l.dateCalendarFormatExp?await l.dateCalendarFormatExp.promise(t,i).catch(()=>locale.fnUnknowError):o.caption+": "+o.format(i),s.push({title:a,from:g,to:v,allDay:0})}}}return s}function w(){var e={},i=t.schema.types;for(var o in i)if(i.hasOwnProperty(o)){var n=i[o].fields;for(var a in n){var s=n[a];s.dateCalendar&&s.dateCalendarFormatExp&&(e=queries.extendDependencies(s.dateCalendarFormatExp.dependencies))}}return e}function x(){NinoxCalendar.commit((function(t){if(t)return T(t);e._syncedNodes=r,T()}))}function T(t){t&&($.alert(t),e._syncEnabled=!1),e._syncRunning=!1,e._lastSync=Date.now(),e._syncTriggered&&!e._syncTimeout&&e._syncEnabled&&(e._syncTimeout=setTimeout(e._runSync,1e4))}};o("./node_modules/core-js/modules/web.url.to-json.js");const F=schemas.RE_NID,R=util.multiMatchOr;function L(){}function j(e,t){var i=k.sortedIndex(e,t);e[i]!==t&&e.splice(i,0,t)}function A(e,t){var i=k.sortedIndex(e,t);e[i]===t&&e.splice(i,1)}function P(e,t){return e===t||null===e&&void 0===t||void 0===e&&null===t}function U(e){var t=F.exec(e);if(t)return parseInt(t[2])}function H(e){var t=F.exec(e);if(t)return t[1]}function z(e){if(!e||"string"!=typeof e)return[];for(var t=e.toLocaleLowerCase().trim().split(/\s+/),i=[],o=0;o<t.length;o++){var n=t[o];n&&i.push(n)}return i}Object.assign(L.prototype,schemas.AbstractDatabase.prototype),L.prototype.isSync=!0,L.prototype.writeUpdateSchema=function(e){throw"Not implemented"},L.prototype.writeCreateNode=function(e,t,i){throw"Not implemented"},L.prototype.writeRemoveNode=function(e,t){throw"Not implemented"},L.prototype.writeUpdateField=function(e,t,i,o){throw"Not implemented"},L.prototype.writeUpdateReference=function(e,t,i,o){throw"Not implemented"},L.prototype.removeTypeFiles=function(e){throw"Not implemented"},L.prototype.removeNodeFiles=function(e,t){throw"Not implemented"},L.prototype.fileURL=function(e,t){throw"Not implemented"},L.prototype.previewURL=function(e,t){throw"Not implemented"},L.prototype.thumbURL=function(e,t){throw"Not implemented"},L.prototype.previewFile=function(e,t){throw"Not implemented"},L.prototype.loadFiles=function(e,t){t("Not implemented")},L.prototype.removeFile=function(e,t,i){i("Not implemented")},L.prototype.saveFile=function(e,t,i,o){o("Not implemented")},L.prototype.setBackgroundFile=function(e,t){t("Not implemented")},L.prototype.backgroundURL=function(){throw"Not implemented"},L.prototype.writeUpdateSettings=function(e){throw"Not implemented"},L.prototype.serverFileURL1=function(e){throw"Not implemented"},L.prototype.userName=function(e){return locale.unknown},L.prototype.authorizationOpen=!0,L.prototype.authorizationPrint=!0,L.prototype.authorizationExport=!0,L.prototype.authorizationImport=!0,L.prototype.authorizationMassDataUpdate=!0,L.prototype.listReports=function(e){e(void 0,this.reports)},L.prototype.loadReport=function(e,t){t(void 0,this.reports[e])},L.prototype.updateReport=function(e,t){t("Not implemented")},L.prototype.removeReport=function(e,t){t("Not implemented")},L.prototype.importReportFile=function(e,t,i,o){o("Not implemented")},L.prototype.saveReportFile=function(e,t,i,o){o("Not implemented")},L.prototype.removeReportFile=function(e,t,i){i("Not implemented")},L.prototype.reportFileURL=function(e,t){throw"Not implemented"},L.prototype.reportFileServerURL=L.prototype.reportFileURL,L.prototype.reportFileURLProxy=function(e,t){throw"Not implemented"},L.prototype.ridOf=U,L.prototype.tidOf=H,L.prototype.ridOfNode=schemas.ridOfNode,L.prototype.init=function(){this.isOpen=!1,this.adminMode=!1,this.adminEnabled=!0,this.name="",this.schema=void 0,this.originalSchema=void 0,this.suppressTriggers=!1,this._transactionDepth=0,this._undoStack=void 0,this.tables={},this.nextRid={},this.settings={},this.user={id:"user",caption:"User",firstName:"Default",lastName:"User",roles:{admin:!0},order:1},this.users={user:this.user},this._schedule=[],this.listeners={},this.supports={history:!1,chat:!1,authentication:!1,files:!0,comments:!1,sync:!1,apps:!1,reindex:!1,reIndexFiles:!1,backup:!1,root:!0,backgroundImage:!0,undo:!0},this.nodeCount=0,this.reports={},this.isUndo=!1,this.isRedo=!1,this.trashcan={},this.undoStack=[],this.redoStack=[]},L.prototype.setAdminMode=function(e){this.adminMode=!!e,this.schedule("*:admin",["admin",this.adminMode]),this.triggerEvents()},L.prototype.createIndex=function(){var e,t,i,o,n,a,s,r,l,c=this.tables,d=this.schema;for(e in c)if(c.hasOwnProperty(e)&&(i=c[e],n=d.types[e]))for(t in i)if(i.hasOwnProperty(t)){var h=i[t];t=parseInt(t),this.nodeCount++;for(const e in h)h.hasOwnProperty(e)&&(a=n.fields[e],r=h[e],a&&(a.isField&&"fn"!==a.base?h[e]=a.convert(r):a.isReference&&((o=c[a.refType.id])&&(s=o[r])?(l=s[a.reverse.id])?j(l,t):s[a.reverse.id]=[t]:h[e]=void 0)))}},L.prototype.typeOf=function(e){return this.schema.typeOf(e)},L.prototype.saveSchema=function(e){this.updateSchema(this.schema,(function(t){t&&$.alert(t),e&&e()}))},L.prototype.resetSchema=function(e){var t=Date.now();ui.undoManager.cancel();var i=Date.now();this.setSchema(this.originalSchema);var o=Date.now();this.schedule("*:schema",["schema",!1,!0]);var n=Date.now();this.triggerEvents();var a=Date.now();e&&e();var s=Date.now();console.log("Memdb.resetSchema",i-t,o-i,n-o,a-n,s-a)},L.prototype.updateSchema=function(e,t){if(this.schema.isProtected){if(!this.schemaPassword)return t("No password provided.");if(!this.schema.protectCheckPassword(this.schemaPassword))return t("Wrong password.")}ui.undoManager.cancel();try{var i=e.validate();if(i)return t(i);e.protectUpdated();var o=e.toJSON();if(this.writeUpdateSchema(o),this.schema)for(var n in this.schema.types)this.schema.types.hasOwnProperty(n)&&(e.types[n]||(this.removeTypeFiles(n,(function(e){e&&console.log(e)})),this.typeRemoved(n)));var a=this.views;for(var s in a)if(a.hasOwnProperty(s)){var r=a[s];e.types[r.type]||delete a[s]}var l=this.reports,c=[];for(var s in l)if(l.hasOwnProperty(s)){var d=l[s];e.types[d.tid]||c.push(s)}for(var h=0;h<c.length;h++)this.removeReport(c[h],(function(e){e&&console.log(e)}));this.setSchema(o),this.schedule("*:schema",["schema",!1,!0]),this.triggerEvents(),t()}catch(e){t(e)}},L.prototype.setSchema=function(e){this.schema&&this.schema.off("change",this.schemaChanged,this),this.schema=new schemas.Schema(this,e),this.originalSchema=e,this.schema.on("change",this.schemaChanged,this)},L.prototype.schemaChanged=function(){this.schedule("*:schema",["schema",!0,!1]),this.triggerEvents()},L.prototype.loadNode=function(e,t){t(void 0,this.get(e))},L.prototype.loadNode2=function(e,t,i){i(void 0,this._get(e,t))},L.prototype.loadNodes=function(e,t){t()},L.prototype.loadNodes2=function(e,t,i){i()},L.prototype.loadNodes3=function(e,t,i){i()},L.prototype.loadNodeSync=L.prototype.get=function(e){if(e){var t=F.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=this.tables[i];if(n)return n[o]}}},L.prototype.loadNodeSync2=L.prototype._get=function(e,t){var i=this.tables[e];if(i)return i[t]},L.prototype._begin=function(){0===this._transactionDepth&&(this._undoStack=[]),this._transactionDepth++},L.prototype._commit=function(){this._transactionDepth--,0===this._transactionDepth&&(this._undoStack.length&&ui.undoManager.push({title:locale.dataChange,db:this,exec:this._undo,stack:this._undoStack}),this._undoStack=[],this.triggerEvents())},L.prototype._pushUndoStack=function(e){this._undoStack.push(e)},L.prototype._undo=function(e){var t=this.stack,i=this.db;i.suppressTriggers=!0,i._begin();for(var o=t.length-1;o>=0;o--){var n=t[o];switch(n.op){case"update":i._update(n.nid,n.fid,n.old);break;case"updates":i._updateNodes(n.updates,{});break;case"create":i._remove(n.nid);break;case"remove":i._restoreFromTrash(n.nid)}}i._commit(),i.suppressTriggers=!1,e()},L.prototype._moveToTrash=function(e){var t=e._id,i=util.clone(e);this.trashcan[t]=i,this._pushUndoStack({op:"remove",nid:t}),this._moveFilesToTrash(t)},L.prototype._restoreFromTrash=function(e){var t=F.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=this.schema.types[i];if(n){var a=this.trashcan[e];if(a){delete this.trashcan[e];var s=this.tables[i];s||(s=this.tables[i]=[]),s[o]=a,this._restoreFilesFromTrash(e);var r={};for(var l in a)if(a.hasOwnProperty(l)&&"_"!==l[0]){if(h=n.fields[l]){var c=a[l];(h.isField||h.isReference)&&"fn"!==h.base&&(r[l]=c)}}this.writeCreateNode(i,o,r);var d=n.fields;for(var l in d)if(d.hasOwnProperty(l)){var h;if((h=d[l]).isReference){if(g=a[l])if(m=this._get(h.refType.id,g))(p=m[h.refFieldId])&&j(p,o);else a[l]=void 0}else if(h.isReverse){var p;if((p=a[l])&&p.length>0){for(var u=[],f=0;f<p.length;f++){var m,g=p[f];if(m=this._get(h.refType.id,g)){var v=m._id;m[h.refFieldId]||(m[h.refFieldId]=o,this.writeUpdateReference(h.refType.id,g,h.refFieldId,o),u.push(g),this.schedule(v+":change",["change",v]))}}a[l]=u}}}this._pushUndoStack({op:"create",nid:e}),this.nodeCount++,this.nodeCreated(e),this.schedule("*:create",["create",i,e]),this.schedule(n.id+":create",["create",i,e])}}}},L.prototype.create=function(e,t,i){if("string"==typeof e&&(e=this.schema.types[e]),!e)return i("Type not found");this._begin();var o=this._create(e,t);this._commit(),i(void 0,o)},L.prototype._create=function(e,t){var i=e.id,o=this.tables[i];o||(o=this.tables[i]=[]);var n=this.createRid(i),a=i+n,s=e.create(a,this.user.id,{});o[n]=s;var r={};for(var l in s)if(s.hasOwnProperty(l)&&"_"!==l[0]){var c=e.fields[l];if(c){var d=s[l];(c.isField||c.isReference)&&"fn"!==c.base&&(r[l]=d)}}for(var l in this._pushUndoStack({op:"create",nid:a}),this.writeCreateNode(i,n,r),this.nodeCount++,e.afterCreateExp&&!this.suppressTriggers&&(this.suppressTriggers=!0,e.afterCreateExp.evaluateSync(this,s),this.suppressTriggers=!1),this.schedule("*:create",["create",i,a]),this.schedule(e.id+":create",["create",i,a]),t)if(t.hasOwnProperty(l)){d=t[l];this._update(a,l,d)}return this.nodeCreated(a),s},L.prototype.createRid=function(e){var t=this.nextRid[e];return t||(t=1),this.nextRid[e]=t+1,t},L.prototype.update=function(e,t,i,o){const n=this.schema.typeOf(e);if(!n)return o();var a=n.fields[t];if(!a)return o();if(i=null==i?null:a.convert(i),"memory-global"===a.binding){const n=a.type.id+"."+a.id,s=this.memory[n];if(s!==i||null==s!=(null==i)){this.memory[n]=null==i?void 0:i,this.setDirty();const s=["update",e,t,i];this.schedule("*:update",s),this.schedule(e+":*",s),this.schedule(e+":update",s),this.schedule(e+":update:"+t,s),this.schedule(e+":change",["change",e]),this.schedule("*:change",["change",e]),this.executeMemoryTrigger(a.afterUpdateExp,e,()=>{this.suppressMemoryTriggers||this.triggerEvents(),o&&o()})}else o&&o()}else if("memory-record"===a.binding){const n=e+"."+a.id,s=this.memory[n];if(s!==i||null==s!=(null==i)){this.memory[n]=null==i?void 0:i,this.setDirty();const s=["update",e,t,i];this.schedule("*:update",s),this.schedule(e+":*",s),this.schedule("*:change",["change",e]),this.executeMemoryTrigger(a.afterUpdateExp,e,()=>{this.suppressMemoryTriggers||this.triggerEvents(),o&&o()})}else o&&o()}else this._begin(),this._update(e,t,i),this._commit(),o&&o()},L.prototype.executeMemoryTrigger=function(e,t,i){e?this.suppressMemoryTriggers?i():(this.suppressMemoryTriggers=!0,this.loadNode(nid,(t,o)=>{t&&console.warn(t),e.evaluate(this,o,e=>{this.suppressMemoryTriggers=!1,e&&console.warn(e),i()})})):i()},L.prototype._update=function(e,t,i){var o=F.exec(e);if(o){var n=o[1],a=parseInt(o[2]),s=this.schema.types[n];if(s){var r=s.fields[t];if(r){var l=this.tables[n];if(l){var c=l[a];if(c){i=r.convert(i);var d=c[t],h=!1;if(!P(d,i))if(r.isField&&"fn"!==r.base)c[t]=i,this._pushUndoStack({op:"update",nid:e,fid:t,old:d,val:i}),this.writeUpdateField(n,a,t,i),h=!0;else if(r.isReference)this._updateReference(c,r,i,!1),this._pushUndoStack({op:"update",nid:e,fid:t,old:d,val:i}),this.writeUpdateReference(n,a,t,i),h=!0;else if(r.isReverse){var p={},u={},f=[],m=[];if(i)for(var g=0;g<i.length;g++){(w=parseInt(i[g]))>0&&(p[w]=!0)}if(d)for(g=0;g<d.length;g++){var v=d[g];p[v]?u[v]=!0:m.push(v)}if(i)for(g=0;g<i.length;g++){(w=parseInt(i[g]))>0&&(u[w]||f.push(w))}for(g=0;g<m.length;g++){var y=m[g],b=r.refTypeId+y;this._update(b,r.refFieldId,null)}for(g=0;g<f.length;g++){var w=f[g],x=r.refTypeId+w;this._update(x,r.refFieldId,a)}}if(h&&!this.suppressTriggers&&(this.suppressTriggers=!0,r.afterUpdateExp&&r.afterUpdateExp.evaluateSync(this,c),s.afterUpdateExp&&s.afterUpdateExp.evaluateSync(this,c),this.suppressTriggers=!1),h){this.nodeUpdated(e);var T=["update",e,t,i];this.schedule("*:update",T),this.schedule(e+":*",T),this.schedule(e+":update",T),this.schedule(e+":update:"+t,T),T=["change",e],this.schedule("*:change",T),this.schedule(e+":change",T)}}}}}}},L.prototype._updateReference=function(e,t,i,o){var n=e._id,a=F.exec(n);if(a){a[1];var s=parseInt(a[2]),r=t.id,l=e[r];if(!P(l,i)){var c,d,h;if(l)if(c=this.tables[t.refType.id])if(d=c[l])(h=d[t.reverse.id])&&A(h,s);if(i)if(c=this.tables[t.refType.id])if(d=c[i])(h=d[t.reverse.id])||(h=d[t.reverse.id]=[]),j(h,s);else i=null;else i=null;else i=null;e[r]=i}return i}},L.prototype.updateNodes=function(e,t){var i={};this._begin(),this._updateNodes(e,i),this._commit(),t&&t(void 0,i)},L.prototype._updateNodes=function(e,t){for(var i=this.schema.types,o=this.tables,n=[],a=[],s=[],r=[],l=[],c={},d=0;d<e.length;d++){var h=e[d];if(h._deleted)s.push(h._id);else if(h._id){var p=h._id;if(!($=F.exec(p)))continue;var u=$[1],f=parseInt($[2]);if(!(S=i[u]))continue;if(!(b=o[u]))continue;if(!(w=b[f]))continue;var m={_id:p};for(var g in h)if(h.hasOwnProperty(g)&&"_"!==g[0]){if(!(T=S.fields[g]))continue;var v=h[g],y=w[g];T.isReference?(r.push({tid:u,rid:f,fid:g,val:v}),v):T.isField&&"fn"!==T.base&&(w[g]=T.convert(v)),m[g]=null==y?null:y}a.push(w),l.push(m)}else{var b;if(!(S=i[u=h._type]))continue;(b=o[u])||(b=o[u]=[]);p=u+(f=this.createRid(u));var w=S.create(p,this.user.id,h);for(var g in b[f]=w,h._id=p,h._clientId&&(c[h._clientId]=f,t[h._clientId]=p),h)if(h.hasOwnProperty(g)&&"_"!==g[0]){if((T=S.fields[g])&&T.isReference){v=h[g];r.push({tid:u,rid:f,fid:g,val:v})}}n.push(w);m={_id:p,_deleted:!0};l.push(m)}}for(d=0;d<r.length;d++){var x=r[d],T=(u=x.tid,f=x.rid,g=x.fid,v=x.val,(S=i[u]).fields[g]);w=o[u][f];c[v]&&(v=c[v]),v=this._updateReference(w,T,v,!0),w[g]=v}for(d=0;d<n.length;d++){p=(w=n[d])._id,u=($=F.exec(p))[1],f=parseInt($[2]);var C=(S=i[u]).fields,k={};for(var g in w)if(w.hasOwnProperty(g)&&"_"!==g[0]&&(T=C[g])){v=w[g];(T.isField||T.isReference)&&"fn"!==T.base&&(k[g]=v)}this.writeCreateNode(u,f,k),this.nodeCount++,this.nodeCreated(p)}for(d=0;d<a.length;d++){var $,S;p=(w=a[d])._id,u=($=F.exec(p))[1],f=parseInt($[2]),C=(S=i[u]).fields,k={};for(var g in w)if(w.hasOwnProperty(g)&&"_"!==g[0]&&(T=C[g])){v=w[g];(T.isField||T.isReference)&&"fn"!==T.base&&(k[g]=null==v?null:v)}this.writeUpdateNode(u,f,k),this.nodeUpdated(p)}for(d=0;d<s.length;d++){p=s[d];this._remove(p,!0),this.nodeCount--,this.nodeRemoved(p)}this._pushUndoStack({op:"updates",updates:l}),this.schedule("*:schema",["schema",null,null])},L.prototype.duplicate=function(e,t){var i=this,o={},n=void 0,a=void 0;try{n=s(e,null,null)}catch(e){a=e}function s(t,n,a){if(o[t])return t;o[t]=!0;var r=[],l=F.exec(t);if(!l)throw"Invalid nid: "+t;var c=l[1],d=parseInt(l[2]),h=i._get(c,d);if(!h)throw"Node not found: "+t;var p=i.schema.types[c];if(!p)throw"Type not found: "+c;var u=i.tables[c];u||(u=i.tables[c]=[]);var f=i.createRid(c),m=c+f,g={_id:m};u[f]=g;var v=p.fields;for(var y in v)if(v.hasOwnProperty(y)){var b=v[y];if(b.isField&&"fn"!==b.base&&"file"!==b.base)null!=(k=h[y])&&(g[y]=b.convert(k));else if(b.isReference){if(b.isComposition&&b.type.master===n)i._updateReference(g,b,U(a),!1);else null!=(k=h[y])&&i._updateReference(g,b,k,!1)}else if(b.isReverse&&b.reference.isComposition&&b.reference.type.master===p){var w=h[y];if(w)for(var x=0;x<w.length;x++){var T=b.refTypeId+w[x];r.push(T)}}}var C={};for(var y in g)if(g.hasOwnProperty(y)&&"_"!==y[0]&&(b=p.fields[y])){var k=g[y];(b.isField||b.isReference)&&"fn"!==b.base&&(C[y]=k)}i.writeCreateNode(c,f,C),i.nodeCount++;for(x=0;x<r.length;x++)s(r[x],p,m);return i.nodeCreated(e),i.schedule("*:create",["create",c,m]),i.schedule(c+":create",["create",c,m]),m}i.triggerEvents(),t(a,n)},L.prototype.remove=function(e,t){this._begin(),this._remove(e),this._commit(),t&&t()},L.prototype.removeAll=function(e,t){this._begin();for(var i=0;i<e.length;i++){var o=e[i];this._remove(o,!0)}this.schedule("*:schema",["schema",null,null]),this._commit(),t&&t()},L.prototype._remove=function(e,t){var i=F.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this.schema.types[o];if(a){var s=this.tables[o];if(s){var r=s[n];if(r){this._moveToTrash(r),this.writeRemoveNode(o,n),this.removeNodeFiles(o,n),delete s[n],this.nodeCount--;var l={},c=a.fields;for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];if(h.isReference){if(m=r[d])if(f=this._get(h.refType.id,m))(p=f[h.refFieldId])&&A(p,n)}else if(h.isReverse){var p;if((p=r[d])&&p.length>0)for(var u=0;u<p.length;u++){var f,m=p[u];if(f=this._get(h.refType.id,m)){var g=f._id;h.cascade?l[f._id]=!0:(f[h.refFieldId]=null,this.writeUpdateReference(h.refType.id,m,h.refFieldId,null),t||this.schedule(g+":change",["change",g]))}}}}if(this.nodeRemoved(e),!t){var v=["remove",e];this.schedule("*:remove",v),this.schedule(e+":*",v),this.schedule(e+":remove",v)}for(var g in l)l.hasOwnProperty(g)&&this._remove(g,t)}}}}},L.prototype.selectFindSyncJS=function(e,t,i,o){var n=this.schema.types[e];if(!n)return[];var a=this.tables[e];if(!a)return[];var s=z(i);if(!s.length)return this.selectSyncJS(e,t);for(var r=[],l=[],c=[],d=0;d<s.length;d++){var h=s[d];r[d]=h,l[d]=Number(h),c[d]=util.containsRegExp(h)}var p=n.fields,u=[];for(var f in a)if(a.hasOwnProperty(f)){var m=this._get(e,f),g=m._id;if(t&&!t(m))continue;var v=!0;e:for(d=0;d<c.length;d++){var y=c[d],b=l[d];r[d];if(b!=f){for(var w in m)if(m.hasOwnProperty(w)){var x=m[w];if(null!=x){var T=p[w];if(T&&T.isField)switch(T.base){case"string":case"html":case"file":case"link":case"email":case"phone":if(y.test(x))continue e;break;case"choice":var C=T.values[x];if(C&&y.test(C.caption))continue e;break;case"number":case"date":case"time":case"timestamp":case"timeinterval":case"appointment":case"boolean":if(y.test(T.format(x)))continue e}}}v=!1;break e}}if(v&&(u.push(g),o&&u.length>o))break}return u},L.prototype.loadCalendar=function(e,t,i){var o=[];try{var n,a,s,r,l,c,d,h=e.split("-"),p=t.split("-");"XXXX"===h[0]?(d=!0,n=0,a=parseInt(h[1])-1,s=parseInt(h[2]),r=0,l=parseInt(p[1])-1,c=parseInt(p[2])):(d=!1,n=parseInt(h[0]),a=parseInt(h[1])-1,s=parseInt(h[2]),r=parseInt(p[0]),l=parseInt(p[1])-1,c=parseInt(p[2]),e=new Date(n,a,s).getTime(),t=new Date(r,l,c+1).getTime());var u=this.schema.types;for(var f in u)if(u.hasOwnProperty(f)){var m=u[f].fields,g=[];for(var v in m)if(m.hasOwnProperty(v)){("date"===(T=m[v]).base&&T.dateCalendar||"datx"===T.base&&T.dateCalendar||"appointment"===T.base)&&g.push(T)}if(g.length>0){var y=this.tables[f];if(y)for(var b in y)if(y.hasOwnProperty(b))for(var w=y[b],x=0;x<g.length;x++){var T,C=w[(T=g[x]).id];if(null!=C)if(d){var k;"date"===T.base?k=new Date(C):"datx"===T.base?(k=new Date(C),k=new Date(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate())):"appointment"===T.base&&(k=new Date(parseInt(C)));var $=k.getMonth(),S=k.getDate();if($>=a&&$<=l&&($>a||S>=s)&&($<l||S<=c)){o.push(w._id);continue}}else if("appointment"===T.base&&(C=parseInt(C)),C>=e&&C<t){o.push(w._id);continue}}}}}catch(e){console.warn(e,e.stack)}return i(void 0,o)},L.prototype.loadCalendar2=function(e,t,i,o,n){var a={},s=this.schema.types,r=this.tables,l=new Date;for(var c in s)if(s.hasOwnProperty(c)){var d=r[c];if(!d)continue;var h=s[c].fields,p=[];for(var u in h)if(h.hasOwnProperty(u)){(y=h[u]).dateCalendar&&p.push(y)}if(p.length)for(var f in d)if(d.hasOwnProperty(f))for(var m=d[f],g=c+f,v=0;v<p.length;v++){var y,b=m[(y=p[v]).id];if(null!=b){"appointment"===y.base&&(b=parseInt(b)),l.setTime(b);var w=l.getFullYear(),x=l.getMonth(),T=l.getDate();if((void 0===e||e===w||y.dateYearly)&&(void 0===t||t===x)&&(void 0===i||i===T)){var C=1e4*w+100*(x+1)+T;if(o){var k=a[C];k?k.push(g):a[C]=[g]}else a[C]=!0}}}}n(void 0,a)},L.prototype.loadCalendarFromTo=function(e,t,i){var o=[],n=this.schema.types,a=this.tables,s=new Date,r=e.getTime(),l=t.getTime(),c=(e.getFullYear(),e.getMonth()),d=100*c+e.getDate(),h=(t.getFullYear(),t.getMonth());h<c&&(h+=12);var p=100*h+t.getDate();for(var u in n)if(n.hasOwnProperty(u)){var f=a[u];if(!f)continue;var m=n[u].fields,g=[];for(var v in m)if(m.hasOwnProperty(v)){(T=m[v]).dateCalendar&&g.push(T)}if(g.length)for(var y in f)if(f.hasOwnProperty(y))for(var b=f[y],w=u+y,x=0;x<g.length;x++){var T,C=b[(T=g[x]).id];if(null!=C)if("appointment"===T.base){var k=C.split("/");if(2===k.length){var $=parseInt(k[0]),S=$+parseInt(k[1]);$<=l&&S>=r&&o.push(w)}}else if(T.dateYearly){var _=parseInt(C),E=((s=new Date(_)).getFullYear(),100*s.getMonth()+s.getDate());E>=d&&E<=p&&o.push(w)}else{(_=parseInt(C))>=r&&_<=l&&o.push(w)}}}i(void 0,o)},L.prototype.select=function(e,t){t(void 0,this.selectSync(e))},L.prototype.selectFromTypeWhere=function(e,t,i){var o=this,n=t?t.getSyncJS():void 0,a=n?function(e){return n(n.ctx,o,e)}:void 0;i(void 0,this.selectSyncJS(e,a,void 0))},L.prototype.selectSync=function(e){var t,i=this;try{t=queries.parseSystem(this.schema,void 0,e,{})}catch(e){console.log(e)}if(!t)return[];var o=t.where&&t.where.getSyncJS(),n=o?function(e){return o(o.ctx,i,e)}:void 0,a=t.order&&t.order.getSyncJS(),s=a?function(e){return a(a.ctx,i,e)}:void 0;return this.selectSyncJS(t.type.id,n,s)},L.prototype.selectSyncJS=function(e,t,i){var o=this,n=this.tables[e];if(!n)return[];var a=[];for(var s in n)if(n.hasOwnProperty(s)){var r=n[s];t&&!t(r)||a.push(r._id)}return i&&a.sort((function(e,t){var n=o.loadNodeSync(e),a=o.loadNodeSync(t);if(n){if(a){var s=i(n),r=i(a);return s<r?-1:s>r?1:0}return 1}return a?-1:0})),a},L.prototype.on=function(e,t,i,o){var n=(t||"*")+":"+(e||"*"),a=this.listeners[n];this.listeners[n]=a?this.listeners[n].concat([{f:i,c:o}]):[{f:i,c:o}]},L.prototype.onCreate=function(e,t,i){this.on("create",e,t,i)},L.prototype.onRemove=function(e,t,i){this.on("remove",e,t,i)},L.prototype.onUpdate=function(e,t,i,o){this.on(t?"update:"+t:"update",e,i,o)},L.prototype.onChange=function(e,t,i){this.on("change",e,t,i)},L.prototype.onComment=function(e,t,i){this.on("comment",e,t,i)},L.prototype.onFile=function(e,t,i){this.on("file",e,t,i)},L.prototype.onView=function(e,t){this.on("view",void 0,e,t)},L.prototype.onChat=function(e,t){this.on("chat",void 0,e,t)},L.prototype.off=function(e,t,i,o){var n=(t||"*")+":"+(e||"*"),a=this.listeners[n];if(a){for(var s=[],r=0;r<a.length;r++){var l=a[r];(i&&l.f!==i||o&&l.c!==o)&&s.push(l)}this.listeners[n]=s}else console.log("Inconsistent database.off")},L.prototype.offCreate=function(e,t,i){this.off("create",e,t,i)},L.prototype.offChange=function(e,t,i){this.off("change",e,t,i)},L.prototype.offRemove=function(e,t,i){this.off("remove",e,t,i)},L.prototype.offUpdate=function(e,t,i,o){this.off(t?"update:"+t:"update",e,i,o)},L.prototype.offComment=function(e,t,i){this.off("comment",e,t,i)},L.prototype.offFile=function(e,t,i){this.off("file",e,t,i)},L.prototype.offView=function(e,t){this.off("view",void 0,e,t)},L.prototype.offChat=function(e,t){this.off("chat",void 0,e,t)},L.prototype.schedule=function(e,t){this._schedule.push([e,t])},L.prototype.triggerEvents=function(){var e=this._schedule;this._schedule=[];for(var t,i,o,n=this.listeners,a=0;a<e.length;a++)if(i=e[a][0],o=e[a][1],t=n[i])for(var s=0;s<t.length;s++)t[s].f.apply(t[s].c,o);if(t=this.listeners["*:*"])for(s=0;s<t.length;s++)t[s].f.apply(t[s].c)},L.prototype.setBackground=function(e,t){this.settings.backgroundClass=e,this.writeUpdateSettings(this.settings),ui.updateBackground(),t()},L.prototype.updateSettings=function(e){Object.assign(this.settings,e),this.writeUpdateSettings(this.settings)},L.prototype.fastSearch=function(e,t,i){var o=null;if(e)try{o=queries.parseSystem(this.schema,void 0,e,{})}catch(e){return i(e)}if(!t||"string"!=typeof t)return i(void 0,[]);var n=t.trim().toLocaleLowerCase().split(" ");if(!n.length)return i(void 0,i);for(var a,s=[],r=0;r<n.length;r++){var l=n[r];l.length>0&&s.push(l)}if(!s.length)return i(void 0,i);o?(a={})[o.type.id]=o.type:a=this.schema.types;var c={};e:for(var d in a){var h=[];c[d]=h;var p=a[d];if(!1!==p.globalSearch){var u=this.tables[d];if(u){for(var f=p.fields,m=[],g=0;g<s.length;g++){var v=s[g],y=[];for(var b in m.push(y),/^[1-9][0-9]*$/.test(v)&&y.push({fid:"_id",mode:0,value:parseInt(v)}),f){var w=f[b];if(!1!==w.globalSearch)switch(w.base){case"string":case"html":case"email":case"phone":case"link":($=util.containsRegExp(v))&&y.push({fid:b,mode:1,re:$});break;case"number":if(/^\-?[0-9\.\,]*$/.test(v))if(null!=(H=w.parseEditor(v))&&!isNaN(H))H=String(H),($=util.startsWithRegExp(H))&&y.push({fid:b,mode:1,re:$});break;case"boolean":v==locale.yes.toLocaleLowerCase()?y.push({fid:b,mode:3,value:!0}):v==locale.no.toLowerCase()&&y.push({fid:b,mode:3,value:!1});break;case"choice":if($=util.containsRegExp(v)){var x={},T=0;for(var C in w.values)if(w.values.hasOwnProperty(C)){var k=w.values[C];$.test(k.caption)&&(x[C]=!0,T++)}T&&y.push({fid:b,mode:4,values:x})}break;case"multi":var $;if($=util.containsRegExp(v)){x={},T=0;for(var C in w.values)if(w.values.hasOwnProperty(C)){k=w.values[C];$.test(k.caption)&&(x[C]=!0,T++)}if(T){var S=[];for(var _ in x)x.hasOwnProperty(_)&&S.push(parseInt(_));S.sort((function(e,t){return e-t})),y.push({fid:b,mode:6,choices:S})}}break;case"date":case"datx":case"timestamp":case"appointment":var E=/^(?:(?:([0-9]{1,2})[\.\-\/])?([0-9]{1,2})[\.\-\/])?([0-9]{2,4})$/.exec(v);if(E){var D,N,I=parseInt(E[3]);if(E[3].length<4&&(I=I<50?2e3+I:1900+I),E[2]){var O=parseInt(E[2]);if(E[1]){var M=parseInt(E[1]);D="datx"===w.base?Date.UTC(I,O-1,M):new Date(I,O-1,M).getTime(),N="datx"===w.base?Date.UTC(I,O-1,M+1):new Date(I,O-1,M+1).getTime()}else D="datx"===w.base?Date.UTC(I,O-1,1):new Date(I,O-1,1).getTime(),N="datx"===w.base?Date.UTC(I,O,1):new Date(I,O,1).getTime()}else D="datx"===w.base?Date.UTC(I,0,1):new Date(I,0,1).getTime(),N="datx"===w.base?Date.UTC(I+1,0,1):new Date(I+1,0,1).getTime();"appointment"===w.base?y.push({fid:b,mode:5,min:D,max:N}):y.push({fid:b,mode:2,min:D,max:N})}}}if(!y.length)continue e}if(m.length)for(var F in u){var L=u[F];F=parseInt(F);var j=!0;t:for(var A=0;A<m.length;A++){y=m[A];var P=!1;i:for(var U=0;U<y.length;U++){var H,z=y[U];if(null!=(H=L[z.fid])&&""!==H)switch(z.mode){case 0:if(z.value===F){P=!0;break i}break;case 1:if(z.re.test(H)){P=!0;break i}break;case 2:if(H>=z.min&&H<z.max){P=!0;break i}break;case 3:if(H==z.value){P=!0;break i}break;case 4:if(z.values[H]){P=!0;break i}break;case 5:var V=parseInt(H);if(V>=z.min&&V<z.max){P=!0;break i}break;case 6:if(R(z.choices,H)){P=!0;break i}}}if(!P){j=!1;break t}}if(j&&(h.push(F),h.length>100))continue e}}}}i(void 0,c)},L.prototype.getRowIds=function(e){var t=this.tables[e];if(!t)return[];var i=[];for(var o in t)t.hasOwnProperty(o)&&i.push(parseInt(o));return i},L.prototype.typeRemoved=function(e){},L.prototype.nodeCreated=function(e){},L.prototype.nodeUpdated=function(e){},L.prototype.nodeRemoved=function(e){},L.prototype.evaluateOnServer=function(e,t,i){t.evaluate(this,this.get(e),(function(e,t){e?$.alert(e):i(t)}))};const V=schemas.RE_NID,W=(schemas.RE_NID_FID,schemas.RE_FILE_REF);let B=Date.now();function q(e){this.account=e,this.clientId=cloudFileSystem.clientId(),this.owner=null,this._writeBuffer="",this.views={},this.originalViews={},this.memory={},this._cachedValues={},this.init()}function Y(e){var t=V.exec(e);if(t)return parseInt(t[2])}function X(e,t){var i=new FileReader;i.onerror=function(){t(i.error||"Unknown error")},i.onloadend=function(e){var o=i.result,n=o.indexOf(",");if(-1===n)t("Invalid URL format");else{var a=o.substr(n+1);t(void 0,a)}},i.readAsDataURL(e)}Object.assign(q.prototype,L.prototype),q.prototype.cloud=!0,q.prototype.location="cloud",q.prototype.getUniqueID=function(){return"cloud."+this.id},q.prototype.closeDatabase=function(e){var t=this;t.calendarSync&&(t.calendarSync.destroy(),t.calendarSync=null),t.schema&&t.schema.off("change",t.schemaChanged,t),t.saveEverything((function(){t.init(),e()}))},q.prototype.descriptor=function(){return{id:this.id,name:this.name,cloud:!0,location:"cloud",account:"local",settings:this.settings}},q.prototype.createDatabase=async function(e,t){var i=this,o=e.name,n=e.icon,a=e.color;i.id=util.createLowerUUID(16),i.name=o,i.owner=i.clientId,i.seq={file:0,pos:0,seq:0},i.sequences={},i.sequences[i.clientId]=i.seq,i.nextRid={},i.tables={},i.settings={icon:n,color:a},i.adminEnabled=!0,i.setSchema({version:1,nextTypeId:1,nextRoleId:1,types:{},roles:{admin:{caption:"admin",roles:[]}}}),i.views={},i.originalViews={};try{await cloudFileSystem.mkdir("data/"+i.id),await cloudFileSystem.mkdir("data/"+i.id+"/sync"),await cloudFileSystem.mkdir("data/"+i.id+"/views"),await cloudFileSystem.mkdir("data/"+i.id+"/files"),await cloudFileSystem.writeFile("data/"+i.id+"/schema.json",JSON.stringify(i.originalSchema),"utf8"),await cloudFileSystem.writeFile("data/"+i.id+"/config.json",JSON.stringify({name:i.name,owner:i.owner}),"utf8"),await cloudFileSystem.writeFile("data/"+i.id+"/settings.json",JSON.stringify(i.settings),"utf8"),i._writeBuffer="",setTimeout(t,0)}catch(e){t(e)}},q.prototype.openDatabase=async function(e,t,i){var o=this;o.readOnly=t;var n,a,s,r,l,c={},d={},h={},p={},u={},f={},m={},g={},v=!1,y=Date.now(),b=y;o._loadTiming={};try{await w(),b=Date.now(),o._loadTiming.loadConfig=b-y,y=b,await x(),b=Date.now(),o._loadTiming.loadSettings=b-y,y=b,await T(),b=Date.now(),o._loadTiming.loadSchema=b-y,y=b,await C(),b=Date.now(),o._loadTiming.loadViews=b-y,y=b,await S(),b=Date.now(),o._loadTiming.loadReports=b-y,y=b,await _(),b=Date.now(),o._loadTiming.loadMaster=b-y,y=b,await D(),b=Date.now(),o._loadTiming.loadSyncs=b-y,y=b,await F(),b=Date.now(),o._loadTiming.applySyncs=b-y,y=b,R(),b=Date.now(),o._loadTiming.buildIndex=b-y,y=b,await L(),b=Date.now(),o._loadTiming.done=b-y,y=b,i()}catch(e){i(e)}async function w(){try{const t=await cloudFileSystem.readFile("data/"+e+"/config.json","utf8"),i=JSON.parse(t);a=i.name,n=i.owner,v=n===o.clientId}catch(e){console.log(e)}}async function x(){try{const t=await cloudFileSystem.readFile("data/"+e+"/settings.json","utf8");s=JSON.parse(t)}catch(e){console.log(e)}}async function T(){const t=await cloudFileSystem.readFile("data/"+e+"/schema.json","utf8").catch(()=>"{}");l=JSON.parse(t),r=new schemas.Schema(o,l)}async function C(){try{const t=await cloudFileSystem.listFiles("data/"+e+"/views");for(const e of t)await $(e)}catch(e){console.log(e)}}async function $(t){try{const i=await cloudFileSystem.readFile("data/"+e+"/views/"+t,"utf8"),o=JSON.parse(i);r.types[o.type]&&(p[t]=util.getPersistentView(o))}catch(e){console.log(e)}}async function S(){try{var t=o.reports={};const i=await cloudFileSystem.listFiles("data/"+e+"/reports");for(const o of i){const i=await cloudFileSystem.readFile("data/"+e+"/reports/"+o+"/report.json","utf8"),n=JSON.parse(i);n.id=o,t[o]=n}}catch(e){console.log(e)}}async function _(){let t="";try{t=await cloudFileSystem.readFile("data/"+e+"/data.db","utf8")}catch(e){console.log("Couldn't load data.db with exception: "+e)}E(t)}function E(e){for(var t,i,o,n,a=r.types,s=0,l=0,d=0,p=0,f=0,m="",g="",v=0,y="",b="";-1!==(l=e.indexOf("\n",s));){try{switch(m=e.substring(s,l),s=l+1,m[0]){case"c":if(-1===(d=m.indexOf(":",1)))break;if(-1===(p=m.indexOf(":",d+1)))break;if(g=m.substring(1,d),y=m.substring(d+1,p),i=JSON.parse(m.substring(p+1).normalize("NFC")),!a[g])break;(n=h[g])||(n=h[g]={}),void 0===(v=c[g])&&(v=1),c[g]=v+1,(o=i)._uu=y,o._id=g+v,n[y]=o;break;case"u":if(-1===(d=m.indexOf(":",1)))break;if(-1===(p=m.indexOf(":",d+1)))break;if(-1===(f=m.indexOf(":",p+1)))break;if(g=m.substring(1,d),y=m.substring(d+1,p),b=m.substring(p+1,f),t=JSON.parse(m.substring(f+1).normalize("NFC")),!a[g])break;if(!(n=h[g]))break;if(!(o=n[y]))break;o[b]=t;break;case"U":if(-1===(d=m.indexOf(":",1)))break;if(-1===(p=m.indexOf(":",d+1)))break;if(g=m.substring(1,d),y=m.substring(d+1,p),i=JSON.parse(m.substring(p+1).normalize("NFC")),!a[g])break;if(!(n=h[g]))break;if(!(o=n[y]))break;for(b in i)i.hasOwnProperty(b)&&(o[b]=i[b]);break;case"r":if(-1===(d=m.indexOf(":",1)))break;if(g=m.substring(1,d),y=m.substring(d+1),!(n=h[g]))break;delete n[y];break;case"S":u=JSON.parse(m.substring(1))}}catch(e){console.log(e)}s=l+1}}async function D(){try{const t=await cloudFileSystem.listFiles("data/"+e+"/sync");for(const e of t)await N(e)}catch(e){console.log(e)}}async function N(t){try{var i=u[t];if(i||(i=u[t]={file:0,pos:0,seq:0}),!(await cloudFileSystem.stats("data/"+e+"/sync/"+t+"/"+i.file)).isFile)return;for(await I(t,i);;){if(!(await cloudFileSystem.stats("data/"+e+"/sync/"+t+"/"+(i.file+1))).isFile)break;i.file++,i.pos=0,await I(t,i)}}catch(e){console.log(e)}}async function I(t,i){let o=await cloudFileSystem.readFile("data/"+e+"/sync/"+t+"/"+i.file,"utf8");try{o=o.substring(i.pos);var n=M(o,i);i.pos+=n}catch(e){console.log(e)}}function M(e,t){for(var i,o,n,a,s,l,d=r.types,h=0,p=0,u=0,v=0,y=0,b="",w="",x=0,T="",C="";-1!==(p=e.indexOf("\n",h));)try{switch(b=e.substring(h,p),h=p+1,b[0]){case"c":if(-1===(u=b.indexOf(":",1)))break;if(-1===(v=b.indexOf(":",u+1)))break;w=b.substring(1,u),T=b.substring(u+1,v);try{o=JSON.parse(b.substring(v+1))}catch(e){console.log(e);break}if(!d[w])break;(a=f[w])||(a=f[w]={}),void 0===(x=c[w])&&(x=1),c[w]=x+1,(n=o)._uu=T,n._id=w+x,a[T]=n,(a=g[w])&&a[T]&&delete a[T];break;case"u":if(-1===(u=b.indexOf(":",1)))break;if(-1===(v=b.indexOf(":",u+1)))break;if(-1===(y=b.indexOf(":",v+1)))break;if(w=b.substring(1,u),T=b.substring(u+1,v),C=b.substring(v+1,y),i=JSON.parse(b.substring(y+1)),!d[w])break;(a=m[w])||(a=m[w]={}),(s=a[T])||(s=a[T]=[]),(l={})[C]=i,s.push({seq:t.seq,idx:s.length,upd:l});break;case"U":if(-1===(u=b.indexOf(":",1)))break;if(-1===(v=b.indexOf(":",u+1)))break;if(-1===(y=b.indexOf(":",v+1)))break;w=b.substring(1,u),T=b.substring(u+1,v);try{o=JSON.parse(b.substring(v+1))}catch(e){console.log(e);break}if(!d[w])break;(a=m[w])||(a=m[w]={}),(s=a[T])||(s=a[T]=[]),s.push({seq:t.seq,idx:s.length,upd:o});break;case"r":if(-1===(u=b.indexOf(":",1)))break;if(w=b.substring(1,u),T=b.substring(u+1),!d[w])break;(a=g[w])||(a=g[w]={}),a[T]=!0;break;case"s":i=parseInt(parseInt(b.substring(1))),isNaN(i)||(t.seq=i)}}catch(e){console.log(e)}return h}async function F(){var i=r.types,o="";for(var n in f)if(f.hasOwnProperty(n)){var a=f[n];if(!(b=i[n]))continue;var s=h[n];for(var l in s||(s=h[n]={}),a)if(a.hasOwnProperty(l)){var c=a[l];if(s[l]=c,v&&!t){var d={};for(var p in c)if(c.hasOwnProperty(p)&&"_"!==p[0]){var y=b.fields[p];y&&(y.isField&&"fn"!==y.base||y.isReference)&&(d[p]=c[p])}o+="c"+n+":"+l+":"+JSON.stringify(d)+"\n"}}}for(var n in m)if(m.hasOwnProperty(n)){var b,w=m[n];if(!(b=i[n]))continue;if(!(s=h[n]))continue;for(var l in w)if(w.hasOwnProperty(l)){var x=w[l];if(x.sort((function(e,t){var i=e.seq-t.seq;return 0===i?e.idx-t.idx:i})),!(c=s[l]))continue;d={};for(var T=0;T<x.length;T++){var C=x[T].upd;for(var p in C)C.hasOwnProperty(p)&&(d[p]=c[p]=C[p])}v&&!t&&(o+="U"+n+":"+l+":"+JSON.stringify(d)+"\n")}}for(var n in g)if(g.hasOwnProperty(n)){var k=g[n];if(!(s=h[n]))continue;for(var l in k)k.hasOwnProperty(l)&&!0===k[l]&&(delete s[l],v&&!t&&(o+="r"+n+":"+l+"\n"))}v&&!t&&o.length>0&&(o+="S"+JSON.stringify(u)+"\n",await cloudFileSystem.appendFile("data/"+e+"/data.db",o,"utf8"))}function R(){try{var e=r.types;for(var t in h)if(h.hasOwnProperty(t)){var i=h[t],n=e[t];if(!n)continue;var a=[];for(var s in n.fields)if(n.fields.hasOwnProperty(s)){var l=n.fields[s];l.isReference&&a.push(l)}var c=d[t];for(var p in c||(c=d[t]={}),i)if(i.hasOwnProperty(p)){var u=i[p],f=Y(u._id);c[f]=u,o.nodeCount++;for(var m=0;m<a.length;m++){var g=a[m],v=u[g.id];if(v){var y=h[g.refTypeId];if(y){var b=y[v];if(b){var w=b[g.refFieldId];if(w){var x=k.sortedIndex(w,f);w.splice(x,0,f)}else b[g.refFieldId]=[f];u[g.id]=Y(b._id)}else u[g.id]=null}else u[g.id]=null}}}}}catch(e){console.log(e)}}async function L(){var i=Date.now(),h=0;for(var f in u)if(u.hasOwnProperty(f)){var m=u[f];m.seq>h&&(h=m.seq)}for(var g in o.seq=u[o.clientId],o.seq||(o.seq={file:0,pos:0,seq:0}),o.seq.seq=h+1,o.sequences=u,o.nextRid=c,o.tables=d,o.id=e,o.name=a,o.owner=n,o.settings=s,o.schema=r,o.originalSchema=l,o.schema.on("change",o.schemaChanged,o),o.adminEnabled=n===o.clientId,o.originalViews=p,o.views={},p)p.hasOwnProperty(g)&&(o.views[g]=util.getPersistentView(p[g]));if(t)B=Date.now();else{var v=Date.now();await cloudFileSystem.mkdir("data/"+e+"/sync/"+o.clientId);var y=Date.now();const t=await cloudFileSystem.stats("data/"+e+"/sync/"+o.clientId+"/"+o.seq.file);var b=Date.now();t.isFile&&t.size>4194304&&(o.seq.file++,o.seq.pos=0),o._writeBuffer="";var w=Date.now();await o.writeEntry("s"+o.seq.seq);var x=Date.now();cloudFileSystem.startDownloadAll("data/"+e).catch(()=>{}).then(()=>{});var T=Date.now();B=Date.now(),o.calendarSync=new O(o),o.calendarSync.init();var C=Date.now();o._loadTiming.doneDetails=[v-i,y-v,b-y,w-b,x-w,T-x,C-T]}}},q.prototype.writeUpdateSchema=function(e){if(!this.readOnly)return this.owner!==this.clientId?$.alert("Data model can only be changed on the device, the database has been created on."):void cloudFileSystem.writeFile("data/"+this.id+"/schema.json",JSON.stringify(e),"utf8").catch(e=>console.log(e))},q.prototype.writeCreateNode=function(e,t,i){if(!this.readOnly){var o=this._get(e,t);if(!o)throw"Node not found "+e+t;o._uu||(o._uu=util.createUUID(12));var n=this.schema.types[e];if(!n)throw"Type not found "+e;var a={};for(var s in i)if(i.hasOwnProperty(s)){var r=i[s],l=n.fields[s];if(l)if(l.isReference)if(r){var c=this._get(l.refTypeId,r);c?(c._uu||(c._uu=util.createUUID(12)),a[s]=c._uu):a[s]=null}else a[s]=null;else a[s]=r}this.writeEntry("c"+e+":"+o._uu+":"+JSON.stringify(a))}},q.prototype.writeRemoveNode=function(e,t){if(!this.readOnly){var i=this._get(e,t);if(!i)throw"Node not found "+e+t;i._uu&&this.writeEntry("r"+e+":"+i._uu)}},q.prototype.writeUpdateNode=function(e,t,i){if(!this.readOnly){var o=this._get(e,t);if(!o)throw"Node not found "+e+t;o._uu||(o._uu=util.createUUID(12));var n=this.schema.types[e];if(!n)throw"Type not found "+e;var a={};for(var s in i)if(i.hasOwnProperty(s)){var r=i[s],l=n.fields[s];if(l)if(l.isReference)if(r){var c=this._get(l.refTypeId,r);c?(c._uu||(c._uu=util.createUUID(12)),a[s]=c._uu):a[s]=null}else a[s]=null;else a[s]=r}this.writeEntry("U"+e+":"+o._uu+":"+JSON.stringify(a))}},q.prototype.writeUpdateField=function(e,t,i,o){if(!this.readOnly){var n=this._get(e,t);if(!n)throw"Node not found "+e+t;n._uu||(n._uu=util.createUUID(12)),this.writeEntry("u"+e+":"+n._uu+":"+i+":"+JSON.stringify(void 0===o?null:o))}},q.prototype.writeUpdateReference=function(e,t,i,o){if(!this.readOnly){var n=this._get(e,t);if(!n)throw"Node not found "+e+t;if(n._uu||(n._uu=util.createUUID(12)),null==o)this.writeEntry("u"+e+":"+n._uu+":"+i+":null");else{var a=this.schema.types[e];if(!a)throw"Type not found "+e;var s=a.fields[i];if(!s)throw"Field not found "+e+"."+i;var r=this._get(s.refTypeId,o);if(!r)throw"Ref node not found "+e+o;r._uu||(r._uu=util.createUUID(12)),this.writeEntry("u"+e+":"+n._uu+":"+i+":"+JSON.stringify(r._uu))}}},q.prototype.removeTypeFiles=function(e){this.readOnly||cloudFileSystem.remove("data/"+this.id+"/files/"+e).catch(e=>{})},q.prototype.removeNodeFiles=function(e,t){if(!this.readOnly){var i=this._get(e,t);i&&cloudFileSystem.remove("data/"+this.id+"/files/"+e+"/"+i._uu).catch(e=>{})}},q.prototype.writeUpdateSettings=function(e){if(!this.readOnly){var t=this;cloudFileSystem.writeFile("data/"+t.id+"/settings.json",JSON.stringify(e),"utf8").catch(e=>console.log(e))}},q.prototype.writeEntry=function(e){if(!this.readOnly){var t=this;if(t._writeError)throw t._writeError;t._writeBuffer+=e+"\n",t._writing||(t._writing=!0,setTimeout(i,0))}async function i(){var e=t._writeBuffer;if(e){t._writeBuffer="";try{await cloudFileSystem.appendFile("data/"+t.id+"/sync/"+t.clientId+"/"+t.seq.file,e,"utf8"),setTimeout(i,0)}catch(e){t._writeError=e}}else t._writing=!1}},q.prototype.thumbURL1=function(e){if(e){var t=W.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=t[3],a=this._get(i,o);if(a){var s=n.substring(0,n.lastIndexOf("."))+".jpg",r=cloudFileSystem.proxyUbiquityUrl();return r?r+"/data/"+this.id+"/files/"+i+"/"+a._uu+"/.thumb_"+encodeURIComponent(s)+"?T="+B:void 0}}}},q.prototype.thumbURL2=function(e,t){if(t){var i=V.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this._get(o,n);if(a){var s=t.substring(0,t.lastIndexOf("."))+".jpg",r=cloudFileSystem.proxyUbiquityUrl();return r?r+"/data/"+this.id+"/files/"+o+"/"+a._uu+"/.thumb_"+encodeURIComponent(s)+"?T="+B:void 0}}}},q.prototype.thumb2URL1=function(e){if(e){var t=W.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=t[3],a=this._get(i,o);if(a){var s=n.substring(0,n.lastIndexOf("."))+".jpg",r=cloudFileSystem.proxyUbiquityUrl();return r?r+"/data/"+this.id+"/files/"+i+"/"+a._uu+"/.thumb2_"+encodeURIComponent(s)+"?T="+B:void 0}}}},q.prototype.thumb2URL2=function(e,t){if(t){var i=V.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this._get(o,n);if(a){var s=t.substring(0,t.lastIndexOf("."))+".jpg",r=cloudFileSystem.proxyUbiquityUrl();return r?r+"/data/"+this.id+"/files/"+o+"/"+a._uu+"/.thumb2_"+encodeURIComponent(s)+"?T="+B:void 0}}}},q.prototype.fileURL1=function(e){if(e){var t=W.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=t[3],a=this._get(i,o);if(a){var s=cloudFileSystem.proxyUbiquityUrl();return s?s+"/data/"+this.id+"/files/"+i+"/"+a._uu+"/"+encodeURIComponent(n)+"?T="+B:void 0}}}},q.prototype.serverFileURL1=q.prototype.fileURL1,q.prototype.fileURL2=function(e,t){if(t){var i=V.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this._get(o,n);if(a){var s=cloudFileSystem.proxyUbiquityUrl();return s?s+"/data/"+this.id+"/files/"+o+"/"+a._uu+"/"+encodeURIComponent(t)+"?T="+B:void 0}}}},q.prototype.previewURL1=q.prototype.downloadURL1=function(e){if(e){var t=W.exec(e);if(t){var i=t[1],o=t[2],n=t[3],a=this._get(i,o);if(a){var s=cloudFileSystem.ubiquityUrl();return s?s+"/data/"+this.id+"/files/"+i+"/"+a._uu+"/"+encodeURIComponent(n)+"?T="+B:void 0}}}},q.prototype.downloadURL=q.prototype.previewURL=function(e,t){var i=V.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this._get(o,n);if(a){var s=cloudFileSystem.ubiquityUrl();return s?s+"/data/"+this.id+"/files/"+o+"/"+a._uu+"/"+encodeURIComponent(t)+"?T="+B:void 0}}},q.prototype.previewFile=function(e,t){var i=V.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this._get(o,n);if(a){var s=cloudFileSystem.ubiquityUrl()+"/data/"+this.id+"/files/"+o+"/"+a._uu+"/"+encodeURIComponent(t);NinoxDocumentInteraction.previewDocument(s,(function(){}))}}},q.prototype.countFiles=async function(e){var t=V.exec(e);if(!t)return!1;var i=t[1],o=parseInt(t[2]),n=this._get(i,o);if(!n)return!1;var a=this.schema.types[i];if(a){var s=a.fields,r={};for(var l in s)if(s.hasOwnProperty(l)){if("file"===s[l].base){var c=n[l];c&&(r[c.normalize("NFC")]=!0)}}return await cloudFileSystem.countFiles("data/"+this.id+"/files/"+i+"/"+n._uu,r)}},q.prototype.loadFiles=async function(e,t){var i=V.exec(e);if(!i)return t("Invalid nid "+e);var o=i[1],n=parseInt(i[2]),a=this._get(o,n);if(!a)return t(void 0,[]);try{const e=await cloudFileSystem.listFiles("data/"+this.id+"/files/"+o+"/"+a._uu);for(var s=[],r=0;r<e.length;r++)s.push({name:e[r]});t(void 0,s)}catch(e){return t(e)}},q.prototype.removeFile=function(e,t,i){if(this.readOnly)return i("Write-protected");var o=V.exec(e);if(!o)return i("Invalid nid "+e);var n=o[1],a=parseInt(o[2]),s=this._get(n,a);if(!s)return i();cloudFileSystem.removeFileAndThumbs("data/"+this.id+"/files/"+n+"/"+s._uu+"/"+t,[".thumb_",".thumb2_"]).then(()=>i()).catch(e=>i(e))},q.prototype.saveFile=function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=this,a=V.exec(e);if(!a)return o("Invalid nid "+e);var s=a[1],r=parseInt(a[2]),l=this._get(s,r);if(!l)return o("Node not found");X(t,(async function(e,t){if(e)return o(e);try{await cloudFileSystem.mkdir("data/"+n.id+"/files/"+s+"/"+l._uu),await cloudFileSystem.writeFileBase64("data/"+n.id+"/files/"+s+"/"+l._uu+"/"+i,t),B++,o()}catch(e){o(e)}}))},q.prototype.saveFileBase64=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=this,a=V.exec(e);if(!a)return o("Invalid nid "+e);var s=a[1],r=parseInt(a[2]),l=this._get(s,r);if(!l)return o("Node not found");l._uu||(l._uu=util.createUUID(12));try{await cloudFileSystem.mkdir("data/"+n.id+"/files/"+s+"/"+l._uu),await cloudFileSystem.writeFileBase64("data/"+n.id+"/files/"+s+"/"+l._uu+"/"+i,t),B++,o()}catch(e){o(e)}},q.prototype.saveFileDataURL=function(e,t,i,o){var n=t.split(",")[1];if(!n)return o("Invalid data");this.saveFileBase64(e,n,i,o)},q.prototype.setBackgroundFile=function(e,t){if(this.readOnly)return t("Write-protected");var i=this;if(!/\.jpg|\.jpeg$/i.test(e.name))return t(locale.backgroundFileMustBeJPEG);var o="data/"+this.id+"/background.jpg";X(e,(async function(e,n){if(e)return t(e);try{await cloudFileSystem.writeFileBase64(o,n),B++,i.setBackground("background-file",t)}catch(e){t(e)}}))},q.prototype.backgroundURL=function(e){return cloudFileSystem.proxyUbiquityUrl()+"data/"+this.id+"/background.jpg?T="+B},q.prototype.loadViews=function(e){e(void 0,this.views)},q.prototype.saveView=function(e,t){if(this.readOnly)return t("Write-protected");this.views[e.id];this.views[e.id]=e,t()},q.prototype.removeView=function(e,t){if(this.readOnly)return t("Write-protected");this.views[e]&&delete this.views[e],t()},q.prototype.saveViews=async function(e){if(this.readOnly)return e();var t=this,i=this.originalViews,o=this.views,n={},a=[],s=[];for(var r in o)if(o.hasOwnProperty(r)){var l=o[r],c=i[r],d=util.getPersistentView(l);n[r]=d,util.viewEquals(d,c)||s.push(d)}for(var r in i)if(i.hasOwnProperty(r)){c=i[r];(l=o[r])||a.push(r)}this.originalViews=n;for(const e in s){const i=s[e];await cloudFileSystem.writeFile("data/"+t.id+"/views/"+i.id,JSON.stringify(i),"utf8").catch(e=>console.log(e))}for(const e in a){const i=a[e];await cloudFileSystem.remove("data/"+t.id+"/views/"+i).catch(e=>console.log(e))}e()},q.prototype.importFile=async function(e,t,i){var o=this;if(this.readOnly)return i("Write-protected");var n=V.exec(e);if(!n)return i("Invalid nid "+e);var a=n[1],s=parseInt(n[2]),r=this._get(a,s);if(!r)return i("Node not found "+e);if("string"==typeof t)try{const e=await cloudFileSystem.importFile(t,"data/"+this.id+"/files/"+a+"/"+r._uu);B++,i(void 0,e)}catch(e){i(e)}else"object"==typeof t?X(t,(async function(e,n){if(e)return i(e);try{await cloudFileSystem.writeFileBase64("data/"+o.id+"/files/"+a+"/"+r._uu+"/"+t.name,n),B++,i(void 0,t.name)}catch(e){i(e)}})):i("Invalid parameter: file")},q.prototype.importFileFromURL=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=V.exec(e);if(!n)return o("Invalid nid "+e);var a=n[1],s=parseInt(n[2]),r=this._get(a,s);if(!r)return o("Node not found "+e);if(i=i.normalize("NFC"),!util.isValidFileName(i))return o("Unsupported file name: "+JSON.stringify(i));try{await cloudFileSystem.downloadFile(t,"data/"+this.id+"/files/"+a+"/"+r._uu+"/"+i),B++,o(void 0,i)}catch(e){return o(e)}},q.prototype.importData=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=V.exec(t);if(!n)return o("Invalid nid "+t);var a=n[1],s=parseInt(n[2]),r=this._get(a,s);if(!r)return o("Node not found "+t);try{await cloudFileSystem.importData(e,"data/"+this.id+"/files/"+a+"/"+r._uu+"/"+i),B++,o()}catch(e){o(e)}},q.prototype.renameFile=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=V.exec(e);if(!n)return o("Invalid nid "+e);var a=n[1],s=parseInt(n[2]),r=this._get(a,s);if(!r)return o("Node not found "+e);var l="data/"+this.id+"/files/"+a+"/"+r._uu+"/"+t,c="data/"+this.id+"/files/"+a+"/"+r._uu+"/"+i;try{await cloudFileSystem.removeThumbs(l,[".thumb_",".thumb2_"]).catch(e=>console.log(e)),await cloudFileSystem.move(l,c),B++,o()}catch(e){o(e)}},q.prototype.listReports=function(e){e(void 0,this.reports)},q.prototype.updateReport=async function(e,t){if(this.readOnly)return t("Write-protected");var i=this;try{await cloudFileSystem.mkdir("data/"+i.id+"/reports/"+e.id),await cloudFileSystem.writeFile("data/"+i.id+"/reports/"+e.id+"/report.json",JSON.stringify(e),"utf8"),i.reports[e.id]=e,t()}catch(e){t(e)}},q.prototype.removeReport=async function(e,t){if(this.readOnly)return t("Write-protected");var i=this;try{await cloudFileSystem.remove("data/"+i.id+"/reports/"+e),delete i.reports[e],t()}catch(e){t(e)}},q.prototype.importReportFile=async function(e,t,i){if(this.readOnly)return i("Write-protected");try{const o=await cloudFileSystem.importFileWithName(t,"data/"+this.id+"/reports/"+e+"/files",util.createLowerUUID(12));B++,i(void 0,o)}catch(e){i(e)}},q.prototype.saveReportFile=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=this;X(t,(async function(t,a){if(t)return o(t);try{await cloudFileSystem.writeFileBase64("data/"+n.id+"/reports/"+e+"/files/"+i,a),B++,o()}catch(t){o(t)}}))},q.prototype.removeReportFile=async function(e,t,i){if(this.readOnly)return i("Write-protected");try{await cloudFileSystem.remove("data/"+this.id+"/reports/"+e+"/files/"+t),i()}catch(e){i(e)}},q.prototype.cleanReportFiles=async function(e,t,i){if(this.readOnly)return i("Write-protected");var o=this;try{const i=await cloudFileSystem.listFiles("data/"+o.id+"/reports/"+e+"/files");for(let n of i)t[n]||await cloudFileSystem.remove("data/"+o.id+"/reports/"+e+"/files/"+n).catch(e=>{})}catch(e){}i()},q.prototype.copyReportFiles=async function(e,t,i){if(this.readOnly)return i("Write-protected");var o=this;try{const n=await cloudFileSystem.listFiles("data/"+o.id+"/reports/"+e+"/files");if(!n||!n.length)return i();await cloudFileSystem.mkdir("data/"+o.id+"/reports/"+t+"/files");for(let i of n)await cloudFileSystem.copyFromCloud("data/"+o.id+"/reports/"+e+"/files/"+i,"data/"+o.id+"/reports/"+t+"/files/"+i).catch(()=>{});B++}catch(e){}i()},q.prototype.reportFileURL=function(e,t){var i=cloudFileSystem.ubiquityUrl();return i?i+"/data/"+encodeURIComponent(this.id)+"/reports/"+encodeURIComponent(e)+"/files/"+encodeURIComponent(t):void 0},q.prototype.reportFileURLProxy=function(e,t){var i=cloudFileSystem.proxyUbiquityUrl();return i?i+"/data/"+encodeURIComponent(this.id)+"/reports/"+encodeURIComponent(e)+"/files/"+encodeURIComponent(t):void 0},q.prototype.reportFileServerURL=q.prototype.reportFileURL,q.prototype.saveEverything=function(e){if(this.readOnly)return e();this.saveViews(e)},q.prototype._moveFilesToTrash=function(e){var t=V.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=this._get(i,o);if(n){var a=n._uu,s="data/"+this.id+"/files/"+i+"/"+a,r=".trash/"+this.id+"/files/"+i+"/"+a;cloudFileSystem.moveToLocal(s,r).catch(e=>$.alert(e))}}},q.prototype._restoreFilesFromTrash=function(e){var t=V.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=this._get(i,o);if(n){var a=n._uu,s=".trash/"+this.id+"/files/"+i+"/"+a,r="data/"+this.id+"/files/"+i+"/"+a;cloudFileSystem.moveFromLocal(s,r).catch(e=>$.alert(e))}}};const G=schemas.RE_NID,J=schemas.RE_NID_FID,K=schemas.RE_FILE_REF;let Q=Date.now();function Z(e){this.account=e,this.fileHandle=void 0,this.isOpen=!1,this.views={},this.originalViews={},this.documentDirectory="",this._writeCallbacks=[],this._writeBuffer="",this._writing=!1,this.memory={},this._cachedValues={},this.init()}function ee(e,t){var i=k.sortedIndex(e,t);e[i]!==t&&e.splice(i,0,t)}function te(e,t){var i=new FileReader;i.onerror=function(){t(i.error||"Unknown error")},i.onloadend=function(e){var o=i.result,n=o.indexOf(",");if(-1===n)t("Invalid URL format");else{var a=o.substr(n+1);t(void 0,a)}},i.readAsDataURL(e)}function ie(e,t,i){var o=t.name,n=!1!==t.includeData,a=!1!==t.includeFiles,s={id:o,name:o,local:!0,account:"local"},r="data/"+e.id,l="data/"+s.name,c="",d={},h=new q;h.openDatabase(e.id,!0,(async function(e){if(e)return i(e);try{await localFileSystem.mkdir(l),t(),await localFileSystem.writeFile(l+"/data.db",c,"utf8"),await m(),await o(),n&&a&&await p(),i(void 0,s)}catch(e){localFileSystem.remove(l).catch(e=>console.log(e)).then(()=>i(e))}function t(){c+="s:"+JSON.stringify(h.originalSchema)+"\n",c+="O:"+JSON.stringify(h.settings)+"\n";var e=h.schema,t=h.views;for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];c+="V"+i+":"+JSON.stringify(o)+"\n"}if(n){var a=h.tables;for(var s in a)if(a.hasOwnProperty(s)){var r=a[s],l=e.types[s];if(l)for(var p in r)if(r.hasOwnProperty(p)){var u=r[p];if(u){d[u._uu]=p;var f={};for(var m in u)if(u.hasOwnProperty(m)&&"_"!==m[0]){var g=u[m];if(null!=g){var v=l.fields[m];v&&(v.isReference||v.isField&&"fn"!==v.base)&&(f[m]=g)}}c+="U"+s+p+":"+JSON.stringify(f)+"\n"}}}}}async function o(){return u("reports")}async function p(){return await f()}async function u(e){if(!await cloudFileSystem.exists(r+"/"+e).catch(()=>!1))return;if(!await localFileSystem.mkdir(l+"/"+e).then(()=>!0).catch(()=>!1))return;const t=await cloudFileSystem.listFiles(r+"/"+e).catch(()=>null);if(t&&t.length)for(let i of t){const t=await cloudFileSystem.stats(r+"/"+e+"/"+i).catch(()=>null);t&&(t.isFile?await cloudFileSystem.copyToLocal(r+"/"+e+"/"+i,l+"/"+e+"/"+i):t.isDirectory&&await u(e+"/"+i))}}async function f(){if(await localFileSystem.mkdir(l+"/files"),!await cloudFileSystem.exists(r+"/files").catch(()=>!1))return;const e=await cloudFileSystem.listFiles(r+"/files");for(let t of e){const e=await cloudFileSystem.listFiles(r+"/files/"+t);for(let i of e){const e=d[i];if(void 0===e)continue;const o=await cloudFileSystem.listFiles(r+"/files/"+t+"/"+i);for(let n of o)await cloudFileSystem.copyToLocal(r+"/files/"+t+"/"+i+"/"+n,l+"/files/"+t+"/"+e+"/"+n)}}}async function m(){await cloudFileSystem.exists(r+"/background.jpg")&&await cloudFileSystem.copyToLocal(r+"/background.jpg",l+"/background.jpg")}}))}function oe(e,t,i){var o=t.name,n=!1!==t.includeData,a=!1!==t.includeFiles,s={id:o,name:o,local:!0},r="data/"+e.id,l="data/"+s.name,c="",d=new Z;d.openDatabase(e,!0,(async function(e){if(e)return i(e);try{await localFileSystem.mkdir(l),t(),await localFileSystem.writeFile(l+"/data.db",c,"utf8"),await o(),await h(),n&&a&&await p(),i(void 0,s)}catch(e){localFileSystem.remove(l).catch(e=>console.log(e)).then(()=>i(e))}function t(){c+="s:"+JSON.stringify(d.originalSchema)+"\n",c+="O:"+JSON.stringify(d.settings)+"\n";var e=d.schema,t=d.views;for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];c+="V"+i+":"+JSON.stringify(o)+"\n"}if(n){var a=d.tables;for(var s in a)if(a.hasOwnProperty(s)){var r=a[s],l=e.types[s];if(l)for(var h in r)if(r.hasOwnProperty(h)){var p=r[h];if(p){var u={};for(var f in p)if(p.hasOwnProperty(f)&&"_"!==f[0]){var m=p[f];if(null!=m){var g=l.fields[f];g&&(g.isReference||g.isField&&"fn"!==g.base)&&(u[f]=m)}}c+="U"+s+h+":"+JSON.stringify(u)+"\n"}}}}}async function o(){await localFileSystem.exists(r+"/background.jpg")&&await localFileSystem.copy(r+"/background.jpg",l+"/background.jpg")}async function h(e){await localFileSystem.exists(r+"/reports")&&await localFileSystem.copy(r+"/reports",l+"/reports")}async function p(){await localFileSystem.exists(r+"/files")&&await localFileSystem.copy(r+"/files",l+"/files")}}))}function ne(e,t,i){var o=new Z;o.openDatabase(e,!0,(function(e){if(e)return i(e);se(o,t,(function(e,t){o.closeDatabase((function(){i(e,t)}))}))}))}function ae(e,t,i){var o=new q;o.openDatabase(e.id,!0,(function(e){if(e)return i(e);se(o,t,(function(e,t){o.closeDatabase((function(){i(e,t)}))}))}))}async function se(e,t,i){var o,n=t.name,a=!1!==t.includeData,s=!1!==t.includeFiles;if(e.local)o=!1;else{if(!e.cloud)return i("Unknown database type");o=!0}var r=util.createLowerUUID(16),l="data/"+e.id,c="data/"+r,d=e.schema,h=e.originalSchema,p={},u={id:r,name:n,owner:cloudFileSystem.clientId()},f=util.clone(e.settings);t.icon&&(f.icon=t.icon),t.color&&(f.color=t.color);try{if(await cloudFileSystem.writeFile(c+"/config.json",JSON.stringify(u),"utf8"),await cloudFileSystem.writeFile(c+"/settings.json",JSON.stringify(f),"utf8"),await cloudFileSystem.writeFile(c+"/schema.json",JSON.stringify(h),"utf8"),await m(),await T(),await g(),a){let e=C();await cloudFileSystem.writeFile(c+"/data.db",e,"utf8"),s&&await v()}i(void 0,{id:r,name:n,cloud:!0,account:"local"})}catch(e){cloudFileSystem.remove(c).catch(e=>console.log(e)).then(()=>i(e))}async function m(){const t=k.toArray(e.views);for(let e of t)await cloudFileSystem.writeFile(c+"/views/"+e.id,JSON.stringify(e),"utf8")}async function g(e){o?await b("reports",e):await x("reports",e)}async function v(){o?await y():await w()}async function y(){if(await cloudFileSystem.mkdir(c+"/files"),await cloudFileSystem.exists(l+"/files")){const e=await cloudFileSystem.listFiles(l+"/files");for(let t of e){const e=await cloudFileSystem.listFiles(l+"/files/"+t);for(let i of e){const e=await cloudFileSystem.listFiles(l+"/files/"+t+"/"+i);for(let o of e)await cloudFileSystem.copyFromCloud(l+"/files/"+t+"/"+i+"/"+o,c+"/files/"+t+"/"+i+"/"+o)}}}}async function b(e){try{if(await cloudFileSystem.exists(l+"/"+e)){await cloudFileSystem.mkdir(c+"/"+e);const t=await cloudFileSystem.listFiles(l+"/"+e);for(let i of t){const t=await cloudFileSystem.stats(l+"/"+e+"/"+i).catch(()=>null);t&&(t.isFile?await cloudFileSystem.copyFromCloud(l+"/"+e+"/"+i,c+"/"+e+"/"+i).catch(()=>{}):t.isDirectory&&await b(e+"/"+i))}}}catch(e){console.log(e)}}async function w(){if(await cloudFileSystem.mkdir(c+"/files"),await localFileSystem.exists(l+"/files")){const e=await localFileSystem.listFiles(l+"/files");for(let t of e){const e=await localFileSystem.listFiles(l+"/files/"+t);for(let i of e){const e=await localFileSystem.listFiles(l+"/files/"+t+"/"+i);for(let o of e){const e=p[t+i];await cloudFileSystem.copyFromLocal(l+"/files/"+t+"/"+i+"/"+o,c+"/files/"+t+"/"+e+"/"+o)}}}}}async function x(e){try{if(await localFileSystem.exists(l+"/"+e)){await cloudFileSystem.mkdir(c+"/"+e);const t=await localFileSystem.listFiles(l+"/"+e);for(const i of t){const t=await localFileSystem.stats(l+"/"+e+"/"+i).catch(e=>{throw new Error(e)});t&&(t.isFile?await cloudFileSystem.copyFromLocal(l+"/"+e+"/"+i,c+"/"+e+"/"+i).catch(e=>{throw new Error(e)}):t.isDirectory&&await x(e+"/"+i))}}}catch(e){console.log(e)}}async function T(){o?await cloudFileSystem.exists(l+"/background.jpg")&&await cloudFileSystem.copyFromCloud(l+"/background.jpg",c+"/background.jpg"):await localFileSystem.exists(l+"/background.jpg")&&await cloudFileSystem.copyFromLocal(l+"/background.jpg",c+"/background.jpg")}function C(){var t,i,o,n,a,s="",r=e.tables;for(t in r)if(r.hasOwnProperty(t))for(o in i=r[t])i.hasOwnProperty(o)&&(a=(n=i[o])._uu||util.createUUID(12),p[n._id]=a);for(t in r)if(r.hasOwnProperty(t)){i=r[t];var l=d.types[t];if(!l)continue;var c=[];for(o in i)i.hasOwnProperty(o)&&c.push(parseInt(o));c.sort((function(e,t){return e-t}));for(var h=0;h<c.length;h++){n=i[o=c[h]],a=p[n._id];var u={};for(var f in n)if(n.hasOwnProperty(f)){var m=n[f];if(null!=m){var g=l.fields[f];if(g)if(g.isReference){var v=r[g.refTypeId];if(v){var y=v[m];y&&(u[f]=p[y._id])}}else g.isField&&"fn"!==g.base&&(u[f]=m)}}s+="c"+t+":"+a+":"+JSON.stringify(u)+"\n"}}return s}}function re(e,t){this.dbms=e,this.accountId=t,this.localDatabases={},this.cloudDatabases={},this.name=locale.myDatabases,this._syncCallbacks=[],this._syncInProgress=!1,this.sync()}Object.assign(Z.prototype,L.prototype),Z.prototype.local=!0,Z.prototype.location="local",Z.prototype.getUniqueID=function(){return"local."+this.id},Z.prototype.closeDatabase=function(e){var t=this;async function i(){t.calendarSync&&(t.calendarSync.destroy(),t.calendarSync=null),t.fileHandle&&(await localFileSystem.close(t.fileHandle),t.fileHandle=void 0),t.isOpen=!1,t.init(),e()}t.schema&&t.schema.off("change",t.schemaChanged,t),t.isOpen?t.saveEverything(i):i()},Z.prototype.descriptor=function(){return{id:this.id,name:this.name,local:!0,location:"local",account:"local",settings:this.settings}},Z.prototype.openDatabase=async function(e,t,i){try{this.documentDirectory=localFileSystem.getDocumentDirectory();var o=this,n={},a=e.icon,s=e.color;o.id=e.name,o.name=e.name,o.readOnly=t;var r="data/"+e.name,l=o.nextRid={},c=o.tables={},d=0,h=0,p=!1,u=null;try{var f=await localFileSystem.readFile(r+"/settings.json","utf8");f&&(u=JSON.parse(f))}catch(e){console.log("Failed to parse settings.json",e)}if(await localFileSystem.exists(r+"/data.bak"))w(r+"/data.bak",(function(e){if(e)return y(e);t?b():m((function(e){if(e)return y(e);g((async function(e){if(e)return y(e);await localFileSystem.remove(r+"/data.bak"),b()}))}))}));else{await localFileSystem.exists(r+"/data.db")?w(r+"/data.db",(async function(e){if(e)return y(e);t?b():d>h+5e3?(await localFileSystem.move(r+"/data.db",r+"/data.bak"),m((function(e){if(e)return y(e);g((async function(e){if(e)return y(e);await localFileSystem.remove(r+"/data.bak"),b()}))}))):m((function(e){if(e)return y(e);b()}))})):m((function(e){if(e)return y(e);v(),g((function(e){if(e)return y(e);b()}))}))}}catch(e){y(e)}async function m(e){try{const t=await localFileSystem.openForAppend(r+"/data.db");o.fileHandle=t,e()}catch(t){e(t)}}async function g(e){let t=void 0;try{await localFileSystem.truncate(o.fileHandle),await x()}catch(e){t=e}e(t)}function v(){o.setSchema({version:1,nextTypeId:1,nextRoleId:1,types:{},roles:{admin:{caption:"admin",roles:[]}}})}function y(e){alert("Failed to open database: "+e),o.closeDatabase((function(){i(e)}))}async function b(){try{for(var e in u||(u={icon:a,color:s},p=!0),p&&await localFileSystem.writeFile(r+"/settings.json",JSON.stringify(u),"utf8"),o.settings=u,o.originalViews=n,o.views={},n)n.hasOwnProperty(e)&&(o.views[e]=util.getPersistentView(n[e]));o.loadReports((function(){t||(o.calendarSync=new O(o),o.calendarSync.init()),o.isOpen=!0,i()}))}catch(e){console.log("localdb.openDatabase.done",e),i(e)}}async function w(e,t){var i;c=o.tables={},l=o.nextRid={};var a="",s=Date.now(),r=s,f=s,m=s,g=s;try{const i=await localFileSystem.readFile(e,"utf8");r=Date.now(),v(i),f=Date.now(),b(),m=Date.now(),w(),g=Date.now(),o._loadTiming={"Read file":r-s,"Parse file":f-r,"Init schema":m-f,"Create index":g-m,Total:g-s},t()}catch(e){t(e)}function v(e){for(var t=0,i=0,o=void 0;;){if(-1===(i=e.indexOf("\n",t))){a+=e.substring(t);break}var n=y(a+=e.substring(t,i));n&&!o&&(o=n),a="",t=i+1,d++}return o}function y(e){var t,o,a,s,r,d,f,m,g,v,y,b,w;try{if(m=e[0],(g=e.indexOf(":"))<1)throw"Invalid line format";if(v=e.substring(1,g),y=e.substring(g+1).normalize("NFC"),b=JSON.parse(y),"#"===m){if("NINOXDB_BATCH_V1"!==b)throw'Unsupported file format or version: "'+b+'"';b}switch(m){case"U":if(!(w=G.exec(v)))throw"Invalid nid (U) "+v+' at "'+e+'"';for(a in t=w[1],o=parseInt(w[2]),l[t]=l[t]>o?l[t]:o+1,s=b,(d=c[t])||(d=c[t]=[]),(f=d[o])||(f=d[o]={_id:t+o},h++),s)s.hasOwnProperty(a)&&(r=s[a],f[a]=r);break;case"u":if(!(w=J.exec(v)))throw"Invalid nid/fid (u) "+v+' at "'+e+'"';t=w[1],o=parseInt(w[2]),a=w[3],l[t]=l[t]>o?l[t]:o+1,r=b,(d=c[t])||(d=c[t]=[]),(f=d[o])||(f=d[o]={_id:t+o},h++),f[a]=r;break;case"r":if(!(w=G.exec(v)))throw"Invalid nid (r) "+v+' at "'+e+'"';t=w[1],o=parseInt(w[2]),l[t]=l[t]>o?l[t]:o+1,(d=c[t])&&d[o]&&(delete d[o],h--);break;case"s":i=b;break;case"V":null===b?delete n[v]:n[v]=util.getPersistentView(b);break;case"O":"object"==typeof b&&(u||(u=b,p=!0))}}catch(e){console.log(e)}}function b(){i?o.setSchema(i):o.setSchema({version:1,nextTypeId:1,nextRoleId:1,types:{},roles:{admin:{caption:"admin",roles:[]}}})}function w(){var e,t,i,n,a,s,r,l,d,h,p,u,f,m;for(e in c)if(c.hasOwnProperty(e)&&(i=c[e],a=o.schema.types[e])){for(f in u=[],h=a.fields)h.hasOwnProperty(f)&&(p=h[f]).isReference&&u.push(p);for(t in i)if(i.hasOwnProperty(t))for(s=i[t],t=parseInt(t),o.nodeCount++,m=0;m<u.length;m++)n=p=u[m],(l=s[f=p.id])&&(l=parseInt(l),isNaN(l)?s[f]=void 0:(n=c[p.refType.id])&&(r=n[l])?(d=r[p.reverse.id])?ee(d,t):r[p.reverse.id]=[t]:s[f]=void 0)}}}async function x(){var e,t,i,a,s,r,l,d,h;for(var p in await o.writeEntry('#:"NINOXDB_BATCH_V1"'),await o.writeEntry("s:"+JSON.stringify(o.schema.toJSON())),await o.writeEntry("O:"+JSON.stringify(o.settings||{})),n)if(n.hasOwnProperty(p)){var u=n[p];await o.writeEntry("V"+p+":"+JSON.stringify(u))}for(e in c)if(c.hasOwnProperty(e)&&(s=c[e],r=o.schema.types[e]))for(t in s)if(s.hasOwnProperty(t)){for(i in h={},d=s[t])d.hasOwnProperty(i)&&"_"!==i[0]&&(l=r.fields[i])&&(a=d[i],(l.isField||l.isReference)&&(h[i]=a));await o.writeEntry("U"+e+t+":"+JSON.stringify(h))}await o.flush()}},Z.prototype.writeUpdateSchema=function(e){this.readOnly||this.writeEntry("s:"+JSON.stringify(e),()=>{})},Z.prototype.writeCreateNode=function(e,t,i){this.readOnly||this.writeEntry("U"+e+t+":"+JSON.stringify(i),()=>{})},Z.prototype.writeRemoveNode=function(e,t){this.readOnly||this.writeEntry("r"+e+t+":null",()=>{})},Z.prototype.writeUpdateNode=function(e,t,i){this.readOnly||this.writeEntry("U"+e+t+":"+JSON.stringify(i),()=>{})},Z.prototype.writeUpdateField=function(e,t,i,o){this.readOnly||this.writeEntry("u"+e+t+i+":"+JSON.stringify(void 0===o?null:o),()=>{})},Z.prototype.writeUpdateReference=function(e,t,i,o){this.readOnly||this.writeEntry("u"+e+t+i+":"+JSON.stringify(void 0===o?null:o),()=>{})},Z.prototype.removeTypeFiles=function(e){this.readOnly||localFileSystem.remove("data/"+this.name+"/files/"+e)},Z.prototype.removeNodeFiles=function(e,t){this.readOnly||localFileSystem.remove("data/"+this.name+"/files/"+e+"/"+t)},Z.prototype.writeUpdateView=function(e){this.readOnly||this.writeEntry("V"+e.id+":"+JSON.stringify(e))},Z.prototype.writeRemoveView=function(e){this.readOnly||this.writeEntry("V"+e+":null")},Z.prototype.writeUpdateSettings=function(e){if(!this.readOnly){var t=JSON.stringify(this.settings);this.writeEntry("O:"+t),localFileSystem.writeFile("data/"+this.name+"/settings.json",t,"utf8").catch(e=>console.log(e))}},Z.prototype.writeEntry=async function(e){this.readOnly||(this._writeBuffer=this._writeBuffer+e+"\n",this._write(),this._writeBuffer.length>16777216&&await this.flush())},Z.prototype._write=function(e){const t=this;if(e&&this._writeCallbacks.push(e),this._writing)return;if(this._writing=!0,!this._writeBuffer)return o();const i=this._writeBuffer;return this._writeBuffer="",localFileSystem.write(this.fileHandle,i).then(()=>{o()}).catch(e=>{o(e)});function o(){const e=t._writeCallbacks;t._writeCallbacks=[],t._writing=!1;for(var i=0;i<e.length;i++)setTimeout(e[i],0);t._writeBuffer&&setTimeout((function(){t._write()}),0)}},Z.prototype.flush=function(){return new Promise(e=>{this._write(e)})},Z.prototype.previewURL1=Z.prototype.downloadURL1=function(e){if(e){var t=K.exec(e);if(t){var i=t[1],o=t[2],n=t[3];return this.documentDirectory+"/data/"+encodeURIComponent(this.name)+"/files/"+i+"/"+o+"/"+encodeURIComponent(n)+"?T="+Q}}},Z.prototype.previewURL=Z.prototype.downloadURL=function(e,t){var i=G.exec(e);if(i){var o=i[1],n=parseInt(i[2]);return this.documentDirectory+"/data/"+encodeURIComponent(this.name)+"/files/"+o+"/"+n+"/"+encodeURIComponent(t)+"?T="+Q}},Z.prototype.thumbURL1=function(e){if(e){var t=K.exec(e);if(t){var i=t[1],o=t[2],n=t[3],a=encodeURIComponent(n.substring(0,n.lastIndexOf("."))+".jpg");return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/files/"+i+"/"+o+"/.thumb_"+a+"?T="+Q}}},Z.prototype.thumbURL2=function(e,t){if(t){var i=G.exec(e);if(i){var o=i[1],n=i[2],a=encodeURIComponent(t.substring(0,t.lastIndexOf("."))+".jpg");return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/files/"+o+"/"+n+"/.thumb_"+a+"?T="+Q}}},Z.prototype.thumb2URL1=function(e){if(e){var t=K.exec(e);if(t){var i=t[1],o=t[2],n=t[3],a=encodeURIComponent(n.substring(0,n.lastIndexOf("."))+".jpg");return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/files/"+i+"/"+o+"/.thumb2_"+a+"?T="+Q}}},Z.prototype.thumb2URL2=function(e,t){if(t){var i=G.exec(e);if(i){var o=i[1],n=i[2],a=encodeURIComponent(t.substring(0,t.lastIndexOf("."))+".jpg");return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/files/"+o+"/"+n+"/.thumb2_"+a+"?T="+Q}}},Z.prototype.fileURL1=function(e){if(e){var t=K.exec(e);if(t){var i=t[1],o=t[2],n=t[3];return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/files/"+i+"/"+o+"/"+encodeURIComponent(n)+"?T="+Q}}},Z.prototype.serverFileURL1=Z.prototype.fileURL1,Z.prototype.fileURL2=function(e,t){if(t){var i=G.exec(e);if(i){var o=i[1],n=i[2];return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/files/"+o+"/"+n+"/"+encodeURIComponent(t)+"?T="+Q}}},Z.prototype.previewFile=function(e,t){var i=G.exec(e);if(i){var o=i[1],n=parseInt(i[2]);try{var a=this.documentDirectory+"/data/"+encodeURIComponent(this.id)+"/files/"+o+"/"+n+"/"+encodeURIComponent(t);NinoxDocumentInteraction.previewDocument(a,(function(){}))}catch(e){return console.log("localdb.previewFile",e),""}}},Z.prototype.countFiles=async function(e){var t=G.exec(e);if(!t)return!1;var i=t[1],o=parseInt(t[2]),n=this._get(i,o);if(!n)return!1;var a=this.schema.types[i];if(a){var s=a.fields,r={};for(var l in s)if(s.hasOwnProperty(l)){if("file"===s[l].base){var c=n[l];c&&(r[c.normalize("NFC")]=!0)}}try{return await localFileSystem.countFiles("data/"+this.name+"/files/"+i+"/"+o,r)}catch(e){return console.log("localdb.countFiles",e),0}}},Z.prototype.loadFiles=async function(e,t){var i=G.exec(e);if(!i)return t("Invalid nid "+e);var o=i[1],n=parseInt(i[2]);try{const e=await localFileSystem.listFiles("data/"+this.name+"/files/"+o+"/"+n);for(var a=[],s=0;s<e.length;s++)a.push({name:e[s]});t(void 0,a)}catch(e){t(e)}},Z.prototype.removeFile=async function(e,t,i){if(this.readOnly)return i("Write-protected");var o=G.exec(e);if(!o)return i("Invalid nid "+e);var n=o[1],a=parseInt(o[2]);await localFileSystem.removeFileAndThumbs("data/"+this.name+"/files/"+n+"/"+a+"/"+t,[".thumb_",".thumb2_"]),i()},Z.prototype.saveFile=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=this,a=G.exec(e);if(!a)return o("Invalid nid "+e);var s=a[1],r=parseInt(a[2]);te(t,(async function(e,t){if(e)return o(e);try{await localFileSystem.writeFileBase64("data/"+n.name+"/files/"+s+"/"+r+"/"+i,t),Q++,setTimeout(o,0)}catch(e){return setTimeout(o,0,e)}}))},Z.prototype.saveFileBase64=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=this,a=G.exec(e);if(!a)return o("Invalid nid "+e);var s=a[1],r=parseInt(a[2]);try{await localFileSystem.mkdir("data/"+n.name+"/files/"+s+"/"+r),await localFileSystem.writeFileBase64("data/"+n.name+"/files/"+s+"/"+r+"/"+i,t),Q++,setTimeout(o,0)}catch(e){setTimeout(o,0,e)}},Z.prototype.saveFileDataURL=function(e,t,i,o){var n=t.split(",")[1];if(!n)return o("Invalid data");this.saveFileBase64(e,n,i,o)},Z.prototype.setBackgroundFile=async function(e,t){if(this.readOnly)return t("Write-protected");var i=this,o=await localFileSystem.fileURL("data/"+this.name+"/background.jpg");if(!/\.jpg|\.jpeg$/i.test(e.name))return t(locale.backgroundFileMustBeJPEG);te(e,(async function(e,n){if(e)return t(e);try{await localFileSystem.writeURLBase64(o,n),Q++,i.setBackground("background-file",t)}catch(e){return t(e)}}))},Z.prototype.backgroundURL=function(e){return localFileSystem.getDocumentDirectoryProxy()+"/data/"+this.name+"/background.jpg?T="+Q},Z.prototype.importFile=async function(e,t,i){if(this.readOnly)return i("Write-protected");var o=G.exec(e);if(!o)return i("Invalid nid "+e);var n=o[1],a=parseInt(o[2]);if(!this._get(n,a))return i("Node not found "+e);var s=this.name;if("string"==typeof t){const e=await localFileSystem.importFile(t,"data/"+s+"/files/"+n+"/"+a);i(null,e)}else"object"==typeof t?te(t,(async function(e,o){if(e)return i(e);try{await localFileSystem.writeFileBase64("data/"+s+"/files/"+n+"/"+a+"/"+t.name,o),Q++,i(void 0,t.name)}catch(e){return i(e)}})):i("Missing argument: file")},Z.prototype.importFileFromURL=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=G.exec(e);if(!n)return o("Invalid nid "+e);var a=n[1],s=parseInt(n[2]);if(!this._get(a,s))return o("Node not found "+e);var r=this.name;if(i=i.normalize("NFC"),!util.isValidFileName(i))return o("Unsupported file name: "+JSON.stringify(i));try{await localFileSystem.downloadFile(t,"data/"+r+"/files/"+a+"/"+s+"/"+i),Q++,o(void 0,i)}catch(e){return o(e)}},Z.prototype.importData=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=G.exec(t);if(!n)return o("Invalid nid "+t);var a=n[1],s=parseInt(n[2]);if(!this._get(a,s))return o("Node not found "+t);try{const t=await localFileSystem.importData(e,"data/"+this.name+"/files/"+a+"/"+s+"/"+i);Q++,o(null,t)}catch(e){o(e)}},Z.prototype.renameFile=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=G.exec(e);if(!n)return o("Invalid nid "+e);var a=n[1],s=parseInt(n[2]);if(!this._get(a,s))return o("Node not found "+e);var r="data/"+this.name+"/files/"+a+"/"+s+"/"+t,l="data/"+this.name+"/files/"+a+"/"+s+"/"+i;try{await localFileSystem.removeThumbs(r,[".thumb_",".thumb2_"]),await localFileSystem.move(r,l),Q++,o()}catch(e){o(e)}},Z.prototype.listReports=function(e){e(void 0,this.reports)},Z.prototype.loadReports=async function(e){var t=this;let i;try{i=await localFileSystem.listFiles("data/"+this.name+"/reports")}catch(e){console.log("localdb.loadReports",e)}var o=t.reports={};if(!i)return setTimeout(e,0,void 0,o);async function n(a){if(a>=i.length)setTimeout(e,0,void 0,o);else{var s=i[a];try{const e=await localFileSystem.readFile("data/"+t.name+"/reports/"+s+"/report.json","utf8");var r=JSON.parse(e);r.id=s,o[s]=r}catch(e){console.info("LocalDB.loadReports => Failed while loading reports",e)}(a+1)%100==0?setTimeout(n,0,a+1):n(a+1)}}n(0)},Z.prototype.updateReport=async function(e,t){if(this.readOnly)return t("Write-protected");var i=this;try{await localFileSystem.mkdir("data/"+i.name+"/reports/"+e.id),await localFileSystem.writeFile("data/"+i.name+"/reports/"+e.id+"/report.json",JSON.stringify(e),"utf8"),i.reports[e.id]=e,t()}catch(e){return t(e)}},Z.prototype.removeReport=async function(e,t){if(this.readOnly)return t("Write-protected");var i=this;try{await localFileSystem.remove("data/"+this.name+"/reports/"+e),delete i.reports[e],t()}catch(e){return t(e)}},Z.prototype.importReportFile=async function(e,t,i){if(this.readOnly)return i("Write-protected");try{const o=await localFileSystem.importFileWithName(t,"data/"+this.name+"/reports/"+e+"/files",util.createLowerUUID(12));Q++,i(void 0,o)}catch(e){return i(e)}},Z.prototype.saveReportFile=function(e,t,i,o){if(this.readOnly)return o("Write-protected");var n=this;te(t,(async function(t,a){if(t)return o(t);try{await localFileSystem.writeFileBase64("data/"+n.name+"/reports/"+e+"/files/"+i,a),Q++,setTimeout(o,0)}catch(t){return setTimeout(o,0,t)}}))},Z.prototype.removeReportFile=async function(e,t,i){if(this.readOnly)return i("Write-protected");await localFileSystem.remove("data/"+this.name+"/reports/"+e+"/files/"+t),i()},Z.prototype.cleanReportFiles=async function(e,t,i){if(this.readOnly)return i("Write-protected");var o=this;try{const a=await localFileSystem.listFiles("data/"+o.name+"/reports/"+e+"/files");if(err||!a)return i();async function n(s){try{if(s>=a.length)return i();var r=a[s];t[r]||await localFileSystem.remove("data/"+o.name+"/reports/"+e+"/files/"+r),(s+1)%100==0?setTimeout(n,0,s+1):n(s+1)}catch(e){console.log("localdb.cleanReportFiles",e)}}n(0)}catch(e){return setTimeout(i,0,e)}},Z.prototype.copyReportFiles=async function(e,t,i){if(this.readOnly)return i("Write-protected");var o=this;try{const a=await localFileSystem.listFiles("data/"+o.name+"/reports/"+e+"/files");if(!a||!a.length)return i();async function n(s){if(s>=a.length)return Q++,i();var r=a[s];try{await localFileSystem.copy("data/"+o.name+"/reports/"+e+"/files/"+r,"data/"+o.name+"/reports/"+t+"/files/"+r),(s+1)%100==0?setTimeout(n,0,s+1):n(s+1)}catch(e){console.log("localdb.copyReportFiles.next",e)}}await localFileSystem.mkdir("data/"+o.name+"/reports/"+t+"/files"),n(0)}catch(e){console.log("localdb.copyReportFiles",e),i()}},Z.prototype.reportFileURL=function(e,t){return localFileSystem.getDocumentDirectory()+"/data/"+encodeURIComponent(this.name)+"/reports/"+encodeURIComponent(e)+"/files/"+encodeURIComponent(t)},Z.prototype.reportFileURLProxy=function(e,t){return localFileSystem.getDocumentDirectoryProxy()+"/data/"+encodeURIComponent(this.name)+"/reports/"+encodeURIComponent(e)+"/files/"+encodeURIComponent(t)},Z.prototype.reportFileServerURL=Z.prototype.reportFileURL,Z.prototype.saveEverything=function(e){if(this.readOnly)return e();this.saveViews(()=>{this.flush().catch(()=>{console.warn(err)}).then(e)})},Z.prototype.loadViews=function(e){e(void 0,this.views)},Z.prototype.saveView=function(e,t){if(this.readOnly)return t("Write-protected");this.views[e.id]=e,t()},Z.prototype.removeView=function(e,t){if(this.readOnly)return t("Write-protected");this.views[e]&&delete this.views[e],t()},Z.prototype.saveViews=function(e){if(this.readOnly)return e("Write-protected");var t=this.originalViews,i=this.views,o={};for(var n in i)if(i.hasOwnProperty(n)){var a=i[n],s=t[n],r=util.getPersistentView(a);o[n]=r,util.viewEquals(r,s)||this.writeUpdateView(r)}for(var n in t)if(t.hasOwnProperty(n)){s=t[n];(a=i[n])||this.writeRemoveView(n)}this.originalViews=o,e()},Z.prototype.loadCustom=async function(e){var t=this,i="data/"+t.name+"/custom/init.js";try{if(!await localFileSystem.exists(i))return e();const o=await localFileSystem.readFile(i,"utf8");try{t.customInitSRC=o,t.customInit=new Function(o)}catch(e){alert(e)}e()}catch(t){console.log("localFileSystem.loadCustom",t),e()}},Z.prototype.saveCustom=async function(e,t){if(this.readOnly)return t("Write-protected");var i=this,o="data/"+i.name+"/custom",n="data/"+i.name+"/custom/init.js";try{await localFileSystem.mkdir(o),await localFileSystem.writeFile(n,e,"utf8"),setTimeout(t,0)}catch(e){return setTimeout(t,0,e)}},Z.prototype._moveFilesToTrash=async function(e){var t=G.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n="data/"+this.name+"/files/"+i+"/"+o,a=".trash/"+this.name+"/files/"+i+"/"+o;try{await localFileSystem.move(n,a)}catch(e){$.alert(e)}}},Z.prototype._restoreFilesFromTrash=async function(e){var t=G.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n="data/"+this.name+"/files/"+i+"/"+o,a=".trash/"+this.name+"/files/"+i+"/"+o;try{await localFileSystem.move(a,n)}catch(e){$.alert(e)}}},Object.assign(re.prototype,util.events),re.prototype.base="local",re.prototype.id="local",re.prototype.createLocalDBFromCloudDB=ie,re.prototype.createLocalDBFromLocalDB=oe,re.prototype.createCloudDBFromLocalDB=ne,re.prototype.createCloudDBFromCloudDB=ae,re.prototype.sync=function(e,t){this._syncCallbacks.push(t),this._syncInProgress||(this._syncInProgress=!0,this.reloadDatabases(e,()=>{const e=this._syncCallbacks;this._syncCallbacks=[],this._syncInProgress=!1,e.forEach(e=>setTimeout(e,0))}))},re.prototype.listDatabases=function(){return util.localeSortBy(k.union(k.toArray(this.localDatabases),k.toArray(this.cloudDatabases)),"name")},re.prototype.getDatabaseNames=function(){var e,t={},i=this.localDatabases;for(e in i)i.hasOwnProperty(e)&&(t[i[e].name]=!0);var o=this.cloudDatabases;for(e in o)o.hasOwnProperty(e)&&(t[o[e].name]=!0);return t},re.prototype.getDatabase=function(e){return this.localDatabases[e]||this.cloudDatabases[e]},re.prototype.ensureDatabase=function(e,t){var i=this,o=i.localDatabases[e];if(o||(o=i.cloudDatabases[e]),o)return t(void 0,o);i.sync(!1,(function(){o=i.cloudDatabases[e],t(void 0,o)}))},re.prototype.reloadDatabases=async function(e,t){await Promise.all([this.loadLocalDatabases(e),this.loadCloudDatabases(e)]),t&&t()},re.prototype.loadLocalDatabases=async function(e){var t={};try{if(await localFileSystem.ensureDirectory("data"))for(var i=await localFileSystem.listFiles("data"),o=0;o<i.length;o++){var n=i[o],a={};try{var s=await localFileSystem.readFile("data/"+n+"/settings.json","utf8");s&&(a=JSON.parse(s))}catch(e){console.log("Failed to read database settings.json: "+n,e)}t[n]={id:n,name:n,local:!0,account:"local",icon:a.icon,color:a.color}}else $.alert("Cannot create data directory")}catch(e){$.alert(e)}this.localDatabases=t,!1!==e&&this.trigger("change")},re.prototype.loadCloudDatabases=async function(e){var t={};if(cloudFileSystem.isAvailable()){await cloudFileSystem.mkdir("data").catch(e=>console.log(e));try{for(var i=await cloudFileSystem.listFiles("data"),o=0;o<i.length;o++){var n=i[o],a={},s=void 0,r=void 0;try{s=await cloudFileSystem.readFile("data/"+n+"/config.json","utf8")}catch(e){console.log(e)}try{r=await cloudFileSystem.readFile("data/"+n+"/settings.json","utf8")}catch(e){console.log(e)}if(r)try{a=JSON.parse(r)}catch(e){console.log("Failed to read database settings.json: "+n,e)}if(s)try{var l={id:n,name:JSON.parse(s).name,cloud:!0,account:"local",color:a.color,icon:a.icon};t[n]=l}catch(e){console.log("Failed to read database config.json: "+n,e)}}this.cloudDatabases=t}catch(e){console.log(e)}!1!==e&&this.trigger("change")}},re.prototype.openDatabase=function(e,t){var i,o=this;if("string"==typeof e){var n=e;if(!(e=o.localDatabases[n]||o.cloudDatabases[n]))return t("Database not found: "+n)}if(e.local)(i=new Z(o)).openDatabase(e,!1,(function(e){if(e)return t(e);window.database=i,t(void 0,database)}));else{if(!e.cloud)return t("Unknown database type: "+e.id);(i=new q(o)).openDatabase(e.id,!1,(function(e){if(e)return t(e);window.database=i,t(void 0,database)}))}},re.prototype.createDatabase=async function(e,t){try{var i=this,o=e.location,n=e.name,a=e.icon,s=e.color;if("local"===o){var r=i.localDatabases[n];if(r)return i.openDatabase(r,t);if(r={id:n,name:n,icon:a,color:s,local:!0},!await localFileSystem.ensureDirectory("data/"+r.name))return t("Cannot create database directory "+r.name);var l=new Z(i);l.openDatabase(r,!1,(function(e){if(trackEvent("createdb",e?"error":"success"),e)return t(e);i.localDatabases[n]=r,window.database=l,i.trigger("change"),t(void 0,r)}))}else{if("cloud"!==o)return trackEvent("createdb","error"),t("Unknown database type: "+o);var c=new q(i);c.createDatabase(e,(function(e){if(trackEvent("createdb",e?"error":"success"),e)return t(e);i.cloudDatabases[c.id]={id:c.id,name:n,icon:a,color:s,cloud:!0},window.database=c,i.trigger("change"),t(void 0,c)}))}}catch(e){t(e)}},re.prototype.removeDatabase=async function(e,t){var i=this;try{e.cloud?(await cloudFileSystem.remove("data/"+e.id),delete i.cloudDatabases[e.id],i.trigger("change"),t()):e.local?(await localFileSystem.remove("data/"+e.name),delete i.localDatabases[e.id],i.trigger("change"),t()):t("Invalid database type.")}catch(e){t(e)}},re.prototype.duplicateDatabase=function(e,t,i){var o=this;e.local&&"local"===t.location?o.createLocalDBFromLocalDB(e,t,(function(e,t){if(e)return i(e);o.localDatabases[t.id]=t,o.trigger("change"),i(void 0,t)})):e.local&&"cloud"===t.location?o.createCloudDBFromLocalDB(e,t,(function(e,t){if(e)return i(e);o.cloudDatabases[t.id]=t,o.trigger("change"),i(void 0,t)})):e.cloud&&"local"===t.location?o.createLocalDBFromCloudDB(e,t,(function(e,t){if(e)return i(e);o.localDatabases[t.id]=t,o.trigger("change"),i(void 0,t)})):e.cloud&&"cloud"===t.location?o.createCloudDBFromCloudDB(e,t,(function(e,t){if(e)return i(e);o.cloudDatabases[t.id]=t,o.trigger("change"),i(void 0,t)})):i("Canot duplicate database to "+t.location)},re.prototype.renameDatabase=async function(e,t,i){try{var o=t.name,n=t.icon,a=t.color,s=this;if(e.local){if(!(e=s.localDatabases[e.id]))return i("Database not found.");if(n!==e.icon||a!==e.color){var r={},l=await localFileSystem.readFile("data/"+e.name+"/settings.json","utf8");if(l)try{r=JSON.parse(l)}catch(e){console.log("Failed to parse settings",e)}r.icon=n,r.color=a,await localFileSystem.writeFile("data/"+e.name+"/settings.json",JSON.stringify(r),"utf8"),e.icon=n,e.color=a}o!==e.name?(await localFileSystem.move("data/"+e.name,"data/"+o),delete s.localDatabases[e.name],e.name=o,e.id=o,s.localDatabases[e.name]=e,s.trigger("change"),i(void 0,e)):(s.trigger("change"),i(void 0,e))}else if(e.cloud){if(!(e=s.cloudDatabases[e.id]))return i("Database not found.");let l=await cloudFileSystem.readFile("data/"+e.id+"/config.json","utf8"),c=JSON.parse(l);if(c.name=o,await cloudFileSystem.writeFile("data/"+e.id+"/config.json",JSON.stringify(c),"utf8"),e.name=o,n!==e.icon||a!==e.color){r={};const i=await cloudFileSystem.readFile("data/"+e.id+"/settings.json","utf8").catch(e=>(console.log("Failed to read settings",e),""));if(i)try{r=JSON.parse(i)}catch(e){console.log("Failed to parse settings",e)}r.icon=t.icon,r.color=t.color,await cloudFileSystem.writeFile("data/"+e.id+"/settings.json",JSON.stringify(r),"utf8").catch(e=>console.log("Failed to write settings",e)),e.icon=n,e.color=a}s.trigger("change"),i(void 0,e)}else i("Unknow database type")}catch(e){i(e)}},re.prototype.openAnotherDatabase=function(e,t){var i,o=this.getDatabase(e);if(!o)return t("Database not found: "+e);if(o.local)(i=new Z).openDatabase(o,!0,(function(e){if(e)return t(e);t(void 0,i)}));else if(o.cloud)(i=new q).openDatabase(e,!0,(function(e){if(e)return t(e);t(void 0,i)}));else{if(!o.sql)return t("Unknown database type: "+e);(i=new dbms.SQLDB).openDatabase(o,!0,(function(e){if(e)return t(e);t(void 0,i)}))}},re.prototype.getRoles=function(){return{}},re.prototype.isAdmin=function(){return!0};const le=schemas.RE_NID,ce=(schemas.RE_NID_FID,schemas.RE_FILE_REF);let de=Date.now();const he=util.encodeSQLValue;function pe(e,t,i){this.lockQueue=[],this.dbinfo=e,this.account=t,this.server=i,this.accountName=t.name||locale.unnamed,this.id=e.id,this.name=e.dbname||locale.unnamed,this.dbname=e.dbname,this.documentDirectory="",this.path="accounts/"+t.id+"/db/"+this.id,this.dbfile=this.path+"/db",this.isOpen=!1,this.adminMode=!1,this.adminEnabled=!0,this.schema=void 0,this.originalSchema=void 0,this.suppressTriggers=!1,this.isTriggerExecution=!1,this._transactionDepth=0,this._undoStack=void 0,this._renamedNodes={},this._createdNodes={},this._updatedNodes={},this._removedNodes={},this._changedNodes={},this.now=Date.now(),this.tables={},this.nextRid={},this.settings=e.settings||{};var o=dbms.getRemoteConnection().getSessionInfo().getCurrentAccountUser(this.account.id),n={};k.each(dbms.getRemoteConnection().getSessionInfo().listAccountUsers(this.account.id),(function(e){n[e.id]=util.enrichUser(e)}));var a=1;k.each(util.localeSortBy(n,"caption"),(function(e){e.order=a++})),this.user=o,this.users=n,this.roles=Object.assign({},dbms.getRemoteConnection().getSessionInfo().getRoles(this.account.id)),this.listeners={},this._schedule=[],this.supports={history:!0,chat:!1,authentication:!0,files:!0,comments:!0,sync:!1,apps:!1,reindex:!1,reIndexFiles:!1,backup:!1,root:!0,backgroundImage:!0,undo:!0,sharing:!0},this.nodeCount=0,this.reports={},this.isUndo=!1,this.isRedo=!1,this.trashcan={},this.undoStack=[],this.redoStack=[],this.views={},this.nodes={},this.memory={},this._cachedValues={},this._selectCache={},this._selectQueue={},this._selectRidsCache={},this._queryLoading={},this._evalCache={},this.seq=0,this.eventSeq=0,this._networkTasks=[],this._syncStarted=!1,this._syncError=null,this._syncTriggered=!1,this._syncPollEvents=$.proxy(this._syncPollEvents,this),this._syncPollEventsTimeout=null,this._syncRun=$.proxy(this._syncRun,this),this._syncRunTimeout=null,this._syncReportFiles=$.proxy(this._syncReportFiles,this),this._syncReportFilesTriggered=!1,this._syncReportFilesTimeout=null,this._syncReportFilesFailed={},this._syncBackgroundFile=$.proxy(this._syncBackgroundFile,this),this._syncBackgroundFileTriggered=!1,this._syncBackgroundFileTimeout=null,this.schemaUpdateCallbacks=[],this.schemaUpdatedFlag=!1,this._queryNodesCount=0,this._queryNodesCallbacks=[],this._queryNodesLoading={},this.updateAuthorization(),this._unlockedTransaction=Ce(this,{create:async(e,t,i)=>{if("string"==typeof e&&(e=this.schema.types[e]),!e)return i("Type not found");let o=void 0,n=void 0;try{var a=await this._create(e,t,!1);o=null!=a?await this._get(e.id,a):void 0}catch(e){n=e}i(n,o)},update:async(e,t,i,o)=>{let n=void 0;try{await this._update(e,t,i)}catch(e){n=e}o&&o(n)},remove:async(e,t)=>{let i=void 0;try{await this._remove(e)}catch(e){i=e}t&&t(i)},removeAll:async(e,t)=>{let i=void 0;try{for(var o=0;o<e.length;o++){var n=e[o];await this._remove(n,!0)}}catch(e){i=e}t&&t(i)},duplicate:async(e,t)=>{let i=void 0,o=void 0;try{o=await this._duplicate(e)}catch(e){i=e}t&&t(i,o)},importFileFromURL:async(e,t,i,o)=>{let n=void 0,a=void 0;try{a=this._importFileFromURL(e,t,i)}catch(e){n=e}o(n,i)}})}Object.assign(pe.prototype,schemas.AbstractDatabase.prototype),pe.prototype.setDirty=function(){this._selectCache={},this._selectRidsCache={},this._evalCache={}},pe.prototype.acquireLock=function(e){const t=new Promise(e=>{this.lockQueue.push(e)});return 1===this.lockQueue.length&&this.lockQueue[0](),t},pe.prototype.releaseLock=function(e){this.lockQueue.shift(),this.lockQueue.length>0&&this.lockQueue[0]()},pe.prototype.sql=!0,pe.prototype.isSync=!1,pe.prototype.location="remote",pe.prototype.descriptor=function(){return{id:this.id,name:this.name,sql:!0,location:"remote",account:this.account.id,settings:this.settings}},pe.prototype.getUniqueID=function(){return"sync."+this.account.id+"."+this.id},pe.prototype.openDatabase=async function(e,t){var i=this;if(i.isOpen)return t();i.documentDirectory=localFileSystem.getDocumentDirectory(),i.readOnly=e;let o=void 0;$.loading(!0);try{await i.acquireLock("openDatabase"),i.sqldb=await n(),await a()||await s(),i.seq=await r(),await l(),await c(),await d(),i.isOpen=!0,e||(i.syncStart(),i.calendarSync=new O(i),i.calendarSync.init())}catch(e){o=e,console.warn("Unable to open database",e),i.sqldb&&(NinoxSQLDBMS.close(i.sqldb).catch(e=>{console.warn("Unable to close sqldb",e)}),i.sqldb=null)}finally{i.releaseLock("openDatabase")}async function n(){if(!await localFileSystem.exists(i.path)&&!await localFileSystem.mkdir(i.path))throw new Error("Failed to create directory: "+i.path);const e=await NinoxSQLDBMS.open(i.account.id,i.id);if(!e)throw new Error("Cannot open "+i.dbfile);return e}async function a(){return!!await i.getConfigValue("seq")}async function s(){var e=i.server.baseURL+"/sync/init?XT="+encodeURIComponent(i.server.getToken());async function t(e){await i.sqldb.syncInit(e)}await t(e)}async function r(){const e=parseInt(await i.getConfigValue("seq"));if(!(e>=0))throw new Error("Invalid seq: "+e);return e}async function l(){var e=await i.getConfigValue("schema");e||(e={version:1,nextTypeId:1,nextRoleId:1,types:{},roles:{admin:{caption:"admin",roles:[]}}},await i.setConfigValue("schema",e)),await i.setSchema(e,void 0)}async function c(){for(var e=await i.sqldb.queryScalar("SELECT view FROM views WHERE sync!=2"),t=0;t<e.length;t++){var o=e[t],n=util.parseJSON(o);n&&(i.views[n.id]=n)}}async function d(){for(var e=await i.sqldb.queryScalar("SELECT report FROM reports WHERE sync!=2"),t=0;t<e.length;t++){var o=e[t],n=util.parseJSON(o);n&&(i.reports[n.id]=n)}}$.loading(!1),t(o)},pe.prototype.getConfigValue=async function(e){var t=await this.sqldb.queryOneScalar2("SELECT value FROM config WHERE name=?",[String(e)]);return t?util.parseJSON(t):void 0},pe.prototype.setConfigValue=async function(e,t){if(null!=t){var i=JSON.stringify(t);await this.sqldb.exec2("REPLACE INTO config (name, value) VALUES (?,?)",[e,i])}else await this.sqldb.exec2("DELETE FROM config WHERE name=?",[e])},pe.prototype.closeDatabase=async function(e){let t=void 0;if(this.isOpen)try{await this.acquireLock("closeDatabase"),this.calendarSync&&(this.calendarSync.destroy(),this.calendarSync=null),await this.syncStop(),this.schema&&this.schema.off("change",this.schemaChanged,this),this.isOpen&&await this.saveEverything(),await NinoxSQLDBMS.close(this.sqldb),this.isOpen=!1}catch(e){t=e}finally{this.releaseLock("closeDatabase")}e(t)},pe.prototype.saveEverything=function(e){e()},pe.prototype.syncStart=function(){this._syncStarted||(this._syncStarted=!0,ui.setCloudSyncState("okay"),this._syncPollEventsTimeout=setTimeout(this._syncPollEvents,0),this.syncTrigger(),this.syncReportFilesTrigger(),this.syncBackgroundFileTrigger())},pe.prototype.syncStop=async function(){this._syncStarted&&(this._syncStarted=!1,await this._cancelNetworkTasks(),this._syncPollEventsTimeout&&(clearTimeout(this._syncPollEventsTimeout),this._syncPollEventsTimeout=null),this._syncRunTimeout&&(clearTimeout(this._syncRunTimeout),this._syncRunTimeout=null))},pe.prototype.syncTrigger=function(){this._syncTriggered=!0,this._syncStarted&&(this._syncRunTimeout||(this._syncRunTimeout=setTimeout(this._syncRun,0)))},pe.prototype.syncReportFilesTrigger=function(){this._syncReportFilesTriggered=!0,this._syncStarted&&(this._syncReportFilesTimeout||(this._syncReportFilesTimeout=setTimeout(this._syncReportFiles,0)))},pe.prototype.syncBackgroundFileTrigger=function(){this._syncBackgroundFileTriggered=!0,this._syncStarted&&(this._syncBackgroundFileTimeout||(this._syncBackgroundFileTimeout=setTimeout(this._syncBackgroundFile,0)))},pe.prototype.syncCountFilesToDownload=async function(){return await this.sqldb.queryOneScalar("SELECT count(*) FROM files WHERE sync=1")},pe.prototype.syncCountFilesToUpload=async function(){return await this.sqldb.queryOneScalar("SELECT count(*) FROM files WHERE sync=2")},pe.prototype.getSyncState=async function(){return{seq:this.seq,lastError:this._syncError,syncFilesDownload:await this.sqldb.queryOneScalar("SELECT count(*) FROM files WHERE sync=1"),syncFilesDownloadError:await this.sqldb.queryOneScalar("SELECT count(*) FROM files WHERE sync=11"),syncFilesUpload:await this.sqldb.queryOneScalar("SELECT count(*) FROM files WHERE sync=2"),syncFilesUploadError:await this.sqldb.queryOneScalar("SELECT count(*) FROM files WHERE sync=12")}},pe.prototype.hasUnsyncedChanges=async function(){var e=this.sqldb;return(await e.queryScalar2("SELECT viewid FROM views WHERE sync=1",[])).length>0||((await e.queryScalar2("SELECT viewid FROM views WHERE sync=2",[])).length>0||((await e.queryScalar2("SELECT reportid FROM reports WHERE sync=1",[])).length>0||((await e.queryScalar2("SELECT reportid FROM reports WHERE sync=2",[])).length>0||((await e.queryScalar2("SELECT nid FROM sync_creates",[])).length>0||((await e.queryScalar2("SELECT nid FROM sync_updates",[])).length>0||(await e.queryScalar2("SELECT nid FROM sync_removes",[])).length>0)))))},pe.prototype._networkTaskStarted=function(e){e&&this._networkTasks.push(e)},pe.prototype._networkTaskDone=function(e){if(e){var t=this._networkTasks.indexOf(e);-1!==t?this._networkTasks.splice(t,1):console.warn("SyncDB._networkTaskDone: task not found")}},pe.prototype._cancelNetworkTasks=async function(){var e=this._networkTasks;this._networkTasks=[];for(var t=0;t<e.length;t++){var i=e[t];await localFileSystem.cancelTask(i)}},pe.prototype._syncPollEvents=function(){var e=this;if(e._syncStarted){if(!NinoxDocumentInteraction.isOnline())return ui.setCloudSyncState("offline"),void(e._syncPollEventsTimeout=setTimeout(e._syncPollEvents,5e3));var t=e.eventSeq;e.server.syncEvents(t,(function(i,o){if(e._syncStarted)if(i)ui.setCloudSyncState("error"),console.warn("events_POLL: Failed to poll events",i),e._syncPollEventsTimeout=setTimeout(e._syncPollEvents,5e3);else{var n=o.seq;e.eventSeq=n,e._syncPollEventsTimeout=setTimeout(e._syncPollEvents,0),t!==n?e.syncTrigger():(ui.setCloudSyncState("okay"),e._syncTriggered&&e.syncTrigger())}}))}},pe.prototype._syncRun=function(){var e=this;if(!e._syncStarted)return a();if(!NinoxDocumentInteraction.isOnline())return n("offline");async function t(){if(!e._syncStarted)return a();ui.setCloudSyncState("pull"),e._syncRunPull((function(e){if(e)return console.warn("SyncDB._syncRun: pull failed",e),n("error",e);i()}))}async function i(){if(!e._syncStarted)return a();ui.setCloudSyncState("push"),e._syncRunPush((function(e,t){if(e)return console.warn("SyncDB._syncRun: push failed",e),n("error",e);o()}))}async function o(){if(!e._syncStarted)return a();e._syncRunFiles((function(t,i){if(t)return n("error",t);e._syncStarted&&!e._syncTriggered&&i?setTimeout(o,0):a()}))}function n(t,i){i&&console.warn("SyncDB._syncRun: defer",t,i),e._syncTriggered=!0,e._syncError=i,ui.setCloudSyncState(t),e._syncStarted?e._syncRunTimeout=setTimeout(e._syncRun,5e3):e._syncRunTimeout=null}function a(){ui.setCloudSyncState("okay"),e._syncStarted&&e._syncTriggered?e._syncRunTimeout=setTimeout(e._syncRun,0):e._syncRunTimeout=null}e._syncTriggered=!1,t()},pe.prototype._syncRunPull=function(e){var t=this,i=(t.sqldb,t.seq);t.server.syncPull(i,(async function(o,n){if(o)return e(o);if(!t._syncStarted)return e();if(!n||n.seq===i)return e();let a=void 0;try{await t.acquireLock("_syncRunPull"),await t._begin("_syncRunPull"),await t._syncRunPullApply(n),t.seq=n.seq,await t._commit("_syncRunPull"),k.isEmpty(n.reports)||t.syncReportFilesTrigger()}catch(e){a=e,console.warn("SyncDB._syncRunPull: apply failed",e),await t._rollback("_syncRunPull").catch(e=>console.warn("SyncDB._syncRunPull: rollback failed",e))}finally{t.releaseLock("_syncRunPull")}e(a)}))},pe.prototype._syncRunPullApply=async function(e){var t=this,i=t.sqldb,o=t.schema,n=t._renamedNodes,a=t._createdNodes,s=t._updatedNodes,r=t._removedNodes,l=e.config;l&&l.schema&&await d(l.schema);var c=await h();async function d(e){var n=new schemas.Schema(t,e);await t.applySchemaUpdate(n),await t.setConfigValue("schema",e),await t.setSchema(e,n),o=t.schema,t.schemaUpdatedFlag=!0;var a="DELETE FROM views WHERE viewid in (",s=!0;for(var r in t.views)if(t.views.hasOwnProperty(r)){var l=t.views[r];o.types[l.type]||(a+=(s?"":",")+'"'+r+'"',s=!1)}a+=")";var c="DELETE FROM reports WHERE reportid in (",d=[];for(var h in s=!0,t.reports)if(t.reports.hasOwnProperty(h)){var p=t.reports[h];o.types[p.tid]||(c+=(s?"":",")+'"'+h+'"',d.push(t.path+"/reports/"+h),s=!1)}if(c+=")",await i.execBatched([a,c])){for(var r in await localFileSystem.remove2(d),t.views)if(t.views.hasOwnProperty(r)){l=t.views[r];o.types[l.type]||delete t.views[r]}for(var h in t.reports)if(t.reports.hasOwnProperty(h)){p=t.reports[h];o.types[p.tid]||delete t.reports[h]}}}async function h(){var t={},n=o.types,a=e.updates||{},s=e.removes||[];for(var r in n)if(n.hasOwnProperty(r)){var l=await i.queryOneScalar2("SELECT seq FROM sqlite_sequence WHERE name=?",["t_"+r])||0;t[r]=l}for(var c in a)if(a.hasOwnProperty(c)){if(p=le.exec(c)){r=p[1];var d=parseInt(p[2]);l=t[r];t[r]=l>d?l:d}}for(var h=0;h<s.length;h++){var p;c=s[h];if(p=le.exec(c)){r=p[1],d=parseInt(p[2]),l=t[r];t[r]=l>d?l:d}}return t}async function p(e){var o="REPLACE INTO views(viewid,view,sync) VALUES (?,?,0)",n=[],a="DELETE FROM views WHERE viewid in (",s=!0;for(var r in e)if(e.hasOwnProperty(r)){null==(c=e[r])?(a+=(s?"":",")+'"'+r+'"',s=!1):n.push([r,JSON.stringify(c)])}if(a+=")",await i.exec(a))for(var r in e)if(e.hasOwnProperty(r)){null==(c=e[r])&&delete t.views[r]}if(await i.exec2Batched(o,n))for(var l=0;l<n.length;l++){var c,d=n[l];r=d[0];(c=d[1]?JSON.parse(d[1]):null)&&(t.views[r]=c)}}async function u(e){var o="REPLACE INTO reports(reportid,report,sync) VALUES (?,?,0)",n=[],a="DELETE FROM reports WHERE reportid in (",s=!0;for(var r in e)if(e.hasOwnProperty(r)){null==(c=e[r])?(a+=(s?"":",")+'"'+r+'"',s=!1):n.push([r,JSON.stringify(c)])}if(a+=")",await i.exec(a))for(var r in e)if(e.hasOwnProperty(r)){null==(c=e[r])&&delete t.reports[r]}if(await i.exec2Batched(o,n))for(var l=0;l<n.length;l++){var c,d=n[l];r=d[0];(c=d[1]?JSON.parse(d[1]):null)&&(t.reports[r]=c)}}async function f(){for(var o=e.updates||{},a=e.removes||[],s={},r=0;r<a.length;r++)s[a[r]]=!0;var l=await i.queryScalar2("SELECT nid FROM sync_creates",[]),c=0;for(r=0;r<l.length;r++){var d=l[r];if(o[d]||s[d]){var h=await m(d);n[d]=h,c++}}c>0&&(t.nodes={})}async function m(e){var n=le.exec(e);if(n){var a=n[1],s=parseInt(n[2]),r=o.types[a].fields,l=(c[a]||0)+1;c[a]=l;var d=a+l;for(var h in r)if(r.hasOwnProperty(h)){var p=r[h];if(p.isReverse){var u=p.refTypeId,f=p.refFieldId;await i.exec2("UPDATE t_"+u+" SET f_"+f+"=? WHERE f_"+f+"=?",[l,s])}}await i.exec2("UPDATE t_"+a+" SET _id=? WHERE _id=?",[l,s]),await i.exec2("UPDATE sqlite_sequence SET seq=? WHERE name=?",[l,"t_"+a]),await i.exec2("UPDATE s_"+a+" SET docid=? WHERE docid=?",[l,s]),await i.exec2("UPDATE files SET nid=? WHERE nid=?",[d,e]),await i.exec2("UPDATE sync_creates SET nid=? WHERE nid=?",[d,e]),await i.exec2("UPDATE sync_updates SET nid=? WHERE nid=?",[d,e]),await i.exec2("UPDATE sync_removes SET nid=? WHERE nid=?",[d,e]);var m=t.path,g=m+"/files/"+a+"/"+s,v=m+"/files/"+a+"/"+l;return await localFileSystem.exists(g)&&await localFileSystem.move(g,v),d}}async function g(e){var n=[],r=[],l=[],c=[];for(var d in await t.loadNodesPromise(Object.keys(e)),e)if(e.hasOwnProperty(d)){var h=e[d];if(!(_=le.exec(d)))return;var p=_[1],u=parseInt(_[2]);if(!(D=o.types[p]))return;if(N=await t._get(p,u))c.push(d);else{var f=["_id","_cu","_cd","_mu","_md"],m=[he(u),he(h._cu||""),he(h._cd||0),he(h._mu||""),he(h._md||0)],g=D.fields,v={};for(var y in g)if(g.hasOwnProperty(y)){if(((F=g[y]).isField||F.isReference)&&"fn"!==F.base)null!=(R=h[y])&&(f.push("f_"+y),m.push(he(R)));F.isReference&&(v[y]=[F.refTypeId,F.refFieldId,R])}n.push("INSERT INTO t_"+p+" ("+f.join(",")+") VALUES ("+m.join(",")+")"),r.push(v),l.push(d)}}if(c.length){for(var b=k.map(c,(function(e){return'"'+e+'"'})).join(","),w=await i.query("SELECT nid,fid,original FROM sync_updates WHERE nid in ("+b+")"),x=k.reduce(w,(function(e,t){var i=t[0],o=t[1],n=t[2];return e[i]||(e[i]={}),e[i][o]=n,e}),{}),T="DELETE FROM sync_updates WHERE nid=? AND fid=?",C=[],$=[],S=0;S<c.length;S++){var _,E=x[d=c[S]];h=e[d];if(!(_=le.exec(d)))return;var D,N;p=_[1],u=parseInt(_[2]);if(!(D=o.types[p]))return;if(N=await t._get(p,u)){var I="UPDATE t_"+p+" SET ",O=!0,M=0;g=D.fields;for(var y in g)if(g.hasOwnProperty(y)){var F=g[y],R=h[y],L=N[y];if((F.isField||F.isReference)&&"fn"!==F.base){if(R!==L){var j=E&&E[y],A=void 0===j?void 0:null===j?null:util.parseJSON(j);(void 0===A||A!==R&&(null!==A||null===A&&void 0!==R))&&(void 0!==A&&C.push([d,y]),I+=(O?"":",")+"f_"+y+"="+he(R),O=!1,M++,N[y]=R)}F.isReference&&(L&&!R?t.removeFromRevs(F.refTypeId,F.refFieldId,L,u):L&&R&&L!==R?(t.removeFromRevs(F.refTypeId,F.refFieldId,L,u),t.addToRevs(F.refTypeId,F.refFieldId,R,u)):!L&&R&&t.addToRevs(F.refTypeId,F.refFieldId,R,u))}}N._md!==h._md&&(I+=(O?"":",")+"_md="+he(h._md||0),N._md=h._md,O=!1,M++),N._mu!==h._mu&&(I+=(O?"":",")+"_mu="+he(h._mu||""),N._mu=h._mu,O=!1,M++),I+=" WHERE _id="+he(u),M>0&&$.push(I)}}if(C.length&&await i.exec2Batched(T,C),await i.execBatched($))for(S=0;S<c.length;S++)s[c[S]]=!0}if(n.length){var P=await i.insertBatched(n);await t.loadNodesPromise(l);for(S=0;S<P.length;S++){if(0!==(u=P[S])){d=l[S],v=r[S];for(var y in v){C=v[y];t.addToRevs(C[0],C[1],C[2],u)}a[d]=!0}}}}async function v(e){await t.loadNodesPromise(e);for(var o=t.path,n={},a="DELETE FROM files WHERE nid=?",s="DELETE FROM sync_creates WHERE nid=?",l="DELETE FROM sync_updates WHERE nid=?",c="DELETE FROM sync_removes WHERE nid=?",d=[],h=[],p=0;p<e.length;p++){var u=e[p];if(x=le.exec(u)){var f=x[1],m=parseInt(x[2]);n[f]?(n[f].t+=","+m,n[f].s+=","+m):n[f]={t:"DELETE FROM t_"+f+" WHERE _id in ("+m,s:"DELETE FROM s_"+f+" WHERE docid in ("+m},d.push([u]),h.push(o+"/files/"+f+"/"+m)}}var g=[];for(var f in n){var v=n[f],y=v.t+")",b=v.s+")";g.push(y,b)}var w=[{query:a,args:d},{query:s,args:d},{query:l,args:d},{query:c,args:d}];if(await i.execBatched(g)){await i.exec3(w),await localFileSystem.remove2(h);for(p=0;p<e.length;p++){var x;u=e[p];if(x=le.exec(u)){f=x[1],m=parseInt(x[2]);var T=t.nodes[u];if(T){var C=t.schema.types[f];if(!C)continue;var k=C.fields;for(var $ in k)if(k.hasOwnProperty($)){var S=k[$];S.isReference&&T[$]&&t.removeFromRevs(S.refTypeId,S.refFieldId,T[$],m)}delete t.nodes[u]}r[u]=!0}}}}async function y(e){for(var o="REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,1,?)",n=[],a=[],s=[],r=[],l=0;l<e.length;l++){var c=e[l];if(1===c.sync)n.push([c.nid,c.name,c.seq]);else if(0===c.sync){a.push('"'+c.nid+'"'),s.push('"'+c.name+'"');var d=le.exec(c.nid);if(d){var h=d[1],p=d[2],u=t.path;r.push([u+"/files/"+h+"/"+p+"/"+c.name,[".thumb_",".thumb2_"]])}}}var f="DELETE FROM files WHERE nid in ("+a.join(",")+") AND name in ("+s.join(",")+")";await i.exec(f),await i.exec2Batched(o,n),await localFileSystem.removeFileAndThumbsBatched(r)}e.views&&await p(e.views),e.reports&&await u(e.reports),await f(),e.updates&&await g(e.updates),e.removes&&await v(e.removes),e.files&&await y(e.files),await t.setConfigValue("seq",String(e.seq))},pe.prototype._syncRunPush=async function(e){var t=this;if(!t._syncStarted)return e();var i=t.sqldb,o=t.seq;try{let i=void 0;try{await t.acquireLock("_syncRunPush1"),i=await r()}finally{t.releaseLock("_syncRunPush1")}if(!i)return e(void 0,!1);await n(i);try{await t.acquireLock("_syncRunPush2"),await s()}finally{t.releaseLock("_syncRunPush2")}e(void 0,!0)}catch(i){console.warn("SyncDB._syncRunPush < failed",t.seq,i);try{await t.acquireLock("_syncRunPush3"),await a().catch(e=>{console.warn("SyncDB._syncRunPush: rollbackSync failed",e)})}finally{t.releaseLock("_syncRunPush3")}e(i)}function n(e){return new Promise((i,n)=>{t.server.syncPush(o,e,(function(e){if(e)return n(e);i()}))})}async function a(){await t._sqlBeginTransaction("rollbacksync");try{await i.exec("UPDATE sync_creates SET sync=1"),await i.exec("UPDATE sync_updates SET sync=1"),await i.exec("UPDATE sync_removes SET sync=1"),await t._sqlCommitTransaction("rollbacksync")}catch(e){throw await t._sqlRollbackTransaction("rollbacksync"),e}}async function s(){await t._sqlBeginTransaction("cleansync");try{await i.exec("DELETE FROM views WHERE sync=2"),await i.exec("UPDATE views SET sync=0 WHERE sync=1"),await i.exec("DELETE FROM reports WHERE sync=2"),await i.exec("UPDATE reports SET sync=0 WHERE sync=1"),await i.exec("DELETE FROM sync_creates WHERE sync=2"),await i.exec("DELETE FROM sync_updates WHERE sync=2"),await i.exec("DELETE FROM sync_removes WHERE sync=2"),await t._sqlCommitTransaction("cleansync")}catch(e){throw await t._sqlRollbackTransaction("cleansync"),e}}async function r(){const e=t.schema;await t._sqlBeginTransaction("getdelta");try{for(var o={},n=await i.query2("SELECT viewid, view FROM views WHERE sync=1",[]),a=0;a<n.length;a++){var s=n[a],r=s[0],l=s[1],c=util.parseJSON(l);c&&(o[r]=c)}var d=await i.queryScalar2("SELECT viewid FROM views WHERE sync=2",[]);for(a=0;a<d.length;a++){o[r=d[a]]=null}var h={},p=await i.query2("SELECT reportid, report FROM reports WHERE sync=1",[]);for(a=0;a<p.length;a++){var u=p[a],f=u[0],m=u[1],g=util.parseJSON(m);g&&(h[f]=g)}var v=await i.queryScalar2("SELECT reportid FROM reports WHERE sync=2",[]);for(a=0;a<v.length;a++){h[f=v[a]]=null}var y=await i.queryScalar2("SELECT nid FROM sync_creates",[]),b=await i.query2("SELECT nid, fid FROM sync_updates",[]),w=await i.queryScalar2("SELECT nid FROM sync_removes",[]),x={};for(a=0;a<y.length;a++){var T=y[a],C=le.exec(T);if(C){var k=C[1],$=parseInt(C[2]),S=e.types[k];if(S){var _=S.fields;if(M=await t._get(k,$)){var E={_cu:M._cu,_cd:M._cd};for(var D in _)if(_.hasOwnProperty(D)){var N=_[D];if((N.isField||N.isReference)&&"fn"!==N.base){var I=M[D];null!=I&&(E[D]=I)}}x[T]=E}}}}var O={};for(a=0;a<b.length;a++){var M,F=b[a];T=F[0],D=F[1];if(!x[T])if(M=await t.get(T)){var R=O[T];R||(R={},O[T]=R);var L=M[D];R[D]=null==L?null:L}}await i.exec2("UPDATE sync_creates SET sync=2",[]),await i.exec2("UPDATE sync_updates SET sync=2",[]),await i.exec2("UPDATE sync_removes SET sync=2",[]),await t._sqlCommitTransaction("getdelta")}catch(e){throw await t._sqlRollbackTransaction("getdelta"),e}return n.length+d.length+p.length+v.length+w.length+y.length+b.length>0?{views:o,reports:h,c:x,u:O,r:w}:void 0}},pe.prototype._syncRunFiles=async function(e){var t=this,i=this.sqldb,o=0,n=void 0;try{await a(),await s(),await r(),0===o&&(await l(),0===o&&await c())}catch(e){console.warn("SyncDB._syncRunFiles: Error - will ignore silently",e),n=e}async function a(){if(!t._syncStarted)throw new Error("Sync not started yet");var e=await t._syncGetFileToPull();if(e){o++;var n=t.server.baseURL+"/files/download/"+encodeURIComponent(e.nid)+"/"+encodeURIComponent(e.name),a=t.server.getAuthorization();ui.setCloudSyncState("pull");var s=await localFileSystem.getDownloadTask(n,"",a);t._networkTaskStarted(s);var{code:r,destName:l}=await localFileSystem.executeDownloadTask(s);if(t._networkTaskDone(s),!t._syncStarted)throw new Error("Sync not started yet");200===r?(await localFileSystem.move(l,e.path),await i.exec2("UPDATE files SET sync=0 WHERE nid=? AND name=?",[e.nid,e.name])):404===r?await i.exec2("DELETE FROM files WHERE nid=? AND name=?",[e.nid,e.name]):await i.exec2("UPDATE files SET sync=11 WHERE nid=? AND name=?",[e.nid,e.name])}}async function s(){if(!t._syncStarted)throw new Error("Sync not started yet");var e=await t._syncGetFileToPush();if(e){o++;var n=t.server.baseURL+"/files/put?nid="+encodeURIComponent(e.nid)+"&name="+encodeURIComponent(e.name),a=t.server.getAuthorization();ui.setCloudSyncState("push");var s=await localFileSystem.getUploadTask(e.path,n,a);t._networkTaskStarted(s);var r=await localFileSystem.executeUploadTask(s);if(t._networkTaskDone(s),!t._syncStarted)throw new Error("Sync not started yet");r>=200&&r<300?await i.exec2("UPDATE files SET sync=0 WHERE nid=? AND name=?",[e.nid,e.name]):await i.exec2("UPDATE files SET sync=12 WHERE nid=? AND name=?",[e.nid,e.name])}}async function r(){if(!t._syncStarted)throw new Error("Sync not started yet");var e=await t._syncGetFileToRemove();function n(e,i){return new Promise((o,n)=>{t.server.removeFile(e,i,(function(e){e?n(e):o()}))})}e&&(o++,await n(e.nid,e.name).catch(e=>console.warn("Could not remove file from server",e)),await i.exec2("DELETE FROM files WHERE nid=? AND name=? AND sync=3",[e.nid,e.name]))}async function l(){await i.queryOne2("SELECT nid,name FROM files WHERE sync=11",[])&&(await i.exec("UPDATE files SET sync=1 WHERE sync=11"),o++)}async function c(){await i.queryOne2("SELECT nid,name FROM files WHERE sync=12",[])&&(await i.exec("UPDATE files SET sync=2 WHERE sync=12"),o++)}e(n,o>0)},pe.prototype._syncGetFileToPull=async function(){try{await this.acquireLock("_syncGetFileToPull");var e=this.sqldb,t=await e.query2("SELECT nid,name FROM files WHERE sync=1",[]);if(!t)return;for(var i=0;i<t.length;i++){var o=t[i],n=o[0],a=o[1],s=le.exec(n);if(s){var r=s[1],l=parseInt(s[2]),c=this.schema.types[r];if(c){if(c.isReadable(this.user.roles))return{nid:n,tid:r,rid:l,name:a,path:this.path+"/files/"+r+"/"+l+"/"+a}}else console.warn('Removed type for entry in files table: "'+n+'"'),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}else console.warn('Invalid entry in files table: "'+n+'"'),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}return}finally{this.releaseLock("_syncGetFileToPull")}},pe.prototype._syncGetFileToPush=async function(){try{await this.acquireLock("_syncGetFileToPush");var e=this.sqldb,t=await e.query2("SELECT nid,name FROM files WHERE sync=2 AND NOT EXISTS (SELECT sync_creates.nid FROM sync_creates WHERE sync_creates.nid = files.nid) AND NOT EXISTS (SELECT sync_removes.nid FROM sync_removes WHERE sync_removes.nid = files.nid)",[]);if(!t)return;for(var i=0;i<t.length;i++){var o=t[i],n=o[0],a=o[1],s=le.exec(n);if(s){var r=s[1],l=parseInt(s[2]),c=this.schema.types[r];if(c){var d=this.path+"/files/"+r+"/"+l+"/"+a;if(await localFileSystem.exists(d)){var h=util.makeValidFileName(a);if(a!==h){console.warn("Rename file to sanitize file name: ",a,h),await e.exec2("UPDATE files SET name=? WHERE nid=? AND name=?",[h,n,a]);var p=this.path+"/files/"+r+"/"+l+"/"+h;await localFileSystem.removeThumbs(d,[".thumb_",".thumb2_"]),await localFileSystem.move(d,p),a=h,d=p}if(c.isWritable(this.user.roles))return{nid:n,tid:r,rid:l,name:a,path:d}}else console.warn("File not found for entry in files table: ",a),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}else console.warn('Removed type for entry in files table: "'+n+'"'),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}else console.warn('Invalid entry in files table: "'+n+'"'),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}return}finally{this.releaseLock("_syncGetFileToPush")}},pe.prototype._syncGetFileToRemove=async function(){try{await this.acquireLock("_syncGetFileToRemove");var e=this.sqldb,t=await e.query2("SELECT nid,name FROM files WHERE sync=3",[]);if(!t)return;for(var i=0;i<t.length;i++){var o=t[i],n=o[0],a=o[1],s=le.exec(n);if(s){var r=s[1],l=parseInt(s[2]),c=this.schema.types[r];if(c){if(c.isWritable(this.user.roles))return{nid:n,tid:r,rid:l,name:a,path:this.path+"/files/"+r+"/"+l+"/"+a}}else console.warn('Removed type for entry in files table: "'+n+'"'),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}else console.warn('Invalid entry in files table: "'+n+'"'),await e.exec2("DELETE FROM files WHERE nid=? AND name=?",[n,a])}return}finally{this.releaseLock("_syncGetFileToRemove")}},pe.prototype._syncReportFiles=async function(){var e=this;if(!e._syncStarted)return c();e._syncReportFilesTriggered=!1;var t=e.reports;for(var i in t)if(t.hasOwnProperty(i))for(var o=ue(t[i]),n=e.path+"/reports/"+i+"/files",a=0;a<o.length;a++){var s=o[a];if(!e._syncReportFilesFailed[i+"/"+s]){var r=n+"/"+s;if(!await localFileSystem.exists(r))return void await l(i,s)}}async function l(t,i){try{var o=e.server.baseURL+"/reports/file?report="+encodeURIComponent(t)+"&file="+encodeURIComponent(i),n=await localFileSystem.getDownloadTask(o,"",e.server.getAuthorization());e._networkTaskStarted(n);var{code:a,destName:s}=await localFileSystem.executeDownloadTask(n);e._networkTaskDone(n),e._syncStarted&&(200===a?await localFileSystem.move(s,r):e._syncReportFilesFailed[t+"/"+i]=!0),e._syncReportFilesTriggered=!0}catch(e){console.warn("SyncDB._syncReportFiles: download failed",e)}finally{c()}}function c(){e._syncStarted&&e._syncReportFilesTriggered?e._syncReportFilesTimeout=setTimeout(e._syncReportFiles,0):e._syncStarted&&!k.isEmpty(e._syncReportFilesFailed)?(e._syncReportFilesFailed={},e._syncReportFilesTimeout=setTimeout(e._syncReportFiles,25e3)):e._syncReportFilesTimeout=null}c()},pe.prototype._syncBackgroundFile=async function(){try{var e=this;if(!e._syncStarted)return d();if(e._syncBackgroundFileTriggered=!1,"background-file"===e.settings.backgroundClass){var t=await e.getConfigValue("backgroundTimestamp")||0,i=e.settings.backgroundTimestamp||0,o=e.path+"/background.jpg";if(t==i&&await localFileSystem.exists(o))d();else{var n=e.server.baseURL+"/files/background.jpg?T="+encodeURIComponent(i),a=e.server.getAuthorization(),s=await localFileSystem.getDownloadTask(n,o,a);e._networkTaskStarted(s);var{code:r,destPath:l}=await localFileSystem.executeDownloadTask(s);e._networkTaskDone(s),r>=200&&r<300?(await e.setConfigValue("backgroundTimestamp",i),setTimeout((function(){de++,ui.updateBackground()}),0),d()):c()}}else d()}catch(e){console.warn("SyncDB._syncBackgroundFile: ",e)}function c(){e._syncBackgroundFileTriggered=!0,e._syncStarted?e._syncBackgroundFileTimeout=setTimeout(e._syncBackgroundFile,1e4):e._syncBackgroundFileTimeout=null}function d(){e._syncStarted&&e._syncBackgroundFileTriggered?e._syncBackgroundFileTimeout=setTimeout(e._syncBackgroundFile,0):e._syncBackgroundFileTimeout=null}},pe.prototype.create=async function(e,t,i){if("string"==typeof e&&(e=this.schema.types[e]),!e)return i("Type not found");let o=void 0,n=void 0;try{await this.acquireLock("create"),await this._begin("create");var a=await this._create(e,t,!1);await this._commit("create"),o=null!=a?await this._get(e.id,a):void 0}catch(e){n=e,await this._rollback("create").catch(t=>console.warn("SyncDB.create: Failed to rollback",e))}finally{this.releaseLock("create")}i(n,o)},pe.prototype._create=async function(e,t,i,o){var n=this.now,a=this.user.id,s=e.id,r=[],l=["_cu","_cd","_mu","_md"],c=[he(a||""),he(n),he(a||""),he(n)],d=e.fields;for(var h in d)if(d.hasOwnProperty(h)){var p=d[h];if((p.isField||p.isReference)&&"fn"!==p.base)void 0!==(y=t[h])||o||(y=p.create()),null!=y&&(l.push("f_"+h),c.push(he(y)),p.isReference&&r.push({tid:p.refTypeId,fid:p.refFieldId,rid:y}))}var u=await this.sqldb.insert("INSERT INTO t_"+s+" ("+l.join(",")+") VALUES ("+c.join(",")+")"),f=s+u;if(await this.sqldb.exec2("REPLACE INTO sync_creates (nid,sync) VALUES (?,1)",[f]),v=await this._get(e.id,u)){for(var m=0;m<r.length;m++){var g=r[m];this.addToRevs(g.tid,g.fid,g.rid,u)}var v;if(this._createdNodes[f]=!0,this._pushUndoStack({op:"create",nid:f}),this.nodeCount++,this.setDirty(),e.afterCreateExp&&!this.suppressTriggers)if(v=await this._get(e.id,u)){this.suppressTriggers=!0,this.isTriggerExecution=!0;try{await this.evaluatePromise(e.afterCreateExp,v)}finally{this.isTriggerExecution=!1,this.suppressTriggers=!1}}if(t)for(var h in t)if(t.hasOwnProperty(h)){var y=t[h];await this._update(f,h,y)}return u}},pe.prototype.evaluatePromise=function(e,t){return new Promise((i,o)=>{e.evaluate(this._unlockedTransaction,t,(e,t)=>{e?o(e):i(t)},!0)})},pe.prototype.schedule=function(e,t){this._schedule.push([e,t])},pe.prototype.triggerEvents=function(){var e=this._schedule;if(this._schedule=[],e&&e.length){this._trigger("*:*",[]);for(var t=0;t<e.length;t++)this._trigger(e[t][0],e[t][1])}},pe.prototype._trigger=function(e,t){var i=this.listeners[e];if(i)for(var o=0;o<i.length;o++)i[o].f.apply(i[o].c,t)},pe.prototype.update=async function(e,t,i,o){let n=void 0;try{await this.acquireLock("update");const n=this.schema.typeOf(e);if(!n)return o();var a=n.fields[t];if(!a)return o();if(i=null==i?null:a.convert(i),"memory-global"===a.binding){const n=a.type.id+"."+a.id,s=this.memory[n];if(s!==i||null==s!=(null==i)){this.memory[n]=null==i?void 0:i,this.setDirty();const s=["update",e,t,i];this.schedule("*:update",s),this.schedule(e+":*",s),this.schedule(e+":update",s),this.schedule(e+":update:"+t,s),this.schedule(e+":change",["change",e]),this.schedule("*:change",["change",e]),this.executeMemoryTrigger(a.afterUpdateExp,e,()=>{this.suppressMemoryTriggers||this.triggerEvents(),o&&o()})}}else if("memory-record"===a.binding){const n=e+"."+a.id,s=this.memory[n];if(s!==i||null==s!=(null==i)){this.memory[n]=null==i?void 0:i,this.setDirty();const s=["update",e,t,i];this.schedule("*:update",s),this.schedule(e+":*",s),this.schedule("*:change",["change",e]),this.executeMemoryTrigger(a.afterUpdateExp,e,()=>{this.suppressMemoryTriggers||this.triggerEvents(),o&&o()})}}else{await this._begin("update");try{await this._update(e,t,i),await this._commit("update")}catch(e){throw await this._rollback("update").catch(e=>console.warn("SyncDB.update: Failed to rollback",e)),e}}}catch(e){n=e}finally{this.releaseLock("update")}o&&o(n)},pe.prototype.executeMemoryTrigger=function(e,t,i){e?this.suppressMemoryTriggers?i():(this.suppressMemoryTriggers=!0,this.loadNode(nid,(t,o)=>{t&&console.warn(t),e.evaluate(this,o,e=>{this.suppressMemoryTriggers=!1,e&&console.warn(e),i()})})):i()},pe.prototype._updateFulltext=async function(e){var t=le.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=this.schema.types[i];if(n&&n.globalSearch){var a=await this.get(e);if(a){var s=n.fields,r=""+o;for(var l in s)if(s.hasOwnProperty(l)){var c=a[l];if(null!=c){var d=s[l];if(d.isField&&"fn"!==d.base&&"false"!==d.globalSearch){var h=d.formatFulltext(c);h&&(r+=" "+h)}}}return{query:r?"REPLACE INTO s_"+i+" (docid, content) VALUES (?,?)":"DELETE FROM s_"+i+" WHERE docid=?",args:r?[o,r]:[o]}}}}},pe.prototype._removeFulltext=function(e){var t=le.exec(e);if(t)return{query:"DELETE FROM s_"+t[1]+" WHERE docid=?",args:[parseInt(t[2])]}},pe.prototype._update=async function(e,t,i){this.seq;var o=le.exec(e);if(o){var n=o[1],a=parseInt(o[2]),s=this.schema.types[n];if(s){var r=s.fields[t];if(r){var l=await this._get(n,a);if(l){i=r.convert(i);var c=l[t],d=!1;if((r.isField||r.isReference)&&"fn"!==r.base){if(!ye(c,i))l[t]=i,this._pushUndoStack({op:"update",nid:e,fid:t,old:c,val:i}),await this.sqldb.exec2("UPDATE t_"+n+" SET f_"+t+"=? WHERE _id=?",[i,a]),r.isReference&&(c&&!i?this.removeFromRevs(r.refTypeId,r.refFieldId,c,a):c&&i&&c!==i?(this.removeFromRevs(r.refTypeId,r.refFieldId,c,a),this.addToRevs(r.refTypeId,r.refFieldId,i,a)):!c&&i&&this.addToRevs(r.refTypeId,r.refFieldId,i,a)),await this.sqldb.queryOne2("SELECT original FROM sync_updates WHERE nid=? AND fid=?",[e,t])?await this.sqldb.exec2("UPDATE sync_updates SET sync=1 WHERE nid=? AND fid=?",[e,t]):await this.sqldb.exec2("INSERT INTO sync_updates (nid,fid,original,sync) VALUES (?,?,?,1)",[e,t,null==c?null:JSON.stringify(c)]),this._updatedNodes[e]=!0,d=!0}else if(r.isReverse){c=await this.sqldb.queryScalar2("SELECT _id FROM t_"+r.refTypeId+" WHERE f_"+r.refFieldId+"=?",[a]);var h={},p={},u=[],f=[];if(i)for(var m=0;m<i.length;m++){(b=parseInt(i[m]))>0&&(h[b]=!0)}if(c)for(m=0;m<c.length;m++){var g=c[m];h[g]?p[g]=!0:f.push(g)}if(i)for(m=0;m<i.length;m++){(b=parseInt(i[m]))>0&&(p[b]||u.push(b))}for(m=0;m<f.length;m++){var v=f[m],y=r.refTypeId+v;await this._update(y,r.refFieldId,null)}for(m=0;m<u.length;m++){var b=u[m],w=r.refTypeId+b;await this._update(w,r.refFieldId,a)}}if(this.setDirty(),d&&!this.suppressTriggers){this.suppressTriggers=!0,this.isTriggerExecution=!0;try{r.afterUpdateExp&&await this.evaluatePromise(r.afterUpdateExp,l),s.afterUpdateExp&&await this.evaluatePromise(s.afterUpdateExp,l)}finally{this.isTriggerExecution=!1,this.suppressTriggers=!1}}}}}}},pe.prototype.updateNodes=async function(e,t){let i={},o=void 0;try{await this.acquireLock("updateNodes"),await this._begin("updateNodes");var n=this.suppressTriggers;this.suppressTriggers=!0,await this._updateNodes(e,i),this.suppressTriggers=n,await this._commit("updateNodes")}catch(e){o=e,await this._rollback("updateNodes").catch(e=>console.warn("SyncDB.updateNodes: Failed to rollback",e))}finally{this.releaseLock("updateNodes")}t&&t(o,i)},pe.prototype._updateNodes=async function(e,t){for(var i=this.schema.types,o=[],n=[],a=[],s={},r=[],l=0;l<e.length;l++){(m=e[l])._deleted?a.push(m):m._id?n.push(m):o.push(m)}for(l=0;l<o.length;l++){if(f=i[u=(m=o[l])._type]){var c=await this._create(f,g(f,m,!0,!1),!0,!0);if(null!=c){var d=u+c;m._clientId&&(s[m._clientId]=c,t[m._clientId]=d),m._id=d}else m._clientId&&(s[m._clientId]=null,t[m._clientId]=null)}}for(l=0;l<o.length;l++){if(d=(m=o[l])._id)if(f=i[u=we(d)]){var h=g(f,m,!1,!0);for(var p in h)h.hasOwnProperty(p)&&await this._update(d,p,h[p])}}for(l=0;l<n.length;l++){var u,f;if(f=i[u=we(d=(m=n[l])._id)]){h=g(f,m,!0,!0);for(var p in h)h.hasOwnProperty(p)&&await this._update(d,p,h[p])}}for(l=0;l<a.length;l++){var m;d=(m=a[l])._id;await this._remove(d,!0)}function g(e,t,i,o){var n={},a=e.fields;for(var r in t)if(t.hasOwnProperty(r)){var l=t[r],c=a[r];if(c)if(c.isReference){if(o&&null!=l){n[r]=null;var d=s[l];n[r]=void 0!==d?d:l}}else c.isField&&"fn"!==c.base&&"_"!==c[0]&&i&&(n[r]=c.convert(l))}return n}this._pushUndoStack({op:"updates",updates:r}),this.setDirty()},pe.prototype.remove=async function(e,t){let i=void 0;try{await this.acquireLock("remove"),await this._begin("remove"),await this._remove(e),await this._commit("remove")}catch(e){i=e,await this._rollback("remove").catch(e=>console.warn("SyncDB.remove: Failed to rollback",e))}finally{this.releaseLock("remove")}t&&t(i)},pe.prototype.removeAll=async function(e,t){let i=void 0;try{await this.acquireLock("removeAll"),await this._begin("removeAll");for(var o=0;o<e.length;o++){var n=e[o];await this._remove(n,!0)}await this._commit("removeAll")}catch(e){i=e,await this._rollback("removeAll").catch(e=>console.warn("SyncDB.removeAll: Failed to rollback",e))}finally{this.releaseLock("removeAll")}t&&t(i)},pe.prototype._remove=async function(e,t){var i=le.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this.schema.types[o];if(a){var s=await this._get(o,n);if(s){await this.sqldb.exec2("DELETE FROM t_"+o+" WHERE _id=?",[n]),await this.sqldb.exec2("DELETE FROM s_"+o+" WHERE docid=?",[n]),await this.sqldb.exec2("DELETE FROM files WHERE nid=?",[e]);var r=await this.sqldb.queryOneScalar2("SELECT count(*) FROM sync_creates WHERE nid=? AND sync=1",[e]);await this.sqldb.exec2("DELETE FROM sync_creates WHERE nid=? AND sync=1",[e]),await this.sqldb.exec2("DELETE FROM sync_updates WHERE nid=? AND sync=1",[e]),r?await this.sqldb.exec2("DELETE FROM sync_removes WHERE nid=? AND sync=1",[e]):await this.sqldb.exec2("REPLACE INTO sync_removes (nid,sync) VALUES (?,1)",[e]);var l={},c=a.fields;for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];if(h.isReverse){var p=h.refTypeId,u=h.refFieldId,f=s[d];if(f)for(var m=0;m<f.length;m++){var g=f[m],v=p+g;if(h.cascade)l[v]=!0;else{await this.sqldb.exec2("UPDATE t_"+p+" SET f_"+u+"=NULL WHERE _id=?",[g]);var y=this.nodes[v];y&&(y[u]=void 0),this._changedNodes[v]=!0}}}else h.isReference&&this.removeFromRevs(h.refTypeId,h.refFieldId,s[d],n)}for(var b in l)l.hasOwnProperty(b)&&await this._remove(b,t);delete this.nodes[e],this._removedNodes[e]=!0,this.setDirty()}}}},pe.prototype.duplicate=async function(e,t){let i=void 0,o=void 0;try{await this.acquireLock("duplicate"),await this._begin("duplicate"),o=await this._duplicate(e),await this._commit("duplicate")}catch(e){i=e,await this._rollback("duplicate").catch(e=>console.warn("SyncDB.removeAll: Failed to rollback",e))}finally{this.releaseLock("duplicate")}t&&t(i,o)},pe.prototype._duplicate=async function(e){var t=this,i=this.now,o=this.user.id,n={},a=await s(e,null,null);return this.setDirty(),a;async function s(e,a,r){if(n[e])return e;n[e]=!0;var l=[],c=le.exec(e);if(c){var d=c[1],h=parseInt(c[2]),p=await t._get(d,h);if(p){var u=t.schema.types[d];if(u){var f=["_cu","_cd","_mu","_md"],m=[he(o||""),he(i||0),he(o||""),he(i||0)],g=u.fields,v={};for(var y in g)if(g.hasOwnProperty(y)){var b=g[y];if(b.isField&&"fn"!==b.base&&"file"!==b.base)null!=(w=p[y])&&(f.push("f_"+y),m.push(he(b.convert(w))));else if(b.isReference){var w;if(b.isComposition&&b.type.master===a){if(r){var x=be(r);f.push("f_"+y),m.push(he(x)),v[y]=[b.refTypeId,b.refFieldId,x]}}else null!=(w=p[y])&&(f.push("f_"+y),m.push(he(w)),v[y]=[b.refTypeId,b.refFieldId,w])}else if(b.isReverse&&b.reference.isComposition&&b.reference.type.master===u){var T=await t.sqldb.queryScalar2("SELECT _id FROM t_"+b.refTypeId+" WHERE f_"+b.refFieldId+"=?",[h]);if(T)for(var C=0;C<T.length;C++){var k=b.refTypeId+T[C];l.push(k)}}}var $=await t.sqldb.insert("INSERT INTO t_"+d+" ("+f.join(",")+") VALUES ("+m.join(",")+")"),S=d+$;for(var y in await t.sqldb.exec2("REPLACE INTO sync_creates (nid,sync) VALUES (?,1)",[S]),t._createdNodes[S]=!0,t.nodeCount++,v){var _=v[y];t.addToRevs(_[0],_[1],_[2],$)}for(C=0;C<l.length;C++)await s(l[C],u,S);return S}console.warn("Type not found",d)}else console.warn("Node not found",e)}else console.warn("Invalid nid",e)}},pe.prototype.loadNodes=function(e,t){for(var i=this.nodes,o={},n=0,a=0;a<e.length;a++){var s=e[a];if(!i[s]){var r=le.exec(s),l=r[1],c=parseInt(r[2]),d=o[l];d?d.push(c):o[l]=[c],n++}}n?this.queryNodes(o,t):t()},pe.prototype.loadNodesPromise=function(e){return new Promise((t,i)=>{this.loadNodes(e,e=>{e?i(e):t()})})},pe.prototype.queryNodesPromise=function(e){return new Promise((t,i)=>{this.queryNodes(e,e=>{e?i(e):t()})})},pe.prototype.queryNodes=function(e,t){const i=this.nodes,o=this._queryNodesLoading,n={};let a=0,s=0;for(const t in e)if(e.hasOwnProperty(t)){const r=e[t];let l=o[t];l||(l=o[t]={});const c=[];for(const e of r){i[t+e]||(l[e]?a++:(l[e]=!0,c.push(e),s++))}c.length&&(n[t]=c)}0!==s||0!==a?(this._queryNodesCallbacks.push(t),s>0&&(this._queryNodesCount++,this.sqldb.queryNodes2(n).then(e=>{for(const t of e)i[t._id]=t;this._queryNodesDone()}).catch(e=>{console.warn(e),this._queryNodesDone()}))):t()},pe.prototype._queryNodesDone=function(){if(this._queryNodesCount--,0===this._queryNodesCount){const e=this._queryNodesCallbacks;this._queryNodesCallbacks=[],this._queryNodesLoading={};for(const t of e)try{t()}catch(e){console.warn(e)}}},pe.prototype.loadNodes2=function(e,t,i){const o=this;var n=this.schema.types,a=this.nodes;t=t||{};var s={};function r(e){for(var t=0,i={},n=0;n<e.length;n++){var s=e[n];if(!a[s]){var r=le.exec(s);if(r){var c=r[1],d=parseInt(r[2]),h=i[c];h?h.push(d):i[c]=[d],t++}}}t>0?o.queryNodes(i,t=>{l(e)}):l(e)}function l(e){const o=[];for(var l=0;l<e.length;l++){const i=e[l];if(s[i])continue;s[i]=!0;const r=a[i];if(!r)continue;const c=le.exec(i);if(!c)continue;const d=c[1],h=(parseInt(c[2]),t[d]);if(h)for(let e=0;e<h.length;e++){const t=h[e],i=r[t];if(null!=i){const e=n[d];if(e){const n=e.fields[t];if(n)if(n.isReference){const e=n.refTypeId+i;s[e]||(s[e]=!0,o.push(e))}else if(n.isReverse)for(let e=0;e<i.length;e++){const t=n.refTypeId+i[e];s[t]||(s[t]=!0,o.push(t))}}}}}o.length?r(o):i()}r(e)},pe.prototype.loadNodes3=function(e,t,i){const o=this.nodes,n=[],a={};a[e]=n;for(const i of t)o[e+i]||n.push(i);if(!n.length)return i();this.queryNodes(a,e=>{i(e)})},pe.prototype.loadNodes4=function(e,t,i,o){this.loadNodes2(t.map(t=>e+t),i,o)},pe.prototype.loadNode=function(e,t){if(!e)return t(void 0);var i=this.nodes[e];if(i)return t(void 0,i);const o=schemas.tidOf(e),n=schemas.ridOf(e);var a={};a[o]=[n],this.queryNodes(a,()=>{t(void 0,this.nodes[e])})},pe.prototype.loadNode2=function(e,t,i){if(!e||!t)return i(void 0,void 0);const o=e+t,n=this.nodes[o];if(n)return i(void 0,n);const a={};a[e]=[t],this.queryNodes(a,()=>{const e=this.nodes[o];i(void 0,e)})},pe.prototype.loadNodeSync2=function(e,t){if(e&&t){var i=e+t;return this.nodes[i]}},pe.prototype._get=function(e,t){return new Promise(i=>{if(!e||!t)return i(void 0);var o=e+t,n=this.nodes[o];if(n)return i(n);var a={};a[e]=[t],this.queryNodes(a,()=>{i(this.nodes[o])})})},pe.prototype.loadNodeSync=function(e){return this.nodes[e]},pe.prototype.get=function(e){return new Promise(t=>{const i=this.nodes[e];if(i)return t(i);const o=le.exec(e);if(!o)return t(void 0);const n=o[1],a=parseInt(o[2]),s={};s[n]=[a],this.queryNodes(s,()=>{t(this.nodes[e])})})},pe.prototype.getTermsForSearchString=function(e){if(!e||"string"!=typeof e)return[];var t=e.trim().toLocaleLowerCase().split(/\s+/);if(!t.length)return[];for(var i=[],o=0;o<t.length;o++){(r=t[o]).length>0&&i.push(r)}if(!i.length)return[];var n=locale.yes.toLocaleLowerCase(),a=locale.no.toLocaleLowerCase(),s=[];for(o=0;o<i.length;o++){var r=i[o],l=[];if(/\*/.test(r)?l.push(r):l.push(r+"*"),"yes"===r||r===n)l.push("[T]");else if("no"===r||r===a)l.push("[F]");else if(util.isLocaleDate(r)){var c=util.parseLocaleDate(r);if(null!=c&&!isNaN(c)){var d=new Date(c),h=d.getFullYear(),p=d.getMonth()+1,u=d.getDate();l.push(h+(p<10?"0":"")+p+(u<10?"0":"")+u)}}l.length&&s.push(l)}return s},pe.prototype.getFulltextQuery=function(e,t){var i=e.getFulltextTokens(),o=e.id,n="";if(t.length){for(var a=[],s=0;s<t.length;s++){var r=t[s];if(r.length){for(var l=[],c=0;c<r.length;c++){var d,h,p=r[c];l.push('"'+me(p)+'"'),"*"===p[0]?"*"===p[p.length-1]?(d=3,h=p.substr(1,p.length-2)):(d=1,h=p.substr(1)):"*"===p[p.length-1]?(d=2,h=p.substr(0,p.length-1)):(d=0,h=p);for(var u=0;u<i.length;u++){var f=i[u],m=f.match;m.length>=h.length&&(0===d&&h==m||1===d&&m.substr(m.length-h.length)==h||2===d&&m.substr(0,h.length)==h||3===d&&-1!==m.indexOf(h))&&l.push('"'+me(f.token)+'"')}}1===l.length?a.push(l[0]):l.length>1&&a.push("("+l.join(" OR ")+")")}}n=" WHERE content MATCH "+he(a.join(" AND "))}return"SELECT docid FROM s_"+o+n},pe.prototype.fastSearch=async function(e,t,i){try{var o=this.schema,n=this.getTermsForSearchString(t);if(!n.length)return i(void 0,[]);var a,s=null;if(e)try{s=queries.parseSystem(o,void 0,e,{})}catch(e){return i(e)}s?(a={})[s.type.id]=s.type:a=this.schema.types;var r={};for(var l in a)if(a.hasOwnProperty(l)){var c=a[l];if(!1===c.globalSearch)continue;e=this.getFulltextQuery(c,n);var d=await this.sqldb.queryScalar(e);d.length&&(r[l]=d.slice(0,100))}i(void 0,r)}catch(e){console.warn("SyncDB.fastSearch: Failed",e),i(e)}},pe.prototype.selectRids=function(e,t,i){const o="SELECT _id FROM t_"+e+(t?" WHERE "+t:""),n=this._selectRidsCache[o];if(n)return void i(void 0,n);const a=this._queryLoading[o];a?a.push(i):(this._queryLoading[o]=[i],this.sqldb.queryScalar2(o,[]).then(e=>{this._selectRidsCache[o]=e;const t=this._queryLoading[o];if(t){delete this._queryLoading[o];for(const i of t)try{i(void 0,e)}catch(e){}}}).catch(e=>{console.warn(e);const t=this._queryLoading[o];if(t){delete this._queryLoading[o];for(const i of t)try{i(e)}catch(e){}}}))},pe.prototype.selectFromTypeWhere=function(e,t,i){this.selectFromTypeWhereSQL(e,t,t&&t.getSQLFilter(),i)};function ue(e){var t=e.objects;if(!t)return[];for(var i=[],o=0;o<t.length;o++){var n=t[o];n.file&&i.push(n.file)}return i}function fe(e,t){if(!t||0===t.length)return!0;if(e.roles.admin)return!0;for(var i=0;i<t.length;i++)if(e.roles[t[i]])return!0;return!1}function me(e){return e.replace(/[\'\"]/g,"")}function ge(e){switch(e.base){case"number":return"REAL";case"ref":case"boolean":case"date":case"datx":case"time":case"timeinterval":case"timestamp":return"INTEGER";case"choice":case"multi":default:return"TEXT"}}function ve(e,t){var i=k.sortedIndex(e,t);e[i]!==t&&e.splice(i,0,t)}function ye(e,t){return e===t||null===e&&void 0===t||void 0===e&&null===t}function be(e){var t=le.exec(e);if(t)return parseInt(t[2])}function we(e){var t=le.exec(e);if(t)return t[1]}function xe(e,t){var i=new FileReader;i.onerror=function(){t(i.error||"Unknown error")},i.onloadend=function(e){var o=i.result,n=o.indexOf(",");if(-1===n)t("Invalid URL format");else{var a=o.substr(n+1);t(void 0,a)}},i.readAsDataURL(e)}function Te(e){return new Promise((t,i)=>{xe(e,(e,o)=>{e?i(e):t(o)})})}function Ce(e,t){return new Proxy(e,{get:function(e,i,o){return t[i]?t[i]:Reflect.get(e,i,o)}})}function ke(e,t){this.dbms=e,this.id=t.id,this.name=t.name,this.databases={},this.isSyncInProgress=!1,this._syncCallbacks=[],this.settings={};var i=dbms.getRemoteConnection().getAccount(this.id);if(i){var o=i.host,n=i.port,a=!1!==i.ssl,s="/"+this.id;n||(n=a?443:80),this.server=new E({host:o,port:n,path:s,ssl:a,dontShowErrors:!0})}this.init()}pe.prototype.selectFromTypeWhereSQL=function(e,t,i,o){var n=[];this.selectRids(e,i,(i,a)=>{if(i)o(i);else if(t)this.loadNodes4(e,a,t&&t.dependencies||{},i=>{let s=1;for(let i=0;i<a.length;i++){const r=e+a[i],l=this.nodes[r];l&&(s++,t.evaluate(this,l,(e,t)=>{t&&n.push(r),s--,0===s&&o(void 0,n)}))}s--,0===s&&o(void 0,n)});else{for(var s=0;s<a.length;s++){var r=a[s],l=e+r;n.push(l)}o(void 0,n)}})},pe.prototype.select=function(e,t){const i=this._selectCache[e];if(console.log("SyncDB.select: "+e+" - Cached: "+!!i),i)return void t(void 0,i);const o=this._selectQueue[e];if(o)return void o.push(t);let n;this._selectQueue[e]=[t];try{n=queries.parseSystem(this.schema,void 0,e,{})}catch(t){return void this.selectDone(e,t,void 0)}this.selectFromTypeWhereSQL(n.type.id,n.where,n.where&&n.where.getSQLFilter(),(t,i)=>{if(t)return void this.selectDone(e,t,void 0);if(!n.order)return void this.selectDone(e,t,i);const o=n.order.getSyncJS(),a=o?e=>o(o.ctx,self,e):e=>e&&schemas.ridOf(e._id)||0;self.loadNodes2(i,n.order.dependencies,()=>{results.sort((function(e,t){var i=self.nodes[e],o=self.nodes[t];if(i){if(o){var n=a(i),s=a(o);return n<s?-1:n>s?1:0}return 1}return o?-1:0})),self._selectCache[e]=results,this.selectDone(e,t,results)})})},pe.prototype.selectDone=function(e,t,i){const o=this._selectQueue[e];delete this._selectQueue[e];for(const e of o)try{e(t,i)}catch(e){console.log(e)}},pe.prototype.find=function(e,t,i){if(!t)return this.select(e,i);let o;try{o=queries.parseSystem(this.schema,void 0,e,{})}catch(e){return i(e)}if("select"!==o.base)return i("Not a select: "+e);const n=o.type,a=n.id,s=o.where;var r;let l;t&&(r=this.getTermsForSearchString(t)),l=r&&r.length?this.getFulltextQuery(n,r):"SELECT _id FROM t_"+a;const c=[];this.sqldb.queryScalar(l).catch(e=>(console.warn(e),[])).then(e=>{if(s)this.loadNodes4(a,e,s&&s.dependencies||{},t=>{let o=1;for(let t=0;t<e.length;t++){const n=a+e[t],r=this.nodes[n];r&&(o++,s.evaluate(this,r,(e,t)=>{t&&c.push(n),o--,0===o&&i(void 0,c)}))}o--,0===o&&i(void 0,c)});else{for(var t=0;t<e.length;t++){var o=e[t],n=a+o;c.push(n)}i(void 0,c)}})},pe.prototype.selectFindSyncJS=async function(e,t,i,o){var n,a,s=this.schema.types[e];if(!s)return[];i&&(n=this.getTermsForSearchString(i)),a=n&&n.length?this.getFulltextQuery(s,n):"SELECT _id FROM t_"+e;var r=[],l=await this.sqldb.queryScalar(a);if(l)for(var c=0;c<l.length;c++){var d=l[c],h=e+d;if(t)t(await this._get(e,d))&&r.push(h);else r.push(h)}return r},pe.prototype._sqlBeginTransaction=async function(e){try{await this.sqldb.exec("BEGIN TRANSACTION")||(console.warn("BEGIN TRANSACTION failed",e),alert("BEGIN TRANSACTION failed: "+e))}catch(t){throw console.warn("BEGIN TRANSACTION failed exception",e,t),alert("BEGIN TRANSACTION failed: "+e),t}},pe.prototype._sqlCommitTransaction=async function(e){try{await this.sqldb.exec("COMMIT TRANSACTION")||(console.warn("COMMIT TRANSACTION failed",e),alert("COMMIT TRANSACTION failed: "+e))}catch(t){throw console.warn("COMMIT TRANSACTION failed exception",e,t),alert("COMMIT TRANSACTION failed: "+e),t}},pe.prototype._sqlRollbackTransaction=async function(e){try{await this.sqldb.exec("ROLLBACK TRANSACTION")||console.warn("ROLLBACK TRANSACTION failed",e)}catch(t){throw console.warn("ROLLBACK TRANSACTION failed exception",e,t),alert("ROLLBACK TRANSACTION failed: "+e),t}},pe.prototype._begin=async function(e){0===this._transactionDepth&&(this._undoStack=[],this._createdNodes={},this._updatedNodes={},this._removedNodes={},await this._sqlBeginTransaction("normal")),this._transactionDepth++,this.now=Date.now()},pe.prototype._rollback=async function(e){this._transactionDepth--,0===this._transactionDepth&&(this._undoStack=[],this._renamedNodes={},this._createdNodes={},this._updatedNodes={},this._removedNodes={},this._changedNodes={},this.nodes={},this.schemaUpdatedFlag=!1,await this._sqlRollbackTransaction("normal"))},pe.prototype._commit=async function(e){if(this._transactionDepth--,0===this._transactionDepth){var t=this._renamedNodes,i=this._createdNodes,o=this._updatedNodes,n=this._removedNodes,a=this._changedNodes,s=0,r=(Date.now(),{});for(var l in i)if(i.hasOwnProperty(l)){if(!n[l])(c=await this._updateFulltext(l))&&(r[c.query]||(r[c.query]=[]),r[c.query].push(c.args),s++)}for(var l in o)if(o.hasOwnProperty(l)){if(!n[l]&&!i[l])(c=await this._updateFulltext(l))&&(r[c.query]||(r[c.query]=[]),r[c.query].push(c.args),s++)}for(var l in n)if(n.hasOwnProperty(l)){var c;(c=await this._removeFulltext(l))&&(r[c.query]||(r[c.query]=[]),r[c.query].push(c.args),s++)}for(var l in a)a.hasOwnProperty(l)&&s++;var d=[];for(var h in r){var p=r[h];d.push({query:h,args:p})}d.length&&await this.sqldb.exec3(d);Date.now();if(this._renamedNodes={},this._createdNodes={},this._updatedNodes={},this._removedNodes={},this._changedNodes={},await this._sqlCommitTransaction("normal"),s&&this.setDirty(),this._undoStack.length&&ui.undoManager.push({title:locale.dataChange,db:this,exec:this._undo,stack:this._undoStack}),this._undoStack=[],this.schemaUpdatedFlag){this.schemaUpdatedFlag=!1;var u=this.schemaUpdateCallbacks;this.schemaUpdateCallbacks=[];for(var f=0;f<u.length;f++)setTimeout(u[f],0);this.triggerSchemaUpdate(!1,!0),this.syncTrigger()}else{var m,g,v,y,b,w=this.listeners;for(l in m=w["*:rename"]||[],t)if(t.hasOwnProperty(l))for(v=(g=w[l+":rename"])?m.concate(g):m,b=["rename",l,t[l]],f=0;f<v.length;f++)try{v[f].f.apply(v[f].c,b)}catch(e){console.warn(e)}if(s>1e3)this.triggerSchemaUpdate(null,null);else{for(l in m=w["*:create"]||[],i)if(i.hasOwnProperty(l)&&!n[l])for(v=(g=w[(y=we(l))+":create"])?m.concate(g):m,b=["create",y,l],f=0;f<v.length;f++)try{v[f].f.apply(v[f].c,b)}catch(e){console.warn(e)}for(l in m=w["*:change"]||[],o)if(o.hasOwnProperty(l)&&!i[l]&&!n[l])for(v=(g=w[l+":change"])?m.concate(g):m,b=["change",l],f=0;f<v.length;f++)try{v[f].f.apply(v[f].c,b)}catch(e){console.warn(e)}for(l in m=w["*:change"]||[],a)if(a.hasOwnProperty(l)&&!o[l]&&!i[l]&&!n[l])for(v=(g=w[l+":change"])?m.concate(g):m,b=["change",l],f=0;f<v.length;f++)try{v[f].f.apply(v[f].c,b)}catch(e){console.warn(e)}for(l in m=w["*:remove"]||[],n)if(n.hasOwnProperty(l))for(v=(g=w[l+":remove"])?m.concate(g):m,b=["remove",l],f=0;f<v.length;f++)try{v[f].f.apply(v[f].c,b)}catch(e){console.warn(e)}for(v=w["*:*"]||[],b=["*:*"],f=0;f<v.length;f++)try{v[f].f.apply(v[f].c,b)}catch(e){console.warn(e)}}s&&this.syncTrigger()}}},pe.prototype._pushUndoStack=function(e){this._undoStack.push(e)},pe.prototype._undo=async function(e){try{0;var t=this.stack,i=this.db;i.suppressTriggers=!0,await i._begin("undo");for(var o=t.length-1;o>=0;o--){var n=t[o];switch(n.op){case"update":await i._update(n.nid,n.fid,n.old);break;case"updates":await i._updateNodes(n.updates,{});break;case"create":await i._remove(n.nid);break;case"remove":await i._restoreFromTrash(n.nid)}}await i._commit("undo"),i.suppressTriggers=!1,e()}catch(t){console.warn("SyncDB._undo: Failed",t),await i._rollback("_undo").catch(e=>console.warn("SyncDB._undo: Rollback failed",e)),e(t)}},pe.prototype._moveToTrash=function(e){var t=e._id,i=util.clone(e);this.trashcan[t]=i,this._pushUndoStack({op:"remove",nid:t}),this._moveFilesToTrash(t)},pe.prototype._restoreFromTrash=async function(e){var t=le.exec(e);if(t){var i=t[1],o=parseInt(t[2]),n=this.schema.types[i];if(n){var a=this.trashcan[e];if(a){delete this.trashcan[e];var s=this.tables[i];s||(s=this.tables[i]=[]),s[o]=a,this._restoreFilesFromTrash(e);var r={};for(var l in a)if(a.hasOwnProperty(l)&&"_"!==l[0]){if(h=n.fields[l]){var c=a[l];(h.isField||h.isReference)&&"fn"!==h.base&&(r[l]=c)}}var d=n.fields;for(var l in d)if(d.hasOwnProperty(l)){var h;if((h=d[l]).isReference){if(g=a[l])if(m=await this._get(h.refType.id,g))(p=m[h.refFieldId])&&ve(p,o);else a[l]=void 0}else if(h.isReverse){var p;if((p=a[l])&&p.length>0){for(var u=[],f=0;f<p.length;f++){var m,g=p[f];if(m=await this._get(h.refType.id,g)){var v=m._id;m[h.refFieldId]||(m[h.refFieldId]=o,await this.writeUpdateReference(h.refType.id,g,h.refFieldId,o),u.push(g),this._changedNodes[v]=!0)}}a[l]=u}}}this._pushUndoStack({op:"create",nid:e}),this.nodeCount++}}}},pe.prototype.authorizationOpen=!0,pe.prototype.authorizationPrint=!0,pe.prototype.authorizationExport=!0,pe.prototype.authorizationImport=!0,pe.prototype.authorizationMassDataUpdate=!0,pe.prototype.authorizationHistory=!0,pe.prototype.ridOf=be,pe.prototype.tidOf=we,pe.prototype.ridOfNode=schemas.ridOfNode,pe.prototype.countFiles=async function(e){try{var t=le.exec(e);if(!t)return!1;var i=t[1],o=parseInt(t[2]),n=await this._get(i,o);if(!n)return!1;var a=this.schema.types[i];if(!a)return;var s=a.fields,r={};for(var l in s)if(s.hasOwnProperty(l)){if("file"===s[l].base){var c=n[l];c&&(r[c.normalize("NFC")]=!0)}}var d=this.path;return await localFileSystem.countFiles(d+"/files/"+i+"/"+o,r)}catch(e){return console.warn("SyncDB.countFiles: Failed",e),0}},pe.prototype.loadFiles=async function(e,t){let i=void 0,o=void 0;try{var n=le.exec(e);if(!n)throw new Error("Invalid nid "+e);var a=n[1],s=parseInt(n[2]),r=this.path;const t=await localFileSystem.listFiles(r+"/files/"+a+"/"+s);for(var l=[],c=0;c<t.length;c++)l.push({name:t[c].normalize("NFC")});o=l}catch(e){i=exc,console.warn("SyncDB.loadFiles: Failed",e)}t(i,o)},pe.prototype.removeFile=async function(e,t,i){let o=void 0;try{await this.acquireLock("removeFile");var n=this;if(this.readOnly)throw new Error("Write-protected");var a=le.exec(e);if(!a)throw new Error("Invalid nid "+e);var s=a[1],r=parseInt(a[2]),l=this.path,c=this.sqldb;await localFileSystem.removeFileAndThumbs(l+"/files/"+s+"/"+r+"/"+t,[".thumb_",".thumb2_"]),await c.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,3,0)",[e,t]),n.syncTrigger()}catch(e){o=e,console.warn("SyncDB.removeFile: Failed",e)}finally{this.releaseLock("removeFile")}i(o)},pe.prototype.renameFile=async function(e,t,i,o){let n=void 0;try{await this.acquireLock("renameFile");var a=this;if(this.readOnly)throw new Error("Write-protected");var s=this.sqldb,r=le.exec(e);if(!r)throw new Error("Invalid nid "+e);var l=r[1],c=parseInt(r[2]);if(!await this._get(l,c))throw new Error("Node not found "+e);var d=this.path,h=d+"/files/"+l+"/"+c+"/"+t,p=d+"/files/"+l+"/"+c+"/"+i;await localFileSystem.removeThumbs(h,[".thumb_",".thumb2_"]),await localFileSystem.move(h,p),await s.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,3,0)",[e,t]),await s.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[e,i]),de++,a.syncTrigger()}catch(e){n=e,console.warn("SyncDB.renameFile: Failed",e)}finally{this.releaseLock("renameFile")}o(n)},pe.prototype.importFile=async function(e,t,i){const o=this;let n=void 0,a=void 0;try{if(await this.acquireLock("importFile"),this.readOnly)throw new Error("Write-protected");var s=le.exec(e);if(!s)throw new Error("Invalid nid "+e);var r=s[1],l=parseInt(s[2]);if(!await this._get(r,l))throw new Error("Node not found "+e);var c=this.path,d=this.sqldb;if("string"==typeof t){var h=util.fileNameOfURL(t);if(!util.isValidFileName(h))throw new Error("Unsupported file name: "+JSON.stringify(h));a=await localFileSystem.importFile(t,c+"/files/"+r+"/"+l),a=a.normalize("NFC"),await d.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[e,a]),de++,o.syncTrigger()}else{if("object"!=typeof t)throw new Error("Missing argument: file");{if(!util.isValidFileName(t.name))throw new Error("Unsupported file name: "+JSON.stringify(t.name));const i=await Te(t);await localFileSystem.writeFileBase64(c+"/files/"+r+"/"+l+"/"+t.name,i),a=t.name.normalize("NFC"),await d.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[e,a]),de++,o.syncTrigger()}}}catch(e){n=e,console.warn("SyncDB.importFile: Failed",e)}finally{this.releaseLock("importFile")}i(n,a)},pe.prototype.importFileFromURL=async function(e,t,i,o){let n=void 0,a=void 0;await this.acquireLock("importFileFromURL");try{a=this._importFileFromURL(e,t,i)}catch(e){n=e}finally{this.releaseLock("importFileFromURL")}o(n,i)},pe.prototype._importFileFromURL=async function(e,t,i){if(this.readOnly)throw new Error("Write-protected");if(i=i.normalize("NFC"),!util.isValidFileName(i))throw new Error("Unsupported file name: "+JSON.stringify(i));const o=le.exec(e);if(!o)throw new Error("Invalid nid "+e);const n=o[1],a=parseInt(o[2]);if(!await this._get(n,a))throw new Error("Node not found "+e);return await localFileSystem.downloadFile(t,this.path+"/files/"+n+"/"+a+"/"+i),await this.sqldb.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[e,i]),de++,this.syncTrigger(),i},pe.prototype.importData=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");if(i=i.normalize("NFC"),!util.isValidFileName(i))return o("Unsupported file name: "+JSON.stringify(i));const n=le.exec(t);if(!n)return o("Invalid nid "+t);const a=n[1],s=parseInt(n[2]);let r=void 0;try{if(await this.acquireLock("importData"),!await this._get(a,s))throw new Error("Node not found "+t);await localFileSystem.importData(e,this.path+"/files/"+a+"/"+s+"/"+i),await this.sqldb.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[t,i]),de++,this.syncTrigger()}catch(e){r=e,console.warn("SyncDB.importData: Failed",e)}finally{this.releaseLock("importData")}o(r,i)},pe.prototype.saveFile=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");if(i=i.normalize("NFC"),!util.isValidFileName(i))return o("Unsupported file name: "+JSON.stringify(i));const n=le.exec(e);if(!n)return o("Invalid nid "+e);const a=n[1],s=parseInt(n[2]);let r=void 0;try{const o=await Te(t);try{await this.acquireLock("saveFile"),await localFileSystem.writeFileBase64(this.path+"/files/"+a+"/"+s+"/"+i,o),await this.sqldb.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[e,i]),de++,this.syncTrigger()}finally{this.releaseLock("saveFile")}}catch(e){r=e,console.warn("SyncDB.saveFile: Failed",e)}o(r)},pe.prototype.saveFileBase64=async function(e,t,i,o){if(this.readOnly)return o("Write-protected");if(i=i.normalize("NFC"),!util.isValidFileName(i))return o("Unsupported file name: "+JSON.stringify(i));const n=le.exec(e);if(!n)return o("Invalid nid "+e);const a=n[1],s=parseInt(n[2]);let r=void 0;try{await this.acquireLock("saveFileBase64"),await localFileSystem.writeFileBase64(this.path+"/files/"+a+"/"+s+"/"+i,t),await this.sqldb.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[e,i]),de++,this.syncTrigger()}catch(e){r=e,console.warn("SyncDB.saveFileBase64: Failed",e)}finally{this.releaseLock("saveFileBase64")}o(r)},pe.prototype.saveFileDataURL=function(e,t,i,o){var n=t.split(",")[1];if(!n)return o("Invalid data");this.saveFileBase64(e,n,i,o)},pe.prototype.previewURL1=pe.prototype.downloadURL1=function(e){if(e){var t=ce.exec(e);if(t){var i=t[1],o=t[2],n=t[3],a=this.path;return this.documentDirectory+"/"+a+"/files/"+i+"/"+o+"/"+encodeURIComponent(n)+"?T="+de}}},pe.prototype.previewURL=pe.prototype.downloadURL=function(e,t){var i=le.exec(e);if(i){var o=i[1],n=parseInt(i[2]),a=this.path;return t=t.normalize("NFC"),this.documentDirectory+"/"+a+"/files/"+o+"/"+n+"/"+encodeURIComponent(t)+"?T="+de}},pe.prototype.thumbURL1=function(e){if(e){var t=ce.exec(e);if(t){var i=t[1],o=t[2],n=t[3],a=n.substring(0,n.lastIndexOf("."))+".jpg";n=n.normalize("NFC"),a=a.normalize("NFC");var s=this.path;return localFileSystem.getDocumentDirectoryProxy()+"/"+s+"/files/"+i+"/"+o+"/.thumb_"+encodeURIComponent(a)+"?T="+de}}},pe.prototype.thumbURL2=function(e,t){if(t){t=t.normalize("NFC");var i=le.exec(e);if(i){var o=i[1],n=i[2],a=this.path,s=t.substring(0,t.lastIndexOf("."))+".jpg";return s=s.normalize("NFC"),localFileSystem.getDocumentDirectoryProxy()+"/"+a+"/files/"+o+"/"+n+"/.thumb_"+encodeURIComponent(s)+"?T="+de}}},pe.prototype.thumb2URL1=function(e){if(e){var t=ce.exec(e);if(t){var i=t[1],o=t[2],n=t[3],a=n.substring(0,n.lastIndexOf("."))+".jpg";n=n.normalize("NFC"),a=a.normalize("NFC");var s=this.path;return localFileSystem.getDocumentDirectoryProxy()+"/"+s+"/files/"+i+"/"+o+"/.thumb2_"+encodeURIComponent(a)+"?T="+de}}},pe.prototype.thumb2URL2=function(e,t){if(t){t=t.normalize("NFC");var i=le.exec(e);if(i){var o=i[1],n=i[2],a=this.path,s=t.substring(0,t.lastIndexOf("."))+".jpg";return s=s.normalize("NFC"),localFileSystem.getDocumentDirectoryProxy()+"/"+a+"/files/"+o+"/"+n+"/.thumb2_"+encodeURIComponent(s)+"?T="+de}}},pe.prototype.fileURL1=function(e){if(e){var t=ce.exec(e);if(t){var i=t[1],o=t[2],n=t[3];n=n.normalize("NFC");var a=this.path;return localFileSystem.getDocumentDirectoryProxy()+"/"+a+"/files/"+i+"/"+o+"/"+encodeURIComponent(n)+"?T="+de}}},pe.prototype.serverFileURL1=function(e){return this.server.fileURL1(e)},pe.prototype.fileURL2=function(e,t){if(t){t=t.normalize("NFC");var i=le.exec(e);if(i){var o=i[1],n=i[2],a=this.path;return localFileSystem.getDocumentDirectoryProxy()+"/"+a+"/files/"+o+"/"+n+"/"+encodeURIComponent(t)+"?T="+de}}},pe.prototype.previewFile=function(e,t){var i=le.exec(e);if(i){var o=i[1],n=parseInt(i[2]);if(t){t=t.normalize("NFC");var a=this.path,s=this.documentDirectory+"/"+a+"/files/"+o+"/"+n+"/"+encodeURIComponent(t);NinoxDocumentInteraction.previewDocument(s,(function(){}))}}},pe.prototype.setBackgroundFile=function(e,t){var i=this;this.server.uploadBackground({file:e},(function(e,o){if(e)return t(e);i.settings=o,i.updateAuthorization(),i.syncBackgroundFileTrigger(),t()}))},pe.prototype.backgroundURL=function(e){return localFileSystem.getDocumentDirectoryProxy()+"/"+this.path+"/background.jpg?T="+de},pe.prototype.userName=function(e){if(void 0===e)return"";var t=this.users[e];return t?t.caption:locale.unknown},pe.prototype.listReports=function(e){e(void 0,this.reports)},pe.prototype.loadReport=function(e,t){t(void 0,this.reports[e])},pe.prototype.updateReport=async function(e,t){let i=void 0;try{await this.acquireLock("updateReport"),await this.sqldb.exec2("REPLACE INTO reports (reportid, report, sync) VALUES (?,?,1)",[e.id,JSON.stringify(e)]),this.reports[e.id]=e,this.syncTrigger()}catch(e){i=e,console.warn("SyncDB.updateReport: Failed",e)}finally{this.releaseLock("updateReport")}t(i)},pe.prototype.removeReport=async function(e,t){let i=void 0;try{await this.acquireLock("removeReport"),await this.sqldb.exec2("UPDATE reports SET sync=2 WHERE reportid=?",[e]),await this.sqldb.exec2("DELETE FROM reportfiles WHERE reportid=?",[e]),delete this.reports[e]}catch(e){i=e,console.warn("SyncDB.removeReport: Failed",e)}finally{this.releaseLock("removeReport")}t(i)},pe.prototype.importReportFile=function(e,t,i){var o=this;o.server.importReportFile(e,t,(function(n,a){if(n)return i(n);xe(t,(async function(t,n){if(t)return i(t);try{await localFileSystem.writeFileBase64(o.path+"/reports/"+e+"/files/"+a,n),de++,setTimeout(i,0,null,a)}catch(t){setTimeout(i,0,t)}}))}))},pe.prototype.saveReportFile=function(e,t,i,o){o()},pe.prototype.removeReportFile=function(e,t,i){i()},pe.prototype.cleanReportFiles=function(e,t,i){i()},pe.prototype.copyReportFiles=function(e,t,i){i()},pe.prototype.reportFileURL=function(e,t){return this.documentDirectory+"/"+this.path+"/reports/"+encodeURIComponent(e)+"/files/"+encodeURIComponent(t)},pe.prototype.reportFileURLProxy=function(e,t){return localFileSystem.getDocumentDirectoryProxy()+"/"+this.path+"/reports/"+encodeURIComponent(e)+"/files/"+encodeURIComponent(t)},pe.prototype.reportFileServerURL=function(e,t){return this.server.reportFileURL(e,t)},pe.prototype.setAdminMode=function(e){this.adminMode=!!e,this.triggerAdmin(this.adminMode)},pe.prototype.typeOf=function(e){return this.schema.typeOf(e)},pe.prototype.saveSchema=function(e){this.updateSchema(this.schema,(function(t){t&&$.alert(t),e&&e()}))},pe.prototype.resetSchema=async function(e){let t=void 0;try{await this.acquireLock("resetSchema"),ui.undoManager.cancel(),await this.setSchema(this.originalSchema,void 0),this.triggerSchemaUpdate(!1,!0)}catch(e){t=e,console.warn("SyncDB.resetSchema: Failed",e)}finally{this.releaseLock("resetSchema")}e&&e(t)},pe.prototype.updateSchema=function(e,t){var i=this;ui.undoManager.cancel();var o=e.validate();if(o)return t(o);if(!NinoxDocumentInteraction.isOnline())return t(locale.notConnected);i.schemaUpdateCallbacks.push(t),e.protectUpdated();var n=e.toJSON();n.password=i.schemaPassword,i.server.sendUpdateSchema(n,(function(e,o){if(e){alert("Failed to update schema: "+e);var n=i.schemaUpdateCallbacks.indexOf(t);-1!==n&&(i.schemaUpdateCallbacks.splice(n,1),t(e))}}))},pe.prototype.applySchemaUpdate=async function(e){var t=this,i=this.sqldb,o=schemas.getSQLTableDefinitions(this.originalSchema).types||{},n=e.types;for(var a in o)o.hasOwnProperty(a)&&!n[a]&&await g(a);for(var a in n)if(n.hasOwnProperty(a)&&!o[a]){var s=n[a];await m(s)}for(var a in n)if(n.hasOwnProperty(a)){var r=o[a],l=n[a],c=r&&r.fields||{},d=l.fields;for(var h in c)c.hasOwnProperty(h)&&!d[h]&&await u(a,h);for(var h in d)if(d.hasOwnProperty(h)&&!c[h]){var p=d[h];await f(p)}}function u(e,t){}async function f(e){if("fn"!==e.base&&!e.isReverse){var t=e.type;await i.exec("ALTER TABLE t_"+t.id+" ADD COLUMN f_"+e.id+" "+ge(e)),"ref"===e.base&&await i.exec("CREATE INDEX IF NOT EXISTS i_"+t.id+"_"+e.id+" ON t_"+t.id+" (f_"+e.id+") WHERE f_"+e.id+" IS NOT NULL")}}async function m(e){var t=e.id;await i.execBatched(["CREATE TABLE t_"+t+" (_id INTEGER PRIMARY KEY AUTOINCREMENT,_cu TEXT NOT NULL,_cd DATETIME NOT NULL,_mu TEXT NOT NULL,_md DATETIME NOT NULL)","CREATE VIRTUAL TABLE s_"+t+' USING fts4(content, tokenize=unicode61 "tokenchars=[]:-.#+")',"INSERT INTO s_"+t+"(s_"+t+") VALUES('automerge=8')"])}async function g(e){var o=e,n=e+"~";await i.execBatched(["DROP TABLE t_"+e,"DROP TABLE s_"+e]);var a=[[o,n]];await i.exec3([{query:"DELETE FROM files WHERE nid>? AND nid<?",args:a},{query:"DELETE FROM sync_removes WHERE nid>? AND nid<?",args:a},{query:"DELETE FROM sync_creates WHERE nid>? AND nid<?",args:a},{query:"DELETE FROM sync_updates WHERE nid>? AND nid<?",args:a}]),await localFileSystem.remove(t.path+"/files/"+e).catch(e=>{console.warn(e)})}t.nodes={}},pe.prototype.removeTypeFiles=function(e,t){t()},pe.prototype.setSchema=async function(e,t){this.schema&&this.schema.off("change",this.schemaChanged,this),t||(t=new schemas.Schema(this,e)),this.schema=t,await this.sqldb.setSchema(t.getSQLTableDefinitions()),this.originalSchema=e,this.schema.on("change",this.schemaChanged,this)},pe.prototype.schemaChanged=function(){this.triggerSchemaUpdate(!0,!1)},pe.prototype.on=function(e,t,i,o){var n=(t||"*")+":"+(e||"*"),a=this.listeners[n];this.listeners[n]=a?this.listeners[n].concat([{f:i,c:o}]):[{f:i,c:o}]},pe.prototype.onCreate=function(e,t,i){this.on("create",e,t,i)},pe.prototype.onRemove=function(e,t,i){this.on("remove",e,t,i)},pe.prototype.onUpdate=function(e,t,i,o){this.on(t?"update:"+t:"update",e,i,o)},pe.prototype.onChange=function(e,t,i){this.on("change",e,t,i)},pe.prototype.onComment=function(e,t,i){this.on("comment",e,t,i)},pe.prototype.onFile=function(e,t,i){this.on("file",e,t,i)},pe.prototype.onView=function(e,t){this.on("view",void 0,e,t)},pe.prototype.onChat=function(e,t){this.on("chat",void 0,e,t)},pe.prototype.off=function(e,t,i,o){var n=(t||"*")+":"+(e||"*"),a=this.listeners[n];if(a){for(var s=[],r=0;r<a.length;r++){var l=a[r];(i&&l.f!==i||o&&l.c!==o)&&s.push(l)}this.listeners[n]=s}else console.warn("Inconsistent database.off")},pe.prototype.offCreate=function(e,t,i){this.off("create",e,t,i)},pe.prototype.offChange=function(e,t,i){this.off("change",e,t,i)},pe.prototype.offRemove=function(e,t,i){this.off("remove",e,t,i)},pe.prototype.offUpdate=function(e,t,i,o){this.off(t?"update:"+t:"update",e,i,o)},pe.prototype.offComment=function(e,t,i){this.off("comment",e,t,i)},pe.prototype.offFile=function(e,t,i){this.off("file",e,t,i)},pe.prototype.offView=function(e,t){this.off("view",void 0,e,t)},pe.prototype.offChat=function(e,t){this.off("chat",void 0,e,t)},pe.prototype.triggerSchemaUpdate=function(e,t){var i=this.listeners["*:schema"];if(i)for(var o=["schema",e,t],n=0;n<i.length;n++)try{i[n].f.apply(i[n].c,o)}catch(e){console.warn(e)}},pe.prototype.triggerAdmin=function(e){var t=this.listeners["*:admin"];if(t)for(var i=["admin",e],o=0;o<t.length;o++)try{t[o].f.apply(t[o].c,i)}catch(e){console.warn(e)}},pe.prototype.loadViews=function(e){e(void 0,this.views)},pe.prototype.saveView=async function(e,t){if(this.readOnly)return t("Write-protected");this.views[e.id]=e;let i=void 0;try{if(await this.acquireLock("saveView"),this.user.roles.admin){var o=util.getPersistentView(e),n=await this.sqldb.queryOneScalar2("SELECT view FROM views WHERE viewid=?",[e.id]),a=n?util.parseJSON(n):void 0;a&&util.viewEquals(o,a)||(await this._begin("saveView"),await this.sqldb.exec2("REPLACE INTO views (viewid, view, sync) VALUES (?,?,1)",[e.id,JSON.stringify(o)]),await this._commit("saveView"))}}catch(e){i=e,console.warn("SyncDB.saveView: Failed",e),await this._rollback("saveView").catch(e=>console.warn("SyncDB.saveView: Rollback Failed",e))}finally{this.releaseLock("saveView")}t(i)},pe.prototype.removeView=async function(e,t){if(this.readOnly)return t("Write-protected");if(!this.user.roles.admin)return t();if(!this.views[e])return t();delete this.views[e];let i=void 0;try{await this.acquireLock("removeView"),await this._begin("removeView"),await this.sqldb.exec2("UPDATE views SET sync=2 WHERE viewid=?",[e]),await this._commit("removeView")}catch(e){i=e,console.warn("SyncDB.removeView: Failed",e),await this._rollback("removeView").catch(e=>console.warn("SyncDB.removeView: Rollback Failed",e))}finally{this.releaseLock("removeView")}t(i)},pe.prototype.saveViews=function(e){e()},pe.prototype.loadHistory=function(e){this.server.loadHistory(e)},pe.prototype.loadNodeHistory=function(e,t){if(!NinoxDocumentInteraction.isOnline())return t("OFFLINE");this.server.loadNodeHistory(e,t)},pe.prototype.loadComments=function(e,t){if(!NinoxDocumentInteraction.isOnline())return t("OFFLINE");this.server.loadComments(e,t)},pe.prototype.postComment=function(e,t,i,o){if(!NinoxDocumentInteraction.isOnline())return o("OFFLINE");this.server.postComment(e,t,i,o)},pe.prototype.removeComment=function(e,t,i){if(!NinoxDocumentInteraction.isOnline())return i("OFFLINE");this.server.removeComment(e,t,i)},pe.prototype.loadCalendar2=async function(e,t,i,o,n){try{var a=this.sqldb,s=this.schema.types,r={},l=new Date,c=new Date(e,null==t?0:t,null==i?0:i),d=new Date(e,null==t?12:t,null==i?31:i+1),h=c.getTime(),p=d.getTime(),u=Date.UTC(e,null==t?0:t,null==i?0:i),f=Date.UTC(e,null==t?12:t,null==i?31:i+1);for(var m in s)if(s.hasOwnProperty(m)){var g=s[m].fields,v=[];for(var y in g)if(g.hasOwnProperty(y)){(_=g[y]).dateCalendar&&v.push(_)}var b=[];for(var y in g)if(g.hasOwnProperty(y)){(_=g[y]).dateCalendar&&("date"===_.base?_.dateYearly?b.push("(f_"+y+" IS NOT NULL)"):b.push("(f_"+y+">="+he(h)+" AND f_"+y+"<="+he(p)+")"):"datx"===_.base?_.dateYearly?b.push("(f_"+y+" IS NOT NULL)"):b.push("(f_"+y+">="+he(u)+" AND f_"+y+"<="+he(f)+")"):"appointment"===_.base&&b.push("(f_"+y+"<"+he(p+"/")+" AND f_"+y+">"+he(h-6048e5+"/")+")"))}if(b.length){var w="SELECT _id FROM t_"+m+" WHERE "+b.join(" OR "),x=await a.queryScalar(w);if(x)for(var T=0;T<x.length;T++){var C=x[T],k=await this._get(m,C);if(k)for(var $=m+C,S=0;S<v.length;S++){var _,E=k[(_=v[S]).id];if(null!=E){"appointment"===_.base&&(E=parseInt(E)),l.setTime(E);var D=l.getFullYear(),N=l.getMonth(),I=l.getDate();if((void 0===e||e===D||_.dateYearly)&&(void 0===t||t===N)&&(void 0===i||i===I)){var O=1e4*D+100*(N+1)+I;if(o){var M=r[O];M?M.push($):r[O]=[$]}else r[O]=!0}}}}}}n(void 0,r)}catch(e){console.warn("SyncDB.loadCalendar2: Failed",e),n(e)}},pe.prototype.loadCalendarFromTo=async function(e,t,i){try{var o=this.sqldb,n=this.schema.types,a=e.getTime(),s=t.getTime(),r=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),l=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),c=[];for(var d in n)if(n.hasOwnProperty(d)){var h=n[d].fields,p=[];for(var u in h)if(h.hasOwnProperty(u)){var f=h[u];f.dateCalendar&&("date"===f.base?f.dateYearly?p.push("(f_"+u+" IS NOT NULL)"):p.push("(f_"+u+">="+he(a)+" AND f_"+u+"<="+he(s)+")"):"datx"===f.base?f.dateYearly?p.push("(f_"+u+" IS NOT NULL)"):p.push("(f_"+u+">="+he(r)+" AND f_"+u+"<="+he(l)+")"):"appointment"===f.base&&p.push("(f_"+u+"<"+he(s+"/")+" AND f_"+u+">"+he(a-6048e5+"/")+")"))}if(p.length){var m="SELECT _id FROM t_"+d+" WHERE "+p.join(" OR "),g=await o.queryScalar(m,[]);if(g)for(var v=0;v<g.length;v++)c.push(d+g[v])}}i(void 0,c)}catch(e){console.warn("SyncDB.loadCalendarFromTo: Failed",e),i(e)}},pe.prototype.selectSyncJS=async function(e,t,i){return[]},pe.prototype.setBackground=function(e,t){var i=this;i.server.setBackground(e,(function(e,o){if(e)return t(e);i.settings=o,i.updateAuthorization(),ui.updateBackground(),t()}))},pe.prototype.updateSettings=function(e,t){var i=this;i.server.updateSettings(e,(function(e,o){e?t&&t(e):(i.settings=o,i.updateAuthorization(),ui.updateBackground(),t&&t(void 0,o))}))},pe.prototype.updateAuthorization=function(){this.authorizationOpen=fe(this.user,this.settings.rolesOpen),this.authorizationHistory=fe(this.user,this.settings.rolesHistory),this.authorizationPrint=fe(this.user,this.settings.rolesPrint),this.authorizationExport=fe(this.user,this.settings.rolesExport),this.authorizationImport=fe(this.user,this.settings.rolesImport),this.authorizationMassDataUpdate=fe(this.user,this.settings.rolesMassDataUpdate)},pe.prototype.getRowIds=async function(e){return await this.sqldb.queryScalar2("SELECT _id FROM t_"+e,[])},pe.prototype.clearHistory=function(e){this.server.clearHistory(e)},pe.prototype.repairSynchronizationProblem=async function(e,t,i){let o=void 0,n=!1;try{if(await this.acquireLock("repairSynchronizationProblem"),!e.actions||-1===e.actions.indexOf(t))return i("Not supported: "+t+".",!1);var a=this.sqldb;switch(t){case"file-download":throw new Error("Not implemented.");case"file-delete":await localFileSystem.remove(e.path),n=!0;break;case"file-pull":await a.exec2("REPLACE INTO files (nid,name,seq,sync) VALUES (?,?,0,1)",[e.tid+e.rid,e.name]),this.syncTrigger(),n=!0;break;case"file-push":case"file-entry-add":await a.exec2("REPLACE INTO files (nid,name,seq,sync) VALUES (?,?,0,2)",[e.tid+e.rid,e.name]),this.syncTrigger(),n=!0;break;case"file-entry-remove":await a.exec2("DELETE FROM files WHERE nid=? AND name=?",[e.tid+e.rid,e.name]),this.syncTrigger(),n=!0;break;case"file-entry-pull":await a.exec2("REPLACE INTO files (nid,name,seq,sync) VALUES (?,?,0,1)",[e.tid+e.rid,e.name]),this.syncTrigger(),n=!0;break;default:throw new Error("Not implemented.")}}catch(e){o=e,console.warn("SyncDB.repairSynchronizationProblem: Failed",e)}finally{this.releaseLock("repairSynchronizationProblem")}i(o,n)},pe.prototype.checkSynchornizationProblems=async function(e){var t=this,i=t.path,o=t.schema.types,n=t.sqldb;try{e(void 0,{files:await a()})}catch(t){e(t)}async function a(){var e=[],a=i+"/files",s={},r=await localFileSystem.listFiles(a);if(r)for(var l=0;l<r.length;l++){var c=r[l],d=o[c],h=a+"/"+c,p=await localFileSystem.stats(h);if(p.err)e.push({tid:c,err:p.err,path:h,actions:["file-delete"]});else if(p.isDirectory)if(schemas.RE_TID.test(c)){d||e.push({tid:c,err:"Removed table directory found.",path:h,size:p.size,actions:["file-delete"]});var u=await localFileSystem.listFiles(h);if(u)for(var f=0;f<u.length;f++){var m=h+"/"+(E=u[f]),g=await localFileSystem.stats(m);if(g.err)e.push({tid:c,rid:E,err:g.err,path:m,actions:["file-delete"]});else if(g.isDirectory)if(schemas.RE_RID.test(E)){var v=c+E,y=await t.get(v);y||e.push({tid:c,err:"Removed record directory found.",path:m,size:g.size,actions:["file-delete"]});var b=await localFileSystem.listFiles(m);if(b)for(var w=0;w<b.length;w++){var x=m+"/"+($=b[w].normalize("NFC")),T=await localFileSystem.stats(x);if(T.err)e.push({tid:c,rid:E,name:$,path:x,err:T.err,actions:["file-delete"]});else if(T.isFile)if(util.isValidFileName($))if(y)(k=await n.queryOne2("SELECT sync,seq FROM files WHERE nid=? AND NAME=?",[v,$]))?s[v+"/"+$]=1:e.push({tid:c,rid:E,name:$,err:"No file sync entry found.",path:x,size:T.size,actions:["file-delete","file-download","file-entry-add"]});else e.push({tid:c,rid:E,name:$,err:"Record has been removed.",path:x,size:T.size,actions:["file-delete","file-download"]});else e.push({tid:c,rid:E,name:$,err:"Invalid file name.",path:x,size:T.size,actions:["file-delete","file-rename","file-download"]});else e.push({tid:c,rid:E,name:$,err:"Not a record file.",path:x,size:T.size,actions:["file-delete"]})}}else e.push({tid:c,rid:E,err:"Invalid record directory found.",path:m,size:g.size,actions:["file-delete"]});else e.push({tid:c,rid:E,err:"Not a record directory.",path:m,size:g.size,actions:["file-delete"]})}}else e.push({tid:c,err:"Invalid table directory found.",path:h,size:p.size,actions:["file-delete"]});else e.push({tid:c,err:"Not a table directory.",path:h,size:p.size,actions:["file-delete"]})}var C=await n.query2("SELECT nid,name,sync,seq FROM files",[]);if(C)for(l=0;l<C.length;l++){v=(k=C[l])[0];var k,$=k[1],S=k[2],_=(k[3],le.exec(v));if(_){c=_[1];var E=_[2];if(util.isValidFileName($))switch(S){case 0:s[v+"/"+$]||e.push({tid:c,rid:E,name:$,err:"File not found locally.",actions:["file-entry-pull"]});break;case 1:e.push({tid:c,rid:E,name:$,err:"File not yet downloaded.",actions:["file-pull"]});break;case 2:s[v+"/"+$]?e.push({tid:c,rid:E,name:$,err:"File not yet uploaded.",actions:["file-push"]}):e.push({tid:c,rid:E,name:$,err:"File not found locally.",actions:["file-entry-remove"]});break;case 11:e.push({tid:c,rid:E,name:$,err:"Failed to download",actions:[]});break;case 12:e.push({tid:c,rid:E,name:$,err:"Failed to upload",actions:[]});break;default:e.push({tid:c,rid:E,name:$,err:"Invalid file entry: "+S,actions:["file-entry-remove"]})}else e.push({tid:c,nid:v,name:$,err:"Invalid file name in file entry: "+$,actions:["file-entry-remove"]})}else e.push({tid:c,nid:v,name:$,err:"Invalid record id in file entry: "+v,actions:["file-entry-remove"]})}return e}},pe.prototype.evaluateOnServer=function(e,t,i){this.server.evaluateOnServer(e,t,(function(e,t){e?($.alert(e),i()):i(t)}))},pe.prototype.sendEmail=function(e,t){this.server.sendEmail(e,t)},pe.prototype.shareFile=function(e,t,i){this.server.shareFile(e,t,i)},pe.prototype.unshareFile=function(e,t,i){this.server.unshareFile(e,t,i)},pe.prototype.loadSharedFile=function(e,t,i){this.server.loadSharedFile(e,t,i)},pe.prototype.shareView=function(e,t,i){this.server.shareView(e,t,i)},pe.prototype.unshareView=function(e,t){this.server.unshareView(e,t)},pe.prototype.loadSharedView=function(e,t){this.server.loadSharedView(e,t)},pe.prototype.addToRevs=function(e,t,i,o){var n=e+i,a=this.nodes[n];a&&(a[t]?a[t]=util.sortedArrayWith(a[t],o):a[t]=[o])},pe.prototype.removeFromRevs=function(e,t,i,o){var n=e+i,a=this.nodes[n];a&&a[t]&&(a[t]=util.sortedArrayWithout(a[t],o))},pe.prototype.printSimple=function(e,t){this.server.printSimple(e,t)},pe.prototype.printRich=function(e,t){this.server.printRich(e,t)},pe.prototype.loadFileURL=function(e,t,i,o){return this.server.loadFileURL(e,t,i,o)},pe.prototype.evaluate=function(e,t,i){e.isUpdating()?this.evaluateUpdating(e,t).then(()=>i()).catch(e=>i(e)):e.evaluate(this,t,i)},pe.prototype.evaluateUpdating=async function(e,t){try{await this.acquireLock(),await this._begin();try{await this.evaluatePromise(e,t),await this._commit()}catch(e){throw await this._rollback(),e}}finally{this.releaseLock()}},Object.assign(ke.prototype,util.events),ke.prototype.base="remote",ke.prototype.drop=function(){},ke.prototype.save=function(){},ke.prototype.update=function(e){this.name=e.name},ke.prototype.listDatabases=function(){return k.filter(util.localeSortBy(this.databases,"name"),(function(e){return e.isOpenable}))},ke.prototype.getDatabaseNames=function(){var e={},t=this.databases;for(var i in t)if(t.hasOwnProperty(i)){e[t[i].name]=!0}return e},ke.prototype.getDatabase=function(e){return this.databases[e]},ke.prototype.ensureDatabase=function(e,t){var i=this,o=i.databases[e];if(o)return t(void 0,o);i.sync(!1,(function(){var o=i.databases[e];t(void 0,o)}))},ke.prototype.resetSync=async function(e){try{await localFileSystem.remove("accounts/"+this.id+"/db/"+e)}catch(e){$.alert(e)}this.sync(!0)},ke.prototype.loadRemoteAccount=function(e){var t=this;return NinoxDocumentInteraction.isOnline()?dbms.getRemoteConnection().getToken()?void t.server.loadAccount(e):e("NOT_SIGNED_ID"):e("OFFLINE")},ke.prototype.loadCachedAccount=async function(){var e=this,t="accounts/"+this.id+"/account.json",i={settings:{},databases:{}};if(await localFileSystem.exists(t).catch(()=>!1))try{var o=await localFileSystem.readFile(t,"utf8");i=JSON.parse(o),e.accountString=o}catch(e){$.alert("Failed to parse cached account info: "+e)}return i},ke.prototype.saveCachedAccount=async function(){var e="accounts/"+this.id+"/account.json",t={id:this.id,name:this.name,settings:this.settings,databases:this.databases},i=JSON.stringify(t);if(i!==this.accountString)try{await localFileSystem.writeFile(e,i,"utf8")}catch(e){console.log(e)}finally{this.accountString=i}},ke.prototype.loadStoredDatabases=async function(){var e={},t=await localFileSystem.listFiles("accounts/"+this.id+"/db").catch(()=>!1);if(t)for(var i=0;i<t.length;i++){var o=t[i];e[o]={id:o}}return e},ke.prototype.init=async function(){var e=this,t=dbms.getRemoteConnection().getAccount(this.id),i=await e.loadCachedAccount(),o=i.databases,n=await e.loadStoredDatabases();for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];s.isStored=!!n[a],s.account=e.id}var r=t?t.name:i.name;e.name!==r&&(e.name=r,await e.saveCachedAccount()),e.databases=o},ke.prototype._callSyncCallbacks=function(){var e=this._syncCallbacks;this._syncCallbacks=[];for(var t=0;t<e.length;t++)setTimeout(e[t],0)},ke.prototype.sync=async function(e,t){var i=this;if(t&&i._syncCallbacks.push(t),!i.isSyncInProgress){i.isSyncInProgress=!0;var o=dbms.getRemoteConnection().getAccount(this.id),n=await i.loadCachedAccount(),a=n.databases,s=await i.loadStoredDatabases();for(var r in a)if(a.hasOwnProperty(r)){var l=a[r];l.isStored=!!s[r],l.account=i.id}var c=o?o.name:n.name;i.name!==c&&(i.name=c,await i.saveCachedAccount()),i.settings=n.settings||{},i.databases=a,NinoxDocumentInteraction.isOnline()?i.loadRemoteAccount((async function(e,t){if(e);else if(t){(i.settings.backgroundTimestamp||0)!=(t.settings&&t.settings.backgroundTimestamp||0)&&await i.removeCachedBackground(),i.settings=t.settings||{};for(var o,n=t.databases||[],a=((await i.loadCachedAccount()).databases,await i.loadStoredDatabases()),s={},r=0;r<n.length;r++){var l=n[r];o=l.id,l.isStored=!!a[o],l.isOpenable=i.canOpenDatabase(l),l.account=i.id,s[o]=l}for(o in a)a.hasOwnProperty(o)&&(s[o]||await i.removeStoredDatabase(o));i.databases=s,await i.saveCachedAccount()}i.isSyncInProgress=!1,i.trigger("change"),i._callSyncCallbacks()})):(i.isSyncInProgress=!1,i.trigger("change"),i._callSyncCallbacks())}},ke.prototype.removeCachedBackground=async function(){var e=this;e._cachedBackground=!1;try{await localFileSystem.remove("accounts/"+e.id+"/background.jpg")}catch(t){console.log("Failed to remove cached background for account "+e.id,t)}finally{e.trigger("change")}},ke.prototype.backgroundURL=async function(){var e=this,t="accounts/"+e.id+"/background.jpg",i=await localFileSystem.fileURLProxy(t).catch(e=>(console.log(e),"ERROR"));if("ERROR"!==i){var o=i+"?T="+(e.settings&&e.settings.backgroundTimestamp||0);if(e._cachedBackground)return o;if(await localFileSystem.exists(t).catch(()=>!1))return e._cachedBackground=!0,o;if(e.settings&&e.settings.backgroundTimestamp)try{await localFileSystem.downloadFile(e.server.backgroundURL(e.settings.backgroundTimestamp),t)}finally{e.trigger("change")}}},ke.prototype.removeStoredDatabase=async function(e){var t="accounts/"+this.id+"/db/"+e;try{await localFileSystem.remove(t)}catch(e){$.alert("Failed to remove: "+t)}},ke.prototype.canOpenDatabase=function(e){var t=e.settings;if(!t)return!0;var i=t.rolesOpen;if(!i||!i.length)return!0;var o=dbms.getRemoteConnection().getCurrentAccountUser(this.id);if(o.roles.admin)return!0;for(var n=0;n<i.length;n++){var a=i[n];if(o.roles[a])return!0}return!1},ke.prototype.openDatabase=function(e,t){var i=this;if("string"==typeof e){var o=e;if(!(e=i.databases[o]))return t("Database not found: "+o+" in account "+i.id)}if(!i.canOpenDatabase(e))return t("Not authorized.");var n=new pe(e,this,i.server.getDBServer(e.id));n.openDatabase(!1,(function(e){if(e)return t(e);window.database=n,t(void 0,n)}))},ke.prototype.openAnotherDatabase=function(e,t){var i=this,o=i.databases[e];if(!o)return t("Database not found: "+e);if(!i.canOpenDatabase(o))return t("Not authorized.");var n=new pe(o,this,i.server.getDBServer(o.id));n.openDatabase(!0,(function(e){if(e)return t(e);t(void 0,n)}))},ke.prototype.createDatabase=function(e,t){var i=this;i.server.createDatabase(e,(function(e,o){trackEvent("createdb",e?"error":"success"),i.sync(!0),t(e,o)}))},ke.prototype.renameDatabase=function(e,t,i){var o=this;o.server.getDBServer(e.id).updateSettings(t,(function(t,n){if(t)return i(t);var a=o.databases[e.id];if(!a)return i("Database not found: "+e.id);n.name&&(a.name=n.name,a.dbname=n.name),a.settings=n,o.saveCachedAccount(),o.sync(!0),i(t,a)}))},ke.prototype.removeDatabase=function(e,t){var i=this;i.server.removeDatabase(e.id,(function(o){o||(delete i.databases[e.id],i.trigger("change")),t(o)}))},ke.prototype.duplicateDatabase=function(){},ke.prototype.isAdmin=function(){return dbms.getRemoteConnection().isAdmin(this.id)},ke.prototype.loadArchive=function(e,t){var i=this;i.server.loadArchive(e,(function(e,o){i.sync(!0),t(e,o)}))},ke.prototype.getRoles=function(){return dbms.getRemoteConnection().getSessionInfo().getRoles(this.id)},ke.prototype.createBackup=function(e,t){this.server.createBackup(e,t)},ke.prototype.listBackups=function(e){this.server.listBackups(e)},ke.prototype.listSnapshots=function(e){this.server.listSnapshots(e)},ke.prototype.removeBackup=function(e,t){this.server.removeBackup(e,t)},ke.prototype.removeSnapshot=function(e,t,i){this.server.removeSnapshot(e,t,i)},ke.prototype.restoreBackup=function(e,t){var i=this;i.server.restoreBackup(e,(function(e){i.sync(!0),t(e)}))},ke.prototype.restoreSnapshot=function(e,t,i){var o=this;o.server.restoreSnapshot(e,t,(function(e){o.sync(!0),i(e)}))},ke.prototype.downloadBackupURL=function(e,t){return this.server.downloadBackupURL(e,t)},ke.prototype.isOwner=function(){var e=dbms.getRemoteConnection();return e.getAccount(this.id).owner===e.getUserId()},ke.prototype.getPlan=function(){return dbms.getRemoteConnection().getSessionInfo().getPlan()},ke.prototype.getInvitations=function(){return dbms.getRemoteConnection().listInvitations(this.id)},ke.prototype.getMembers=function(){return dbms.getRemoteConnection().listAccountUsers(this.id)},ke.prototype.getOwnerId=function(){return dbms.getRemoteConnection().getAccount(this.id).owner},ke.prototype.getCurrentUser=function(){return dbms.getRemoteConnection().getCurrentUser()},ke.prototype.getCurrentUserId=function(){const e=this.getCurrentUser();return e?e.id:void 0},ke.prototype.isRootUser=function(){return dbms.getRemoteConnection().getSessionInfo().user.isRoot};const $e=/^[a-zA-Z0-9]+$/;function Se(){this.localAccount=null,this.remoteAccounts={}}Object.assign(Se.prototype,util.events),Se.prototype.bootstrap=async function(e){try{var t=this;if(this.remote=new T,this.messageService=new S(this),this.remoteAccounts={},Object(c.f)()||(this.localAccount=new re(this)),!await localFileSystem.ensureDirectory("accounts"))return e("Cannot create accounts directory");for(var i=await localFileSystem.listFiles("accounts"),o=0;o<i.length;o++){var n=i[o];if($e.test(n)){var a=void 0;try{var s=await localFileSystem.readFile("accounts/"+n+"/account.json","utf8");s&&(a=JSON.parse(s))}catch(e){console.log("Invalid account config: "+n,e)}a&&a.id===n&&(this.remoteAccounts[n]=new ke(this,a))}}}catch(t){return console.log(t),e(t)}dbms.getRemoteConnection().refresh((function(i){t.syncAccounts((function(){t.fasttrackOnboarding((function(){t.remote.on("change",$.proxy(t.remoteChanged,t)),e()}))}))}),!0)},Se.prototype.fasttrackOnboarding=function(e){return e()},Se.prototype.getRemoteConnection=function(){return this.remote},Se.prototype.listAccounts=function(){return Object(c.f)()?util.localeSortBy(this.remoteAccounts,"name"):(this.localAccount?[this.localAccount]:[]).concat(util.localeSortBy(this.remoteAccounts,"name"))},Se.prototype.getRemoteAccounts=function(){return this.remoteAccounts},Se.prototype.getLocalAccount=function(){return this.localAccount},Se.prototype.getDefaultAccount=function(){return Object(c.f)()?this.listAccounts()[0]:this.localAccount},Se.prototype.getDefaultAccountId=function(){if(Object(c.f)()){var e=this.listAccounts()[0];return e?e.id:void 0}return"local"},Se.prototype.getAccount=function(e){return"local"===e?this.localAccount:this.remoteAccounts[e]},Se.prototype.getRemoteAccount=function(e){return this.remoteAccounts[e]},Se.prototype.syncAccounts=function(e){var t,i=this.remoteAccounts,o=this.remote.getAccounts();if(o){for(t in i){if(!o.hasOwnProperty(t))i[t].drop(),delete i[t]}for(t in o)if(o.hasOwnProperty(t)){var n=i[t],a=o[t];n?n.update(a):((n=new ke(this,a)).save(),i[t]=n)}}e&&e()},Se.prototype.remoteChanged=function(){var e=this;e.syncAccounts((function(){e.trigger("change")}))},Se.prototype.closeDatabase=function(e){window.database?window.database.closeDatabase((function(){window.database=null,e()})):e()},Se.prototype.getAllDatabases=function(){var e=[];if(!Object(c.f)()){var t=this.localAccount;t&&(e=e.concat(t.listDatabases()))}var i=this.remoteAccounts;for(var o in i)if(i.hasOwnProperty(o)){var n=i[o];e=e.concat(n.listDatabases())}return e},Se.prototype.getLocalDatabases=function(){var e=[];if(!Object(c.f)()){var t=this.localAccount;t&&(e=e.concat(t.listDatabases()))}return e},Se.prototype.openAnotherDatabase=function(e,t,i){var o;if(!(o="local"===e?this.localAccount:this.remoteAccounts[e]))return i("Account not found: "+e);o.openAnotherDatabase(t,i)};var _e=o("./src/js/printer/printNode.js"),Ee=o("./src/js/printer/printTable.js"),De=o("./src/js/printer/renderNodeHTML.js"),Ne=o("./src/js/printer/renderTableHTML.js");function Ie(){const e={printNode:_e.a,printTable:Ee.a,renderNodeHTML:De.a,renderTableHTML:Ne.a};return e.aggSymbol=Oe,e.cellTypeAlign=Me,e.DPI=72,e.MM=.0393700787*e.DPI,e}function Oe(e){return""}function Me(e){switch(e.base){case"number":case"nid":return"right";case"date":case"datx":case"time":case"appointment":case"timeinterval":case"boolean":return"center";default:return"left"}}var Fe=o("./src/js/reports/ActionMenu.js"),Re=o("./src/js/reports/Designer.jsx"),Le=o("./src/js/reports/RDHTML.js"),je=o("./src/js/reports/RDImage.js"),Ae=o("./src/js/reports/RDImageField.js"),Pe=o("./src/js/reports/RDObject.js"),Ue=o("./src/js/reports/RDReverse.js"),He=o("./src/js/reports/RDText.js"),ze=o("./src/js/reports/ColorMenu.js"),Ve=o("./src/js/reports/ObjectMenu.js"),We=o("./src/js/reports/PaperMenu.js"),Be=o("./src/js/reports/TextMenu.js");function qe(){const e={ActionMenu:Fe.a,ColorMenu:ze.a,Designer:Re.a,ObjectMenu:Ve.a,PaperMenu:We.a,TextMenu:Be.a,RDHTML:Le.a,RDImage:je.a,RDImageField:Ae.a,RDObject:Pe.a,RDReverse:Ue.a,RDText:He.a,printAllRecords:!1,designer:void 0,openDesigner:function(e){if(e.nid){var t=database.typeOf(e.nid);if(t){var i=e.reportName,o=e.reportId;if(null===o){var n=new Re.a({tid:t.id,caption:e.caption},{nid:e.nid,empty:e.empty,nids:e.nids});NinoxDocumentInteraction.setUserDefault("ui.report.id:"+database.id+"/"+t.id,n.id)}else database.listReports((function(n,a){if(n)return $.alert(n);if(i)for(var s in a){if((d=a[s]).caption==i&&d.tid===t.id){o=s;break}}var r=a[o||NinoxDocumentInteraction.getUserDefault("ui.report.id:"+database.id+"/"+t.id)];if(r&&r.tid!==t.id&&(r=void 0),!r)for(var l=util.localeSortBy(a,"caption"),c=0;c<l.length;c++){var d;if((d=l[c]).tid===t.id){r=d;break}}r||(r={tid:t.id,caption:e.caption});var h=new Re.a(r,{nid:e.nid,nids:e.nids,printOneAndClose:e.printOneAndClose,printAllAndClose:e.printAllAndClose,saveToFileAndClose:e.saveToFileAndClose});NinoxDocumentInteraction.setUserDefault("ui.report.id:"+database.id+"/"+t.id,h.id)}))}}}};return e}o("./src/react/views/BrowserNotSupportedView.scss");o("./node_modules/core-js/modules/web.immediate.js");function Ye(){!function(){function e(e){var t,i,o,n,a,s=0,r=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?(s=e.selectionStart,r=e.selectionEnd):(i=document.selection.createRange())&&i.parentElement()==e&&(n=e.value.length,t=e.value.replace(/\r\n/g,"\n"),(o=e.createTextRange()).moveToBookmark(i.getBookmark()),(a=e.createTextRange()).collapse(!1),o.compareEndPoints("StartToEnd",a)>-1?s=r=n:(s=-o.moveStart("character",-n),s+=t.slice(0,s).split("\n").length-1,o.compareEndPoints("EndToEnd",a)>-1?r=n:(r=-o.moveEnd("character",-n),r+=t.slice(0,r).split("\n").length-1))),{start:s,end:r}}function t(t,i){var o=e(t),n=t.value;t.value=n.slice(0,o.start)+i+n.slice(o.end)}function i(){return window.getSelection&&"None"!==window.getSelection().type&&""!==window.getSelection().toString()}window.htmlEscape=function(e){return null==e?"":"string"!=typeof e?String(e):e.replace(/[&<>'"]/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&apos;",'"':"&quot;"}[e]}))},window.$EL=function(e,t,i,o,n){var a=document.createElement(e);if(t&&(a.className=t),o)for(var s in o)o.hasOwnProperty(s)&&a.setAttribute(s,o[s]);if(n)for(var s in n)n.hasOwnProperty(s)&&(a.style[s]=n[s]);return i&&i.appendChild(a),a},window.$DIV=function(e,t,i,o){return $EL("div",e,t,i,o)},window.$EMPTY=function(e){return e.innerHTML="",e},window.$REMOVE=function(e){var t=e.parentNode;t&&t.removeChild(e)},function(){var e=[],t=[],i=!1;function o(o){for(var n,a,s,r;e.length;)for(n=e,e=[],s=0,r=n.length;s<r;s++)(a=n[s])[0].apply(void 0,a.slice(1));for(;t.length;)for(n=t,t=[],s=0,r=n.length;s<r;s++)(a=n[s])[0].apply(void 0,a.slice(1));i=!1}function n(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];e[e.length]=t,i||(i=!0,postMessage("si","*"))}function a(){for(var e=[],o=0,n=arguments.length;o<n;o++)e[o]=arguments[o];t[t.length]=e,i||(i=!0,postMessage("si","*"))}window.addEventListener("message",o,!1),window.setImmediate=n,window.setFinally=a}(),function(){var e=0,o=void 0,n={},a=null;$.chooseFile=function(e,t){var i=document.getElementById("NinoxDocumentInteraction-file");i&&i.parentNode.removeChild(i),(i=document.createElement("input")).id="NinoxDocumentInteraction-file",i.type="file",i.style.display="none",i.style.position="absolute",i.style.left=(e.clientX||0)+"px",i.style.top=(e.clientY||0)+"px",document.body.appendChild(i),i.addEventListener("change",$.fileChoosen),a=t,i.value=null,i.click()},$.chooseFileWithExtensions=function(e,t){var i=document.getElementById("NinoxDocumentInteraction-file");i&&i.parentNode.removeChild(i),(i=document.createElement("input")).id="NinoxDocumentInteraction-file",i.type="file",i.style.display="none";for(var o="",n=0;n<e.length;n++)o+=(n>0?",":"")+"."+e[n];i.accept=o,document.body.appendChild(i),i.addEventListener("change",$.fileChoosen),a=t,i.value=null,i.click()},$.fileChoosen=function(e){var t=document.getElementById("NinoxDocumentInteraction-file");if(t){var i=a;if(a=null,i){var o=t.files;if(o&&1===o.length)i(void 0,o[0])}}},$.loading=function(t){t?(0===e&&($.pushInputHandler(n),o=$('<div class="nx-backplane nx-backplane-loading"><div class="spinner" style="position:absolute;left:50%;top:50%;margin:-24px 0 0 -24px"></div></div>').appendTo($(document.body))),e++):0===--e&&($.popInputHandler(n),o.remove(),o=void 0)},$.backplane=function(e){var t=!1,i=(e=e||{}).inputHandler||{keydown:s};$.pushInputHandler(i);var o=$('<div class="nx-backplane nx-anim-fade-hidden'+(e.scrollable?" nx-vscrollable":"")+(e.cls?" "+e.cls:"")+'">').appendTo($(document.body));return!1!==e.closable&&o.on(TOUCH?EVENT_touchstart:"mousedown",n),null!=e.zIndex&&o.css("z-index",e.zIndex),setTimeout((function(){o.addClass("nx-anim-fade-in"),setTimeout((function(){o.removeClass("nx-anim-fade-hidden nx-anim-fade-in")}),300)}),0),o.close=a,o;function n(e){var t=$(e.target);(t.is(".nx-backplane")||t.is(".nx-popdown-container"))&&a()}function a(n){t||(t=!0,e.beforeClose&&e.beforeClose(),$.popInputHandler(i),o.addClass("nx-anim-fade-out"),setTimeout((function(){o.remove(),e.close&&e.close(),n&&n()}),300))}function s(t){switch(t.which){case 27:e.escape?e.escape(t):!1!==e.closable&&(a(),t.preventDefault());break;case 13:e.enter?e.enter(t):!1!==e.closable&&(a(),t.preventDefault())}}},$.progress=function(e){var t=$.backplane({closable:!1}),i=48+(e.caption?32:0)+(e.cancel?48:0),o=16+(e.caption?32:0),n=$('<div style="position:absolute;top:50%;left:50%;width:320px;height:'+i+"px;margin-left:-160px;margin-top:-"+i/2+'px;background-color:#000;border-radius:8px">').appendTo(t);e.caption&&$('<div style="color:#ccc;text-align:center;position:absolute;top:8px;left:8px;right:8px;overflow:hidden;line-height:32px">').text(e.caption).appendTo(n);$('<div style="position:absolute;left:16px;width:288px;height:16px;top:'+o+'px;background-color:#555;border-radius:4px">').appendTo(n);var a=$('<div style="position:absolute;left:16px;width:0px;height:16px;top:'+o+'px;background-color:#fff;border-radius:4px">').appendTo(n);function s(e){a[0].style.width=Math.floor(288*e)+"px"}function r(){t.close()}function l(){r(),e.cancel&&e.cancel()}return e.cancel&&$('<div style="position:absolute;bottom:16px;right:16px;padding:0 16px;line-height:32px;height:32px;border-radius:4px;background-color:#aaa">').text(locale.cancel).appendTo(n).touch(l),{update:s,close:r}},$.fn.animFadeIn=function(e){var t=this;return t.addClass("nx-anim-fade-hidden"),setTimeout((function(){t.addClass("nx-anim-fade-in"),setTimeout((function(){t.removeClass("nx-anim-fade-hidden nx-anim-fade-in"),e&&e()}),300)}),0),this},$.fn.animFadeOut=function(e){var t=this;return t.addClass("nx-anim-fade-out"),setTimeout((function(){t.removeClass("nx-anim-fade-out"),e&&e()}),300),this},$.popdown=function(e){e=e||{};var t={};$.pushInputHandler(t);var i=$('<div class="nx-backplane">').appendTo($(document.body)).on(TOUCH?EVENT_touchstart:"mousedown",d),o=$('<div class="nx-popdown-container">').appendTo(i),n=$('<div class="nx-popdown '+(e.cls||"large")+' nx-anim-hidden-up">').appendTo(o),a=void 0,s=void 0,r=void 0;if(e.head&&$('<div class="nx-section-head">').text(e.head).appendTo(n),e.buttons){a=$('<div class="nx-section-pane">').appendTo(n),s=$("<div>").appendTo(a),r=$('<div class="nx-button-bar">').appendTo(a);for(var l=0;l<e.buttons.length;l++){var c=e.buttons[l];" "===c?$('<div class="nx-hspace-small">').appendTo(r):"-"===c?$('<div class="nx-hspace-flex">').appendTo(r):"cancel"===c?$('<div class="nx-button-text grey">').text(locale.cancel).touch(h).appendTo(r):"okay"===c?$('<div class="nx-button-text blue">').text(locale.okay).touch(h).appendTo(r):$('<div class="nx-button-text '+(c.cls||"grey")+'">').text(c.caption).touch(c.click).appendTo(r)}}return setTimeout((function(){n.addClass("nx-anim-show-down"),setTimeout((function(){requestAnimationFrame((function(){n.removeClass("nx-anim-hidden-up nx-anim-hidden-up")}))}),300)}),0),{$backplane:i,$container:o,$pane:n,$section:a,$content:s,$buttons:r,close:p};function d(t){if(!1!==e.closable){var i=$(t.target);(i.is(".nx-backplane")||i.is(".nx-popdown-container"))&&h()}}function h(){p(e.close)}function p(e){n.addClass("nx-anim-hide-up"),setTimeout((function(){$.popInputHandler(t),i.remove(),e&&e()}),300)}},$.buttons=function(e){var t=(e=e||{}).items||[],i=e.style||"",o=e.classes?" "+e.classes:"",n=$('<div class="nx-button-bar'+o+'" style="'+i+'">');e.$container&&n.appendTo(e.$container);for(var a=0;a<t.length;a++){var s=t[a];" "===s?$('<div class="nx-hspace-small">').appendTo(n):"-"===s?$('<div class="nx-hspace-flex">').appendTo(n):$('<div class="nx-button-text '+(s.cls||"grey")+'">').text(s.caption).touch(s.click).appendTo(n)}return{$pane:n}},$.input=function(e){(e=e||{}).type;var t=$('<div class="component editor editor-string" style="width:'+(e.width||"100%")+'">');e.caption&&$("<label>").text(e.caption).appendTo(t);var i=$('<input type="'+(e.type||"text")+'">').appendTo($('<div class="stringeditor">').appendTo(t));return e.val&&i.val(e.val),e.placeholder&&i.attr("placeholder",e.placeholder),e.$container&&t.appendTo(e.$container),e.focus&&setTimeout((function(){i.focus()}),400),i.keypress((function(t){13===t.which&&e.enter&&e.enter(),27===t.which&&e.escape&&e.escape()})),{$el:t,$input:i,val:$.proxy(i.val,i),focus:function(){i.focus()}}},$.field=function(e){(e=e||{}).type;var t=$('<div class="component editor editor-string" style="width:'+(e.width||"100%")+'">');e.caption&&$("<label>").text(e.caption).appendTo(t);var i=$('<div class="input-text">').text(e.val).appendTo($('<div class="stringeditor stringeditor-fn">').appendTo(t));return e.$container&&t.appendTo(e.$container),e.touch&&i.css("cursor","pointer").touch(e.touch),{$el:t,val:function(e){i.text(e)}}},$.tabs=function(e){for(var t=$("<div>").appendTo(e.$parent),i=$('<div class="nx-switch-big">').appendTo(t),o=e.selected||0,n=[],a=e.tabs||[],s=0;s<a.length;s++){var r=a[s],l=$('<div class="nx-switch-big-item" data-index="'+s+'">').text(r.caption).appendTo(i),c=$('<div class="nx-section-pane">').appendTo(t);s===o?l.addClass("selected"):c.hide(),n.push({index:s,$tab:l,$pane:c})}function d(t){t!=o&&(n[o].$tab.removeClass("selected"),n[o].$pane.hide(),n[t].$tab.addClass("selected"),n[t].$pane.show(),o=t,e.onSelect&&e.onSelect(t))}return i.touch((function(e){var t=$(e.target).closest(".nx-switch-big-item").attr("data-index");t&&d(parseInt(t))})),{$pane:t,tabs:n,select:d}},$.switchpane=function(e){var t=$('<div class="nx-switchpane">').touch(n),i=e.value,o={};return k.each(e.items,(function(e){var n=$('<div class="nx-switchpane-item">').append($('<div class="nx-switchpane-item-pane">').append($('<div class="nx-switchpane-item-pane-icon '+e.icon+'">'))).append($('<div class="nx-switchpane-item-label">').text(e.caption)).appendTo(t).attr("data-id",e.id);o[e.id]=n,i===e.id&&n.addClass("selected")})),t;function n(t){var n=$(t.target).closest(".nx-switchpane-item").attr("data-id");n&&n!==i&&(null!=i&&o[i].removeClass("selected"),o[i=n].addClass("selected"),e.update(i))}},$.alert=function(e){$("#nx-alert-backplane").remove();var t=$('<div class="nx-backplane nx-backplane-dark" id="nx-alert-backplane">').click((function(e){$(e.target).is(".nx-backplane")&&n()})),i=$('<div class="nx-alert">').appendTo(t);$('<div class="nx-alert-pane">').text(String(e)).appendTo(i);var o=$('<div class="nx-alert-buttons">').appendTo(i);function n(){t.remove()}$('<div class="nx-hspace-flex">').appendTo(o),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(o).touch(n),t.appendTo($(document.body))},$.notify=function(e){"string"==typeof e&&(e={message:e}),$(".notification").remove();var t=$('<div class="notification">').append($('<div class="notification-message">').text(e.message)).appendTo($(document.body)).css({opacity:0,transition:"opacity .5s",zIndex:999999}).on("touchstart mousedown",o);setTimeout((function(){t.css({opacity:1})}),100);var i=!1;function o(){i||(i=!0,t.css({opacity:0}),setTimeout((function(){t.remove()}),500))}setTimeout(o,1500)},$.fn.button=function(e,t,i,o){var n=$('<div class="button">').appendTo(this).touch(o).keypress((function(e){32!==e.which&&13!==e.which||o()}));return e&&(i?$('<div class="icon-big-white icon-big-'+e+'">').appendTo(n):$('<div class="icon-big-black icon-big-'+e+'">').appendTo(n)),t&&(n.addClass("text"),$("<span>").text(t).appendTo(n)),i&&n.addClass(i),this},$.fn.button2=function(e,t){return this.append($.button(e))},$.button=function(e){var t=$('<div class="button">').touch(e.click).keypress((function(e){32!==e.which&&13!==e.which||callback()}));return e.icon&&$("<div>").addClass(e.icon).appendTo(t),e.caption&&(t.addClass("text"),$("<span>").text(e.caption).appendTo(t)),e.color&&t.addClass(e.color),e.cls&&t.addClass(e.cls),e.tip&&t.attr("title",e.tip),t},$.contextmenu=function(e,t){for(var i=$.backplane({}),o=$('<div class="nx-menu-popup" style="overflow:auto">').appendTo(i),n=t.items,a="",s=0;s<n.length;s++){var r=n[s];a+="-"===r?"<hr>":'<div class="nx-menu-item" data-index="'+s+'">'+(r.icon?'<div class="nx-menu-icon '+r.icon+'"></div>':"")+'<div class="nx-menu-label">'+htmlEscape(r.caption)+"</div></div>"}o.html(a),o.touch((function(e){var t=$(e.target).closest(".nx-menu-item").attr("data-index");if(null!=t){var i=n[parseInt(t)];i&&i.click&&(v(),i.click())}}));var l=window.getWidth(),c=window.getHeight(),d=o.outerWidth(),h=o.outerHeight();const p=14,u=ui.fullWidth<=640?48+ui.footHeight:48;h+p>c-u-20&&(h=c-u-p-20,o.outerHeight(h));let f=e.clientX,m=e.clientY;TOUCH&&(f=e.changedTouches[0].clientX,m=e.changedTouches[0].clientY);var g={left:f,top:m};function v(){i.close()}g.left+d>l&&(g.left=l-d),g.top+h+p>c&&(g.top=c-h-u-p),o.offset(g),$(`<div\n            style="width: 0;\n                   height: 0;\n                   border-left: 17px solid transparent;\n                   border-right: 17px solid transparent;\n                   border-top: 17px solid #ececec;\n                   top: ${g.top+(h-3)}px;\n                   left: ${f+1}px;\n                   position: absolute;"\n               >\n        `).appendTo(i),e.preventDefault()},$.dialog=function(e){var t={keydown:function(t){switch(t.which){case 13:e.buttons&&e.buttons.length&&(s(),e.buttons[e.buttons.length-1].callback&&e.buttons[e.buttons.length-1].callback(),t.preventDefault());break;case 27:e.closable&&(s(),t.preventDefault())}}};$.pushInputHandler(t);var i=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)),o=$('<div class="nx-alert">').appendTo(i);if(e.closable&&i.touch((function(e){$(e.target).is(".nx-backplane")&&s()})),e.caption)$('<div class="nx-alert-head">').text(e.caption).appendTo(o);$('<div class="nx-alert-pane">').html(e.message).appendTo(o);var n=$('<div class="nx-alert-buttons">').appendTo(o),a=!0;function s(){i.remove(),$.popInputHandler(t)}$('<div class="nx-hspace-flex">').appendTo(n),e.closable&&($('<div class="nx-button-text grey">').text(locale.cancel).appendTo(n).touch((function(){s()})),a=!1),k.each(e.buttons,(function(e){a||$('<div class="nx-hspace-small">').appendTo(n),a=!1,$('<div class="nx-button-text '+(e.color||"grey")+'">').text(e.caption).appendTo(n).touch((function(){s(),e.callback&&e.callback()}))}))},$.clearSelection=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},$.fn.nxdraggable=function(e){e=e||{};for(var t=0;t<this.length;t++)this[t].addEventListener(TOUCH?EVENT_touchstart:"mousedown",i);return this;function i(t){if(!TOUCH||1===t.touches.length){var i=$(t.target);if(!e.dismiss||!i.is(e.dismiss)){var o=e.selector?i.closest(e.selector):i;if(o.length){var n=TOUCH?t.touches[0].clientX:t.clientX,a=TOUCH?t.touches[0].clientY:t.clientY,s=n,r=a,l=!1;TOUCH?(EVENT_target(t).addEventListener(EVENT_touchmove,c,!1),EVENT_target(t).addEventListener(EVENT_touchend,d,!1)):(window.addEventListener("mousemove",c,!0),window.addEventListener("mouseup",d,!0)),t.preventDefault(),t.stopPropagation()}}}function c(t){if(!TOUCH||1===t.touches.length){var i=TOUCH?t.touches[0].clientX:t.clientX,c=TOUCH?t.touches[0].clientY:t.clientY,d=i-n,h=c-a;l?e.drag&&e.drag({$el:o,x0:n,y0:a,x1:s,y1:r,x2:i,y2:c}):d*d+h*h>10&&(l=!0,e.dragStart&&e.dragStart({$el:o,x0:n,y0:a,x1:s,y1:r,x2:i,y2:c})),s=i,r=c,t.preventDefault(),t.stopPropagation()}}function d(t){TOUCH&&0!==t.touches.length||(TOUCH?(EVENT_target(t).removeEventListener(EVENT_touchmove,c,!1),EVENT_target(t).removeEventListener(EVENT_touchend,d,!1)):(window.removeEventListener("mousemove",c,!0),window.removeEventListener("mouseup",d,!0)),t.preventDefault(),t.stopPropagation(),l?e.dragEnd&&e.dragEnd({$el:o,x0:n,y0:a,x1:s,y1:r,x2:s,y2:r}):e.click&&e.click({$el:o,x0:n,y0:a}))}}},$.event.special.destroyed={remove:function(e){e.handler&&e.handler()}};var s=[];$(window).on("resize",(function(){var e=s;s=[],k.each(e,(function(e){var t=document.getElementById(e);if(t){s.push(e);var i=$(t),o=i.offset,n=Math.max(20,(window.getHeight()-i.outerHeight())/3);n>o.top&&(n=o.top);var a=Math.max(0,(window.getWidth()-i.outerWidth())/2);i.css("transition","top .5s"),i.offset({top:n,left:a})}}))})),window.NINOX_IE&&$(window).on("click",(function(){document.activeElement?document.activeElement.focus():window.focus()})),$.fn.setHidden=function(e){return e?this.css("display","none"):this.css("display",""),this},$.fn.center=function(){var e=this.uniqueId().attr("id");-1===s.indexOf(e)&&s.push(e);var t=Math.max(20,(window.getHeight()-$(this).outerHeight()-(TOUCH?352:0))/3),i=Math.max(0,(window.getWidth()-$(this).outerWidth())/2);return this.offset({top:t,left:i}),this};var r=[];function l(e){return!1}function d(e){if(!e)return!1;var t=e.localName;if("input"===t||"textarea"===t)return!0;for(;e&&e!==document.body;){if("true"==e.contentEditable)return!0;e=e.parentNode}return!1}function h(e){if(!l(e)&&r.length){var t=r[0];if(t.keydown&&!d(e.target))return t.keydown(e)}}function p(e){if(!l(e)&&r.length){var t=r[0];if(t.keyup)return t.keyup(e)}}function u(e){if(!l(e)&&r.length){var t=r[0];if(t.keypress)return t.keypress(e)}}window.addEventListener("cut",(function(e){if(console.log("EVENT: cut()"),!i()&&!d(e.target)){console.log("EVENT: cut() - not an editor");const t=r[0];if(t&&t.cut){console.log("EVENT: cut() - got a handler");const i=t.cut();i&&(console.log("EVENT: cut() - have some data",i),e.clipboardData.setData("text/plain",i),console.log("EVENT: cut() - stored the data"),e.preventDefault())}}})),window.addEventListener("copy",(function(e){if(console.log("EVENT: copy()"),!i()&&!d(e.target)){console.log("EVENT: copy() - not an editor");const t=r[0];if(t&&t.copy){console.log("EVENT: copy() - got a handler");const i=t.copy();i&&(console.log("EVENT: copy() - have some data",i),e.clipboardData.setData("text/plain",i),console.log("EVENT: copy() - stored the data"),e.preventDefault())}}})),window.addEventListener("paste",(function(e){if(console.log("EVENT: paste()"),!i()&&!d(e.target)){console.log("EVENT: paste() - not an editor");const t=r[0];if(t&&t.paste){console.log("EVENT: copy() - got a handler");const i=e.clipboardData.getData("text/plain");i&&(t.paste(i),e.preventDefault())}}})),$.pushInputHandler=function(e){r=[e].concat(r),Object(c.l)()},$.popInputHandler=function(e){var t=r.indexOf(e);t>=0?r=r.slice(0,t).concat(r.slice(t+1)):console.log("Unbalanced push/pop keydown listener"),Object(c.l)()},$.currentInputHandler=function(){return r[0]},$.fn.replaceSelectedText=function(e){return 1===this.length&&t(this[0],e),this},$((function(){window.addEventListener("keydown",h,!1),window.addEventListener("keyup",p,!1),window.addEventListener("keypress",u,!1)}))}()}()}function Xe(){$.fn.nxmenu=function(e){var t=this;return this.addClass("nx-menu-button").click(i),this;function i(){t.addClass("nx-selected");var i=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)).click(r),o=$('<div class="nx-menu-popup">').appendTo(i);k.each(e.items,(function(t){if("string"==typeof t)"-"===t?$("<hr>").appendTo(o):$("<h1>").text(t).appendTo(o);else if("object"==typeof t){var i=$('<div class="nx-menu-item">').appendTo(o);if(e.icon)$('<div class="nx-menu-icon">').addClass(e.icon).appendTo(i);$('<div class="nx-menu-label">').text(t.caption).appendTo(i);i.click(t.click)}}));var n=o.outerWidth(),a=o.outerHeight(),s=t.offset();function r(){i.remove(),t.removeClass("nx-selected")}return s.top+=t.outerHeight()+16,s.left-=16,s.left+n>window.innerWidth&&(s.left=window.innerWidth-n),s.top+a>window.innerHeight&&(s.top=window.innerHeight-a),o.offset(s),!1}}}var Ge=o("./node_modules/@babel/runtime/helpers/defineProperty.js"),Je=o.n(Ge),Ke=(o("./node_modules/react-swipeable-views/lib/index.js"),o("./src/react/FeatureHighlightSlides.css"),o("./node_modules/assert-never/index.js")),Qe=o.n(Ke),Ze=(o("./src/react/ToggleComponent.css"),o("./src/react/util/FastClickContainer.tsx"));function et(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function tt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?et(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):et(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}let it;it||(it={});class ot extends s.Component{constructor(e){super(e),this.state={isOn:this.props.defaultValue}}render(){switch(this.props.options.type){case"CHECKBOX":case"SLIDING_TOGGLE":return s.createElement(Ze.a,{onFastClick:()=>this.setState(e=>tt({},e,{isOn:!e.isOn}),()=>this.props.onChange(this.state.isOn)),className:this.getRootClass()},this.getBody());default:return Qe()(this.props.options)}}getRootClass(){switch(this.props.options.type){case"CHECKBOX":return"ToggleComponent_checkbox";case"SLIDING_TOGGLE":return"ToggleComponent_switch";default:return Qe()(this.props.options)}}getBody(){switch(this.props.options.type){case"CHECKBOX":return s.createElement(s.Fragment,null,s.createElement("div",{className:"ToggleComponent_checkContainer"},s.createElement("div",{className:"ToggleComponent_check "+(this.state.isOn?"ToggleComponent_checkOn":"")},this.state.isOn?s.createElement(s.Fragment,null,s.createElement("div",{className:"ToggleComponent_checkKick"}),s.createElement("div",{className:"ToggleComponent_checkStem"})):null),s.createElement("p",{className:"ToggleComponent_label"},this.props.options.label)));case"SLIDING_TOGGLE":return s.createElement("div",{className:"ToggleComponent_slide "+(this.state.isOn?"ToggleComponent_slideChecked":"")});default:return Qe()(this.props.options)}}}s.Component;function nt(e){this.messageService=e,this.renderers={HTML:$.proxy(this.renderHTML,this)},this.capSize=2,this.messageInDisplay=null,this.messageMaxHeight=471,this.messagePreviewHeight=90,this.$el=$('<div class="messages" style="display:none">').appendTo(document.body),this.$list=$('<div class="messages-list">').appendTo(this.$el),e.on("logout",$.proxy(this.hideMessageList,this,!0)),e.on("messages",$.proxy(this.onMessages,this)),e.on("message",$.proxy(this.onMessage,this)),e.on("removeMessageError",$.proxy(this.removeMessageError,this))}nt.prototype.onMessages=function(e,t){var i=this;t.length?(i.$list.empty(),k.each(t,(function(e){i.renderMessage(e)}))):i.hideMessageList(!0)},nt.prototype.onMessage=function(e,t){var i=this,o=t.message,n=t.latest,a=i.$list.children().length===i.capSize;function s(){var e=i.$list.find(".messages-message-container").last();i.messageInDisplay||e.removeClass("fadein").toggleClass("fadeout").toggle(100),setTimeout((function(){e.remove()}),100)}n&&a&&s(),i.renderMessage(o,n)},nt.prototype.renderMessage=function(e,t){var i=this;t=t||!1;e.type?i.renderers[e.type]?i.renderers[e.type](e,t):console.warn(e.type+" type messages cannot be rendered yet"):console.warn("Message data does not have a type attribute to proceed with")},nt.prototype.show=function(){this.$el.css("display","")},nt.prototype.markMessageAsRead=function(e){var t=this;t.messageService.markMessageAsRead(e),t.removeMessage(e)},nt.prototype.hideMessageList=function(e){var t=this;e&&t.$list.empty(),t.$list.children().length||t.$el.css("display","none")},nt.prototype.messageContainer=function(e,t){var i=this,o=e(),n=o.messageWrapper,a=o.controls,s=$('<span class="messages-message-container-utils-link">').text(locale.showMore),r=$('<div class="messages-message-container-utils">').append(s),l=$('<div class="messages-message-container-inner">').append(a).append(n).append(r),c=$('<div class="messages-message-container drawer-rev" id="'+t+'">').append(l);return s.touch($.proxy(i.toggleMessageState,i,t)),{messageContainer:c,utils:r}},nt.prototype.renderHTML=function(e,t){var i=this;if("string"==typeof e.message){var o=$('<span class="messages-message-controls-control button icon-big-grey icon-big-close">'),n=$('<div class="messages-message-controls">').append(o),a=$('<div class="messages-message-wrapper">').html(e.message),s=i.messageContainer((function(){return{controls:n,messageWrapper:a}}),e._id),r=s.messageContainer,l=s.utils;o.touch($.proxy(i.markMessageAsRead,i,e._id)),i.show(),t?i.$list.prepend(r):i.$list.append(r),l.css({display:a[0].scrollHeight<i.messagePreviewHeight?"none":"flex"}),r.css({display:i.messageInDisplay?"none":"block"}),r.addClass("fadein")}else console.warn("Cannot display message! Wrong format detected",null)},nt.prototype.toggleContainersOtherThan=function(e){this.$list.find(".messages-message-container").each((function(){var t=this;$(t).prop("id")!==e&&$(t).removeClass("fadein").toggle(10)}))},nt.prototype.toggleMessageState=function(e){var t=this,i=t.$list.find("#"+e).find(".messages-message-container-inner"),o=i.find(".messages-message-wrapper"),n=(i.find(".messages-message-container-utils"),i.find(".messages-message-container-utils-link")),a=i[0].scrollHeight,s=a-10>=o[0].scrollHeight?a-10:a;if(t.messageInDisplay===e)i.css({overflow:"hidden"}),i.animate({height:t.messagePreviewHeight,scrollTop:0},200),n.text(locale.showMore),t.toggleContainersOtherThan(e),t.messageInDisplay=null;else if(t.messageInDisplay){var r=t.$list.find("#"+t.messageInDisplay).find(".messages-message-container-inner"),l=(r.find(".messages-message-container-utils"),r.find(".messages-message-container-utils-link"));r.animate({height:t.messagePreviewHeight,scrollTop:0},150),l.text(locale.showMore),t.toggleContainersOtherThan(e),t.messageInDisplay=e,i.animate({height:s}),n.text(locale.showLess)}else i.css({overflow:"auto",paddingBottom:s>t.messageMaxHeight?32:20}),i.animate({height:s},200),n.text(locale.showLess),t.toggleContainersOtherThan(e),t.messageInDisplay=e},nt.prototype.removeMessage=function(e){var t=this,i=t.$list.find("#"+e);t.messageInDisplay===e&&(t.messageInDisplay=null,t.toggleContainersOtherThan(e)),t.messageInDisplay||i.toggle(10),setTimeout((function(){i.remove(),t.hideMessageList()}),100)},nt.prototype.removeMessageError=function(e){$.notify("Sorry we couldn't take care of that. Please try again later.")};const at={};let st,rt;const lt={error:"",token:""},ct=/(?:\#)?\/saml\/callback(?:\?)?(.*)/;function dt(){const e=ct.exec(window.location.hash);e&&bt(e[1]),rt=St(),st=ft(xt()),vt(st),yt(void 0,st),window.addEventListener("popstate",ht)}function ht(e){const t=ut(window.location.hash),i=st;wt(t),yt(i,t)}const pt={teams:"teamId",database:"dbId",module:"moduleId",view:"vid",node:"nid",tab:"tabId"};function ut(e){const t=(e||"").split("/"),i={};for(let e=1;e<t.length;e+=2){const o=pt[(t[e]||"").trim()],n=(t[e+1]||"").trim();o&&n&&(i[o]=decodeURIComponent(n))}return i}function ft(e){return void 0!==e.dbId&&(void 0===e.moduleId&&(e.moduleId="default"),void 0===e.vid&&(e.vid="default"),void 0!==e.nid&&void 0===e.tabId&&(e.tabId="default")),e}function mt(e){return(e.teamId?"/teams/"+encodeURIComponent(e.teamId):"")+(e.dbId?"/database/"+encodeURIComponent(e.dbId):"")+(e.moduleId?"/module/"+encodeURIComponent(e.moduleId):"")+(e.vid?"/view/"+encodeURIComponent(e.vid):"")+(e.nid?"/node/"+encodeURIComponent(e.nid):"")+(e.tabId?"/tab/"+encodeURIComponent(e.tabId):"")}function gt(e){const t=st,i=ft(e);wt(i),window.location.assign(window.location.pathname+"#"+mt(i)),yt(t,i)}function vt(e){wt(ft(e)),window.location.replace(window.location.pathname+"#"+mt(e))}function yt(e,t){e?e.nid!==t.nid||e.tabId!==t.tabId?$t("tab",t):e.dbId!==t.dbId||e.moduleId!==t.moduleId||e.vid!==t.vid?$t("view",t):e.teamId!==t.teamId&&$t("team",t):$t("team",t)}function bt(e){const t=e.split("&");for(const e of t){const[t,i]=e.split("=");"token"===t?lt.token=decodeURIComponent(i):"error"===t&&(lt.error=decodeURIComponent(i))}}function wt(e){window.NinoxDocumentInteraction.setUserDefault("ui.navigation.state"+("prod"===window.NINOX_ENV?"":"."+window.NINOX_ENV),JSON.stringify(e)||""),st=e}function xt(){const e=window.location.hash;if(e&&"#"!==e)return ft(ut(window.location.hash));{let e;const t=window.NinoxDocumentInteraction.getUserDefault("ui.navigation.state"+("prod"===window.NINOX_ENV?"":"."+window.NINOX_ENV));if(t&&"{}"!==t)try{const i=JSON.parse(t);null!=i&&"object"==typeof i&&(e=i)}catch(e){console.log("Invalid navigation state",e)}return e||{teamId:"default"}}}function Tt(){if(!st)throw new Error("Router not initialized");return st}function Ct(e,t,i){const o=at[e];at[e]=o?o.concat([{callback:t,context:i}]):[{callback:t,context:i}]}function kt(e,t,i){const o=at[e];o&&(at[e]=o.filter(e=>e.callback!==t&&e.context!==i))}function $t(e,t){const i=at[e];if(i)for(const e of i)e.callback.apply(e.context,[t])}function St(){let e=null;const t=/template=(.*)/.exec(window.location.hash);return t&&(e=decodeURIComponent(t[1])),e}function _t(){return rt}function Et(){return lt}function Dt(){var e=null,t=[];function i(e){return e&&"NFC"!==e?"NFD"===e?unorm.nfd(this):this:unorm.nfc(this)}function o(e){return this}function n(){NinoxAppStore.onProductsChanged(a),NinoxAppStore.pendingPurchases(()=>{})}function a(e,t){if(console.log("appStoreProductsChanged: "+JSON.stringify(t),e),NinoxAppStore.onProductsChanged(a),!e){for(var i=!1,o=0;o<t.length;o++){var n=t[o];/^nx_/.test(n)&&(i=!0)}if(i&&window.dbms){var r=dbms.getRemoteConnection();r&&r.isLoggedIn()&&NinoxDocumentInteraction.isOnline()&&(console.log("appStoreProductsChanged - loading receipt"),s((function(e,t){if(e)return $.alert(e);console.log("appStoreProductsChanged - sending receipt"),r.sendReceipt(t,(function(e){console.log("appStoreProductsChanged - receipt sent",e),e&&$.alert(e)}))})))}}}function s(e){NinoxAppStore.loadReceipt((t,i)=>{if(i)return e(void 0,i);NinoxAppStore.refreshReceipt(e)})}function r(){window.console||(window.console={}),console.log}window.ninox_init=async function(){let e=void 0,a=!1;await new Promise(t=>{NinoxViewController.getInitializationParameters((i,o,n)=>{a=o,e=n,t()})}),window.database=null;await localFileSystem.exists("data");var s=cloudFileSystem.clientId(),d="mac";function p(){var e=/^([a-z]+)(?:\-([a-z]+))?$/i.exec(navigator.language);if(e){var t=(e[1]||"").toLowerCase(),i=(e[2]||"").toUpperCase(),o=$.datepicker.regional[t+"-"+i]||$.datepicker.regional[t];o&&$.datepicker.setDefaults(o),$.datepicker.setDefaults({firstDay:locale.weekStartMonday?1:0})}$.datepicker.formatDate=function(e,t,i){return t?b.util.moment(t).format(locale.dateFormat):""},$.datepicker.parseDate=function(e,t,i){if(t)return b.util.moment(t,locale.dateFormat).toDate()}}function u(){window.trackPageView=m,window.trackEvent=g,setInterval(f,6e4)}function f(){if(t.length&&NinoxDocumentInteraction.isOnline()){var e=t;t=[];for(var i="",o=0;o<e.length;o++)i+=JSON.stringify(e[o])+"\n";var n=b.util.AESEncrypt(i,"51bbl:cy7u338do.bnda;3256Lpq+3mx"),a="https://mp.ninox.com/";$.ajax({url:a,type:"POST",data:n,cache:!1,contentType:"text/plain",processData:!1,success:function(){},error:function(){t=e.concat(t)}})}}function m(e){t.length>100&&(t=t.slice(10)),t.push({cid:s,t:"p",dp:"/"+d+"/"+e,ts:Date.now()})}function g(e,i,o){dbms.getRemoteConnection().isLoggedIn()&&(t.length>100&&(t=t.slice(10)),t.push({cid:s,ec:e,ea:i,el:d,ev:o,ts:Date.now()}))}function v(){$.loading(!0),setTimeout((function(){dbms.bootstrap((function(e){if($.loading(!1),e)return $.alert(String(e));Object(c.k)(()=>{const e=Object(c.d)("settings")||{},t=Object(c.d)("passwordPolicy")||{},i=e.localeOverrides;i&&(Object(b.overrideLocales)(i),window.locale=Object(b.getLocale)(),window.LOCALE=Object(b.getUserLanguage)()),t.idleTimeoutInMinutes&&Object(c.e)(60*t.idleTimeoutInMinutes*1e3),y()})}))}),0)}async function y(){if(dt(),await localFileSystem.cachedURL("https://ninox.com/api/templates",864e5),Object(c.f)()){const e=NinoxDocumentInteraction.getUserDefault("nx.server"),t=(e?"https://"+e:"")+"/_custom/custom.css",i=document.createElement("link");i.rel="stylesheet",i.href=await localFileSystem.cachedURL(t,6e4)||t,document.head.appendChild(i);const o=(e?"https://"+e:"")+"/_custom/custom.js",n=document.createElement("script");n.type="text/javascript",n.src=await localFileSystem.cachedURL(o,6e4)||o,document.head.appendChild(n)}ui.initRoot&&ui.initRoot(),n(),setTimeout((function(){$("#bootscreen").addClass("fade-out"),setTimeout((function(){$("#bootscreen").remove()}),300)}),100),new nt(dbms.messageService),NinoxViewController.initializationDone(),e&&(NinoxViewController.clearLaunchURL(),root.handleOpenURL(e))}l.d(),l.e({device:d}),String.prototype.normalize?String.prototype.normalize||(String.prototype.normalize=o):String.prototype.normalize=i,r(),h(),p(),u(),v()};var d={};function h(){0}d["-M-PL0jBisit-PCFunUO"]={init:function(e){console.log("Appcues flow Enter Data: init"),database&&database.on("update",this.onUpdate,this)},reset:function(e){console.log("Appcues flow Enter Data: reset"),database&&database.off("update",this.onUpdate,this)},onUpdate:function(e){console.log("Appcues flow Enter Data: record updated"),Appcues.track("Record Modified",{})}},window.getWidth=function(){return window.innerWidth},window.getHeight=function(){return window.innerHeight},window.ninox_barcode=function(t){if(e){var i=e.value,o=e.selectionStart,n=e.selectionEnd;o>0||(o=0),n>o||(n=o),i=i.substr(0,o)+t+i.substr(n),e.value=i,$(e).trigger("change")}},window.ninox_openURL=function(e){NinoxViewController.clearLaunchURL(),root.handleOpenURL(e)},window.ninox_saveListeners=[],window.registerSaveListener=function(e){ninox_saveListeners=ninox_saveListeners.concat(e)},window.unregisterSaveListener=function(e){var t=ninox_saveListeners.indexOf(e);t>=0&&(ninox_saveListeners=ninox_saveListeners.slice(0,t).concat(ninox_saveListeners.slice(t+1)))},window.ninox_saveEverything=function(){for(var e=ninox_saveListeners,t=0;t<e.length;t++)e[t]();window.database?window.database.saveEverything((function(e){e&&console.log("ninox_saveEverything database err",e),NinoxViewController.everythingSaved()})):NinoxViewController.everythingSaved()},window.ninox_cutEnabled=function(){var e=$.currentInputHandler();return e&&e.cutEnabled&&e.cutEnabled()||!1},window.ninox_copyEnabled=function(){var e=$.currentInputHandler();return e&&e.copyEnabled&&e.copyEnabled()||!1},window.ninox_pasteEnabled=function(){var e=$.currentInputHandler();return e&&e.pasteEnabled&&e.pasteEnabled()||!1},window.ninox_cut=function(){var e=$.currentInputHandler();return e&&e.cut&&e.cut()||""},window.ninox_copy=function(){var e=$.currentInputHandler();return e&&e.copy&&e.copy()||""},window.ninox_paste=function(e){var t=$.currentInputHandler();t&&t.paste&&t.paste(e)},window.ninox_menuEnabled=function(e){switch(e){case"menuNewDatabase":case"menuImportArchive":return!ui.isInitialized;case"menuSaveArchiveAs":case"menuDuplicateDatabase":return!!ui.isInitialized&&window.database&&!window.database.sql;case"menuRenameDatabase":return!!ui.isInitialized;case"menuReorganizeDatabase":return!!(ui.isInitialized&&window.database&&database.cloud);case"menuDeleteDatabase":case"menuCloseDatabase":return!!ui.isInitialized;default:var t=$.currentInputHandler();return!(!t||"function"!=typeof t[e+"Enabled"])&&t[e+"Enabled"]()}},window.ninox_menuAction=function(e){switch(e){case"menuNewDatabase":ui.createDatabase();break;case"menuImportArchive":ui.importArchive();break;case"menuSaveArchiveAs":ui.isInitialized&&ui.saveArchiveAs({});break;case"menuDuplicateDatabase":ui.isInitialized&&ui.duplicateDatabase();break;case"menuRenameDatabase":ui.isInitialized&&ui.renameDatabase();break;case"menuReorganizeDatabase":ui.isInitialized&&database.cloud&&ui.reorganizeDatabase();break;case"menuDeleteDatabase":ui.isInitialized&&ui.dropDatabase();break;case"menuCloseDatabase":ui.isInitialized&&ui.backToRoot();break;default:var t=$.currentInputHandler();t&&"function"==typeof t[e]&&t[e]()}setTimeout(()=>Object(c.l)(),10)},window.ninox_undoChanged=function(){ui.recordNavigation&&ui.recordNavigation.updateUndo()},window.ninox_decrypt=function(e,t){console.log("ninox_decrypt",e,t);var i=b.util.AESDecrypt(e,t);return console.log("ninox_decrypt > ",i),i},window.samlLoginCallback=function(e,t){if(console.log("samlLoginCallback",e,t),e)return $.alert(e);dbms.getRemoteConnection().isLoggedIn()||dbms.getRemoteConnection().fetchSession(t,(function(e,t){if(e)return $.alert(e);t&&dbms.getRemoteConnection().saveSession(t),dbms.getRemoteConnection().refresh(()=>{root.afterLogin()})}))}}o("./src/react/ResizeDragHandle.css");const Nt=e=>s.createElement("div",{className:"ResizeDragHandle_container"},s.createElement("div",{className:"ResizeDragHandle_handleContainer"+(e.adminMode?" ResizeDragHandle_handleContainerAdminMode":"")},s.createElement("div",{className:"i-24-24 i-lighter-grey i-resize-handle"})));function It(){this.nextUndoId=1,this._undoOperations={},this.undoImplementation=void 0!==window.UNDO_IMPLEMENTATION?window.UNDO_IMPLEMENTATION:new Ot,this.undoImplementation.cancelUndo()}function Ot(){this.isUndoing=!1,this.isRedoing=!1,this.undoStack=[],this.redoStack=[]}It.prototype.cancel=function(){this._undoOperations={},this.undoImplementation.cancelUndo()},It.prototype.push=function(e){var t=String(this.nextUndoId++);this._undoOperations[t]=e,this.undoImplementation.pushUndoOperation({id:t,title:e.title})},It.prototype.performUndo=function(e,t=(()=>{})){var i=this._undoOperations[e];console.log(i),i&&($.loading(!0),i.exec((function(e){$.loading(!1),e&&$.alert(e),t()})))},It.prototype.canExecUndo=function(e){this.undoImplementation.canExecUndo(e)},It.prototype.canExecRedo=function(e){this.undoImplementation.canExecRedo(e)},It.prototype.execUndo=function(){this.undoImplementation.execUndo()},It.prototype.execRedo=function(){this.undoImplementation.execRedo()},Ot.prototype.pushUndoOperation=function(e){this.isUndoing?this.redoStack.push(e):this.undoStack.push(e),ui.recordNavigation&&ui.recordNavigation.updateUndo()},Ot.prototype.cancelUndo=function(){this.undoStack=[],this.redoStack=[],ui.recordNavigation&&ui.recordNavigation.updateUndo()},Ot.prototype.canExecUndo=function(e){e(void 0,this.undoStack.length>0)},Ot.prototype.canExecRedo=function(e){e(void 0,this.redoStack.length>0)},Ot.prototype.execUndo=function(){var e=this;if(e.undoStack.length){var t=e.undoStack.pop();ui.undoManager&&(e.isUndoing=!0,ui.undoManager.performUndo(t.id,(function(t){e.isUndoing=!1}))),ui.recordNavigation&&ui.recordNavigation.updateUndo()}},Ot.prototype.execRedo=function(){var e=this;if(e.redoStack.length){var t=e.redoStack.pop();ui.undoManager&&(e.isRedoing=!0,ui.undoManager.performUndo(t.id,(function(t){e.isRedoing=!1}))),ui.recordNavigation&&ui.recordNavigation.updateUndo()}};o("./src/react/database/CondensedHudLeftHeader.css");class Mt extends s.Component{constructor(e){super(e)}render(){return null===this.props.onBurgerMenuClicked?null:s.createElement(Ze.a,{className:"hud-menu-group CondensedHudLeftHeader_leftHud",onFastClick:this.props.onBurgerMenuClicked},s.createElement("div",{className:"i-32-24 i-white i-setting-side-menu-left"}))}}var Ft=o("./node_modules/react-sortable-hoc/dist/react-sortable-hoc.umd.js");o("./src/react/database/Hud.css");const Rt=Object(Ft.SortableHandle)(()=>s.createElement("div",{className:"Hud_sortingHandleContainer"},s.createElement("div",{className:"i-24-24 i-lighter-grey i-drag-handle"}))),Lt=Object(Ft.SortableElement)(({value:e})=>s.createElement("div",{className:"Hud_sortableElement"},e)),jt=Object(Ft.SortableContainer)(({children:e})=>s.createElement("div",null,e));class At extends s.Component{constructor(e){super(e),Je()(this,"onSortEnd",(e,t,i)=>{Object(l.f)("Table","Rearrange"),e!==t&&this.props.database.schema.updateTypeOrder(e,t,i),this.setState({isSorting:!1})}),this.state={currentlyExpanded:[],isSorting:!1}}render(){const e=[],t=window.ui.getAvailableTypes();for(const i of t){const t=i.children.length>0,o=void 0!==this.state.currentlyExpanded[i.id];e.push(s.createElement("div",{key:"container"+i.id,className:"Hud_rowContainer"},this.renderType(i,t),o?this.renderSortable(i.children.map(e=>this.renderType(e,!1)),i):null))}return this.renderSortable(e,null)}toggleExpand(e){this.setState(t=>(void 0!==t.currentlyExpanded[e]?t.currentlyExpanded[e]=void 0:t.currentlyExpanded[e]=e,t))}renderType(e,t){const i=e.id===this.props.selection,o=this.state.currentlyExpanded[e.id],n=e.icon?"nav-item-icon ic ic-"+e.icon:"nav-item-icon i-32-24 i-white i-setting-table",a=this.props.database.adminMode&&this.props.database.isAdminEnabled(),r=a&&e.hasExpressionErrors();return s.createElement(Ze.a,{onFastClick:()=>this.props.onTableClick(e.id),key:e.id,className:"nav-item"+(i?" selected":"")+(this.state.isSorting?" Hud_sorting":"")+(r?" error":""),style:{width:"100%",overflow:"hidden",paddingLeft:e.master?32:void 0}},i?s.createElement("div",{className:"nav-item-selected-indicator"}):null,s.createElement("div",{className:n,style:{opacity:i?1:.7}}),r?s.createElement("div",{className:"nav-item-icon-error i-red i-warning"}):null,s.createElement("div",{className:"nav-item-text"},e.caption||Object(b.getLocale)().unnamed),this.ShouldShowActionContainer(e,t)?s.createElement("span",{className:"Hud_actionIconsContainer"},t?s.createElement(Ze.a,{className:"nav-item-expand i-32-12 i-white i-line-down-thick "+(void 0!==o?"expanded":"collapsed"),onFastClick:()=>this.toggleExpand(e.id)}):null,e.hidden?this.hiddenTag():"",a?s.createElement(Rt,null):null):null)}ShouldShowActionContainer(e,t){return t||e.hidden||this.props.database.adminMode&&this.props.database.isAdminEnabled()}hiddenTag(){return s.createElement("span",{className:"Hud_hiddenTag"},Object(b.getLocale)().hidden)}renderSortable(e,t){return s.createElement(jt,{onSortEnd:e=>this.onSortEnd(e.oldIndex,e.newIndex,t),useDragHandle:!0,onSortStart:()=>this.setState({isSorting:!1}),helperClass:"Hud_helperClass"},e.map((e,t)=>s.createElement(Lt,{key:`item-${t}`,index:t,value:e})))}}o("./src/react/database/HudContainer.css"),o("./src/react/database/HudLeftHeader.css");class Pt extends s.Component{constructor(e){super(e)}render(){const e=this.props.stickySettings;return s.createElement("div",{className:"HudLeftHeader_root"},window.ui.fullWidth<=640||null===e?null:s.createElement(Ze.a,{onFastClick:()=>{e.toggleSticky()},className:"HudLeftHeader_toggle"},s.createElement("div",{className:"i-40-24 i-white "+(e.isSticky?"i-setting-pin-on":"i-setting-pin-off")})),s.createElement("div",{className:"HudLeftHeader_backContainer"},s.createElement(Ze.a,{onFastClick:this.props.onCloseClick,className:"nav-item head HudLeftHeader_backButton"},s.createElement("div",{className:"nav-item-icon i-24-24 i-white i-arrow-back"}),s.createElement("div",{className:"nav-item-text head"},window.database.account.name))),s.createElement(Ze.a,{onFastClick:()=>this.props.onItemClick("home"),className:"nav-item head"+("home"===this.props.selection?" selected":""),title:this.props.database.name},"home"===this.props.selection?s.createElement("div",{className:"nav-item-selected-indicator"}):null,s.createElement("div",{className:"nav-item-icon i-24-24 i-white i-home"}),s.createElement("div",{className:"nav-item-text head"},this.props.database.name),void 0===this.props.cloudState?null:s.createElement(Ze.a,{onFastClick:this.props.cloudState.onClick,className:"HudLeftHeader_cloudContainer i-32-24 i-white i-cloud-"+this.props.cloudState.state,title:"cloud"===this.props.cloudState.type?Object(b.getLocale)().resyncCloudDatabases:Object(b.getLocale)().ninoxCloudSync})),s.createElement(Ze.a,{onFastClick:()=>this.props.onItemClick("search"),className:"nav-item head"+("search"===this.props.selection?" selected":""),title:Object(b.getLocale)().search},"search"===this.props.selection?s.createElement("div",{className:"nav-item-selected-indicator"}):null,s.createElement("div",{className:"nav-item-icon i-24-24 i-white i-search"}),s.createElement("div",{className:"nav-item-text head"},Object(b.getLocale)().search)),s.createElement(Ze.a,{onFastClick:()=>this.props.onItemClick("calendar"),className:"nav-item head"+("calendar"===this.props.selection?" selected":""),title:Object(b.getLocale)().calendar},"calendar"===this.props.selection?s.createElement("div",{className:"nav-item-selected-indicator"}):null,s.createElement("div",{className:"nav-item-icon i-24-24 i-white i-calendar",title:Object(b.getLocale)().calendar}),s.createElement("div",{className:"nav-item-text head"},Object(b.getLocale)().calendar)),s.createElement("div",{className:"HudLeftHeader_divider"}))}}class Ut extends s.Component{constructor(e){super(e),Je()(this,"onHeaderClick",e=>{switch(e){case"search":this.props.openSearch();break;case"home":this.props.openHome();break;case"calendar":this.props.openCalendar();break;default:Qe()(e)}}),Je()(this,"onTableClick",e=>{this.props.openTable(e)})}render(){return s.createElement("div",{className:"HudContainer_root"},s.createElement(Pt,{cloudState:this.props.cloudState,onItemClick:this.onHeaderClick,onCloseClick:this.props.onCloseClick,selection:this.props.selection,database:this.props.database,stickySettings:this.props.stickySettings}),s.createElement("div",{className:"HudContainer_body"},s.createElement(At,{selection:this.props.selection,database:this.props.database,onTableClick:this.onTableClick})),this.props.database.adminMode&&this.props.database.isAdminEnabled()?s.createElement(Ze.a,{rippleStyle:"LIGHT",onFastClick:this.props.createTable,className:"nav-item nav-item-add-table",title:Object(b.getLocale)().addTable},s.createElement("div",{className:"nav-item-icon i-32-24 i-white i-plus"}),s.createElement("div",{className:"nav-item-text",style:{color:"white"}},Object(b.getLocale)().addTable)):null)}}var Ht=o("./node_modules/react-burger-menu/lib/BurgerMenu.js");const zt=640;function Vt(e){this.$el=$('<div class="nav-container">').appendTo(ui.$left),this.$slidingHeader=$('<div id="react-root-sliding-header">').appendTo(ui.$overlays),this.attachCondensed(),this.selection=void 0,database.on("admin",void 0,$.proxy(this.updateUI,this)),database.on("schema",void 0,$.proxy(this.updateUI,this)),this.cloudState="okay"}function Wt(){var e=this;this.controllers=[],this.$actions=$('<div class="hud-menu-group" style="margin:0 8px 0 0;display:none">'),this.$print=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-print disabled" title="'+htmlEscape(locale.print)+'" style="margin-right: 2px;">').touch($.proxy(this.print,this)).appendTo(this.$actions),this.$remove=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-trash disabled" title="'+htmlEscape(locale.removeRecord)+'" style="margin-right: 2px;">').touch($.proxy(this.remove,this)).appendTo(this.$actions),this.$duplicate=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-copy disabled" title="'+htmlEscape(locale.duplicateRecord)+'" style="margin-right: 2px;">').touch($.proxy(this.duplicate,this)).appendTo(this.$actions),this.$add=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-add disabled" title="'+htmlEscape(locale.createRecord)+'">').touch($.proxy(this.add,this)).appendTo(this.$actions),this.$navs=$('<div class="hud-menu-group" style="margin:0 0px 0 9px">').appendTo(ui.$menuRight),this.$first=$('<div class="hud-menu-button menu-nav i-32-24 i-light-grey i-arrow-solid-first disabled" title="'+htmlEscape(locale.gotoFirst)+'">').appendTo(this.$navs),this.$prev=$('<div class="hud-menu-button menu-nav i-32-24 i-light-grey i-arrow-solid-left disabled" title="'+htmlEscape(locale.gotoPrev)+'">').appendTo(this.$navs),this.$next=$('<div class="hud-menu-button menu-nav i-32-24 i-light-grey i-arrow-solid-right disabled" title="'+htmlEscape(locale.gotoNext)+'">').appendTo(this.$navs),this.$last=$('<div class="hud-menu-button menu-nav i-32-24 i-light-grey i-arrow-solid-last disabled" title="'+htmlEscape(locale.gotoLast)+'">').appendTo(this.$navs),this.$actionsSmall=$('<div class="hud-menu-group">'),this.$printSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-print disabled" title="'+htmlEscape(locale.print)+'">').touch($.proxy(this.print,this)).appendTo(this.$actionsSmall),this.$removeSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-trash disabled" title="'+htmlEscape(locale.removeRecord)+'">').touch($.proxy(this.remove,this)).appendTo(this.$actionsSmall),this.$duplicateSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-copy disabled" title="'+htmlEscape(locale.duplicateRecord)+'">').touch($.proxy(this.duplicate,this)).appendTo(this.$actionsSmall),this.$addSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-add disabled" title="'+htmlEscape(locale.createRecord)+'">').touch($.proxy(this.add,this)).appendTo(this.$actionsSmall),this.$navsSmall=$('<div class="hud-menu-group">').appendTo(ui.$foot),this.$firstSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-arrow-solid-first disabled" title="'+htmlEscape(locale.gotoFirst)+'">').appendTo(this.$navsSmall),this.$prevSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-arrow-solid-left disabled" title="'+htmlEscape(locale.gotoPrev)+'">').appendTo(this.$navsSmall),this.$nextSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-arrow-solid-right disabled" title="'+htmlEscape(locale.gotoNext)+'">').appendTo(this.$navsSmall),this.$lastSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-arrow-solid-last disabled" title="'+htmlEscape(locale.gotoLast)+'">').appendTo(this.$navsSmall),this.$first.on("contextmenu",(function(e){e.preventDefault()})),this.$first.touch($.proxy(this.first,this)),this.$prev.on("contextmenu",(function(e){e.preventDefault()})),this.$prev[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",n),this.$next.on("contextmenu",(function(e){e.preventDefault()})),this.$next[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",o),this.$last.on("contextmenu",(function(e){e.preventDefault()})),this.$last.touch($.proxy(this.last,this)),this.$firstSmall.on("contextmenu",(function(e){e.preventDefault()})),this.$firstSmall.touch($.proxy(this.first,this)),this.$prevSmall.on("contextmenu",(function(e){e.preventDefault()})),this.$prevSmall[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",n),this.$nextSmall.on("contextmenu",(function(e){e.preventDefault()})),this.$nextSmall[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",o),this.$lastSmall.on("contextmenu",(function(e){e.preventDefault()})),this.$lastSmall.touch($.proxy(this.last,this)),Wt.$actions=this.$actions,Wt.$navs=this.$navs,Wt.$actionsSmall=this.$actionsSmall,Wt.$navsSmall=this.$navsSmall,Wt.$actionsSmall.appendTo(ui.$foot),Wt.$navsSmall.appendTo(ui.$foot),Wt.$navs.prependTo(ui.$menuRight),Wt.$actions.prependTo(ui.$menuRight),this.updateUI();var t=null,i=null;function o(e){return a("next",e),e.preventDefault(),!1}function n(e){return a("prev",e),e.preventDefault(),!1}function a(o,n){i||(i=o,TOUCH?(EVENT_target(n).addEventListener(EVENT_touchend,s),EVENT_target(n).addEventListener("touchcancel",s)):window.addEventListener("mouseup",s),"next"===i?e.next():e.prev(),t=setTimeout(r,400),n.preventDefault())}function s(e){i&&(i=null,TOUCH?(EVENT_target(e).removeEventListener(EVENT_touchend,s),EVENT_target(e).removeEventListener("touchcancel",s)):window.removeEventListener("mouseup",s),t&&(clearTimeout(t),t=null),e.preventDefault())}function r(){"next"===i?(e.next(),t=setTimeout(r,10)):"prev"===i?(e.prev(),t=setTimeout(r,10)):t=null}}Vt.prototype.attachCondensed=function(){this.$menu=$('<div id="react-root-condensed-hud-left-header">').appendTo(ui.$headerContainer)},Vt.prototype.initialResize=function(){ui.fullWidth<=zt&&ui.hideLeftPanel(),this.lastWidth=ui.fullWidth,this.lastLeftWidth=ui.leftWidth,this.updateUI()},Vt.prototype.resize=function(){this.lastWidth>=zt&&ui.fullWidth<=zt&&(ui.hideLeftPanel(),this.updateUI()),this.lastWidth<=zt&&ui.fullWidth>zt&&(ui.showLeftPanel({}),this.updateUI()),(!this.lastLeftWidth&&ui.leftWidth||this.lastLeftWidth&&!ui.leftWidth)&&this.updateUI(),ui.leftWidth&&ui.isLeftOpen&&(n.unmountComponentAtNode(this.$menu[0]),n.unmountComponentAtNode(this.$slidingHeader[0])),this.lastWidth=ui.fullWidth,this.lastLeftWidth=ui.leftWidth},Vt.prototype.updateState=function(e){if(e)switch(e.base){case"table":this.selection=e.tid;break;case"calendar":this.selection="calendar";break;case"search":this.selection="search";break;case"home":this.selection="home"}else this.selection=void 0;this.updateUI()},Vt.prototype.isOpen=!1,Vt.prototype.handleBurgerMenuClickLarge=function(){ui.showLeftPanel({shouldResetWidth:!0})},Vt.prototype.handleBurgerMenuClickSmall=function(){this.isOpen=!this.isOpen,this.updateUI()},Vt.prototype.handleStateChange=function(e){this.isOpen!==e.isOpen&&(this.isOpen=e.isOpen,this.updateUI())},Vt.prototype.closeMenu=function(){this.isOpen=!1,this.updateUI()},Vt.prototype.toggleSticky=function(){ui.fullWidth>zt&&(ui.showLeftPanel({shouldResetWidth:!0}),this.isOpen=!1,this.updateUI())},Vt.prototype.renderCondensedHeader=function(e){n.render(s.createElement(Mt,{onBurgerMenuClicked:()=>e()}),this.$menu[0])},Vt.prototype.reloadDatabase=function(){dbms.closeDatabase((function(){window.location.reload()}))},Vt.prototype.setCloudSyncState=function(e){this.cloudState=e,this.updateUI()},Vt.prototype.renderHudContainerLarge=function(){n.render(s.createElement(Ut,{cloudState:this.getCloudState(),stickySettings:null,onCloseClick:()=>ui.backToRoot(),selection:this.selection,database:database,openSearch:()=>ui.openSearch(),openHome:()=>ui.openHome(),openCalendar:()=>ui.openCalendar(),openTable:e=>ui.openTable(e),createTable:()=>ui.createTable()}),this.$el[0])},Vt.prototype.getCloudState=function(){return database.cloud?{onClick:()=>this.reloadDatabase(),state:this.cloudState,type:"cloud"}:database.sql?{onClick:()=>this.popupSyncState(),state:this.cloudState,type:"sql"}:void 0},Vt.prototype.renderHudContainerSmall=function(){n.render(s.createElement(Ht.slide,{isOpen:this.isOpen,customBurgerIcon:!1,customCrossIcon:!1,styles:{bmMenu:{background:"white"},bmMenuWrap:{transition:"all 0.3s ease 0s"},bmOverlay:{transition:"opacity 0.3s ease 0s"}},onStateChange:e=>this.handleStateChange(e)},s.createElement(Ut,{cloudState:this.getCloudState(),stickySettings:{isSticky:!1,toggleSticky:()=>this.toggleSticky()},selection:this.selection,database:database,onCloseClick:()=>ui.backToRoot(),openSearch:()=>{this.closeMenu(),ui.openSearch()},openHome:()=>{this.closeMenu(),ui.openHome()},openCalendar:()=>{this.closeMenu(),ui.openCalendar()},openTable:e=>{this.closeMenu(),ui.openTable(e)},createTable:()=>{this.closeMenu(),ui.createTable()}})),this.$slidingHeader[0])},Vt.prototype.updateUI=function(){ui.isLeftOpen&&ui.leftWidth?(this.renderHudContainerLarge(),this.isOpen=!1,n.unmountComponentAtNode(this.$slidingHeader[0])):(this.renderCondensedHeader(()=>{this.handleBurgerMenuClickSmall()}),n.unmountComponentAtNode(this.$el[0]),this.renderHudContainerSmall())},Vt.prototype.popupSyncState=function(){const e=this;if(database.sql){var t=$.popdown({head:locale.syncState,close:o,buttons:[{caption:locale.syncProblemCheck,click:function(){t.close(),$.loading(!0),database.checkSynchornizationProblems((function(t,i){if($.loading(!1),t)return $.alert(t);e.popupSynchronizationProblems(i)}))}}," ",{caption:locale.syncNow,click:function(){t.close(),database.syncTrigger((function(e){e&&$.alert(e)}))}},"-","okay"]});n();var i=setInterval(n,1e3)}function o(){i&&clearInterval(i),i=null}async function n(){var e=await database.getSyncState().catch(e=>($.alert(e),{}));t.$content.html('<div style="padding:0 16px"><p>'+htmlEscape(locale.syncSeq)+" "+e.seq+"</p><p>"+htmlEscape(locale.syncFilesToDownload)+": "+e.syncFilesDownload+(e.syncFilesDownloadError?" ("+e.syncFilesDownloadError+" "+htmlEscape(locale.syncFilesFailed)+")":"")+"</p><p>"+htmlEscape(locale.syncFilesToUpload)+": "+e.syncFilesUpload+(e.syncFilesUploadError?" ("+e.syncFilesUploadError+" "+htmlEscape(locale.syncFilesFailed)+")":"")+"</p>"+(database.syncError?'<p style="color:red">'+htmlEscape(String(database.syncError))+"</p>":"")+"</div>")}},Vt.prototype.popupSynchronizationProblems=function(e){const t={"file-download":"Save file as...","file-delete":"Delete file","file-rename":"Rename file...","file-pull":"Download file","file-push":"Upload file","file-entry-add":"Synchronize","file-entry-remove":"Remove from sync","file-entry-pull":"Download again"};var i=database.schema.types,o=$.popdown({head:locale.syncProblems,buttons:["-","okay"]}),n="";n+='<div class="syncproblems">';var a=e.files;if(a&&a.length){n+='<div class="syncproblems-files">';for(var s=0;s<a.length;s++){var r=a[s],l=i[r.tid];n+='<div class="syncproblems-file" data-index="'+s+'"><div class="syncproblems-file-item"><div class="syncproblems-file-name">'+htmlEscape(l?l.caption:r.tid)+htmlEscape(r.rid?"/"+r.rid:"")+htmlEscape(r.name?"/"+r.name:"")+'</div><div class="syncproblems-file-description">'+htmlEscape(r.size?r.size+" byte ":"")+htmlEscape(r.err?" - "+r.err:"")+"</div></div>",n+='<div class="syncproblems-file-actions">';var c=r.actions;c&&c.length&&(n+='<div class="button i-32-24 i-grey i-setting-settings"></div>'),n+="</div>",n+="</div>"}n+="</div>"}else n+=htmlEscape(locale.fileSync+": "+locale.noProblems);function d(e,t){var i=$.popdown({head:locale.rename,buttons:["-","cancel"," ",{cls:"blue",caption:locale.rename,click:a}]}),o=$('<div class="component editor editor-string" style="width:100%">').appendTo(i.$content);$("<label>").text(locale.name).appendTo(o);var n=$('<input type="text">').val(e.name).appendTo($('<div class="stringeditor">').appendTo(o)).keydown((function(e){13===e.which&&a(),27===e.which&&s(!1)}));function a(){var t=n.val();return e.name===t?s(!1):b.util.isValidFileName(t)?($.loading(!0),void database.renameFile(e.tid+e.rid,e.name,t,(function(i){if(i)return $.loading(!1),void $.alert(locale.couldntRenameFile);e.fid?database.update(e.tid+e.rid,e.fid,t,(function(e){$.loading(!1),e&&$.alert(e),s(!0)})):($.loading(!1),s(!0))}))):$.alert(locale.invalidFileName)}function s(e){i.close(),t(e)}}function h(e){var t=database.downloadURL(e.tid+e.rid,e.name);NinoxDocumentInteraction.saveFile(e.name,"",(function(e,i){if(e)return $.alert(e);i&&localFileSystem.copyURL(t,i).catch(e=>$.alert(e))}))}n+="</div>",o.$content.html(n),o.$content.touch((function(i){var o=$(i.target).closest(".syncproblems-file"),n=o.attr("data-index");if(n){var a=e.files[n];if(a){var s=a.actions;if(s&&s.length){var r=$.backplane({close:closed}),l=$('<div class="nx-menu-popup">').appendTo(r);k.each(s,(function(e){$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(t[e]||e)).appendTo(l).touch((function(){r.close(),"file-rename"===e?d(a,(function(e){e&&o.hide("fast")})):"file-download"===e?h(a):($.loading(!0),database.repairSynchronizationProblem(a,e,(function(e,t){$.loading(!1),e?$.alert(e):t&&o.hide("fast")})))}))}));var c=l.outerWidth(),p=l.outerHeight(),u={left:i.clientX,top:i.clientY};u.left+c>window.getWidth()&&(u.left=window.getWidth()-c),u.top+p>window.getHeight()&&(u.top=window.getHeight()-p),l.offset(u)}}}}))},Wt.$actions=void 0,Wt.$navs=void 0,Wt.$actionsSmall=void 0,Wt.$navsSmall=void 0,Wt.prototype.pushController=function(e){this.controllers.unshift(e),this.updateUI()},Wt.prototype.popController=function(e){var t=this.controllers.indexOf(e);-1!==t&&this.controllers.splice(t,1),this.updateUI()},Wt.prototype.updateUI=function(){var e=this.controllers[0];ui.fullWidth<=640?(this.$navsSmall[0].style.display=e?"":"none",this.$actionsSmall[0].style.display=e?"":"none",this.$actions[0].style.display="none",this.$navs[0].style.display="none"):(this.$navs[0].style.display=ui.fullWidth-ui.leftWidth<800||!e?"none":"",this.$actions[0].style.display=e?"":"none",this.$navsSmall[0].style.display="none",this.$actionsSmall[0].style.display="none");var t=!(e&&e.hasPrevRecord&&e.hasPrevRecord()),i=!(e&&e.hasNextRecord&&e.hasNextRecord()),o=!(e&&e.hasAddRecord&&e.hasAddRecord()),n=!(e&&e.hasDuplicateRecord&&e.hasDuplicateRecord()),a=!(e&&e.hasRemoveRecord&&e.hasRemoveRecord()),s=!(e&&e.hasPrintRecord&&e.hasPrintRecord());this.$first.toggleClass("disabled",t),this.$prev.toggleClass("disabled",t),this.$next.toggleClass("disabled",i),this.$last.toggleClass("disabled",i),this.$add.toggleClass("disabled",o),this.$duplicate.toggleClass("disabled",n),this.$remove.toggleClass("disabled",a),this.$print.toggleClass("disabled",s),this.$firstSmall.toggleClass("disabled",t),this.$prevSmall.toggleClass("disabled",t),this.$nextSmall.toggleClass("disabled",i),this.$lastSmall.toggleClass("disabled",i),this.$addSmall.toggleClass("disabled",o),this.$duplicateSmall.toggleClass("disabled",n),this.$removeSmall.toggleClass("disabled",a),this.$printSmall.toggleClass("disabled",s),this.updateUndo()},Wt.prototype.updateUndo=function(){this.$undo&&(this.$undo.toggleClass("disabled",!0),ui.undoManager.canExecUndo((e,t)=>{e&&console.log(e),this.$undo.toggleClass("disabled",!t)})),this.$redo&&(this.$redo.toggleClass("disabled",!0),ui.undoManager.canExecRedo((e,t)=>{e&&console.log(e),this.$redo.toggleClass("disabled",!t)}))},Wt.prototype.first=function(){var e=this.controllers[0];e&&e.firstRecord&&(e.firstRecord(),Object(l.f)("Navigation","GoToFirst"))},Wt.prototype.last=function(){var e=this.controllers[0];e&&e.lastRecord&&(e.lastRecord(),Object(l.f)("Navigation","GoToLast"))},Wt.prototype.prev=function(){var e=this.controllers[0];e&&e.hasPrevRecord&&e.hasPrevRecord()&&e.prevRecord&&(e.prevRecord(),Object(l.f)("Navigation","GoToPrev"))},Wt.prototype.next=function(){var e=this.controllers[0];e&&e.hasNextRecord&&e.hasNextRecord()&&e.nextRecord&&(e.nextRecord(),Object(l.f)("Navigation","GoToNext"))},Wt.prototype.add=function(){Object(l.f)("Form","CreateRecord");var e=this.controllers[0];e&&e.hasAddRecord&&e.hasAddRecord()&&e.addRecord&&e.addRecord()},Wt.prototype.duplicate=function(){Object(l.f)("Form","DuplicateRecord");var e=this.controllers[0];e&&e.hasDuplicateRecord&&e.hasDuplicateRecord()&&e.duplicateRecord&&e.duplicateRecord()},Wt.prototype.remove=function(){Object(l.f)("Form","DeleteRecord");var e=this.controllers[0];e&&e.hasRemoveRecord&&e.hasRemoveRecord()&&e.removeRecord&&e.removeRecord()},Wt.prototype.print=function(){Object(l.f)("Form","Print");var e=this.controllers[0];e&&e.hasPrintRecord&&e.hasPrintRecord()&&e.printRecord&&e.printRecord()},Wt.prototype.resize=function(){this.updateUI()};var Bt=o("./src/react/SimpleTabSelectionRow.tsx"),qt=o("./src/js/widgets/Field.js");const Yt={csvHeaderDefault:!0,csvFooterDefault:!1,csvSepHeaderDefault:!1,csvLinefeedDefault:"\r\n",csvQuoteDefault:'"',csvEncodingDefault:"utf8",csvDateFormatDefault:"locale",csvNumberFormatDefault:void 0,csvSeparatorDefault:void 0};function Xt(){void 0===Yt.csvNumberFormatDefault&&(NinoxDocumentInteraction.defaultDecimalSymbolIsComma()?(Yt.csvNumberFormatDefault="comma",Yt.csvSeparatorDefault=";"):(Yt.csvNumberFormatDefault="point",Yt.csvSeparatorDefault=","))}function Gt(e,t){return null!=e?e:t}function Jt(e){Xt();var t=e.$container;function i(){e.onUpdate&&e.onUpdate()}e.types&&(this.csvType=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.chooseTypeToExport,values:e.types,formWidth:1})),this.csvType.onUpdate(i),this.csvTypeField=new qt.a(void 0,this.csvType,t)),this.csvHeader=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.csvHeader,required:!0,formWidth:1/3})),this.csvHeader.value=Gt(e.header,Yt.csvHeaderDefault),this.csvHeader.onUpdate(i),this.csvHeaderField=new qt.a(void 0,this.csvHeader,t),this.csvSepHeader=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.csvSepHeader,required:!0,formWidth:1/3})),this.csvSepHeader.value=Gt(e.sepHeader,Yt.csvSepHeaderDefault),this.csvSepHeader.onUpdate(i),this.csvSepHeaderField=new qt.a(void 0,this.csvSepHeader,t),this.csvSeparator=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvSeparator,required:!0,formWidth:1/3,values:{",":{caption:",",order:1},";":{caption:";",order:2},"|":{caption:"|",order:3},"\t":{caption:locale.csvSeparatorTab,order:4}}})),this.csvSeparator.value=Gt(e.sep,Yt.csvSeparatorDefault),this.csvSeparator.onUpdate(i),this.csvSeparatorField=new qt.a(void 0,this.csvSeparator,t),this.csvQuote=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvQuote,required:!0,formWidth:1/3,values:{'"':{caption:'"'},"'":{caption:"'"}}})),this.csvQuote.value=Gt(e.qut,Yt.csvQuoteDefault),this.csvQuote.onUpdate(i),this.csvQuoteField=new qt.a(void 0,this.csvQuote,t),this.csvLinefeed=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvLinefeed,required:!0,formWidth:1/3,values:{"\r\n":{caption:"CRLF"},"\n":{caption:"LF"}}})),this.csvLinefeed.value=Gt(e.lf,Yt.csvLinefeedDefault),this.csvLinefeed.onUpdate(i),this.csvLinefeedField=new qt.a(void 0,this.csvLinefeed,t),this.csvNumberFormat=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvNumberFormat,required:!0,formWidth:1/3,values:{point:{caption:locale.csvNumberFormatPoint,order:1},comma:{caption:locale.csvNumberFormatComma,order:2},field:{caption:locale.csvNumberFormatField,order:3}}})),this.csvNumberFormat.value=Gt(e.numberFormat,Yt.csvNumberFormatDefault),this.csvNumberFormat.onUpdate(i),this.csvNumberFormatField=new qt.a(void 0,this.csvNumberFormat,t),this.csvDateFormat=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvDateFormat,required:!0,formWidth:1/3,values:{locale:{caption:locale.csvDateFormatLocal,order:1},iso:{caption:"ISO 8601",order:2},gmt:{caption:"GMT",order:3},timestamp:{caption:"UNIX Timestamp",order:4}}})),this.csvDateFormat.value=Gt(e.dateFormat,Yt.csvDateFormatDefault),this.csvDateFormat.onUpdate(i),this.csvDateFormatField=new qt.a(void 0,this.csvDateFormat,t),this.csvEncoding=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvEncoding,required:!0,formWidth:2/3,values:{utf8:{caption:"UTF-8 (Unicode)",order:1},utf16:{caption:"UTF-16 (Unicode)",order:13},ascii:{caption:"ASCII",order:14},"mac-roman":{caption:"Mac Roman",order:2},"windows-cp1252":{caption:"Windows Latin 1 CP1252",order:3},"windows-cp1250":{caption:"Windows Latin 2 CP1250",order:4},"windows-cp1251":{caption:"Windows Cyrillic CP1251",order:5},"windows-cp1253":{caption:"Windows Greek CP1253",order:6},"windows-cp1254":{caption:"Windows Turkish CP1254",order:7},"iso-latin1":{caption:"ISO Latin 1",order:8},"iso-latin2":{caption:"ISO Latin 2",order:9},"japanese-euc":{caption:"Japanese EUC",order:10},"japanese-shift":{caption:"Japanese SHIFT",order:11},"japanese-iso":{caption:"Japanese ISO",order:12}}})),this.csvEncoding.value=Gt(e.encoding,Yt.csvEncodingDefault),this.csvEncoding.onUpdate(i),this.csvEncodingField=new qt.a(void 0,this.csvEncoding,t)}async function Kt(e,t,i,o){var n=Qt(e,t),a=n.types,s="local"===e.location,r="cloud"===e.location,l="remote"===e.location,c=e.id,d=util.createUUID(12),h=s||r?"data/"+c:l?e.path:void 0,p="data/"+d;let u=null;try{await f(),await m(),await w(),await g(),await S()}catch(e){u=e}finally{localFileSystem.remove(p).catch(e=>console.log(e)).then(()=>o(u))}async function f(){await localFileSystem.mkdir(p),await localFileSystem.mkdir(p+"/files"),await localFileSystem.mkdir(p+"/reports")}async function m(){var i="";i+="s:"+JSON.stringify(n.toJSON())+"\n",i+="O:"+JSON.stringify(e.settings)+"\n";var o=e.views;for(var s in o)if(o.hasOwnProperty(s)){var r=o[s];(d=a[r.type])&&(i+="V"+s+":"+JSON.stringify(r)+"\n")}for(var l in a)if(a.hasOwnProperty(l)){var c=t.types[l];if(!c||!c.data)continue;var d=a[l],h=await e.getRowIds(l);if(!h||!h.length)continue;await new Promise(t=>e.loadNodes3(l,h,t));for(var u=0;u<h.length;u++){var f=h[u],m=e.loadNodeSync2(l,f);if(m){var g={};for(var v in m)if(m.hasOwnProperty(v)&&"_"!==v[0]){var y=m[v];if(null!=y){var b=d.fields[v];b&&(b.isReference||b.isField&&"fn"!==b.base)&&(g[v]=y)}}i+="U"+l+f+":"+JSON.stringify(g)+"\n"}}}return await localFileSystem.writeFile(p+"/data.db",i,"utf8")}function g(){return new Promise((t,i)=>{e.listReports((async function(e,o){if(e)return i(e);for(const t in o){const n=o[t],c=n.tid;if(a[c])try{s?await v(n.id):r?await y(n.id):l&&await b(n)}catch(e){i(e)}}t()}))})}async function v(e){return await localFileSystem.copy(h+"/reports/"+e,p+"/reports/"+e)}async function y(e){return await cloudFileSystem.copyToLocal(h+"/reports/"+e,p+"/reports/"+e)}async function b(e){await localFileSystem.writeFile(h+"/reports/"+e.id+"/report.json",JSON.stringify(e)),await localFileSystem.copy(h+"/reports/"+e.id,p+"/reports/"+e.id)}async function w(){for(const e in a)await x(a[e])}async function x(e){var i=t.types[e.id];if(i&&i.files){var o=e.id;s?await T(o):r?await C(o):l&&await $(o)}}async function T(e){await localFileSystem.exists(h+"/files/"+e)&&await localFileSystem.copy(h+"/files/"+e,p+"/files/"+e)}async function C(t){var i={},n=e.tables[t];if(!n)return o();for(var a in n)if(n.hasOwnProperty(a)){i[n[a]._uu]=a}const s=await cloudFileSystem.listFiles(h+"/files/"+t);for(let e of s){const o=i[e];await k(t,e,o)}}async function k(e,t,i){const o=await cloudFileSystem.listFiles(h+"/files/"+e+"/"+t);for(let n of o)await cloudFileSystem.copyToLocal(h+"/files/"+e+"/"+t+"/"+n,p+"/files/"+e+"/"+i+"/"+n)}async function $(e){await localFileSystem.exists(h+"/files/"+e)&&await localFileSystem.copy(h+"/files/"+e,p+"/files/"+e)}async function S(){await NinoxZIP.zip(await localFileSystem.fileURL(p),i)}}function Qt(e,t){var i=new schemas.Schema(e,e.schema.toJSON()),o=i.types,n=[];for(var a in o)if(o.hasOwnProperty(a)){var s=t.types[a];s&&s.export||n.push(a)}return i.removeTypes(n),i}function Zt(e){if(!database.authorizationExport)return $.alert(locale.notAuthorized);var t=$.popdown({close:M}),i=t.$pane;Object(l.f)("DatabaseHomeExportData","Open"),$('<div class="nx-section-head">').text(locale.exportData).appendTo(i);var o=$('<div class="nx-switch-big">').appendTo(i),n=$('<div class="nx-switch-big-item selected">').text(locale.exportCSV).appendTo(o),a=$('<div class="nx-section-pane">').appendTo(i),s={},r=database.schema.types;for(var c in r)if(r.hasOwnProperty(c)){var d=r[c];database.canRead(d)&&(s[c]=d)}var h=new Jt({$container:a,types:s}),p=$('<div class="nx-button-bar">').appendTo(a);p.append($('<div class="nx-button-text grey">').text(locale.cancel).touch(O)),p.append($('<div class="nx-hspace-flex">')),p.append($('<div class="nx-button-text grey">').text(locale.csvExportSaveAs).touch(E)),p.append($('<div class="nx-hspace-small">')),p.append($('<div class="nx-button-text blue">').text(locale.csvExportOpen).touch(D));var u,f=$('<div class="nx-switch-big-item">').text(locale.exportXLS).appendTo(o),m=$('<div class="nx-section-pane">').hide().appendTo(i),g=$('<div class="nx-list" style="padding:0 16px;height:204px;overflow-x:hidden;overflow-y:auto">').appendTo($('<div class="nx-list-container">').appendTo(m));if(tables.xlsExportTids){u={};for(var v=0;v<tables.xlsExportTids.length;v++)u[tables.xlsExportTids[v]]=!0}k.each(util.localeSortBy(s,"caption"),(function(e){$('<div style="line-height:32px">').append($('<input type="checkbox"'+(void 0===u||u[e.id]?' checked="checked"':"")+">").data("tid",e.id)).append($("<label>").text(e.caption)).appendTo(g)}));var y=$('<div class="nx-button-bar">').appendTo(m);y.append($('<div class="nx-button-text grey">').text(locale.cancel).touch(O)),y.append($('<div class="nx-hspace-flex">')),y.append($('<div class="nx-button-text grey">').text(locale.xlsExportSaveAs).touch(S)),y.append($('<div class="nx-hspace-small">')),y.append($('<div class="nx-button-text blue">').text(locale.xlsExportOpen).touch(_));var b=$('<div class="nx-switch-big-item">').text("Ninox").appendTo(o),w=$('<div class="nx-section-pane">').hide().appendTo(i);N();var x=$('<div class="nx-button-bar">').appendTo(w);function T(){var e=[],t=g.find("input:checked");return k.each(t,(function(t){e.push($(t).data("tid"))})),e}function C(){tables.xlsExportTids=T()}function S(){C(),Object(l.f)("ExportData","DatabaseHomeExcelSave"),NinoxDocumentInteraction.saveFile(util.escapeFileName(database.name),"xlsx",(async function(e,t){try{if(e)return $.alert(e);if(!t)return;var i=await ei(tables.xlsExportTids);await localFileSystem.writeURLBase64(t,i),O()}catch(e){$.alert(e)}}))}async function _(){try{C();var e,t=await ei(tables.xlsExportTids);Object(l.f)("ExportData","DatabaseHomeExcelOpen"),e=await localFileSystem.tempURL(util.escapeFileName(database.name)+".xlsx"),await localFileSystem.writeURLBase64(e,t),O(),NinoxDocumentInteraction.previewDocument(e,(async function(){0}))}catch(e){$.alert(e)}}function E(){var e=h.getType();if(!e)return $.alert(locale.chooseTypeToExport);var t=database.schema.types[e];if(!t)return $.alert(locale.chooseTypeToExport);Object(l.f)("ExportData","DatabaseHomeCSVSave"),h.saveCSVExportOptions(),NinoxDocumentInteraction.saveFile(util.escapeFileName(t.caption),"csv",(async function(e,i){if(e)return $.alert(e);if(i){var o=h.getCSVExportOptions();try{var n=await ti(t,o);await localFileSystem.writeURL(i,n,o.encoding),O()}catch(e){$.alert(e)}}}))}async function D(){try{var e=h.getType();if(!e)return $.alert(locale.chooseTypeToExport);var t=database.schema.types[e];if(!t)return $.alert(locale.chooseTypeToExport);Object(l.f)("ExportData","DatabaseHomeCSVOpen"),h.saveCSVExportOptions();var i,o=h.getCSVExportOptions(),n=await ti(t,o);i=await localFileSystem.tempURL(util.escapeFileName(database.name)+".csv"),await localFileSystem.writeURL(i,n,o.encoding),O(),NinoxDocumentInteraction.previewDocument(i,(async function(){0}))}catch(e){return $.alert(e)}}function N(){var e=tables.ninoxExportOptions;e||(e=tables.ninoxExportOptions={});var t='<div class="nx-button-bar-small"><div class="nx-hspace-flex"></div><div class="nx-button-text-small blue" data-action="all">'+htmlEscape(locale.selectAll)+'</div><div class="nx-hspace-small"></div><div class="nx-button-text-small blue" data-action="clear">'+htmlEscape(locale.clearSelection)+'</div></div><div style="max-height:400px;overflow:auto;padding:0px;background-color:#fff;xborder:solid 1px #ddd;margin:8px"><table class="export-ninox-table"><thead><tr><th>'+htmlEscape(locale.table)+"</th><th>"+htmlEscape(locale.dataModel)+"</th><th>"+htmlEscape(locale.includeDataShort)+"</th><th>"+htmlEscape(locale.includeFilesShort)+"</th></tr></thead><tbody>";k.each(util.localeSortBy(database.schema.types,"caption"),(function(i){if(database.canRead(i)){var o=e[i.id];o||(o=e[i.id]={export:!0,data:!0,files:!0}),t+='<tr data-tid="'+i.id+'"><td>'+htmlEscape(i.caption)+'</td><td class="option"><input type="checkbox"'+(o.export?' checked="checked"':"")+'></td><td class="option"><input type="checkbox"'+(o.data?' checked="checked"':"")+'></td><td class="option"><input type="checkbox"'+(o.files?' checked="checked"':"")+"></td></tr>"}})),t+="</table></tbody></div>",w.html(t),w.on("change",(function(t){var i=$(t.target).closest("tr"),o=i.attr("data-tid");if(o){var n=e[o],a=i.find("input"),s=$(a[0]),r=$(a[1]),l=$(a[2]);n.export=s.prop("checked"),n.export?(n.data=r.prop("checked"),n.data?n.files=l.prop("checked"):(l.prop("checked",!1),n.files=!1)):(r.prop("checked",!1),l.prop("checked",!1),n.data=!1,n.files=!1)}})),w.touch((function(t){var i=$(t.target).attr("data-action");"all"===i?(w.find("input").prop("checked",!0),k.each(e,(function(e){e.export=!0,e.data=!0,e.files=!0}))):"clear"===i&&(w.find("input").prop("checked",!1),k.each(e,(function(e){e.export=!1,e.data=!1,e.files=!1})))}))}function I(){Object(l.f)("ExportData","NinoxExportSave"),NinoxDocumentInteraction.saveFile(util.escapeFileName(database.name),"ninox",(function(e,t){if(e)return $.alert(e);$.loading(!0),Kt(database,{types:tables.ninoxExportOptions||{}},t,(function(e){if($.loading(!1),e)return $.alert(e);O()}))}))}function O(){t.close(M)}function M(){h.destroy()}x.append($('<div class="nx-button-text grey">').text(locale.cancel).touch(O)),x.append($('<div class="nx-hspace-flex">')),x.append($('<div class="nx-button-text blue">').text(locale.xlsExportSaveAs).touch(I)),n.touch((function(){n.addClass("selected"),f.removeClass("selected"),b.removeClass("selected"),a.show(),m.hide(),w.hide()})),f.touch((function(){n.removeClass("selected"),f.addClass("selected"),b.removeClass("selected"),a.hide(),m.show(),w.hide()})),b.touch((function(){b.addClass("selected"),n.removeClass("selected"),f.removeClass("selected"),m.hide(),a.hide(),w.show()}))}async function ei(e){for(var t=[],i=0;i<e.length;i++){var o=e[i],n=database.schema.types[o];n&&database.canRead(n)&&t.push(await a(n))}return xlsx({worksheets:t}).base64;async function a(e){var t,i=e.sorted,o=[],n=[],a=[];n.push(a),a.push({value:"Id",autoWidth:!0});var r,l,c,d={id:!0};for(l=0;l<i.length;l++)if(((t=i[l]).isField&&"fn"!==t.base||t.isReference)&&database.canRead(t)){o.push(t);for(var h=util.escapeXLSColumnHead(t.caption,l),p=h,u=2;d[p.toLocaleLowerCase()];u++)p=h+u;d[p.toLocaleLowerCase()]=!0,a.push({value:p,autoWidth:!0})}var f=e.id,m=await database.getRowIds(f);if(m&&m.length)for(m.sort((function(e,t){return e-t})),await s(m.map(e=>f+e)),r=0;r<m.length;r++){var g=m[r],v=database.loadNodeSync2(f,g);for(a=[],n.push(a),a.push(g),l=0;l<o.length;l++)if((t=o[l]).isReference)c=null==(c=v[t.id])||""===c?"":parseInt(c),a.push(c);else{switch(c=v[t.id],t.base){case"number":break;case"date":case"timestamp":null!=c&&(c=new Date(c));break;case"datx":null!=c&&(c=new Date(c),c=new Date(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()));break;case"html":c=c?String(c):"";break;default:c=t.format(c)}null==c&&(c=""),a.push(c)}}else for(a=[],n.push(a),l=0;l<i.length;l++)a[l]="";return{table:!0,name:util.escapeFileName(e.caption).substr(0,30),data:n}}function s(e){return new Promise((t,i)=>{database.loadNodes(e,()=>{t()})})}}async function ti(e,t){var i,o,n,a=e.sorted,s=[],r=t.sep||",",l=(new RegExp("\\"+r,"g"),t.lf||"\r\n"),c=t.qut||'"',d=new RegExp("\\"+c,"g"),h=(t.encoding,t.numberFormat||"point"),p=t.dateFormat||"locale",u=t.header||!0,f="";if((t.sepHeader||!1)&&(f+="sep="+r+l),u){for(f+="Id",n=0;n<a.length;n++)(i=a[n]).isField&&"fn"!==i.base&&database.canRead(i)&&(s.push(i),f+=r+w(i.caption));f+=l}var m=e.id,g=await database.getRowIds(m);if(g)for(g.sort((function(e,t){return e-t})),o=0;o<g.length;o++){var v=g[o],y=database.loadNodeSync2(m,v);for(f+=v,n=0;n<s.length;n++){var b=y[(i=s[n]).id];switch(i.base){case"number":b=x(b);break;case"date":b=T(b);break;case"datx":b=C(b);break;case"timestamp":b=k(b);break;case"html":b=b?String(b):"";break;default:b=i.format(b)}null==b&&(b=""),f+=r+w(b)}f+=l}return f;function w(e){return null==e?"":("string"!=typeof e&&(e=String(e)),-1!==e.indexOf(c)||-1!==e.indexOf(r)||-1!==e.indexOf("\n")?c+e.replace(d,c+c)+c:e)}function x(e,t){if(null==e||"number"!=typeof e||isNaN(e))return"";switch(h){case"field":return t.format(e);case"comma":return String(e).replace(".",",");default:return String(e)}}function T(e){switch(p){case"iso":return util.formatISODate(e);case"gmt":return null==e?"":new Date(e).toString();case"timestamp":return null==e?"":String(e);default:return util.formatLocaleDate(e)}}function C(e){switch(p){case"iso":return util.formatISODatx(e);case"gmt":return null==e?"":new Date(e).toString();case"timestamp":return null==e?"":String(e);default:return util.formatLocaleDatx(e)}}function k(e){switch(p){case"iso":return util.formatISODateTime(e);case"gmt":return null==e?"":new Date(e).toString();case"timestamp":return null==e?"":String(e);default:return util.formatLocaleDateTime(e)}}}function ii(e,t){try{var i=database.schema.clone();for(var o in e.types)if(e.types.hasOwnProperty(o)){var n=e.types[o];if(a=i.uuids[n.uuid]){if(!a.isNodeType)throw locale.errorTypeNotFound+": "+n.uuid}else a=i.createType(n.captions[LOCALE]||n.captions.en,n.uuid)}for(var o in e.types)if(e.types.hasOwnProperty(o)){var a;n=e.types[o];if(!(a=i.uuids[n.uuid])||!a.isNodeType)throw locale.errorTypeNotFound+": "+n.uuid;for(var s in n.fields)if(n.fields.hasOwnProperty(s)){var r=n.fields[s];r.caption=r.captions[LOCALE]||r.captions.en;var l=i.uuids[r.uuid];if(l){if(l.type!==a)throw locale.errorFieldTypeMismatch+": "+r.uuid}else switch(r.base){case"rev":break;case"ref":var c=i.uuids[r.targetTypeUUID];if(!c||!c.isNodeType)throw locale.errorTypeNotFound+": "+r.targetTypeUUID;l=i.createReference(a,r.caption,c,r.targetCaptions[LOCALE]||r.targetCaptions.en,r.cascade,r.uuid,r.targetUUID,r.constraint,r.viewConfig,r.order,r.targetOrder,!0);break;case"tab":case"head":case"br":case"space":l=i.createUI(a,r.caption,r.order,r.base,r.uuid,!0);break;case"choice":var d=r.values;if(d)for(var h in d)if(d.hasOwnProperty(h)){var p=d[h];p.captions&&(p.caption=p.captions[LOCALE]||p.captions.en)}l=i.createField2(a,r,!0);break;default:l=i.createField2(a,r,!0)}}}database.updateSchema(i,(function(o){if(o)return t(o);if(e.views)for(var n=0;n<e.views.length;n++)try{var a=e.views[n],s=i.uuids[a.type];if(s&&s.isNodeType){var r={};r.id=a.id,r.type=s.id,r.caption=a.captions[LOCALE]||a.captions.en;var l=a.config,c=r.config={};c.type=s.id,c.cols=l.cols,c.sort=l.sort,c.descending=l.descending,c.group=l.group,database.saveView(r,(function(e){e&&$.alert(e)}))}}catch(o){console.log(o)}t()}))}catch(e){t(e)}}function oi(){var e,t,i={},o=!1;function n(){$.loading(!0);var e="http://templates.ninoxdb.de/tables.js";$.ajax({timeout:5e3,url:e,crossDomain:!0,dataType:"jsonp",jsonpCallback:"jsonpCallback",success:function(e){$.loading(!1),i=e,s()},error:function(e,t,i){$.loading(!1),$.alert(locale.errorGET)}})}function a(){if(!o){o=!0,e=$('<div class="nx-backplane nx-backplane-opaq">').appendTo($(document.body));var i=$('<div class="table-store-controls">').appendTo(e);$('<div class="button icon-big-grey icon-big-close" style="float:right">').appendTo(i).click(l),t=$('<div class="table-store-templates">').appendTo(e)}}function s(){o||a(),t.empty(),k.each(i,(function(e){var i=$('<div class="table-store-template">').appendTo(t);$('<img class="table-store-template-image" src="http://templates.ninoxdb.de/tables/'+e.uuid+'/preview.jpg">').appendTo(i),$('<div class="table-store-template-caption">').text(e.captions[LOCALE]||e.captions.en).appendTo(i),$('<div class="table-store-template-description">').text(e.descriptions[LOCALE]||e.descriptions.en).appendTo(i),i.click((function(){$.dialog({closable:!0,caption:locale.installTemplate,message:locale.confirmInstallTemplate+": "+(e.captions[LOCALE]||e.captions.en)+"?",buttons:[{color:"blue",caption:locale.installTemplateOkay,callback:function(){r(e)}}]})}))}))}function r(e){$.loading(!0),ii(e,(function(e){$.loading(!1),l(),e&&$.alert(e)}))}function l(){o&&(e.remove(),e=void 0,t=void 0)}n()}Jt.prototype.destroy=function(){this.csvTypeField&&this.csvTypeField.destroy(),this.csvHeaderField.destroy(),this.csvSepHeaderField.destroy(),this.csvSeparatorField.destroy(),this.csvQuoteField.destroy(),this.csvLinefeedField.destroy(),this.csvNumberFormatField.destroy(),this.csvDateFormatField.destroy(),this.csvEncodingField.destroy()},Jt.prototype.getType=function(){return this.csvType?this.csvType.value:void 0},Jt.prototype.getCSVExportOptions=function(){return{sep:this.csvSeparator.value,qut:this.csvQuote.value,lf:this.csvLinefeed.value,numberFormat:this.csvNumberFormat.value,dateFormat:this.csvDateFormat.value,header:this.csvHeader.value,sepHeader:this.csvSepHeader.value,encoding:this.csvEncoding.value}},Jt.prototype.saveCSVExportOptions=function(){Yt.csvHeaderDefault=this.csvHeader.value,Yt.csvSepHeaderDefault=this.csvSepHeader.value,Yt.csvLinefeedDefault=this.csvLinefeed.value,Yt.csvSeparatorDefault=this.csvSeparator.value,Yt.csvQuoteDefault=this.csvQuote.value,Yt.csvEncodingDefault=this.csvEncoding.value,Yt.csvDateFormatDefault=this.csvDateFormat.value,Yt.csvNumberFormatDefault=this.csvNumberFormat.value};const ni={uuid:"ninox.contacts",order:1,captions:{en:"Contact Management",de:"Kontaktverwaltung"},descriptions:{en:"Manage and import your contacts.",de:"Verwalten Sie Ihre Kontate und importieren Sie Ihr Adressbuch."},types:[{uuid:"ninox.contacts.contact",captions:{en:"Contact",de:"Kontakt"},fields:[{uuid:"ninox.contacts.contact.kind",captions:{en:"Kind",de:"Art"},base:"choice",required:!0,choiceDefault:1,values:{1:{id:1,captions:{en:"Person",de:"Person"}},2:{id:2,captions:{en:"Company",de:"Firma"}}},width:1,order:1},{uuid:"ninox.contacts.contact.gender",captions:{en:"Gender",de:"Anrede"},base:"choice",values:{1:{id:1,captions:{en:"Male",de:"Herr"}},2:{id:2,captions:{en:"Female",de:"Frau"}}},width:1,order:2},{uuid:"ninox.contacts.contact.prefix",captions:{en:"Title",de:"Titel"},base:"string",width:1,order:3},{uuid:"ninox.contacts.contact.birthday",captions:{en:"Birthday",de:"Geburtstag"},base:"date",dateCalendar:!0,dateCalendarColor:"#f00",dateYearly:!0,order:4},{uuid:"ninox.contacts.contact.firstname",captions:{en:"First name",de:"Vorname"},base:"string",width:2,order:5},{uuid:"ninox.contacts.contact.middlename",captions:{en:"Middle name",de:"Zweiter Vorname"},base:"string",visibility:"false",width:2,order:6},{uuid:"ninox.contacts.contact.lastname",captions:{en:"Last name",de:"Nachname"},base:"string",width:2,order:7},{uuid:"ninox.contacts.contact.suffix",captions:{en:"Suffix",de:"Namenszusatz"},base:"string",visibility:"false",width:1,order:8},{uuid:"ninox.contacts.contact.nickname",captions:{en:"Nickname",de:"Spitzname"},base:"string",visibility:"false",width:1,order:9},{uuid:"ninox.contacts.contact.organization",captions:{en:"Organization",de:"Firma"},base:"string",width:2,order:10},{uuid:"ninox.contacts.contact.department",captions:{en:"Department",de:"Abteilung"},base:"string",width:1,order:11},{uuid:"ninox.contacts.contact.jobtitle",captions:{en:"Job title",de:"Funktion"},base:"string",width:1,order:12},{uuid:"ninox.contacts.contact.tab1",captions:{en:"Info",de:"Info"},base:"tab",order:100},{uuid:"ninox.contacts.contact.groupname",captions:{en:"Group",de:"Gruppe"},base:"string",width:4,order:101},{uuid:"ninox.contacts.contact.note",captions:{en:"Note",de:"Notizen"},base:"html",width:4,order:102},{uuid:"ninox.contacts.contact.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contact.creationdate_ios",captions:{en:"Creation date (iOS)",de:"Erstell am (iOS)"},base:"timestamp",width:1,visibility:"false",order:902},{uuid:"ninox.contacts.contact.modificationdate_ios",captions:{en:"Modification date (iOS)",de:"Geändert am (iOS)"},base:"timestamp",width:1,visibility:"false",order:903}]},{uuid:"ninox.contacts.contactemail",captions:{en:"Contact Email",de:"Kontakt E-Mail"},fields:[{uuid:"ninox.contacts.contactemail.label",captions:{en:"Label",de:"Etikett"},base:"choice",required:!0,choiceDefault:1,values:{1:{id:1,captions:{en:"Home",de:"Privat"}},2:{id:2,captions:{en:"Work",de:"Arbeit"}},3:{id:3,captions:{en:"Other",de:"Andere"}}},nextChoiceId:1e3,width:1,order:1},{uuid:"ninox.contacts.contactemail.address",captions:{en:"Address",de:"Adresse"},base:"email",width:3,order:2},{uuid:"ninox.contacts.contactemail.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contactemail.contact",targetTypeUUID:"ninox.contacts.contact",targetUUID:"ninox.contacts.contact.contactemail",captions:{en:"Contact",de:"Kontakt"},targetCaptions:{en:"Email",de:"E-Mail"},base:"ref",cascade:!0,constraint:void 0,order:902,targetOrder:15,viewConfig:{cols:[{expression:"$ninox.contacts.contactemail.label$"},{expression:"$ninox.contacts.contactemail.address$"}]}}]},{uuid:"ninox.contacts.contactphone",captions:{en:"Contact Phone",de:"Kontakt Telefon"},fields:[{uuid:"ninox.contacts.contactphone.label",captions:{en:"Label",de:"Etikett"},base:"choice",values:{1:{id:1,captions:{en:"Home",de:"Privat"}},2:{id:2,captions:{en:"Work",de:"Arbeit"}},3:{id:3,captions:{en:"Other",de:"Andere"}},4:{id:3,captions:{en:"Mobile",de:"Mobil"}},5:{id:3,captions:{en:"FAX (home)",de:"Fax (privat)"}},6:{id:3,captions:{en:"FAX (work)",de:"Fax (Arbeit)"}},7:{id:3,captions:{en:"FAX (other)",de:"Fax (andere)"}},8:{id:3,captions:{en:"Main",de:"Zentrale"}},9:{id:3,captions:{en:"Pager",de:"Pager"}}},nextChoiceId:1e3,width:1,order:1},{uuid:"ninox.contacts.contactphone.number",captions:{en:"Number",de:"Nummer"},base:"phone",width:3,order:2},{uuid:"ninox.contacts.contactphone.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contactphone.contact",targetTypeUUID:"ninox.contacts.contact",targetUUID:"ninox.contacts.contact.contactphone",captions:{en:"Contact",de:"Kontakt"},targetCaptions:{en:"Phone",de:"Telefon"},base:"ref",cascade:!0,constraint:void 0,order:902,targetOrder:14,viewConfig:{cols:[{expression:"$ninox.contacts.contactphone.label$"},{expression:"$ninox.contacts.contactphone.number$"}]}}]},{uuid:"ninox.contacts.contactaddress",captions:{en:"Contact Address",de:"Kontakt Adresse"},fields:[{uuid:"ninox.contacts.contactaddress.label",captions:{en:"Label",de:"Etikett"},base:"choice",values:{1:{id:1,captions:{en:"Home",de:"Privat"}},2:{id:2,captions:{en:"Work",de:"Arbeit"}},3:{id:3,captions:{en:"Other",de:"Andere"}}},nextChoiceId:1e3,width:1,order:1},{uuid:"ninox.contacts.contactaddress.street",captions:{en:"Street",de:"Straße"},base:"string",width:4,order:2},{uuid:"ninox.contacts.contactaddress.zip",captions:{en:"ZIP",de:"PLZ"},base:"string",width:1,order:3},{uuid:"ninox.contacts.contactaddress.city",captions:{en:"City",de:"Stadt"},base:"string",width:3,order:4},{uuid:"ninox.contacts.contactaddress.state",captions:{en:"State",de:"Bundesland"},base:"string",width:2,order:5},{uuid:"ninox.contacts.contactaddress.country",captions:{en:"Country",de:"Land"},base:"string",width:2,order:6},{uuid:"ninox.contacts.contactaddress.countrycode",captions:{en:"Country code",de:"Länderkennung"},base:"string",visibility:"false",width:1,order:7},{uuid:"ninox.contacts.contactaddress.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contactaddress.contact",targetTypeUUID:"ninox.contacts.contact",targetUUID:"ninox.contacts.contact.contactaddress",captions:{en:"Contact",de:"Kontakt"},targetCaptions:{en:"Address",de:"Adresse"},base:"ref",cascade:!0,constraint:void 0,order:902,targetOrder:13,viewConfig:{cols:[{expression:"$ninox.contacts.contactaddress.label$"},{expression:"$ninox.contacts.contactaddress.street$"},{expression:"$ninox.contacts.contactaddress.zip$"},{expression:"$ninox.contacts.contactaddress.city$"}]}}]},{uuid:"ninox.contacts.contacturl",captions:{en:"Contact Internet",de:"Kontakt Internet"},fields:[{uuid:"ninox.contacts.contacturl.label",captions:{en:"Label",de:"Etikett"},base:"choice",values:{1:{id:1,captions:{en:"Home",de:"Privat"}},2:{id:2,captions:{en:"Work",de:"Arbeit"}},3:{id:3,captions:{en:"Other",de:"Andere"}},4:{id:4,captions:{en:"Home page",de:"Homepage"}}},nextChoiceId:1e3,width:1,order:1},{uuid:"ninox.contacts.contacturl.url",captions:{en:"URL",de:"URL"},base:"link",width:3,order:2},{uuid:"ninox.contacts.contacturl.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contacturl.contact",targetTypeUUID:"ninox.contacts.contact",targetUUID:"ninox.contacts.contact.contacturl",captions:{en:"Contact",de:"Kontakt"},targetCaptions:{en:"Internet",de:"Internet"},base:"ref",cascade:!0,constraint:void 0,order:3,targetOrder:902,viewConfig:{cols:[{expression:"$ninox.contacts.contacturl.label$"},{expression:"$ninox.contacts.contacturl.url$"}]}}]},{uuid:"ninox.contacts.contactinstantmessage",captions:{en:"Contact instant messenger accounts",de:"Kontakt Instant-Messenger-Accounts"},fields:[{uuid:"ninox.contacts.contactinstantmessage.label",captions:{en:"Label",de:"Etikett"},base:"choice",values:{1:{id:1,captions:{en:"Home",de:"Privat"}},2:{id:2,captions:{en:"Work",de:"Arbeit"}},3:{id:3,captions:{en:"Other",de:"Andere"}}},nextChoiceId:1e3,width:1,order:1,visibility:"false"},{uuid:"ninox.contacts.contactinstantmessage.service",captions:{en:"Service",de:"Dienst"},base:"string",width:1,order:2},{uuid:"ninox.contacts.contactinstantmessage.user",captions:{en:"User name",de:"Benutzername"},base:"string",width:3,order:3},{uuid:"ninox.contacts.contactinstantmessage.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contactinstantmessage.contact",targetTypeUUID:"ninox.contacts.contact",targetUUID:"ninox.contacts.contact.contactinstantmessage",captions:{en:"Contact",de:"Kontakt"},targetCaptions:{en:"Instant messenger accounts",de:"Instant-Messenger-Accounts"},base:"ref",cascade:!0,constraint:void 0,order:902,targetOrder:105,viewConfig:{cols:[{expression:"$ninox.contacts.contactinstantmessage.service$"},{expression:"$ninox.contacts.contactinstantmessage.user$"}]}}]},{uuid:"ninox.contacts.contactsocialprofile",captions:{en:"Contact social profiles",de:"Kontakt soziale Netzwerke"},fields:[{uuid:"ninox.contacts.contactsocialprofile.label",captions:{en:"Label",de:"Etikett"},base:"choice",values:{1:{id:1,captions:{en:"Home",de:"Privat"}},2:{id:2,captions:{en:"Work",de:"Arbeit"}},3:{id:3,captions:{en:"Other",de:"Andere"}}},nextChoiceId:1e3,width:1,order:1,visibility:"false"},{uuid:"ninox.contacts.contactsocialprofile.service",captions:{en:"Service",de:"Dienst"},base:"string",width:1,order:2},{uuid:"ninox.contacts.contactsocialprofile.user",captions:{en:"User name",de:"Benutzername"},base:"string",width:3,order:3},{uuid:"ninox.contacts.contactsocialprofile.userid",captions:{en:"User identifier",de:"Benutzer-ID"},base:"string",width:4,order:4,visibility:"false"},{uuid:"ninox.contacts.contactsocialprofile.id_ios",captions:{en:"ID (iOS)",de:"ID (iOS)"},base:"string",width:1,visibility:"false",order:901},{uuid:"ninox.contacts.contactsocialprofile.contact",targetTypeUUID:"ninox.contacts.contact",targetUUID:"ninox.contacts.contact.contactsocialprofile",captions:{en:"Contact",de:"Kontakt"},targetCaptions:{en:"Social network profiles",de:"Soziale Netzwerke"},base:"ref",cascade:!0,constraint:void 0,order:902,targetOrder:106,viewConfig:{cols:[{expression:"$ninox.contacts.contactsocialprofile.service$"},{expression:"$ninox.contacts.contactsocialprofile.user$"}]}}]}],views:[{id:"nxcontactscontactview1",type:"ninox.contacts.contact",captions:{en:"Contacts",de:"Kontakte"},config:{cols:[{expression:"$ninox.contacts.contact.firstname$"},{expression:"$ninox.contacts.contact.lastname$"},{expression:"$ninox.contacts.contact.birthday$"}],sort:0}}]};function ai(e){var t,i,o=database,n=e.dbid,a=e.accountId;function s(){$.loading(!0),dbms.openAnotherDatabase(a,n,(function(e,i){if($.loading(!1),e)return c(e);t=i,setTimeout(r,0)}))}function r(){var e=$.popdown();$('<div class="nx-section-head">').text(locale.importFromAnotherDatabase).appendTo(e.$pane);var n=$('<div class="nx-section-pane">').appendTo(e.$pane);function a(){Object(l.f)("ImportData","NinoxDatabaseImport"),$.dialog({closable:!0,caption:locale.importFromAnotherDatabase,message:locale.confirmImportNinox,buttons:[{color:"red",caption:locale.importExecute,callback:function(){$.loading(!0),si(o,t,i,(function(t){if($.loading(!1),t)return $.alert(t);Object(l.f)("ImportData","NinoxDatabaseImportNow"),e.close(),c()}))}}]})}function s(){e.close(),c()}u(n),$('<div class="nx-button-bar">').appendTo(n).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(s)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.import).touch(a))}function c(e){t&&(t.closeDatabase((function(e){e&&$.alert(e)})),t=void 0),e&&$.alert(e)}function d(){return{types:h()}}function h(){var e={},i=t.schema.types;for(var n in i)if(i.hasOwnProperty(n)){var a=i[n],s=o.schema.uuids[a.uuid];s&&!s.isNodeType&&(s=void 0),s||(s=o.schema.findType(a.caption)),e[n]={import:!0,data:!0,files:!0,target:s?s.id:void 0,fields:p(s,a)}}return e}function p(e,t){for(var i={},o=t.sorted,n=0;n<o.length;n++){var a=o[n],s=void 0;e&&((s=e.schema.uuids[a.uuid])&&s.base===a.base&&s.type===e||(s=e.findElement(a.caption))&&s.base===a.base||(s=void 0)),i[(a.isUI?"ui:":"field:")+a.id]={import:!0,target:s?s.id:void 0}}return i}function u(e){i=d();var n='<div class="nx-button-bar-small"><div class="nx-hspace-flex"></div><div class="nx-button-text-small blue" data-action="all">'+htmlEscape(locale.selectAll)+'</div><div class="nx-hspace-small"></div><div class="nx-button-text-small blue" data-action="clear">'+htmlEscape(locale.clearSelection)+'</div></div><div style="max-height:400px;overflow:auto;padding:0px;background-color:#fff;xborder:solid 1px #ddd;margin:8px"><table class="export-ninox-table"><thead><tr><th>'+htmlEscape(locale.table)+"</th><th>"+htmlEscape(locale.dataModel)+"</th><th>"+htmlEscape(locale.includeDataShort)+"</th><th>"+htmlEscape(locale.includeFilesShort)+"</th><th>"+htmlEscape(locale.targetTable)+"</th></tr></thead><tbody>";k.each(util.localeSortBy(t.schema.types,"caption"),(function(e){var t=i.types[e.id];n+='<tr data-tid="'+e.id+'"><td>'+htmlEscape(e.caption)+'</td><td class="option"><input type="checkbox"'+(t.import?' checked="checked"':"")+'></td><td class="option"><input type="checkbox"'+(t.data?' checked="checked"':"")+'></td><td class="option"><input type="checkbox"'+(t.files?' checked="checked"':"")+"></td>",n+='<td><select size="1" style="width:120px"><option value="#NEW#"'+(t.target?"":" selected")+">"+htmlEscape(locale.addTable)+"</option>",k.each(util.localeSortBy(o.schema.types,"caption"),(function(e){n+='<option value="'+e.id+'"'+(t.target==e.id?" selected":"")+">"+htmlEscape(e.caption)+"</option>"})),n+="</select></td>",n+="</tr>"})),n+="</table></tbody></div>",e.html(n),e.on("change",(function(e){var n=$(e.target).closest("tr"),a=n.attr("data-tid");if(a){var s=t.schema.types[a],r=i.types[a],l=n.find("input"),c=$(l[0]),d=$(l[1]),h=$(l[2]),u=n.find("select");r.import=c.prop("checked"),r.import?(r.data=d.prop("checked"),r.data?r.files=h.prop("checked"):(h.prop("checked",!1),r.files=!1),u.prop("disabled",!1)):(d.prop("checked",!1),h.prop("checked",!1),r.data=!1,r.files=!1,u.prop("disabled",!0));var f=u.val();if(f!==r.target){var m="#NEW#"===f?void 0:o.schema.types[f];r.target=m?m.id:void 0,r.fields=p(m,s)}}})),e.touch((function(t){var o=$(t.target).attr("data-action");"all"===o?(e.find("input").prop("checked",!0),k.each(i.types,(function(e){e.import=!0,e.data=!0,e.files=!0})),e.find("select").prop("disabled",!1)):"clear"===o&&(e.find("input").prop("checked",!1),k.each(i.types,(function(e){e.import=!1,e.data=!1,e.files=!1})),e.find("select").prop("disabled",!0))}))}s()}function si(e,t,i,o){var n,a,s=e.local||!1,r=t.local||!1,l=e.cloud||!1,c=t.cloud||!1,d=e.sql||!1,h=(t.sql,i.types||{}),p={},u={},f={},m={},g={mapField:function(e){return u[e.type.id+"."+e.id]},mapType:function(e){return p[e.id]}},v=t.schema,y=v.types;try{n=new schemas.Schema(e,e.schema.toJSON()),a=n.types,b()}catch(e){return o("Cannot merge schema: "+e)}function b(){for(var e in y)if(y.hasOwnProperty(e)){var t=y[e];if(!(b=h[e])||!b.import)continue;if(b.target){if(!(w=a[b.target]))throw new Error("Type not found: "+b.target);p[t.id]=w}else{(w=n.createType(li(n,t.caption))).icon=t.icon,w.hidden=t.hidden,w.color=t.color,w.background=t.background,w.formWidth=t.formWidth,w.description=t.description,w.readRoles=t.readRoles,w.writeRoles=t.writeRoles,w.createRoles=t.createRoles,w.deleteRoles=t.deleteRoles,p[t.id]=w}}for(var e in y)if(y.hasOwnProperty(e)){t=y[e];if(!(b=h[e])||!b.import)continue;if(!(w=p[e]))continue;w.id;var i=t.sorted,o=b.fields||{};console.log("IMPORT FIELDS",i.length);for(var s=0;s<i.length;s++){var r=(x=i[s]).id,l=o[(x.isUI?"ui:":"field:")+x.id];if(console.log("IMPORT FIELD",s,x.caption,JSON.stringify(l)),l&&l.import)if(l.target){var c=x.isUI?w.uis[l.target]:w.fields[l.target];u[x.type.id+"."+x.id]=c}else if(x.isField){(v=x.toJSON()).fn=void 0,v.visibility=void 0,v.afterUpdate=void 0,v.caption=ci(w,x.caption),v.uuid=void 0;c=n.createField2(w,v);u[e+"."+r]=c}else if(x.isReference){var d=p[x.refType.id];if(d){if(!d)throw new Error("Referenced type not found for field: "+x.type.caption+"."+x.caption+" => "+x.refType.caption+"."+x.reverse.caption);var m=ci(w,x.caption),g=ci(d,x.reverse.caption);c=n.createReference(w,m,d,g,x.cascade,void 0,void 0,void 0,void 0,x.order,void 0,!1);u[x.type.id+"."+x.id]=c,u[x.reverse.type.id+"."+x.reverse.id]=c.reverse}}else if(x.isReverse);else if(x.isUI){var v;(v=x.toJSON()).caption=ci(w,x.caption),v.uuid=void 0,v.visibility=void 0,v.fn=void 0;c=n.createUI2(w,v);f[e+"."+r]=c}}}for(var e in y)if(y.hasOwnProperty(e)){var b,w;t=y[e];if(!(b=h[e])||!b.import||b.target)continue;if(!(w=p[e]))continue;w.id;w.afterCreate=O(t,t.afterCreate),w.afterUpdate=O(t,t.afterUpdate),w.canRead=O(t,t.canRead),w.canWrite=O(t,t.canWrite);for(i=t.sorted,o=b.fields||{},s=0;s<i.length;s++){var x;r=(x=i[s]).id;if((l=o[(x.isUI?"ui:":"field:")+x.id])&&l.import&&!l.target)(c=x.isUI?f[e+"."+r]:u[e+"."+r])&&(c.visibility=O(t,x.visibility),c.afterUpdate=O(t,x.afterUpdate),c.fn=O(t,x.fn),x.isReference&&(c.constraint=O(t,x.constraint),x.reverse.viewConfig&&(c.reverse.viewConfig=F(x.reverse.viewConfig))))}}}function w(i){t.loadViews((function(t,o){if(t)return i(t);for(var n in o)if(o.hasOwnProperty(n)){var a=o[n],s=a.type,r=h[s];if(!r||!r.import)continue;var l=p[s];if(!l)continue;var c=l.id,d=Object.assign({},a);d.id=util.createUUID(16),d.type=c,d.config&&(d.config=F(d.config)),e.saveView(d,(function(){}))}i()}))}function x(i){function o(e){t.listReports((function(t,i){if(t)return e(t);var o=[],n={};for(var a in i)if(i.hasOwnProperty(a)){var s=i[a],r=s.tid,l=y[r];if(!l)continue;var c=h[r];if(!c||!c.import)continue;var d=p[r];if(!d)continue;var u=Object.assign({},s);u.id=util.createUUID(12),u.tid=d.id;var f=u.objects;if(f)for(var m=0;m<f.length;m++){var g=f[m];switch(g.base){case"text":g.text=M(l,g.text);break;case"html":g.fn=O(l,g.fn);break;case"imagefield":g.fid=I(r,g.fid);break;case"rev":g.expression=O(l,g.expression),g.viewConfig=F(g.viewConfig)}}n[u.id]=a,o.push(u)}e(void 0,o,n)}))}function n(t,i,o){util.asyncEach(t,(function(t,o){e.updateReport(t,(function(e){if(e)return o(e);a(t,i[t.id],o)}))}),o)}function a(e,t,i){s?r?d(e,t,i):c?u(e,t,i):i():l?r?f(e,t,i):c?m(e,t,i):i():i()}async function d(i,o,n){let a="data/"+e.id+"/reports/"+i.id+"/files",s="data/"+t.id+"/reports/"+o+"/files";try{let e=await localFileSystem.listFiles(s);for(let t of e){let e=a+"/"+t,i=s+"/"+t;await localFileSystem.copy(i,e)}n()}catch(e){n(e)}}async function u(i,o,n){let a="data/"+e.id+"/reports/"+i.id+"/files",s="data/"+t.id+"/reports/"+o+"/files";try{const e=await cloudFileSystem.listFiles(s);for(let t of e){let e=a+"/"+t,i=s+"/"+t;await cloudFileSystem.copyToLocal(i,e)}n()}catch(e){n(e)}}async function f(i,o,n){let a="data/"+e.id+"/reports/"+i.id+"/files",s="data/"+t.id+"/reports/"+o+"/files";try{const e=await localFileSystem.listFiles(s);for(let t of e){let e=a+"/"+t,i=s+"/"+t;await cloudFileSystem.copyFromLocal(i,e)}n()}catch(e){n(e)}}async function m(i,o,n){let a="data/"+e.id+"/reports/"+i.id+"/files",s="data/"+t.id+"/reports/"+o+"/files";try{const e=await cloudFileSystem.listFiles(s);for(let t of e){let e=a+"/"+t,i=s+"/"+t;await cloudFileSystem.copyFromCloud(i,e)}n()}catch(e){n(e)}}o((function(e,t,o){if(e)return i(e);n(t,o,(function(e){if(e)return i(e);i()}))}))}async function T(i){var o=[];for(var n in y)if(y.hasOwnProperty(n)){var a=y[n],s=h[n];if(!s||!s.import||!s.data)continue;var r=a.fields,l=p[n];if(!l)continue;for(var c=l.id,d=await t.getRowIds(n),f=0;f<d.length;f++){var g=d[f],v=t.loadNodeSync2(n,g),b={_type:c,_clientId:n+g};for(var w in v)if(v.hasOwnProperty(w)){if("_"===w[0])continue;var x=r[w];if(!x)continue;var T=v[w];if(null==T)continue;var C=u[n+"."+w];if(!C)continue;x.isField&&"fn"!==x.base?b[C.id]=T:x.isReference&&(b[C.id]=x.refType.id+T)}o.push(b)}}e.updateNodes(o,(function(e){if(e)return i(e);for(var t=0;t<o.length;t++){var n=o[t];m[n._clientId]=n._id}i()}))}function C(e){util.asyncEach(y,k,e)}function k(e,t){var i=e.id,o=h[i];if(!(o&&o.import&&o.data&&o.files))return t();var n=p[i];if(!n)return t();s?r?$(n,e,t):c?S(n,e,t):t():l?r?_(n,e,t):c?E(n,e,t):t():d?r?D(n,e,t):c?N(n,e,t):t():t()}async function $(i,o,n){let a="data/"+e.id+"/files/"+i.id,s="data/"+t.id+"/files/"+o.id;try{const e=await localFileSystem.listFiles(s);for(let t of e){let e=o.id+t,i=m[e];if(!i)continue;let n=a+"/"+schemas.ridOf(i),r=s+"/"+t;const l=await localFileSystem.listFiles(r);if(l)for(let e of l){let t=n+"/"+e,i=r+"/"+e;await localFileSystem.copy(i,t)}}n()}catch(e){n(e)}}async function S(i,o,n){let a=t.tables[o.id];if(!a)return n();let s={};for(let e in a)if(a.hasOwnProperty(e)){let t=a[e];s[t._uu]=t._id}let r="data/"+e.id+"/files/"+i.id,l="data/"+t.id+"/files/"+o.id;try{const e=await cloudFileSystem.listFiles(l);for(let t of e){let e=s[t];if(!e)continue;let i=m[e];if(!i)continue;let o=r+"/"+schemas.ridOf(i),n=l+"/"+t;const a=await cloudFileSystem.listFiles(n);if(a)for(let e of a){let t=o+"/"+e,i=n+"/"+e;await cloudFileSystem.copyToLocal(i,t)}}n()}catch(e){n(e)}}async function _(i,o,n){let a=e.tables[i.id];if(!a)return n();let s="data/"+e.id+"/files/"+i.id,r="data/"+t.id+"/files/"+o.id;try{const e=await localFileSystem.listFiles(r);for(let t of e){let e=o.id+t,i=m[e];if(!i)continue;let n=a[schemas.ridOf(i)];if(!n)continue;let l=s+"/"+n._uu,c=r+"/"+t;const d=await localFileSystem.listFiles(c);if(d)for(let e of d){let t=l+"/"+e,i=c+"/"+e;await cloudFileSystem.copyFromLocal(i,t)}}n()}catch(e){n(e)}}async function E(i,o,n){let a=e.tables[i.id];if(!a)return n();let s=t.tables[o.id];if(!s)return n();let r={};for(let e in s)if(s.hasOwnProperty(e)){let t=s[e];r[t._uu]=t._id}let l="data/"+e.id+"/files/"+i.id,c="data/"+t.id+"/files/"+o.id;try{const e=await cloudFileSystem.listFiles(c);for(let t of e){let e=r[t],i=m[e];if(!i)continue;let o=a[schemas.ridOf(i)];if(!o)continue;let n=l+"/"+o._uu,s=c+"/"+t;const d=await cloudFileSystem.listFiles(s);if(d)for(let e of d){let t=n+"/"+e,i=s+"/"+e;await cloudFileSystem.copyFromCloud(i,t)}}n()}catch(e){n(e)}}async function D(i,o,n){try{let a=e.path+"/files/"+i.id,s="data/"+t.id+"/files/"+o.id;const r=await localFileSystem.listFiles(s);for(let t of r){let i=o.id+t,n=m[i];if(!n)continue;let r=a+"/"+schemas.ridOf(n),l=s+"/"+t;const c=await localFileSystem.listFiles(l);if(c)for(let t of c){let i=r+"/"+t,o=l+"/"+t;await localFileSystem.copy(o,i),e.sqldb.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[n,t])}}n()}catch(e){n(e)}}async function N(i,o,n){let a=t.tables[o.id];if(!a)return n();let s={};for(let e in a)if(a.hasOwnProperty(e)){let t=a[e];s[t._uu]=t._id}let r=e.path+"/files/"+i.id,l="data/"+t.id+"/files/"+o.id;try{const t=await cloudFileSystem.listFiles(l);for(let i of t){let t=s[i];if(!t)continue;let o=m[t];if(!o)continue;let n=r+"/"+schemas.ridOf(o),a=l+"/"+i;const c=await cloudFileSystem.listFiles(a);if(c)for(let t of c){let i=n+"/"+t,s=a+"/"+t;await cloudFileSystem.copyToLocal(s,i),e.sqldb.exec2("REPLACE INTO files (nid,name,sync,seq) VALUES (?,?,2,0)",[o,t])}}n()}catch(e){n(e)}}function I(e,t){var i=u[e+"."+t];return i?i.id:void 0}function O(e,t){if(!t)return t;try{return queries.parseSystem(v,e,t,{},!1).toMappedString(g)}catch(e){return void console.log('Failed to map expression "'+t+'": '+e)}}function M(e,t){return t?queries.parseSystemStringTemplate(e.schema,e,t,{}).toMappedString(g,!0):t}function F(e){if(!e)return e;if(e){var t=y[e.type];if(t){var i=p[e.type];if(i){var o=Object.assign({},e);o.type=i.id;var n=o.cols;if(n)for(var a=0;a<n.length;a++){var s=n[a];if(s.expression){var r=O(t,s.expression);s.expression=r}}return o}}}}e.updateSchema(n,(function(t){if(t)return o(t);n=e.schema,a=n.types,w((function(e){if(e)return o(e);x((function(e){if(e)return o(e);T((function(e){if(e)return o(e);C((function(e){if(e)return o(e);o()}))}))}))}))}))}var ri=/([0-9]+)$/;function li(e,t){var i=0,o=t,n=ri.exec(t);for(n&&(i=parseInt(n[1])+1,o=t.substr(0,n.index),t=o+i);e.findType(t);)t=o+ ++i;return t}function ci(e,t){t||(t=locale.unnamed);var i=0,o=t,n=ri.exec(t);for(n&&(i=parseInt(n[1])+1,o=t.substr(0,n.index),t=o+i);e.findElement(t);)t=o+ ++i;return t}function di(){var e=database.schema,t=fe("ninox.contacts.contact"),i=me(t,"ninox.contacts.contact.id_ios","string"),o=me(t,"ninox.contacts.contact.kind","choice"),n=(me(t,"ninox.contacts.contact.gender","choice"),me(t,"ninox.contacts.contact.prefix","string")),a=me(t,"ninox.contacts.contact.firstname","string"),s=me(t,"ninox.contacts.contact.lastname","string"),r=me(t,"ninox.contacts.contact.middlename","string"),c=me(t,"ninox.contacts.contact.suffix","string"),d=me(t,"ninox.contacts.contact.nickname","string"),h=me(t,"ninox.contacts.contact.organization","string"),p=me(t,"ninox.contacts.contact.department","string"),u=me(t,"ninox.contacts.contact.jobtitle","string"),f=me(t,"ninox.contacts.contact.birthday","date"),m=me(t,"ninox.contacts.contact.note","html"),g=me(t,"creationdate_ios","timestamp"),v=me(t,"modificationdate_ios","timestamp"),y=me(t,"ninox.contacts.contact.groupname","string"),b=fe("ninox.contacts.contactemail"),w=me(b,"ninox.contacts.contactemail.label","choice"),x=me(b,"ninox.contacts.contactemail.address","email"),T=me(b,"ninox.contacts.contactemail.id_ios","string"),C=me(b,"ninox.contacts.contactemail.contact","ref",t),k=fe("ninox.contacts.contactphone"),S=me(k,"ninox.contacts.contactphone.label","choice"),_=me(k,"ninox.contacts.contactphone.number","phone"),E=me(k,"ninox.contacts.contactphone.id_ios","string"),D=me(k,"ninox.contacts.contactphone.contact","ref",t),N=fe("ninox.contacts.contactaddress"),I=me(N,"ninox.contacts.contactaddress.label","choice"),O=me(N,"ninox.contacts.contactaddress.street","string"),M=me(N,"ninox.contacts.contactaddress.zip","string"),F=me(N,"ninox.contacts.contactaddress.city","string"),R=me(N,"ninox.contacts.contactaddress.state","string"),L=me(N,"ninox.contacts.contactaddress.country","string"),j=me(N,"ninox.contacts.contactaddress.countrycode","string"),A=me(N,"ninox.contacts.contactaddress.id_ios","string"),P=me(N,"ninox.contacts.contactaddress.contact","ref",t),U=fe("ninox.contacts.contacturl"),H=me(U,"ninox.contacts.contacturl.label","choice"),z=me(U,"ninox.contacts.contacturl.url","link"),V=me(U,"ninox.contacts.contacturl.id_ios","string"),W=me(U,"ninox.contacts.contacturl.contact","ref",t),B=fe("ninox.contacts.contactinstantmessage"),q=me(B,"ninox.contacts.contactinstantmessage.label","choice"),Y=me(B,"ninox.contacts.contactinstantmessage.service","string"),X=me(B,"ninox.contacts.contactinstantmessage.user","string"),G=me(B,"ninox.contacts.contactinstantmessage.id_ios","string"),J=me(B,"ninox.contacts.contactinstantmessage.contact","ref",t),K=fe("ninox.contacts.contactsocialprofile"),Q=me(K,"ninox.contacts.contactsocialprofile.label","choice"),Z=me(K,"ninox.contacts.contactsocialprofile.service","string"),ee=me(K,"ninox.contacts.contactsocialprofile.user","string"),te=me(K,"ninox.contacts.contactsocialprofile.userid","string"),ie=me(K,"ninox.contacts.contactsocialprofile.id_ios","string"),oe=me(K,"ninox.contacts.contactsocialprofile.contact","ref",t);if(t&&i&&a&&s){$.loading(!0);var ne=[],ae={},se={},re={},le=1,ce=[];de((function(e){if(e)return $.loading(!1),$.alert(e);he((function(e){if(e)return $.loading(!1),$.alert(e);pe((function(e){if(e)return $.loading(!1),$.alert(e);$.loading(!1),$.alert(locale.importSuccessful),Object(l.f)("ImportData","ImportContactsSuccessful")}))}))}))}else $.dialog({closable:!0,caption:locale.templateRequired,message:locale.templateRequiredContacts,buttons:[{color:"blue",caption:locale.templateRequiredOkay,callback:function(){new oi}}]});function de(e){NinoxAddressBook.loadContacts((function(t,i){if(t)return e(t);ne=i,e()}))}function he(e){database.select("select "+t.id,(function(t,o){if(t)return e(t);database.loadNodes(o,(function(t){if(t)return e(t);for(var n=0;n<o.length;n++){var r=database.loadNodeSync(o[n]);if(r){ae[o[n]]=r,r[i.id]&&(se[r[i.id]]=r);var l=r[s.id],c=r[a.id];c&&l&&(re[l+"~"+c]=r)}}e()}))}))}function pe(e){ce=[];for(var t=0;t<ne.length;t++)ue(ne[t]);database.updateNodes(ce,e)}function ue(e){var l,$=void 0;e.id_ios&&($=se[e.id_ios]),!$&&e.firstname&&e.lastname&&($=re[e.lastname+"~"+e.firstname]);var ne={};if($?(ne._id=$._id,l=schemas.ridOf($._id)):(l=ne._clientId="$"+t.id+le++,ne._type=t.id),ne[i.id]=e.id_ios,o&&(ne[o.id]="person"===e.kind?1:"organization"===e.kind?2:void 0),n&&(ne[n.id]=e.prefix),a&&(ne[a.id]=e.firstname),s&&(ne[s.id]=e.lastname),r&&(ne[r.id]=e.middlename),c&&(ne[c.id]=e.suffix),d&&(ne[d.id]=e.nickname),h&&(ne[h.id]=e.organization),p&&(ne[p.id]=e.department),u&&(ne[u.id]=e.jobtitle),f&&(ne[f.id]=e.birthday),m&&e.note&&(ne[m.id]=e.note.replace(/\r?\n\r?/g,"<br>")),g&&(ne[g.id]=e.creationdate_ios),v&&(ne[v.id]=e.modificationdate_ios),y&&(ne[y.id]=e.groupname),ce.push(ne),e.phone&&k&&D&&E){var ae={},de={},he={};if($){var pe=$[D.reverse.id];if(pe)for(var ue=0;ue<pe.length;ue++){var fe=k.id+pe[ue];if(ge=database.loadNodeSync(fe))ae[fe]=ge,(we=ge[E.id])&&(de[we]=ge)}}for(ue=0;ue<e.phone.length;ue++){var me=e.phone[ue],ge=de[ue],ve={},ye=String(ue);he[ye]=ve,ge?ve._id=ge._id:ve._type=k.id,ve[D.id]=l,ve[E.id]=ye,S&&(ve[S.id]=me.label),_&&(ve[_.id]=me.number),ce.push(ve)}for(var be in ae){var we;if(ae.hasOwnProperty(be))(we=(ge=ae[be])[E.id])&&!he[we]&&ce.push({_id:ge._id,_deleted:!0})}}if(e.email&&b&&C&&T){var xe={},Te={},Ce={};if($){var ke=$[C.reverse.id];if(ke)for(ue=0;ue<ke.length;ue++){var $e=b.id+ke[ue];if(_e=database.loadNodeSync($e))xe[$e]=_e,(Ne=_e[T.id])&&(Te[Ne]=_e)}}for(ue=0;ue<e.email.length;ue++){var Se=e.email[ue],_e=Te[ue],Ee={},De=String(ue);Ce[De]=Ee,_e?Ee._id=_e._id:Ee._type=b.id,Ee[C.id]=l,Ee[T.id]=De,w&&(Ee[w.id]=Se.label),x&&(Ee[x.id]=Se.address),ce.push(Ee)}for(var be in xe){var Ne;if(xe.hasOwnProperty(be))(Ne=(_e=xe[be])[T.id])&&!Ce[Ne]&&ce.push({_id:_e._id,_deleted:!0})}}if(e.url&&U&&W&&V){var Ie={},Oe={},Me={};if($){var Fe=$[W.reverse.id];if(Fe)for(ue=0;ue<Fe.length;ue++){var Re=U.id+Fe[ue];if(je=database.loadNodeSync(Re))Ie[Re]=je,(Ue=je[V.id])&&(Oe[Ue]=je)}}for(ue=0;ue<e.url.length;ue++){var Le=e.url[ue],je=Oe[ue],Ae={},Pe=String(ue);Me[Pe]=Ae,je?Ae._id=je._id:Ae._type=U.id,Ae[W.id]=l,Ae[V.id]=Pe,H&&(Ae[H.id]=Le.label),z&&(Ae[z.id]=Le.url),ce.push(Ae)}for(var be in Ie){var Ue;if(Ie.hasOwnProperty(be))(Ue=(je=Ie[be])[V.id])&&!Me[Ue]&&ce.push({_id:je._id,_deleted:!0})}}if(e.address&&N&&P&&A){var He={},ze={},Ve={};if($){var We=$[P.reverse.id];if(We)for(ue=0;ue<We.length;ue++){var Be=N.id+We[ue];if(Ye=database.loadNodeSync(Be))He[Be]=Ye,(Je=Ye[A.id])&&(ze[Je]=Ye)}}for(ue=0;ue<e.address.length;ue++){var qe=e.address[ue],Ye=ze[ue],Xe={},Ge=String(ue);Ve[Ge]=Xe,Ye?Xe._id=Ye._id:Xe._type=N.id,Xe[P.id]=l,Xe[A.id]=Ge,I&&(Xe[I.id]=qe.label),O&&(Xe[O.id]=qe.street),M&&(Xe[M.id]=qe.zip),F&&(Xe[F.id]=qe.city),R&&(Xe[R.id]=qe.state),L&&(Xe[L.id]=qe.country),j&&(Xe[j.id]=qe.countrycode),ce.push(Xe)}for(var be in He){var Je;if(He.hasOwnProperty(be))(Je=(Ye=He[be])[A.id])&&!Ve[Je]&&ce.push({_id:Ye._id,_deleted:!0})}}if(e.instantmessage&&B&&J&&G){var Ke={},Qe={},Ze={};if($){var et=$[J.reverse.id];if(et)for(ue=0;ue<et.length;ue++){var tt=B.id+et[ue];if(ot=database.loadNodeSync(tt))Ke[tt]=ot,(st=ot[G.id])&&(Qe[st]=ot)}}for(ue=0;ue<e.instantmessage.length;ue++){var it=e.instantmessage[ue],ot=Qe[ue],nt={},at=String(ue);Ze[at]=nt,ot?nt._id=ot._id:nt._type=B.id,nt[J.id]=l,nt[G.id]=at,q&&(nt[q.id]=it.label),Y&&(nt[Y.id]=it.service),X&&(nt[X.id]=it.user),ce.push(nt)}for(var be in Ke){var st;if(Ke.hasOwnProperty(be))(st=(ot=Ke[be])[G.id])&&!Ze[st]&&ce.push({_id:ot._id,_deleted:!0})}}if(e.socialprofile&&K&&oe&&ie){var rt={},lt={},ct={};if($){var dt=$[oe.reverse.id];if(dt)for(ue=0;ue<dt.length;ue++){var ht=K.id+dt[ue];if(ut=database.loadNodeSync(ht))rt[ht]=ut,(gt=ut[ie.id])&&(lt[gt]=ut)}}for(ue=0;ue<e.socialprofile.length;ue++){var pt=e.socialprofile[ue],ut=lt[ue],ft={},mt=String(ue);ct[mt]=ft,ut?ft._id=ut._id:ft._type=K.id,ft[oe.id]=l,ft[ie.id]=mt,Q&&(ft[Q.id]=pt.label),Z&&(ft[Z.id]=pt.service),ee&&(ft[ee.id]=pt.user),te&&(ft[te.id]=pt.userid),ce.push(ft)}for(var be in rt){var gt;if(rt.hasOwnProperty(be))(gt=(ut=rt[be])[ie.id])&&!ct[gt]&&ce.push({_id:ut._id,_deleted:!0})}}}function fe(t){var i=e.uuids[t];if(i&&i.isNodeType)return i}function me(t,i,o,n){if(t){var a=e.uuids[i];if(a&&a.type===t&&("ref"!==o||a.refType===n))return a}}}const hi={importCSVEncodingDefault:"utf8",importCSVHeaderDefault:!0,importCSVQuoteDefault:'"',importCSVSeparatorDefault:void 0,importCSVNumberFormatDefault:void 0,importCSVDateFormatDefault:"auto",importTypeDefault:void 0,importModeDefault:"all",importAmbiguousDefault:"skip"};function pi(e){void 0===hi.importCSVNumberFormatDefault&&(NinoxDocumentInteraction.defaultDecimalSymbolIsComma()?(hi.importCSVNumberFormatDefault="comma",hi.importCSVSeparatorDefault=";"):(hi.importCSVNumberFormatDefault="point",hi.importCSVSeparatorDefault=","));var t=null,i=null,o="",n=[],a=[],s=[],r=!1,c=null,d=null,h=null;function p(){return database?u():$.alert("Please open a database. Then try again to open a CSV file with Ninox to import it into that database.")}function u(){if(!database.authorizationImport)return $.alert(locale.notAuthorized);if(e.url)return i=e.url,void setTimeout(f,0);var o=$.popdown(),n=o.$pane;t=null,i=null,$('<div class="nx-section-head">').text(locale.importData).appendTo(n);var a=$.tabs({$parent:n,tabs:[{caption:"CSV"},{caption:locale.contacts},{caption:"Ninox"}]});$('<div class="import-choose-from">').text(locale.importChooseCSVFile).appendTo(a.tabs[0].$pane).click(d),$('<div class="import-choose-from">').text(locale.importChooseURL).appendTo(a.tabs[0].$pane).click(c),$('<div class="nx-button-bar">').appendTo(a.tabs[0].$pane).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(p)),function(){var e=$('<div class="nx-picklist" style="max-height:320px">').appendTo(a.tabs[2].$pane),t=dbms.getLocalDatabases();k.each(b.util.localeSortBy(t,"name"),(function(t){$('<div class="nx-picklist-item" data-dbid="'+encodeURIComponent(t.id)+'" data-account="'+encodeURIComponent(t.account)+'">').text(t.name).appendTo(e)}));var i=void 0,o=void 0,n=void 0;function s(){Object(l.f)("ImportData","ChooseNinoxDatabase"),o&&(p(),new ai({dbid:o,accountId:n}))}e.touch((function(e){var t=$(e.target).closest(".nx-picklist-item"),a=t.attr("data-dbid"),s=t.attr("data-account");a&&(a=decodeURIComponent(a),s=decodeURIComponent(s),i&&i.removeClass("selected"),t.addClass("selected"),i=t,o=a,n=s)})),$('<div class="nx-button-bar">').appendTo(a.tabs[2].$pane).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(p)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.next).touch(s))}();var s=$("<div>").appendTo(a.tabs[1].$pane);function r(){s.empty();var e=database.schema.uuids["ninox.contacts.contact"];e&&e.isNodeType?$('<div class="import-choose-from">').text(locale.importContacts).appendTo(s).click((function(){Object(l.f)("ImportData","ImportMyContacts"),p(),new di})):($('<p class="center">').text(locale.templateRequiredContacts).appendTo(s),database.isAdminEnabled()&&$('<div class="import-choose-from">').text(locale.templateRequiredOkay).appendTo(s).click((function(){Object(l.f)("ImportData","InstallTableTemplate"),ii(ni,(function(e){if(e)return $.alert(e);r()}))})))}function c(){Object(l.f)("ImportData","ChooseURL");var e=$.popdown({cls:"small"}),t=$('<div class="nx-section-pane">').appendTo(e.$pane),o=$('<div class="component editor editor-string" style="width:100%">').appendTo(t);$("<label>").text(locale.importEnterURL).appendTo(o);var n=$('<input type="url">').appendTo($('<div class="stringeditor">').appendTo(o));function a(){e.close()}function s(){var e=n.val();e&&(a(),i=e,h())}$('<div class="nx-button-bar">').appendTo(t).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(a)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.next).touch(s))}function d(){Object(l.f)("ImportData","ChooseFile"),NinoxDocumentInteraction.chooseFileWithExtensions(["csv","txt"],(function(e,t){if(e)return $.alert(e);t&&(i=t,h())}))}function h(){Object(l.f)("ImportData","ChooseSourceConfirm"),p(),setTimeout(f,0)}function p(){o.close()}r(),$('<div class="nx-button-bar">').appendTo(a.tabs[1].$pane).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(p))}function f(){var t=$.popdown(),i=t.$pane;$('<div class="nx-section-head">').text(locale.importSourceSettings).appendTo(i);var o=$('<div class="nx-section-pane">').appendTo(i),n=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvEncoding,required:!0,formWidth:2/3,values:{utf8:{caption:"UTF-8 (Unicode)",order:1},utf16:{caption:"UTF-16 (Unicode)",order:13},ascii:{caption:"ASCII",order:14},"mac-roman":{caption:"Mac Roman",order:2},"windows-cp1252":{caption:"Windows Latin 1 CP1252",order:3},"windows-cp1250":{caption:"Windows Latin 2 CP1250",order:4},"windows-cp1251":{caption:"Windows Cyrillic CP1251",order:5},"windows-cp1253":{caption:"Windows Greek CP1253",order:6},"windows-cp1254":{caption:"Windows Turkish CP1254",order:7},"iso-latin1":{caption:"ISO Latin 1",order:8},"iso-latin2":{caption:"ISO Latin 2",order:9},"japanese-euc":{caption:"Japanese EUC",order:10},"japanese-shift":{caption:"Japanese SHIFT",order:11},"japanese-iso":{caption:"Japanese ISO",order:12}}}));n.value=hi.importCSVEncodingDefault;new qt.a(void 0,n,o);var a=new b.util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.importHeader,booleanDefault:!0,required:!0,formWidth:1/3}));a.value=hi.importCSVHeaderDefault;new qt.a(void 0,a,o);var s=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvSeparator,required:!0,formWidth:1/4,values:{",":{caption:",",order:1},";":{caption:";",order:2},"|":{caption:"|",order:3},"\t":{caption:locale.csvSeparatorTab,order:4}}}));s.value=hi.importCSVSeparatorDefault;new qt.a(void 0,s,o);var h=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvQuote,required:!0,formWidth:1/4,values:{'"':{caption:'"'},"'":{caption:"'"}}}));h.value=hi.importCSVQuoteDefault;new qt.a(void 0,h,o);var p=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvNumberFormat,required:!0,formWidth:1/4,values:{point:{caption:locale.csvNumberFormatPoint,order:1},comma:{caption:locale.csvNumberFormatComma,order:2}}}));p.value=hi.importCSVNumberFormatDefault;new qt.a(void 0,p,o);var f=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.csvDateFormat,required:!0,formWidth:1/4,values:{auto:{caption:"auto",order:1},"YYYY-MM-DD":{caption:"YYYY-MM-DD",order:2},"DD/MM/YY":{caption:"DD/MM/YY",order:3},"DD/MM/YYYY":{caption:"DD/MM/YYYY",order:4},"MM/DD/YY":{caption:"MM/DD/YY",order:5},"MM/DD/YYYY":{caption:"MM/DD/YYYY",order:6},"MMM, DD YYYY":{caption:"MMM, DD YYYY",order:7},"DD.MM.YYYY":{caption:"DD.MM.YYYY",order:8}}}));f.value=hi.importCSVDateFormatDefault;new qt.a(void 0,f,o);$('<div class="nx-section-head">').text(locale.importTargetSettings).appendTo(i),o=$('<div class="nx-section-pane">').appendTo(i);var y={};database.isAdminEnabled()&&(y["#new#"]={id:"#new#",caption:locale.importCreateTable,order:-1}),k.each(b.util.localeSortBy(database.schema.types,"caption"),(function(e,t){y[e.id]={id:e.id,caption:e.caption,oder:t}}));var x=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.importTable,required:!0,formWidth:1,values:y}));y[hi.importTypeDefault]||(hi.importTypeDefault="#new#"),x.value=e.tid||hi.importTypeDefault,database.isAdminEnabled()||"#new#"!==x.value||(x.value=void 0);new qt.a(void 0,x,o);var T=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.importMode,required:!0,formWidth:2/3,values:{all:{id:"all",caption:locale.importModeAll},new:{id:"new",caption:locale.importModeNew},update:{id:"update",caption:locale.importModeUpdate}}}));T.value=hi.importModeDefault;new qt.a(void 0,T,o);var C=new b.util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.importAmbiguous,required:!0,formWidth:1/3,values:{skip:{id:"skip",caption:locale.importAmbiguousSkip},updateAll:{id:"updateAll",caption:locale.importAmbiguousUpdateAll}}}));C.value=hi.importAmbiguousDefault;new qt.a(void 0,C,o);var S=$('<div class="nx-button-bar">').appendTo(o);function _(){hi.importCSVEncodingDefault=n.value,hi.importCSVHeaderDefault=a.value,hi.importCSVSeparatorDefault=s.value,hi.importCSVQuoteDefault=h.value,hi.importCSVNumberFormatDefault=p.value,hi.importCSVDateFormatDefault=f.value,hi.importTypeDefault=x.value,hi.importModeDefault=T.value,hi.importAmbiguousDefault=C.value}function E(){_(),t.close(),setTimeout(u,0)}function D(){if(Object(l.f)("Import CSV","DataSource&ImportSettingsNext"),!y[x.value])return $.alert(locale.importTable);_(),$.loading(!0),setTimeout((function(){m((function(e){if(e)return $.loading(!1),"InvalidEncoding"===e&&(e=locale.invalidEncoding),$.alert(e);g((function(e){if($.loading(!1),e)return $.alert(e);if(t.close(),"#new#"===x.value)setTimeout(w,0);else{if(r=!1,c=database.schema,!(d=c.types[x.value]))return $.alert(locale.errorTypeNotFound);setTimeout(v,0)}}))}))}),0)}function N(){t.close()}$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(S).touch(N),$('<div class="nx-hspace-flex">').appendTo(S),$('<div class="nx-button-text grey">').text(locale.back).appendTo(S).touch(E),$('<div class="nx-hspace-small">').appendTo(S),$('<div class="nx-button-text blue">').text(locale.next).appendTo(S).touch(D)}async function m(e){if(i)try{const t=await localFileSystem.readURL(i,hi.importCSVEncodingDefault);o=t,e()}catch(t){e(t)}else if(t){var n={utf8:"utf-8",utf16:"UTF-16",ascii:"ASCII","mac-roman":"mac","windows-cp1252":"windows-1252","windows-cp1250":"windows-1250","windows-cp1251":"windows-1251","windows-cp1253":"windows-1253","windows-cp1254":"windows-1254","iso-latin1":"iso-8859-1","iso-latin2":"iso-8859-2","japanese-euc":"euc-jp","japanese-shift":"csshiftjis","japanese-iso":"iso-2022-jp"}[hi.importCSVEncodingDefault];n||(n="utf-8");var a=new FileReader;a.onerror=function(){e(a.error)},a.onloadend=function(t){o=a.result,e()},a.readAsText(t,n)}else $.alert("Nothing to import.")}function g(e){if(!(n=b.util.parseCSV(o,{sep:hi.importCSVSeparatorDefault,qut:hi.importCSVQuoteDefault}))||n.length<1)return e(locale.importNoDataFound);hi.importCSVHeaderDefault?(a=n[0],s=n.slice(1)):(a=[],s=n);for(var t=0,i=0;i<s.length;i++)t=Math.max(t,s[i].length);for(i=0;i<t;i++)a[i]||(a[i]=locale.column+(i+1));e()}function v(){for(var e=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)),t=$('<div class="import2-pane">').appendTo(e),i=new schemas.TChoice(void 0,void 0,{width:1,required:!0,values:{"key-exact":{id:"key-exact",caption:locale.importFieldModeKeyExact},"update-always":{id:"update-always",caption:locale.importFieldModeUpdateAlways},"update-empty":{id:"update-empty",caption:locale.importFieldModeUpdateEmpty}}}),o={},n=[],s=[],r=[],c=y(!1),p=0;p<a.length;p++){(r[p]={index:p,caption:a[p],base:c[p],importFieldModeModel:new b.util.SimpleModel(i,"update-always")}).importFieldModeModel.withoutLabel=!0}window.getHeight();var u=$('<div class="popupeditor panel centered width-768 fullheight">').appendTo(t).droppable({accept:".import-available-field",drop:S}),m=$('<div class="pane import-fields-pane">').appendTo(u);$("<h1>").text(locale.importFields).appendTo(m);var g=$('<div style="position:absolute;top:32px;left:0;right:0;bottom:0;overflow:auto">').appendTo(m),v=$('<div class="pane import-availables-pane">').appendTo(u);$("<h1>").text(locale.importAvailableFields).appendTo(v);var w=$('<div class="import-availables" style="position:absolute;top:48px;left:0;right:0;bottom:0;overflow:auto">').appendTo(v),T=$('<div class="nx-button-bar" style="position:absolute;left:16px;bottom:8px;right:16px;height:32px">').appendTo(u);function C(){for(var e=d.sorted,t=0;t<r.length;t++){var i=r[t];if(!n[i.index])for(var a=0;a<e.length;a++){var s=e[a];s.isField&&database.canWrite(s)&&void 0===o[s.id]&&_i(i.caption,s.caption)&&(n[i.index]=s.id,o[s.id]=i.index)}}}function S(e,t){$(e.target);var i=t.draggable.data("col");if(i){var a=n[i.index];a&&(delete n[i.index],delete s[i.index],delete o[a],setTimeout(E,0))}}function _(e,t){var i=$(e.target),a=t.draggable,r=i.closest(".import-col").data("col");if(r){var l=a.data("field");if(l){var c=a.data("refField"),d=a.data("col");if(d){n[d.index];delete n[d.index],delete s[d.index],delete o[l.id]}var h=n[r.index];h&&(delete n[r.index],delete s[r.index],delete o[h]),n[r.index]=l.id,c&&(s[r.index]=c.id),o[l.id]=r.index,"_id"!==l.id||c||r.importFieldModeModel.setValue("key-exact"),setTimeout(E,0)}}}function E(){D(),N()}function D(){g.empty();var e={greedy:!0,accept:".import-available-field",hoverClass:"hover",drop:_},t={helper:"clone",appendTo:$(document.body),zIndex:1e3};k.each(r,(function(i){var o=$('<div class="import-col">').data("col",i).appendTo(g);$(`<div class="import-col-source-assign" title="${i.caption}">`).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+(i.base||"string"))).append($('<div class="t-columneditor-label">').text(i.caption)).appendTo(o);$('<div class="import-col-arrow">').appendTo(o);var a=$('<div class="import-col-target-assign">').appendTo(o).droppable(e);if(d){var r=n[i.index];if(r){var l="_id"===r?d.field_id:d.fields[r];if(l)if("_id"===r)$('<div class="import-available-field t-columneditor-column">').data("field",l).data("col",i).appendTo(a).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+l.base)).append($('<div class="t-columneditor-label">').text(l.caption)).draggable(t);else if(l.isField){$('<div class="import-available-field t-columneditor-column">').data("field",l).data("col",i).appendTo(a).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+l.base)).append($('<div class="t-columneditor-label">').text(l.caption)).draggable(t);new qt.a(void 0,i.importFieldModeModel,o).el.css("width",150)}else if(l.isReference){var c=s[i.index],h=l.refType,p="_id"===c?h.field_id:h.fields[c];if(p){$('<div class="import-available-field t-columneditor-column">').data("field",l).data("refField",p).data("col",i).appendTo(a).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+l.base)).append($('<div class="t-columneditor-label">').text(l.caption+" ("+p.caption+")")).draggable(t);new qt.a(void 0,i.importFieldModeModel,o).el.css("width",150)}}}}}))}function N(){w.empty();var e={helper:"clone",appendTo:$(document.body),zIndex:1e3};void 0===o._id&&$('<div class="import-available-field t-columneditor-column">').data("field",d.field_id).appendTo(w).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+d.field_id.base)).append($('<div class="t-columneditor-label">').text(d.field_id.caption)).draggable(e),k.each(d.sorted,(function(t){if(t.isField&&database.canWrite(t)){if(void 0===o[t.id])var i=$('<div class="import-available-field t-columneditor-column">').data("field",t).appendTo(w).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+t.base)).append($('<div class="t-columneditor-label">').text(t.caption)).draggable(e)}else if(t.isReference&&database.canWrite(t)&&void 0===o[t.id]){var n=t.refType,a=(i=$('<div class="import-available-field t-columneditor-column expandable">').data("field",t).appendTo(w),$('<div class="t-columneditor-label icon-big-black icon-big-expand">').appendTo(i));$('<div class="t-columneditor-label">').text(t.caption).appendTo(i);var s=$('<div style="padding-left:32px">').hide().appendTo(w);$('<div class="import-available-field t-columneditor-column">').data("field",t).data("refField",n.field_id).appendTo(s).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+t.base)).append($('<div class="t-columneditor-label">').text(n.field_id.caption)).draggable(e),k.each(n.sorted,(function(i){"number"!==i.base&&"string"!==i.base||$('<div class="import-available-field t-columneditor-column">').data("field",t).data("refField",i).appendTo(s).append($('<div class="t-columneditor-label type-symbol-grey">').addClass("type-symbol-"+i.base)).append($('<div class="t-columneditor-label">').text(i.caption)).draggable(e)})),i.click((function(){s.toggle(),a.toggleClass("icon-big-expand icon-big-collapse")}))}}))}function I(){e.remove(),setTimeout(f,0)}function O(){Object(l.f)("ImportData","FieldsNext"),h=[];for(var t=0;t<r.length;t++){var i=r[t],o=n[i.index];if(o){var a="_id"===o?d.field_id:d.fields[o];if("_id"===o&&h.push({index:t,field:a,mode:"key-exact"}),a.isField)h.push({index:t,field:a,mode:i.importFieldModeModel.value});else if(a.isReference){var c=a.refType,p=s[i.index],u="_id"===p?c.field_id:c.fields[p];u&&h.push({index:t,field:a,refField:u,mode:i.importFieldModeModel.value})}}}e.remove(),setTimeout(x,0)}function M(){e.remove()}$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(T).touch(M),$('<div class="nx-hspace-flex">').appendTo(T),$('<div class="nx-button-text grey">').text(locale.back).appendTo(T).touch(I),$('<div class="nx-hspace-small">').appendTo(T),$('<div class="nx-button-text blue">').text(locale.next).appendTo(T).touch(O),C(),E()}function y(e){for(var t=[],i=0;i<a.length;i++)for(var o=t[i]={boolean:!0,number:!0,date:!0,timestamp:!0,multiline:!1},n=0;n<s.length&&n<100;n++){var r=s[n][i];""!==r&&null!=r&&(o.boolean&&void 0===fi(r)&&(o.boolean=!1),o.number&&!gi(r,hi.importCSVNumberFormatDefault)&&(o.number=!1),o.date&&!1===Ci(r)&&(o.date=!1),o.timestamp&&!1===wi(r)&&(o.timestamp=!1),!o.multiline&&/[\r\n]/.test(r)&&(o.multiline=!0))}var l=[];for(i=0;i<t.length;i++){o=t[i];l[i]=o.number?"number":o.boolean?"boolean":o.date?"datx":o.timestamp?"timestamp":e&&o.multiline?"string-multiline":"string"}return l}function w(){r=!0,c=database.schema.clone(),d=null;var e=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)),o=$('<div class="import2-pane">').appendTo(e),n=$('<div class="popupeditor pane centered width-3col fullheight">').appendTo(o),s=$("<div>").appendTo(n),p=new b.util.SimpleModel(new schemas.TString(void 0,void 0,{caption:locale.enterTableName,required:!0,formWidth:1}));if(i){var u=/\/([^\/\?\.]+)(?:\.[^\?\/]*)?(?:\?.*)?$/.exec(i);u&&(p.value=decodeURIComponent(u[1]))}else t&&(p.value=t.name);new qt.a(void 0,p,s);for(var m=$('<div style="position:absolute;left:24px;top:80px;right:0px;bottom:48px;overflow-y:auto;overflow-x:hidden">').appendTo(n),g=new schemas.TChoice(void 0,void 0,{formWidth:1,required:!0,values:{string:{id:"string",caption:locale.types.string,order:1},"string-multiline":{id:"string-multiline",caption:locale.types.string_multiline,order:1.5},html:{id:"html",caption:locale.types.html,order:2},number:{id:"number",caption:locale.types.number,order:3},boolean:{id:"boolean",caption:locale.types.boolean,order:4},choice:{id:"choice",caption:locale.types.choice,order:5},date:{id:"date",caption:locale.types.date,order:6},time:{id:"time",caption:locale.types.time,order:8},timestamp:{id:"timestamp",caption:locale.types.timestamp,order:9},timeinterval:{id:"timeinterval",caption:locale.types.timeinterval,order:10},appointment:{id:"appointment",caption:locale.types.appointment,order:11},link:{id:"link",caption:locale.types.link,order:12},email:{id:"email",caption:locale.types.email,order:13},phone:{id:"phone",caption:locale.types.phone,order:14},location:{id:"location",caption:locale.types.location,order:15},color:{id:"color",caption:locale.types.color,order:16},icon:{id:"icon",caption:locale.types.icon,order:17}}}),v=y(!0),w=[],T=0;T<a.length;T++){var C=a[T],k=w[T]={},S=$('<div class="import-col">').appendTo(m),_=$('<div class="import-col-source-create">').appendTo(S),E=new b.util.SimpleModel(new schemas.TString(void 0,void 0,{required:!0,stringMinLength:1,caption:locale.fieldCaption,formWidth:1}));E.withoutLabel=!0,E.value=C,k.name=E;new qt.a(void 0,E,_);$('<div class="import-col-arrow">').appendTo(S);var D=$('<div class="import-col-target-create">').appendTo(S),N=new b.util.SimpleModel(g);N.withoutLabel=!0,N.value=v[T],k.type=N,new qt.a(void 0,N,D).el.css({margin:0,width:200})}var I=$('<div class="nx-button-bar" style="position:absolute;left:16px;bottom:8px;right:16px;height:32px">').appendTo(n);function O(){e.remove(),setTimeout(f,0)}function M(){Object(l.f)("ImportData","UpdateTableAndFieldsNext"),d=c.createType(p.value),h=[];for(var t=0;t<w.length;t++){var i=w[t],o=c.createField2(d,{base:"string-multiline"===i.type.value?"string":i.type.value,caption:i.name.value,order:t,stringMultiline:"string-multiline"===i.type.value||void 0});h.push({index:t,field:o,mode:"update-always"})}e.remove(),setTimeout(x,0)}function F(){e.remove()}$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(I).touch(F),$('<div class="nx-hspace-flex">').appendTo(I),$('<div class="nx-button-text grey">').text(locale.back).appendTo(I).touch(O),$('<div class="nx-hspace-small">').appendTo(I),$('<div class="nx-button-text blue">').text(locale.next).appendTo(I).touch(M)}function x(){for(var t=hi.importModeDefault,i=hi.importAmbiguousDefault,o=h,n={},a=[],p=[],u=[],f=[],m=0;m<o.length;m++){var g=o[m],y=g.mode,b=g.field;if(b&&y)switch(y){case"key-exact":p.push({col:g,field:b,index:{}});break;case"update-always":if(!b.isNew&&!database.canWrite(b))return T(locale.errorNotAuthorized+": "+b.caption);u.push({col:g,field:b,always:!0}),b.isReference&&f.push(g);break;case"update-empty":if(!b.isNew&&!database.canWrite(b))return T(locale.errorNotAuthorized+": "+b.caption);u.push({col:g,field:b,always:!1}),b.isReference&&f.push(g)}}function x(e){setTimeout((function(){var t="select "+d.id;database.select(t,(function(t,i){if(t)return e(t);database.loadNodes(i,(function(t){if(t)return e(t);for(var o=0;o<i.length;o++){var a=i[o],s=database.loadNodeSync(a);s&&(n[a]=s)}e()}))}))}),0)}function C(e){function t(i){if(i===f.length)return e();var o=f[i],n={};o.refIndex=n;var a=o.field,s=o.refField,r="select "+a.refType.id;database.select(r,(function(o,a){if(o)return e(o);database.loadNodes(a,(function(o){if(o)return e(o);for(var r=0;r<a.length;r++){var l=a[r],c=database.loadNodeSync(l);if(c){var d=c[s.id];null!=d&&("nid"===s.base&&(d=schemas.ridOf(d)),void 0===n[d]?n[d]=c._id:n[d]=null)}}setTimeout(t,0,i+1)}))}))}setTimeout(t,0,0)}function S(){for(var e=[],o={},r=0;r<p.length;r++){var l=(E=p[r]).index,c=E.field.id;for(var h in n){if(n.hasOwnProperty(h))null==(C=(b=n[h])[c])&&(C=""),"_id"===c&&(C=schemas.ridOf(C)),(g=l[C])||(g=l[C]=[]),g.push(h)}}for(var f=0;f<s.length;f++){var m=s[f],g=void 0;for(r=0;r<p.length;r++){null==(C=m[(E=p[r]).col.index])&&(C=""),C="_id"===E.field.id?C:Si(C,E.field);var v=E.index[C];g=v?g?k.intersection(g,v):v:[]}if(g&&g.length>0){if(g.length>0&&(1===g.length||"updateAll"===i))for(var y=0;y<g.length;y++){h=g[y];var b=n[h],w=o[h];w||(w={_id:h});for(var x=0,T=0;T<u.length;T++){if("_id"!==(N=(D=u[T]).field).id){var C=m[(I=D.col).index],$=b[N.id];if(N.isField)null!=(O=Si(C,N))&&""!==O||(O=null),D.always?O!==$&&(w[N.id]=O,x++):null!=$&&""!==$||(w[N.id]=O,x++);else if(N.isReference){if(O=I.refIndex[C])(M=database.ridOf(O))&&(D.always?M!==$&&(w[N.id]=M,x++):$||(w[N.id]=M,x++));else w[N.id]=null}}}x>0&&(o[h]=w)}}else{x=0;var S={_type:d.id};for(T=0;T<p.length;T++){var E;if("_id"!==(N=(E=p[T]).field).id)null!=(O=Si(C=m[(I=E.col).index],N))&&""!==O&&(S[N.id]=O,x++)}for(T=0;T<u.length;T++){var D,N;if("_id"!==(N=(D=u[T]).field).id){var I;C=m[(I=D.col).index];if(N.isField)null!=(O=Si(C,N))&&""!==O&&(S[N.id]=O,x++);else if(N.isReference){var O,M;if(O=I.refIndex[C])(M=database.ridOf(O))&&(S[N.id]=M,x++)}}}x>0&&e.push(S)}}switch(t){case"all":a=k.values(o).concat(e);break;case"new":a=e;break;case"update":a=k.values(o);break;default:a=[]}_()}function _(){var t=d.sorted,i=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)),o=$('<div class="import-preview">').appendTo(i),s=$('<div class="nx-button-bar" style="position:absolute;left:0;bottom:0;right:0">').appendTo(o);$('<div class="nx-button-text grey">').text(locale.cancel).touch(S).appendTo(s),$('<div class="nx-hspace-flex">').appendTo(s),$('<div class="nx-button-text grey">').text(locale.back).touch(k).appendTo(s),$('<div class="nx-hspace-small">').appendTo(s),$('<div class="nx-button-text blue">').text(locale.importExecute).touch(C).appendTo(s);var h=$('<div style="position:absolute;left:0;top:20px;width:100%;padding:8px 0 8px 8px;box-sizing:border-box;-moz-box-sizing:border-box;text-align:right">').appendTo(o);$('<div style="float:left;height:32px;line-height:32px">').text(locale.importPreview).appendTo(h),h.button("prev",void 0,void 0,b);var p=$('<div style="display:inline-block;height:32px;line-height:32px">').appendTo(h);h.button("next",void 0,void 0,x);var u=$('<div style="position:absolute;left:0;top:68px;width:100%;bottom:48px;overflow:auto">').appendTo(o),f=window.getHeight()-128,m=Math.max(1,Math.floor(f/33)-1),g=0,y=Math.ceil(a.length/m);function b(){--g<0&&(g=y-1),T()}function x(){++g>=y&&(g=0),T()}function T(){p.text(locale.page+" "+(g+1)+" / "+y);for(var e="<table><thead><tr><th></th>",i=0;i<t.length;i++){((v=t[i]).isField&&"fn"!==v.base||v.isReference)&&(e+="<th>"+htmlEscape(v.caption)+"</th>")}e+="</tr></thead><tbody>";for(var o=g*m,s=Math.min(o+m,a.length),r=o;r<s;r++){var l=a[r];if(e+="<tr>",l._id){var c=l._id,d=n[c];e+="<td>"+htmlEscape(schemas.ridOf(c))+"</td>";for(i=0;i<t.length;i++){if((v=t[i]).isField&&"fn"!==v.base||v.isReference){var h=l[v.id],f=d[v.id];e+='<td class="cell-'+v.base+'">',null!=f&&""!==f&&(e+='<div class="import-cell-old">'+htmlEscape(v.format(f))+"</div>"),void 0!==h&&(e+='<div class="import-cell-update">'+htmlEscape(v.format(h))+"</div>"),e+="</td>"}}}else{e+="<td>"+htmlEscape(locale.new)+"</td>";for(i=0;i<t.length;i++){var v;if((v=t[i]).isField&&"fn"!==v.base||v.isReference){e+='<td class="cell-'+v.base+'">';var b=l[v.id];void 0!==b&&(e+='<div class="import-cell-update">'+htmlEscape(v.format(b))+"</div>"),e+="</td>"}}}e+="</tr>"}e+="</tbody></table>",u.html(e)}function C(){Object(l.f)("ImportData","ImportNow"),$.loading(!0),r?database.updateSchema(c,(function(t){t?($.loading(!1),$.alert(locale.importFailed+": "+t)):database.updateNodes(a,(function(t){t?($.loading(!1),$.alert(locale.importFailed+": "+t)):($.loading(!1),$.alert(locale.importSuccessful),Object(l.f)("ImportData","ImportSuccessful"),S(),e.success&&e.success())}))})):database.updateNodes(a,(function(t){t?($.loading(!1),$.alert(locale.importFailed+": "+t)):($.loading(!1),$.alert(locale.importSuccessful),Object(l.f)("ImportData","ImportSuccessful"),S(),e.success&&e.success())}))}function k(){i.remove(),r?setTimeout(w,0):setTimeout(v,0)}function S(){i.remove()}T()}r?S():($.loading(!0),x((function(e){if(e)return $.loading(!1),T(e);C((function(e){if(e)return $.loading(!1),T(e);$.loading(!1),S()}))})))}function T(e){$.alert(e),r?setTimeout(w,0):setTimeout(v,0)}setTimeout(p,0),Object(l.f)("ImportData","Open")}function fi(e){var t=locale.yes.toLowerCase(),i=locale.no.toLowerCase(),o=locale.true.toLowerCase(),n=locale.false.toLowerCase();if(null!=e)return"1"===(e=e.trim().toLowerCase())||"true"===e||"t"===e||e===t||e===o||"0"!==e&&"false"!==e&&"f"!==e&&e!==i&&e!==n&&void 0}function mi(e,t){if(null!=e&&(e=e.trim(),""!==(e="comma"===t?(e=e.replace(/[^0-9\,\-]/g,"")).replace(",","."):e.replace(/[^0-9\.\-]/g,""))&&(e=Number(e),!isNaN(e))))return e}function gi(e,t){return"comma"===t?/^\s*(\+|\-)?\s*([0-9]+\.?)+(\,[0-9]+)?[^0-9]*$/.test(e):/^\s*(\+|\-)?\s*([0-9]+\,?)+(\.[0-9]+)?[^0-9]*$/.test(e)}var vi=/^\-?[0-9]+$/,yi=/^([0-9]{4})\-([0-9]{1,2})\-([0-9]{1,2})((?:T|\s+)([0-9]{1,2})\:([0-9]{1,2})(\:([0-9]{1,2})(\.([0-9]+))?)?(Z?))?$/i,bi=/^(mon|tue|wed|thu|fri|sat|sun) (jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec) ([0-9]{1,2}) ([0-9]{4})( ([0-9]{1,2})\:([0-9]{1,2})(\:([0-9]{1,2}))?)?( GMT([\+\-][0-9]{1,4})?( \(([a-z]{3})\))?)?/i;function wi(e){if(null!=e&&""!==e)return yi.test(e)||bi.test(e)||b.util.isLocaleDateTime(e)}function xi(e){if(null!=e){e=e.trim();var t=vi.test(e),i=yi.exec(e),o=bi.test(e);if(t)return parseInt(e);if(i){var n=new Date(0);if(i[11])n.setUTCFullYear(Number(i[1]||0)),n.setUTCMonth(Number(i[2]||0)-1),n.setUTCDate(Number(i[3]||0)),n.setUTCHours(Number(i[5]||0)),n.setUTCMinutes(Number(i[6]||0)),n.setUTCSeconds(Number(i[8]||0)),n.setUTCMilliseconds(Number(i[10]||0));else(n=new Date(0)).setFullYear(Number(i[1]||0)),n.setMonth(Number(i[2]||0)-1),n.setDate(Number(i[3]||0)),n.setHours(Number(i[5]||0)),n.setMinutes(Number(i[6]||0)),n.setSeconds(Number(i[8]||0)),n.setMilliseconds(Number(i[10]||0));var a=n.getTime();return isNaN(a)?void 0:a}if(o){a=(n=new Date(e)).getTime();return isNaN(a)?void 0:a}return b.util.parseLocaleDateTime(e)}}function Ti(e){if(null!=e){e=e.trim();var t=vi.test(e),i=yi.exec(e),o=bi.test(e);if(t)return parseInt(e);if(i){var n=new Date(0);if(i[11])n.setUTCFullYear(Number(i[1]||0)),n.setUTCMonth(Number(i[2]||0)-1),n.setUTCDate(Number(i[3]||0)),n.setUTCHours(Number(i[5]||0)),n.setUTCMinutes(Number(i[6]||0)),n.setUTCSeconds(Number(i[8]||0)),n.setUTCMilliseconds(Number(i[10]||0));else(n=new Date(0)).setFullYear(Number(i[1]||0)),n.setMonth(Number(i[2]||0)-1),n.setDate(Number(i[3]||0)),n.setHours(Number(i[5]||0)),n.setMinutes(Number(i[6]||0)),n.setSeconds(Number(i[8]||0)),n.setMilliseconds(Number(i[10]||0));var a=n.getTime();return isNaN(a)?void 0:a}if(o){a=(n=new Date(e)).getTime();return isNaN(a)?void 0:a}return b.util.parseLocaleDateTime(e)}}function Ci(e){if(null!=e&&""!==e){var t=hi.importCSVDateFormatDefault;return"auto"===t?yi.test(e)||bi.test(e)||b.util.isLocaleDate(e):b.util.moment(e,t,!0).isValid()}}function ki(e){var t=hi.importCSVDateFormatDefault;if("auto"!==t){var i=b.util.moment(e,t);if(i.isValid())return i.valueOf()}else{var o=xi(e);if(void 0!==o){var n=new Date(o);return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),n.getTime()}}}function $i(e){var t=hi.importCSVDateFormatDefault;if("auto"!==t){var i=b.util.moment(e,t);if(i.isValid())return Date.UTC(i.year(),i.month(),i.date())}else{var o=Ti(e);if(void 0!==o){var n=new Date(o);return Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())}}}function Si(e,t){switch(t.base){case"number":return mi(e,hi.importCSVNumberFormatDefault);case"boolean":return fi(e);case"date":return ki(e);case"datx":return $i(e);case"timestamp":return xi(e);default:return t.parse(e)}}function _i(e,t){return String(e).toLowerCase()==String(t).toLowerCase()}o("./src/react/LocalizationColumnSelector.css");var Ei=o("./src/react/util/PositionedBackplane.tsx");class Di extends s.Component{constructor(...e){super(...e),Je()(this,"locales",["en","de","ca","es","fr","it","pl","pt","ru","chs","cht"]),Je()(this,"options",[])}render(){return this.options=this.props.localizedOptions,s.createElement(Ei.a,{show:null!==this.props.target,onClick:()=>this.props.submitChanges(this.options),clickTarget:this.props.target,settings:{style:"tooltip",arrowColor:"white"}},s.createElement("div",{className:"LocalizationColumnSelector_Container"},s.createElement("div",null,this.locales.map((e,t)=>s.createElement("div",{key:t,className:"LocalizationColumnSelector_Item"},s.createElement(ot,{defaultValue:-1!==this.options.indexOf(e),options:{type:"CHECKBOX",label:e},onChange:t=>{t?this.options.push(e):this.options.splice(this.options.indexOf(e),1)}}))))))}}o("./src/react/LocalizationTable.css");class Ni extends s.Component{shouldComponentUpdate(e,t,i){return this.props.isSelected!==e.isSelected||this.props.caption!==e.caption}render(){return this.props.isSelected?s.createElement("input",{className:"Localization_cell",type:"text",onKeyDown:this.props.handleKeyDown,defaultValue:void 0===this.props.caption?"":this.props.caption,onChange:this.props.handleCellUpdate,autoFocus:!0,onBlur:()=>this.props.blurOrSubmitCell(null)}):void 0!==this.props.caption?s.createElement(Ze.a,{className:"Localization_cell",onFastClick:this.props.onClick,title:this.props.caption},s.createElement("span",{className:"Localization_cell_text"},this.props.caption)):s.createElement(Ze.a,{className:"Localization_cell",onFastClick:this.props.onClick})}}var Ii=o("./src/react/util/commons.ts");function Oi(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Mi(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Oi(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Oi(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class Fi extends s.Component{constructor(e){super(e),Je()(this,"numberOfRows",void 0),Je()(this,"handleCellUpdate",e=>{const t=e.target.value;this.setState(e=>(Object(Ii.a)(e.selectedElement),{selectedElement:Mi({},e.selectedElement,{val:t})}))}),Je()(this,"handleLocalizationCellClick",(e,t,i)=>{this.setState({selectedElement:{col:t,row:i,val:this.props.locales[i].captions[t]}})}),Je()(this,"handleKeyDown",e=>{switch(e.key){case"Escape":this.setState({selectedElement:null});break;case"Enter":this.blurOrSubmitCell(null);break;case"Tab":e.preventDefault(),Object(Ii.a)(this.state.selectedElement);let t=this.props.selectedLanguages.indexOf(this.state.selectedElement.col),i=this.state.selectedElement.row;e.shiftKey?(t=(t-1+this.props.selectedLanguages.length)%this.props.selectedLanguages.length,t===this.props.selectedLanguages.length-1&&(i=(i+this.numberOfRows-1)%this.numberOfRows)):(t=(t+1)%this.props.selectedLanguages.length,0===t&&(i=(i+1)%this.numberOfRows));const o={col:this.props.selectedLanguages[t],row:i,val:this.props.locales[i].captions[this.props.selectedLanguages[t]]};this.blurOrSubmitCell(o);break;case"ArrowUp":e.preventDefault(),Object(Ii.a)(this.state.selectedElement);const n=(this.state.selectedElement.row+this.numberOfRows-1)%this.numberOfRows,a={col:this.state.selectedElement.col,row:n,val:this.props.locales[n].captions[this.state.selectedElement.col]};this.blurOrSubmitCell(a);break;case"ArrowDown":e.preventDefault(),Object(Ii.a)(this.state.selectedElement);const s=(this.state.selectedElement.row+1)%this.numberOfRows,r={col:this.state.selectedElement.col,row:s,val:this.props.locales[s].captions[this.state.selectedElement.col]};this.blurOrSubmitCell(r)}}),Je()(this,"checkForChangesAndSubmit",()=>{Object(Ii.a)(this.state.selectedElement),this.props.locales[this.state.selectedElement.row].captions[this.state.selectedElement.col]!==this.state.selectedElement.val&&this.props.onCellChange(this.state.selectedElement.row,this.state.selectedElement.col,this.state.selectedElement.val)}),Je()(this,"blurOrSubmitCell",e=>{this.checkForChangesAndSubmit(),this.setState({selectedElement:e})}),Je()(this,"handleHeaderClick",e=>{this.setState({editLocale:{target:Ze.b.getTarget(e),options:this.props.selectedLanguages}})}),Je()(this,"submitHeaderEdits",e=>{Object(l.f)(Fi.trackingCategory,"Edit Locales",{locales:e}),this.props.onHeaderUpdate(e),this.setState({editLocale:null})}),this.numberOfRows=this.props.locales.length,this.state={selectedElement:null,editLocale:null}}render(){return s.createElement("div",{className:"Localization_root"},s.createElement("div",{className:"Localization-header-column"},s.createElement("div",{className:"Localization_corner_cell"},Object(b.getLocale)().LocalizationModuleColumnHeader),s.createElement("div",{className:"Localization_column_header_container"},this.renderLocalizationColumnHeaders())),s.createElement("div",{className:"Localization_content"},this.renderTableContent()),s.createElement(Di,{localizedOptions:this.props.selectedLanguages,target:null===this.state.editLocale?null:this.state.editLocale.target,submitChanges:this.submitHeaderEdits}))}renderTableContent(){return this.props.locales.map((e,t)=>s.createElement("div",{key:t,className:"Localization_row_container"},s.createElement("div",{title:e.module,className:"Localization_module"},e.module),s.createElement("div",{className:"Localization_row"},s.createElement("div",{title:e.caption,className:"Localization_cell Localization_default"},e.caption),this.renderLocalizedValuesAndEmptyCells(e.captions,t))))}renderLocalizedValuesAndEmptyCells(e,t){return this.props.selectedLanguages.map((i,o)=>s.createElement(Ni,{caption:e[i],key:o,isSelected:null!==this.state.selectedElement&&this.state.selectedElement.col===i&&this.state.selectedElement.row===t,handleKeyDown:this.handleKeyDown,blurOrSubmitCell:this.blurOrSubmitCell,onClick:e=>this.handleLocalizationCellClick(e,i,t),handleCellUpdate:this.handleCellUpdate}))}renderLocalizationColumnHeaders(){const e=[];e.push(s.createElement("div",{key:Object(b.getLocale)().LocalizationDefaultColumnHeader,className:"Localization_column_header"},Object(b.getLocale)().LocalizationDefaultColumnHeader));for(const t of this.props.selectedLanguages)e.push(s.createElement("div",{key:t,className:"Localization_column_header"},t));return this.props.locales.length>0&&e.push(s.createElement(Ze.a,{key:Object(b.getLocale)().LocalizationAddLocaleColumnHeader,className:"Localization_column_header",onFastClick:e=>this.handleHeaderClick(e)},Object(b.getLocale)().LocalizationAddLocaleColumnHeader)),e}}let Ri;Je()(Fi,"trackingCategory","Localized Captions"),Ri||(Ri={});class Li{constructor(e,t,i){Je()(this,"base","localization"),Je()(this,"container",void 0),Je()(this,"visible",void 0),Je()(this,"el",void 0),Je()(this,"database",void 0),Je()(this,"localizedFieldOptions",void 0),Je()(this,"locales",[]),Je()(this,"handleCellChange",(e,t,i)=>{const o=b.util.clone(this.locales);o[e].captions[t]=i,this.saveData(o)}),Je()(this,"updateColumnHeadings",e=>{this.localizedFieldOptions=e,this.createEmptyValuesForSelectedColumns(e),this.removeValuesInLocaleColumn(e)}),Je()(this,"createEmptyValuesForSelectedColumns",e=>{const t=b.util.clone(this.locales),i=t[0];for(const t of e)i.captions.hasOwnProperty(t)||(i.captions[t]="");this.saveData(t)}),Je()(this,"removeValuesInLocaleColumn",e=>{const t=b.util.clone(this.locales);for(const i of t)for(const t in i.captions)i.captions.hasOwnProperty(t)&&-1===e.indexOf(t)&&delete i.captions[t];this.saveData(t)}),Je()(this,"setLocalizedHeaders",e=>{const t=[];e.forEach(e=>{Object.keys(e.captions).forEach(e=>{-1===t.indexOf(e)&&t.push(e)})}),this.localizedFieldOptions=t}),Je()(this,"saveData",e=>{const t=this.database.schema,i=t.types;let o,n,a,s,r=!1;for(const t of e)switch(t.base){case"type.caption":if(o=i[t.tid],!o)continue;o.caption!==t.caption&&(o.caption=t.caption,r=!0),b.util.equals(o.captions,t.captions)||(o.captions=b.util.clone(t.captions),r=!0);break;case"field.caption":if(o=i[t.tid],!o)continue;if(n=o.fields[t.fid],!n)continue;n.caption!==t.caption&&(n.caption=t.caption,r=!0),b.util.equals(n.captions,t.captions)||(n.captions=b.util.clone(t.captions),r=!0);break;case"field.tooltip":if(o=i[t.tid],!o)continue;if(n=o.fields[t.fid],!n)continue;n.tooltip!==t.caption&&(n.tooltip=t.caption,r=!0),b.util.equals(n.tooltips,t.captions)||(n.tooltips=b.util.clone(t.captions),r=!0);break;case"field.value.caption":if(o=i[t.tid],!o)continue;if(n=o.fields[t.fid],!n)continue;if(a=n.values[t.vid],!a)continue;a.caption!==t.caption&&(a.caption=t.caption,r=!0),b.util.equals(a.captions,t.captions)||(a.captions=b.util.clone(t.captions),r=!0);break;case"ui.caption":if(o=i[t.tid],!o)continue;if(s=o.uis[t.uid],!s)continue;s.caption!==t.caption&&(s.caption=t.caption,r=!0),b.util.equals(s.captions,t.captions)||(s.captions=b.util.clone(t.captions),r=!0);break;default:Object(Ke.assertNever)(t)}r&&t.trigger("change")}),this.container=e,this.visible=!1,this.el=window.$('<div class="admin-options">'),this.database=i,this.localizedFieldOptions=null,i.on("schema",void 0,this.updateUI,this)}getNavigationState(){return{base:"localization"}}destroy(){this.el.remove()}show(){this.visible||(this.visible=!0,this.el.appendTo(this.container.el),this.updateUI())}hide(){this.visible&&(this.visible=!1,this.el.detach())}updateUI(){if(this.locales=this.getLocalizedCaptionData(),this.setLocalizedHeaders(this.locales),null===this.localizedFieldOptions)throw new Error("impossible");n.render(s.createElement(Fi,{locales:this.locales,selectedLanguages:this.localizedFieldOptions,onCellChange:this.handleCellChange,onHeaderUpdate:this.updateColumnHeadings}),this.el[0])}getLocalizedCaptionData(){const e=[],t=this.database.schema.types;for(const i in t)if(t.hasOwnProperty(i)){const o=t[i];e.push({base:"type.caption",tid:i,module:[o.caption].join(" / "),caption:o.caption,captions:b.util.clone(o.captions)||{}});const n=o.fields;for(const t in n)if(n.hasOwnProperty(t)){const a=n[t];if(e.push({base:"field.caption",tid:i,fid:t,module:[o.caption,a.caption].join(" / "),caption:a.caption,captions:b.util.clone(a.captions)||{}}),e.push({base:"field.tooltip",tid:i,fid:t,module:[o.caption,a.caption,"Tooltip"].join(" / "),caption:a.tooltip,captions:b.util.clone(a.tooltips)||{}}),"choice"===a.base||"multi"===a.base){const n=a.values;for(const s in n)if(n.hasOwnProperty(s)){const r=n[s];e.push({base:"field.value.caption",tid:i,fid:t,vid:s,module:[o.caption,a.caption,"Value"].join(" / "),caption:r.caption,captions:b.util.clone(r.captions)||{}})}}}const a=o.uis;for(const t in a)if(a.hasOwnProperty(t)){const n=a[t];e.push({base:"ui.caption",tid:i,uid:t,module:[o.caption,n.caption,"UI"].join(" / "),caption:n.caption,captions:b.util.clone(n.captions)||{}})}}return e}}function ji(e){var t=e.$container,i=$("<div>").appendTo(t),o=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.background,width:4,required:!0,choiceRenderer:"switch",values:{solid:{caption:locale.solid,order:1},gradient:{caption:locale.gradient,order:2},image:{caption:locale.image,order:3},default:{caption:locale.defaultValue,order:0}}}),e.settings.bgType||("background-file"===e.settings.backgroundClass?"image":"default"));o.on("update",(function(){"image"===o.value?e.updateSettings({bgType:"image",backgroundClass:"background-file"},(function(){})):"default"===o.value?e.updateSettings({bgType:null,backgroundClass:""},(function(){})):e.updateSettings({bgType:o.value},(function(){})),g()})),new qt.a(void 0,o,i);var n=$("<div>").appendTo(i),a=$("<div>").appendTo(i),s=$("<div>").appendTo(i),r=$('<div style="padding:8px 0">').appendTo(s),l=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.backgroundColor,required:!0}),e.settings.bgColor||"#ccc");l.on("update",(function(){e.updateSettings({bgColor:l.value},(function(){}))})),new qt.a(void 0,l,r),$('<div class="nx-button-text blue" style="width:auto;display:inline-block;margin:8px 0">').text(locale.uploadBackgroundFile).appendTo(r).on("click",(function(t){$.chooseFile(t,(function(t,i){e.setBackgroundFile(i,(function(e){if(e)return $.alert(e)}))}))}));var c=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.horizontalPosition,width:2,required:!0,choiceRenderer:"switch",values:{left:{caption:locale.left,order:1},center:{caption:locale.center,order:2},right:{caption:locale.right,order:3}}}),e.settings.bgPosH||"center");c.on("update",(function(){e.updateSettings({bgPosH:c.value},(function(){}))}));var d=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.verticalPosition,width:2,required:!0,choiceRenderer:"switch",values:{top:{caption:locale.top,order:1},center:{caption:locale.center,order:2},bottom:{caption:locale.bottom,order:3}}}),e.settings.bgPosV||"center");d.on("update",(function(){e.updateSettings({bgPosV:d.value},(function(){}))}));var h=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.size,width:3,required:!0,choiceRenderer:"switch",values:{auto:{caption:locale.original,order:1},cover:{caption:locale.cover,order:2},contain:{caption:locale.contain,order:3},"100% 100%":{caption:locale.stretch,order:4}}}),e.settings.bgSize||"cover");h.on("update",(function(){e.updateSettings({bgSize:h.value},(function(){}))}));var p=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.repeat,width:1,required:!0,choiceRenderer:"switch",values:{"no-repeat":{caption:locale.no,order:2},repeat:{caption:locale.yes,order:1}}}),e.settings.bgRepeat||"no-repeat");p.on("update",(function(){e.updateSettings({bgRepeat:p.value},(function(){}))})),new qt.a(void 0,d,s),new qt.a(void 0,c,s),$("<br>").appendTo(s),new qt.a(void 0,h,s),new qt.a(void 0,p,s);var u=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.startColor,required:!0}),e.settings.bgGradient0||"#ccc");u.on("update",(function(){e.updateSettings({bgGradient0:u.value},(function(){}))}));var f=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.endColor,required:!0}),e.settings.bgGradient1||"#aaa");f.on("update",(function(){e.updateSettings({bgGradient1:f.value},(function(){}))})),new qt.a(void 0,u,a),new qt.a(void 0,f,a);var m=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.color,required:!0}),e.settings.bgColor||"#ccc");function g(){n.css("display","solid"===o.value?"":"none"),a.css("display","gradient"===o.value?"":"none"),s.css("display","image"===o.value?"":"none")}m.on("update",(function(){e.updateSettings({bgColor:m.value},(function(){}))})),new qt.a(void 0,m,n),g()}var Ai=o("./src/js/admin/FunctionEditor.js");function Pi(e){this.button=$('<div class="hud-menu-button i-32-24 i-grey i-setting-tool">').attr("title",locale.admin).appendTo(e||ui.$menuRight).touch($.proxy(this.toggle,this)),this.update(),database.on("admin",void 0,this.update,this),Object(Ai.b)()}function Ui(e,t){this.container=e,this.visible=!1,this.el=$('<div class="admin-options">'),this.$globalCode=void 0,this.globalCodeField=void 0,this.afterOpenField=void 0}Pi.prototype.destroy=function(){database.off("admin",void 0,this.update,this),this.button.remove()},Pi.prototype.toggle=function(e){Object(l.f)("Admin",database.adminMode?"Activate":"Deactivate"),database.schema.isProtected?database.adminMode?(database.schemaUnlocked=!1,database.schemaPassword=void 0,database.setAdminMode(!1)):Pi.popupProtectionPassword({mode:"unlock",okay:function(e){return database.schema.protectCheckPassword(e)?(database.schemaUnlocked=!0,database.schemaPassword=e,database.setAdminMode(!0),!0):($.alert(locale.wrongPassword),!1)}}):database.setAdminMode(!database.adminMode)},Pi.popupProtectionPassword=function(e){var t,i=$.popdown({cls:"small",head:"protect"===e.mode?locale.protectDatabase:"unprotect"===e.mode?locale.unprotectDatabase:"unlock"===e.mode?locale.unlockDatabase:"Unknown",buttons:["cancel","-",{cls:"blue",caption:locale.okay,click:n}]}),o=($('<div class="component editor editor-string" style="width:100%">').appendTo(i.$pane),$.input({$container:i.$content,type:"password",caption:locale.password}));function n(){var n=o.val();n&&("protect"!==e.mode||n===t.val()?e.okay(n)&&i.close():$.alert(locale.passwordMismatch))}"protect"===e.mode&&(t=$.input({$container:i.$content,type:"password",caption:locale.repeatPassword}))},Pi.prototype.update=function(){database.adminMode?this.button[0].className="hud-menu-button red i-32-24 i-white i-setting-tool selected --ul-admin-button-active":this.button[0].className="hud-menu-button i-32-24 i-white i-setting-tool --ul-admin-button"},Pi.prototype.mightyMode=function(){var e=$('<div class="nx-backplane nx-backplane-opaq">').appendTo($(document.body)),t=$('<textarea autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="border:none;background-color:#fff;font-family:monospace;font-size:12px;position:absolute;top:64px;left:16px;right:16px;bottom:16px">').val(database.customInitSRC||"").appendTo(e),i=$('<div class="nx-button-bar" style="position:absolute;left:8px;top:8px;right:8px">').appendTo(e);$('<div class="nx-hspace-flex">').appendTo(i);$('<div class="nx-button-text red">').text("Save and Reload").appendTo(i).touch(o);$('<div class="nx-hspace-small">').appendTo(i);$('<div class="nx-button-text grey">').text("Cancel").appendTo(i).touch(n);function o(){var e=t.val();try{new Function(e);database.saveCustom(e,(function(e){if(e)return $.alert(e);window.location.reload()}))}catch(e){$.alert(e)}}function n(){e.remove()}},Ui.prototype.base="options",Ui.prototype.getNavigationState=function(){return{base:"options"}},Ui.prototype.destroy=function(){this.el.remove()},Ui.prototype.show=function(){Object(l.f)("Options","Open"),this.visible||(this.visible=!0,this.createUI(),this.el.appendTo(this.container.el),database.on("schema",void 0,this.schemaChanged,this))},Ui.prototype.hide=function(){this.visible&&(this.visible=!1,this.el.detach(),this.destroyUI(),database.off("schema",void 0,this.schemaChanged,this))},Ui.prototype.setBackground=function(e){database.setBackground(e,(function(e){e&&$.alert(e)}))},Ui.prototype.getNavigationState=function(){return{base:"options"}},Ui.prototype.schemaChanged=function(){this.createFields()},Ui.prototype.destroyUI=function(){this.destroyFields(),this.el.empty(),this.$globalCode=void 0},Ui.prototype.createUI=function(){var e=this;new ji({$container:$('<div class="admin-options-pane">').appendTo(this.el),settings:database.settings,updateSettings:function(e,t){database.updateSettings(e,t),ui.updateBackground(!0)},setBackground:function(e,t){database.setBackground(e,t)},setBackgroundFile:function(e,t){database.setBackgroundFile(e,t)}});var t=$('<div class="admin-options-pane">').appendTo(this.el);$('<div style="text-align:center">').text(locale.printTableSettings).appendTo(t);var i=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.printFontSize,width:2,required:!0,values:{6:{caption:"6 pt",order:1},7:{caption:"7 pt",order:2},8:{caption:"8 pt",order:3},9:{caption:"9 pt",order:4},10:{caption:"10 pt",order:5},11:{caption:"11 pt",order:6},12:{caption:"12 pt",order:7},13:{caption:"13 pt",order:8},14:{caption:"14 pt",order:9}}}),database.settings.printTableFontSize||"8");i.on("update",n);new qt.a(void 0,i,t);var o=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.printRendering,width:2,required:!0,values:{PDF:{caption:"PDF",order:1},HTML:{caption:"HTML",order:2}}}),database.settings.printTableRendering||"PDF");o.on("update",n);new qt.a(void 0,o,t);function n(){window.reports,database.updateSettings({printTableFontSize:i.value,printTableRendering:o.value})}if(this.$globalCode=$('<div class="admin-options-pane">').appendTo(this.el),$('<div class="buttons">').appendTo(this.el).button(void 0,database.schema.isProtected?locale.unprotectDatabase:locale.protectDatabase,"grey",(function(){Pi.popupProtectionPassword({mode:database.schema.isProtected?"unprotect":"protect",okay:function(t){return database.schema.isProtected?database.schema.unprotect(t)?(e.destroyUI(),e.createUI(),$.loading(!0),database.saveSchema((function(e){$.loading(!1),e&&$.alert(e)})),!0):($.alert(locale.wrongPassword),!1):(database.schema.protect(t),database.schemaUnlocked=!0,database.schemaPassword=t,database.setAdminMode(!1),$.loading(!0),database.saveSchema((function(e){$.loading(!1),database.schemaUnlocked=!1,database.schemaPassword=void 0,e&&$.alert(e)})),!0)}})})),database.supports.history||database.supports.reindex){var a=$('<div class="buttons">').appendTo(this.el);database.supports.history&&a.button(void 0,locale.clearHistory,"grey",(function(){$.dialog({closable:!0,caption:locale.clearHistory,message:locale.confirmClearHistory,buttons:[{color:"red",caption:locale.clearHistory,callback:function(){database.clearHistory((function(e){e&&$.alert(e)}))}}]})})),database.supports.reindex&&a.button(void 0,locale.reindex,"grey",(function(){$.dialog({closable:!0,caption:locale.reindex,message:locale.confirmReindex,buttons:[{color:"red",caption:locale.reindex,callback:function(){database.reindex((function(e){e&&$.alert(e)}))}}]})})),database.supports.rebuildThumbs&&a.button(void 0,locale.rebuildThumbnails,"grey",(function(){$.dialog({closable:!0,caption:locale.rebuildThumbnails,message:locale.rebuildThumbnailsConfirm,buttons:[{color:"red",caption:locale.rebuildThumbnails,callback:function(){database.rebuildThumbs((function(e){e&&$.alert(e)}))}}]})})),database.supports.reIndexFiles&&a.button(void 0,locale.reIndexFiles,"grey",(function(){$.dialog({closable:!0,caption:locale.reIndexFiles,message:locale.reIndexFilesConfirm,buttons:[{color:"red",caption:locale.reIndexFiles,callback:function(){database.reIndexFiles(e=>{e&&$.alert(e)})}}]})}))}this.createFields()},Ui.prototype.destroyFields=function(){this.globalCodeField&&this.globalCodeField.destroy(),this.afterOpenField&&this.afterOpenField.destroy()},Ui.prototype.createFields=function(){this.destroyFields(),this.globalCodeField=new qt.a(void 0,database.schema.getGlobalCodeModel(),this.$globalCode),this.afterOpenField=new qt.a(void 0,database.schema.getAfterOpenModel(),this.$globalCode)};let Hi=1,zi=1;function Vi(){this.nodes=[],this.edges=[],this.incDistances=null,this.outDistances=null,this.symDistances=null}function Wi(e,t,i,o){this.graph=e,this.id=t,this.label=i||t,this.data=o||{},this.out=[],this.inc=[],this.rad=1,this.mass=1,this.color=0}function Bi(e,t,i,o,n,a){this.graph=e,this.id=t,this.source=i,this.target=o,this.label=n||t,this.data=a||{}}function qi(e,t){var i=e.indexOf(t);if(-1===i)throw new Error("Not a member");e.splice(i,1)}Vi.prototype.pathDirect=function(){this.calcDistances();for(var e=this.nodes,t=this.incDistances,i=this.partitions(),o=0;o<i.length;o++)i[o];var n=[],a=0;for(var s in t)if(t.hasOwnProperty(s)){var r=t[s];if(r>=a){var l=s.split("-"),c=parseInt(l[0]),d=parseInt(l[1]);e[c],e[d];r===a?n.push([c,d]):n=[[c,d]]}}if(0!==n.length){n.sort((function(t,i){var o=e[t[0]],n=e[i[0]];return o.inc.length+o.out.length-(n.inc.length+n.out.length)}));n[0]}},Vi.prototype.powerDirectInit=function(e,t){this.powerW=e,this.powerH=t;for(var i=this.nodes,o=0;o<i.length;o++){var n=i[o];n.x=Math.sin(2*Math.PI*o/i.length)*i.length,n.y=Math.cos(2*Math.PI*o/i.length)*i.length}},Vi.prototype.powerDirectStep=function(e){for(var t=0,i=this.nodes,o=this.edges,n=0;n<i.length;n++){(b=i[n]).fx=0,b.fy=0}for(n=0;n<o.length;n++){var a,s=o[n],r=s.source,l=s.target,c=(v=r.x-l.x)*v+(y=r.y-l.y)*y,d=v/(u=Math.sqrt(c)),h=y/u;a=u<1?0:u>1?-4*(1-1/c):0,r.fx+=a*d,r.fy+=a*h,l.fx-=a*d,l.fy-=a*h}for(n=0;n<i.length;n++){r=i[n];for(var p=n+1;p<i.length;p++){l=i[p],c=(v=r.x-l.x)*v+(y=r.y-l.y)*y,d=v/(u=Math.sqrt(c)),h=y/u;var u,f=r.rad+l.rad;u<f&&(a=16*Math.sqrt(f*f-c)/f,r.fx+=a*d,r.fy+=a*h,l.fx-=a*d,l.fy-=a*h)}}var m=this.powerW,g=this.powerH;for(n=0;n<i.length;n++){var v=(b=i[n]).x/m,y=b.y/g;b.fx-=b.mass*v,b.fy-=b.mass*y}for(n=0;n<i.length;n++){var b;(b=i[n]).x+=b.fx*e,b.y+=b.fy*e,t+=Math.sqrt(b.fx*b.fx+b.fy*b.fy)}return t},Vi.prototype.sub=function(e,t){e||(e=this.nodes),t||(t=this.edges);for(var i={},o={},n=0;n<e.length;n++)o[e[n].id]=!0;for(n=0;n<t.length;n++)i[t[n].id]=!0;var a=new Vi;for(n=0;n<e.length;n++){var s=e[n];a.nodes.push(new Wi(a,s.id,s.label,s.data));for(var r=0;r<s.out.length;r++){i[s.out[r].id]}}},Vi.prototype.node=function(e,t){var i=new Wi(this,Hi++,e,t);return this.nodes.push(i),i},Vi.prototype.edge=function(e,t,i,o){var n=new Bi(this,zi++,e,t,i,o);return e.out.push(n),t.inc.push(n),this.edges.push(n),n},Vi.prototype.removeNode=function(e){for(var t=0;t<e.inc.length;t++)this.removeEdge(e.inc[t]);for(t=0;t<e.out.length;t++)this.removeEdge(e.out[t]);qi(this.nodes,e)},Vi.prototype.removeEdge=function(e){qi(e.source.out,e),qi(e.target.inc,e),qi(this.edges,e)},Vi.prototype.calcDistances=function(){for(var e=this.nodes,t={},i=0;i<e.length;i++)for(var o=(c=e[i]).inc,n=1,a={};o.length>0;){for(var s=[],r=0;r<o.length;r++){a[(d=o[r].source).id]||(a[d.id]=!0,t[c.id+"-"+d.id]=n,s=s.concat(d.inc))}n++,o=s}var l={};for(i=0;i<e.length;i++){var c;for(o=(c=e[i]).out,n=1,a={};o.length>0;){for(s=[],r=0;r<o.length;r++){var d;a[(d=o[r].target).id]||(a[d.id]=!0,l[c.id+"-"+d.id]=n,s=s.concat(d.out))}n++,o=s}}var h={};for(var p in t)t.hasOwnProperty(p)&&(h[p]=t[p]);for(var p in l)l.hasOwnProperty(p)&&(void 0===h[p]||h[p]>l[p])&&(h[p]=l[p]);this.incDistances=t,this.outDistances=l,this.symDistances=h},Vi.prototype.partitions=function(e,t){if("function"!=typeof e){this.symDistances||this.calcDistances();var i="inc"===e?this.incDistances:"out"===e?this.outDistances:this.symDistances;e=function(e,t){return void 0!==i[e.id+"-"+t.id]}}t||(t=this.nodes);for(var o=[],n=0;n<t.length;n++)o.push([t[n]]);for(;function(){for(var t=0;t<o.length;t++)for(var i=o[t],n=t+1;n<o.length;n++)for(var a=o[n],s=0;s<i.length;s++)for(var r=i[s],l=0;l<a.length;l++){var c=a[l];if(e(r,c))return o[t]=i.concat(a),o.splice(n,1),!0}return!1}(););return o},Wi.prototype.toString=function(){return"("+this.label+")"},Wi.prototype.remove=function(){this.graph.removeNode(this)},Bi.prototype.toString=function(){return this.source.toString()+" - "+this.label+" - "+this.target.toString()},Bi.prototype.remove=function(){this.graph.removeEdge(this)};class Yi extends s.Component{constructor(e){super(e)}render(){return s.createElement("div",{className:"nx-switch-big"},this.props.tabs.map((e,t)=>s.createElement(Ze.a,{key:t,onFastClick:e.onClick,className:"nx-switch-big-item "+(e.isSelected?"selected":null)},e.text)))}}var Xi=o("./src/js/admin/AdminField.js");function Gi(e){var t=e.type,i=$('<div class="nx-backplane nx-backplane-dark">');let o;o=window.getWidth()<640?"100%":"600px";var n=$('<div class="nx-menu-popup grey" style="width:'+o+';padding:0">').appendTo(i);$('<div class="nx-section-head">').text("Duplicate Table: "+t.caption).appendTo(n);var a=$('<div class="nx-section-pane">').appendTo(n);$('<div style="padding:0 8px">').text("Select fields to copy:").appendTo(a);for(var s=$('<div style="max-height:400px;overflow:auto;padding:8px;background-color:#fff;border:solid 1px #ddd;margin:8px">').appendTo(a),r=[],l=t.sorted,c=0;c<l.length;c++){var d=l[c],h=$('<div style="display:flex;display:-webkit-flex">').appendTo(s),p=$('<input type="checkbox" style="margin:10px 4px 0 0">').appendTo(h);d.isReverse||p.attr("checked","checked"),$('<div style="flex:1 1 auto;-webkit-flex:1 1 auto;display:flex;display:-webkit-flex">').append($('<div class="type-symbol i-32-24 i-grey i-field-'+d.base+'">')).append($('<div style="line-height:32px;white-space:nowrap;overflow:hidden">').text(d.caption)).appendTo(h),r.push({field:d,$duplicate:p})}var u=$('<div class="nx-button-bar">').appendTo(a);function f(){var i=Ji(t,r);m(),e.okay&&e.okay(i)}function m(){i.animFadeOut((function(){i.remove(),e.close&&e.close()}))}$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(u).touch(m),$('<div class="nx-hspace-flex">').appendTo(u),$('<div class="nx-button-text blue">').text(locale.duplicateTable).appendTo(u).touch(f),i.appendTo($(document.body)).animFadeIn(),n.center()}function Ji(e,t){for(var i=e.schema,o=i.createType(Qi(e)),n=0;n<t.length;n++){var a=t[n],s=a.field;if(a.$duplicate.is(":checked"))if(s.isField)(r=s.toJSON()).uuid=void 0,i.createField2(o,r);else if(s.isReference)i.createReference(o,s.caption,s.refType,Zi(s.refType,s.reverse.caption),s.cascade,void 0,void 0,void 0,void 0,s.order,void 0,!1);else if(s.isReverse)i.createReference(s.refType,Zi(s.refType,s.reference.caption),o,s.caption,s.reference.cascade,void 0,void 0,void 0,void 0,void 0,s.order,!1);else if(s.isUI){var r;(r=s.toJSON()).uuid=void 0,i.createUI2(o,r)}}return o}var Ki=/([0-9]+)$/;function Qi(e){var t=e.schema,i=e.caption||locale.table,o=2,n=Ki.exec(i);for(n&&(o=parseInt(n[1]),i=i.substr(0,n.index));t.findType(i+""+o);)o++;return i+""+o}function Zi(e,t){var i=t||locale.field,o=2,n=Ki.exec(i);for(n&&(o=parseInt(n[1]),i=i.substr(0,n.index));e.findElement(i+""+o);)o++;return i+""+o}function eo(e){var t,i=void 0,o="EDIT_FIELDS",a=e.schema||database.schema.clone(),r=e.schemaDirty||!1,c=e.isNewType||!1,d=e.type;if(d){if(!(t=a.types[d]))return}else t=a.createType(),r=!0,c=!0;a.on("change",de);var h=$.backplane({closable:!1,enter:function(e){r||(e.preventDefault(),fe())},escape:function(e){r||(e.preventDefault(),fe())}}),p=$('<div class="typeeditor">').appendTo(h),u=$("<div>").appendTo(p),f=$('<div class="typeeditor-bottom">').appendTo(p),m=$('<div class="typeeditor-left">').appendTo(p),g=$('<div class="--ul-typeeditor-center-right-container" style="pointer-events: none;position: absolute;">').appendTo(p),v=$('<div class="typeeditor-center accordion">').appendTo(p),y=$('<div class="typeeditor-right accordion">').appendTo(p);if(!c){var b=$('<div class="nx-button-text red">').appendTo(f).touch(pe);window.getWidth()<640?b.append('<div class="i-32-24 i-red i-setting-trash"/>'):b.text(locale.removeTable),$('<div class="nx-hspace-small">').appendTo(f),$('<div class="nx-button-text grey">').text(locale.duplicateTable+"...").appendTo(f).touch(he)}$('<div class="nx-hspace-flex">').appendTo(f);var w=$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(f).touch(fe),x=$('<div class="nx-button-text blue --ul-type-editor-save-button" style="margin-left:8px">').text(locale.okay).appendTo(f).touch(ue);r?window.getWidth()<640?(x.text(""),x.append('<div class="i-32-24 i-white i-save"/>')):x.text(locale.saveDataModelChanges):w.hide();var T,C,S,_,E,D,N=$("<div>"),I=new qt.a(this,t.getIconModel(),N,{cls:"--ul-table-icon-button table-icon-button",formWidth:.17}),O=new qt.a(this,t.getCaptionModel(),N,{cls:"--ul-table-name-input",formWidth:.83}),M=$("<div>").appendTo(m),F=new qt.a(this,t.getHiddenModel(),m,{cls:"typeeditor-boolean"}),R=new qt.a(this,t.getGlobalSearchModel(),m,{cls:"typeeditor-boolean"}),L=new qt.a(this,t.getHasFilesModel(),m,{cls:"typeeditor-boolean"}),j=database.supports.comments?new qt.a(this,t.getHasCommentsModel(),m,{cls:"typeeditor-boolean"}):void 0,A=database.supports.history?new qt.a(this,t.getHasHistoryModel(),m,{cls:"typeeditor-boolean"}):void 0,P=new qt.a(this,t.getAfterCreateModel(),m),U=new qt.a(this,t.getAfterUpdateModel(),m);database.supports.authentication&&(T=new qt.a(this,t.getReadRolesModel(),m),C=new qt.a(this,t.getWriteRolesModel(),m)),E=new qt.a(this,t.getCanReadModel(),m),D=new qt.a(this,t.getCanWriteModel(),m),database.supports.authentication&&(S=new qt.a(this,t.getCreateRolesModel(),m),_=new qt.a(this,t.getDeleteRolesModel(),m));$('<div class="accordion-head">').text(locale.fields).appendTo(v);var H=$('<div class="accordion-pane --ul-type-editor-center">').appendTo(v).css({overflow:"auto"}),z=!1,V=!1,W=-1;H.sortable({start:function(){V=!0},stop:function(e){V=!1},beforeStop:function(){},receive:oe,sort:te,update:ie,handle:TOUCH?".t-columneditor-icon, .t-columneditor-label":void 0});var B=$('<div class="accordion-head">').text(locale.createField).appendTo(y),q=$('<div class="accordion-pane">').appendTo(y).css({overflow:"auto"}),Y=$('<div class="accordion-head">').text(locale.createUI).appendTo(y),X=$('<div class="accordion-pane">').appendTo(y).css({overflow:"auto"}).hide(),G=$('<div class="accordion-head">').text(locale.createReference).appendTo(y),J=$('<div class="accordion-pane">').appendTo(y).css({overflow:"auto"}).hide();B.touch((function(){ae(q)})),Y.touch((function(){ae(X)})),G.touch((function(){ae(J)}));var K=q;function Q(){var e=window.getWidth(),t=window.getHeight(),o=t-56,a=348,s=Math.min(348,Math.floor((e-a)/2)),r=s,l=a+s+r,c=Math.max(0,Math.floor((e-l)/2));p.css({width:l,left:c}),(void 0===i||i>=640)&&e<640?(p.prepend(N),Z()):(void 0===i||i<=640)&&e>640&&(N.appendTo(M),n.unmountComponentAtNode(u[0])),e>640?(m.css({display:"",top:16,bottom:112,left:16,width:a-32}),y.css({display:"",top:16,bottom:112,left:a+s,width:r-16}),v.css({display:"",top:16,bottom:112,left:a,width:s-16}),J.css({height:o-282}),H.css({height:o-196}),q.css({height:o-282}),X.css({height:o-282}),p.css({top:16,bottom:16,height:t-80}),g.css({top:16,bottom:112,left:a,width:s+r-16})):(m.css({left:16,width:"95%",top:128,bottom:136}),v.css({left:"3%",width:"45%",top:128,bottom:136}),y.css({left:"52%",width:"45%",top:128,bottom:136}),g.css({left:"3%",width:"94%",top:128,bottom:136}),p.css({top:0,bottom:0,height:t}),H.css({height:o-252}),q.css({height:o-336}),X.css({height:o-336}),J.css({height:o-336})),i=e}function Z(){const e=[{isSelected:"EDIT_FIELDS"===o,text:locale.fields,onClick:()=>{o="EDIT_FIELDS",Z()}},{isSelected:"SECURITY_OPTIONS"===o,text:locale.options,onClick:()=>{o="SECURITY_OPTIONS",Z()}}];n.render(s.createElement(Yi,{tabs:e}),u[0]),"SECURITY_OPTIONS"===o?(m.css("display",""),y.css("display","none"),v.css("display","none")):(m.css("display","none"),y.css("display",""),v.css("display",""))}function ee(e){if(TOUCH){let t=e.data("field");if(!t)return;new Xi.a(void 0,t,!0)}else{if(!e)return;let o=e.data("field");if(!o)return;var t=e.find(".t-columneditor-label"),i=$('<input class="t-columneditor-input" type="text">').val(o.caption);t.before(i),t.detach(),i.keyup((function(e){13===e.which&&i.blur()})),i.blur((function(){var e=i.val();o.caption=e,t.text(e),i.before(t),i.remove()})),i.focus().select()}}function te(e,t){W=t.placeholder.index()}function ie(){if(!z){for(var e=H.children(),i=0;i<e.length;i++){$(e[i]).data("field").order=i}t.resort(),a.trigger("change")}}function oe(e,i){z=!0;var o=i.sender;if(o){var n=W,a=o.data("col");if(a){var s;if(a.isCreateField){var r=t.createNewFieldName(a.field.base,a.field.caption);s=t.schema.createField2(t,Object.assign({},a.field,{caption:r,order:n-1})),Object(l.f)("Table","AddField",{type:"Field",fieldType:a.field.base})}else if(a.isCreateReference){var c=a.refType,d=c.caption;for(let e=2;t.findElement(d);e++)d=c.caption+e;var h=t.caption;for(let e=2;c.findElement(h)||t===c&&d===h;e++)h=t.caption+e;s=t.schema.createReference(t,d,c,h,!1),Object(l.f)("Table","AddField",{type:"Table Reference",fieldType:"reference"})}else a.isCreateUI&&(s=t.schema.createUI(t,a.field.caption,n-1,a.field.base),Object(l.f)("Table","AddField",{type:"Layout Element",fieldType:a.field.base}));setTimeout((function(){se(),z=!1,ee(ne(s))}),0)}}}function ne(e){for(var t=H.children(),i=0;i<t.length;i++){var o=$(t[i]);if(o.data("field")===e)return o}}function ae(e){K!==e&&(K.slideUp("fast"),e.slideDown("fast"),K=e)}function se(){H.empty();var e=0,i=t.sorted;k.each(i,(function(i){e++;var o=i.getExpressionErrors().length>0,n="rev"===i.base&&i.refType.master===t?"list":"signature"===i.fileHandling?"signature":i.base;$('<div class="t-columneditor-column'+(o?" error":"")+'">').data("field",i).append($('<div class="t-columneditor-icon i-32-24 '+(o?"i-red":"i-light-grey")+'">').addClass("i-field-"+n)).append($('<div class="t-columneditor-label">').text(i.caption)).appendTo(H).mouseup((function(){V||new Xi.a(void 0,i)}))})),0===e&&$('<div style="padding:16px;color:#555">').text(locale.dragFieldsHere).appendTo(H)}function re(){q.empty();var e={connectToSortable:H,helper:"clone",zIndex:1e7,appendTo:$(document.body),handle:TOUCH?".t-columneditor-icon, .t-columneditor-label":void 0};function t(t){var i={field:t,isCreateField:!0},o="signature"===t.fileHandling?"signature":t.base;$('<div class="t-columneditor-column --ul-type-editor-right-field">').data("col",i).append($('<div class="t-columneditor-icon i-32-24 i-light-grey">').addClass("i-field-"+o)).append($('<div class="t-columneditor-label">').text(t.caption)).appendTo(q).draggable(e)}t({base:"fn",caption:locale.types.fn}),t({base:"string",caption:locale.types.string}),t({base:"string",caption:locale.types.string_multiline,stringMultiline:!0}),t({base:"html",caption:locale.types.html}),t({base:"number",caption:locale.types.number}),t({base:"boolean",caption:locale.types.boolean}),t({base:"choice",caption:locale.types.choice}),t({base:"multi",caption:locale.types.multi}),t({base:"date",caption:locale.types.date}),t({base:"time",caption:locale.types.time}),t({base:"timestamp",caption:locale.types.timestamp}),t({base:"timeinterval",caption:locale.types.timeinterval}),t({base:"appointment",caption:locale.types.appointment}),t({base:"file",caption:locale.types.file}),t({base:"file",caption:locale.signature,fileHandling:"signature"}),t({base:"link",caption:locale.types.link}),t({base:"email",caption:locale.types.email}),t({base:"phone",caption:locale.types.phone}),t({base:"location",caption:locale.types.location}),t({base:"color",caption:locale.types.color}),t({base:"icon",caption:locale.types.icon}),database.supports.authentication&&t({base:"user",caption:locale.types.user}),t({base:"dchoice",caption:locale.choiceDynamic}),t({base:"dmulti",caption:locale.multipleChoiceDynamic})}function le(){X.empty();var e={connectToSortable:H,helper:"clone",zIndex:1e7,appendTo:$(document.body),handle:TOUCH?".t-columneditor-icon, .t-columneditor-label":void 0};function t(t){var i={field:t,isCreateUI:!0};$('<div class="t-columneditor-column">').data("col",i).append($('<div class="t-columneditor-icon i-32-24 i-light-grey">').addClass("i-field-"+t.base)).append($('<div class="t-columneditor-label">').text(t.caption)).appendTo(X).draggable(e)}t({base:"tab",caption:locale.types.tab}),t({base:"head",caption:locale.types.head}),t({base:"text",caption:locale.types.text}),t({base:"br",caption:locale.types.br}),t({base:"space",caption:locale.types.space}),t({base:"button",caption:locale.types.button}),t({base:"view",caption:locale.types.view}),t({base:"chart",caption:locale.types.chart})}function ce(){J.empty();var e={connectToSortable:H,helper:"clone",zIndex:1e7,appendTo:$(document.body),handle:TOUCH?".t-columneditor-icon, .t-columneditor-label":void 0};k.each(util.localeSortBy(t.schema.types,"caption"),(function(t){var i={refType:t,isCreateReference:!0};$('<div class="t-columneditor-column">').data("col",i).append($('<div class="t-columneditor-icon i-32-24 i-light-grey">').addClass("i-field-ref")).append($('<div class="t-columneditor-label">').text(t.caption)).appendTo(J).draggable(e)}))}function de(){se(),ce(),r||(r=!0,w.show(),window.getWidth()<640?(x.text(""),x.append('<div class="i-32-24 i-white i-save"/>')):x.text(locale.saveDataModelChanges))}function he(){Object(l.f)("Table","Duplicate"),new Gi({type:t,cancel:function(){},okay:function(e){Object(l.f)("Table","DuplicateConfirm"),fe(),new eo({schema:a,type:e.id,isNewType:!0,schemaDirty:!0})}})}function pe(){Object(l.f)("Table","Remove"),$.dialog({closable:!0,caption:locale.removeTable,message:locale.confirmRemoveTable,buttons:[{color:"red",caption:locale.removeTable,callback:function(){Object(l.f)("Table","RemoveConfirm"),$.loading(!0),t.schema.removeType(t),database.updateSchema(a,(function(e){if($.loading(!1),e)return $.alert(e);fe()}))}}]})}function ue(){if(!r)return fe();Object(l.f)("Table","SaveChanges"),e.beforeSaveType&&e.beforeSaveType(),$.loading(!0),database.updateSchema(a,(function(i){if($.loading(!1),i)return $.alert(i);fe(),e.afterSaveType&&e.afterSaveType(t.id)}))}function fe(){$(window).off("resize",Q),a.off("change",de),h.close((function(){O.destroy(),I.destroy(),F.destroy(),R.destroy(),L&&L.destroy(),j&&j.destroy(),A&&A.destroy(),T&&T.destroy(),C&&C.destroy(),S&&S.destroy(),_&&_.destroy(),E&&E.destroy(),D&&D.destroy(),P&&P.destroy(),U&&U.destroy(),e.close&&e.close(),n.unmountComponentAtNode(u[0])}))}se(),re(),le(),ce(),Q(),$(window).on("resize",Q),c&&setTimeout((function(){p.find(".component").first().data("component").focus()}),400)}function to(e,t){this.container=e,this.visible=!1,this.el=$('<div class="schema">'),this.$controls=$('<div class="admin-schema-controls">'),this.$controls.button2({cls:"blue",caption:locale.addTable,click:function(){Object(l.f)("DataModel","CreateTable"),new eo({})}}),this.resize=()=>{this.render()},database.on("schema",void 0,this.schemaChanged,this)}function io(e,t){this.container=e,this.visible=!1;var i=database.settings;this.el=$('<div class="admin-options">');var o=$('<div class="admin-options-pane">').appendTo(this.el),n=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.rolesOpen,width:4}));n.value=i.rolesOpen?i.rolesOpen.slice():[];new qt.a(this,n,o);var a=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.history,width:4}));a.value=i.rolesHistory?i.rolesHistory.slice():[];new qt.a(this,a,o);var s=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.rolesExport,width:4}));s.value=i.rolesExport?i.rolesExport.slice():[];new qt.a(this,s,o);var r=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.rolesImport,width:4}));r.value=i.rolesImport?i.rolesImport.slice():[];new qt.a(this,r,o);var l=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.rolesPrint,width:4}));l.value=i.rolesPrint?i.rolesPrint.slice():[];new qt.a(this,l,o);var c=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.rolesMassDataUpdate,width:4}));c.value=i.rolesMassDataUpdate?i.rolesMassDataUpdate.slice():[];new qt.a(this,c,o);$('<div style="padding:8px 0;text-align:right">').appendTo(o).button(void 0,locale.saveSchema,"blue",(function(){database.updateSettings({rolesOpen:n.value,rolesHistory:a.value,rolesExport:s.value,rolesImport:r.value,rolesPrint:l.value,rolesMassDataUpdate:c.value},(function(e){if(e)return $.alert(e);$.alert(locale.okay)}))}))}to.prototype.base="schema",to.prototype.getNavigationState=function(){return{base:"schema"}},to.prototype.destroy=function(){database.off("schema",void 0,this.schemaChanged,this),this.el.remove(),this.$controls.remove()},to.prototype.hide=function(){this.visible&&(this.visible=!1,$(window).off("resize",this.resize),this.$controls.detach(),this.el.detach().empty())},to.prototype.show=function(){if(!this.visible){Object(l.f)("DataModel","Open"),this.visible=!0,this.el.appendTo(this.container.el),this.$controls.appendTo(ui.$body),$(window).on("resize",this.resize);var e=this;setTimeout((function(){e.render()}),0)}},to.prototype.schemaChanged=function(e,t,i){this.visible&&this.render()},to.prototype.render=function(){var e=this.el,t=database.schema.types;if(0!==k.size(t)){var i=new Vi,o={},n={};k.each(t,(function(e){var t={children:[],type:e};if(o[e.id]=t,!e.master){var a=i.node(e.caption,{type:e,group:t});a.rad=1.5,a.mass=1,a.color=1,t.node=a,n[e.id]=a}})),k.each(t,(function(e){var t=o[e.id];if(e.master){var i=o[e.master.id];i.children.push(t),t.parent=i}})),k.each(t,(function(e){o[e.id];if(e.master){for(var t=o[e.master.id];t.parent;)t=t.parent;t.node.rad+=.4}}));var a=[],s={};k.each(t,(function(e){for(var t=o[e.id],n=t;n.parent;)n=n.parent;var r=n.node;k.each(e.fields,(function(n){if(n.isReference){var l=e.id+"-"+n.refType.id,c=n.refType.id+"-"+e.id;if(!s[l]&&(s[l]=!0,!s[c])){s[l]=!0;for(var d=o[n.refType.id],h=d;h.parent;)h=h.parent;var p=h.node;if(t!==d&&(!t.type.master||t.type.master!==d.type)){var u=i.node(n.caption,{source:r,target:p,sourceGroup:t,targetGroup:d});u.mass=0,u.color=2,u.rad=.2;i.edge(u,r,n.caption,{}),i.edge(u,p,n.caption,{});a.push(u)}}}}))}));var r=Math.max(800,ui.$body.width()-20),l=Math.max(600,ui.$body.height()),c=50;i.powerDirectInit(r/c,l/c);for(var d=0;d<2e3;d++){if(i.powerDirectStep(.05)<1)break}var h=1/0,p=1/0,u=-1/0,f=-1/0;k.each(n,(function(e){h=Math.min(e.x-e.rad,h),p=Math.min(e.y-e.rad,p),u=Math.max(e.x+e.rad,u),f=Math.max(e.y+e.rad,f)}));var m=u-h,g=f-p,v=Math.ceil(Math.max(l,c*g)),y=Math.ceil(Math.max(r,c*m)),b=Math.round((y-c*m)/2),w=Math.round((v-c*g)/2);e.empty();var x="http://www.w3.org/2000/svg",T=document.createElementNS(x,"svg");e[0].appendChild(T),T.setAttributeNS(null,"viewBox","0 0 "+y+" "+v),T.setAttributeNS(null,"width",y),T.setAttributeNS(null,"height",v);var C=e.width(),$=e.height();r>C&&e.scrollLeft((r-C)/2),v>$&&e.scrollTop((v-$)/2);var S=document.createElementNS(x,"defs");T.appendChild(S);var _=document.createElementNS(x,"marker");_.id="Triangle",_.setAttributeNS(null,"refX","4"),_.setAttributeNS(null,"refY","3"),_.setAttributeNS(null,"markerWidth","6"),_.setAttributeNS(null,"markerHeight","6"),_.setAttributeNS(null,"orient","auto"),S.appendChild(_);var E=document.createElementNS(x,"path");E.setAttributeNS(null,"d","M0,0 L0,6 L4,3 L0,0"),E.setAttributeNS(null,"class","schema-arrow"),_.appendChild(E);var D=document.createElementNS(x,"g");T.appendChild(D);var N=document.createElementNS(x,"g");T.appendChild(N),k.each(n,(function(e){var t=e.data.group;I(D,t);var i=b+c*(e.x-h),o=w+c*(e.y-p);t.x=i,t.y=o,t.shape.setAttributeNS(null,"transform","translate("+i+" "+o+")")})),k.each(a,(function(e){e.data.path&&T.remove(e.data.path),e.data.path=M(N,e)}))}function I(e,t){var i=t.type,o=document.createElementNS(x,"g");e.appendChild(o);var n=document.createElementNS(x,"clipPath");n.id="CLIP_"+Math.random(),o.appendChild(n);var a=document.createElementNS(x,"rect");n.appendChild(a);var s=document.createElementNS(x,"rect");s.setAttributeNS(null,"class","schema-type"),o.appendChild(s);var r=document.createElementNS(x,"text");r.appendChild(document.createTextNode(i.caption)),r.setAttributeNS(null,"class","schema-type-text"),r.setAttributeNS(null,"clip-path","url(#"+n.id+")"),o.appendChild(r);for(var l=120,c=30,d=[],h=0;h<t.children.length;h++){I(o,y=t.children[h]),l=Math.max(l,y.w),c+=y.h+10,d.push(y)}d.length>0&&(l+=20);var p=-l/2,u=-c/2;s.setAttributeNS(null,"rx",4),s.setAttributeNS(null,"ry",4),s.setAttributeNS(null,"x",p),s.setAttributeNS(null,"y",u),s.setAttributeNS(null,"width",l),s.setAttributeNS(null,"height",c),a.setAttributeNS(null,"x",p),a.setAttributeNS(null,"y",u),a.setAttributeNS(null,"width",l),a.setAttributeNS(null,"height",c);var f,m=r.getComputedTextLength();f=m>l-10?p+5:-m/2,r.setAttributeNS(null,"x",f),r.setAttributeNS(null,"y",u+20);var g=0,v=u+30;for(h=0;h<d.length;h++){var y;(y=d[h]).x=g,y.y=v+y.h/2,y.shape.setAttributeNS(null,"transform","translate("+y.x+" "+y.y+")"),v+=y.h+10}t.w=l,t.h=c,t.shape=o,r.onclick=s.onclick=function(){new eo({type:i.id})}}function O(e){for(var t=e.x,i=e.y,o=e.parent;o;)t+=o.x,i+=o.y,o=o.parent;return{x:t-e.w/2,y:i-e.h/2,width:e.w,height:e.h}}function M(e,t){var i=t.data.sourceGroup,o=t.data.targetGroup,n=O(i),a=O(o),s=b+c*(t.x-h),r=w+c*(t.y-p),l=F(n,s,r),d=F(a,s,r),u="M "+l[0]+","+l[1]+" C "+s+","+r+","+s+","+r+","+d[0]+","+d[1],f=document.createElementNS(x,"path");return f.setAttributeNS(null,"d",u),f.setAttributeNS(null,"class","schema-link"),f.setAttributeNS(null,"style","marker-end:url(#Triangle)"),e.appendChild(f),f}function F(e,t,i){var o=e.x,n=e.y,a=e.width,s=e.height,r=a/2,l=s/2,c=o+r,d=n+l,h=t-c,p=i-d,u=Math.abs(h*(l/p)),f=Math.abs(p*(r/h));return u<=r?p<0?h>0?[c+u,n]:[c-u,n]:h>0?[c+u,n+s]:[c-u,n+s]:p<0?h>0?[o+a,d-f]:[o,d-f]:h>0?[o+a,d+f]:[o,d+f]}},io.prototype.base="security",io.prototype.getNavigationState=function(){return{base:"security"}},io.prototype.destroy=function(){this.el.remove()},io.prototype.show=function(){Object(l.f)("Security","Open"),this.visible||(this.visible=!0,this.el.appendTo(this.container.el))},io.prototype.hide=function(){this.visible&&(this.visible=!1,this.el.detach())};o("./src/react/Console.css");function oo({navigationState:e,updateNavigationState:t,queries:i,database:o}){const[n,a]=s.useState(e.consoleInput||""),[r,c]=s.useState(e.consoleOutput||"");function d(e){try{const t=i.parse(o.schema,void 0,e,{},!0,!0,!0);if(t.errors&&t.errors.length)return t.errors[0].message}catch(e){return e.toString()}}function h(e){Object(l.f)("Console","Run"),u(n,e.event.metaKey&&e.event.shiftKey),t(n,r)}function p(e){a(e),t(n,r)}function u(e,t){let n;try{n=i.parse(o.schema,void 0,e,{},!0,!0,!0),n.errors&&n.errors.length?c(n.errorMessage()):n.evaluate(o,void 0,(e,a)=>{if(e)c(n.errorMessage());else{let e="";n.isMultiple()?a&&(e=a.reduce((e,t)=>[...e,n.returnType.format(t)],[]).join("\n")):e=n.returnType.format(a),t&&(e+="\n=== Internal Expression ===\n"+n.toString()+"\n=== Reparsed Expression ===\n"+i.parseSystem(o.schema,void 0,n.toString(),{}).toHumanString("")+"\n=== JS Sync Code ===\n"+n.getSyncJS()+"\n=== JS Async Code ===\n"+n.getAsyncJS()),c(e)}})}catch(e){c(e+" / "+n.getAsyncJS())}}return s.createElement("div",{className:"Console_root"},s.createElement("div",{className:"Console_header"},s.createElement(Ze.a,{className:"Console_runButton nx-button-text blue",onFastClick:h},Object(b.getLocale)().runConsole),s.createElement("div",{className:"Console_error"},d(n))),s.createElement("textarea",{onChange:e=>p(e.target.value),value:n,style:{height:"30%"},className:"Console_input",autoCorrect:"off",autoCapitalize:"off",autoComplete:"off",spellCheck:!1}),s.createElement("textarea",{onChange:()=>null,value:r,className:"Console_output",autoCorrect:"off",autoCapitalize:"off",autoComplete:"off",spellCheck:!1}))}class no{constructor(e,t){Je()(this,"container",void 0),Je()(this,"navigationState",void 0),Je()(this,"el",void 0),Je()(this,"visible",void 0),Je()(this,"base",void 0),this.container=e,this.navigationState=t,this.updateNavigationState=$.proxy(this.updateNavigationState,this),this.el=$('<div class="admin-options console-container">'),this.base="console"}getNavigationState(){return this.navigationState}updateNavigationState(e,t){this.navigationState.consoleInput=e,this.navigationState.consoleOutput=t}destroy(){n.unmountComponentAtNode(this.el[0]),this.el.remove()}hide(){this.visible&&(this.visible=!1,this.el.detach())}show(){Object(l.f)("Console","Open"),this.visible||(this.visible=!0,this.el.appendTo(this.container.el),this.updateUI())}updateUI(){this.visible&&n.render(s.createElement(oo,{database:window.database,queries:window.queries,updateNavigationState:this.updateNavigationState,navigationState:this.navigationState}),this.el[0])}}var ao=o("./src/js/widgets/Component.js");function so(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component br">').data("component",this).attr("title",i.tooltip||"").appendTo(t.el)}function ro(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component editor button">').data("component",this).attr("title",i.tooltip||""),this.updateElementWidth(),this.el.appendTo(t.el);var o=i.buttonColor||"blue";this.button=$('<div class="nx-button-text '+o+'">').text(i.caption||locale.unnamed).appendTo(this.el).touch($.proxy(this.buttonClicked,this)),this.updateUIStyle()}Object.assign(so.prototype,ao.a.prototype),so.prototype.isWidthAdjustable=function(){return!1},so.prototype.updateStructure=function(){var e=this.field;this.el.attr("title",e.tooltip||"")},Object.assign(ro.prototype,ao.a.prototype),ro.prototype.isWidthAdjustable=function(){return!0},ro.prototype.updateStructure=function(){var e=this.field;this.button.text(e.caption||locale.unnamed),this.updateElementWidth(),this.el.attr("title",e.tooltip||"");var t=e.buttonColor||"blue";this.button[0].className="nx-button-text "+t,this.updateUIStyle()},ro.prototype.setHeight=function(e){},ro.prototype.updateUI=function(){},ro.prototype.updateUIStyle=function(){var e=this.field,t=e.style&&JSON.parse(e.style)||void 0;if(t){var i=t.backgroundColor;this.button.css({"border-color":i,"background-color":i,color:t.color||util.contrastingTextColorTo(i)||"#FFF","font-weight":t.fontWeight||"","font-style":t.fontStyle||"","font-size":t.fontSize||"","text-align":t.textAlign||"","border-width":t.borderWidth||"","border-color":t.borderColor||"","border-left-style":(util.multiHasOne(t.borderSides,[1])?t.borderStyle:"none")||"","border-top-style":(util.multiHasOne(t.borderSides,[2])?t.borderStyle:"none")||"","border-bottom-style":(util.multiHasOne(t.borderSides,[3])?t.borderStyle:"none")||"","border-right-style":(util.multiHasOne(t.borderSides,[4])?t.borderStyle:"none")||""})}else this.button.css({"border-color":"","background-color":"",color:"","font-weight":"","font-style":"","font-size":"","text-align":"","border-width":"","border-color":"","border-left-style":"","border-top-style":"","border-bottom-style":"","border-right-style":""})},ro.prototype.buttonClicked=function(){this.button.addClass("clicked"),Object(c.c)(this.field.fn,this.container.nid,e=>{this.button.removeClass("clicked"),e&&$.alert(e)})};var lo=o("./node_modules/chart.js/dist/Chart.js");function co(e){var t=e.query,i=t.cols,o=t.models,n=t.rows,a=t.groups,s=null!=t.cidxGroup,r=t.tid;if(!database.schema.types[r])throw new Error(locale.errorTypeNotFound);s&&(n=t.groupsSorted);var l=e.chartType||"bar",c=e.chartDatasets||"rows",d=!!e.chartStacked,h=e.chartLineTension?.25:0,p=void 0,u=[];function f(e){var o=i[e];return s?e===t.cidxGroup?o.field:o.agg?o.aggType:void 0:o.field}if(i.length<1)throw new Error(locale.chartNoData);if(1===i.length){if($=i[0],!(w=f(0)))throw new Error(locale.chartNoData);if("number"!==w.base)throw new Error(locale.chartNoData);!0,p=void 0,u=[0]}else{$=i[0],(w=f(0))&&"number"===w.base?(!1,p=0):(!0,p=0);for(var m=1;m<i.length;m++)$=i[m],(w=f(m))&&"number"===w.base&&u.push(m)}if(!u.length)throw new Error(locale.chartNoData);var g={responsive:!1,responsiveAnimationDuration:0,maintainAspectRatio:!1,onResize:null,devicePixelRatio:window.devicePixelRatio,tooltips:{callbacks:{label:function(e,t){const i=u[e["rows"===c?"index":"datasetIndex"]];var o=void 0===i?void 0:f(i),n="pie"===l||"doughnut"===l?t.datasets[e.datasetIndex].data[e.index]:e.yLabel;return o?o.format(n):String(n)}}},animation:{duration:0}};if("none"===e.chartLegend&&(g.legend={display:!1}),"bubble"!==l){var v=[],y=[];if("cols"===c){if(null!=p)for(var b=0;b<n.length;b++){var w,x=n[b],T=(D=s?a[x]:o[x]).values[p],C=(w=f(p))?w.format(T):String(T);v[b]=C||String(b+1)}else for(b=0;b<n.length;b++)v[b]=String(b+1);for(m=0;m<u.length;m++){var k=u[m],$=i[k],S=[];for(b=0;b<n.length;b++){x=n[b],T=(D=s?a[x]:o[x]).values[k];S[b]=T||0}var _={label:C=$.caption||$.expression.caption,data:S};switch(l){case"bar":_.borderColor=ho(m,u.length),_.backgroundColor=ho(m,u.length);break;case"line":case"radar":_.borderColor=uo(m,u.length),_.backgroundColor=po(m,u.length),_.tension=h;break;case"pie":case"doughnut":case"polarArea":_.borderColor=[],_.backgroundColor=[];for(var E=0;E<n.length;E++)_.borderColor[E]="#fff",_.backgroundColor[E]=ho(E,n.length)}y.push(_)}}else{for(m=0;m<u.length;m++){k=u[m],$=i[k];v[m]=$.caption||$.expression.caption}for(b=0;b<n.length;b++){x=n[b];var D=s?a[x]:o[x];for(S=[],m=0;m<u.length;m++){k=u[m],$=i[k],T=D.values[k];S[m]=T||0}_={label:C=null!=p&&(w=f(p))&&w.format(D.values[p])||String(b+1),data:S};switch(l){case"bar":_.borderColor=ho(b,n.length),_.backgroundColor=ho(b,n.length);break;case"line":case"radar":_.borderColor=uo(b,n.length),_.backgroundColor=po(b,n.length),_.tension=h;break;case"pie":case"doughnut":case"polarArea":_.backgroundColor=[];for(E=0;E<u.length;E++)_.backgroundColor[E]=uo(E,u.length)}y.push(_)}}var N=f(u[0]);return"bar"!==l&&"line"!==l||Object.assign(g,{scales:{yAxes:[{stacked:d,ticks:{beginAtZero:!0,callback:function(e,t,i){return N?N.format(e):String(e)}}}],xAxes:[{stacked:d}]}}),new lo(e.$canvas,{type:l,data:{labels:v,datasets:y},options:g})}if(u.length<3)throw new Error(locale.chartBubbleRequiresColumns);for(y=[],b=0;b<n.length;b++){x=n[b],D=s?a[x]:o[x];C=null!=p&&(w=f(p))&&w.format(D.values[p])||String(b+1);var I=D.values[u[0]],O=D.values[u[1]],M=D.values[u[2]];null!=I&&null!=O&&null!=M&&y.push({label:C,borderColor:uo(b,n.length),borderWidth:2,backgroundColor:po(b,n.length),data:[{x:I,y:O,r:M}]})}return new lo(e.$canvas[0].getContext("2d"),{type:l,data:{datasets:y},options:g})}function ho(e,t){return fo(e,t,.6)}function po(e,t){return fo(e,t,.1)}function uo(e,t){return fo(e,t,1)}function fo(e,t,i){var o=360*e/t,n=.8,a=.8,s=util.hsv2rgb(o,n,a);return s[3]=i,util.formatColor(s)}function mo(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component editor chart">').data("component",this).attr("title",i.tooltip||"").css("height",40*i.height+37+"px"),this.updateElementWidth(),this.el.appendTo(t.el),this.label=$("<label>").text(i.caption||locale.unnamed).appendTo(this.el),this.$chart=$('<div class="chartview">').appendTo(this.el),this.$message=$('<div class="chartview-message">').appendTo(this.$chart),this.$canvas=$('<canvas class="chartview-canvas" style="display:block;width:100%;height:100%"></canvas>').appendTo(this.$chart),this.chart=void 0}function go(e,t){const i=this;this.id="comments",this.container=e,this.selectedIconClass="tab-icon-container i-18 i-white i-chat",this.unselectedIconClass="tab-icon-container i-18 i-light-grey i-chat",this.elTab=$('<div class="tab tab-icon">').attr("title",locale.comments).append($(`<div class="${this.unselectedIconClass}"></div>`)).touch($.proxy((function(){i.container.selectTab(i.id)}),this)),this.tabSelectedIndicator=$('<div class="tab-selected-indicator">'),this.el=$('<div class="comments">').hide().appendTo(e.containerEl||e.el);const o=$('<div class="component editor editor-string editor-4col">').appendTo(this.el);$("<label>").text(locale.postCommentLabel).appendTo(o),this.comment=$('<textarea style="height:96px">').appendTo($('<div class="stringeditor">').appendTo(o));const n=$('<div class="comments-post-btn">').appendTo(this.el);$('<div class="nx-hspace-flex">').appendTo(n),$('<div class="nx-button-text blue">').text(locale.postCommentButton).appendTo(n).touch($.proxy(this.post,this)),this.commentDiv=$('<div class="comment">').appendTo(this.el).touch($.proxy(this.commentClicked,this))}function vo(e){var t=e.getHours(),i=e.getMinutes();return(t<10?"0":"")+t+":"+(i<10?"0":"")+i}function yo(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component editor custom">').data("component",this).appendTo(t.el),this.updateElementWidth(),this.label=$("<label>").text(i.caption||locale.unnamed).appendTo(this.el),this.content=$('<div style="padding:8px">').appendTo(this.el)}Object.assign(mo.prototype,ao.a.prototype),mo.prototype.destroy=function(){this.chart&&(this.chart.destroy(),this.chart=void 0),ao.a.prototype.destroy.call(this)},mo.prototype.createQuery=function(){try{return new queries.QueryExpression(database,this.field,this.container.nid)}catch(e){return}},mo.prototype.updateStructure=function(){var e=this.field;this.el.css("height",40*e.height+37+"px").attr("title",e.tooltip||""),this.updateElementWidth(),this.label.text(e.caption||locale.unnamed)},mo.prototype.updateUI=function(){var e=this,t=this.createQuery();if(this.query=t,!t)return;let i=e._chartLoadingId=Math.random();t.load((function(){if(i===e._chartLoadingId){e.chart&&(e.chart.destroy(),e.chart=void 0),e.$message.text("");try{e.chart=co({query:t,chartType:e.field.chartType,chartDatasets:e.field.chartDatasets,chartStacked:e.field.chartStacked,chartLineTension:e.field.chartLineTension,chartLegend:e.field.chartLegend,animationDuration:0,$canvas:e.$canvas}),e.resizeChart()}catch(t){e.$message.text(t)}}}))},mo.prototype.bind=function(e){this.updateVisibility(),this.updateUI()},mo.prototype.nodeChanged=function(){this.updateVisibility(),this.updateUI()},mo.prototype.isHeightAdjustable=function(){return!0},mo.prototype.setHeight=function(e){var t=Math.max(2,Math.round((e-37)/40));this.field.height=t,this.el.css("height",40*t+37+"px"),this.resize()},mo.prototype.widthChanged=function(){this.resize()},mo.prototype.resize=function(){this.resizeChart()},mo.prototype.resizeChart=function(){this.chart&&this.chart.resize()},go.prototype.bind=function(e){!database.sql&&this.nid&&database.offComment(this.nid,this.loadComments,this),this.nid=e?e._id:void 0,!database.sql&&this.nid&&database.onComment(this.nid,this.loadComments,this),this.container.currentTab===this&&this.loadComments()},go.prototype.destroy=function(){!database.sql&&this.nid&&database.offComment(this.nid,this.loadComments,this),this.elTab.remove(),this.el.remove()},go.prototype.hide=function(e){this.container.currentTab===this&&(this.container.currentTab=void 0,this.el.hide(),this.commentDiv.empty(),this.tabSelectedIndicator.detach(),this.elTab.removeClass("selected"),this.elTab[0].firstElementChild.className=this.unselectedIconClass,!database.sql&&this.nid&&database.offComment(this.nid,this.loadComments,this),e&&e())},go.prototype.show=function(){this.container.currentTab!==this&&(this.container.currentTab&&this.container.currentTab.hide(),this.container.currentTab=this,this.el.show(),this.elTab.addClass("selected"),this.elTab[0].firstElementChild.className=this.selectedIconClass,this.tabSelectedIndicator.appendTo(this.elTab),this.loadComments(),!database.sql&&this.nid&&database.onComment(this.nid,this.loadComments,this))},go.prototype.focus=function(){},go.prototype.loadComments=function(){var e=this;e.container.nid&&database.loadComments(e.container.nid,(function(t,i){t||e.render(i)}))},go.prototype.render=function(e){var t=this.commentDiv;t.empty();var i=void 0,o=void 0,n=void 0;k.each(e,(function(e){var a=e[0],s=new Date(a),r=vo(s),l=e[1],c=e[2],d=util.formatLocaleDate(s);if(d!==i&&($('<div class="comment-date">').text(d).appendTo(t),i=d,o=void 0),l!==o){const e=$('<div class="comment-head">').appendTo(t);$('<div class="comment-user">').text(database.userName(l)).appendTo(e),$('<div class="comment-time">').text(r).appendTo(e)}else if(r!==n){const e=$('<div class="comment-head">').appendTo(t);$('<div class="comment-time">').text(r).appendTo(e)}o=l,n=r;$('<div class="comment-text" data-cid="'+a+'" data-user="'+l+'">').text(c).appendTo(t)}),this)},go.prototype.commentClicked=function(e){var t=this,i=$(e.target).closest(".comment-text"),o=null,n=null,a=null,s=null;function r(){c(),t.removeComment(a)}function l(){var e=(o.val()||"").trim();e?(c(),i.text(e),t.postComment(a,e)):r()}function c(){c||(c=!0,n.remove(),o.remove(),i.show())}i.length&&(a=i.attr("data-cid"),s=i.attr("data-user"),a&&s&&s==database.user.id&&(i.hide(),n=$('<div class="comment-controls">').append($('<div class="comment-controls-buttons">').append($('<div class="button i-32-24 i-red i-setting-trash">').click(r))).insertBefore(i),o=$('<textarea class="comment-editor">').insertAfter(i).val(i.text()).blur(l).focus()))},go.prototype.post=function(){var e=this.comment.val()||"";this.comment.val(""),0!==e.trim().length&&this.postComment(void 0,e)},go.prototype.postComment=function(e,t){var i=this;database.postComment(this.nid,e,t,(function(e,t){e&&$.alert(e),database.sql&&i.loadComments()}))},go.prototype.removeComment=function(e){var t=this;database.removeComment(this.nid,e,(function(e,i){e&&$.alert(e),database.sql&&t.loadComments()}))},Object.assign(yo.prototype,ao.a.prototype),yo.prototype.isWidthAdjustable=function(){return!0},yo.prototype.isHeightAdjustable=function(){return!1},yo.prototype.bind=function(e){console.log("Custom.bind");var t=this;t.load((function(){t.updateUI()})),t.updateVisibility()},yo.prototype.updateStructure=function(){console.log("Custom.updateStructure");var e=this.field;this.label.text(e.caption||locale.unnamed),this.updateElementWidth()},yo.prototype.setHeight=function(e){},yo.prototype.updateUI=function(){console.log("Custom.updateUI"),this.content.html(this.value||"")},yo.prototype.load=function(e){var t=this;t.getValue((function(i,o){t.value=o,e()}))},yo.prototype.getValue=function(e){var t=this;database.loadNode(t.container.nid,(function(i,o){if(i)return e(i);t.field.exp?t.field.exp.evaluate(database,o,e):e(void 0,void 0)}))};var bo=o("./src/js/widgets/widgets.js");function wo(e,t,i){this.container=e,this.field=i,this.visible=!0,this.error=null;var o=i.getEditorClass();this.el=$('<div class="component">').addClass(Object(bo.d)(i)).data("component",this).attr("title",i.tooltip||""),this.updateElementWidth(),this.el.appendTo(t.el),"left"===i.labelPosition&&this.el.addClass("label-left"),this.label=$("<label>").text(i.caption||locale.unnamed).css("display",widgets.DONT_SHOW_LABEL[o]||"placeholder"===i.labelPosition||"none"===i.labelPosition?"none":"").appendTo(this.el),this.editor=Object(bo.c)(this,this),this.error||this.setError(void 0)}Object.assign(wo.prototype,ao.a.prototype),wo.prototype.blur=qt.a.prototype.blur,wo.prototype.focus=qt.a.prototype.focus,wo.prototype.editorUp=qt.a.prototype.editorUp,wo.prototype.editorDown=qt.a.prototype.editorDown,wo.prototype.getNid=function(){return this.container.nid},wo.prototype.destroy=function(){this.editor.destroy(),this.el.remove()},wo.prototype.updateStructure=function(){var e=this.field,t=e.getEditorClass();this.label.text(e.caption||locale.unnamed).css("display",widgets.DONT_SHOW_LABEL[t]||"placeholder"===e.labelPosition||"none"===e.labelPosition?"none":""),this.el.attr("title",e.tooltip||""),this.updateElementWidth(),t!==this.editor.editorClass||"fn"===t&&e.exp&&e.exp.returnType.base!==this.editor.base?(this.error&&this.error.detach(),this.editor.destroy(),this.el.attr("class","component "+Object(bo.d)(e)),this.editor=Object(bo.c)(this,this),this.error&&this.error.appendTo(this.el)):this.editor.updateStructure(),this.el.toggleClass("label-left","left"===e.labelPosition),this.error||this.setError(void 0)},wo.prototype.bind=function(e){this.editor.load(!0),this.updateIsWritable(),this.updateVisibility()},wo.prototype.save=function(){this.editor.save&&this.editor.save()},wo.prototype.onUpdate=function(){},wo.prototype.offUpdate=function(){},wo.prototype.getValue=function(e){const t=this.getNid();if(!t)return e(void 0,void 0);database.loadValue(t,this.field.id,e)},wo.prototype.setValue=function(e,t){if(!this.getNid())return t(void 0,void 0);database.update(this.getNid(),this.field.id,e,t)},wo.prototype.nodeChanged=function(){console.log("CmpField.nodeChanged"),this.editor.load(!1),this.updateIsWritable(),this.updateVisibility()},wo.prototype.isHeightAdjustable=function(){return this.editor.isHeightAdjustable()},wo.prototype.setHeight=function(e){this.editor.setHeight(e)},wo.prototype.startEditCaption=function(){if(TOUCH)this.popup(!0);else{var e=this.field,t=e.caption||"",i=this.el.offset(),o=i.left,n=i.top,a=this.el.outerWidth(),s={};$.pushInputHandler(s);var r=$('<div class="nx-backplane">').appendTo($(document.body)),l=$('<input type="text" class="component-label-editor" style="left:'+o+"px;top:"+n+"px;width:"+a+'px">').appendTo(r).blur(d).keydown(c).val(t).focus().select()}function c(e){switch(e.which){case 27:e.preventDefault(),h()}}function d(){var i=l.val();if(i!=t){var o=e.caption;e.caption=i,e.trigger("update","caption",o,i),e.type.schema.trigger("change")}h()}function h(){r.remove(),$.popInputHandler(s)}},wo.prototype.widthChanged=function(){this.editor&&this.editor.widthChanged&&this.editor.widthChanged()},wo.prototype.getError=function(){return Object(bo.b)()?this.field.getExpressionErrors()[0]:void 0};var xo=o("./src/react/LightboxComponent.tsx"),To=(o("./src/react/PdfRenderer.tsx"),o("./src/js/widgets/editors/ColorSelector.js"));function Co(e){var t=$.backplane({closable:!1}),i=$('<div class="paint">').appendTo(t),o=$('<div class="paint-head">').appendTo(i),n=$('<div class="paint-body">').appendTo(i),a=$('<div class="button"><div class="i-32-24 i-light-grey i-undo"></div></div>').click(Z).appendTo(o),s=$('<div class="button"><div class="i-32-24 i-light-grey i-redo"></div></div>').click(ee).appendTo(o);$('<div class="nx-hspace-small2">').appendTo(o);var r=$('<div class="button paint-tool"><div class="icon-big-grey icon-big-draw"></div></div>').appendTo(o).click(ne),l=$('<div class="button paint-tool"><div class="icon-big-grey icon-big-rect"></div></div>').appendTo(o).click(ae),c=$('<div class="button paint-tool"><div class="icon-big-grey icon-big-circle"></div></div>').appendTo(o).click(se);$('<div class="nx-hspace-small2">').appendTo(o);var d=$('<div style="width:24px;height:24px;border-radius:12px;border:solid 4px #000;display:inline-block;box-sizing:border-box;text-align:center;line-height:16px;font-size:16px;box-shadow:rgba(255, 255, 255, 1) 0px 0px 8px;color:#555;background-color:#fff;margin:4px"></div>'),h=$('<div style="width:24px;height:24px;border-radius:12px;background-color:#0f0;display:inline-block;box-sizing:border-box;text-align:center;line-height:24px;font-size:16px;box-shadow:rgba(255, 255, 255, 1) 0px 0px 8px;color:#555;margin:4px"></div>'),p=$('<div style="border-bottom:solid 1px #fff;width:32px;height:14px">');$('<div class="button">').append(d).appendTo(o).click(te),$('<div class="nx-hspace-small">').appendTo(o),$('<div class="button">').append(h).appendTo(o).click(ie),$('<div class="nx-hspace-small2">').appendTo(o),$('<div class="button">').append(p).appendTo(o).click(oe),$('<div class="nx-hspace-small2">').appendTo(o);$('<div class="nx-button-text grey"><span>'+htmlEscape(locale.clear)+"</span></div>").click(ce).appendTo(o);$('<div class="nx-hspace-flex">').appendTo(o);$('<div class="nx-button-text grey"><span>'+htmlEscape(locale.cancel)+"</span></div>").click(he).appendTo(o);$('<div class="nx-hspace-small">').appendTo(o);$('<div class="nx-button-text blue"><span>'+htmlEscape(locale.okay)+"</span></div>").click(de).appendTo(o);var u=e.img,f=0,m=0,g=0,v=0,y=0,b=0,w=0,x=0,T=null,C=0,k=0,S=0,_=0,E=0,D=0,N=1,I=0,O=0,M=0,F=0,R=0,L=0,j=[],A=[],P=null,U="draw",H="#000",z="",V=4,W=document.createElement("canvas");W.style.backgroundColor="#fff",n[0].appendChild(W);var B=W.getContext("2d");if(u){var q=n.width(),Y=n.height();E=(q-u.width)/2,D=(Y-(q>Y?96:116)-u.height)/2}function X(e){if(!TOUCH||e.touches)if(TOUCH&&1!==e.touches.length){if(TOUCH&&2===e.touches.length){"draw"===P&&(T=null,j.pop(),P=null,Q(),K()),M=E,F=D,I=e.touches[0].clientX,O=e.touches[0].clientY;var t=e.touches[0].clientX-e.touches[1].clientX,i=e.touches[0].clientY-e.touches[1].clientY;R=Math.sqrt(t*t+i*i),L=N}}else{var o=TOUCH?e.touches[0].clientX:e.clientX,n=TOUCH?e.touches[0].clientY:e.clientY;if(null===P){switch(P="draw",C=(o-g-E)/N,k=(n-v-D)/N,A=[],U){case"draw":(T=new ko).moveTo(C,k);break;case"rect":T=new $o(C,k);break;case"circle":T=new So(C,k)}T.strokeStyle=H,T.fillStyle=z,T.lineWidth=V,j.push(T)}}}function G(e){if(!TOUCH||e.touches)if(TOUCH&&1!==e.touches.length){if(TOUCH&&2===e.touches.length){var t=e.touches[0].clientX,i=e.touches[0].clientY,o=t-I,n=i-O,a=Math.sqrt(o*o+n*n),s=e.touches[0].clientX-e.touches[1].clientX,r=e.touches[0].clientY-e.touches[1].clientY,l=Math.sqrt(s*s+r*r)-R;Math.abs(l)>Math.abs(a)?((N=Math.min(2,Math.max(.5,L+l/100)))>=.95&&N<=1.05&&(N=1),E=M,D=F):(E=M+o,D=F+n,N=L),K()}}else{var c=TOUCH?e.touches[0].clientX:e.clientX,d=TOUCH?e.touches[0].clientY:e.clientY;if("draw"===P){switch(S=(c-g-E)/N,_=(d-v-D)/N,U){case"draw":T.lineTo(S,_);break;case"rect":case"circle":T.x1=S,T.y1=_}Q(),K(),C=S,k=_}}}function J(e){TOUCH&&e.touches&&e.touches.length||"draw"===P&&(T.isEmpty()&&j.pop(),T=null,P=null,K(),re())}function K(){E=Math.max(-w*N+20,Math.min(f-y*N-20,E)),D=Math.max(-x*N+20,Math.min(m-b*N-20,D)),B.setTransform(1,0,0,1,0,0),B.clearRect(0,0,f,m),B.setTransform(N,0,0,N,E,D),u&&B.drawImage(u,0,0);for(var e=0;e<j.length;e++)j[e].draw(B)}function Q(){if(j.length){y=1/0,b=1/0,w=-1/0,x=-1/0;for(var e=0;e<j.length;e++){var t=j[e],i=t.lineWidth,o=Math.min(t.x0,t.x1)-i,n=Math.min(t.y0,t.y1)-i,a=Math.max(t.x0,t.x1)+i,s=Math.max(t.y0,t.y1)+i;o<y&&(y=o),n<b&&(b=n),a>w&&(w=a),s>x&&(x=s)}}else y=0,b=0,w=0,x=0;u&&(y=Math.min(0,y),b=Math.min(0,b),w=Math.max(u.width,w),x=Math.max(u.height,x))}function Z(){if(j.length){var e=j.pop();A.push(e),K(),re()}}function ee(){if(A.length){var e=A.pop();j.push(e),K(),re()}}function te(e){new To.a({$el:$(e.target).closest(".button"),update:function(e){H=e||"",re()}})}function ie(e){new To.a({$el:$(e.target).closest(".button"),update:function(e){z=e||"",re()}})}function oe(e){var t=$(e.target).offset(),i=$.backplane({close:n}),o=$('<div style="position:absolute;width:48px">').css({left:t.left,top:t.top+32}).appendTo(i);function n(){i.close(),re()}$('<div style="width:48px;height:48px;background-color:rgb(0,0,0)"><div style="margin:0 8px;border-bottom:solid 1px #fff;width:32px;height:16px"></div></div>').click((function(){V=1,n()})).appendTo(o),$('<div style="width:48px;height:48px;background-color:rgb(0,0,0)"><div style="margin:0 8px;border-bottom:solid 2px #fff;width:32px;height:16px"></div></div>').click((function(){V=2,n()})).appendTo(o),$('<div style="width:48px;height:48px;background-color:rgb(0,0,0)"><div style="margin:0 8px;border-bottom:solid 4px #fff;width:32px;height:16px"></div></div>').click((function(){V=4,n()})).appendTo(o),$('<div style="width:48px;height:48px;background-color:rgb(0,0,0)"><div style="margin:0 8px;border-bottom:solid 8px #fff;width:32px;height:16px"></div></div>').click((function(){V=8,n()})).appendTo(o),$('<div style="width:48px;height:48px;background-color:rgb(0,0,0)"><div style="margin:0 8px;border-bottom:solid 16px #fff;width:32px;height:16px"></div></div>').click((function(){V=16,n()})).appendTo(o)}function ne(){U="draw",re()}function ae(){U="rect",re()}function se(){U="circle",re()}function re(){switch(d[0].style.borderColor=H||"#fff",d.text(H?"":"X"),h[0].style.backgroundColor=z,h.text(z?"":"X"),p[0].style.borderBottomWidth=V+"px",p[0].style.height=16-Math.floor(V/2)+"px",r.removeClass("selected"),l.removeClass("selected"),c.removeClass("selected"),U){case"draw":r.addClass("selected");break;case"rect":l.addClass("selected");break;case"circle":c.addClass("selected")}a[0].style.opacity=j.length?1:.5,s[0].style.opacity=A.length?1:.5}function le(){f=n.width(),m=n.height();var e=n.offset();g=e.left,v=e.top,W.setAttribute("width",f),W.setAttribute("height",m),K()}function ce(){u=void 0,j=[],B.clearRect(0,0,f,m),K()}function de(){if(!j.length)return he();var t=w-y,i=x-b,o=document.createElement("canvas");o.width=t,o.height=i;var n=o.getContext("2d");n.setTransform(1,0,0,1,-y,-b),u&&n.drawImage(u,0,0);for(var a=0;a<j.length;a++)j[a].draw(n);var s=o.toDataURL("image/png");pe(),e.save(s)}function he(){pe()}function pe(){window.removeEventListener("resize",le),t.close()}le(),re(),window.addEventListener("resize",le),W.addEventListener(TOUCH?EVENT_touchstart:"mousedown",X),W.addEventListener(TOUCH?EVENT_touchmove:"mousemove",G),W.addEventListener(TOUCH?EVENT_touchend:"mouseup",J)}function ko(){this.strokeStyle="#000",this.lineWidth=1,this.fillStyle=null,this.path=[],this.x0=0,this.y0=0,this.x1=0,this.y1=0}function $o(e,t){this.x0=e,this.y0=t,this.x1=e,this.y1=t,this.strokeStyle="#000",this.lineWidth=1,this.fillStyle=null}function So(e,t){this.x0=e,this.y0=t,this.x1=e,this.y1=t,this.strokeStyle="#000",this.lineWidth=1,this.fillStyle=null}function _o(e,t,i,o,n){var a=.5522848,s=o/2*a,r=n/2*a,l=t+o,c=i+n,d=t+o/2,h=i+n/2;e.beginPath(),e.moveTo(t,h),e.bezierCurveTo(t,h-r,d-s,i,d,i),e.bezierCurveTo(d+s,i,l,h-r,l,h),e.bezierCurveTo(l,h+r,d+s,c,d,c),e.bezierCurveTo(d-s,c,t,h+r,t,h)}function Eo(e){var t=$.backplane({closable:!TOUCH,close:E});window.addEventListener("resize",T,!1);var i=$('<div class="nx-menu-popup" style="position:absolute;padding:0">').appendTo(t),o=$('<div style="position:relative;top:0;left:0;width:100%;height:100%">').appendTo(i),n=$('<div style="position:absolute;left:0;bottom:0;right:0;height:48px;background-color:#eee;padding:8px;box-sizing:border-box;-webkit-box-sizing:border-box;display:flex;display:-webkit-flex">').appendTo(o);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(n).click(S),$('<div class="nx-hspace-small">').appendTo(n),$('<div class="nx-button-text grey">').text(locale.clear).appendTo(n).click(k),$('<div class="nx-hspace-flex">').appendTo(n),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(n).click(_);var a,s,r,l,c=this.$canvas=$('<canvas style="position:absolute;left:0;top:0;background-color:#fff">').appendTo(o);T();var d=c[0],h=d.getContext("2d");d.addEventListener(TOUCH?EVENT_touchstart:"mousedown",m,!1);var p=null,u=null,f=[];function m(e){TOUCH&&1!==e.touches.length||(p||(p="draw",y(TOUCH?e.touches[0].pageX:e.pageX,TOUCH?e.touches[0].pageY:e.pageY),TOUCH?(EVENT_target(e).addEventListener(EVENT_touchmove,g,!1),EVENT_target(e).addEventListener(EVENT_touchend,v,!1)):(window.addEventListener("mousemove",g,!1),window.addEventListener("mouseup",v,!1))))}function g(e){TOUCH&&1!==e.touches.length||"draw"===p&&(b(TOUCH?e.touches[0].pageX:e.pageX,TOUCH?e.touches[0].pageY:e.pageY),x(h,a,s,1,0,0))}function v(e){TOUCH&&0!==e.touches.length||"draw"===p&&(w(),x(h,a,s,1,0,0),p=null,TOUCH?(EVENT_target(e).removeEventListener(EVENT_touchmove,g,!1),EVENT_target(e).removeEventListener(EVENT_touchend,v,!1)):(window.removeEventListener(TOUCH?EVENT_touchmove:"mousemove",g,!1),window.removeEventListener(TOUCH?EVENT_touchend:"mouseup",v,!1)))}function y(e,t){u=[],f.push(u),b(e,t)}function b(e,t){u.push([e-r,t-l])}function w(){u=null}function x(e,t,i,o,n,a){e.strokeStyle="#000",e.lineWidth=3,e.clearRect(0,0,t,i);for(var s=0;s<f.length;s++){var r=f[s],l=r[0];if(e.beginPath(),e.moveTo(n+l[0]*o,a+l[1]*o),1===r.length)e.lineTo(n+l[0]*o,a+l[1]*o);else for(var c=1;c<r.length;c++){var d=r[c];e.lineTo(n+d[0]*o,a+d[1]*o)}e.stroke()}}function T(){var e=window.getWidth(),t=window.getHeight();a=Math.min(800,e),s=Math.min(448,t),r=Math.floor((e-a)/2),l=Math.floor((t-s)/2),i.css({left:r,top:l,width:a,height:s}),c.attr("width",a).attr("height",s-48)}function C(){for(var e=300,t=150,i=$('<canvas width="'+e+'" height="'+t+'" style="position:absolute;left:0;top:0;border:solid 1px red">'),o=i[0],n=o.getContext("2d"),a=1/0,s=1/0,r=-1/0,l=-1/0,c=0;c<f.length;c++)for(var d=f[c],h=0;h<d.length;h++){var p=d[h],u=p[0],m=p[1];a=Math.min(a,u),s=Math.min(s,m),r=Math.max(r,u),l=Math.max(l,m)}var g=(r+=4)-(a-=4),v=(l+=4)-(s-=4),y=e/g,b=t/v,w=Math.min(1,y,b);x(n,e,t,w,(e-g*w)/2-w*a,(t-v*w)/2-w*s);var T=o.toDataURL("image/png");return i.remove(),T}function k(){f=[],x(h,a,s)}function S(){t.close(),e.cancel&&e.cancel()}function _(){var i=C();t.close(),e.okay&&e.okay(i)}function E(){window.removeEventListener("resize",T,!1)}}function Do(e,t,i){this.container=e,this.field=i,this.visible=!0,this.error=null,this.currentFile=void 0,this.el=$('<div class="component">').data("component",this).attr("title",i.tooltip||"").addClass(Object(bo.d)(i)),this.updateElementWidth(),this.el.appendTo(t.el),"left"===i.labelPosition&&this.el.addClass("label-left"),this.label=$("<label>").text(this.field.caption||locale.unnamed).css("display","placeholder"===i.labelPosition||"none"===i.labelPosition?"none":"").appendTo(this.el),this.removeButton=$('<div class="button icon-big i-32-24 i-grey i-setting-menu">').appendTo($('<div style="position:relative;height:0;text-align:right;z-index:1">').appendTo(this.el)).touch($.proxy(this.popupMenu,this));var o=this.el.width();this.content=$('<div class="editor-file-file" style="text-align:center;display:table-cell;vertical-align:middle;width:'+o+"px;max-width:"+o+'px">').css({height:68*i.height+32,"background-size":i.bgSize||""}).appendTo(this.el).on("contextmenu",$.proxy(this.popupMenu,this)).touch($.proxy(this.fileClicked,this)),"signature"!==i.fileHandling&&this.registerDropListeners()}function No(e){var t=this;this.id="files",this.loading=!1,this.container=e,this.popupMenu=$.proxy(this.popupMenu,this),this.selectedIconClass="tab-icon-container i-18 i-white i-attachment",this.unselectedIconClass="tab-icon-container i-18 i-light-grey i-attachment",this.elTab=$('<div class="tab tab-icon">').attr("title",locale.files).append($(`<div class="${this.unselectedIconClass}"></div>`)).touch($.proxy((function(){t.container.selectTab(t.id)}),this)),this.tabSelectedIndicator=$('<div class="tab-selected-indicator">'),this.el=$('<div class="files">').hide().appendTo(e.containerEl||e.el),this.el[0].addEventListener("dragover",(function(e){return t.el[0].style.backgroundColor="#ddd",e.preventDefault(),!1}),!1),this.el[0].addEventListener("dragleave",(function(e){return t.el[0].style.backgroundColor="",e.preventDefault(),!1}),!1),this.el[0].addEventListener("drop",(function(e){t.el[0].style.backgroundColor="";var i=t.nid;database.typeOf(i);if(!t.isWritable())return e.preventDefault(),$.alert(locale.errorNotAuthorized),!1;var o=e.target.files||e.dataTransfer&&e.dataTransfer.files;return o&&o.length&&setTimeout(n,0,0),e.preventDefault(),!1;function n(e){if(e>=o.length)return a();var i=o[e];t.importFile(i,(function(t){setTimeout(n,0,e+1)}))}function a(){t.updateUI()}}),!1),this.filesEl=$("<div>").appendTo(this.el)}function Io(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component head">').data("component",this).attr("title",i.tooltip||""),this.updateElementWidth(),this.el.appendTo(t.el),this.label=$("<label>").text(i.caption).appendTo(this.el),this.updateStyle()}function Oo(e){const t=this;this.id="history",this.container=e,this.selectedIconClass="tab-icon-container i-18 i-white i-info",this.unselectedIconClass="tab-icon-container i-18 i-light-grey i-info",this.elTab=$('<div class="tab tab-icon">').attr("title",locale.history).append($(`<div class="${this.unselectedIconClass}"></div>`)).touch($.proxy((function(){t.container.selectTab(t.id)}),this)),this.tabSelectedIndicator=$('<div class="tab-selected-indicator">'),this.el=$('<div class="history">').hide().appendTo(e.containerEl||e.el);$('<div class="editor">').appendTo(this.el);this.historyDiv=$('<div class="history">').appendTo(this.el)}function Mo(e){var t=e.getHours(),i=e.getMinutes(),o=e.getSeconds();return(t<10?"0":"")+t+":"+(i<10?"0":"")+i+":"+(o<10?"0":"")+o}ko.prototype.draw=function(e){var t=this.path;e.beginPath();for(var i=0;i<t.length;i++){var o=t[i];switch(o[0]){case"M":e.moveTo(o[1],o[2]);break;case"L":e.lineTo(o[1],o[2])}}this.fillStyle&&(e.closePath(),e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&(e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.stroke())},ko.prototype.moveTo=function(e,t){this.path.push(["M",e,t]),this.updateBounds()},ko.prototype.lineTo=function(e,t){this.path.push(["L",e,t]),this.updateBounds()},ko.prototype.isEmpty=function(){return this.path.length<2},ko.prototype.updateBounds=function(){var e=this.path;if(e.length){for(var t=1/0,i=-1/0,o=1/0,n=-1/0,a=0;a<e.length;a++){var s=e[a],r=s[1],l=s[2];r<t&&(t=r),r>i&&(i=r),l<o&&(o=l),l>n&&(n=l)}this.x0=t,this.x1=i,this.y0=o,this.y1=n}},$o.prototype.draw=function(e){e.beginPath(),e.moveTo(this.x0,this.y0),e.lineTo(this.x1,this.y0),e.lineTo(this.x1,this.y1),e.lineTo(this.x0,this.y1),e.closePath(),this.fillStyle&&(e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&(e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.stroke())},$o.prototype.isEmpty=function(){return Math.abs(this.x0-this.x1)<2&&Math.abs(this.y0-this.y1)<2},$o.prototype.updateBounds=function(){},So.prototype.draw=function(e){_o(e,this.x0,this.y0,this.x1-this.x0,this.y1-this.y0),this.fillStyle&&(e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&(e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.stroke())},So.prototype.isEmpty=function(){return Math.abs(this.x0-this.x1)<2&&Math.abs(this.y0-this.y1)<2},So.prototype.updateBounds=function(){},Object.assign(Do.prototype,ao.a.prototype),Do.prototype.destroy=function(){this.el.remove()},Do.prototype.setWidth=function(e,t){ao.a.prototype.setWidth.call(this,e,t);var i=this.el.width();this.content.css({width:i,"max-width":i})},Do.prototype.resize=function(){var e=this.field,t=this.el.width();this.content.css({width:t,"max-width":t,height:68*e.height+32})},Do.prototype.updateStructure=function(){var e=this.field;this.el.attr("title",e.tooltip||""),this.updateElementWidth();var t=this.el.width();this.content.css({width:t,"max-width":t,height:68*e.height+32,"background-size":e.bgSize||""}),this.label.text(e.caption||locale.unnamed).css("display","placeholder"===e.labelPosition||"none"===e.labelPosition?"none":""),this.el.toggleClass("label-left","left"===e.labelPosition)},Do.prototype.validate=function(e){var t=this.field.validate(e);return t?(this.setError(t),!1):(this.setError(void 0),!0)},Do.prototype.setError=function(e){e?(this.error||(this.error=$('<div class="editor-error">').appendTo(this.el)),this.error.html('<div class="editor-error-text"><div class="editor-error-icon i-red i-16-12 i-warning"></div>'+htmlEscape(e)+"</div>"),this.el.addClass("error")):(this.error&&this.error.remove(),this.error=void 0,this.el.removeClass("error"))},Do.prototype.bind=function(){this.nodeChanged()},Do.prototype.nodeChanged=function(){this.updateIsWritable(),this.updateVisibility();var e=this.container.nid;if(e){var t=database.loadNodeSync(e);if(t){var i=t[this.field.id],o=e+"/"+i;if(o!==this.currentFile)if(this.currentFile=o,i){if(util.RE_IMAGE_FILE_EXT.test(i)){var n=database.thumb2URL2(e,i);this.content[0].style.backgroundImage=n?'url("'+n+'")':"",this.content[0].innerHTML=""}else this.content[0].style.backgroundImage="",this.content[0].innerHTML='<div class="file-type">'+htmlEscape(i)+"</div>";this.removeButton.css("display","")}else this.content[0].style.backgroundImage="",this.content[0].innerHTML="",this.removeButton.css("display","none");this.validate(i)}else this.setError()}else this.setError()},Do.prototype.fileClicked=function(e){var t="",i="",o=this.field;o&&(i=this.field.id);var a=this.container.nid;if(a){var r=database.loadNodeSync(a);if(r){var l=r[this.field.id],c=r[i];if(c&&(t=database.fileURL2(a,c)),l)if("sketch"===o.fileHandling)this.isWritable()?this.openPaint():database.previewFile(a,l);else if(/\.(png|jpg|jpeg|gif)$/i.test(c)||(/\.(png|jpg|jpeg|gif)$/i.test(c),0)){var d=$("<div>").appendTo(document.body);n.render(s.createElement(xo.a,{images:[{file:t,name:c}],initialImageIndex:0,closeLightBox:()=>{n.unmountComponentAtNode(d[0]),d.remove()},downloadUrl:h}),d[0])}else/\.(pdf)$/i.test(c),h();else{if(!this.isWritable())return;"sketch"===o.fileHandling?this.openPaint():"signature"===o.fileHandling?this.createSignature():this.chooseFileSystem()}}}function h(){database.previewFile(a,l)}},Do.prototype.chooseFileMenu=function(e){var t=this,i=$(e.target),o=$.backplane({}),n=$('<div class="nx-menu-popup">').appendTo(o);$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.takePhoto)).appendTo(n).touch(l),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.photoLibrary)).appendTo(n).touch(c),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.icloudDrive)).appendTo(n).touch(d),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.dropbox)).appendTo(n).touch(h);var a=n.outerWidth(),s=n.outerHeight(),r=i.offset();function l(){o.close(),t.takePhoto(e)}function c(){o.close(),t.choosePhotoFromLibrary(e)}function d(){o.close(),t.chooseICloud()}function h(){o.close(),t.chooseDropbox()}r.left+=i.width()-32,r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)},Do.prototype.takePhoto=function(e){var t=this;NinoxDocumentInteraction.choosePhotoFromCamera((function(i,o,n){if(i)return $.alert(i);o?t.photoTaken(e):n&&t.videoTaken(n)}))},Do.prototype.choosePhotoFromLibrary=function(e){var t=this;NinoxDocumentInteraction.choosePhotoFromLibrary((function(i,o,n){if(i)return $.alert(i);o?t.photoTaken(e):n&&t.videoTaken(n)}))},Do.prototype.photoTaken=function(e){var t,i=this,o=$(e.target);switch(this.field.fileHandling){case"image-s":return l("S");case"image-m":return l("M");case"image-l":return l("L");case"image-o":return l("O")}t=$.backplane({});var n=$('<div class="nx-menu-popup">').appendTo(t);$('<div class="nx-menu-head">').text(locale.imageSize).appendTo(n),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeSmall)).appendTo(n).touch((function(){l("S")})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeMedium)).appendTo(n).touch((function(){l("M")})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeLarge)).appendTo(n).touch((function(){l("L")})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeOriginal)).appendTo(n).touch((function(){l("O")}));var a=n.outerWidth(),s=n.outerHeight(),r=o.offset();function l(e){t&&t.close(),i.savePhoto(e)}r.left+=o.width()-32,r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)},Do.prototype.videoTaken=function(e){var t=this;if(!t.isWritable())return $.alert(locale.errorNotAuthorized);var i=this.container.nid,o=this.field.id;$.loading(!0),database.importFile(i,e,(function(e,n){e?($.loading(!1),$.alert(e)):(t.currentFile=void 0,database.update(i,o,n,(function(e){$.loading(!1),e&&$.alert(e)})))}))},Do.prototype.savePhoto=function(e){var t=this;if(!t.isWritable())return $.alert(locale.errorNotAuthorized);var i=this.container.nid,o=this.field.id;$.loading(!0),NinoxDocumentInteraction.convertChoosenPhoto(e,(function(e,n){if(e)return $.loading(!1),$.alert(e);Object(c.h)(i,locale.photo+" "+util.formatISODateTimeFileName(new Date),(function(e,a){var s=a+=".jpg";database.importData(n,i,s,(function(e){if(e)return $.loading(!1),$.alert(e);t.currentFile=void 0,database.update(i,o,s,(function(e){$.loading(!1),e&&$.alert(e)}))}))}))}))},Do.prototype.chooseICloud=function(){NinoxDocumentInteraction.chooseFileFromICloud($.proxy(this.urlChoosen,this))},Do.prototype.chooseFromDevice=function(){this.isWritable()&&($.loading(!0),setTimeout(()=>{NinoxDocumentInteraction.chooseFileFromDevice((e,t)=>{$.loading(!1),this.urlChoosen(e,t)})},0))},Do.prototype.chooseDropbox=function(){var e=this;$.loading(!0),setTimeout((function(){NinoxDocumentInteraction.chooseFile((function(t,i){$.loading(!1),e.urlChoosen(t,i)}))}),0)},Do.prototype.chooseFileSystem=function(){NinoxDocumentInteraction.chooseFile($.proxy(this.urlChoosen,this))},Do.prototype.urlChoosen=function(e,t){var i=this;if(!i.isWritable())return $.alert(locale.errorNotAuthorized);this.container.nid,this.field.id;if(e)return $.alert(e);t&&($.loading(!0),i.importFile(t,(function(e,t){$.loading(!1),e&&$.alert(e)})))},Do.prototype.importFile=function(e,t){var i=this;if(!i.isWritable())return $.alert(locale.errorNotAuthorized);var o=this.container.nid,n=this.field.id;function a(t){if("object"!=typeof e)return t();var i=/^(.*)\.([a-z0-9]+)/i.exec(e.name);if(!i)return t();var n=i[1],a=i[2];Object(c.h)(o,n,(function(i,o){e.renameTo=o+"."+a,t()}))}a((function(){database.importFile(o,e,(function(e,a){if(e)return t(e);i.currentFile=void 0,database.update(o,n,a,(function(e){t(e)}))}))}))},Do.prototype.removeFile=function(){var e=this;if(!e.isWritable())return $.alert(locale.errorNotAuthorized);var t=this.container.nid;if(t){var i=database.loadNodeSync(t);if(i){var o=i[this.field.id];o&&$.dialog({closable:!0,caption:locale.removeFile,message:locale.confirmRemoveFile,buttons:[{color:"red",caption:locale.removeFile,callback:function(){database.removeFile(t,o,(function(i){i&&$.alert(i),e.currentFile=void 0,database.update(t,e.field.id,null,(function(e){if(e)return $.alert(e)}))}))}}]})}}},Do.prototype.popupMenu=function(e){var t=this,i=this.field,o=i.id,n=this.container.nid;if(n){var a=database.loadNodeSync(n);if(a){var s=a[o];if(s){var r=$(e.target),l=$.backplane({}),c=$('<div class="nx-menu-popup">').appendTo(l);"signature"!==i.fileHandling&&$('<div class="nx-menu-head file-name">').text(s).appendTo(c),"signature"!==i.fileHandling&&($('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.saveAs)).appendTo(c).touch(u),database.authorizationExport&&database.supports.sharing&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.shareFile+"...")).appendTo(c).touch(g)),t.isWritable()&&("signature"!==i.fileHandling&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.rename)).appendTo(c).touch(f),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.remove)).appendTo(c).touch(m));var d,h=c.outerWidth(),p=c.outerHeight();return(d=r.is(".i-setting-menu")?r.offset():{left:e.clientX,top:e.clientY}).left+h>window.getWidth()&&(d.left=window.getWidth()-h),d.top+p>window.getHeight()&&(d.top=window.getHeight()-p),c.offset(d),!1}}}function u(){l.close(),t.saveFileFileSystem()}function f(){l.close(),t.renameFile()}function m(){l.close(),t.removeFile()}function g(){l.close(),t.shareFile()}},Do.prototype.shareFile=function(){var e=this.field.id,t=this.container.nid;if(t){var i=database.loadNodeSync(t);if(i){var o=i[e];o&&database.loadSharedFile(t,o,(function(e,i){if(e)return $.alert(e);var n=$.popdown({head:locale.shareFile,buttons:[{caption:locale.share,cls:"grey",click:r},"-",{caption:locale.close,cls:"blue",click:d}]}),a=$.field({val:i.url,$container:n.$content,touch:function(){window.open(i.url)}});function s(){a.val(i.url||""),a.$el.css("display",i.url?"":"none"),i.url?$(n.$buttons.children()[0]).removeClass("grey").addClass("red").text("Unshare"):$(n.$buttons.children()[0]).removeClass("red").addClass("blue").text(locale.share)}function r(){i.url?c():l()}function l(){database.shareFile(t,o,(function(e,t){if(e)return $.alert(e);i=t,s()}))}function c(){database.unshareFile(t,o,(function(e){if(e)return $.alert(e);i={},s()}))}function d(){n.close()}s()}))}}},Do.prototype.renameFile=function(){var e=this;if(!e.isWritable())return $.alert(locale.errorNotAuthorized);var t=this.field.id,i=this.container.nid;if(i){var o=database.loadNodeSync(i);if(o){var n=o[t];if(n){var a=$.popdown({head:locale.rename,buttons:["-","cancel"," ",{cls:"blue",caption:locale.rename,click:l}]}),s=$('<div class="component editor editor-string" style="width:100%">').appendTo(a.$content);$("<label>").text(locale.name).appendTo(s);var r=$('<input type="text">').val(n).appendTo($('<div class="stringeditor">').appendTo(s)).keydown((function(e){13===e.which&&l(),27===e.which&&a.close()}))}}}function l(){var o=r.val();return n===o?a.close():util.isValidFileName(o)?($.loading(!0),void setTimeout((function(){database.renameFile(i,n,o,(function(n){if(n)return $.loading(!1),$.alert(locale.couldntRenameFile);e.currentFile=void 0,database.update(i,t,o,(function(e){$.loading(!1),e&&$.alert(e),a.close()}))}))}),0)):$.alert(locale.invalidFileName)}},Do.prototype.saveFileICloud=function(){var e=this.field.id,t=this.container.nid;if(t){var i=database.loadNodeSync(t);if(i){var o=i[e];if(o){var n=database.downloadURL(t,o);NinoxDocumentInteraction.saveFileOnICloud(n,(function(e){e&&$.alert(e)}))}}}},Do.prototype.saveFileFileSystem=function(e){var t=this.field.id,i=this.container.nid;if(i){var o=database.loadNodeSync(i);if(o){var n=o[t];if(n){var a=database.downloadURL(i,n);NinoxDocumentInteraction.saveFile(n,"",(function(e,t){if(e)return $.alert(e);t&&localFileSystem.copyURL(a,t).catch(e=>$.alert(e))}))}}}},Do.prototype.openFileIn=function(e){var t=this.field.id,i=this.container.nid;if(i){var o=database.loadNodeSync(i);if(o){var n=o[t];if(n){var a=database.downloadURL(i,n);NinoxDocumentInteraction.showFileOptions(a,e.clientX,e.clientY,(function(){}))}}}},Do.prototype.isHeightAdjustable=function(){return!0},Do.prototype.setHeight=function(e){var t=this.field,i=t.height,o=Math.max(1,Math.round((e-32)/68));o!==i&&(this.content.css({height:68*o+32}),t.height=o)},Do.prototype.registerDropListeners=function(){var e=this;e.content[0].addEventListener("dragover",(function(t){return e.content[0].style.backgroundColor="#ddd",t.preventDefault(),!1}),!1),e.content[0].addEventListener("dragleave",(function(t){return e.content[0].style.backgroundColor="",t.preventDefault(),!1}),!1),e.content[0].addEventListener("drop",(function(t){if(e.content[0].style.backgroundColor="",!e.isWritable())return t.preventDefault(),$.alert(locale.errorNotAuthorized),!1;var i=t.target.files||t.dataTransfer&&t.dataTransfer.files;if(i&&1===i.length){var o=i[0],n=e.container.nid,a=e.field.id,s=database.loadNodeSync(n);if(s){var r=s[a];return e.currentFile=void 0,$.loading(!0),r?l():c(),t.preventDefault(),!1}}function l(){database.removeFile(n,r,(function(e){if(e)return $.loading(!1),$.alert(e);c()}))}function c(){e.importFile(o,(function(e){$.loading(!1),e&&$.alert(e)}))}}),!1)},Do.prototype.createSignature=function(){var e=this,t=e.container.nid;if(t&&database.loadNodeSync(t)){var i=this.field.id;new Eo({okay:function(o){$.loading(!0),Object(c.h)(t,locale.signature,(function(n,a){a+=".png",database.saveFileDataURL(t,o,a,(function(o){if(o)return $.loading(!1),$.alert(o);e.currentFile=void 0,database.update(t,i,a,(function(e){$.loading(!1),e&&$.alert(e)}))}))}))}})}},Do.prototype.openPaint=function(){var e=this,t=this.field,i=this.container.nid;if(i){var o=database.loadNodeSync(i);if(o){var n=void 0,a=o[t.id];if(a){var s=database.fileURL2(i,a);(n=new Image).crossOrigin="anonymous",n.addEventListener("load",r,!1),n.src=s}else l()}}function r(){l()}function l(){new Co({img:n,save:function(t){$.loading(!0),c(t,(function(t){$.loading(!1),t&&$.alert(t),e.currentFile=void 0,e.nodeChanged()}))}})}function c(e,t){a?d(e,t):h(e,t)}function d(e,t){database.saveFileDataURL(i,e,a,t)}function h(e,n){database.loadFiles(i,(function(a,s){if(a)return n(a);var r={};s&&k.each(s,(function(e){r[e.name]=!0}));for(var l=1,c=locale.drawing+" "+l+".png";r[c];)l++,c=locale.drawing+" "+l+".png";database.saveFileDataURL(i,e,c,(function(e){if(e)return n(e);database.update(o._id,t.id,c,n)}))}))}},No.prototype.isWritable=function(){var e=this.nid;return!!e&&(!!database.typeOf(e)&&this.container.isWritable())},No.prototype.register=function(){},No.prototype.unregister=function(){},No.prototype.bind=function(e){this.unregister(),this.nid=e?e._id:void 0,this.register(),this.updateUI()},No.prototype.destroy=function(){this.unregister(),this.el.remove(),this.elTab.remove()},No.prototype.hide=function(e){this.container.currentTab===this&&(this.container.currentTab=void 0,this.el.hide(),this.tabSelectedIndicator.detach(),this.elTab.removeClass("selected"),this.elTab[0].firstElementChild.className=this.unselectedIconClass,e&&e())},No.prototype.show=function(){this.container.currentTab!==this&&(this.container.currentTab&&this.container.currentTab.hide(),this.container.currentTab=this,this.el.show(),this.elTab.addClass("selected"),this.elTab[0].firstElementChild.className=this.selectedIconClass,this.tabSelectedIndicator.appendTo(this.elTab),this.updateUI())},No.prototype.focus=function(){},No.prototype.chooseFileClicked=function(e){this.isWritable()&&this.chooseFileSystem()},No.prototype.chooseFileMenu=function(e){var t=this;if(this.isWritable()){var i=$(e.target),o=$.backplane({}),n=$('<div class="nx-menu-popup">').appendTo(o);$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.takePhoto)).appendTo(n).touch(l),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.photoLibrary)).appendTo(n).touch(c),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.icloudDrive)).appendTo(n).touch(d),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.dropbox)).appendTo(n).touch(h);var a=n.outerWidth(),s=n.outerHeight(),r=i.offset();r.left+=i.width()-32,r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)}function l(){o.close(),t.takePhoto(e)}function c(){o.close(),t.choosePhotoFromLibrary(e)}function d(){o.close(),t.chooseICloud()}function h(){o.close(),t.chooseDropbox()}},No.prototype.takePhoto=function(e){var t=this;NinoxDocumentInteraction.choosePhotoFromCamera((function(i,o,n){if(i)return $.alert(i);o?t.photoTaken(e):n&&t.videoTaken(n)}))},No.prototype.choosePhotoFromLibrary=function(e){var t=this;NinoxDocumentInteraction.choosePhotoFromLibrary((function(i,o,n){if(i)return $.alert(i);o?t.photoTaken(e):n&&t.videoTaken(n)}))},No.prototype.photoTaken=function(e){var t=this,i=$(e.target),o=$.backplane({}),n=$('<div class="nx-menu-popup">').appendTo(o);$('<div class="nx-menu-head">').text(locale.imageSize).appendTo(n),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeSmall)).appendTo(n).touch((function(){l("S")})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeMedium)).appendTo(n).touch((function(){l("M")})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeLarge)).appendTo(n).touch((function(){l("L")})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.imageSizeOriginal)).appendTo(n).touch((function(){l("O")}));var a=n.outerWidth(),s=n.outerHeight(),r=i.offset();function l(e){o.close(),t.savePhoto(e)}r.left+=i.width()-32,r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)},No.prototype.videoTaken=function(e){var t=this,i=this.nid;$.loading(!0),database.importFile(i,e,(function(e,i){$.loading(!1),e&&$.alert(e),t.updateUI()}))},No.prototype.savePhoto=function(e){if(!this.isWritable())return $.alert(locale.errorNotAuthorized);var t=this,i=this.nid;$.loading(!0),NinoxDocumentInteraction.convertChoosenPhoto(e,(function(e,o){if(e)return $.loading(!1),$.alert(e);Object(c.h)(i,locale.photo+" "+util.formatISODateTimeFileName(new Date),(function(e,n){var a=n+=".jpg";database.importData(o,i,a,(function(e){$.loading(!1),e&&$.alert(e),t.updateUI()}))}))}))},No.prototype.chooseFromDevice=function(){this.isWritable()&&($.loading(!0),setTimeout(()=>{NinoxDocumentInteraction.chooseFileFromDevice((e,t)=>{$.loading(!1),this.urlChoosen(e,t)})},0))},No.prototype.chooseICloud=function(){this.isWritable()&&NinoxDocumentInteraction.chooseFileFromICloud($.proxy(this.urlChoosen,this))},No.prototype.chooseDropbox=function(){if(this.isWritable()){var e=this;$.loading(!0),setTimeout((function(){NinoxDocumentInteraction.chooseFile((function(t,i){$.loading(!1),e.urlChoosen(t,i)}))}),0)}},No.prototype.chooseFileSystem=function(){this.isWritable()&&NinoxDocumentInteraction.chooseFile($.proxy(this.urlChoosen,this))},No.prototype.urlChoosen=function(e,t){if(!this.isWritable())return $.alert(locale.errorNotAuthorized);var i=this;this.nid;if(e)return $.alert(e);t&&($.loading(!0),i.importFile(t,(function(e){$.loading(!1),e&&$.alert(e),i.updateUI()})))},No.prototype.importFile=function(e,t){if(!this.isWritable())return $.alert(locale.errorNotAuthorized);var i=this.nid;function o(t){if("object"!=typeof e)return t();var o=/^(.*)\.([a-z0-9]+)/i.exec(e.name);if(!o)return t();var n=o[1],a=o[2];Object(c.h)(i,n,(function(i,o){e.renameTo=o+"."+a,t()}))}o((function(){database.importFile(i,e,(function(e,i){t(e)}))}))},No.prototype.updateUI=async function(){var e=this,t=this.nid;function i(){e.loading=!0,database.loadFiles(t,(function(o,n){if(t!==e.nid)t=e.nid,setTimeout(i,200);else{if(e.loading=!1,o)return $.alert(o);var a=database.typeOf(t);if(!a)return;var s=database.loadNodeSync(t);if(!s)return;var r={},l=a.fields;for(var c in l){if(l.hasOwnProperty(c))if("file"===l[c].base){var d=s[c];d&&(r[d]=!0)}}let i=[],p=[];for(var h=0;h<n.length;h++)r[(d=n[h]).name]||(i.push(d),/\.(png|jpg|jpeg|gif)$/i.test(d.name)&&p.push(d));e.renderFile(i,p),e.renderFileAddButton()}}))}database.countFiles&&await database.countFiles(t)?this.elTab.addClass("has-content"):this.elTab.removeClass("has-content"),this.container.currentTab===this&&(this.loading||(this.filesEl.empty(),t&&i()))},No.prototype.renderFileAddButton=function(){$('<div class="file-add"><div class="icon i-40-24 i-light-grey i-setting-add-file"></div><div class="label">'+htmlEscape(locale.chooseFile)+"</div></div>").appendTo(this.filesEl).click($.proxy(this.chooseFileClicked,this))},No.prototype.renderFile=function(e,t){for(var i=this,o=0;o<e.length;o++){n(e[o])}function n(e){var o,n,a=i.container.nid,s=e.name,r=$('<div class="file">').data("file",e).appendTo(i.filesEl).on("contextmenu",i.popupMenu).touch((function(){/\.(png|jpg|jpeg|gif)$/i.test(e.name)||(/\.(png|jpg|jpeg|gif)$/i.test(e.name),0)?i.showGallery(e,t):(/\.(pdf)$/i.test(e.name),database.previewFile(a,s))})),l=$('<div class="file-image">').appendTo(r);if($('<div class="file-label">').text(e.name).appendTo(r),$('<div class="button icon-big i-32-24 i-grey i-setting-menu">').appendTo(r).click(i.popupMenu),util.RE_IMAGE_FILE_EXT.test(s)){var c=database.thumb2URL2(a,s);o=$('<img style="position:relative">').appendTo(l),(n=new Image).src=c,n.complete?p():n.onload=p}else{var d=/\.(\w+)$/.exec(s),h=d?d[1]:"?";l.html('<div class="file-type">'+htmlEscape(h)+"</div>")}function p(){var e,t,i,a=150,s=150,r=n.naturalWidth,l=n.naturalHeight,c=a/r,d=s/l;c<d?(e=a,i=(s-l*c)/2,t=0):(i=0,t=(a-(e=r*d))/2);var h=o[0];h.style.left=t+"px",h.style.top=i+"px",h.style.width=e+"px",h.src=n.src}}},No.prototype.showGallery=function(e,t){var i=this.container.nid,o=[];var a=e=>{database.previewFile(i,e.name)};for(var r of t)o.push({file:database.fileURL2(i,r.name),name:r.name});var l=database.fileURL2(i,e.name),c=o.findIndex(e=>e.file===l),d=$("<div>").appendTo(document.body);n.render(s.createElement(xo.a,{images:o,initialImageIndex:c,closeLightBox:()=>{n.unmountComponentAtNode(d[0]),d.remove()},downloadUrl:a}),d[0])},No.prototype.popupMenu=function(e){var t=this,i=$(e.target),o=i.closest(".file").data("file");if(o){var n=$.backplane({}),a=$('<div class="nx-menu-popup">').appendTo(n);$('<div class="nx-menu-head file-name">').text(o.name).appendTo(a),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.saveAs)).appendTo(a).touch(c),this.isWritable()&&($('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.rename)).appendTo(a).touch(d),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.remove)).appendTo(a).touch(h));var s=a.outerWidth(),r=a.outerHeight(),l=i.offset();return l.left+=i.width()-32,l.left+s>window.getWidth()&&(l.left=window.getWidth()-s),l.top+r>window.getHeight()&&(l.top=window.getHeight()-r),a.offset(l),!1}function c(){n.close(),t.saveFileFileSystem(o)}function d(){n.close(),t.renameFile(o,e)}function h(){n.close(),t.removeFile(o)}},No.prototype.removeFile=function(e){if(!this.isWritable())return $.alert(locale.errorNotAuthorized);var t=this,i=this.container.nid;$.dialog({closable:!0,caption:locale.removeFile,message:locale.confirmRemoveFile,buttons:[{color:"red",caption:locale.removeFile,callback:function(){database.removeFile(i,e.name,(function(e){e&&$.alert(e),t.updateUI()}))}}]})},No.prototype.renameFile=function(e,t){if(!this.isWritable())return $.alert(locale.errorNotAuthorized);var i=this,o=this.nid,n=e.name,a=$.popdown({head:locale.rename,buttons:["-","cancel"," ",{cls:"blue",caption:locale.rename,click:l}]}),s=$('<div class="component editor editor-string" style="width:100%">').appendTo(a.$content);$("<label>").text(locale.name).appendTo(s);var r=$('<input type="text">').val(n).appendTo($('<div class="stringeditor">').appendTo(s)).keydown((function(e){13===e.which&&l(),27===e.which&&close()}));function l(){var e=r.val();return n===e?a.close():util.isValidFileName(e)?($.loading(!0),void setTimeout((function(){database.renameFile(o,n,e,(function(e){if($.loading(!1),e)return $.alert(locale.couldntRenameFile);a.close(),i.updateUI()}))}),0)):$.alert(locale.invalidFileName)}setTimeout((function(){r.focus()}),400)},No.prototype.saveFileICloud=function(e){var t=this.nid,i=e.name,o=database.downloadURL(t,i);NinoxDocumentInteraction.saveFileOnICloud(o,(function(e){e&&$.alert(e)}))},No.prototype.saveFileFileSystem=function(e){var t=this.nid,i=e.name,o=database.downloadURL(t,i);NinoxDocumentInteraction.saveFile(i,"",(function(e,t){if(e)return $.alert(e);t&&localFileSystem.copyURL(o,t).catch(e=>$.alert(e))}))},No.prototype.openFileIn=function(e,t){var i=this.nid,o=e.name,n=database.downloadURL(i,o);NinoxDocumentInteraction.showFileOptions(n,t.clientX,t.clientY,(function(){}))},Object.assign(Io.prototype,ao.a.prototype),Io.prototype.updateStructure=function(){var e=this.field;this.el.attr("title",e.tooltip||""),this.updateElementWidth(),this.label.text(e.caption||locale.unnamed),this.updateStyle()},Io.prototype.updateStyle=function(){var e,t=this.field;if(t.style)try{e=JSON.parse(t.style)}catch(e){}this.label.css({"background-color":e&&e.backgroundColor||"","border-color":e&&e.borderColor||"","border-width":e&&e.borderWidth||"",color:e&&e.color||"","font-size":e&&e.fontSize||"","text-align":e&&e.textAlign||"","font-weight":e&&(util.multiHasOne(e.fontStyle,[1])?"bold":"normal")||"","font-style":e&&util.multiHasOne(e.fontStyle,[2])?"italic":"","border-left-style":e&&(util.multiHasOne(e.borderSides,[1])?e.borderStyle:"none")||"","border-top-style":e&&(util.multiHasOne(e.borderSides,[2])?e.borderStyle:"none")||"","border-bottom-style":e&&(util.multiHasOne(e.borderSides,[3])?e.borderStyle:"none")||"","border-right-style":e&&(util.multiHasOne(e.borderSides,[4])?e.borderStyle:"none")||""})},Io.prototype.startEditCaption=wo.prototype.startEditCaption,Oo.prototype.bind=function(){this.container.currentTab===this&&this.load()},Oo.prototype.destroy=function(){this.elTab.remove(),this.el.remove()},Oo.prototype.hide=function(e){this.container.currentTab===this&&(this.container.currentTab=void 0,this.el.hide(),this.historyDiv.empty(),this.elTab.removeClass("selected"),this.elTab[0].firstElementChild.className=this.unselectedIconClass,this.tabSelectedIndicator.detach(),e&&e())},Oo.prototype.show=function(){this.container.currentTab!==this&&(this.container.currentTab&&this.container.currentTab.hide(),this.container.currentTab=this,this.el.show(),this.elTab.addClass("selected"),this.elTab[0].firstElementChild.className=this.selectedIconClass,this.tabSelectedIndicator.appendTo(this.elTab),this.load())},Oo.prototype.focus=function(){},Oo.prototype.load=function(){var e=this;e.container.nid&&database.loadNodeHistory(e.container.nid,(function(t,i){if(t)return $.alert(t);e.render(i)}))},Oo.prototype.render=function(e){var t=this;t.historyDiv.empty();var i=t.container.type,o=t.historyDiv,n=void 0,a=void 0;e.sort((function(e,t){return t[0]-e[0]})),k.each(e,(function(e){e[0];var t=e[1],s=new Date(e[2]),r=e[3],l=util.formatLocaleDate(s);if(l!==n&&(void 0!==a&&$('<div class="history-foot">').appendTo(o),$('<div class="history-date">').text(l).appendTo(o),n=l,a=void 0),t!==a){void 0!==a&&$('<div class="history-foot">').appendTo(o);var c=$('<div class="history-head">').appendTo(o);$('<div class="history-user">').text(database.userName(t)).appendTo(c),a=t}var d=$('<div class="history-entry">').appendTo(o);switch($('<div class="history-time">').text(Mo(s)).appendTo(d),r){case"create":$('<div class="history-change">').appendTo(d).text(locale.created);break;case"remove":$('<div class="history-change">').appendTo(d).text(locale.removed);break;case"update":var h=e[5],p=$('<div class="history-change">').appendTo(d);k.each(h,(function(e,t){var o=i.fields[t];if(o&&database.canRead(o))if(o.isField)$("<div>").text(o.caption+" "+locale.updated+" "+o.format(e)).appendTo(p);else if(o.isReference)if(e){var n=o.refType.id+e;$("<div>").append($('<div class="history-link">'+o.caption+" "+locale.linked+" ...</div>").touch((function(){new kn.PopupEditor(n,{})}))).appendTo(p)}else $("<div>").text(o.caption+" "+locale.unlinked).appendTo(p);else if(o.isReverse)for(var a in e)if(e.hasOwnProperty(a)){n=o.refType.id+a;!0===e[a]?$("<div>").append($('<div class="history-link">'+o.caption+" "+locale.linked+" ...</div>").touch((function(){new kn.PopupEditor(n,{})}))).appendTo(p):!1===e[a]&&$("<div>").append($('<div class="history-link">'+o.caption+" "+locale.unlinked+" ...</div>").touch((function(){new kn.PopupEditor(n,{})}))).appendTo(p)}}))}})),void 0!==a&&$('<div class="history-foot">').appendTo(o)};o("./src/react/SideEditorTools.css");var Fo=o("./src/react/util/HorizontalScrollContainer/HorizontalScrollContainer.tsx");class Ro extends s.Component{constructor(e){super(e),this.state={isScrollable:!1}}render(){return s.createElement("div",{className:"SideEditorTools_root"},s.createElement(Fo.a,{controlsConfig:{left:{visibility:window.TOUCH?"NONE":"AUTO",containerClassName:"SideEditorTools_movementControls",iconClassName:"i-32-24 i-white i-arrow-solid-left",innerElement:!window.TOUCH&&this.state.isScrollable?s.createElement("div",{className:"SideEditorTools_divider"}):null},right:{visibility:window.TOUCH?"NONE":"AUTO",containerClassName:"SideEditorTools_movementControls",iconClassName:"i-32-24 i-white i-arrow-solid-right"},position:"AFTER_CHILD"},onScrollStateChange:e=>this.setState({isScrollable:e}),customScrollBy:e=>Math.max(e/2,64)},s.createElement(Ze.a,{onFastClick:this.props.editFields,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-setting-tool"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().editFields)),s.createElement("div",{className:"SideEditorTools_divider"}),s.createElement(Ze.a,{onFastClick:this.props.popupFields,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-plus"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().field)),s.createElement(Ze.a,{onFastClick:this.props.addFunction,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-field-formula"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().function)),s.createElement(Ze.a,{onFastClick:this.props.popupUIs,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-header"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().layoutElement)),s.createElement("div",{className:"SideEditorTools_divider"}),s.createElement(Ze.a,{onFastClick:this.props.popupReferences,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-field-ref"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().linkTo)),s.createElement(Ze.a,{onFastClick:this.props.popupReverses,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-field-rev"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().linkFrom)),s.createElement(Ze.a,{onFastClick:this.props.addSubTable,className:"SideEditorTools_button",rippleStyle:"LIGHT"},s.createElement("div",{className:"SideEditorTools_buttonIcon i-32-24 i-white i-setting-table"}),s.createElement("div",{className:"SideEditorTools_buttonLabel"},Object(b.getLocale)().subTable))))}}var Lo=o("./src/react/tableView/PopupMenu.tsx");class jo extends s.Component{constructor(e){super(e),Je()(this,"handleClick",(e,t)=>{null!==e&&(Object(Ii.a)(this.state.currentAction),this.state.currentAction(e,t)),this.setState({currentAction:null})}),Je()(this,"popupUIs",e=>{const t=[];["br","space","head","text","tab","button","view","chart"].forEach(e=>{t.push({id:e,text:Object(b.getLocale)().types[e]||e,iconClass:"i-32-24 i-light-grey i-field-"+e})}),this.setState({currentAction:e=>this.props.onCreateUI(t[e].id),currentTarget:Ze.b.getTarget(e),currentItemsToRender:t,currentMaxCols:2})}),Je()(this,"popupFields",e=>{const t=["string","string_multiline","html","number","boolean","choice","multi","date","time","timestamp","timeinterval","appointment","file","signature","link","email","phone","location","color","icon"];this.props.database.supports.authentication&&t.push("user");const i=[];t.forEach(e=>{i.push({id:e,text:Object(b.getLocale)().types[e],iconClass:"i-32-24 i-light-grey i-field-"+e})}),this.setState({currentAction:e=>this.props.onCreateField(t[e]),currentTarget:Ze.b.getTarget(e),currentItemsToRender:i,currentMaxCols:3})}),Je()(this,"popupReferences",e=>{const t=this.getSortedTypes();this.setState({currentAction:e=>this.props.onCreateReference(t[e]),currentTarget:Ze.b.getTarget(e),currentItemsToRender:t,currentMaxCols:void 0})}),Je()(this,"getSortedTypes",()=>b.util.localeSortBy(this.props.database.schema.types,"caption").map(e=>{const t=e.icon?"ic ic-"+e.icon:"i-40-24 i-light-grey i-setting-table";return{id:e.id,text:e.caption||Object(b.getLocale)().unnamed,iconClass:"icon-big-grey "+t}})),Je()(this,"popupReverses",e=>{const t=this.getSortedTypes();this.setState({currentAction:e=>this.props.onCreateReverse(t[e]),currentTarget:Ze.b.getTarget(e),currentItemsToRender:t,currentMaxCols:void 0})}),this.state={currentTarget:null,currentItemsToRender:[],currentAction:null,currentMaxCols:void 0}}render(){return s.createElement(s.Fragment,null,s.createElement(Ro,{editFields:this.props.editFields,popupFields:this.popupFields,addFunction:this.props.addFunction,popupUIs:this.popupUIs,popupReferences:this.popupReferences,popupReverses:this.popupReverses,addSubTable:this.props.addSubTable}),this.renderPopup())}renderPopup(){return s.createElement(Lo.a,{itemBackground:"DEFAULT",clickTarget:this.state.currentTarget,show:null!==this.state.currentAction,onClick:this.handleClick,maxColumns:this.state.currentMaxCols,items:this.state.currentItemsToRender})}}o("./node_modules/jquery/dist/jquery.js");function Ao(e,t,i,o){this.columns=this.calculateColumns(),this.selectedComponent=void 0,this.mouseMode=void 0,this.container=e,this.tid=t,this.type=void 0,this.hideFields=i||{},this.nid=void 0,this.node=void 0,this.currentTab=void 0,this._isWritable=!0,this.el=$('<div class="object --ul-document-object'+(e.isEmbedded?" object-embedded":"")+'">').appendTo(e.containerEl||e.el),this.el.on("mousedown touchstart",$.proxy(this.mousedown,this)),this.el.on("contextmenu",$.proxy(this.contextmenu,this)),this.elTabs=e.tabsEl,this.tabs=[],this.createStructure(o),ui.on("saveSchema",this.unselectComponent,this)}Ao.prototype.updateStructure=function(){var e=this;Object(bo.b)()?this.el.addClass("adminmode"):(this.el.removeClass("adminmode"),this.unselectComponent());var t=this.currentTab?this.currentTab.id:void 0,i=this.type=database.schema.types[this.tid];if(!i)return this.destroy();var o=i.sorted[0]&&"tab"===i.sorted[0].base,n=this.tabs,a=[],s={},r={};o||(r[0]=!0);for(var l=0;l<n.length;l++){var c=n[l];s[c.id]=c,c.children=[]}o||((c=s[0]).field={id:"0",caption:i.caption,type:i,order:-1},a.push(c)),k.each(i.sorted,(function(t){"tab"===t.base?((c=s[t.id])?c.field=t:c=new kn.Tab(e,t),a.push(c),r[t.id]=!0):c.children.push(t)}));for(l=0;l<n.length;l++){c=n[l];r[c.id]||c.destroy()}this.tabs=a,k.each(this.tabs,(function(e){e.updateStructure()})),this.updateTabs(),this.selectTab(t)},Ao.prototype.createStructure=function(e){var t=this;Object(bo.b)()?this.el.addClass("adminmode"):this.el.removeClass("adminmode");var i,o=this.type=database.schema.types[this.tid];o&&(o.sorted[0]&&"tab"===o.sorted[0].base||(i=new kn.Tab(this,{id:"0",caption:o.caption,type:o,order:-1}),this.tabs.push(i)),k.each(o.sorted,(function(e){"tab"===e.base?(i=new kn.Tab(t,e),t.tabs.push(i)):i.children.push(e)})),database.supports.files&&o.hasFiles&&(this.files=new kn.FilesTab(this)),database.supports.comments&&o.hasComments&&(this.comments=new kn.CommentsTab(this)),database.supports.history&&database.authorizationHistory&&o.hasHistory&&(this.history=new kn.HistoryTab(this)),this.updateTabs(),this.selectTab(e))},Ao.prototype.updateTabs=function(){k.each(this.tabs,(function(e){e.elTab.detach()}),this),k.each(this.tabs,(function(e){e.elTab.appendTo(this.elTabs)}),this),this.files&&this.files.elTab.appendTo(this.elTabs),this.comments&&this.comments.elTab.appendTo(this.elTabs),this.history&&this.history.elTab.appendTo(this.elTabs)},Ao.prototype.register=function(){this.nid&&database.on("*",void 0,this.nodeChanged,this)},Ao.prototype.unregister=function(){this.nid&&database.off("*",void 0,this.nodeChanged,this)},Ao.prototype.destroy=function(){ui.off("saveSchema",this.unselectComponent,this),this.unregister(),k.each(this.tabs,(function(e){e.destroy()})),this.files&&this.files.destroy(),this.comments&&this.comments.destroy(),this.history&&this.history.destroy(),this.el.remove()},Ao.prototype.bind=function(e){this.unregister(),this.node=e,this.nid=e?e._id:void 0,this.register(),this.updateIsWritable(),k.each(this.tabs,(function(t){t.bind(e)})),this.files&&this.files.bind(e),this.comments&&this.comments.bind(e),this.history&&this.history.bind(e)},Ao.prototype.updateIsWritable=function(){this._isWritable=database.canWriteNode(this.nid)},Ao.prototype.isWritable=function(){return this._isWritable},Ao.prototype.save=function(){k.each(this.tabs,(function(e){e.save()}))},Ao.prototype.getSelectedTab=function(){if(this.currentTab)return this.currentTab.id},Ao.prototype.selectTab=function(e){let t=e;if("files"===e&&this.files)this.files.show();else if("comments"===e&&this.comments)this.comments.show();else if("history"===e&&this.history)this.history.show();else{var i=this.tabs;const o=i.find(t=>t.id===e);void 0===o?(i[0].show(),t=i[0].id):o.show()}this.container.editorTabChanged&&this.container.editorTabChanged(t)},Ao.prototype.nodeChanged=function(){var e=database.loadNodeSync(this.nid);this.node=e,this.updateIsWritable(e),e&&k.each(this.tabs,(function(e){e.nodeChanged()}))};var Po=0;function Uo(e){return{file:"float:left"}[e]||""}function Ho(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function zo(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ho(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ho(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Vo(){var e=this;this.nid=void 0,this.opened=!1,this.editor=void 0,this.options={},this.lastSelectedTab=void 0,this.el=$('<div class="sideeditor">').appendTo(ui.$right),$('<div class="popupeditor2-shadow">').appendTo(this.el),this.$tools=void 0,$('<div class="sideeditor-buttons-left">').appendTo(this.el).button2({icon:"i-40-24 i-light-grey i-line-right",click:function(){e.close()}}),this.tabsEl=$('<div class="sideeditor-tabs">').appendTo(this.el),database.on("rename",void 0,this.nodeRenamed,this),database.on("remove",void 0,this.nodeRemoved,this),database.on("schema",void 0,this.schemaChanged,this),database.on("admin",void 0,this.adminChanged,this)}function Wo(e){var t=ui.sideEditor.opened?1:0,i=widgets.popupEditorStack,o=i.length+t,n=ui.rightWidth,a=ui.leftWidth,s=ui.fullWidth-a-n,r=32*(o-1),l=Math.max(s<r?0:-Math.floor(s/o),-n);if(t&&ui.fullWidth>640){var c=l*(o-1);ui.$right[0].style.transform=ui.$right[0].style.WebkitTransform="translateX("+c+"px)"}for(var d=0;d<i.length;d++){c=l*(o-d-1-t);e&&d===i.length-1||ui.fullWidth<640||(i[d].el[0].style.transform=i[d].el[0].style.WebkitTransform="translateX("+c+"px)")}}function Bo(){for(var e=ui.sideEditor.opened?1:0,t=widgets.popupEditorStack,i=t.length+e,o=ui.rightWidth,n=ui.leftWidth,a=ui.fullWidth-n-o,s=32*(i-1),r=a<s?o-s:o,l=a<s?0:-Math.floor(a/i),c=r+"px",d=ui.footHeight+"px",h=0;h<t.length;h++)t[h].el[0].style.bottom=d,ui.fullWidth>640?(t[h].el[0].style.width=c,t[h].$backplane.css("z-index",8),t[h].el[0].style.top=ui.topPadding+88+"px"):(t[h].el[0].style.width=ui.fullWidth+"px",t[h].$backplane.css("z-index",10),t[h].el[0].style.top=ui.topPadding+"px");if(e){var p=l*(i-1);ui.$right[0].style.transition="none",ui.$right[0].style.transform=ui.$right[0].style.WebkitTransform="translateX("+p+"px)"}for(h=0;h<t.length;h++){p=l*(i-h-1-e);t[h].el[0].style.transition="none",t[h].el[0].style.transform=t[h].el[0].style.WebkitTransform="translateX("+p+"px)"}setTimeout((function(){e&&(ui.$right[0].style.transition="");for(var i=0;i<t.length;i++)t[i].el[0].style.transition=""}),0)}function qo(){ui.sideEditor.updateTools();for(var e=widgets.popupEditorStack,t=0;t<e.length;t++)e[t].updateTools();ui.trigger("widgets.tools.updated")}function Yo(e,t){var i=this;this.isClosed=!1;var o=database.typeOf(e);if(!o)return;var n=ui.sideEditor.opened?1:0,a=widgets.popupEditorStack.length+n+1,s=ui.rightWidth,r=ui.leftWidth,l=32*(a-1),c=ui.fullWidth-r-s<l?s-l:s;t=t||{},this.options=t,this.nid=e,this.children=[],this.recordController={hasNextRecord:function(){return!!t.next},nextRecord:function(){i.editor.save(),t.next&&t.next()},hasPrevRecord:function(){return!!t.prev},prevRecord:function(){i.editor.save(),t.prev&&t.prev()},hasAddRecord:function(){return!(!t.create||!database.canCreate(o))},addRecord:function(){i.editor.save(),t.create&&t.create()},hasDuplicateRecord:function(){return!(!t.duplicate||!database.canCreate(o))},duplicateRecord:function(){i.editor.save(),t.duplicate&&database.canCreate(o)&&("function"==typeof t.duplicate?t.duplicate():($.loading(!0),database.duplicate(e,(function(e,t){if($.loading(!1),e)return $.alert(e);i.setNid(t)}))))},hasRemoveRecord:function(){return database.canDelete(o)},removeRecord:function(){i.remove()},hasPrintRecord:function(){return!!database.authorizationPrint},printRecord:function(){i.editor.save(),i.print()},hasUnlinkRecord:function(){return!!t.unlink},unlinkRecord:function(){i.editor.save(),t.unlink&&t.unlink()}},this.$backplane=$('<div class="nx-backplane nx-backplane-popupeditor2">').appendTo($(document.body)).touch((function(e){var t=$(e.target);(t.is(".nx-backplane")||t.is(".popupeditor2-shadow"))&&i.close()}));var d=this.el=$('<div class="popupeditor2" style="transform:translateX('+c+"px);-webkit-transform:translateX("+c+"px);width:"+c+"px;bottom:"+ui.footHeight+'px">').appendTo(this.$backplane);ui.fullscreenStack.length>0?(this.$backplane.css("z-index",10),this.el.css({top:0,bottom:0})):ui.fullWidth>640?(this.$backplane.css("z-index",8),this.el[0].style.top=ui.topPadding+96+"px"):(this.$backplane.css("z-index",10),this.el.css({top:ui.topPadding,width:ui.fullWidth+"px"})),$('<div class="popupeditor2-shadow">').appendTo(this.el),$('<div class="popupeditor2-buttons-left">').appendTo(this.el).button2({icon:"i-40-18 i-light-grey i-close",click:$.proxy(this.close,this)}),this.tabsEl=$('<div class="popupeditor2-tabs">').appendTo(this.el),this.editor=new Ao(this,o.id,this.options.hideFields||{},void 0),database.loadNode(e,(function(e,t){t&&i.editor.bind(t)})),database.on("rename",void 0,this.nodeRenamed,this),database.on("remove",void 0,this.nodeRemoved,this),database.on("schema",void 0,this.schemaChanged,this),database.on("admin",void 0,this.adminChanged,this),this.keydown=$.proxy(this.keydown,this),ui.recordNavigation.pushController(this.recordController),$.pushInputHandler(this),widgets.popupEditorStack.push(this),qo(),Wo(!0),setTimeout((function(){d[0].style.transform=d[0].style.WebkitTransform="translateX(0px)"}),0)}function Xo(e){e=e||{};var t=$.backplane({close:d}),i=window.getHeight(),o=this.$menu=$('<div class="nx-menu-popup" style="max-height:'+(i-64)+'px;overflow:auto">').appendTo(t);if(e.head){var n=$('<div class="nx-menu-head">').appendTo(o);e.head.caption&&n.append($("<span>").text(e.head.caption))}var a=e.items||[];k.each(a,(function(e,t){if(e)if("string"==typeof e)$('<div class="nx-menu-head2">').append($("<span>").text(e)).appendTo(o);else{var i=$('<div class="nx-menu-item">').appendTo(o).click((function(t){$(this).addClass("anim-activated"),c(),e.click&&e.click(t)}));e.icon&&$('<div class="nx-menu-icon '+e.icon+'">').appendTo(i),e.caption&&$('<div class="nx-menu-label">').text(e.caption).appendTo(i),e.css&&i.css(e.css)}})),this.close=c;var s=o.outerWidth(),r=o.outerHeight(),l=e.offset;function c(){t.close()}function d(){e.close&&e.close()}l.left+s>window.getWidth()&&(l.left=window.getWidth()-s),l.top+r>window.getHeight()&&(l.top=window.getHeight()-r),o.offset(l)}Ao.prototype.mousedown=function(e){if(Object(bo.b)()&&!(this.mouseMode||e.touches&&1!==e.touches.length)){var t=this,i=e.target.className,o=$(e.target),n=o.closest(".component").data("component"),a=Date.now(),s=a-Po;Po=a,n?/component-selector-tool/.test(i)?(n.popup(),e.preventDefault()):/component-selector-cr/.test(i)?(c(),e.preventDefault()):/component-selector-cb/.test(i)?(d(),e.preventDefault()):/component-selector/.test(i)?(s<400?n.startEditCaption&&n.startEditCaption():l(),e.preventDefault()):o.is("label")||o.is(".component")||o.is(".booleanslide-text")?t.selectedComponent===n?(l(),e.preventDefault()):r():this.unselectComponent():this.unselectComponent()}function r(){t.mouseMode="start-select";var i=e.touches?e.touches[0].clientX:e.clientX,o=e.touches?e.touches[0].clientY:e.clientY,a=i,s=o;function r(e){e.touches&&1!==e.touches.length||(a=e.touches?e.touches[0].clientX:e.clientX,s=e.touches?e.touches[0].clientY:e.clientY)}function l(e){if(!e.touches||0===e.touches.length){$(window).off("mousemove touchmove",r),$(window).off("mouseup touchend",l),t.mouseMode=void 0;var c=a-i,d=s-o;c*c+d*d<10&&(t.selectComponent(n),e.preventDefault())}}$(window).on("mousemove touchmove",r),$(window).on("mouseup touchend",l)}function l(){t.mouseMode="drag";var i,o,a,s,r,l,c,d="init",h=e.touches?e.touches[0].clientX:e.clientX,p=e.touches?e.touches[0].clientY:e.clientY,u=n.el.parent();function f(e){if(!e.touches||1===e.touches.length){e.preventDefault();var t=e.touches?e.touches[0].clientX:e.clientX,l=e.touches?e.touches[0].clientY:e.clientY,f=t-h,m=l-p;if("init"===d)f*f+m*m>25&&(d="drag",i=n.el.outerWidth(),i/u.width(),o=n.el.outerHeight(),a=n.el.offset(),s=$('<div style="display:inline-block;width:'+(i-1)+"px;height:"+(o-3)+"px;background-color:#ccc;"+Uo(n.field.base)+'">').insertBefore(n.el),n.el.css({position:"absolute",left:a.left,top:a.top,width:i,height:o,backgroundColor:"#e7e7e7",opacity:.8,zIndex:11}).detach().appendTo($(document.body)),g());else{n.el.css({left:a.left+f,top:a.top+m});var y=v(t,l);if(y&&(!r||y.el!==r.el||y.dirH!==r.dirH||y.dirV!==r.dirV||y.tab!==r.tab)){if(r&&r.tab&&r.tab.elTab.css("background-color",""),(r=y)&&r.tab)r.tab.elTab.css("background-color","red"),s.detach();else{var b=$(r.el).data("component");r.dirV<0||r.dirH<0?(s.insertBefore($(r.el)),c=b.field.order-.5):(r.dirV>0||r.dirH>0)&&(s.insertAfter($(r.el)),c=b.field.order+.5)}g()}}}}function m(e){e.touches&&0!==e.touches.length||($(window).off("mousemove touchmove",f),$(window).off("mouseup touchend",m),e.preventDefault(),t.mouseMode=void 0,"drag"===d&&(r&&r.tab?(r.tab.elTab.css("background-color",""),n.field.order=r.tab.field.order+.5,n.field.type.resort(),n.field.type.schema.trigger("change")):(n.el.css({position:"",left:"",top:"",width:100*n.field.formWidth+"%",height:"",backgroundColor:"",opacity:"",zIndex:""}).detach().insertBefore(s),r&&(n.field.order=c,n.field.type.resort(),n.field.type.schema.trigger("change"))),r=void 0,s.remove()))}function g(){l=[];for(var e=u.children(".component"),i=0;i<e.length;i++){var o=$(e[i]),n=o.offset(),a=o.width(),s=o.height();l.push({x:n.left,y:n.top,w:a,h:s,el:o[0]})}var r=t.tabs;for(i=0;i<r.length;i++){var c=r[i];if(!c.visible){var d=c.elTab;n=d.offset(),a=d.width(),s=d.height();l.push({x:n.left,y:n.top,w:a,h:s,el:d[0],tab:c})}}}function v(e,t){for(var i=0;i<l.length;i++){var o=l[i];if(e>=o.x&&e<=o.x+o.w&&t>=o.y&&t<=o.y+o.h)return{dirH:e-o.x<o.w/4?-1:e-o.x>3*o.w/4?1:0,dirV:t-o.y<o.h/4?-1:t-o.y>3*o.h/4?1:0,el:o.el,tab:o.tab}}}$(window).on("mousemove touchmove",f),$(window).on("mouseup touchend",m)}function c(){t.mouseMode="resize-h",$(window).on("mousemove touchmove",l),$(window).on("mouseup touchend",c);var i=e.touches?e.touches[0].clientX:e.clientX,o=e.touches?e.touches[0].clientY:e.clientY,a=n.el.parent(),s=n.el.outerWidth()/a.width(),r=n.field.formWidth;function l(e){if(!e.touches||1===e.touches.length){e.preventDefault();var t=e.touches?e.touches[0].clientX:e.clientX,r=e.touches?e.touches[0].clientY:e.clientY,l=t-i,c=r-o,d=Math.abs(l)>Math.abs(c)?l:c,h=Math.round(Math.min(4,Math.max(1,4*(s+d/a.width())))),p=Math.round(Math.min(32,Math.max(n.field.minFormWidth,32*(s+d/a.width()))))/32;n.setWidth(h,p)}}function c(e){e.touches&&0!==e.touches.length||($(window).off("mousemove touchmove",l),$(window).off("mouseup touchend",c),e.preventDefault(),t.mouseMode=void 0,r!==n.field.formWidth&&n.field.type.schema.trigger("change"))}}function d(){t.mouseMode="resize-v";var i=e.touches?e.touches[0].clientY:e.clientY,o=n.el.outerHeight(),a=n.field.height;function s(e){if(!e.touches||1===e.touches.length){e.preventDefault();var t=(e.touches?e.touches[0].clientY:e.clientY)-i;n.setHeight(o+t)}}function r(e){e.touches&&0!==e.touches.length||($(window).off("mousemove touchmove",s),$(window).off("mouseup touchend",r),e.preventDefault(),t.mouseMode=void 0,a!==n.field.height&&n.field.type.schema.trigger("change"))}$(window).on("mousemove touchmove",s),$(window).on("mouseup touchend",r)}},Ao.prototype.selectComponentByUUID=function(e,t){var i=this.currentTab;if(i){var o=i.components;if(o)for(var n=0;n<o.length;n++){var a=o[n],s=a.field;if(s&&s.uuid===e)return this.selectComponent(a),void(t&&a.startEditCaption&&a.startEditCaption())}}},Ao.prototype.selectComponent=function(e){if(e!==this.selectedComponent&&(this.blur(),this.unselectComponent(),this.selectedComponent=e,e)){var t="";e.el.addClass("selected"),e.popup&&(t+='<div class="component-selector-tool button i-32-24 i-white i-setting-tool"></div>'),e.isWidthAdjustable()&&(t+='<div class="component-selector-cr --ul-resize-right"></div>'),e.isHeightAdjustable()&&(t+='<div class="component-selector-cb"></div>');$('<div class="component-selector">').html(t).prependTo(e.el);var i=e.el.offset().top,o=i+e.el.outerHeight(),n=this.el.offset().top,a=n+this.el.height(),s=this.el.scrollTop();o>a?this.el.scrollTop(s+Math.min(i-n,o-a)):i<n&&this.el.scrollTop(s+(i-n))}},Ao.prototype.blur=function(){k.each(this.tabs,(function(e){e.blur()}))},Ao.prototype.focus=function(){this.currentTab&&this.currentTab.focus()},Ao.prototype.unselectComponent=function(e){this.selectedComponent&&(this.selectedComponent.el.children(".component-selector").remove(),this.selectedComponent.el.removeClass("selected"),this.selectedComponent=void 0)},Ao.prototype.resize=function(){var e=this.columns,t=this.calculateColumns();t!==e&&(this.columns=t,this.columnsChanged()),k.each(this.tabs,(function(e){e.resize()}))},Ao.prototype.calculateColumns=function(){var e=ui.rightWidth;return e<=320?1:e<=480?2:4},Ao.prototype.columnsChanged=function(){k.each(this.tabs,(function(e){e.columnsChanged()}))},Ao.prototype.editorUp=function(){this.container.editorUp&&this.container.editorUp()},Ao.prototype.editorDown=function(){this.container.editorDown&&this.container.editorDown()},Ao.prototype.updateBackground=function(e){this.container.updateBackground(e)},Ao.prototype.openTab=function(e){if(e){var t=k.filter(this.tabs,(function(t){return t.field&&t.field.caption===e}))[0];t&&this.selectTab(t.id)}},Ao.prototype.isFullscreen=function(){return this.container&&this.container.isFullscreen&&this.container.isFullscreen()},Ao.prototype.contextmenu=function(e){if(!window.NINOX_BETA)return;if(!$(e.target).is(".form"))return;const t=this;var i=$.backplane({autoClose:!0}),o=$('<div class="nx-menu-popup" style="white-space:nowrap">').appendTo(i);$('<div class="nx-menu-item">').text("Copy this record").appendTo(o).click(r),$('<div class="nx-menu-item">').text("Past as a new record").appendTo(o).click(l);var n=o.outerWidth(),a=o.outerHeight();const s={left:e.clientX,top:e.clientY};async function r(){i.close();const e=[];try{await o(t.nid);const i={application:"Ninox",version:window.NINOX_VERSION,type:"records",records:e};navigator.clipboard.writeText(JSON.stringify(i,0,4))}catch(e){$.alert(e)}async function o(t,i){const n=database.typeOf(t);if(!n)return;const a=await new Promise(e=>database.loadNode(t,(t,i)=>e(i))),s={_type:n.id,_clientId:a._id};for(const e in a){const t=a[e];if(null!=t)if("_"===e[0]);else{const a=n.fields[e];if(a)if("ref"===a.base)a.isComposition&&a.type.master===i?s[e]=a.refTypeId+t:s[e]=t;else if("rev"===a.base){if(a.reference.isComposition&&a.reference.type.master===n){const e=t;if(e&&e.length){const t=a.refTypeId;for(const i of e){const e=t+i;await o(e,n)}}}}else a.isField&&"fn"!==a.base&&(s[e]=t)}}e.unshift(s)}}async function l(){i.close();try{const e=await navigator.clipboard.readText(),t=JSON.parse(e);if("Ninox"!==t.application||"records"!==t.type||!Array.isArray(t.records))throw new Error("Could not find a Ninox record on the clipboard.");await new Promise(e=>database.updateNodes(t.records,()=>e()))}catch(e){$.alert(e)}}s.left+n>window.getWidth()&&(s.left=window.getWidth()-n),s.top+a>window.getHeight()&&(s.top=window.getHeight()-a),o.offset(s),e.preventDefault()},Vo.prototype.destroy=function(){database.off("rename",void 0,this.nodeRenamed,this),database.off("remove",void 0,this.nodeRemoved,this),database.off("schema",void 0,this.schemaChanged,this),database.off("admin",void 0,this.adminChanged,this),this.close(),this.el.remove()},Vo.prototype.schemaChanged=function(e,t,i){this.updateStructure()},Vo.prototype.adminChanged=function(e,t){this.updateStructure()},Vo.prototype.isOnTop=function(){return!widgets.popupEditorStack.length},Vo.prototype.open=function(e,t,i){console.log("SideEditor.open",e);var o=this;if(this.editor&&(this.editor.save(),this.lastSelectedTab=this.editor.getSelectedTab()),this.options=t||{},!e)return this.close();var n=database.typeOf(e);if(!n)return this.close();this.nid=e;const a=Tt();e!==a.nid&&vt(zo({},a,{nid:e}));var s=this.opened;s||(this.opened=!0,ui.showRight()),this.editor&&this.editor.type===n?this.editor.selectTab(a.tabId&&"default"!==a.tabId?a.tabId:this.lastSelectedTab):(this.editor&&this.editor.destroy(),this.editor=new Ao(this,n.id,!0,a.tabId&&"default"!==a.tabId?a.tabId:this.lastSelectedTab)),$.loading(!0),database.loadNode(e,(function(t,i){$.loading(!1),e===o.nid&&(i?o.editor.bind(i):o.close())})),!TOUCH&&i&&setTimeout((function(){o.editor&&o.editor.focus()}),s?0:400),this.updateTools(),window.Appcues&&window.Appcues.page()},Vo.prototype.editorTabChanged=function(e){const t=Tt();t.tabId!==e&&vt(zo({},t,{tabId:e}))},Vo.prototype.close=function(e){if(this.opened){this.opened=!1,this.nid=void 0;var t=this.editor;this.editor=void 0,t&&(t.save(),this.lastSelectedTab=t.getSelectedTab()),ui.hideRight((function(){t&&t.destroy()})),this.options.close&&!e&&this.options.close(),this.options={},this.updateTools(),vt(zo({},Tt(),{nid:void 0,tabId:void 0})),window.Appcues&&window.Appcues.page()}},Vo.prototype.isOpen=function(){return this.opened},Vo.prototype.focus=function(){this.opened&&this.editor&&this.editor.focus()},Vo.prototype.updateStructure=function(){var e=this;this.editor&&(this.nid&&database.typeOf(this.nid)?(this.editor.updateStructure(),database.loadNode(this.nid,(function(t,i){i&&e.editor.bind(i)}))):this.close());this.updateTools()},Vo.prototype.updateTools=function(){database.adminMode&&this.opened&&this.isOnTop()?this.showTools():this.hideTools()},Vo.prototype.showTools=function(){var e=this;function t(t){Object(l.f)("Form","EditFields");var i=database.typeOf(e.getSelectedNid());i&&new eo({type:i.id})}function i(t){Object(l.f)("Form","CreateField",{fieldType:t});var i=t,o=void 0,n=void 0,a=void 0;"string_multiline"===i?(i="string",o=!0):"signature"===i&&(i="file",n="signature",a=locale.signature);var s=h(),r=database.typeOf(e.getSelectedNid());if(r){var c=r.createNewFieldName(i,a),d=r.schema.createField2(r,{base:i,order:s,caption:c,stringMultiline:o,fileHandling:n},!1,!0);e.editor.selectComponentByUUID(d.uuid,!0)}}function o(t){Object(l.f)("Form","CreateReference");var i=h(),o=database.typeOf(e.getSelectedNid());if(o){var n=t.id,a=database.schema.types[n];if(a){var s=a.caption;for(let e=2;o.findElement(s);e++)s=a.caption+e;var r=o.caption;for(let e=2;a.findElement(r)||o===a&&s===r;e++)r=o.caption+e;var c=o.schema.createReference(o,s,a,r,!1,void 0,void 0,void 0,void 0,i,void 0,!1);e.editor.selectComponentByUUID(c.uuid,!0)}}}function a(t){Object(l.f)("Form","CreateReverse");var i=h(),o=database.typeOf(e.getSelectedNid());if(o){var n=t.id,a=database.schema.types[n];if(a){var s=o.caption;for(let e=2;a.findElement(s);e++)s=o.caption+e;var r=a.caption;for(let e=2;o.findElement(r)||a===o&&s===r;e++)r=a.caption+e;var c=a.schema.createReference(a,s,o,r,!1,void 0,void 0,void 0,void 0,void 0,i,!1);e.editor.selectComponentByUUID(c.reverse.uuid)}}}function r(t){Object(l.f)("Form","CreateSubTable");var i=h(),o=database.schema.clone(),n=o.typeOf(e.getSelectedNid());if(n){var a=o.createType(),s=void 0;new eo({schema:o,schemaDirty:!0,isNewType:!0,type:a.id,beforeSaveType:function(){var e=n.caption;for(let t=2;a.findElement(e);t++)e=n.caption+t;var t=a.caption;for(let i=2;n.findElement(t)||a===n&&e===t;i++)t=a.caption+i;var r=o.createReference(a,e,n,t,!0,void 0,void 0,void 0,void 0,void 0,i,!1);s=r.reverse.uuid},afterSaveType:function(){s&&e.editor.selectComponentByUUID(s)}})}}function c(t){Object(l.f)("Form","CreateFunction");var i=h(),o=database.typeOf(e.getSelectedNid());o&&new Ai.a({schema:o.schema,type:o,okay:function(t,n){if(t&&n){Object(l.f)("Form","CreateFunctionConfirm");var a=o.schema.createField2(o,{order:i,caption:o.createNewFieldName("fn"),base:"fn",fn:t},!1,!0);e.editor.selectComponentByUUID(a.uuid,!0)}}})}function d(t){Object(l.f)("Form","LayoutElement",{fieldType:t});var i="tab"===t?void 0:h(),o=database.typeOf(e.getSelectedNid());if(o){var n=locale.types[t],a=o.schema.createUI(o,n,i,t,void 0,!1,!0);e.editor.selectComponentByUUID(a.uuid,"head"===t||"button"===t)}}function h(){var t=database.typeOf(e.getSelectedNid());if(t){var i=t.sorted,o=0,n=e.editor&&e.editor.currentTab&&e.editor.currentTab.field;n&&(o=i.indexOf(n)+1);for(var a=o;a<i.length;a++){var s=i[a];if("tab"===s.base)return s.order-.5}}}this.$tools||(this.$tools=$("<div>").appendTo(this.el)),n.render(s.createElement(jo,{addFunction:c,addSubTable:r,editFields:t,onCreateField:i,onCreateReference:o,onCreateReverse:a,database:database,onCreateUI:d}),this.$tools[0])},Vo.prototype.hideTools=function(){this.$tools&&(n.unmountComponentAtNode(this.$tools[0]),this.$tools.remove(),this.$tools=void 0)},Vo.prototype.nodeRemoved=function(e,t){t===this.nid&&this.close()},Vo.prototype.nodeRenamed=function(e,t,i){t===this.nid&&this.setNid(i)},Vo.prototype.setNid=function(e){this.opened&&this.open(e,this.options)},Vo.prototype.remove=function(){var e=this,t=this.nid,i=database.typeOf(t);if(!database.canDelete(i))return $.alert(locale.errorNotAuthorized);$.dialog({closable:!0,caption:locale.remove,message:locale.confirmRemove,buttons:[{color:"red",caption:locale.remove,callback:function(){database.remove(t,(function(t){if(t)return $.alert(t);e.open(void 0)}))}}]})},Vo.prototype.print=function(){var e=this;this.nid&&(window.reports?reports.openDesigner({nid:this.nid,nids:e.options.getSelectedNids?e.options.getSelectedNids():[]}):Object(_e.a)(this.nid))},Vo.prototype.prev=function(){this.options.prev&&this.options.prev()},Vo.prototype.next=function(){this.options.next&&this.options.next()},Vo.prototype.first=function(){this.options.first&&this.options.first()},Vo.prototype.last=function(){this.options.last&&this.options.last()},Vo.prototype.popup=function(e){var t=this,i=t.nid,o=database.typeOf(i);if(o){var n=$.backplane({}),a=$('<div class="nx-menu-popup" style="border-radius:4px">').appendTo(n);database.authorizationPrint&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.print+"...")).appendTo(a).click((function(){n.close(),t.print()})),this.options.duplicate&&database.canCreate(o)&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.duplicate)).appendTo(a).click((function(){n.close(),t.options.duplicate()})),database.canDelete(o)&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.remove)).appendTo(a).click((function(){n.close(),t.remove()})),$("<hr>").appendTo(a),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.close)).appendTo(a).click((function(){n.close(),t.close()}));var s=a.outerWidth(),r=a.outerHeight(),l=$(e.target).offset();l.top+=32,l.left+s>window.getWidth()&&(l.left=window.getWidth()-s),l.top+r>window.getHeight()&&(l.top=window.getHeight()-r),a.offset(l)}},Vo.prototype.resize=function(){this.editor&&this.editor.resize(),this.updateTools()},Vo.prototype.editorUp=function(){this.prev()},Vo.prototype.editorDown=function(){this.next()},Vo.prototype.updateBackground=function(e){var t=util.luminosity(e)<.5;this.el.css("background-color",e||""),this.el.toggleClass("darkmode",t)},Vo.prototype.getSelectedNid=function(){return this.nid},Vo.prototype.openTab=function(e){this.editor.openTab(e)},Yo.prototype.isOnTop=function(){return widgets.popupEditorStack[widgets.popupEditorStack.length-1]===this},Yo.prototype.showTools=Vo.prototype.showTools,Yo.prototype.hideTools=Vo.prototype.hideTools,Yo.prototype.updateTools=function(){database.adminMode&&!this.isClosed&&this.isOnTop()?this.showTools():this.hideTools()},Yo.prototype.setNid=function(e){var t=this;this.nid=e,database.loadNode(e,(function(e,i){i&&t.editor.bind(i)}))},Yo.prototype.keydown=function(e){if(!($(e.target).closest(".contenteditable").length>0)&&"textarea"!==e.target.localName&&"input"!==e.target.localName)switch(e.which){case 27:this.close(),e.preventDefault();break;case 38:this.options.prev&&this.options.prev(),e.preventDefault();break;case 40:this.options.next&&this.options.next(),e.preventDefault()}},Yo.prototype.close=function(){var e=this;if(!this.isClosed){this.isClosed=!0,this.hideTools(),widgets.popupEditorStack.pop();var t=ui.rightWidth;ui.fullWidth<640&&(t=ui.fullWidth),this.el[0].style.transform=this.el[0].style.WebkitTransform="translateX("+t+"px)",ui.recordNavigation.popController(this.recordController),database.off("rename",void 0,this.nodeRenamed,this),database.off("remove",void 0,this.nodeRemoved,this),database.off("schema",void 0,this.schemaChanged,this),database.off("admin",void 0,this.adminChanged,this),$.popInputHandler(this),setTimeout((function(){e.editor&&e.editor.destroy(),e.$backplane.remove(),e.options.close&&e.options.close()}),400),qo(),Wo()}},Yo.prototype.nodeRenamed=function(e,t,i){t===this.nid&&this.setNid(i)},Yo.prototype.nodeRemoved=function(e,t){t===this.nid&&this.close()},Yo.prototype.schemaChanged=function(e,t,i){this.updateStructure()},Yo.prototype.adminChanged=function(e,t){this.updateStructure()},Yo.prototype.updateStructure=function(){var e=this;database.typeOf(this.nid)&&(this.editor.updateStructure(),database.loadNode(this.nid,(function(t,i){i?e.editor.bind(i):this.close()})),this.updateTools())},Yo.prototype.remove=function(){var e=this;return $.dialog({closable:!0,caption:locale.remove,message:locale.confirmRemove,buttons:[{color:"red",caption:locale.remove,callback:function(){e.close(),database.remove(e.nid,(function(e){if(e)return $.alert(e)}))}}]}),!1},Yo.prototype.print=function(){this.nid&&(window.reports?reports.openDesigner({nid:this.nid,nids:this.options.getSelectedNids&&this.options.getSelectedNids()}):Object(_e.a)(this.nid))},Yo.prototype.popup=function(e){var t=this,i=t.nid,o=database.typeOf(i);if(o){var n=$.backplane({}),a=$('<div class="nx-menu-popup" style="border-radius:4px">').appendTo(n);database.authorizationPrint&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.print+"...")).appendTo(a).click((function(){n.close(),t.print()})),t.options.unlink&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.unlink)).appendTo(a).click((function(){n.close(),t.options.unlink()})),t.options.duplicate&&database.canCreate(o)&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.duplicate)).appendTo(a).click((function(){n.close(),t.options.duplicate(t)})),database.canDelete(o)&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.remove)).appendTo(a).click((function(){n.close(),t.remove()}));var s=a.outerWidth(),r=a.outerHeight(),l=$(e.target).offset();l.top+=40,l.left+s>window.getWidth()&&(l.left=window.getWidth()-s),l.top+r>window.getHeight()&&(l.top=window.getHeight()-r),a.offset(l)}},Yo.prototype.updateBackground=function(e){var t=util.luminosity(e)<.5;this.el.css("background-color",e||""),this.el.toggleClass("darkmode",t)},Yo.prototype.menuNextRecordEnabled=function(){return!!this.options.next},Yo.prototype.menuNextRecord=function(){this.options.next&&this.options.next()},Yo.prototype.menuPrevRecordEnabled=function(){return!!this.options.prev},Yo.prototype.menuPrevRecord=function(){this.options.prev&&this.options.prev()},Yo.prototype.menuFirstRecordEnabled=function(){return!!this.options.first},Yo.prototype.menuFirstRecord=function(){this.options.first&&this.options.first()},Yo.prototype.menuLastRecordEnabled=function(){return!!this.options.last},Yo.prototype.menuLastRecord=function(){this.options.last&&this.options.last()},Yo.prototype.menuCreateRecordEnabled=function(){var e=database.typeOf(this.nid);return!!(this.options.create&&e&&database.canCreate(e))},Yo.prototype.menuCreateRecord=function(){this.options.create&&this.options.create()},Yo.prototype.menuDuplicateRecordEnabled=function(){var e=database.typeOf(this.nid);return!!(this.options.duplicate&&e&&database.canCreate(e))},Yo.prototype.menuDuplicateRecord=function(){this.options.duplicate&&this.options.duplicate()},Yo.prototype.menuDeleteRecordEnabled=function(){var e=database.typeOf(this.nid);return!(!e||!database.canDelete(e))},Yo.prototype.menuDeleteRecord=function(){this.remove()},Yo.prototype.menuPrintRecordEnabled=function(){return!!database.authorizationPrint},Yo.prototype.menuPrintRecord=function(){this.print()},Yo.prototype.menuUnlinkRecordEnabled=function(){return!!this.options.unlink},Yo.prototype.menuUnlinkRecord=function(){this.options.unlink&&this.options.unlink()},Yo.prototype.menuCloseRecordEnabled=function(){return!0},Yo.prototype.menuCloseRecord=function(){this.close()},Yo.prototype.getSelectedNid=function(){return this.nid},Yo.prototype.editorDown=function(){this.editor.save(),this.options.next&&this.options.next()},Yo.prototype.editorUp=function(){this.editor.save(),this.options.prev&&this.options.prev()};class Go{constructor(e,t,i,o,n){Je()(this,"isActive",!0),Je()(this,"valueModel",void 0),Je()(this,"valueField",void 0),Je()(this,"functionModel",void 0),Je()(this,"operandModel",void 0),Je()(this,"operandField",void 0),Je()(this,"colorModel",void 0),Je()(this,"colorField",void 0),Je()(this,"backgroundModel",void 0),Je()(this,"backgroundField",void 0),Je()(this,"cellModel",void 0),Je()(this,"cellField",void 0),Je()(this,"iconModel",void 0),Je()(this,"iconField",void 0),Je()(this,"$el",void 0),Je()(this,"$valueFieldContainer",void 0),Je()(this,"tempCol",{}),this.$el=$('<div class="conditional-styling-rule">').data("rule",this).appendTo(o);let a={};"number"===n?(this.valueModel=new b.util.SimpleModel(new b.schemas.TNumber(void 0,void 0,{caption:Object(b.getLocale)().value,formWidth:1}),i.value||0),a={"=":{id:"=",caption:"="},"!=":{id:"!=",caption:"!="},"<":{id:"<",caption:"<"},"<=":{id:"<=",caption:"<="},">":{id:">",caption:">"},">=":{id:">=",caption:">="},"f(x)":{id:"f(x)",caption:"f(x)"}}):"string"===n&&(this.valueModel=new b.util.SimpleModel(new b.schemas.TString(void 0,void 0,{caption:Object(b.getLocale)().value,formWidth:1}),i.value||""),a={"=":{id:"=",caption:"="},"!=":{id:"!=",caption:"!="},startsWith:{id:"startsWith",caption:Object(b.getLocale)().startsWith},endsWith:{id:"endsWith",caption:Object(b.getLocale)().endsWith},contains:{id:"contains",caption:Object(b.getLocale)().op_contains},"f(x)":{id:"f(x)",caption:"f(x)"}}),this.operandModel=new b.util.SimpleModel(new b.schemas.TChoice(void 0,void 0,{required:!0,values:a,caption:Object(b.getLocale)().operator,formWidth:1}),i.operand||"="),this.operandModel.on("update",this.onOperandValueChange,this),this.tempCol.expression=i.value,this.functionModel=new b.schemas.ExpressionModel(this.tempCol,"expression",void 0,e,Object(b.getLocale)().function),this.functionModel.field.formWidth=1,this.valueModel.field.formWidth=1,this.operandField=new qt.a(void 0,this.operandModel,$('<div style="width:80px">').appendTo(this.$el),{cls:"conditional-styling-rule-part"}),this.$valueFieldContainer=$('<span style="width: 25%">').appendTo($('<div style="width:120px;flex:1 0 auto;-webkit-flex:1 0 auto">').appendTo(this.$el)),this.valueField=new qt.a(this,this.valueModel,this.$valueFieldContainer,{cls:"conditional-styling-rule-part"}),this.onOperandValueChange(),this.colorModel=new b.util.SimpleModel(new b.schemas.TColor(void 0,void 0,{caption:Object(b.getLocale)().text,formWidth:1}),i.color),this.colorField=new qt.a(this,this.colorModel,$('<div style="width:80px">').appendTo(this.$el),{cls:"conditional-styling-rule-part"}),this.backgroundModel=new b.util.SimpleModel(new b.schemas.TColor(void 0,void 0,{caption:Object(b.getLocale)().background,formWidth:1}),i.background),this.backgroundField=new qt.a(this,this.backgroundModel,$('<div style="width:80px">').appendTo(this.$el),{cls:"conditional-styling-rule-part"}),this.cellModel=new b.util.SimpleModel(new b.schemas.TColor(void 0,void 0,{caption:Object(b.getLocale)().cellBackground||"Cell",formWidth:1}),i.cell),this.cellField=new qt.a(this,this.cellModel,$('<div style="width:80px">').appendTo(this.$el),{cls:"conditional-styling-rule-part"}),this.iconModel=new b.util.SimpleModel(new b.schemas.TIcon(void 0,void 0,{caption:Object(b.getLocale)().icon,formWidth:1}),i.icon),this.iconField=new qt.a(this,this.iconModel,$('<div style="width:80px">').appendTo(this.$el),{cls:"conditional-styling-rule-part"});const s=$('<div class="conditional-styling-rule-icon-container">').appendTo(this.$el);$('<div class="i-32-24 i-light-grey i-setting-trash">').click(()=>{this.isActive=!1,this.destroy()}).appendTo(s),$('<div class="i-24-24 i-lighter-grey i-drag-handle">').appendTo(s)}destroy(){this.operandField.destroy(),this.iconField.destroy(),this.backgroundField.destroy(),this.colorField.destroy(),this.valueField.destroy(),this.$el.remove()}getRule(){let e;return"f(x)"===this.operandModel.value?this.tempCol.expression&&(e=this.tempCol.expression):e=this.valueModel.value,{background:this.backgroundModel.value,color:this.colorModel.value,cell:this.cellModel.value,value:e,operand:this.operandModel.value,icon:this.iconModel.value}}onOperandValueChange(){"f(x)"===this.operandModel.value?this.onFunctionSelect():this.onOutOfFunctionSelect()}onFunctionSelect(){this.valueField.destroy(),this.valueField=new qt.a(this,this.functionModel,this.$valueFieldContainer,void 0)}onOutOfFunctionSelect(){this.valueField.destroy(),this.valueField=new qt.a(this,this.valueModel,this.$valueFieldContainer,void 0)}}class Jo{constructor(e,t,i,o){Je()(this,"$popDown",void 0),Je()(this,"col",void 0),Je()(this,"rules",[]),Je()(this,"onSave",void 0),Je()(this,"tableType",void 0),Je()(this,"createRule",(e,t)=>new Go(this.tableType,this.col,e,this.$popDown.$content,t)),this.tableType=e,this.onSave=i,this.col=t;const n=this.col.conditionalStyling?this.col.conditionalStyling:[];this.$popDown=window.$.popdown({cls:"xlarge",head:Object(b.getLocale)().conditionalStyling,buttons:[{caption:Object(b.getLocale)().cancel,click:()=>this.destroy()},"-",{cls:"blue",caption:Object(b.getLocale)().addRule,click:()=>{this.rules.push(this.createRule({},o))}}," ",{cls:"blue",caption:Object(b.getLocale)().okay,click:()=>{this.save(),this.destroy()}}]});for(const e of n)this.rules.push(this.createRule(e,o));this.$popDown.$content.css({maxHeight:window.getHeight()/2+"px",overflowY:"auto"}),this.$popDown.$content.sortable({handle:".i-drag-handle"})}destroy(){for(const e of this.rules)e.destroy();this.$popDown.close()}save(){const e=[];for(const t of this.$popDown.$content.children()){const i=$(t).data("rule");i.isActive&&e.push(i.getRule())}this.onSave(e)}}var Ko=o("./src/js/helpers.ts");const Qo=40,Zo=0,en=20;function tn(e,t,i){this.rowHeight=Qo,this.headHeight=40,this.footHeight=40,this.container=e,this.tab=t,this.field=i,this.visible=!0,this.reverseRenderer=i.reverseRenderer,this.cachedViewConfig=util.getPersistentViewConfig(i.viewConfig),this.query=this.createQuery(),this.popupEditor=null,this.minRows=0,this.maxRows=i.height,this.ridxTop=0,this.scrollTop=0,this.scrollLeft=0,this.scrollDoneTimeout=null,this.scrollDoneTime=0,this.scrollDone=$.proxy(this.scrollDone,this),this.viewWidth=0,this.viewRows=[],this.el=$('<div class="component editor editor-list editor-4col">').data("component",this).attr("title",i.tooltip||""),this.updateElementWidth(),this.el.appendTo(t.el),this.label=$("<label>").text(i.caption||locale.unnamed).appendTo(this.el),this.$list=$('<div class="list">').appendTo(this.el).touch($.proxy(this.click,this)).on("contextmenu",$.proxy(this.contextmenu,this)),this.$controls=$('<div class="list-controls">').appendTo(this.el),this.$find=$('<div class="list-button"><div class="i-32-16 i-light-grey i-search"></div><span>'+htmlEscape(locale.addRowFind)+"</span></div>").appendTo(this.$controls).touch($.proxy(this.addRowFind,this)),this.$create=$('<div class="list-button"><div class="i-32-16 i-light-grey i-plus"></div><span>'+htmlEscape(locale.addRowCreate)+"</span></div>").appendTo(this.$controls).touch($.proxy(this.addRowCreate,this)),this.$container=$DIV("t-container",this.$list[0]),this.$head=$DIV("t-head",this.$container),this.$foot=$DIV("t-foot",this.$container),this.$foot.style.zIndex=1,this.$body=$DIV("t-body",this.$container),this.$content=$DIV("t-content",this.$body),this.$view=$DIV("t-view",this.$content),this.$headCells=[],this.$footCells=[],this.$scrollbarVContainer=$DIV("t-scrollbar-v-container",this.$container),this.$scrollbarV=$DIV("t-scrollbar-v",this.$scrollbarVContainer),this.$scrollbarHContainer=$DIV("t-scrollbar-h-container",this.$container),this.$scrollbarHContainer.style.left=0,this.$scrollbarHContainer.style.bottom=0,this.$scrollbarH=$DIV("t-scrollbar-h",this.$scrollbarHContainer),this.$scrollVIndicator=$DIV("t-scroll-v-indicator",this.$container),this.registerScrollListeners(),this.registerHeadResizeListeners(),this.registerHeadDragListeners(),this.rebalanceColumns(),this.updateTable(),this.updateButtons(),database.on("rename",void 0,this.nodeRenamed,this)}Object.assign(tn.prototype,ao.a.prototype),tn.prototype.createQuery=function(){return new queries.QueryReverse(database,this.field,void 0)},tn.prototype.updateStructure=function(){var e=this.field;this.el.attr("title",e.tooltip||""),this.updateElementWidth(),this.label.text(e.caption||locale.unnamed),this.maxRows=e.height,this.queryNeedsUpdate()&&(this.query=this.createQuery(),this.rebalanceColumns(),this.updateTable()),this.reload()},tn.prototype.queryNeedsUpdate=function(){return util.viewConfigEquals(this.field.viewConfig,this.cachedViewConfig)?!(!this.query||this.field==this.query.field):(this.cachedViewConfig=util.getPersistentViewConfig(this.field.viewConfig),!0)},tn.prototype.destroy=function(){database.off("rename",void 0,this.nodeRenamed,this),this.el.remove()},tn.prototype.nodeChanged=function(){this.updateIsWritable(),this.updateVisibility(),this.reload(),this.updateButtons()},tn.prototype.reload=function(){if(this.query){var e=this;e.nid=e.container.nid,e.query.nid=e.container.nid,e.query.load((function(){e.updateAll()}))}},tn.prototype.updateAll=function(){this.updateHeight(),this.updateHead(),this.updateFoot(),this.updateRows(),this.updateButtons()},tn.prototype.saveConfigIfAdminMode=function(){Object(bo.b)()&&this.saveConfig()},tn.prototype.saveConfig=function(){this.query&&(this.field.viewConfig=util.getPersistentViewConfig(this.query.getConfig()),this.cachedViewConfig=util.clone(this.field.viewConfig),this.field.type.schema.trigger("change"))},tn.prototype.addRowFind=function(){if(this.query){var e=this;if(!this.isWritable())return $.alert(locale.errorNotAuthorized);if(!database.canWrite(e.field.reference))return $.alert(locale.errorNotAuthorized);var t=database.canCreate(e.field.refType);new nn(e.nid,e.field,{viewConfig:e.query.getConfig(),select:function(t){database.update(t,e.field.refFieldId,database.ridOf(e.nid),(function(e){e&&$.alert(e)}))},create:t?function(){e.addRowCreate()}:void 0})}},tn.prototype.addRowCreate=function(){var e=this;if(!this.isWritable())return $.alert(locale.errorNotAuthorized);if(!database.canCreate(e.field.refType))return $.alert(locale.errorNotAuthorized);if(!database.canWrite(e.field.reference))return $.alert(locale.errorNotAuthorized);var t={};t[e.field.refFieldId]=database.ridOf(e.nid),database.create(e.field.refType,t,(function(t,i){if(t)return $.alert(t);e.select(i._id,!0)}))},tn.prototype.contextmenu=function(e){if(this.query){e.preventDefault();var t=$(e.target),i=t.closest(".t-head-cell");if(i.length){null!=(n=i.attr("data-cidx"))?this.popupColumnMenu(parseInt(n),e):this.popupAddColumnMenu(e)}else{var o=t.closest(".t-foot-cell");if(o.length){var n;null!=(n=o.attr("data-cidx"))?this.popupColumnMenu(parseInt(n),e):this.popupAddColumnMenu(e)}else{var a=t.closest(".t-row");if(a.length){var s=parseInt(a.attr("data-ridx"))+this.ridxTop,r=this.query.rows[s];r&&(this.query.groups[r]||this.popupRowMenu(r,e))}}}}},tn.prototype.popupRowMenu=function(e,t){if(!TOUCH){this.field;var i=this.canUnlink(),o=this.canRemove();if(i||o){var n=this,a=$.backplane({}),s=$('<div class="nx-menu-popup" style="border-radius:4px">').appendTo(a);o&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.removeRecord)).appendTo(s).touch((function(){a.close(),database.remove(e,(function(e){e&&$.alert(e)}))})),i&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.unlink)).appendTo(s).touch((function(){a.close(),n.unlinkFrom(e)}));var r=s.outerWidth(),l=s.outerHeight(),c={left:t.clientX,top:t.clientY};return c.left+r>window.getWidth()&&(c.left=window.getWidth()-r),c.top+l>window.getHeight()&&(c.top=window.getHeight()-l),s.offset(c),!1}}},tn.prototype.click=function(e){if(this.query){var t=$(e.target),i=t.closest(".t-cell-button").attr("data-action");if("find"!==i)if("create"!==i){var o=t.closest(".t-row");if(o.length){var n=parseInt(o.attr("data-ridx"))+this.ridxTop,a=this.query.rows[n];a&&(this.query.groups[a]?(this.query.toggleGroup(a),this.updateHeight(),this.updateRows()):this.select(a))}}else this.addRowCreate();else this.addRowFind()}},tn.prototype.touchHead=function(e){var t=$(e.target).closest(".t-head-cell");if(t.length){var i=t.attr("data-cidx");null!=i?this.popupColumnMenu(parseInt(i),e):this.popupAddColumnMenu(e)}},tn.prototype.select=function(e,t){if(this.query&&e!==this.query.nidSelected){var i=this;this.query.nidSelected=e,this.updateRows();var o={};this.field.isComposition&&(o[this.field.refFieldId]=!0),e?this.popupEditor?this.popupEditor.setNid(e):this.field.isComposition?this.popupEditor=new Yo(e,{hideFields:o,editMode:!0===t,close:function(){i.popupEditor=null,i.unselect()},duplicate:function(){i.duplicate()},prev:function(){i.selectPrev()},next:function(){i.selectNext()},getSelectedNids:function(){return i.getSelectedNids()},create:function(){i.addRowCreate()}}):this.popupEditor=new Yo(e,{hideFields:o,editMode:!0===t,unlink:function(){i.unlink()},close:function(){i.popupEditor=null,i.unselect()},duplicate:function(e){i.duplicate(e)},prev:function(){i.selectPrev()},next:function(){i.selectNext()},getSelectedNids:function(){return i.getSelectedNids()},create:function(){i.addRowCreate()}}):this.popupEditor&&(this.popupEditor.close(),this.popupEditor=null)}},tn.prototype.unlink=function(){if(this.query){var e=this.query.nidSelected;e&&(this.unselect(),this.unlinkFrom(e))}},tn.prototype.unlinkFrom=function(e){this.canUnlink()&&database.update(e,this.field.refFieldId,null,(function(e){e&&$.alert(e)}))},tn.prototype.selectPrev=function(){if(this.query){var e=this.query.nidSelected;if(e){var t=this.query.rows.indexOf(e),i=t>0?this.query.rows[t-1]:0===t?this.query.rows[this.query.rows.length-1]:void 0;i&&this.select(i)}}},tn.prototype.selectNext=function(){if(this.query){var e=this.query.nidSelected;if(e){var t=this.query.rows.indexOf(e),i=t<0?void 0:t<this.query.rows.length-1?this.query.rows[t+1]:this.query.rows[0];i&&this.select(i)}}},tn.prototype.getSelectedNids=function(){if(!this.query)return[];for(var e=this.query.rows,t=this.query.models,i=[],o=0;o<e.length;o++){var n=e[o];t[n]&&i.push(n)}return i},tn.prototype.duplicate=function(){if(this.query){var e=this,t=e.query.nidSelected;t&&database.duplicate(t,(function(t,i){if(t)return $.alert(t);e.select(i,!0)}))}},tn.prototype.unselect=function(){this.select(null)},tn.prototype.bind=function(e){if(this.query){e&&(this.updateIsWritable(),this.updateVisibility(),this.nid=e._id,this.query.nid=e._id,this.reload())}},tn.prototype.updateTable=function(){this.updateHeight(),this.createCells(),this.updateHead(),this.updateFoot(),this.updateRows(),this.resizeColumns(),this.scroll(!0,!1)},tn.prototype.updateHeight=function(){var e=this.query?this.query.rows:[],t=this.minRows,i=this.maxRows,o=this.hasFooter(),n=Math.max(t,Math.min(i,e.length)),a=Math.max(0,n*(this.rowHeight+Zo)+this.headHeight+(o?this.footHeight:0))+1;this.$list.css({height:a})},tn.prototype.hasFooter=function(){if(!this.query)return!1;for(var e=this.query.cols,t=!1,i=0;i<e.length;i++){e[i].agg&&(t=!0)}return t},tn.prototype.createCells=function(){var e=this.$head,t=this.$foot,i=this.$view,o=(this.$body,this.$headCells=[]),n=this.$footCells=[],a=this.query?this.query.cols:[],s=this.maxRows;$EMPTY(e),$EMPTY(t),$EMPTY(i);for(var r=0;r<a.length;r++){var l=a[r],c=$DIV("t-head-cell",e,{"data-cidx":r});$DIV("t-head-resizer",c),$EL("span",c).innerHTML=htmlEscape(l.caption||l.expression.caption),o[r]=c;var d=$DIV("t-foot-cell t-foot-cell-"+l.field.base,t,{"data-cidx":r});n[r]=d}for(var h=s+en,p=[],u=0;u<h;u++){var f=$DIV("t-row",i,{"data-ridx":u});f.style.top=u*(Qo+Zo)+"px";var m=[];for(r=0;r<a.length;r++){l=a[r];m[r]=$DIV("t-cell t-cell-"+l.field.base,f)}var g={$row:f,$cells:m};p.push(g)}this.viewRows=p,this.$selectionContainer=$DIV("t-selection-container",this.$view),this.$selectionEl1=$DIV("t-selection t-selection-row",this.$selectionContainer),this.resizeRows()},tn.prototype.updateRows=function(){this._updateRowsId=(this._updateRowsId||0)+1;const e=this._updateRowsId,t=this.query,i=this.viewRows,o=(t&&t.nidSelected,t?t.models:{}),n=t?t.groups:{},a=t?this.ridxTop:0,s=t?t.cidxGroup:void 0,r=t?t.rows:[],l=t?t.cols:[];let c=0;for(let u=0;u<i.length;u++){const f=i[u],m=f.$row,g=u+a,v=f.$cells;let y=!1,b=!1;if(g<0||g>=r.length)for(let e=0;e<l.length;e++){l[e];const t=v[e];t.innerHTML="",t.style.backgroundColor=""}else{const i=r[g],a=n[i]||o[i];if(a){const o=a.values;y=!1,b=!!n[i],b?c=0:c++;for(let n=0;n<l.length;n++){const a=l[n],r=v[n];if(a.isReadable){const l=o[n],c=r.innerHTML;let h="",p="",u=!1;if(b&&a.agg&&n!==s){const e=a.aggType.format(l);null!=e&&(h=tables.aggTypeToSymbol(a.agg,e))}else{const o=a.field,n=o.base;if("choice"===n){const e=o.getValues()[l];e&&(h+=`\n                                            <div \n                                                class="multicombo-item" \n                                                style="${e.color?"background-color:"+e.color+";color:"+e.textColor:""}"\n                                            >\n                                                ${e.icon?`<div class="choice-symbol ic ic-${e.icon}"></div>`:""}\n                                                <span>${htmlEscape(e.caption||"")}</span>\n                                            </div>`)}else if("dchoice"===n)u=!0,o.loadValue(i,l,t=>{if(e===this._updateRowsId)if(t){const e=`\n                                                <div \n                                                    class="multicombo-item" \n                                                    style="${t.color?"background-color:"+t.color+";color:"+util.contrastingTextColorTo(t.color):""}"\n                                                >\n                                                    ${t.icon?`<div class="choice-symbol ic ic-${t.icon}"></div>`:""}\n                                                    <span>${htmlEscape(t.caption||"")}</span>\n                                                </div>`;r.innerHTML=e,r.style.background=""}else r.innerHTML="",r.style.background=""});else if("multi"===n){const e=util.multiDecode(l);if(e){const t=o.getValues();e.sort((function(e,i){const o=t[e],n=t[i];return o?n?o.order-n.order:-1:0}));for(var d=0;d<e.length;d++){const i=t[e[d]];i&&(h+=`\n                                            <div \n                                                class="multicombo-item" \n                                                style="${i.color?"background-color:"+i.color+";color:"+i.textColor:""}"\n                                            >\n                                                ${i.icon?`<div class="choice-symbol ic ic-${i.icon}"></div>`:""}\n                                                <span>${htmlEscape(i.caption||"")}</span>\n                                            </div>`)}}}else if("dmulti"===n){const t=util.multiDecode(l);t&&(u=!0,o.loadValues(i,(i,o)=>{if(e===this._updateRowsId){o=o||{};let e="";t.sort((function(e,t){const i=o[e],n=o[t];return i?n?i.order-n.order:-1:0}));for(let i=0;i<t.length;i++){const n=o[t[i]];n&&(e+=`\n                                                    <div \n                                                        class="multicombo-item" \n                                                        style="${n.color?"background-color:"+n.color+";color:"+util.contrastingTextColorTo(n.color):""}"\n                                                    >\n                                                        ${n.icon?`<div class="choice-symbol ic ic-${n.icon}"></div>`:""}\n                                                        <span>${htmlEscape(n.caption||"")}</span>\n                                                    </div>`)}r.innerHTML=e,r.style.background=""}}))}else if("color"===n)l&&(h+=`<div\n                                        class="t-cell-content-colored" \n                                        style="background-color:${l}"></div>`);else if("icon"===n)l&&(h='<div class="choice-symbol ic ic-'+l+'"></div>');else if(("number"===n||"string"===n)&&null!=a.conditionalStyling&&a.conditionalStyling.length>0){let e=!1;for(let n=0;n<a.conditionalStyling.length&&!e;n++){const s=a.conditionalStyling[n];switch(s.operand){case"=":l===s.value&&(e=!0);break;case">":l>s.value&&(e=!0);break;case">=":l>=s.value&&(e=!0);break;case"<":l<s.value&&(e=!0);break;case"<=":l<=s.value&&(e=!0);break;case"!=":null!=l&&l!==s.value&&(e=!0);break;case"startsWith":null!=l&&String(l).startsWith(s.value)&&(e=!0);break;case"endsWith":null!=l&&String(l).endsWith(s.value)&&(e=!0);break;case"contains":null!=l&&String(l).includes(s.value)&&(e=!0);break;case"f(x)":{const o=database.loadNodeSync(i),n=queries.parseSystem(database.schema,t.type,s.value,{});if(o&&n){n.evaluateSync(database,o)&&(e=!0)}break}}e&&(h=`\n                                            <div \n                                                class="multicombo-item" \n                                                style="${"background-color:"+(s.background||"")+";color:"+s.color||!1}"\n                                            >\n                                                ${s.icon?`<div class="choice-symbol ic ic-${s.icon}"></div>`:""}\n                                                <span>${htmlEscape(o.format(l))}</span>\n                                            </div>`,p=s.cell||"")}e||(h=htmlEscape(o.format(l)))}else if("styled"===n)l&&(h+=`<div \n                                        class="multicombo-item" \n                                        style="${l.background?`background-color:${l.background};`:""}${l.color?`color:${l.color};`:""}"\n                                    >\n                                        ${l.icon?`<div class="choice-symbol ic ic-${l.icon}"></div>`:""}\n                                        <span>${htmlEscape(l.text||"")}</span>\n                                    </div>`);else if("file"===o.base){if(l){const e=database.thumbURL1(l);e&&(h='<img style="height:40px" src="'+e+'">')}}else{const e=o.format(l);h=htmlEscape(e)}}u||(c!==h&&(r.innerHTML=h),r.style.backgroundColor=p)}else r.innerHTML="",r.style.backgroundColor="#f7f7f7"}}}var h=null==s&&(u+a)%2==0,p="t-row"+(g<0||g>=r.length?" empty":(y?" choosen":b?" group":"")+(h?" t-row-2nd":" t-row-1st"));p!==m.className&&(m.className=p)}this.updateSelection()},tn.prototype.rebalanceColumns=function(e){if(this.query){var t=this.query.cols;if(!(t.length<2)){var i=this.el.width()-1;console.log("Rebalance",i);for(var o=0,n=0,a=0;a<t.length;a++){var s=t[a];a!==e&&(o+=s.width),n+=s.width}if(o<=i){var r=0;for(a=0;a<t.length-1;a++){(s=t[a]).width=Math.floor(s.width*i/n),r+=s.width}t[t.length-1].width=i-r}}}},tn.prototype.resizeColumns=function(){for(var e=this.viewRows,t=this.query?this.query.cols:[],i=this.$headCells,o=this.$footCells,n=0,a=0;a<t.length;a++){n+=(d=t[a]).width}if(t.length>0){var s=this.el.width()-1,r=t[t.length-1];(n<s||n-r.width<s&&r.width+s-n>=50)&&(r.width+=s-n)}for(var l=0;l<e.length;l++){var c=e[l];n=0;for(a=0;a<t.length;a++){var d=t[a];c.$cells[a].style.left=n+"px",c.$cells[a].style.width=d.width+"px",n+=d.width}}n=0;for(a=0;a<t.length;a++){d=t[a];i[a].style.left=n+"px",i[a].style.width=d.width+"px",o[a].style.left=n+"px",o[a].style.width=d.width+"px",n+=d.width}this.viewWidth=n,this.$head.style.width=n+"px",this.$foot.style.width=n+"px"},tn.prototype.updateHead=function(){for(var e=this.query,t=e?e.cols:[],i=e?e.cidxGroup:void 0,o=e?e.cidxSort:0,n=!!e&&!0===e.sortDescending,a=this.$headCells,s=0;s<t.length;s++){var r=t[s],l=a[s],c=s===i,d=s===o,h=!!r.filter,p='<div class="t-head-resizer"></div><span>'+htmlEscape(r.caption||r.expression.caption)+"</span>"+(h?'<div class="i-40-16 i-light-grey i-setting-filter" style="width: 12px;"></div>':"")+(c?'<div class="i-40-18 i-light-grey i-table-group" style="width: 24px"></div>':d?n?'<div class="i-40-12 i-light-grey i-line-down-thick" style="width: 12px"></div>':'<div class="i-40-12 i-light-grey i-line-up-thick" style="width: 12px"></div>':"");l.innerHTML=p}},tn.prototype.updateFoot=function(){for(var e=this.query?this.query.cols:[],t=this.query?this.query.foot.values:[],i=this.$footCells,o=this.hasFooter(),n=0;n<e.length;n++){var a=e[n];if(a.isReadable)if(a.agg){a.aggType.base;var s=a.aggType.format(t[n]);null==s&&(s=""),i[n].innerHTML=tables.aggTypeToSymbol(a.agg,s)}else i[n].innerHTML="";else i[n].innerHTML=""}o?(this.$body.style.bottom="40px",this.$foot.style.display=""):(this.$body.style.bottom="0",this.$foot.style.display="none")},tn.prototype.scrollTo=function(e,t){this.scrollTop=t,this.scrollLeft=e,this.scroll(!1,!0)},tn.prototype.scroll=function(e,t){var i=this.scrollTop,o=this.scrollLeft,n=Math.floor(i/(Qo+Zo)),a=this.ridxTop;n>this.ridxTop+en-1?a=n:n<this.ridxTop&&(a=n-en+1),(a!==this.ridxTop||e)&&(this.ridxTop=a,this.updateRows());var s=i%(Qo+Zo);s<0&&(s+=Qo+Zo);var r=-(s+(n-a)*(Qo+Zo)),l=-o;l!==this.viewX&&(this.$head.style.transform=this.$head.style.WebkitTransform="translate3d("+l+"px,0px,0px)",this.$foot.style.transform=this.$foot.style.WebkitTransform="translate3d("+l+"px,0px,0px)",this.viewX=l),this.$view.style.transform=this.$view.style.WebkitTransform="translate3d("+l+"px,"+r+"px,0px)",this.updateScrollbar(t)},tn.prototype.registerScrollListeners=function(){TOUCH?(this.registerScrollTouchListeners(),this.registerScrollbarVTouchListeners()):(this.registerScrollMouseListeners(),this.registerScrollbarVMouseListeners(),this.registerScrollbarHMouseListeners())},tn.prototype.registerScrollMouseListeners=function(){var e=this;function t(t){if(e.query){var i=e.hasFooter(),o=Math.max(0,e.query.rows.length*(Qo+Zo)-1-e.$list.height()+(i?2*(Qo+Zo):Qo+Zo)),n=OSX_10_9_MODE?-t.wheelDeltaY:t.deltaY*(1==t.deltaMode?Qo+Zo:2==t.deltaMode?window.getHeight():1),a=OSX_10_9_MODE?t.wheelDeltaX:-t.deltaX;Math.abs(a)>Math.abs(n)?n=0:a=0;var s=e.scrollTop,r=Math.min(Math.max(s+n,0),o),l=Math.min(Math.max(0,e.scrollLeft-a),Math.max(0,e.viewWidth-1-e.$list.width()));return e.scrollTo(l,r),t.preventDefault(),!1}}OSX_10_9_MODE?e.$body.addEventListener("mousewheel",t):e.$body.addEventListener("wheel",t)},tn.prototype.registerScrollTouchListeners=function(){var e,t=this,i=0,o=0,n=0,a=0,s=0,r=0,l=0,c=null,d=!1,h=500,p=h*h,u=h/60,f=!0;function m(){if(t.query&&d){var e=t.scrollTop,i=t.scrollLeft,o=Math.max(0,t.query.rows.length*(Qo+Zo)-t.$list.height()+(f?2*(Qo+Zo):Qo+Zo));if(e<0){var n=e-10*e*u/h;Math.abs(n)<.1&&(n=0),t.scrollTo(i,n),requestAnimationFrame(m)}else if(0===e)d=!1;else if(e>o){n=e-10*(e-o)*u/h;Math.abs(n-o)<.1&&(n=o),t.scrollTo(i,n),requestAnimationFrame(m)}else if(e===o)d=!1;else if(l>=h)d=!1;else{var a=1-l*l/p;if(!isNaN(a)){var c=a*s,g=a*r,v=Math.min(Math.max(0,i-c),Math.max(0,t.viewWidth-1-t.$list.width()));n=e-g;t.scrollTo(v,n)}l+=u,requestAnimationFrame(m)}}}t.$body.addEventListener("touchstart",(function(s){return d=!1,i=n=s.touches[0].clientX,o=a=s.touches[0].clientY,e=(new Date).getTime(),c=null,f=t.hasFooter(),s.preventDefault(),!1})),t.$body.addEventListener("touchmove",(function(e){d=!1;var i=e.touches[0].clientX,o=e.touches[0].clientY,s=i-n,r=o-a;c||s*s+r*r>9&&(c=Math.abs(s)>Math.abs(r)?"H":"V"),"H"===c?r=0:s=0;var l=Math.min(Math.max(0,t.scrollLeft-s),Math.max(0,t.viewWidth-1-t.$list.width())),h=t.scrollTop-r;return t.scrollTo(l,h),n=i,a=o,e.preventDefault(),!1})),t.$body.addEventListener("touchend",(function(h){if(c){var p=(new Date).getTime()-e;return s="H"===c?(n-i)*u/p:0,r="V"===c?t.scrollTop<0?0:(a-o)*u/p:0,l=0,d=!0,requestAnimationFrame(m),h.preventDefault(),!1}return t.click(h)}))},tn.prototype.popupColumnMenu=function(e){if(!this.query)return;var t=this,i=this.query,o=i.cols[e];if(!o)return;var n=e===i.cidxSort&&!i.sortDescending,a=e===i.cidxSort&&i.sortDescending,s=e===i.cidxGroup,r=$.backplane({});const l="number"===o.expression.returnType.base?"number":"string"===o.expression.returnType.base?"string":null;var c=$('<div class="nx-menu-popup grey column-menu">').appendTo(r),d=$('<div class="column-menu-section" style="display:flex;display:-webkit-flex;flex-direction:row;-webkit-flex-direction:row">').appendTo(c),h=$('<div style="flex-grow:1;-webkit-flex-grow:1;width:48px">').appendTo(d),p=($('<div style="width:32px;padding:8px"><div class="type-symbol type-symbol-white type-symbol-fn" style="border-radius:4px;background-color:#007AEB"></div></div>').appendTo(d).click((function(){new Ai.a({schema:i.type.schema,type:i.type,variables:{},supportsCommands:!1,value:o.expression.toString(),okay:function(o,n){r.close(),n&&(i.setExpression(e,n),t.reload(),t.saveConfigIfAdminMode())},cancel:function(){}})})),$('<div class="component editor" style="width:100%">').appendTo(h)),u=$('<input type="text">').val(o.caption).attr("placeholder",o.expression.caption).appendTo($('<div class="stringeditor">').appendTo(p)).change((function(){o.caption=u.val()||void 0,r.close(),t.updateTable(),t.saveConfigIfAdminMode()})),f=$('<div class="column-menu-section">').appendTo(c),m=$('<div class="editor" style="width:100%">').appendTo(f),g=tables.createFilterEditor({updateFilter:function(e){e&&r.close(),o.filter=g.getFilter(),t.reload(),t.saveConfigIfAdminMode()}},m,o.field,o.filter),v=$('<div class="column-menu-section">').appendTo(c),y=$('<div class="editor" style="width:100%">').appendTo(v),b=$('<div class="switch table-popup-sorting">').appendTo(y);$('<div class="switch-item'+(n?" selected":"")+'">').append($('<div class="icon i-32-12 i-light-grey i-line-up-thick inline-block inline-block">')).append($("<span>").text(locale.sortAscending)).appendTo(b).click((function(){r.close(),i.sort(e,!1),t.updateTable(),t.saveConfigIfAdminMode()})),$('<div class="switch-item'+(a?" selected":"")+'">').append($('<div class="icon i-32-12 i-light-grey i-line-down-thick inline-block">')).append($("<span>").text(locale.sortDescending)).appendTo(b).click((function(){r.close(),i.sort(e,!0),t.updateTable(),t.saveConfigIfAdminMode()})),$('<div class="switch-item'+(s?" selected":"")+'">').append($('<div class="icon i-32-16 i-light-grey i-table-group">')).append($("<span>").text(locale.grouped)).appendTo(b).click((function(){r.close(),s?(i.ungroup(),t.updateTable()):(i.group(e),t.updateTable()),t.saveConfigIfAdminMode()}));var w=o.field.aggregations;if(w&&w.length){var x=$('<div class="column-menu-section">').appendTo(c),T=$('<div class="editor" style="width:100%">').appendTo(x),C=$('<div class="switch">').appendTo(T);k.each(w,(function(n){$('<div class="switch-item'+(n===o.agg?" selected":"")+'">').text(locale.agg[n]).appendTo(C).click((function(){r.close(),n!==o.agg?i.setAggregation(e,n):i.setAggregation(e,void 0),t.updateTable(),t.saveConfigIfAdminMode()}))}))}null!==l&&$('<div class="buttons">').appendTo(c).append(`<div class="root-help-link">${locale.conditionalStyling}...</div>`).touch((function(){r.close(),new Jo(i.type,o,(function(e){o.conditionalStyling=e,t.updateTable(),t.saveConfigIfAdminMode()}),l)}));var S=$('<div class="buttons">').appendTo(c);$('<div class="nx-button-text grey">').text(locale.hideColumn).appendTo(S).click((function(){r.close(),i.removeColumn(e),t.updateTable(),t.saveConfigIfAdminMode()})),$('<div class="nx-hspace-flex">').appendTo(S),$('<div class="nx-button-text blue">').text(locale.showColumn+"...").appendTo(S).click((function(){r.close(),t.popupAddColumnMenu(e)}));var _=c.outerWidth(),E=c.outerHeight(),D=$(this.$headCells[e]).offset();D.left-=8,D.top+=Qo,D.left+_>window.getWidth()&&(D.left=window.getWidth()-_),D.top+E>window.getHeight()&&(D.top=window.getHeight()-E),c.offset(D)},tn.prototype.popupAddColumnMenu=function(e,t){if(this.query){var i=this.$headCells[e]?$(this.$headCells[e]).offset():this.$list.offset();i.top+=Qo;var o=this,n=this.query,a=[];t||(t=[{type:n.type,path:"",multiple:!1}]),t.length>1?a.push({icon:"i-32-24 i-light-grey i-arrow-solid-left",caption:locale.back,click:b}):a.push({icon:"i-light-grey i-32-24 i-field-fn",caption:locale.function,click:v});var s={};if(this.query.cols)for(var r=0;r<this.query.cols.length;r++){var l=this.query.cols[r].expression;l&&(s[l.toString()]=!0)}var c=t[0].type,d=t[0].path,h=t[0].multiple;s[d+"_id"]||a.push({icon:"i-32-24 i-light-grey i-field-number",caption:locale.id,field:c.field_id,click:m});for(var p=c.sorted,u=0;u<p.length;u++){var f=p[u];(f.isField||f.isReverse||f.isReference)&&(s[d+f.id]||a.push({icon:"i-light-grey i-32-24 i-field-"+f.base,caption:f.caption,field:f,click:m}))}new Xo({offset:i,head:{caption:locale.showColumn},items:a})}function m(){var a=this.field;if(a.isReference){var s=[{type:a.refType,path:d+a.id+".",multiple:h}].concat(t);o.popupAddColumnMenu(e,s)}else if(a.isReverse){s=[{type:a.refType,path:d+a.id+".",multiple:!0}].concat(t);o.popupAddColumnMenu(e,s)}else if(a.isField)if(h){for(var r=[{icon:"i-32-24 i-light-grey i-arrow-solid-left",caption:locale.back,click:y}],l=a.aggregations,c=0;c<l.length;c++){var p=l[c];r.push({caption:locale.agg[p]+"("+a.caption+")",field:a,agg:p,click:g})}new Xo({offset:i,head:{caption:locale.showColumn},items:r})}else n.addColumn(e+1,{expression:d+a.id},(function(){o.rebalanceColumns(e+1),o.updateTable(),o.saveConfigIfAdminMode()}))}function g(){var t=this.agg,i=this.field;n.addColumn(e+1,{expression:t+"("+d+i.id+")"},(function(){o.rebalanceColumns(e+1),o.updateTable(),o.saveConfigIfAdminMode()}))}function v(){new Ai.a({schema:n.type.schema,type:n.type,variables:{},supportsCommands:!1,value:"",okay:function(t,i){i&&n.addColumn(e+1,{expression:i.toString()},(function(){o.rebalanceColumns(e+1),o.updateTable(),o.saveConfigIfAdminMode()}))},cancel:function(){}})}function y(){o.popupAddColumnMenu(e,t)}function b(){var i=t.slice(1);o.popupAddColumnMenu(e,i)}},tn.prototype.isHeightAdjustable=function(){return!0},tn.prototype.setHeight=function(e){var t=Math.max(1,Math.round((e-this.headHeight-this.footHeight)/(this.rowHeight+Zo)));this.field.height=t,this.maxRows=t,this.updateTable()},tn.prototype.setWidth=function(e,t){ao.a.prototype.setWidth.call(this,e,t),this.resizeColumns()},tn.prototype.resize=function(){this.resizeColumns()},tn.prototype.canUnlink=function(){var e=this.field;return!e.isComposition&&this.isWritable()&&database.canWrite(e.reference)},tn.prototype.canRemove=function(){var e=this.field;return this.isWritable()&&database.canDelete(e.refType)},tn.prototype.startEditCaption=wo.prototype.startEditCaption,tn.prototype.registerRowResizeListeners=function(){var e=this;function t(t){const i="touchstart"===t.type;if(!i||1===t.touches.length){var o=t.target;if($(o).is(".t-rowhead-resizer")){var n=i?t.touches[0].clientY:t.clientY,a=e.rowHeight,s=e.scrollTop;i?(EVENT_target(t).addEventListener(EVENT_touchend,l,!1),EVENT_target(t).addEventListener(EVENT_touchmove,r,!1)):(window.addEventListener("mouseup",l,!1),window.addEventListener("mousemove",r,!1)),t.preventDefault(),t.stopPropagation()}}function r(t){if(!i||1===t.touches.length){var o=(i?t.touches[0].clientY:t.clientY)-n;a<40?a+o>40&&(o=Math.max(40-a,o-24)):a+o<40&&(o=Math.min(40-a,o+24));var r=Math.min(120,Math.max(28,Math.round(a+o))),l=r-a;e.rowHeight=r,e.scrollTop=s+s/a*l,e.resizeRows(),e.updateSelection(),e.updateRows(),t.preventDefault()}}function l(t){i&&0!==t.touches.length||(i?(EVENT_target(t).removeEventListener(EVENT_touchend,l,!1),EVENT_target(t).removeEventListener(EVENT_touchmove,r,!1)):(window.removeEventListener("mousemove",r,!1),window.removeEventListener("mouseup",l,!1)),t.preventDefault(),e.saveTableRowHeight(e.rowHeight))}}this.$view.addEventListener(TOUCH?EVENT_touchstart:"mousedown",t,!1)},tn.prototype.resizeRows=function(){for(var e=this.viewRows,t=0;t<e.length;t++){var i=e[t];i.$row.style.top=t*(this.rowHeight+Zo)+"px",i.$row.style.height=this.rowHeight+"px";for(var o=i.$cells,n=this.query?this.query.cols:[],a=this.rowHeight<40?Math.floor((this.rowHeight-18)/2)+"px":"",s=0;s<n.length;s++)o[s].style.paddingTop=a}this.$view.className=this.rowHeight<="40"?"t-view":"t-view t-view-resized-rows"},tn.prototype.registerHeadResizeListeners=function(){var e=this;function t(t){if(e.query&&(!TOUCH||1===t.touches.length)){var o=t.target;if("t-head-resizer"===o.className){var n=o.parentNode.getAttribute("data-cidx");if(n){n=parseInt(n);var a=e.query.cols[n];if(a){var s=a.width,r=TOUCH?t.touches[0].clientX:t.clientX,l=TOUCH?t.touches[0].clientY:t.clientY,c=!1;return TOUCH?(EVENT_target(t).addEventListener(EVENT_touchmove,d,!1),EVENT_target(t).addEventListener(EVENT_touchend,h,!1)):(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",h,!1)),i(t),!1}}}}function d(t){if(!TOUCH||1===t.touches.length){var o=TOUCH?t.touches[0].clientX:t.clientX,n=TOUCH?t.touches[0].clientY:t.clientY,d=o-r,h=n-l,p=Math.abs(d)>Math.abs(h)?d:h;if(Math.abs(p)>1&&(c=!0),c){c=!0;var u=Math.max(32,s+p);a.width=u,e.resizeColumns()}return i(t),!1}}function h(t){if(!TOUCH||0===t.touches.length)return TOUCH?(EVENT_target(t).removeEventListener(EVENT_touchmove,d,!1),EVENT_target(t).removeEventListener(EVENT_touchend,h,!1)):(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",h,!1)),c?e.saveConfigIfAdminMode():e.touchHead(t),i(t),!1}}function i(e){e.preventDefault(),e.stopPropagation()}TOUCH?e.$head.addEventListener(EVENT_touchstart,t,!1):e.$head.addEventListener("mousedown",t,!1)},tn.prototype.registerHeadDragListeners=function(){var e=this;function t(t){if(e.query&&(!TOUCH||1===t.touches.length)){var i=t.target;if("t-head-resizer"!==i.className){for(;i&&"t-head-cell"!==i.className;)i=i.parentNode;if(i){var o=i.getAttribute("data-cidx");if(o){o=parseInt(o);var n=e.query.cols;if(n[o]){for(var a=e.$headCells,s=e.$footCells,r=a[o],l=s[o],c=e.$container.getBoundingClientRect(),d=0,h=0;h<o;h++)d+=n[h].width;var p=TOUCH?t.touches[0].clientX:t.clientX,u=(e.scrollLeft,!1),f=o,m=[];y(),TOUCH?(EVENT_target(t).addEventListener(EVENT_touchmove,g,!0),EVENT_target(t).addEventListener(EVENT_touchend,v,!0)):(window.addEventListener("mousemove",g,!0),window.addEventListener("mouseup",v,!0)),t.preventDefault(),t.stopPropagation()}}}}}function g(t){if(!TOUCH||1===t.touches.length){var i=TOUCH?t.touches[0].clientX:t.clientX,a=i-p;if(Math.abs(a)>3){u=!0,r.style.zIndex="1",r.style.backgroundColor="rgba(200,200,200,.5)",l.style.zIndex="1",l.style.backgroundColor="rgba(200,200,200,.5)";for(var s=e.viewRows,h=0;h<s.length;h++){s[h].$cells[o].style.zIndex=1}}if(u){var g=d+a+"px";r.style.left=g,l.style.left=g;for(s=e.viewRows,h=0;h<s.length;h++)s[h].$cells[o].style.left=g;for(var v=c.left,b=0;b<m.length;b++){var w=n[m[b]],x=v-e.scrollLeft,T=x+w.width/3,C=x+2*w.width/3,k=x+w.width;if(b!==f){if(x<=i&&T>i){f=b,y();break}if(C<i&&k>=i){f=b+1,y();break}}v+=w.width}}t.preventDefault(),t.stopPropagation()}}function v(t){if(!TOUCH||0===t.touches.length){if(TOUCH?(EVENT_target(t).removeEventListener(EVENT_touchmove,g,!0),EVENT_target(t).removeEventListener(EVENT_touchend,v,!0)):(window.removeEventListener("mousemove",g,!0),window.removeEventListener("mouseup",v,!0)),u){r.style.zIndex="",r.style.backgroundColor="",l.style.zIndex="",l.style.backgroundColor="";for(var i=e.viewRows,a=0;a<i.length;a++){i[a].$cells[o].style.zIndex=""}if(o===f)e.resizeColumns();else{var s=void 0!==e.cidxSort?n[e.cidxSort]:void 0,c=void 0!==e.cidxSort?n[e.cidxGroup]:void 0;Object(Ko.b)(n,o,f),s&&(e.cidxSort=n.indexOf(s)),c&&(e.cidxGroup=n.indexOf(c));var d=e.query.models,h=e.query.groups;for(var p in d)if(d.hasOwnProperty(p)){var m=d[p];Object(Ko.b)(m.values,o,f)}for(var y in h)if(h.hasOwnProperty(y)){var b=h[y];Object(Ko.b)(b.values,o,f)}Object(Ko.b)(e.query.foot.values,o,f),e.createCells(),e.resizeColumns(),e.updateHead(),e.updateRows(),e.updateFoot(),e.saveConfigIfAdminMode()}}else e.touchHead(t);t.preventDefault(),t.stopPropagation()}}function y(){m=[];for(var t=0;t<n.length;t++)m[t]=t;m.splice(o,1),m.splice(f,0,o);for(var i=0,r=e.viewRows,l=0;l<r.length;l++){var c=r[l];i=0;for(t=0;t<m.length;t++){var d=n[m[t]].width;if(t!==f)c.$cells[m[t]].style.left=i+"px";i+=d}}i=0;for(t=0;t<m.length;t++){d=n[m[t]].width;if(t!==f)a[m[t]].style.left=i+"px",s[m[t]].style.left=i+"px";i+=d}}}TOUCH?e.$head.addEventListener(EVENT_touchstart,t,!1):e.$head.addEventListener("mousedown",t,!1)},tn.prototype.updateScrollbar=function(e){if(this.query){var t=this.query.rows.length,i=this.scrollTop,o=this.scrollLeft,n=this.hasFooter(),a=this.containerHeight()-(n?2*(Qo+Zo):Qo+Zo),s=Math.max(a,(Qo+Zo)*t),r=this.viewWidth-1,l=this.$container.clientWidth,c=s-1>a,d=r>l,h=a-4,p=l-(c?16:0),u=Math.max(36,Math.round(h*a/s)),f=Math.max(0,Math.min(h-u,Math.round(i/(s-a)*(h-u))))+2,m=Math.max(36,Math.min(p,Math.round(p*(l/r)))),g=Math.max(0,Math.min(p-m,Math.round(o/(r-l)*(p-m))))+2,v=this.$scrollbarV;v.style.top=f+"px",v.style.height=u+"px";var y=this.$scrollbarH;d?(this.$scrollbarHContainer.style.display="",y.style.left=g+"px",y.style.width=m+"px"):this.$scrollbarHContainer.style.display="none",e&&(this.scrollDoneTime=Date.now()+1e3,this.scrollDoneTimeout||(c&&(v.className="t-scrollbar-v scrolling"),d&&(y.className="t-scrollbar-h scrolling"),this.scrollDoneTimeout=setTimeout(this.scrollDone,1e3))),this.$scrollVIndicator.style.opacity=0!=i?1:0}},tn.prototype.scrollDone=function(){var e=Date.now(),t=this.scrollDoneTime-e;t<100?(this.$scrollbarV.className="t-scrollbar-v",this.$scrollbarH.className="t-scrollbar-h",this.scrollDoneTimeout=null):this.scrollDoneTimeout=setTimeout(this.scrollDone,t)},tn.prototype.containerHeight=function(){return this.$list.height()+2},tn.prototype.registerScrollbarVMouseListeners=function(){var e=this;function t(t){if(e.query){t.target;var i=t.clientY,o=e.scrollTop,n=e.query.rows.length,a=e.hasFooter(),s=e.containerHeight()-(a?2*(Qo+Zo):Qo+Zo),r=s-4,l=Math.max(s,(Qo+Zo)*n-1),c=l/r;window.addEventListener("mouseup",h,!1),window.addEventListener("mousemove",d,!1),t.preventDefault()}function d(t){var n=t.clientY-i;e.scrollTo(e.scrollLeft,Math.max(0,Math.min(l-s,Math.round(o+c*n)))),t.preventDefault()}function h(e){window.removeEventListener("mousemove",d,!1),window.removeEventListener("mouseup",h,!1),e.preventDefault()}}this.$scrollbarV.addEventListener("mousedown",t,!1)},tn.prototype.registerScrollbarVTouchListeners=function(){var e=this;function t(t){if(e.query&&1===t.touches.length){var i=t.touches[0].clientY,o=e.scrollTop,n=e.query.rows.length,a=e.hasFooter(),s=e.containerHeight()-(a?2*(Qo+Zo):Qo+Zo),r=s-4,l=Math.max(s,(Qo+Zo)*n-1),c=l/r;EVENT_target(t).addEventListener(EVENT_touchmove,d,!1),EVENT_target(t).addEventListener(EVENT_touchend,h,!1)}function d(t){if(1===t.touches.length){var n=t.touches[0].clientY-i;e.scrollTo(e.scrollLeft,Math.max(0,Math.min(l-s,Math.round(o+c*n)))),t.preventDefault()}}function h(e){0===e.touches.length&&(EVENT_target(e).removeEventListener(EVENT_touchmove,d,!1),EVENT_target(e).removeEventListener(EVENT_touchend,h,!1),e.preventDefault())}}this.$scrollbarV.addEventListener(EVENT_touchstart,t,!1)},tn.prototype.registerScrollbarHMouseListeners=function(){var e=this;function t(t){t.target;var i=t.clientX,o=e.scrollLeft,n=e.$container.clientWidth,a=n-4,s=e.viewWidth-1,r=s/a;function l(t){var a=t.clientX-i;e.scrollTo(Math.max(0,Math.min(s-n,Math.round(o+r*a))),e.scrollTop),t.preventDefault()}function c(e){window.removeEventListener("mousemove",l,!1),window.removeEventListener("mouseup",c,!1),e.preventDefault()}window.addEventListener("mouseup",c,!1),window.addEventListener("mousemove",l,!1),t.preventDefault()}this.$scrollbarH.addEventListener("mousedown",t,!1)},tn.prototype.nodeRenamed=function(e,t,i){var o=this;o.query&&o.query.nodeRenamed(e,t,i,(function(){o.updateAll()}))},tn.prototype.rowY=function(e,t){return((e<t?e:t)-this.ridxTop)*this.rowHeight},tn.prototype.rowH=function(e,t){return(Math.abs(t-e)+1)*this.rowHeight},tn.prototype.updateSelection=function(){var e=1,t=this.query;if(!t)return this.hideSelection();var i=t.rows;if(!t.nidSelected)return this.hideSelection();var o=i.indexOf(t.nidSelected);if(-1===o)return this.hideSelection();this.$selectionContainer.style.display="";var n=this.rowY(o,o),a=this.rowH(o,o)-1,s=this.viewWidth-2,r=this.$selectionEl1;r.style.left=e+"px",r.style.top=n+"px",r.style.width=s-e+"px",r.style.height=a+"px"},tn.prototype.hideSelection=function(){this.$selectionContainer.style.display="none"},tn.prototype.updateButtons=function(){var e=this.field,t=this.container,i=!1,o=!1;this.isWritable()&&database.canWrite(e.reference)&&(i=database.canCreate(e.refType)&&(!e.refType.master||e.refType.master===t.type),o=!e.isComposition),this.$find&&this.$find.css("display",o?"":"none"),this.$create&&this.$create.css("display",i?"":"none"),this.$controls&&this.$controls.css("display",o||i?"":"none")};const on=40;function nn(e,t,i){this.rowHeight=on,this.headHeight=40,this.footHeight=40;var o=this;this.resize=$.proxy(this.resize,this);var n=null,a=null,s=0;this.nid=e,this.field=t,this.options=i,this.viewIsDirty=!1,this.query=new queries.Query(database,Object.assign({},i.viewConfig||t.viewConfig,{type:t.refTypeId,choosen:{}})),this.$backplane=$.backplane({close:$.proxy(this.closed,this)});var r=this.$popup=$('<div class="popupeditor pane">').css({left:32,top:32,right:32,bottom:32}).appendTo(this.$backplane),l=$('<div style="display:flex;display:-webkit-flex;position:absolute;left:16px;top:16px;right:16px">').appendTo(r),c=$('<div class="editor editor-string" style="flex:1 1 auto;-webkit-flex:1 1 auto;padding:0 8px 0 0">').appendTo(l);function d(e){switch(e.which){case 27:return o.close(),!1}}function h(){a&&clearTimeout(a),a=setTimeout(p,200)}function p(e){a=null;var t=o.$search.val().trim();(e||t!==n)&&(n=t,u(++s,t))}async function u(e,t){var i=o.nid,n=o.field,a=o.query,r=a.deps,l=n.isReverse||!1,c=a.getWhereExpression(),d=l?n.reference.constraintExp:n.constraintExp;if(database.find){var h=null;d&&(h=l?d.resolve({a:new queries.This(n.refType),b:new queries.Record(n.type,new queries.Const(schemas.ridOf(i),schemas.tnumber))}):d.resolve({a:new queries.Record(n.type,new queries.Const(schemas.ridOf(i),schemas.tnumber)),b:new queries.This(n.refType)}));var p=c?d?"select "+n.refTypeId+" where ("+c.toString()+") and ("+h.toString()+")":"select "+n.refTypeId+" where ("+c.toString()+")":d?"select "+n.refTypeId+" where ("+h.toString()+")":"select "+n.refTypeId;database.find(p,t,g)}else{var u=c?c.getSyncJS():void 0;if(d){var f=d.getSyncJS(),m=database.loadNodeSync(i);g(void 0,m?l?await database.selectFindSyncJS(n.refTypeId,(function(e){return(!u||u(u.ctx,database,e))&&f(f.ctx,database,void 0,{a:e,b:m})}),t,0):await database.selectFindSyncJS(n.refTypeId,(function(e){return(!u||u(u.ctx,database,e))&&f(f.ctx,database,void 0,{a:m,b:e})}),t,0):[])}else g(void 0,u?await database.selectFindSyncJS(n.refTypeId,(function(e){return u(u.ctx,database,e)}),t,0):await database.selectFindSyncJS(n.refTypeId,void 0,t,0))}function g(t,i){e===s&&database.loadNodes2(i,r,(function(){if(e===s){if(t)return v(t);if(l){for(var o=n.refFieldId,a=[],r=0;r<i.length;r++){var c=i[r],d=database.loadNodeSync(c);if(d)d[o]||a.push(c)}v(void 0,a)}else v(void 0,i)}}))}function v(t,i){e===s&&(t&&$.alert(t),a.loadNids(i||[],(function(){o.updateHeight(),o.updateHead(),o.updateFoot(),o.updateRows()})))}}this.$search=$('<input type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">').attr("placeholder",locale.refFinderSearchCaption+" "+(t.refType.caption||t.refType.id)).appendTo($('<div class="stringeditor">').appendTo(c)).keydown(d).keyup(h).change(h),i.create&&($('<div class="nx-button-text blue" style="flex:0 0 auto;-webkit-flex:0 0 auto">').text(locale.createRecord).appendTo(l).touch((function(){o.close(),i.create()})),$('<div class="nx-hspace-small">').appendTo(l)),$('<div class="nx-button-text grey" style="flex:0 0 auto;-webkit-flex:0 0 auto">').text(locale.cancel).appendTo(l).touch($.proxy(this.close,this)),this.el=this.$list=$('<div class="list">').appendTo($('<div class="editor editor-rev" style="position:absolute;top:56px;left:8px;right:8px;bottom:8px">').appendTo(r)).touch($.proxy(this.click,this)),this.$container=$DIV("t-container",this.$list[0]),this.$head=$DIV("t-head",this.$container),this.$foot=$DIV("t-foot",this.$container),this.$body=$DIV("t-body",this.$container),this.$content=$DIV("t-content",this.$body),this.$view=$DIV("t-view hoverable",this.$content),this.$headCells=[],this.$footCells=[],this.$scrollbarVContainer=$DIV("t-scrollbar-v-container",this.$container),this.$scrollbarV=$DIV("t-scrollbar-v",this.$scrollbarVContainer),this.$scrollbarHContainer=$DIV("t-scrollbar-h-container",this.$container),this.$scrollbarHContainer.style.left=0,this.$scrollbarHContainer.style.bottom=0,this.$scrollbarH=$DIV("t-scrollbar-h",this.$scrollbarHContainer),this.$scrollVIndicator=$DIV("t-scroll-v-indicator",this.$container),this.ridxTop=0,this.scrollTop=0,this.scrollLeft=0,this.scrollDoneTimeout=null,this.scrollDoneTime=0,this.scrollDone=$.proxy(this.scrollDone,this),this.viewWidth=0,this.viewRows=[],this.minRows=this.maxRows=Math.max(1,Math.floor((window.getHeight()-144)/40)-(this.hasFooter()?2:1)),this.registerScrollListeners(),this.registerHeadResizeListeners(),this.registerHeadDragListeners(),this.updateTable(),window.addEventListener("resize",this.resize),database.on("rename",void 0,this.nodeRenamed,this),this.$search.focus(),this.reload=function(){a&&clearTimeout(a),p(!0)},h()}nn.prototype.click=function(e){var t=$(e.target),i=t.closest(".t-foot-cell");if(i.length){var o=i.attr("data-cidx");null!=o?this.popupColumnMenu(parseInt(o),e):this.popupAddColumnMenu(e)}else{var n=t.closest(".t-row");if(n.length){var a=parseInt(n.attr("data-ridx"))+this.ridxTop,s=this.query.rows[a];s&&(this.query.groups[s]?(this.query.toggleGroup(s),this.updateHeight(),this.updateRows()):(this.options.select&&this.options.select(s),this.close()))}}},nn.prototype.touchHead=tn.prototype.touchHead,nn.prototype.closed=function(){this.viewIsDirty&&this.options.saveViewConfig&&this.options.saveViewConfig(this.query.getConfig()),database.off("rename",void 0,this.nodeRenamed,this),window.removeEventListener("resize",this.resize)},nn.prototype.close=function(){this.$backplane.close()},nn.prototype.add=function(){},nn.prototype.resize=function(){this.updateTable()},nn.prototype.registerHeadResizeListeners=tn.prototype.registerHeadResizeListeners,nn.prototype.registerHeadDragListeners=tn.prototype.registerHeadDragListeners,nn.prototype.updateAll=tn.prototype.updateAll,nn.prototype.updateTable=tn.prototype.updateTable,nn.prototype.createCells=tn.prototype.createCells,nn.prototype.tableHeadDropped=tn.prototype.tableHeadDropped,nn.prototype.rebalanceColumns=tn.prototype.rebalanceColumns,nn.prototype.resizeColumns=tn.prototype.resizeColumns,nn.prototype.columnResizeDrag=tn.prototype.columnResizeDrag,nn.prototype.updateHeight=function(){this.minRows=this.maxRows=Math.max(1,Math.floor((window.getHeight()-144)/40)-(this.hasFooter()?2:1)),tn.prototype.updateHeight.call(this)},nn.prototype.updateRows=tn.prototype.updateRows,nn.prototype.updateHead=tn.prototype.updateHead,nn.prototype.updateFoot=tn.prototype.updateFoot,nn.prototype.scroll=tn.prototype.scroll,nn.prototype.scrollTo=tn.prototype.scrollTo,nn.prototype.registerScrollListeners=tn.prototype.registerScrollListeners,nn.prototype.registerScrollMouseListeners=tn.prototype.registerScrollMouseListeners,nn.prototype.registerScrollTouchListeners=tn.prototype.registerScrollTouchListeners,nn.prototype.popupColumnMenu=tn.prototype.popupColumnMenu,nn.prototype.popupAddColumnMenu=tn.prototype.popupAddColumnMenu,nn.prototype.saveConfigIfAdminMode=function(){this.viewIsDirty=!0},nn.prototype.hasFooter=tn.prototype.hasFooter,nn.prototype.updateScrollbar=tn.prototype.updateScrollbar,nn.prototype.scrollDone=tn.prototype.scrollDone,nn.prototype.containerHeight=tn.prototype.containerHeight,nn.prototype.registerScrollbarVMouseListeners=tn.prototype.registerScrollbarVMouseListeners,nn.prototype.registerScrollbarVTouchListeners=tn.prototype.registerScrollbarVTouchListeners,nn.prototype.registerScrollbarHMouseListeners=tn.prototype.registerScrollbarHMouseListeners,nn.prototype.nodeRenamed=tn.prototype.nodeRenamed,nn.prototype.isWritable=tn.prototype.isWritable,nn.prototype.updateSelection=tn.prototype.updateSelection,nn.prototype.hideSelection=tn.prototype.hideSelection,nn.prototype.resizeRows=tn.prototype.resizeRows;var an=o("./src/js/widgets/editors/ChoiceEditor.js");class sn{constructor(e){Je()(this,"reference",void 0),Je()(this,"editor",void 0),this.reference=e,this.editor=new an.a({el:this.reference.el,setError:e=>this.reference.setError(e),editorUp:()=>this.reference.container.editorUp(),editorDown:()=>this.reference.container.editorDown(),getNid:()=>this.reference.getNid(),focus:()=>this.reference.focus(),focusNext:()=>this.reference.focusNext(),focusPrev:()=>this.reference.focusPrev()},{field:this.reference.field,onUpdate:()=>{},offUpdate:()=>{},getValue:e=>e(void 0,this.reference.value),setValue:(e,t)=>this.reference.update(e,t),isWritable:()=>this.reference.isWritable()})}destroy(){this.editor.destroy()}nodeChanged(){this.editor.load(!1)}updateButtons(){}updateStructure(){this.editor.updateStructure(),this.editor.load(!0)}resize(){this.editor.resizeAux()}focus(){this.editor.focus()}startEdit(){this.editor.startEdit()}stopEdit(){this.editor.stopEdit()}}class rn{constructor(e){Je()(this,"reference",void 0),Je()(this,"subDocument",void 0),Je()(this,"$subDocument",void 0),Je()(this,"$search",void 0),Je()(this,"$create",void 0),Je()(this,"$find",void 0),Je()(this,"$unlink",void 0),this.reference=e,this.$create=$('<div class="stringeditor-button2"><div class="i-32-18 i-light-grey i-setting-add"></div></div>').attr("title",Object(b.getLocale)().addRowCreate).click(()=>(this.reference.create(),!1)),this.$find=$('<div class="stringeditor-button"><div class="button i-32-18 i-light-grey i-search"></div></div>').attr("title",Object(b.getLocale)().addRowFind).click(()=>(this.reference.find(),!1)),this.$search=$('<div class="stringeditor">').append('<div class="input-text text-selectable">').append(this.$create).append(this.$find).appendTo(this.reference.el).click(()=>this.reference.find()),this.$subDocument=$('<div class="subdocument" style="display:none">').appendTo(this.reference.el);const t=$('<div class="subdocument-head">').appendTo(this.$subDocument),i=$('<div class="subdocument-tabs">').appendTo(t);this.$unlink=$('<div class="subdocument-unlink i-light-grey i-18 i-unlink">').attr("title",Object(b.getLocale)().unlink).click(()=>(this.reference.unlink(),!1)).appendTo(t);const o=$('<div class="subdocument-container">').appendTo(this.$subDocument);this.subDocument=new Ao({containerEl:o,tabsEl:i,isEmbedded:!0,updateBackground:()=>{}},this.reference.field.refTypeId,{},void 0)}destroy(){this.subDocument.destroy(),this.$subDocument.remove(),this.$search.remove()}nodeChanged(){const e=this.reference.getRef();e?window.database.loadNode(e,(e,t)=>{this.updateSubDocument(t)}):this.updateSubDocument(void 0)}updateButtons(){const e=this.reference.getRef();let t=!1,i=!1,o=!1;this.reference.isWritable()&&(t=!e&&window.database.canCreate(this.reference.field.refType)&&!this.reference.field.refType.master,o=!!e&&!this.reference.field.cascade,i=!e),this.$create&&(this.$create[0].style.display=t?"":"none"),this.$find&&(this.$find[0].style.display=i?"":"none"),this.$unlink&&(this.$unlink[0].style.display=o?"":"none")}updateStructure(){this.subDocument&&this.subDocument.updateStructure()}resize(){this.subDocument.resize()}updateSubDocument(e){e?(this.$search.css("display","none"),this.$subDocument.css("display",""),this.subDocument.bind(e)):(this.$search.css("display",""),this.$subDocument.css("display","none"),this.subDocument.bind(null))}}class ln{constructor(e){Je()(this,"reference",void 0),Je()(this,"content",void 0),Je()(this,"text",void 0),Je()(this,"$create",void 0),Je()(this,"$find",void 0),Je()(this,"$unlink",void 0),this.reference=e,this.content=$('<div class="stringeditor">').appendTo(this.reference.el).click(()=>(this.reference.open(),!1)),this.text=$('<div class="input-text text-selectable">').appendTo(this.content),this.$create=$('<div class="stringeditor-button2"><div class="i-32-18 i-light-grey i-setting-add"></div></div>').attr("title",Object(b.getLocale)().addRowCreate).click(()=>(this.reference.create(),!1)).appendTo(this.content),this.$find=$('<div class="stringeditor-button"><div class="button i-32-18 i-light-grey i-search"></div></div>').attr("title",Object(b.getLocale)().addRowFind).click(()=>(this.reference.find(),!1)).appendTo(this.content),this.$unlink=$('<div class="stringeditor-button"><div class="button i-32-18 i-light-grey i-unlink"></div></div>').attr("title",Object(b.getLocale)().unlink).click(()=>(this.reference.unlink(),!1)).appendTo(this.content)}destroy(){this.content.remove()}nodeChanged(){this.reference.formatReference(e=>{this.text[0].innerText=e})}updateButtons(){const e=this.reference.isWritable(),t=this.reference.getRef();let i=!1,o=!1,n=!1;e&&(i=!t&&window.database.canCreate(this.reference.field.refType)&&!this.reference.field.refType.master,n=!!t&&!this.reference.field.cascade,o=!t),this.$create&&(this.$create[0].style.display=i?"":"none"),this.$find&&(this.$find[0].style.display=o?"":"none"),this.$unlink&&(this.$unlink[0].style.display=n?"":"none")}updateStructure(){}resize(){}}function cn(e){const{values:t,isSelected:i,setSelected:o}=e;return s.createElement("div",{className:"choiceradio"},t.map(e=>s.createElement(dn,{key:e.id,value:e,isSelected:i(e.id),onClick:t=>{o(e.id,!i(e.id))}})))}function dn(e){const{isSelected:t,value:i,onClick:o}=e;return s.createElement("div",{onClick:o,className:"choiceradio-item"+(t?" selected":""),style:{backgroundColor:t&&i.color?i.color:"",color:e.isSelected?e.value.textColor:""}},s.createElement("div",{className:"choiceradio-item-radio-container"},s.createElement("div",{className:"choiceradio-item-radio"})),i.icon?s.createElement("div",{className:"choice-symbol ic ic-"+i.icon}):null,s.createElement("div",{className:"choiceradio-item-text",style:{color:t&&i.textColor||""}},i.caption))}class hn{constructor(e){Je()(this,"reference",void 0),Je()(this,"el",void 0),Je()(this,"isDestroyed",!1),Je()(this,"isReady",!1),Je()(this,"query",void 0),this.reference=e,this.el=document.createElement("div"),this.reference.el[0].appendChild(this.el)}destroy(){var e;this.isDestroyed||(this.isDestroyed=!0,a.a.unmountComponentAtNode(this.el),null===(e=this.el.parentElement)||void 0===e||e.removeChild(this.el))}nodeChanged(){this.isDestroyed||this.load()}updateButtons(){}updateStructure(){}resize(){}load(){this.isReady=!1,this.query&&(this.query.destroy(),this.query=void 0),this.reference.field.viewConfig&&(this.reference.field.viewConfig.type=this.reference.field.refTypeId),this.query=new b.QueryReference(window.database,this.reference.field,this.reference.container.nid),this.query.load(()=>{this.isDestroyed||this.updateDOM(this.el),this.isReady=!0})}getValues(){const e=this.query;if(!e)return[];window.database,this.reference.field;let t=0;return e.rows.slice(0,100).map(i=>{const o=e.models[i];let n,a,s;const r=[];if(o)for(let t=0;t<e.cols.length;t++){const i=e.cols[t].expression.returnType;"icon"===i.base?n=o.values[t]:"color"===i.base?(a=o.values[t],s=a?b.util.contrastingTextColorTo(a):void 0):r.push(i.format(o.values[t]))}return t++,{id:i,caption:r.join(" "),color:a,textColor:s,icon:n,order:t}})}getValue(){return this.reference.getRef()}setValue(e){this.isReady&&(null===e&&this.reference.field.required||this.reference.update(e?window.database.ridOf(e):null))}}class pn extends hn{constructor(e){super(e)}updateDOM(e){a.a.render(s.createElement(cn,{values:this.getValues(),isSelected:e=>e===this.getValue(),setSelected:(e,t)=>this.setValue(t?e:null)}),e)}}function un(e){const{values:t,isSelected:i,setSelected:o}=e;return s.createElement("div",{className:"choiceswitch"},t.map(e=>s.createElement(fn,{key:e.id,value:e,isSelected:i(e.id),onClick:t=>{o(e.id,!i(e.id))}})))}function fn(e){const{isSelected:t,value:i,onClick:o}=e;return s.createElement("div",{onClick:o,className:"choiceswitch-item"+(t?" selected":""),style:{backgroundColor:t&&i.color?i.color:"",color:e.isSelected?e.value.textColor:""}},i.icon?s.createElement("div",{className:"choice-symbol ic ic-"+i.icon}):null,s.createElement("span",null,i.caption))}class mn extends hn{constructor(e){super(e)}updateDOM(e){a.a.render(s.createElement(un,{values:this.getValues(),isSelected:e=>e===this.getValue(),setSelected:(e,t)=>this.setValue(t?e:null)}),e)}}class gn extends ao.a{constructor(e,t,i){super(),Je()(this,"container",void 0),Je()(this,"field",void 0),Je()(this,"visible",void 0),Je()(this,"value",void 0),Je()(this,"error",void 0),Je()(this,"editor",void 0),Je()(this,"el",void 0),Je()(this,"label",void 0),Je()(this,"renderer",void 0),Je()(this,"currentLoadingId",0),this.container=e,this.field=i,this.visible=!0,this.value=void 0,this.error=null,this.editor=void 0,this.el=$('<div class="component">').appendTo(t.el).data("component",this).attr("title",i.tooltip||"").addClass(Object(bo.d)(i)),this.updateElementWidth(),"left"===i.labelPosition&&this.el.addClass("label-left"),this.label=$("<label>").text(i.caption||Object(b.getLocale)().unnamed).css("display","placeholder"===i.labelPosition||"none"===i.labelPosition?"none":"").appendTo(this.el),this.updateEditor(),this.updateButtons()}updateStructure(){this.el.attr("title",this.field.tooltip||""),this.updateElementWidth(),this.label.text(this.field.caption||Object(b.getLocale)().unnamed).css("display","placeholder"===this.field.labelPosition||"none"===this.field.labelPosition?"none":""),this.el.toggleClass("label-left","left"===this.field.labelPosition),this.updateEditor(),this.nodeChanged(),this.editor&&this.editor.updateStructure()}updateEditor(){const e=this.field.referenceRenderer;if(!this.editor||e!==this.renderer)switch(this.editor&&(this.editor.destroy(),this.editor=void 0),this.renderer=e,e){case"embed":this.editor=new rn(this);break;case"combo":this.editor=new sn(this);break;case"switch":this.editor=new mn(this);break;case"radio":this.editor=new pn(this);break;default:this.editor=new ln(this)}}updateButtons(){this.editor&&this.editor.updateButtons()}resize(){this.editor&&this.editor.resize()}destroy(){this.editor&&this.editor.destroy(),this.el.remove()}bind(){this.nodeChanged()}nodeChanged(){this.updateIsWritable(),this.updateVisibility(),this.updateButtons();const e=this.container.nid;e&&window.database.loadNode(e,(e,t)=>{this.value=!e&&t?t[this.field.id]:void 0,this.editor&&this.editor.nodeChanged(),this.updateButtons(),this.validate(this.value)})}find(){if(!this.isWritable())return;const e=this.container.nid;e&&new nn(e,this.field,{backButtonCaption:this.field.type.caption,select:e=>{this.update(window.database.ridOf(e))},saveViewConfig:e=>{this.saveConfigIfAdminMode(e)},create:window.database.canCreate(this.field.refType)?()=>{this.create()}:void 0})}update(e,t){window.database.update(this.container.nid,this.field.id,e,e=>{e&&$.alert(e),t&&t(e)})}saveConfigIfAdminMode(e){Object(bo.b)()&&this.saveConfig(e)}saveConfig(e){this.field.viewConfig=e,this.field.type.schema.trigger("change")}create(){if(!this.isWritable())return;if(!window.database.canCreate(this.field.refType))return;const e=this.container.nid;if(!e)return;const t={};t[this.field.refFieldId]=[b.schemas.ridOf(e)],window.database.create(this.field.refType,t,(e,t)=>{if(e)return $.alert(e);t?(this.value=b.schemas.ridOf(t._id),this.open()):this.value=void 0})}unlink(){const e=this.container.nid;e&&window.database.update(e,this.field.id,null,e=>{if(e)return $.alert(e)})}open(){if(this.value){const e=this.getRef();if(this.field.isComposition)new kn.PopupEditor(e,{});else{const t=new kn.PopupEditor(e,{unlink:()=>{t.close(),this.unlink()}})}}else this.find()}validate(e){const t=this.field.validate(e);return t?(this.setError(t),!1):(this.setError(void 0),!0)}startEditCaption(){wo.prototype.startEditCaption.call(this)}formatReference(e){if(!this.value)return void e("");const t=this.getRef();window.database.loadNode(t,(t,i)=>{i?this.field.referenceFormatExp?this.field.referenceFormatExp.evaluate(window.database,i,(t,i)=>{e(t?"ERROR: "+t:this.field.referenceFormatExp.returnType.format(i)||"")}):e(this.field.refType.format(i)||""):e("")})}loadRecords(e,t){const i=this.currentLoadingId+1;this.currentLoadingId=i;const o=this,n=window.database,a=this.container.nid,s=this.field,r=s.constraintExp,l={};if(window.NINOX_APP)if(r){const t=r.getSyncJS(),i=n.loadNodeSync(a);c(void 0,i?n.selectFindSyncJS(s.refTypeId,e=>t(t.ctx,n,void 0,{a:i,b:e}),e,0):[])}else c(void 0,n.selectFindSyncJS(s.refTypeId,void 0,e,0));else{let t=null;r&&(t=r.resolve({a:new b.queries.Record(s.type,new b.queries.Const(b.schemas.ridOf(a),b.schemas.tnumber)),b:new b.queries.This(s.refType)}));const i=r?"select "+s.refTypeId+" where ("+t.toString()+")":"select "+s.refTypeId;n.find(i,e,c)}function c(e,t){i===o.currentLoadingId&&n.loadNodes2(t,l,()=>{if(i===o.currentLoadingId)return e?d(e):void d(void 0,t)})}function d(e,n){i===o.currentLoadingId&&(e&&$.alert(e),t(n||[]))}}getNid(){return this.container.nid}getRef(){return this.value?this.field.refTypeId+this.value:void 0}focus(){var e;if(!this.visible)return!1;if(!this.isWritable())return!1;if(null===(e=this.editor)||void 0===e?void 0:e.focus){if(window.NINOX_IOS)this.editor.focus();else{var t;const e=this.container&&this.container.el||this.el.parent(),i=e.offset().top,o=i+e.height(),n=e.scrollTop(),a=(null===(t=this.el.offset())||void 0===t?void 0:t.top)||0,s=(this.el.height()||0)+a+8;a<i?e.scrollTop(n-(i-a)):s>o&&e.scrollTop(n+(s-o)),setTimeout(()=>{var e;(null===(e=this.editor)||void 0===e?void 0:e.focus)&&this.editor.focus()},0)}return!0}return!1}}function vn(e,t,i){var o=this;this.container=e,this.tab=t,this.field=i,this.visible=!0,this.reverseRenderer=i.reverseRenderer,this.cachedViewConfig=util.getPersistentViewConfig(i.viewConfig),this.query=new queries.QueryReverse(database,i,void 0),this.popupEditor=null,this.el=$('<div class="component editor reversefield">').data("component",this).attr("title",i.tooltip||"").touch($.proxy(this.clicked,this)),this.updateElementWidth(),this.el.appendTo(t.el),this.label=$("<label>").text(i.caption||locale.unnamed).appendTo(this.el),this.$content=$('<div class="stringeditor">').appendTo(this.el),this.$text=$('<div class="input-text reversefield-items">').appendTo(this.$content),this.$create=$('<div class="stringeditor-button2"><div class="i-32-18 i-light-grey i-setting-add"></div></div>').attr("title",locale.addRowCreate).touch((function(){return o.addRowCreate(),!1})).appendTo(this.$content),this.$find=$('<div class="stringeditor-button"><div class="button i-32-18 i-light-grey i-search"></div></div>').attr("title",locale.addRowFind).touch((function(){return o.addRowFind(),!1})).appendTo(this.$content),this.updateButtons(),this.updateHeight(),database.on("rename",void 0,this.nodeRenamed,this)}function yn(e,t,i){this.container=e,this.tab=t,this.field=i,this.visible=!0,this.reverseRenderer=i.reverseRenderer,this.el=$('<div class="component editor">').appendTo(t.el).data("component",this).attr("title",i.tooltip||""),this.label=$("<label>").text(i.caption||locale.unnamed).appendTo(this.el),this.$content=$('<div style="background-color:green;height:32px;width:200px">LIST</div>').appendTo(this.el)}Object.assign(vn.prototype,ao.a.prototype),vn.prototype.updateStructure=function(){var e=this.field;this.el.attr("title",e.tooltip||""),this.updateElementWidth(),this.label.text(e.caption||locale.unnamed),util.viewConfigEquals(e.viewConfig,this.cachedViewConfig)||(this.cachedViewConfig=util.getPersistentViewConfig(this.field.viewConfig),this.query=new queries.QueryReverse(database,e,void 0),this.updateTable()),this.updateButtons(),this.updateHeight(),this.reload()},vn.prototype.updateRows=vn.prototype.updateTable=vn.prototype.updateAll=function(){for(var e=this.query,t=e.nidSelected,i=e.rows,o=e.cols,n=e.models,a="",s=(e.type,this.canUnlink()),r=0;r<i.length;r++){var l=i[r],c=n[l];if(c){for(var d=[],h=0;h<o.length;h++){var p=o[h],u=c.values[h];if(null!=u){var f=p.field.format(u);f&&d.push(f)}}var m=d.join(" ")||locale.unnamed;a+='<div class="reversefield-item'+(l===t?" selected":"")+'" data-nid="'+l+'"><span>'+htmlEscape(m)+"</span>"+(s?'<div class="icon-medium-black icon-medium-unlink"></div>':"")+"</div>"}}this.$text.html(a),this.updateButtons()},vn.prototype.updateHead=function(){},vn.prototype.updateFoot=function(){},vn.prototype.clicked=function(e){var t=$(e.target),i=t.closest(".reversefield-item").attr("data-nid");i&&(t.is(".icon-medium-unlink")?this.unlinkFrom(i):this.select(i))},vn.prototype.reload=tn.prototype.reload,vn.prototype.bind=tn.prototype.bind,vn.prototype.destroy=tn.prototype.destroy,vn.prototype.nodeChanged=tn.prototype.nodeChanged,vn.prototype.addRowFind=tn.prototype.addRowFind,vn.prototype.addRowCreate=tn.prototype.addRowCreate,vn.prototype.select=tn.prototype.select,vn.prototype.unselect=tn.prototype.unselect,vn.prototype.unlinkFrom=tn.prototype.unlinkFrom,vn.prototype.selectPrev=function(){},vn.prototype.selectNext=function(){},vn.prototype.getSelectedNids=function(){return[]},vn.prototype.duplicate=tn.prototype.duplicate,vn.prototype.canUnlink=tn.prototype.canUnlink,vn.prototype.canRemove=tn.prototype.canRemove,vn.prototype.isWritable=tn.prototype.isWritable,vn.prototype.nodeRenamed=tn.prototype.nodeRenamed,vn.prototype.isHeightAdjustable=function(){return!0},vn.prototype.setHeight=function(e){var t=this.field,i=t.height,o=Math.max(1,Math.round(e/32));o!==i&&(this.$content.css({height:32*o-2}),this.$text.css({"white-space":o>1?"normal":""}),t.height=o)},vn.prototype.updateHeight=function(){var e=this.field.height||1;e=Math.max(1,Math.min(32,e));this.$content.css({height:32*e-2}),this.$content.toggleClass("input-text-multiline",e>1),this.$text.css({"white-space":e>1?"normal":""})},vn.prototype.startEditCaption=wo.prototype.startEditCaption,vn.prototype.updateButtons=tn.prototype.updateButtons,Object.assign(yn.prototype,ao.a.prototype);class bn extends ao.a{constructor(e,t,i){super(),Je()(this,"container",void 0),Je()(this,"tab",void 0),Je()(this,"field",void 0),Je()(this,"el",void 0),Je()(this,"label",void 0),Je()(this,"content",void 0),Je()(this,"isDestroyed",!1),Je()(this,"query",void 0),Je()(this,"nid",void 0),this.container=e,this.tab=t,this.field=i,this.el=$('<div class="component editor choice">').data("component",this).attr("title",i.tooltip||""),this.updateElementWidth(),this.el.appendTo(t.el),this.label=$("<label>").text(i.caption||Object(b.getLocale)().unnamed).appendTo(this.el),this.content=$("<div>").appendTo(this.el)}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.query&&(this.query.destroy(),this.query=void 0),a.a.unmountComponentAtNode(this.content[0]),this.el.remove(),super.destroy())}bind(e){this.query&&(this.query.destroy(),this.query=void 0),this.field.viewConfig&&(this.field.viewConfig.type=this.field.refTypeId),this.query=new b.Query(window.database,this.field.viewConfig||{type:this.field.refTypeId},!1),this.nid=e._id,this.reload()}updateStructure(){}isHeightAdjustable(){return!0}setHeight(e){}updateHeight(){}startEditCaption(){}reload(){this.query&&this.query.load(()=>this.queryLoaded())}queryLoaded(){this.isDestroyed||this.updateDOM()}getValues(){const e=this.query;return e?e.rows.slice(0,100).map(t=>{const i=e.models[t];let o,n,a;const s=[];if(i)for(let t=0;t<e.cols.length;t++){const r=e.cols[t].expression.returnType;"icon"===r.base?o=i.values[t]:"color"===r.base?(n=i.values[t],a=n?b.util.contrastingTextColorTo(n):void 0):s.push(r.format(i.values[t]))}return{id:b.util.ridOf(t),caption:s.join(" "),color:n,textColor:a,icon:o}}):[]}isSelected(e){const t=window.database.loadNodeSync(this.nid);if(!t)return!1;const i=t[this.field.id];return!!i&&-1!==i.indexOf(parseInt(e,10))}setSelected(e,t){const i=this.field.refTypeId+e;window.database.update(i,this.field.refFieldId,t?b.util.ridOf(this.nid):null,()=>{this.reload()})}updateDOM(){this.isDestroyed||a.a.render(s.createElement(cn,{values:this.getValues(),isSelected:e=>this.isSelected(e),setSelected:(e,t)=>this.setSelected(e,t)}),this.content[0])}}function wn(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component space">').data("component",this).attr("title",i.tooltip||"").css("height",i.height||64),this.updateElementWidth(),this.el.appendTo(t.el)}function xn(e,t){this.container=e,this.id=t.id,this.field=t,this.visible=!1,this.hidden=!1,this.toolbox=void 0,this.children=[],this.components=[],this.elTab=$('<div class="tab">').attr("title",t.tooltip||"").touch($.proxy(this.clicked,this)).on("contextmenu",$.proxy(this.clicked,this)),this.textContainer=$("<div>").appendTo(this.elTab),this.tabSelectedIndicator=$('<div class="tab-selected-indicator">'),this.el=null,this.updateTab()}function Tn(e,t,i){this.container=e,this.field=i,this.visible=!0,this.el=$('<div class="component text">').data("component",this).attr("title",i.tooltip||""),this.updateElementWidth(),this.el.appendTo(t.el),this.label=$("<label>").text(i.caption).appendTo(this.el),this.updateStyle()}function Cn(e,t,i){tn.call(this,e,t,i),this._cachedFn=i.fn}Object.assign(wn.prototype,ao.a.prototype),wn.prototype.updateStructure=function(){var e=this.field;this.el.css("height",e.height||64).attr("title",e.tooltip||""),this.updateElementWidth()},wn.prototype.isHeightAdjustable=function(){return!0},wn.prototype.setHeight=function(e){this.field.height=8*Math.max(1,Math.min(64,Math.round(e/8))),this.updateStructure()},xn.prototype.show=function(){if(this.hidden)return;if(this.visible)return;this.visible=!0;var e=this.container,t=this.children;let i=e.currentTab;i||(i={hide:function(e){e()}}),i.hide(()=>{e.currentTab=this,this.elTab.addClass("selected"),this.tabSelectedIndicator.appendTo(this.elTab),this.el=$('<div class="form">').appendTo(e.containerEl||e.el),Object(c.c)(this.field.beforeShow,this.container.nid,i=>{i&&$.alert(i),this.components=[];for(var o=0;o<t.length;o++){var n=t[o],a=this.createComponent(n);a&&this.components.push(a)}var s=e.node;s&&this.bind(s),this.container.updateBackground(this.field.bgColor),this.updateTab()})})},xn.prototype.updateTab=function(){var e=this.field;this.textContainer.text(e.caption),this.elTab.attr("title",e.tooltip||"")},xn.prototype.createComponent=function(e){if(database.canRead(e)&&(!e.viewConfig||"none"!==e.viewConfig.mode)&&(!e.visibilityExp||!e.visibilityExp.isConstant()||e.visibilityExp.evaluateSync(database,void 0))){var t=this.container;if(!t.hideFields[e.id])switch(e.base){case"space":return new kn.Space(t,this,e);case"br":return new kn.BR(t,this,e);case"head":return new kn.Head(t,this,e);case"text":return new kn.Text(t,this,e);case"custom":return new kn.Custom(t,this,e);case"view":return new kn.View(t,this,e);case"chart":return new kn.Chart(t,this,e);case"button":return new kn.Button(t,this,e);case"ref":return new kn.Reference(t,this,e);case"rev":return"field"===e.reverseRenderer?new kn.ReverseField(t,this,e):"list"===e.reverseRenderer?new kn.ReverseList(t,this,e):"radio"===e.reverseRenderer?new kn.ReverseRadio(t,this,e):new kn.Reverse(t,this,e);case"file":return new kn.File(t,this,e);default:return e.isField?new kn.CmpField(t,this,e):void 0}}},xn.prototype.updateStructure=function(){if(this.updateTab(),this.visible){this.container.type;for(var e=this.components,t=this.children,i={},o=0;o<t.length;o++){i[(r=t[o]).id]=r}var n={};for(o=0;o<e.length;o++){var a=i[(l=e[o]).field.id];a?(l.field=a,n[a.id]=l):l.destroy()}var s=[];for(o=0;o<t.length;o++){var r;(l=n[(r=t[o]).id])?"rev"===r.base&&r.reverseRenderer!=l.reverseRenderer&&(l.destroy(),l=this.createComponent(r)):l=this.createComponent(r),l&&(l.field=r,s.push(l))}this.components=s;for(o=0;o<s.length;o++){var l;(l=s[o]).el.index()!==o&&(o>0?l.el.insertAfter(s[o-1].el):l.el.prependTo(this.el)),l.updateStructure()}this.visible&&this.container.updateBackground(this.field.bgColor)}},xn.prototype.hide=function(e){this.visible&&(this.visible=!1,this.container.currentTab===this&&(this.container.currentTab=void 0,this.container.updateBackground(),this.elTab.removeClass("selected"),this.tabSelectedIndicator.detach(),k.each(this.components,(function(e){e.destroy()})),this.components=[],this.el.remove(),this.el=null,this.updateTab(),Object(c.c)(this.field.afterHide,this.container.nid,t=>{t&&$.alert(t),e&&e()})))},xn.prototype.bind=function(e){this.updateVisibility(),this.visible&&k.each(this.components,(function(t){t.bind(e)}))},xn.prototype.updateVisibility=function(){if(this.field.visibilityExp){var e=this,t=this._updateVisibilityId=Math.random();database.loadNode(e.container.nid,(function(i,o){o&&e.field.visibilityExp.evaluate(database,o,(function(i,o){t===e._updateVisibilityId&&e.setHidden(!i&&!o)}))}))}else this.hidden&&this.setHidden(!1)},xn.prototype.setHidden=function(e){this.hidden=!!e,e?(this.elTab[0].style.display="none",this.blur(),this.visible&&(this.hide(),this.container.selectTab("0"))):this.elTab[0].style.display=""},xn.prototype.resize=function(e){this.visible&&k.each(this.components,(function(e){e.resize&&e.resize()}))},xn.prototype.save=function(){this.visible&&k.each(this.components,(function(e){e.save&&e.save()}))},xn.prototype.nodeChanged=function(){this.updateVisibility(),this.visible&&k.each(this.components,(function(e){e.nodeChanged&&e.nodeChanged()}))},xn.prototype.blur=function(){this.visible&&k.each(this.components,(function(e){e.blur()}))},xn.prototype.focus=function(){if(this.visible)for(var e=this.components,t=0;t<e.length;t++){var i=e[t];if(i.focus&&i.focus())return}},xn.prototype.destroy=function(){this.hide(),this.elTab.remove()},xn.prototype.clicked=function(){return this.container.currentTab===this?Object(bo.b)()&&this.popup():this.container.selectTab(this.id),!1},xn.prototype.popup=function(){var e=this.field;if("0"!==this.id){var t=$.backplane({close:l}),i=$('<div class="nx-menu-popup grey" style="width:256px">').appendTo(t),o=new qt.a(this,e.getCaptionModel(),i,{formWidth:.75}),n=new qt.a(this,e.getBGColorModel(),i,{formWidth:.25});$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.removeTab)).appendTo(i).touch((function(){t.close(),e.type.schema.removeField(e)}));var a=i.outerWidth(),s=i.outerHeight(),r=this.elTab.offset();r.top+=this.elTab.outerHeight(),r.left+a>window.getWidth()-1&&(r.left=window.getWidth()-a-1),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),i.offset(r)}function l(){o.destroy(),n.destroy()}},xn.prototype.editorUp=function(){this.container.editorUp&&this.container.editorUp()},xn.prototype.editorDown=function(){console.log("Tab.editorDown"),this.container.editorDown&&this.container.editorDown()},xn.prototype.isWritable=function(){return this.container.isWritable()},xn.prototype.columnsChanged=function(){k.each(this.components,(function(e){e.updateElementWidth()}))},Object.assign(Tn.prototype,ao.a.prototype),Tn.prototype.updateStructure=Io.prototype.updateStructure,Tn.prototype.updateStyle=Io.prototype.updateStyle,Tn.prototype.startEditCaption=wo.prototype.startEditCaption,Object.assign(Cn.prototype,tn.prototype),Cn.prototype.createQuery=function(){try{return new queries.QueryExpression(database,this.field,this.container.nid)}catch(e){return}},Cn.prototype.updateButtons=function(){this.$controls[0].style.display="none",this.$create[0].style.display="none",this.$find[0].style.display="none"},Cn.prototype.addRowFind=function(){},Cn.prototype.addRowCreate=function(){},Cn.prototype.canUnlink=function(){return!1},Cn.prototype.canRemove=function(){return!1},Cn.prototype.queryNeedsUpdate=function(){var e=tn.prototype.queryNeedsUpdate.call(this);return this.field.fn!==this._cachedFn?(this._cachedFn=this.field.fn,!0):e},Cn.prototype.isWritable=function(){return!1};const kn={BR:so,Button:ro,Chart:mo,CommentsTab:go,Custom:yo,CmpField:wo,File:Do,FilesTab:No,Head:Io,HistoryTab:Oo,PopupEditor:Yo,Reference:gn,Reverse:tn,ReverseField:vn,ReverseList:yn,ReverseRadio:bn,Space:wn,Tab:xn,Text:Tn,View:Cn};o("./src/react/HomeHistory.css");function $n({entries:e}){return s.createElement("div",null,e.map((e,t)=>s.createElement(Sn,{entry:e,key:t})))}function Sn({entry:{nid:e,change:t,time:i}}){function o(){return new kn.PopupEditor(e,{})}return s.createElement("div",{className:"History_entry",onClick:o},s.createElement("div",{className:"History_change"},t),s.createElement("div",{className:"History_time"},i))}class _n{constructor(e,t){Je()(this,"container",void 0),Je()(this,"el",void 0),Je()(this,"base","history"),Je()(this,"visible",!1),Je()(this,"database",window.database),Je()(this,"locale",Object(b.getLocale)()),this.container=e,this.el=$('<div class="admin-options" style="top:48px;background-color:rgba(255,255,255,.8)">')}getNavigationState(){return{base:"history"}}destroy(){this.hide(),this.el.remove()}hide(){this.visible&&(this.visible=!1,this.el.detach(),this.database.off("history",void 0,this.updateUI,this))}show(){Object(l.f)("History","Open"),this.visible||(this.visible=!0,this.el.appendTo(this.container.el),this.updateUI(),this.database.on("history",void 0,this.updateUI,this))}async updateUI(){if(!this.visible)return;if(!this.database.supports.history||!this.database.authorizationHistory)return;const e=await this.getHistoryEntries();n.render(s.createElement($n,{entries:e}),this.el[0])}async getHistoryEntries(){const e=await this.getHistory(),t=["create","remove","update","comment"],i=e.filter(e=>t.includes(e[3])),o=i.map(e=>e[4]);return await this.preloadNodes(o),i.reduce((e,[t,i,o,n,a])=>{const s=this.database.typeOf(a);if(s&&this.database.canRead(s)){const r=`${this.database.userName(i)}, ${En(new Date(o))} ${Dn(o)}`;if("remove"===n)return[...e,{nid:a,change:`${s.caption} #${b.schemas.ridOf(a)} ${this.locale.removed}`,time:r,seq:t}];const l=this.database.loadNodeSync(a);if(l&&!e[a]){const i="create"===n?`${s.caption} #${b.schemas.ridOf(a)} ${this.locale.created}`:"comment"===n?`${s.caption} #${b.schemas.ridOf(a)} ${s.format(l).substr(0,20)} ${this.locale.commented}`:`${s.caption} #${b.schemas.ridOf(a)} ${s.format(l).substr(0,20)} ${this.locale.modified}`;return[...e,{nid:a,change:i,time:r,seq:t}]}}return e},[])}async preloadNodes(e){return new Promise(t=>{this.database.loadNodes(e,()=>t())})}async getHistory(){return new Promise((e,t)=>{this.database.loadHistory((i,o)=>{i?t(i):e(o)})})}}function En(e){const t=Object(b.getLocale)(),i=e.getTime(),o=new Date,n=new Date(o.getFullYear(),o.getMonth(),o.getDate()).getTime(),a=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1).getTime(),s=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1).getTime();return i>=n&&i<a?t.today:i>=s&&i<n?t.yesterday:b.util.formatLocaleDate(e)}function Dn(e){return b.util.formatLocaleTime(e)}o("./src/react/HomeTableList.css");const Nn=Object(Ft.SortableHandle)(({hidden:e})=>s.createElement("span",{className:"HomeTableList_sortingHandleContainer"},s.createElement("span",{className:"i-32-24 i-lighter-grey i-drag-handle"}),e?s.createElement("span",{className:"Hud_hiddenTag"},Object(b.getLocale)().hidden):null)),In=Object(Ft.SortableElement)(({value:e})=>s.createElement("span",{className:"home-table --ul-home-table"},e)),On=Object(Ft.SortableContainer)(({children:e})=>s.createElement("div",null,e));class Mn extends s.Component{constructor(e){super(e),Je()(this,"onSortEnd",(e,t,i)=>{e!==t&&this.props.database.schema.updateTypeOrder(e,t,i)})}render(){const e=[],t=this.props.database.schema.types;return b.util.localeSortBy(t,"order").map(t=>{if(this.shouldShowType(t)&&!t.master){const i=t.getAllChildren().filter(e=>this.shouldShowType(e)),o=i.length>0;e.push(s.createElement(Ze.a,{key:t.id,onFastClick:()=>this.props.onTableClick(t.id)},this.props.database.adminMode&&this.props.database.isAdminEnabled()?s.createElement("div",{style:{position:"absolute",left:-8}},s.createElement(Nn,{hidden:t.hidden})):null,o?s.createElement(Ze.a,{onFastClick:e=>this.props.onShowChildrenClick(e,i),className:"HomeTableList_burgerMenuContainer"},s.createElement("div",{className:"button i-32-24 i-light-grey i-setting-menu"})):null,s.createElement("div",{className:"home-table-label"},t.caption||t.id)))}}),this.renderSortable(e,null)}shouldShowType(e){const t=this.props.database;return t.canRead(e)&&!e.hidden||t.adminMode&&t.isAdminEnabled()}renderSortable(e,t){return s.createElement(s.Fragment,null,s.createElement(On,{onSortEnd:e=>this.onSortEnd(e.oldIndex,e.newIndex,t),axis:"xy",useDragHandle:!0},e.map((e,t)=>s.createElement(In,{key:`item-${t}`,index:t,value:e}))),this.props.database.adminMode&&this.props.database.isAdminEnabled()?s.createElement(Ze.a,{className:"home-table home-table-add --ul-add-table-button",onFastClick:this.props.onAddTableClick,rippleStyle:"LIGHT"},s.createElement("div",{className:"home-table-label"},s.createElement("div",{className:"i-24-24 i-light-grey i-plus",style:{margin:"0 auto 8px auto"}}),s.createElement("div",null,Object(b.getLocale)().addTable))):null,this.props.database.authorizationImport?s.createElement(Ze.a,{rippleStyle:"LIGHT",className:"home-table home-table-add",onFastClick:this.props.onImportClick},s.createElement("div",{className:"home-table-label"},s.createElement("div",{className:"i-24-24 i-light-grey i-setting-import",style:{margin:"0 auto 8px auto"}}),s.createElement("div",null,Object(b.getLocale)().importData))):null,window.NINOX_APP&&this.props.database.isAdmin()?s.createElement(Ze.a,{className:"home-table home-table-add",onFastClick:this.props.onExportClick,rippleStyle:"LIGHT"},s.createElement("div",{className:"home-table-label"},s.createElement("div",{className:"i-24-24 i-light-grey i-setting-export",style:{margin:"0 auto 8px auto"}}),s.createElement("div",null,Object(b.getLocale)().exportData))):null)}}class Fn{constructor(e,t){this.container=e,this.visible=!1,this.el=$('<div class="home home-tables">'),database.on("schema",void 0,this.schemaChanged,this),database.on("admin",void 0,this.schemaChanged,this),this.base="tables"}getNavigationState(){return{base:"tables"}}destroy(){database.off("admin",void 0,this.schemaChanged,this),database.off("schema",void 0,this.schemaChanged,this),n.unmountComponentAtNode(this.el[0]),this.el.remove()}hide(){this.visible&&(n.unmountComponentAtNode(this.el[0]),this.visible=!1,this.el.detach())}show(){this.visible||(this.visible=!0,this.el.appendTo(this.container.el),this.updateUI())}schemaChanged(e,t,i){this.updateUI()}updateUI(){this.visible&&n.render(s.createElement(Mn,{database:database,onTableClick:e=>ui.openTable(e),onShowChildrenClick:(e,t)=>this.showChildrenList(e,t),onAddTableClick:()=>{Object(l.f)("DatabaseHomeTable","Create"),new eo({})},onExportClick:()=>{Object(l.f)("DatabaseHome","ExportData"),new Zt({})},onImportClick:()=>{Object(l.f)("DatabaseHome","ImportData"),new pi({})}}),this.el[0])}showChildrenList(e,t){var i=$.backplane({}),o=$('<div class="nx-menu-popup">').appendTo(i);k.each(b.util.localeSortBy(t,"order"),(function(e){$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(e.caption)).appendTo(o).click((function(){i.close(),ui.openTable(e.id)}))}));const n=$(e.event.target);var a=n.offset(),s=o.outerWidth(),r=o.outerHeight();return a.top+=32,a.left+=n.width()-32,a.left+s>window.getWidth()&&(a.left=window.getWidth()-s),a.top+r>window.getHeight()&&(a.top=window.getHeight()-r),o.offset(a),!1}}function Rn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ln(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Rn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class jn{constructor(){Je()(this,"base","home"),Je()(this,"visible",void 0),Je()(this,"view",void 0),Je()(this,"el",void 0),Je()(this,"$tabs",void 0),this.visible=!1,this.view=void 0,this.resizeBackground=this.resizeBackground.bind(this),this.el=$('<div class="home">'),this.$tabs=$('<div class="secondary-tabs">'),this.updateBackground(),window.database.on("admin",void 0,this.adminChanged,this)}getTabs(e){const t=[];return t.push({id:"tables",iconClass:"",isSelected:"tables"===e,text:Object(b.getLocale)().tables}),window.database.supports.history&&window.database.authorizationHistory&&t.push({id:"history",iconClass:"",isSelected:"history"===e,text:Object(b.getLocale)().history}),window.database.adminMode&&window.database.adminEnabled&&window.database.isAdmin()&&(t.push({id:"schema",iconClass:"",isSelected:"schema"===e,text:Object(b.getLocale)().dataModel}),t.push({id:"options",iconClass:"",isSelected:"options"===e,text:Object(b.getLocale)().options}),window.database.supports.authentication&&t.push({id:"security",iconClass:"",isSelected:"security"===e,text:Object(b.getLocale)().security}),t.push({id:"console",iconClass:"",isSelected:"console"===e,text:"Console"})),t}getNavigationState(){return{base:"home",view:void 0===this.view?{base:"tables"}:this.view.getNavigationState()}}setNavigationState(e){let t=e.vid;var i,o;"default"===t&&(t=null!==(i=null===(o=e.view)||void 0===o?void 0:o.base)&&void 0!==i?i:"tables",vt(Ln({},Tt(),{vid:t})));const n={base:t};switch(n.base){case"tables":case"history":this.createView(n);break;case"schema":case"options":case"security":case"console":case"localizations":window.database.adminMode?this.createView(n):(vt(Ln({},Tt(),{vid:"tables"})),this.createView({base:"tables"}));break;default:this.setNavigationState({vid:"default"})}}navigateToView(e){gt(Ln({},Tt(),{vid:e}))}createView(e){const t=e.base;if(this.view){if(t===this.view.base)return void(this.view.visible||this.view.show());this.view.destroy(),this.view=void 0}switch(t){case"history":this.view=new _n(this,e);break;case"schema":this.view=new to(this,e);break;case"options":this.view=new Ui(this,e);break;case"security":this.view=new io(this,e);break;case"console":this.view=new no(this,e);break;case"localization":this.view=new Li(this,e,window.database);break;default:this.view=new Fn(this,e)}this.view.show(),this.updateTabs()}updateTabs(){if(!this.visible||!this.view)return;const e=this.view.base;a.a.render(r.a.createElement(Bt.a,{items:this.getTabs(e),currentItemId:e,onItemSelect:e=>this.navigateToView(e),onContextMenuClick:()=>{},onNewItemClick:null,popupItemBackground:"OFF_WHITE"}),this.$tabs[0])}adminChanged(){window.database.adminMode||!this.visible||{tables:!0,history:!0}[this.view.base]?this.updateTabs():this.navigateToView("tables")}destroy(){var e;window.database.off("admin",void 0,this.adminChanged,this),this.hide(),this.$tabs.remove(),this.el.remove(),null===(e=this.view)||void 0===e||e.destroy()}show(){this.visible||(this.visible=!0,this.$tabs.appendTo(window.ui.$header),this.el.appendTo(window.ui.$body),this.updateTabs(),window.NINOX_IOS&&window.addEventListener("orientationchange",this.resizeBackground),$.pushInputHandler(this))}hide(){this.visible&&(this.visible=!1,this.view&&this.view.hide(),this.el.detach(),a.a.unmountComponentAtNode(this.$tabs[0]),this.$tabs.detach(),window.NINOX_IOS&&window.removeEventListener("orientationchange",this.resizeBackground),$.popInputHandler(this))}resizeBackground(){if(window.NINOX_IOS){const e=this.el[0];0===window.orientation||180===window.orientation?(e.style.width=screen.width+"px",e.style.height=screen.height-90+"px"):(e.style.width=screen.height+"px",e.style.height=screen.width-90+"px")}}menuNewTableEnabled(){return!!window.database.adminEnabled}menuNewTable(){window.database.adminEnabled&&new eo({})}menuImportDataEnabled(){return!!window.database.authorizationImport}menuImportData(){window.database.authorizationImport&&new pi({})}menuExportDataEnabled(){return!!window.database.authorizationExport}menuExportData(){window.database.authorizationExport&&new Zt({})}async updateBackground(e){const t=this.el[0],i=window.database.settings||{},o=window.database.account&&window.database.account.settings&&window.database.account.settings.databaseBackgroundCustomCSS;if(o){for(const e in o)if(o.hasOwnProperty(e)){let i=o[e];const n=/^url\((.*)\)$/.exec(i);if(n){const e=n[1];i="url("+(await window.localFileSystem.cachedURL(e,null)||e)+")"}t.style[e]=i}}else{if(null==i.bgType)t.className="home background-file default",t.style.backgroundImage="",t.style.backgroundColor="";else if("solid"===i.bgType)t.className="home",t.style.backgroundImage="",t.style.backgroundColor=i.bgColor||"";else if("gradient"===i.bgType)t.className="home",t.style.backgroundImage="linear-gradient("+(i.bgGradient0||"#ccc")+" 0%, "+(i.bgGradient1||"#aaa")+" 100%)",t.style.backgroundColor="";else if("image"===i.bgType)t.className="home background-file",t.style.backgroundImage='url("'+window.database.backgroundURL(e)+'")',t.style.backgroundColor=i.bgColor||"";else{const o=i.backgroundClass||"background";t.className="home background "+o,"background-file"===o?(t.style.backgroundImage='url("'+window.database.backgroundURL(e)+'")',t.style.backgroundColor=i.bgColor||""):(t.style.backgroundImage="",t.style.backgroundColor="")}t.style.backgroundPosition=(i.bgPosH||"center")+" "+(i.bgPosV||"center"),t.style.backgroundSize=i.bgSize||"cover",t.style.backgroundRepeat=i.bgRepeat||"no-repeat"}}}var An=o("./src/react/util/general.ts");o("./src/react/util/SimpleContextMenu.css");class Pn extends s.Component{constructor(e){super(e)}render(){return s.createElement(Ei.a,{positionAdjustment:this.props.positionAdjustment,clickTarget:this.props.clickTarget,show:this.props.show,settings:{style:"tooltip",arrowColor:"white"},onClick:this.props.onClick,className:"SimpleContextMenu_container",killWhenTargetIsNull:this.props.killWhenTargetIsNull},0===this.props.items.length?s.createElement("div",{className:"SimpleContextMenu_emptyText"},Object(b.getLocale)().errorNotAuthorized):this.props.items.map((e,t)=>s.createElement(Ze.a,{key:e.text+t,className:Object(An.a)("nx-menu-item",{"nx-menu-item-selected":!0===e.isSelected,"nx-menu-item-disabled":!0===e.disabled,"nx-menu-item-divider":!0===e.topBorder}),onFastClick:t=>{e.disabled||(this.props.onClick(),e.onClick(t))}},e.isSelected?s.createElement("div",{className:"nx-menu-item-selected-indicator"}):null,s.createElement("div",{className:"nx-menu-label"},e.text))))}}const Un=36e5,Hn=24*Un;function zn(e){var t=this;this.calendar=e,this.nodes={},this.days=5,this.showFullDay=!1,this.el=$('<div class="calendar-week">'),this.$head=$('<div class="calendar-week-header">').appendTo(this.el),this.$body=$('<div class="calendar-week-body">').appendTo(this.el),this.$nav=$('<div class="hud-menu-group" style="margin-left:8px">'),this.$controls=$('<div class="calendar-controls">'),this.smallContextMenuTarget=null,this.$controlsSmall=$('<div class="hud-menu-button i-32-24 i-light-grey i-column">').click(e=>{this.smallContextMenuTarget=e.target,this.updateUI()}),$('<div class="button i-32-24 i-light-grey i-arrow-solid-left">').appendTo(this.$nav).touch($.proxy(this.prevWeek,this)),this.$label=$('<div class="calendar-week-label">').appendTo(this.$nav).touch($.proxy(this.popupMiniCalendar,this)),$('<div class="button i-32-24 i-light-grey i-arrow-solid-right">').appendTo(this.$nav).touch($.proxy(this.nextWeek,this)),this.$show7Days=$('<div class="button option first">').text(locale.sevenDays).appendTo(this.$controls).touch((function(){t.setDays(7),t.load()})),this.$show5Days=$('<div class="button option selected">').text(locale.fiveDays).appendTo(this.$controls).touch((function(){t.setDays(5),t.load()})),this.$show1Days=$('<div class="button option last">').text(locale.oneDay).appendTo(this.$controls).touch((function(){t.setDays(1),t.load()})),this.$showFullDay=$('<div class="button option first last selected" style="margin-left:8px">').text(locale.showOnlyWorkHours).appendTo(this.$controls).touch((function(){t.setShowFullDay(!t.showFullDay),t.load()})),this.el.click(o);var i=new Date;function o(e){var t=$(e.target).closest(".calendar-week-full-box,.calendar-week-box,.calendar-week-cell"),i=t.data("nid"),o=t.data("time");i?new kn.PopupEditor(i,{duplicate:!0}):o&&n(e)}function n(e){var i=[];if(k.each(database.schema.types,(function(e){database.canCreate(e)&&k.each(e.fields,(function(e){"appointment"===e.base&&database.canWrite(e)&&i.push(e)}))})),0!==i.length){var o=$(e.target).data("time"),n=new Date(o),a=$.backplane({}),s=$('<div class="nx-menu-popup grey" style="border-radius:4px">').appendTo(a);$("<h1>").text(locale.createRecord).appendTo(s),$('<div style="text-align:center;padding:8px 0">').text(util.formatLocaleDate(n)).appendTo(s);var r=$('<div style="padding:8px 0">').appendTo(s);$("<label>").text(locale.appointmentBegin+" ").appendTo(r);var l=$('<input type="text" class="appointment-time">').val(Vn(n)).appendTo(r);$("<label>").text(" "+locale.appointmentEnd+" ").appendTo(r);var c=$('<input type="text" class="appointment-time">').val(Vn(new Date(o+Un))).appendTo(r);TOUCH&&(l.attr("type","time"),c.attr("type","time")),k.each(i,(function(e){var i=e.type;$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-grey i-setting-add">')).append($('<div class="nx-menu-label">').text(i.caption+" ("+e.caption+")")).appendTo(s).touch((function(){var o=Wn(l.val()),s=Wn(c.val())-o;if(!(s<0)){var r=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()+o;a.close();var d={};d[e.id]=r+"/"+s,database.create(i,d,(function(e,i){if(e)return $.alert(e);t.nodes[i._id]=i,t.updateUI(),new kn.PopupEditor(i._id,{duplicate:!0})}))}}))}));var d=s.outerWidth(),h=s.outerHeight(),p={left:e.clientX-24,top:e.clientY+16};p.left+d>window.getWidth()&&(p.left=window.getWidth()-d),p.top+h>window.getHeight()&&(p.top=window.getHeight()-h),s.offset(p)}else $.notify(locale.calendarCreateAppointmentField)}this.start=new Date(i.getFullYear(),i.getMonth(),i.getDate()),this.resizeListener=k.debounce($.proxy(this.updateUI,this),100),this.updateLabel()}function Vn(e){var t=e.getHours(),i=e.getMinutes();return(t<10?"0":"")+t+":"+(i<10?"0":"")+i}function Wn(e){if(!e||"string"!=typeof e)return 0;var t=e.split(":");if(2!==t.length)return 0;var i=36e5*parseInt(t[0])+6e4*parseInt(t[1]);return isNaN(i)?0:i}function Bn(e){this.calendar=e,this.visible=!1,this.el=$('<div class="calendar-month">'),this.controls=$('<div class="hud-menu-group" style="margin-left:8px">'),$('<div class="button i-32-24 i-light-grey i-arrow-solid-first">').appendTo(this.controls).touch($.proxy(this.prevYear,this)),$('<div class="button i-32-24 i-light-grey i-arrow-solid-left">').appendTo(this.controls).touch($.proxy(this.prevMonth,this)),this.label=$('<div class="calendar-month-label">').appendTo(this.controls).touch($.proxy(this.popupMiniCalendar,this)),$('<div class="button i-32-24 i-light-grey i-arrow-solid-right">').appendTo(this.controls).touch($.proxy(this.nextMonth,this)),$('<div class="button i-32-24 i-light-grey i-arrow-solid-last">').appendTo(this.controls).touch($.proxy(this.nextYear,this)),this.table=$('<table class="calendar-table">').appendTo(this.el),this.thead=$("<thead>").appendTo(this.table),this.trhead=$("<tr>").appendTo(this.thead),$('<th class="calendar-month-week">').text(locale.calendarWeek).appendTo(this.trhead);for(var t=0;t<7;t++)$("<th>").text(locale.dayNames[(t+locale.firstDayOfWeek)%7]).appendTo(this.trhead);this.tbody=$("<tbody>").appendTo(this.table),this.trs=[],this.tds=[],this.cells=[];for(var i=0;i<6;i++){var o=$("<tr>").appendTo(this.tbody);this.trs.push(o),this.tds.push($('<th class="calendar-month-week">').appendTo(o));for(var n=0;n<7;n++){var a=7*i+n,s=$("<td>").appendTo(o).data("index",a);this.cells[a]=new qn(this,s,a)}}var r=new Date;this.setDate(r.getFullYear(),r.getMonth())}function qn(e,t,i){this.calendar=e,this.td=t,this.index=i,this.refs={}}function Yn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Xn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Yn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Gn(){this.visible=!1,this.tabs=$('<div class="secondary-tabs" style="display:flex;display:-webkit-flex">'),this.calendarMonth=new Bn(this),this.calendarWeek=new zn(this),this.tabMonth=$('<div class="secondary-tab">').text(locale.month).appendTo(this.tabs).touch((function(){gt(Xn({},Tt(),{vid:"month"}))})),this.tabWeek=$('<div class="secondary-tab">').text(locale.week).appendTo(this.tabs).touch((function(){gt(Xn({},Tt(),{vid:"week"}))})),$('<div class="nx-button-text" style="color:#fff;display:flex;display:-webkit-flex;margin-left:16px;align-items: center;-webkit-align-items: center;font-weight: 500;">').append($('<div class="i-40-24 i-white i-calendar">')).append($("<span>").text(locale.options+"...")).appendTo(this.tabs).touch($.proxy(this.popupSync,this)),this.currentTab=this.calendarWeek,this.tabWeek.addClass("selected"),this.currentDate=null}function Jn(e){var t=e.year,i=new Date,o=e.selectedDay,n=$.backplane({}),a=$('<div class="nx-menu-popup minical-popup">').css({top:40,left:ui.leftWidth}).appendTo(n),s=$('<div class="minical">').appendTo(a).touch((function(t){if(e.selectMonth){var i=$(t.target).closest(".minical-month");i.length&&(e.selectMonth(parseInt(i.attr("data-year")),parseInt(i.attr("data-month"))),n.close())}else if(e.selectDay){var o=$(t.target).closest(".minical-day");o.length&&(e.selectDay(parseInt(o.attr("data-year")),parseInt(o.attr("data-month")),parseInt(o.attr("data-day"))),n.close())}}));e.selectMonth?s.addClass("minical-monthselectable"):e.selectDay&&s.addClass("minical-dayselectable");for(var r=$('<div class="minical-months">').appendTo(s),l=0;l<12;l++){var c=new Date(t,l,1),d=c.getDay(),h=locale.firstDayOfWeek,p=d>=h?h-d+1:h-d-6,u=new Date(c.getFullYear(),c.getMonth(),p),f=$('<div class="minical-month" data-year="'+t+'" data-month="'+l+'">').appendTo(r);$('<div class="minical-month-label">').text(locale.monthNames[l]).appendTo(f);for(var m=$('<div class="minical-days">').appendTo(f),g=0;g<6;g++)for(var v=0;v<7;v++){var y=new Date(u.getFullYear(),u.getMonth(),u.getDate()+7*g+v),b=y.getFullYear()===t&&y.getMonth()===l,w=y.getFullYear()===i.getFullYear()&&y.getMonth()===i.getMonth()&&y.getDate()===i.getDate(),x=o&&y.getFullYear()===o.getFullYear()&&y.getMonth()===o.getMonth()&&y.getDate()===o.getDate();$('<div class="minical-day '+(b?x?"selected":w?"today":"this-month":"other-month")+'" data-day="'+y.getDate()+'" data-year="'+y.getFullYear()+'" data-month="'+y.getMonth()+'">').text(y.getDate()).appendTo(m)}}}function Kn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Qn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Kn(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Kn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}zn.prototype.destroy=function(){this.hide(),this.el.remove(),this.$controls.remove(),this.$nav.remove()},zn.prototype.prevWeek=function(){var e=this.start;1===this.days?this.start=new Date(e.getFullYear(),e.getMonth(),e.getDate()-1):this.start=new Date(e.getFullYear(),e.getMonth(),e.getDate()-7),this.updateLabel(),this.load(),this.calendar.dateChanged(this.start)},zn.prototype.nextWeek=function(){var e=this.start;e=this.start;1===this.days?this.start=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1):this.start=new Date(e.getFullYear(),e.getMonth(),e.getDate()+7),this.updateLabel(),this.load(),this.calendar.dateChanged(this.start)},zn.prototype.show=function(e){this.visible||(this.visible=!0,e&&this.setDate(e,!1),this.$nav.appendTo(ui.$menuCenter),this.$controls.appendTo(ui.$menuCenter),this.$controlsSmall.appendTo(ui.$menuCenter),this.el.appendTo(ui.$body),this.load(!0),database.on("schema",void 0,this.schemaChanged,this),database.onChange(void 0,this.databaseChange,this),database.onRemove(void 0,this.databaseRemove,this),database.onCreate(void 0,this.databaseCreate,this),$(window).on("resize",this.resizeListener))},zn.prototype.hide=function(){this.visible&&(this.visible=!1,this.$controls.detach(),this.$controlsSmall.detach(),this.$nav.detach(),this.el.detach(),this.nodes={},database.off("schema",void 0,this.schemaChanged,this),database.offChange(void 0,this.databaseChange,this),database.offRemove(void 0,this.databaseRemove,this),database.offCreate(void 0,this.databaseCreate,this),$(window).off("resize",this.resizeListener))},zn.prototype.bodyResized=function(){this.updateUI()},zn.prototype.schemaChanged=function(e,t,i){this.load()},zn.prototype.databaseChange=function(e,t){var i=this;i.nodes[t]&&database.loadNode(t,(function(e,o){i.nodes&&i.nodes[t]&&(i.nodes[t]=o,i.updateUI())}))},zn.prototype.databaseRemove=function(e,t){var i=this;i.nodes[t]&&(delete i.nodes[t],i.updateUI())},zn.prototype.databaseCreate=function(e,t,i){var o=this;database.loadNode(i,(function(e,t){t&&(o.nodes[i]=t,o.updateUI())}))},zn.prototype.load=function(){var e=this,t=this.days,i=this.start,o=new Date(i.getFullYear(),i.getMonth(),i.getDate()+t);database.loadCalendarFromTo(i,o,(function(t,i){e.updateRefs(i||[])}))},zn.prototype.updateRefs=function(e){var t=this,i={},o=(e=k.uniq(e),this.calendar.getDependencies());database.loadNodes2(e,o,(function(){database.filterReadable(void 0,e,(function(e){for(var o=0;o<e.length;o++){var n=e[o],a=database.loadNodeSync(n);a&&(i[n]=a)}t.nodes=i,t.updateUI()}))}))},zn.prototype.updateLabel=function(){this.$label.text(util.formatLocaleDate(this.start))},zn.prototype.updateUI=async function(){if(!this.visible)return;ui.fullWidth<750?(this.$controls.hide(),this.$controlsSmall.show()):(this.$controls.show(),this.$controlsSmall.hide(),this.smallContextMenuTarget=null),a.a.render(r.a.createElement(Pn,{show:null!==this.smallContextMenuTarget,clickTarget:this.smallContextMenuTarget,items:[{text:locale.sevenDays,onClick:()=>{this.setDays(7),this.load()},isSelected:7===this.days},{text:locale.fiveDays,onClick:()=>{this.setDays(5),this.load()},isSelected:5===this.days},{text:locale.oneDay,onClick:()=>{this.setDays(1),this.load()},isSelected:1===this.days},{text:locale.showOnlyWorkHours,onClick:()=>{this.setShowFullDay(!this.showFullDay),this.load()},isSelected:this.showFullDay}],onClick:()=>{this.smallContextMenuTarget=null,this.updateUI()}}),this.$controlsSmall[0]);const e=Math.floor(parseInt(NinoxDocumentInteraction.getUserDefault("ui.calendar.dayStart")||"28800000")/36e5),t=Math.ceil(parseInt(NinoxDocumentInteraction.getUserDefault("ui.calendar.dayEnd")||"64800000")/36e5),i=this.$body;i.empty();const o=this.start,n=this.days,s=this.showFullDay?0:e,l=this.showFullDay?24:t,c=32,d=this.el.width(),h=this.el.height(),p=Math.max(Math.floor((d-64)/n),c),u=d-p*n,f=this.$head.empty();$('<div class="calendar-week-head">').appendTo(f).css({position:"absolute",width:u,top:0,left:0,"max-height":h+"px"});const m=[];for(let e=0;e<n;e++){const t=new Date(o.getFullYear(),o.getMonth(),o.getDate()+e),i=$("<div>");$('<div class="calendar-week-head">').appendTo(f).css({position:"absolute",width:p-1,top:0,left:u+e*p,"max-height":h+"px"}).append($("<div>").text(locale.dayNames[t.getDay()]+" "+t.getDate()+".")).append(i),m.push({date:t,begin:t.getTime(),left:u+e*p,width:p,boxes:[],$full:i})}const g=this.$hours=$('<div class="calendar-week-hours">').appendTo(this.$body).css({position:"absolute",width:u+1,top:0,left:0});for(let e=s;e<l;e++){const t=e===s?"":(e<10?"0":"")+e+":00";$('<div class="calendar-week-hour">').text(t).appendTo(g)}for(let o=0;o<n;o++){const n=m[o],a=$('<div class="calendar-week-col">').appendTo(i).css({position:"absolute",width:p-1,top:0,left:u+o*p});for(let i=s;i<l;i++){const o=$('<div class="calendar-week-cell">').appendTo(a).data("time",n.begin+i*Un).addClass(i<e?"calendar-week-cell-early":i>=t?"calendar-week-cell-late":"calendar-week-cell-normal");(n.date.getDay()+6)%7>4&&o.addClass("calendar-week-cell-weekend")}}for(const e of Object.values(this.nodes)){const t=e._id,i=database.typeOf(t);if(i)for(const a in i.fields)if(i.fields.hasOwnProperty(a)){const s=i.fields[a];if(s.dateCalendar)if("date"===s.base||"datx"===s.base){const r=e[a];if(r){const a=new Date(r);"datx"===s.base&&(a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())),s.dateYearly&&a.setYear(o.getFullYear());const l=Math.floor((a.getTime()-m[0].begin)/Hn);if(l>=0&&l<n){const o=m[l],n=$('<div class="calendar-week-full-box">').data("nid",t).appendTo(o.$full),a=s.dateCalendarFormatExp;if(a){const i=await a.promise(database,e).catch(()=>{});null!=i?"styled"===a.returnType.base?(n.html((i.icon?'<div class="choice-icon ic ic-'+i.icon+'"></div>':"")+'<span style="color:'+(i.color||"")+'">'+htmlEscape(i.text)+"</span>"),n.css("background-color",i.background||s.dateCalendarColor||"")):"choice"===a.returnType.base||"dchoice"===a.returnType.base?a.returnType.loadValue(t,i,e=>{e?(n.html((e.icon?'<div class="choice-icon ic ic-'+e.icon+'"></div>':"")+'<span style="color:'+(e.textColor||"")+'">'+htmlEscape(e.caption)+"</span>"),n.css("background-color",e.color||s.dateCalendarColor||"")):n.css("background-color",s.dateCalendarColor||"")}):"icon"===a.returnType.base?n.html('<div class="choice-icon ic ic-'+i+'"></div>'):"color"===a.returnType.base?n.css("background-color",color||s.dateCalendarColor||""):(n.text(a.returnType.format(i)),n.css("background-color",s.dateCalendarColor||"")):(n.text(""),n.css("background-color",s.dateCalendarColor||""))}else n.text(i.caption+": "+i.format(e)),n.css("background-color",s.dateCalendarColor||"")}}}else if("appointment"===s.base){const o=e[a];if(o){const n=o.split("/"),a=parseInt(n[0]),r=parseInt(n[1]),l=a+r;if(!isNaN(a)&&!isNaN(r)){let o=Math.floor((a-m[0].begin)/Hn),n=Math.floor((l-m[0].begin)/Hn);if(o<0&&(o=0),n>=m.length&&(n=m.length-1),o<m.length&&n>=0)for(let r=o;r<=n;r++){const o=m[r],n=Math.max(a,o.begin),c=Math.min(o.begin+Hn,l),d=$('<div class="calendar-week-box">').data("nid",t),h=s.dateCalendarFormatExp;h?h.evaluate(database,e,(t,i)=>{null!=i?"styled"===h.returnType.base?(d.html((i.icon?'<div class="choice-icon ic ic-'+i.icon+'"></div>':"")+'<span style="color:'+(i.color||"")+'">'+htmlEscape(i.text)+"</span>"),d.css("background-color",i.background||s.dateCalendarColor||"")):"choice"===h.returnType.base||"dchoice"===h.returnType.base?h.returnType.loadValue(e._id,i,e=>{e?(d.html((e.icon?'<div class="choice-icon ic ic-'+e.icon+'"></div>':"")+'<span style="color:'+(e.textColor||"")+'">'+htmlEscape(e.caption)+"</span>"),d.css("background-color",e.color||s.dateCalendarColor||"")):d.css("background-color",s.dateCalendarColor||"")}):"icon"===h.returnType.base?(d.html('<div class="choice-icon ic ic-'+i+'"></div>'),d.css("background-color",s.dateCalendarColor||"")):"color"===h.returnType.base?d.css("background-color",i||s.dateCalendarColor||""):(d.text(h.returnType.format(i)),d.css("background-color",s.dateCalendarColor||"")):(d.text(""),d.css("background-color",s.dateCalendarColor||""))}):(d.text(i.caption+": "+i.format(e)),d.css("background-color",s.dateCalendarColor||""));const p={$box:d,begin:n,end:c,left:0,right:0,width:0,prev:null,next:null};o.boxes.push(p)}}}}}}for(let e=0;e<m.length;e++){const t=m[e],o=t.boxes;o.sort((function(e,t){return e.begin-t.begin}));for(let e=0;e<o.length;e++){const t=o[e];if(e<o.length-1){const i=o[e+1];t.end>i.begin&&(t.next=i)}for(let i=e-1;i>=0;i--){const e=o[i];if(e.end>t.begin){t.prev=e;break}}}for(let e=0;e<o.length;e++){const i=o[e];i.prev?i.left=i.prev.right:i.left=0;let n=0,a=i;for(;a=a.next;)n++;i.width=Math.floor((t.width-i.left)/(n+1)),i.right=i.left+i.width}for(let e=0;e<o.length;e++){const n=o[e];n.$box.css({left:t.left+n.left,width:n.width+1,top:Math.floor(64*(n.begin-t.begin)/Un-64*s)-1,height:Math.ceil(64*(n.end-n.begin)/Un)+1}).appendTo(i)}}},zn.prototype.setShowFullDay=function(e){e?(this.showFullDay=!0,this.$showFullDay.removeClass("selected")):(this.showFullDay=!1,this.$showFullDay.addClass("selected")),NinoxDocumentInteraction.setUserDefault("ui.calendarWeekFullDay",e?"true":"false")},zn.prototype.setDays=function(e){if(e!==this.days){if(this.$show7Days.toggleClass("selected",7==e),this.$show5Days.toggleClass("selected",5==e),this.$show1Days.toggleClass("selected",1==e),this.days=e,e>1){var t=this.start,i=t.getDay(),o=locale.firstDayOfWeek,n=7===e?t.getDate()-i+o-(i<o?7:0):t.getDate()-i+1-(i<o?7:0);this.start=new Date(t.getFullYear(),t.getMonth(),n)}NinoxDocumentInteraction.setUserDefault("ui.calendarWeekDays",String(e)),this.calendar.dateChanged(this.start)}},zn.prototype.setDate=function(e,t){var i=this.days;if(i>1){var o=e,n=o.getDay(),a=locale.firstDayOfWeek,s=7===i?o.getDate()-n+a-(n<a?7:0):o.getDate()-n+1-(n<a?7:0);this.start=new Date(o.getFullYear(),o.getMonth(),s)}else this.start=new Date(e.getFullYear(),e.getMonth(),e.getDate());this.updateLabel(),this.load(),!1!==t&&this.calendar.dateChanged(this.start)},zn.prototype.getNavigationState=function(){return{year:this.start.getFullYear(),month:this.start.getMonth(),day:this.start.getDate(),days:this.days,showFullDay:this.showFullDay}},zn.prototype.setNavigationState=function(e){var t=new Date;this.start=new Date(null!=e.year?e.year:t.getFullYear(),null!=e.month?e.month:t.getMonth(),null!=e.day?e.day:t.getDate());var i=5;if(null!=e.days)i=e.days;else{var o=NinoxDocumentInteraction.getUserDefault("ui.calendarWeekDays");o&&(i=parseInt(o))}this.setDays(i),this.setShowFullDay(null!=e.showFullDay?e.showFullDay:"true"===NinoxDocumentInteraction.getUserDefault("ui.calendarWeekFullDay")),this.load(),this.calendar.dateChanged(this.start)},zn.prototype.popupMiniCalendar=function(){var e=this;new Jn({year:e.start.getFullYear(),selectedDay:e.start,selectDay:function(t,i,o){e.setDate(new Date(t,i,o))}})},Bn.prototype.destroy=function(){this.hide(),this.controls.remove(),this.el.remove()},Bn.prototype.show=function(e){this.visible||(this.visible=!0,e&&this.setDate(e.getFullYear(),e.getMonth(),!1),this.controls.appendTo(ui.$menuCenter),this.el.appendTo(ui.$body),this.updateUI(),database.on("schema",void 0,this.schemaChanged,this),database.onChange(void 0,this.updateUI,this),database.onCreate(void 0,this.updateUI,this),database.onRemove(void 0,this.updateUI,this))},Bn.prototype.hide=function(){this.visible&&(this.visible=!1,database.off("schema",void 0,this.schemaChanged,this),database.offChange(void 0,this.updateUI,this),database.offCreate(void 0,this.updateUI,this),database.offRemove(void 0,this.updateUI,this),this.controls.detach(),this.el.detach())},Bn.prototype.schemaChanged=function(e,t,i){this.updateUI()},Bn.prototype.bodyResized=function(){this.updateUI()},Bn.prototype.onchange=function(){this.updateUI()},Bn.prototype.setDate=function(e,t,i){if(e!==this.year||t!==this.month){var o=new Date;this.today=new Date(o.getFullYear(),o.getMonth(),o.getDate());var n=new Date(e,t,1);this.week=util.getWeek(n),this.date=n,this.year=n.getFullYear(),this.month=n.getMonth();var a=n.getDay(),s=locale.firstDayOfWeek,r=a>=s?s-a+1:s-a-6;this.startDate=new Date(n.getFullYear(),n.getMonth(),r),!1!==i&&this.calendar.dateChanged(new Date(e,t,1))}},Bn.prototype.nextMonth=function(){this.month<11?(this.setDate(this.year,this.month+1),this.updateUI()):(this.setDate(this.year+1,0),this.updateUI())},Bn.prototype.prevMonth=function(){this.month>0?(this.setDate(this.year,this.month-1),this.updateUI()):(this.setDate(this.year-1,11),this.updateUI())},Bn.prototype.nextYear=function(){this.setDate(this.year+1,this.month),this.updateUI()},Bn.prototype.prevYear=function(){this.setDate(this.year-1,this.month),this.updateUI()},Bn.prototype.getDate=function(e){return new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate()+e)},Bn.prototype.getIndex=function(e){var t=this.startDate,i=e;return Math.floor((i-t)/864e5-(i.getTimezoneOffset()-t.getTimezoneOffset())/1440)},Bn.prototype.updateUI=function(){if(this.visible){var e=this,t=new Date(e.year,e.month,1),i=new Date(e.year,e.month+1,1);database.loadCalendarFromTo(t,i,(function(t,i){var o={},n=[];if(i)for(var a=0;a<i.length;a++){var s=i[a];o[s]||(n.push(s),o[s]=!0)}e.updateRefs(n)}))}},Bn.prototype.updateRefs=function(e){var t=this,i=this.calendar.getDependencies();database.loadNodes2(e,i,(function(){database.filterReadable(void 0,e,(function(e){t.label.text(locale.monthNames[t.date.getMonth()]+" "+t.date.getFullYear());for(var i=0;i<t.cells.length;i++)t.cells[i].updateUI();for(i=0;i<6;i++){let e=new Date(t.date.getTime());e.setDate(e.getDate()+7*i),t.tds[i].text(String(util.moment(e).isoWeek()))}t.cells[35].date.getMonth()!==t.month?t.trs[5].hide():t.trs[5].show(),k.each(e,(function(e){var i=database.loadNodeSync(e);if(i){var o=database.typeOf(e);if(o)for(var n in o.fields)if(o.fields.hasOwnProperty(n)){var a=o.fields[n];if(a.dateCalendar)if("date"===a.base){if("number"==typeof(r=i[n])&&!isNaN(r)){var s=new Date(r);a.dateYearly&&s.setYear(t.year),(h=t.getIndex(s))>=0&&h<42&&t.cells[h].addRef(o,a,i)}}else if("datx"===a.base){if("number"==typeof(r=i[n])&&!isNaN(r)){s=new Date(r);s=new Date(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.dateYearly&&s.setYear(t.year),(h=t.getIndex(s))>=0&&h<42&&t.cells[h].addRef(o,a,i)}}else if("appointment"===a.base){var r;if(r=i[n]){var l=r.split("/");if(2===l.length){var c=parseInt(l[0]),d=c+parseInt(l[1]);for(s=new Date(c);;){var h;if((h=t.getIndex(s))>=0&&h<42&&t.cells[h].addRef(o,a,i),(s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1)).getTime()>d)break}}}}}}}))}))}))},qn.prototype.updateUI=function(){this.refs={},this.td.empty(),this.td.attr("class","calendar-day-"+(this.index+locale.firstDayOfWeek)%7),this.date=this.calendar.getDate(this.index),this.label=$("<label>").text(this.date.getDate()).appendTo($('<div class="placeholder">').appendTo(this.td)),this.ul=$("<ul>").appendTo(this.td),this.date.toString()==this.calendar.today.toString()?this.td.addClass("calendar-today"):this.date.getMonth()!==this.calendar.month&&this.td.addClass("calendar-other-month")},qn.prototype.addRef=function(e,t,i){this.refs[i._id]=!0;var o=$("<li>").appendTo(this.ul).touch((function(e){return new kn.PopupEditor(i._id,{duplicate:!0}),!1})),n=t.dateCalendarFormatExp;n?n.evaluate(database,i,(function(a,s){if(a)o.text(e.caption+": "+e.format(i));else if(null!=s)switch(n.returnType.base){case"choice":case"dchoice":n.returnType.loadValue(i._id,s,e=>{e?(o.html((e.icon?'<div class="choice-icon ic ic-'+e.icon+'"></div>':"")+'<span style="color:'+(e.textColor||"")+'">'+htmlEscape(e.caption)+"</span>"),o.css("background-color",e.color||t.dateCalendarColor||"")):o.css("background-color",t.dateCalendarColor||"")});break;case"styled":o.html((s.icon?'<div class="choice-icon ic ic-'+s.icon+'"></div>':"")+'<span style="color:'+(s.color||"")+'">'+htmlEscape(s.text)+"</span>"),o.css("background-color",s.background||t.dateCalendarColor||"");break;case"color":o.css("background-color",color||t.dateCalendarColor||"");break;case"icon":o.html('<div class="choice-icon ic ic-'+s+'"></div>'),o.css("background-color",t.dateCalendarColor||"");break;default:o.text(n.returnType.format(s)),o.css("background-color",t.dateCalendarColor||"")}else o.css("background-color",t.dateCalendarColor||"")})):(o.text(e.caption+": "+e.format(i)),o.css("background-color",t.dateCalendarColor||""))},Bn.prototype.getNavigationState=function(){return{year:this.year,month:this.month}},Bn.prototype.setNavigationState=function(e){var t=new Date;this.setDate(null!=e.year?e.year:t.getFullYear(),null!=e.month?e.month:t.getMonth()),this.updateUI()},Bn.prototype.popupMiniCalendar=function(){var e=this;new Jn({year:this.year,selectMonth:function(t,i){e.setDate(t,i),e.updateUI()}})},Gn.prototype.showMonth=function(){this.tabMonth.addClass("selected"),this.tabWeek.removeClass("selected"),this.calendarMonth.show(this.currentDate),this.calendarWeek.hide(),this.currentTab=this.calendarMonth,NinoxDocumentInteraction.setUserDefault("ui.calendarMode","month")},Gn.prototype.showWeek=function(){this.tabMonth.removeClass("selected"),this.tabWeek.addClass("selected"),this.calendarMonth.hide(),this.calendarWeek.show(this.currentDate),this.currentTab=this.calendarWeek,NinoxDocumentInteraction.setUserDefault("ui.calendarMode","week")},Gn.prototype.dateChanged=function(e){this.currentDate=e},Gn.prototype.destroy=function(){this.calendarMonth.destroy(),this.calendarWeek.destroy(),this.tabs.remove()},Gn.prototype.show=function(){this.visible||(this.visible=!0,this.tabs.appendTo(ui.$header),this.currentTab.show())},Gn.prototype.hide=function(){this.visible&&(this.visible=!1,this.currentTab.hide(),this.tabs.detach())},Gn.prototype.bodyResized=function(){this.currentTab.bodyResized()},Gn.prototype.getDependencies=function(){var e={},t=database.schema.types;for(var i in t)if(t.hasOwnProperty(i)){var o=t[i].fields;for(var n in o){var a=o[n];a.dateCalendar&&a.dateCalendarFormatExp&&(e=queries.extendDependencies(a.dateCalendarFormatExp.dependencies))}}return e},Gn.prototype.getNavigationState=function(){return{base:"calendar",mode:this.currentTab===this.calendarMonth?"month":"week",calendarMonth:this.calendarMonth.getNavigationState(),calendarWeek:this.calendarWeek.getNavigationState()}},Gn.prototype.setNavigationState=function(e){this.calendarMonth.setNavigationState(e.calendarMonth||{}),this.calendarWeek.setNavigationState(e.calendarWeek||{});const t=Tt(),i="month"===t.vid?"month":"week"===t.vid?"week":e.mode||"week";i!==t.vid&&vt(Xn({},t,{vid:i})),"month"===i?this.showMonth():this.showWeek()},Gn.prototype.updateUI=function(){this.visible&&this.currentTab&&this.currentTab.updateUI()},Gn.prototype.popupSync=function(){var e=this;$.loading(!0),NinoxCalendar.enableCalendarSync((function(t,i){return $.loading(!1),t?callback(t):i?void e.showCalendarSyncOptions():callback(locale.noCalendarAccess)}))},Gn.prototype.showCalendarSyncOptions=async function(){for(var e,t=this,i="db."+database.getUniqueID(),o="true"===NinoxDocumentInteraction.getUserDefault(i+".calendar.syncEnabled"),n=NinoxDocumentInteraction.getUserDefault(i+".calendar.syncStorage"),a=parseInt(NinoxDocumentInteraction.getUserDefault(i+".calendar.syncBeyond")||"1"),s=parseInt(NinoxDocumentInteraction.getUserDefault(i+".calendar.syncAhead")||"3"),r=parseInt(NinoxDocumentInteraction.getUserDefault("ui.calendar.dayStart")||"28800000"),l=parseInt(NinoxDocumentInteraction.getUserDefault("ui.calendar.dayEnd")||"64800000"),c=util.localeSortBy(await NinoxCalendar.getSources(),"title"),d={},h=0;h<c.length;h++){var p=c[h];d[p.id]={id:p.id,caption:p.title,order:h},e||!/icloud/i.test(p.title)&&!/^androidlocal$/.test(p.id)||(e=p.id)}n||(n=e);var u=$.popdown({cls:"small",head:locale.calendarOptions,closable:!1,buttons:["cancel","-",{caption:locale.okay,cls:"blue",click:k}]}),f=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.calendarSyncEnabled,required:!0,width:2,booleanRenderer:"switch"}));f.value=o,f.on("update",C);new qt.a(this,f,u.$content);var m=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.calendarSyncLocation,required:!0,width:2,values:d}));m.value=n;var g=new qt.a(this,m,u.$content),v=new util.SimpleModel(new schemas.TNumber(void 0,void 0,{caption:locale.calendarSyncBeyond,required:!0,width:2}));v.value=a;var y=new qt.a(this,v,u.$content),b=new util.SimpleModel(new schemas.TNumber(void 0,void 0,{caption:locale.calendarSyncAhead,required:!0,width:2}));b.value=s;var w=new qt.a(this,b,u.$content);$("<hr>").appendTo(u.$content),$('<div class="nx-sub-head">').text(locale.defineWorkHours).appendTo(u.$content);var x=new util.SimpleModel(new schemas.TTime(void 0,void 0,{caption:locale.calendarWorkStart,required:!0,width:2}));x.value=r;new qt.a(this,x,u.$content);var T=new util.SimpleModel(new schemas.TTime(void 0,void 0,{caption:locale.calendarWorkEnd,required:!0,width:2}));T.value=l;new qt.a(this,T,u.$content);function C(){var e=f.value;g.el.css("display",e?"":"none"),w.el.css("display",e?"":"none"),y.el.css("display",e?"":"none")}function k(){var e=parseInt(v.value);if(!(e>=0))return $.alert("Sync beyond must be greater than 0");if(!(e<=12))return $.alert("Sync beyond cannot be greater than 12");var o=parseInt(b.value);if(!(o>=1))return $.alert("Sync ahead must be greater than 0");if(!(o<=12))return $.alert("Sync ahead cannot be greater than 12");var n=x.value;if(!(n>=0))return $.alert("Day start must be greater or equal to 00:00");if(!(n<=864e5))return $.alert("Day start must be smaller or eqaal to 24:00");var a=T.value;return a>=0?a<=864e5?n<a?(NinoxDocumentInteraction.setUserDefault(i+".calendar.syncEnabled",String(f.value)),NinoxDocumentInteraction.setUserDefault(i+".calendar.syncStorage",String(m.value||"")),NinoxDocumentInteraction.setUserDefault(i+".calendar.syncBeyond",String(e)),NinoxDocumentInteraction.setUserDefault(i+".calendar.syncAhead",String(o)),NinoxDocumentInteraction.setUserDefault("ui.calendar.dayStart",String(n)),NinoxDocumentInteraction.setUserDefault("ui.calendar.dayEnd",String(a)),u.close(),database.calendarSync&&database.calendarSync.settingsChanged(),void t.updateUI()):$.alert("Day start must be smaller than day end."):$.alert("Day end must be smaller or eqaal to 24:00"):$.alert("Day end must be greater or equal to 00:00")}C()};class Zn{constructor(){Je()(this,"visible",void 0),Je()(this,"el",void 0),Je()(this,"$controls",void 0),Je()(this,"$search",void 0),Je()(this,"$searchContainer",void 0),Je()(this,"$searchText",void 0),Je()(this,"$searchCancel",void 0),Je()(this,"$searchPlaceholder",void 0),Je()(this,"recordController",void 0),Je()(this,"keydown",void 0);const e=this;this.visible=!1,this.el=$('<div class="search-page">').click(r),this.$controls=$('<div class="hud-menu-group" style="margin-left:12px">'),this.$searchContainer=$('<div class="hud-menu-search">').appendTo(this.$controls),this.$searchPlaceholder=$('<div class="hud-menu-search-placeholder">').appendTo(this.$searchContainer),$('<div class="i-24-16 i-light-grey i-search" style="opacity: 0.5;margin-left: 3px;">').appendTo(this.$searchPlaceholder),this.$searchText=$('<div style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">').text(Object(b.getLocale)().FindIn$.replace("$",database.name)).appendTo(this.$searchPlaceholder),this.$search=$('<input type="text" class="hud-menu-search-input" style="display:none">').appendTo(this.$searchContainer).keyup(x).change(x),(this.$searchCancel=$('<div class="i-32-16 i-light-grey i-close" style="margin-left:-32px;margin-top:4px;display:none">').appendTo($('<div style="width:0;flex:0 0 0px;-webkit-flex:0 0 0px">').appendTo(this.$searchContainer))).touch(()=>{this.$search.val(""),x()}),this.$searchPlaceholder.touch($.proxy(this.focus,this)),this.$search.blur(()=>{this.$searchPlaceholder.css("display",""),this.$search.css("display","none")}),this.recordController={hasNextRecord:()=>!0,nextRecord:m,hasPrevRecord:()=>!0,prevRecord:g,hasAddRecord:()=>{if(!i)return!1;const e=database.typeOf(i);return!!e&&database.canCreate(e)},addRecord:()=>{if(!i)return;const e=database.typeOf(i);e&&database.canCreate(e)&&database.create(e,{},(e,t)=>{if(e)return $.alert(e);c(),t&&d(t._id)})},hasDuplicateRecord:()=>{if(!i)return!1;const e=database.typeOf(i);return!!e&&database.canCreate(e)},duplicateRecord:p,hasRemoveRecord:()=>{if(!i)return!1;const e=database.typeOf(i);return!!e&&database.canDelete(e)},removeRecord:u,hasPrintRecord:()=>!(!i||!1===database.authorizationPrint),printRecord:f},this.keydown=e=>{switch(e.which){case 27:c();break;case 38:g();break;case 40:m()}};let t=null,i=null,o="",n=null,a=0,s={};function r(e){const i=$(e.target).closest("tr");t&&t.attr("nid")===i.attr("nid")?l(void 0):l(i)}function l(e){if(t&&(t.removeClass("selected"),t=null),e){const i=e.attr("nid");i?(e.addClass("selected"),t=e,d(i)):h()}else h();ui.recordNavigation.updateUI()}function c(){l(void 0)}function d(e){i=e,ui.sideEditor.open(i,{prev:g,next:m,first:v,last:y,close:c,duplicate:p},!1)}function h(){i=null,ui.sideEditor.close()}function p(){i&&database.duplicate(i,(e,t)=>{if(e)return $.alert(e);c(),d(t)})}function u(){const e=i;if(!e)return;const t=database.typeOf(e);t&&database.canDelete(t)&&$.dialog({closable:!0,caption:Object(b.getLocale)().remove,message:Object(b.getLocale)().confirmRemove,buttons:[{color:"red",caption:Object(b.getLocale)().remove,callback:()=>{$.loading(!0),database.remove(e,t=>{if($.loading(!1),t)return $.alert(t);w(e)})}}]})}function f(){if(!1===database.authorizationPrint)return;const e=i;e&&database.typeOf(e)&&(reports?reports.openDesigner({nid:e}):Object(_e.a)(e))}function m(){t&&l(t.next())}function g(){t&&l(t.prev())}function v(){if(t){const e=t.siblings();e.length>0&&l($(e[0]))}}function y(){if(t){const e=t.siblings();e.length>0&&l($(e[e.length-1]))}}const w=e=>{e===i&&c();const t=b.schemas.RE_NID.exec(e);if(!t)return;const o=t[1],n=parseInt(t[2],10),a=s[o];if(a){const e=a.rids,t=e.indexOf(n);-1!==t&&e.splice(t,1),k()}};function x(){const t=e.$search.val();e.$searchText.text(t||Object(b.getLocale)().FindIn$.replace("$",database.name)).css("color",t?"":"#7D8294"),e.$searchCancel.css("display",t?"":"none"),n&&clearTimeout(n),n=window.setTimeout(T,200)}function T(){n=null;const t=e.$search.val().trim();t!==o&&(o=t,a++,C(a,t))}const C=(e,t)=>{function i(t,i){if(e!==a)return;s={};const o=[];let n={};function r(){for(const e in i)if(i.hasOwnProperty(e)){const t=i[e];if(t.length){const i=database.schema.types[e];if(i&&database.canRead(i)){i.canReadExp&&(n=b.queries.extendDependencies(n,i.canReadExp.dependencies));const a=i.sorted,r=[];for(let t=0;t<a.length&&r.length<8;t++){const i=a[t];if((i.isField&&"file"!==i.base||i.isReference)&&database.canRead(i))if(r.push(i),"fn"===i.base&&i.exp)n=b.queries.extendDependencies(n,i.exp.dependencies);else if(i.isReference){const t={};t[e]=i.id,n=b.queries.extendDependencies(n,t)}}s[e]={type:i,fields:r,rids:t};for(const i of t)o.push(e+t)}}}}r(),database.loadNodes2(o,n,()=>{k()})}t?database.fastSearch(void 0,t,i):(s={},k())};async function k(){let t="";for(const e in s)if(s.hasOwnProperty(e)){const i=s[e],o=i.rids,n=i.type,a=n.canReadExp;o.sort((e,t)=>e-t);const r=i.fields;t+="<h1>"+htmlEscape(n.caption)+"</h1><table><thead><tr>",t+='<th style="position:sticky;top:-1px;background: white;">'+htmlEscape(Object(b.getLocale)().id)+"</th>";for(const e of r)t+='<th style="position:sticky;top:-1px;background: white;">'+htmlEscape(e.caption)+"</th>";t+="</tr></thead><tbody>";for(const i of o){const o=e+i,n=database.loadNodeSync(o);if(n&&(!a||await a.promise(database,n).catch(()=>{}))){t+='<tr nid="'+o+'">',t+='<td style="text-align:right">'+i+"</td>";for(const e of r)if("choice"===e.base||"dchoice"===e.base){const i=n[e.id],a=null==i?void 0:await new Promise(t=>e.loadValue(o,i,t));t+=a?'<td style="text-align:'+e.columnAlign+'"><div class="multicombo-item" style="'+(a.color?"background-color:"+a.color:"")+'">'+(a.icon?'<div class="choice-symbol ic ic-'+a.icon+'"></div>':"")+"<span>"+htmlEscape(a.caption||"")+"</span></div></td>":'<td style="text-align:'+e.columnAlign+'"></td>'}else if("multi"===e.base||"dmulti"===e.base){t+='<td style="text-align:'+e.columnAlign+'">';const i=n[e.id];if(i){const n=b.util.multiDecode(i);if(n){const i=await new Promise(t=>e.loadValues(o,(e,i)=>t(i||{})));for(const e of n){const o=i[e];o&&(t+='<div class="multicombo-item" style="'+(o.color?"background-color:"+o.color:"")+'">'+(o.icon?'<div class="choice-symbol ic ic-'+o.icon+'"></div>':"")+"<span>"+htmlEscape(o.caption||"")+"</span></div>")}}}t+="</td>"}else{let i="";if("fn"===e.base){if(e.exp){const t=await e.exp.promise(database,n).catch(()=>{});null==t||t._missingNodes||(i=e.exp.returnType.format(t))}}else if(e.isField)i=e.format(n[e.id]);else if(e.isReference){const t=n[e.id];if(t){const o=database.loadNodeSync(e.refTypeId+t);i=e.refType.format(o)}}t+='<td style="text-align:'+e.columnAlign+'">'+htmlEscape(i)+"</td>"}t+="</tr>"}}t+="</tbody></table>"}e.el.html(t)}}destroy(){this.hide(),this.el.remove()}show(){this.visible||(this.visible=!0,this.$controls.appendTo(ui.$menuCenter),this.el.appendTo(ui.$body),ui.recordNavigation.pushController(this.recordController),$.pushInputHandler(this),setTimeout($.proxy(this.focus,this),100))}hide(){this.visible&&(this.visible=!1,ui.recordNavigation.popController(this.recordController),$.popInputHandler(this),ui.sideEditor.close(),this.$search.blur(),this.$controls.detach(),this.el.detach())}setNavigationState(){"all"!==Tt().vid&&vt(Qn({},Tt(),{vid:"all"}))}getNavigationState(){return{base:"search"}}focus(){this.$searchPlaceholder.css("display","none"),this.$search.css("display",""),this.$search.focus()}}function ea(e,t){var i=this,o=database.typeOf(e);o&&(this.isOpen=!0,t=t||{},this.options=t,this.nid=e,this.children=[],this.$backplane=$.backplane({closable:!1}),this.el=$('<div class="fullscreeneditor'+(!1===t.controls?" no-controls":"")+'">').appendTo(this.$backplane),this.buttons=$('<div class="popupeditor2-buttons-left">').appendTo(this.el).button2({icon:"i-40-18 i-light-grey i-close",click:$.proxy(ui.closeFullscreen,ui)}),this.tabsEl=$('<div class="popupeditor2-tabs">').appendTo(this.el),this.editor=new Ao(this,o.id,{},void 0),database.loadNode(e,(function(e,t){t&&i.editor.bind(t)})),database.on("rename",void 0,this.nodeRenamed,this),database.on("remove",void 0,this.nodeRemoved,this),database.on("schema",void 0,this.schemaChanged,this),database.on("admin",void 0,this.adminChanged,this),$.pushInputHandler(this))}ea.prototype.setNid=function(e){var t=this;this.nid=e,database.loadNode(e,(function(e,i){i&&t.editor.bind(i)}))},ea.prototype.close=function(){this.isOpen&&(this.isOpen=!1,this.editor.destroy(),database.off("rename",void 0,this.nodeRenamed,this),database.off("remove",void 0,this.nodeRemoved,this),database.off("schema",void 0,this.schemaChanged,this),database.off("admin",void 0,this.adminChanged,this),$.popInputHandler(this),this.$backplane.close())},ea.prototype.nodeRenamed=function(e,t,i){t===this.nid&&this.setNid(i)},ea.prototype.nodeRemoved=function(e,t){t===this.nid&&this.close()},ea.prototype.schemaChanged=function(e,t,i){this.updateStructure()},ea.prototype.adminChanged=function(e,t){this.updateStructure()},ea.prototype.updateStructure=function(){var e=this;database.typeOf(this.nid)&&(this.editor.updateStructure(),database.loadNode(this.nid,(function(t,i){i?e.editor.bind(i):this.close()})))},ea.prototype.updateBackground=function(e){var t=util.luminosity(e)<.5;this.el.css("background-color",e||"#FFF"),this.el.toggleClass("darkmode",t)},ea.prototype.getSelectedNid=function(){return this.nid},ea.prototype.isFullscreen=function(){return!0};let ta="";function ia(){var e,t=Array.prototype.join.call(arguments," "),i=document.getElementById("LOG");if(e=i?$(i):$('<div id="LOG" style="position:fixed;left:0;bottom:0;width:100%;padding:32px;box-sizing:border-box;-moz-box-sizing:border-box;background-color:rgba(0,0,0,.8);color:#fff;overflow:auto;z-index:999">').hide().appendTo($(document.body)).click((function(){return ta="",e.stop(!0,!1).hide().empty(),!1})),t!==ta){var o=e.children();o.length>4&&$(o[0]).remove(),o.css("color","#aaa"),e.append($("<div>").text([].join.call(arguments," ")))}e.stop(!0,!1).fadeIn().delay(3e3).fadeOut(),ta=t}function oa(){Object(c.f)()||na()}function na(){var e=database.account.id;if("local"===e)ui.planInfo=void 0,sa();else{var t=NinoxDocumentInteraction.getUserDefault("ui.planInfo."+e);t&&(ui.planInfo=b.util.parseJSON(t),sa());var i=database.account.getOwnerId();dbms.getRemoteConnection().getPlanInfo(i,(function(e,t){if(e)return console.log(e);t&&aa(t)}))}}function aa(e){var t=database.account.id;"local"!==t&&(ui.planInfo=e,NinoxDocumentInteraction.setUserDefault("ui.planInfo."+t,JSON.stringify(e)),sa())}function sa(){var e=database.account.id;if("local"!==e){var t=dbms.getRemoteConnection().getAccount(e),i=t.owner===dbms.getRemoteConnection().getUserId(),o=t.users[t.owner],n=!1,a=!1;ui.planInfo&&(n="none"===ui.planInfo.name,a=ui.planInfo.free>ui.planInfo.collaborators),ra(ui.planInfo,n,a,i,o)}}function ra(e,t,i,o,n,a){t||i?(ui.$planInfo?ui.$planInfo.empty():(trackPageView("expired"),Object(l.f)("PlanExpired","Show",{isOwner:o}),ui.setTopPadding(128),ui.$planInfo=$('<div style="background:#fff;position:absolute;left:0;top:0;width:100%;height:127px;display:flex;-webkit-display:flex;align-items:center;align-content:center;border-bottom:solid 1px #ccc">').prependTo(document.body)),$('<div style="flex:1 1 0px;-webkit-flex:1 1 0px">').appendTo(ui.$planInfo),$('<div class="thankyou" style="flex:0 0 auto;-webkit-flex:0 0 auto">').appendTo(ui.$planInfo),$('<div style="flex:0 1 32px;-webkit-flex:0 1 32px">').appendTo(ui.$planInfo),o?$('<div style="flex:0 1 auto;-webkit-flex:0 1 auto">').html('<div style="font-size:16px;font-weight:bold;padding:4px">'+htmlEscape(t?locale.planExpired:locale.planOverused)+'</div><div style="padding:4px">'+htmlEscape(locale.planUsageInfo.replace("$1",e.total).replace("$2",e.teamCount))+(e.basic>0?htmlEscape(" "+locale.planUsageCovered.replace("$1",e.basic)):"")+'</div><div style="padding:4px">'+htmlEscape(locale.planGetNow.replace("$1",e.free))+"</div>").appendTo(ui.$planInfo):$('<div style="flex:0 1 auto;-webkit-flex:0 1 auto">').html(htmlEscape((t?locale.planExpiredMember:locale.planOverusedMember).replace("$1",n.email))).appendTo(ui.$planInfo),$('<div style="flex:0 1 32px;-webkit-flex:0 1 32px">').appendTo(ui.$planInfo),$('<div class="nx-button-text blue" style="flex:0 0 auto;-webkit-flex:0 0 auto">').text(o?locale.planGetNowCTA:locale.contactOwner).appendTo(ui.$planInfo).touch((function(){if(o)Object(l.f)("PlanExpired","Upgrade",{isOwner:o}),trackEvent("expired-upgrade","click"),root.upgradePlan();else{Object(l.f)("PlanExpired","ContactOwner",{isOwner:o}),trackEvent("expired-contact","click");var e="mailto:"+n.email;NinoxDocumentInteraction.openBrowser(e)}})),$('<div style="flex:1 1 0px;-webkit-flex:1 1 0px">').appendTo(ui.$planInfo)):ui.$planInfo&&(ui.setTopPadding(0),ui.$planInfo.remove(),ui.$planInfo=void 0)}o("./src/react/credentials/Credentials.scss");const la=[{name:"Afghanistan",code:"AF"},{name:"Åland Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"AndorrA",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"The Democratic Republic of the Congo",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Laos",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"RWANDA",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia and Montenegro",code:"CS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan, Province of China",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor-Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Viet Nam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}];function ca(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function da(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ca(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const ha={SignUp0:e=>{const t=Object(b.getLocale)(),i=t=>{e.setFormState({isBusiness:"true"===t.target.value})};return s.createElement(s.Fragment,null,s.createElement(Ze.a,{className:"close-popup",onFastClick:()=>e.close()}),s.createElement("h4",{className:"center mb-24"},t.signUpHeader1_1,s.createElement("br",null),t.signUpHeader1_2),s.createElement("div",{className:"mb-24"},s.createElement("label",{className:"form-control"},s.createElement("input",{onChange:i,checked:e.formState.isBusiness,type:"radio",name:"userType",value:"true"}),s.createElement("div",{className:"radio-control"},t.business)),s.createElement("label",{className:"form-control"},s.createElement("input",{onChange:i,checked:!e.formState.isBusiness,type:"radio",name:"userType",value:"false"}),s.createElement("div",{className:"radio-control"},t.private))),s.createElement("div",{className:"center mb-40 body--2 content--60"},t.signUpBusinessMessage),s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{className:"button button--filled",onFastClick:()=>e.switchPage("SignUp1")},t.next)),s.createElement("div",{className:"popup--text"},t.haveAnAccount," ",s.createElement(Ze.a,{onFastClick:()=>e.switchPage("SignIn0"),className:"link"},t.login2)))},SignUp1:e=>{const t=Object(b.getLocale)(),[i,o]=s.useState(!1),[n,a]=s.useState(null),[r,c]=s.useState(!1),d=t=>{e.setFormState({email:t.target.value}),o(!1)},h=t=>{e.setFormState({password:t.target.value}),o(!1)},p=t=>{e.setFormState({newsletter:t.target.checked}),o(!1)},u=e.formState.password||"",f=[[u.length>=8,t.passHintLen],[u.toLowerCase()!==u&&u.toUpperCase()!==u,t.passHintCase],[/[^\w\s]/.test(u),t.passHintChar],[/\d/.test(u),t.passHintNum]],m=e.formState.email.length&&b.util.isValidEmail(e.formState.email),g=!f.some(([e,t])=>!e),v=m&&g;function y(){o(!0),v&&Object(l.b)((t,i)=>{t&&console.warn("Could not fetch attribution details",t),$.loading(!0),window.dbms.getRemoteConnection().signup({email:e.formState.email,password:e.formState.password,newsletter:e.formState.newsletter,iadAttributionDetails:i},(t,i)=>{if(window.trackEvent("signup",t?"error":"success"),Object(l.f)("Signup",t?"Error":"Success"),$.loading(!1),t)return a(t);e.setUserId(i),e.formState.isBusiness?e.switchPage("SignUp2"):(e.close(),e.afterLogin())})})}async function w(){const t=window.dbms,i=await t.getRemoteConnection().googleLogin(),{userId:o,newUser:n}=i;e.setUserId(o),!e.formState.isBusiness||!0!==n&&"true"!==n?(NinoxDocumentInteraction.setUserDefault("nx.session.logout.user",""),NinoxDocumentInteraction.setUserDefault("nx.session.login.user",i.email),e.close(),e.afterLogin()):e.switchPage("SignUp2")}return s.createElement(s.Fragment,null,s.createElement(Ze.a,{className:"close-popup",onFastClick:()=>e.close()}),s.createElement("h4",{className:"center mb-24"},t.signUpHeader2),s.createElement("div",{className:"mb-24"},s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.emailAddress),s.createElement("input",{type:"email",required:!0,onChange:d,value:e.formState.email,className:Object(An.a)({error:i&&!m})}),i&&!m?s.createElement("div",{className:"error-message"},t.invalidUserEMail):null),s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.password),s.createElement("input",{autoComplete:"off",type:"password",onChange:h,value:e.formState.password,className:Object(An.a)({error:i&&!g}),onFocus:()=>c(!0),onBlur:()=>c(!1)}),i&&!g?s.createElement("div",{className:"error-message"},t.wrongPassword):null,s.createElement("div",{className:Object(An.a)("password-hint",{active:r})},s.createElement("div",{className:"password-hint-pointer-wrapper"},s.createElement("div",{className:"password-hint-pointer-border"},s.createElement("div",{className:"password-hint-pointer"}))),s.createElement("div",{className:"password-hint-container"},s.createElement("div",null,t.passHint),f.map(([e,t],i)=>s.createElement("div",{key:i,className:Object(An.a)({fulfilled:e})},t))))),s.createElement("div",{className:"mb-24"},s.createElement("label",{className:"form-control"},s.createElement("input",{type:"checkbox",name:"newsletter",onChange:p,checked:e.formState.newsletter}),s.createElement("div",{className:"checkbox-control"},t.signUpNewsletter," ",s.createElement("a",{className:"privacy-link",href:"https://ninox.com/privacy#privacy5",target:"_blank"},t.signUpPrivacyPolicy))))),i&&n?s.createElement("div",{className:"form-error-message mb-24 center"},n):null,s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{className:"button button--filled",onFastClick:y},t.register)),s.createElement("div",{className:"center"},t.termsDisclamer.split("$")[0],s.createElement("a",{href:"https://ninox.com/en/terms",className:"link"},t.termsDisclamer.split("$")[1]),t.termsDisclamer.split("$")[2]),s.createElement("div",{className:"or-line"},s.createElement("div",{className:"or-text"},t.op_or)),e.isGoogleAvailable?s.createElement(s.Fragment,null,s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{onFastClick:w,className:"google-login-button"},s.createElement("span",{className:"google-logo logo"}),s.createElement("span",null," ",t.signupWithGoogle," ")))):null,s.createElement("div",{className:"popup--text"},t.haveAnAccount," ",s.createElement(Ze.a,{onFastClick:()=>e.switchPage("SignIn0"),className:"link"},t.login2)))},SignUp2:e=>{const t=Object(b.getLocale)(),[i,o]=s.useState(!1),[n,a]=s.useState(null),r=t=>{e.setFormState({displayName:t.target.value}),o(!1)},l=t=>{e.setFormState({company:t.target.value}),o(!1)},c=t=>{e.setFormState({telephone:t.target.value}),o(!1)},d=t=>e.setFormState({country:t.target.value}),h=!!e.formState.displayName.length,p=!!e.formState.company.length,u=e.formState.telephone.length>6,f=h&&p&&u;function m(){if(!f)return o(!0);const{displayName:t,company:i,country:n,telephone:s}=e.formState;$.loading(!0),window.dbms.getRemoteConnection().updateUserProfile({displayName:t,company:i,country:n,telephone:s},t=>{if(t)return a(t);e.close(),$.loading(!1),e.afterLogin()})}return s.createElement(s.Fragment,null,s.createElement("h4",{className:"center mb-24"},t.signUpHeader3),s.createElement("div",{className:"mb-24"},s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.fullName),s.createElement("input",{className:Object(An.a)({error:i&&!h}),type:"text",required:!0,onChange:r,value:e.formState.displayName}),i&&!h?s.createElement("div",{className:"error-message"},t.allFieldsAreRequired):null),s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.company),s.createElement("input",{className:Object(An.a)({error:i&&!p}),type:"text",required:!0,onChange:l,value:e.formState.company}),i&&!p?s.createElement("div",{className:"error-message"},t.allFieldsAreRequired):null),s.createElement("span",{className:"form-control required"},s.createElement("span",{className:"caption"},t.country),s.createElement("input",{type:"text",required:!0,value:e.formState.country,readOnly:!0}),s.createElement("select",{value:e.formState.country,onChange:d,style:{width:"100%",position:"absolute",top:"32px",left:0,opacity:0}},la.map(({name:e})=>s.createElement("option",{key:e,value:e},e)))),s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.workPhone),s.createElement("input",{className:Object(An.a)({error:i&&!u}),type:"phone",required:!0,onChange:c,value:e.formState.telephone}),i&&!u?s.createElement("div",{className:"error-message"},t.allFieldsAreRequired):null)),i&&n?s.createElement("div",{className:"form-error-message mb-24 center"},n):null,s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{className:"button button--filled",onFastClick:m},t.saveProfile)),s.createElement("div",{className:"body--2 content--60 center"},t.allFieldsAreRequired))},SignIn0:e=>{const t=Object(b.getLocale)(),[i,o]=s.useState(!1),[n,a]=s.useState(!1),r=t=>e.setFormState({email:t}),d=e.formState.email,[h,p]=s.useState(""),u=d.length&&h.length;function f(){if(!u)return o(!0);const t=window.dbms;$.loading(!0),t.getRemoteConnection().login(d,h,i=>{if(window.trackEvent("login",i?"error":"success"),Object(l.f)("Login",i?"Error":"Success"),$.loading(!1),i)return a(!0);const o=t.getRemoteConnection().getCurrentUser();e.setUserId(o.id),Object(c.f)()&&o.passwordExpired&&t.getRemoteConnection().logout(()=>{e.switchPage("ResetPassword0")}),NinoxDocumentInteraction.setUserDefault("nx.session.logout.user",""),NinoxDocumentInteraction.setUserDefault("nx.session.login.user",d),e.close(),e.afterLogin()})}async function m(){const t=window.dbms,i=await t.getRemoteConnection().googleLogin(),{userId:o,newUser:n}=i;e.setUserId(o),!e.formState.isBusiness||!0!==n&&"true"!==n?(NinoxDocumentInteraction.setUserDefault("nx.session.logout.user",""),NinoxDocumentInteraction.setUserDefault("nx.session.login.user",i.email),e.close(),e.afterLogin()):e.switchPage("SignUp2")}function g(e){13===e.nativeEvent.keyCode&&u&&f()}return s.createElement(s.Fragment,null,s.createElement(Ze.a,{className:"close-popup",onFastClick:()=>e.close()}),s.createElement("div",{className:"mb-24"},s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.emailAddress),s.createElement("input",{className:Object(An.a)({error:i&&0===d.length}),type:"email",required:!0,onKeyDown:g,onChange:e=>{r(e.target.value),a(!1)},value:d})),s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.password),s.createElement("input",{className:Object(An.a)({error:i&&0===h.length}),type:"password",required:!0,onKeyDown:g,onChange:e=>{p(e.target.value),a(!1)},value:h}))),n?s.createElement("div",{className:"form-error-message mb-24 center"},t.invalidCredentials):null,s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{className:"button button--filled",onFastClick:f},t.login)),e.canSignup?s.createElement(s.Fragment,null,s.createElement("div",{className:"or-line"},s.createElement("div",{className:"or-text"},t.op_or)),e.isGoogleAvailable?s.createElement(s.Fragment,null,s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{onFastClick:m,className:"google-login-button"},s.createElement("span",{className:"google-logo logo"}),s.createElement("span",null," ",t.loginWithGoogle," ")))):null,s.createElement("div",null,s.createElement("div",{className:"center mb-40"},s.createElement(Ze.a,{onFastClick:()=>e.switchPage("SignUp0"),className:"link"},t.dontHaveAnAccount)))):null,s.createElement("div",{className:"popup--text"},s.createElement("span",null,t.problemsLoggingIn," "),s.createElement(Ze.a,{onFastClick:()=>e.switchPage("ForgotPassword0"),className:"link"},t.resetPassword)))},ResetPassword0:e=>{const t=Object(b.getLocale)(),[i,o]=s.useState(null),[n,a]=s.useState(""),[r,l]=s.useState(""),[c,d]=s.useState(""),[h,p]=s.useState(!1),[u,f]=s.useState(!1),m=r||"",g=[[m.length>=8,t.passHintLen],[m.toLowerCase()!==m&&m.toUpperCase()!==m,t.passHintCase],[/[^\w\s]/.test(m),t.passHintChar],[/\d/.test(m),t.passHintNum]],v=n===r&&n.length>0,y=r!==c&&c.length>0&&!v,w=!g.some(([e,t])=>!e),x=!y&&!v&&w;function T(){if(!x)return void f(!0);window.dbms.getRemoteConnection().changeExpiredPassword({userId:e.userId,oldPassword:n,newPassword:r},(t,i)=>{if(t)return o(t);e.close()})}return s.createElement(s.Fragment,null,s.createElement("h4",{className:"center mb-24"},t.passwordExpired),s.createElement("div",{className:"mb-24"},s.createElement("div",{className:"",style:{width:"100%"}},s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.oldPassword),s.createElement("input",{type:"password",required:!0,onChange:e=>{a(e.target.value),o(null)},value:n})),s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.newPassword),s.createElement("input",{type:"password",required:!0,onChange:e=>{l(e.target.value),o(null)},value:r,onFocus:()=>p(!0),onBlur:()=>p(!1)}),v?s.createElement("div",{className:"error-message"},t.newOldPassword):null,u&&!w?s.createElement("div",{className:"error-message"},t.wrongPassword):null,s.createElement("div",{className:Object(An.a)("password-hint",{active:h})},s.createElement("div",{className:"password-hint-pointer-wrapper"},s.createElement("div",{className:"password-hint-pointer-border"},s.createElement("div",{className:"password-hint-pointer"}))),s.createElement("div",{className:"password-hint-container"},s.createElement("div",null,t.passHint),g.map(([e,t],i)=>s.createElement("div",{key:i,className:Object(An.a)({fulfilled:e})},t))))),s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.repeatPassword),s.createElement("input",{type:"password",required:!0,onChange:e=>{d(e.target.value),o(null)},value:c}),y?s.createElement("div",{className:"error-message"},t.matchPasswords):null)),i?s.createElement("div",{className:"form-error-message mb-24 center"},i):null),s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{className:"button button--filled",onFastClick:T},t.save)))},ForgotPassword0:e=>{const t=Object(b.getLocale)(),[i,o]=s.useState(!1),[n,a]=s.useState(null),r=t=>{e.setFormState({email:t.target.value}),o(!1)},c=b.util.isValidEmail(e.formState.email);function d(){if(!c)return o(!0);const i=window.dbms;Object(l.f)("ForgotPassword","Click"),i.getRemoteConnection().forgotPassword({email:e.formState.email},i=>{i?(a(i),Object(l.f)("ForgotPassword","Error")):(a(t.forgotPasswordSuccess+":\n"+e.formState.email),Object(l.f)("ForgotPassword","Success"),e.switchPage("SignIn0"))})}return s.createElement(s.Fragment,null,s.createElement(Ze.a,{className:"close-popup",onFastClick:()=>e.close()}),s.createElement("h4",{className:"center mb-24"},t.forgotPassword),s.createElement("div",{className:"mb-24"},s.createElement("div",{className:"",style:{width:"100%"}},s.createElement("label",{className:"form-control required"},s.createElement("span",{className:"caption"},t.email),s.createElement("input",{className:Object(An.a)({error:i&&!c}),type:"email",required:!0,onChange:r,value:e.formState.email}),i&&!c?s.createElement("div",{className:"error-message"},t.emailNotRegistered):null))),n?s.createElement("div",{className:"form-error-message mb-24 center"},t.wrongUserPassword):null,s.createElement("div",{className:"mb-24"},s.createElement(Ze.a,{className:"button button--filled",onFastClick:d},t.resetPassword)),s.createElement("div",{className:"popup--text"},s.createElement("span",null,t.noNeedToResetPassword," "),s.createElement(Ze.a,{onFastClick:()=>e.switchPage("SignIn0"),className:"link"},t.signIn)))}},pa=e=>{const[t,i]=s.useState(e.wantsSignup?"SignUp0":"SignIn0"),[o,n]=s.useState(""),[a,r]=s.useState({password:"",displayName:"",telephone:"",country:"Germany",company:"",email:"",locale:"",isBusiness:!0,newsletter:!1});function c(e){Object(l.f)(e,"Open"),i(e)}function d(){const e=ha[t];return e||null}function h(e){r(da({},a,{},e))}const p=d();return s.createElement(s.Fragment,null,s.createElement("div",{className:"credentials-popup--background"},s.createElement("div",{className:"credentials-popup--content"},s.createElement("div",{className:"credentials"},p&&s.createElement(p,{formState:a,setFormState:h,switchPage:c,close:e.close,afterLogin:e.afterLogin,canSignup:e.canSignup,userId:o,setUserId:n,isGoogleAvailable:e.isGoogleAvailable})))))};o("./src/react/EmailVerificationReminder.css");o("./src/react/AdminDatabaseActions.css");const ua=e=>s.createElement("div",{className:"AdminDataBaseActions_root"+(e.isEmptyTeam?"AdminDataBaseActionsEmptyTeam":"")},s.createElement("div",{className:"AdminDatabaseActions_buttonsContainer"},s.createElement("div",{className:"AdminDatabaseActions_buttonContainer --ul-create-db-button"},s.createElement(Ze.a,{onFastClick:e.onNewDatabaseClick,behaviour:"FORCE_RIPPLE",className:"AdminDatabaseActions_iconContainer"},s.createElement("div",{className:"i-32-24 i-light-grey i-plus"})),s.createElement("div",{className:"AdminDatabaseActions_textContainer"},Object(b.getLocale)().createDatabase)),s.createElement("div",{className:"AdminDatabaseActions_buttonContainer"},s.createElement(Ze.a,{onFastClick:e.onImportArchiveClick,behaviour:"FORCE_RIPPLE",className:"AdminDatabaseActions_iconContainer"},s.createElement("div",{className:"i-32-24 i-light-grey i-setting-import"})),s.createElement("div",{className:"AdminDatabaseActions_textContainer"},Object(b.getLocale)().importArchive)),void 0!==e.onManageBackupsClick?s.createElement("div",{className:"AdminDatabaseActions_buttonContainer"},s.createElement(Ze.a,{onFastClick:e.onManageBackupsClick,behaviour:"FORCE_RIPPLE",className:"AdminDatabaseActions_iconContainer"},s.createElement("div",{className:"i-32-24 i-light-grey i-backup"})),s.createElement("div",{className:"AdminDatabaseActions_textContainer"},Object(b.getLocale)().manageBackups)):null));o("./src/react/DatabaseIcon.css");const fa="DatabaseIcon_rootId",ma=e=>{const[t,i]=s.useState(null);s.useEffect(()=>{async function t(){let t=e.db.icon;"URL"===e.db.type&&null!==t&&(t.startsWith("//")&&(t="https:"+t),t.startsWith("https://")&&(t=await window.localFileSystem.cachedURL(t,null)||t),i(t))}t()},[e.db.icon]);const o=e=>{let i,o,n;return"URL"===e.type&&null!==t?o={background:`url(${t})`,backgroundSize:"contain",backgroundRepeat:"no-repeat",width:"40px",height:"40px",padding:"4px"}:(n=`root-db-icon i-db-icon-big i-db i-${e.icon?e.icon:"0"}`,i="DatabaseIcon_newIconWrapper"),s.createElement("span",{className:i},s.createElement("div",{className:n,style:o}),e.isStored?null:s.createElement("div",{className:"db-badge db-badge-new db-badge-react"}))},n=t=>{void 0!==e.onContextMenu&&e.onContextMenu(t,e.db.id,fa+e.index)};return s.createElement(s.Fragment,null,s.createElement(Ze.a,{id:fa+e.index,behaviour:"FORCE_RIPPLE",onFastClick:()=>e.onClick(e.db.id),onFastContextMenu:n,className:Object(An.a)("root-db DatabaseIcon_buttonContainer",e.db.isStored?"root-db-stored":"root-db-not-stored","--ul-db-root"),"data-dbtype":"sync"},s.createElement("div",{className:"DatabaseIcon_iconContainer",style:{backgroundColor:e.db.color?e.db.color:""}},o(e.db)),void 0===e.onContextMenu?null:s.createElement(Ze.a,{className:"root-db-indicator-place",onFastClick:n,onContextMenu:()=>{}},s.createElement("div",{className:(e.db.isStored?"root-db-indicator":"root-db-indicator-new")+" i-32-24 i-light-grey i-line-down"})),s.createElement("div",{className:"root-db-hover-place"},s.createElement("div",{className:"root-db-hover",style:{background:e.db.color?e.db.color:""}})),void 0===e.db.name?null:s.createElement("div",{className:"DatabaseIcon_textContainer"},e.db.name),void 0!==e.db.localStorageType?s.createElement("div",{style:{position:"absolute",top:0},className:Object(An.a)("i-32-24 i-light-grey",{"i-cloud-okay":"cloud"===e.db.localStorageType})}):null))};o("./src/react/DatabaseList.css");class ga extends s.Component{constructor(e){super(e),Je()(this,"handleContext",(e,t,i)=>{this.props.onContextMenuClick(Ze.b.getTarget(e).closest("#"+i),t)})}render(){return s.createElement("div",{className:"DatabaseList_root"},this.props.databases.map((e,t)=>s.createElement("div",{key:e.id,className:"DatabaseList_item"},s.createElement(ma,{index:t,onClick:this.props.onDatabaseClick,db:e,onContextMenu:this.handleContext}))))}}function va(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function ya(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?va(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):va(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class ba extends s.Component{constructor(e){super(e),Je()(this,"handleContextMenu",(e,t)=>{Object(l.f)("DatabaseMenu","Open"),this.setState({currentContext:{target:e,id:t}})}),Je()(this,"getContextMenuItems",()=>{const e=[];return this.props.isAdmin&&e.push({text:Object(b.getLocale)().renameDatabase,onClick:()=>this.handleContextMenuItemClick("DatabaseMenu",this.props.onRenameDatabase)},{text:Object(b.getLocale)().createBackup,onClick:()=>this.handleContextMenuItemClick("CreateBackup",this.props.onCreateBackup)},{text:Object(b.getLocale)().remove,onClick:()=>this.handleContextMenuItemClick("Remove",this.props.onRemove)}),window.NINOX_APP&&e.push({text:Object(b.getLocale)().resetSync,onClick:()=>this.handleContextMenuItemClick("ResetSync",this.props.onResetSync)}),e}),this.state={currentContext:null,classAndStyle:{className:"",style:{}}}}async updateClassAndStyle(){const e=await this.getClassAndStyle();b.util.equals(e,this.state.classAndStyle)||this.setState(ya({},this.state,{classAndStyle:e}))}render(){this.updateClassAndStyle();const e=this.getCustomHTML(),t=this.getDatabases(),i=0===t.length,{className:o,style:n}=this.state.classAndStyle;return s.createElement("div",{className:Object(An.a)(o,"--ul-database"),style:n},s.createElement(ga,{databases:t,onContextMenuClick:this.handleContextMenu,onDatabaseClick:this.props.onDatabaseClick}),this.props.isAdmin?s.createElement(ua,{isEmptyTeam:i,onNewDatabaseClick:this.props.onNewDatabaseClick,onImportArchiveClick:this.props.onImportArchiveClick,onManageBackupsClick:this.props.onManageBackupsClick}):null,i?null:s.createElement(Pn,{items:this.getContextMenuItems(),positionAdjustment:{top:-20,left:0},clickTarget:null!==this.state.currentContext?this.state.currentContext.target:null,onClick:()=>this.setState({currentContext:null}),show:null!==this.state.currentContext}),e?s.createElement("div",{dangerouslySetInnerHTML:{__html:e}}):null)}handleContextMenuItemClick(e,t){Object(Ii.a)(this.state.currentContext),Object(l.f)("DatabaseMenu",e),t(this.state.currentContext.id),this.setState({currentContext:null})}getCustomHTML(){const e=this.props.account;return(e?e.settings:{}).backgroundCustomHTML}async getClassAndStyle(){const e=this.props.account,t=e?e.settings:{},i=t.backgroundCustomCSS,o=e?await e.backgroundURL():null;let n="";const a={};if(i){n="root-remote-dblist";for(const e in i)if(i.hasOwnProperty(e)){let t=i[e];const o=/^url\((.*)\)$/.exec(t);if(o){const e=o[1];t="url("+(await this.props.localFileSystem.cachedURL(e,null)||e)+")"}a[e.replace(/-[a-z]/g,e=>e[1].toUpperCase())]=t}}else if(t.bgType){if("solid"===t.bgType)n="root-remote-dblist",a.backgroundImage="",a.backgroundColor=t.bgColor||"";else if("gradient"===t.bgType)n="root-remote-dblist",a.backgroundImage="linear-gradient("+(t.bgGradient0||"#ccc")+" 0%, "+(t.bgGradient1||"#aaa")+" 100%)",a.backgroundColor="";else if("image"===t.bgType)n="root-remote-dblist background-file",a.backgroundImage='url("'+o+'")',a.backgroundColor=t.bgColor||"";else{const e=t.backgroundClass||"background";n="root-remote-dblist background "+e,"background-file"===e?(a.backgroundImage='url("'+o+'")',a.backgroundColor=t.bgColor||""):(a.backgroundImage="",a.backgroundColor="")}a.backgroundPosition=(t.bgPosH||"center")+" "+(t.bgPosV||"center"),a.backgroundSize=t.bgSize||"cover",a.backgroundRepeat=t.bgRepeat||"no-repeat"}else n="root-remote-dblist",a.backgroundPosition="center center",a.backgroundSize="cover",a.backgroundRepeat="no-repeat",a.backgroundImage="";return this.props.hideUserList&&(a.right="0"),{className:n,style:a}}getDatabases(){const e=this.props.account;return e?e.listDatabases().map(e=>{const t=e.settings,i=t?t.icon:null,o=t?t.color:null;return{name:e.name,id:e.id,isStored:e.isStored,color:o,icon:i,type:/^(https?\:)?\/\//.test(i)?"URL":"IMAGE"}}):[]}}class wa extends s.Component{constructor(e){super(e)}render(){const e=this.props.account,t=e.getInvitations();return e.isAdmin()?s.createElement(s.Fragment,null,t.length>0?s.createElement(s.Fragment,null,s.createElement("div",{className:"account-head",style:{marginTop:"16px"}},Object(b.getLocale)().invitations),s.createElement("div",{className:"account-invitations"},t.map(e=>s.createElement(Ze.a,{key:e.inviteCode,className:"account-invitation",onFastClick:()=>this.props.onClick(e.inviteCode)},s.createElement("div",{className:"account-invitation-name"},e.email))))):null,s.createElement(Ze.a,{style:{padding:"0 24px"},className:"root-remote-button",onFastClick:this.props.invite},s.createElement("div",{className:"i-32-24 i-blue i-setting-add"}),s.createElement("span",null,Object(b.getLocale)().invite))):null}}function xa(e){const t=e.plan;return"trial"===t.name?s.createElement("div",{className:"account-plan"},Object(b.getLocale)().planTrial,s.createElement("br",null),Object(b.getLocale)().planTrialExpiresAt,": ",b.util.formatLocaleDate(t.expiresAt)):"basic"===t.name?t.collaborators>=t.accountableUserCount?s.createElement("div",{className:"account-plan"},Object(b.getLocale)().planCurrentCovers.replace("$1",t.collaborators)):s.createElement("div",{className:"account-plan"},s.createElement("div",{className:"icon-big-white icon-big-close",style:{backgroundColor:"#f00",borderRadius:"16px",flex:"0 0 32px",WebkitFlex:"0 0 32px",marginRight:"8px"}}),s.createElement("div",null,Object(b.getLocale)().planCurrentCovers.replace("$1",t.collaborators),s.createElement("br",null),Object(b.getLocale)().planUsageRequired.replace("$1",t.accountableUserCount))):s.createElement("div",{className:"account-plan"},s.createElement("div",{className:"icon-big-white icon-big-close",style:{backgroundColor:"#f00",borderRadius:"16px",flex:"0 0 32px",WebkitFlex:"0 0 32px",marginRight:"8px"}}),s.createElement("div",null,Object(b.getLocale)().planNone))}class Ta extends s.Component{render(){const e=this.props.account;if(e.isOwner()&&!this.props.isPrivateCloud){const t=e.getPlan();return s.createElement(s.Fragment,null,s.createElement("div",{className:"account-head"},Object(b.getLocale)().currentPlan),s.createElement(xa,{plan:t}),s.createElement("div",{style:{padding:"0 24px"}},s.createElement("div",{className:"nx-hspace-flex"}),s.createElement(Ze.a,{className:"nx-button-text blue",style:{height:48,lineHeight:"48px",textAlign:"center"},onFastClick:this.props.upgradePlan},Object(b.getLocale)().upgradePlan)),s.createElement("div",{style:{height:1,margin:24,background:"#EFF1F9"}}))}return null}}function Ca(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function ka(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ca(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ca(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class $a extends s.Component{constructor(e){super(e),this.state={icon:null},this.updateUserIcon()}getUserIcon(e){if(null===e)return s.createElement("div",{className:"button"},s.createElement("div",{className:"i-32-24 i-white i-field-user"}));{const t=ka({},this.props.style,{width:this.props.size+"px",height:this.props.size+"px",lineHeight:this.props.size+"px",fontSize:24===this.props.size?"14px":"18px",color:"#fff",fontWeight:"bold",textAlign:"center",backgroundPosition:"center",backgroundRepeat:"no-repeat",borderRadius:"50%",backgroundSize:"cover"});if(this.state.icon)return s.createElement("div",{className:"button"},s.createElement("div",{style:ka({backgroundImage:`url(${this.state.icon})`},t)}));{const i=(e.name||"?")[0].toLocaleUpperCase(),o=b.util.pickColor(e.id);return s.createElement("div",{className:"button"},s.createElement("div",{style:ka({backgroundColor:o},t)},i))}}}render(){return s.createElement(Ze.a,{onFastClick:this.props.onClick},this.getUserIcon(this.props.user))}async updateUserIcon(){const{user:e}=this.props;e&&e.photo&&this.setState({icon:await window.localFileSystem.cachedURL("https:"+e.photo,null)})}}class Sa extends s.Component{render(){const e=this.props.account,t=e.getOwnerId(),i=e.getCurrentUserId();return s.createElement(s.Fragment,null,s.createElement("div",{className:"account-head",style:{marginTop:"16px"}},Object(b.getLocale)().teamMembers),s.createElement("div",{className:"account-users"},e.getMembers().map(e=>s.createElement(Ze.a,{key:e.id,onFastClick:()=>this.props.onClick(e.id)},s.createElement("div",{className:`account-user ${i===e.id?" selected":""}`},i===e.id?s.createElement("div",{className:"account-user-selected-indicator"}):null,s.createElement($a,{onClick:()=>{},user:e,size:24,style:{margin:"4px -2px 4px 4px"}}),s.createElement("div",{className:"account-user-name"},e.name," ",e.id===t?" (Owner)":e.roles.admin?" (Admin)":""))))))}}class _a extends s.Component{render(){if(this.props.hideUserList)return null;const e=this.props.account;return s.createElement("div",{className:"root-remote-info --ul-remote-info"},s.createElement(Ta,{account:e,isPrivateCloud:this.props.isPrivateCloud,upgradePlan:this.props.upgradePlan}),s.createElement(Sa,{account:e,onClick:this.props.onClickUser}),s.createElement(wa,{account:e,onClick:this.props.onClickInvitation,invite:this.props.invite}))}}class Ea extends s.Component{render(){const e=this.props.account,t=e&&e.settings&&!0===e.settings.hideUserList&&!e.isRootUser();return s.createElement(s.Fragment,null,s.createElement(ba,{isAdmin:this.props.isAdmin,localFileSystem:this.props.localFileSystem,NinoxDocumentInteraction:this.props.NinoxDocumentInteraction,account:this.props.account,onDatabaseClick:this.props.onDatabaseClick,onCreateBackup:this.props.onCreateBackup,onRemove:this.props.onRemove,onRenameDatabase:this.props.onRenameDatabase,onResetSync:this.props.onResetSync,onNewDatabaseClick:this.props.onNewDatabaseClick,onImportArchiveClick:this.props.onImportArchiveClick,onManageBackupsClick:this.props.onManageBackupsClick,hideUserList:t}),s.createElement(_a,{account:this.props.account,isPrivateCloud:this.props.isPrivateCloud,onClickInvitation:this.props.onClickInvitation,onClickUser:this.props.onClickUser,upgradePlan:this.props.upgradePlan,invite:this.props.invite,hideUserList:t}))}}function Da(e){const t=e.items.sort((e,t)=>t.timestamp-e.timestamp);if(0===t.length)return null;const i=t[0].dbname;return s.createElement("div",null,s.createElement("div",{className:"root-backup-item root-backup-group"},s.createElement("div",{className:"root-backup-item-label"},i)),t.map(t=>s.createElement(Ze.a,{key:t.id,onFastClick:()=>e.handleSnapshotClick(t.id),className:"root-backup-item root-backup-child"+(e.selectedSnapshotId===t.id?" selected":"")},s.createElement("div",{className:"root-backup-item-info"},s.createElement("div",null,b.util.formatLocaleDateTime(t.timestamp))))))}class Na extends s.Component{constructor(e){super(e),Je()(this,"handleSnapshotClick",e=>{this.setState({selectedSnapshotId:e}),this.props.onSnapshotClick(e)}),this.state={selectedSnapshotId:null}}render(){const e=this.props.snapshots;return Object.keys(e).map(t=>({dbid:t,items:e[t]})).filter(e=>e.items.length>0).sort((e,t)=>String(e.items[0].dbname).localeCompare(String(t.items[0].dbname))).map(e=>s.createElement(Da,{key:e.dbid,dbid:e.dbid,items:e.items,selectedSnapshotId:this.state.selectedSnapshotId,handleSnapshotClick:this.handleSnapshotClick}))}}class Ia extends s.Component{constructor(e){super(e)}render(){return s.createElement("div",{className:"nx-button-bar",style:{margin:0,padding:24}},s.createElement(Ze.a,{onFastClick:this.props.onDeleteClick,className:"nx-button-text grey"},Object(b.getLocale)().remove),s.createElement("div",{className:"nx-hspace-flex"}),"backups"===this.props.currentTab?s.createElement(Ze.a,{onFastClick:this.props.onDownloadBackupClick,className:"nx-button-text grey"},Object(b.getLocale)().dumpDatabase):null,s.createElement("div",{className:"nx-hspace-small"}),s.createElement(Ze.a,{onFastClick:this.props.onRestoreClick,className:"nx-button-text grey"},Object(b.getLocale)().restoreBackup),s.createElement("div",{className:"nx-hspace-small"}),s.createElement(Ze.a,{onFastClick:this.props.onCloseClick,className:"nx-button-text blue"},Object(b.getLocale)().close))}}class Oa extends s.Component{constructor(e){super(e)}render(){return this.props.backups.slice().sort((e,t)=>t.timestamp-e.timestamp).map(e=>s.createElement(Ze.a,{key:e.id,onFastClick:()=>this.props.onBackupClick(e.id),className:"root-backup-item"+(e.id===this.props.selectedBackupId?" selected":"")},s.createElement("div",{className:"root-backup-item-label"},e.dbname),s.createElement("div",{className:"root-backup-item-info"},s.createElement("div",null,b.util.formatLocaleDateTime(e.timestamp)),s.createElement("div",null,e.user?e.user.name:""))))}}function Ma(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Fa(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ma(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ma(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const Ra="/";class La extends s.Component{constructor(e){super(e),Je()(this,"onBackupClicked",e=>{this.setState({currBackupId:e})}),Je()(this,"removeBackup",()=>{if(null!==this.state.currBackupId)if("backups"===this.state.currTab&&"backups"===this.getCurrentSelectionType())this.props.loading(!0),this.props.account.removeBackup(this.state.currBackupId,e=>{if(this.props.loading(!1),e)return this.props.alert(e);this.reload()});else if("snapshots"===this.state.currTab&&"snapshots"===this.getCurrentSelectionType()){if(!this.props.isPaidPlan)return this.props.alert("Please upgrade your account to use this feature.");this.props.loading(!0),this.props.account.removeSnapshot(this.state.currBackupId.split(Ra)[0],parseInt(this.state.currBackupId.split(Ra)[1],10),e=>{if(this.props.loading(!1),e)return this.props.alert(e);this.reload()})}}),Je()(this,"restoreBackup",()=>{if("backups"===this.state.currTab&&"backups"===this.getCurrentSelectionType()){if(!this.props.isPaidPlan)return this.props.alert("Please upgrade your account to use this feature.");this.props.loading(!0),this.props.account.restoreBackup(this.state.currBackupId,e=>{if(this.props.loading(!1),e)return this.props.alert(e);this.props.closePopup()})}else if("snapshots"===this.state.currTab&&"snapshots"===this.getCurrentSelectionType()){if(!this.props.isPaidPlan)return this.props.alert("Please upgrade your account to use this feature.");this.props.loading(!0),Object(Ii.a)(this.state.currBackupId),this.props.account.restoreSnapshot(this.state.currBackupId.split(Ra)[0],parseInt(this.state.currBackupId.split(Ra)[1],10),e=>{if(this.props.loading(!1),e)return this.props.alert(e);this.props.closePopup()})}}),Je()(this,"downloadBackup",()=>{if(null===this.state.currBackupId)return;let e=null;for(const t of this.state.manualBackups)if(t.id===this.state.currBackupId){e=t;break}if(null===e)return;const t=this.props.account.downloadBackupURL(e.id,e.dbname+".ninox");this.props.ninoxDocumentInteraction.openBrowser(t),this.props.closePopup()}),this.state={currBackupId:e.initialSelection,currTab:e.initialTab,manualBackups:[],snapshots:[]},this.reload()}reload(){this.props.loading(!0),this.props.account.listBackups((e,t)=>{this.props.loading(!1),e&&this.props.alert(e);let i=[];if(t){const e=this.props.dbms.getRemoteConnection();i=t.sort((e,t)=>t.timstamp-e.timestamp).map(t=>Fa({},t,{user:e.getAccountUser(this.props.account.id,t.user)}))}this.setState({manualBackups:i})}),this.props.account.listSnapshots((e,t)=>{this.props.loading(!1),e&&this.props.alert(e);let i={};if(t){for(const e in t)t[e]=t[e].map(t=>Fa({},t,{id:e+Ra+t.timestamp}));i=t}this.setState({snapshots:i})})}render(){return s.createElement("span",null,s.createElement("div",{className:"nx-section-head",style:{borderBottom:"none"}},Object(b.getLocale)().manageBackups),s.createElement(Yi,{tabs:[{isSelected:"snapshots"===this.state.currTab,text:Object(b.getLocale)().automatedBackups,onClick:()=>this.setState({currTab:"snapshots"})},{isSelected:"backups"===this.state.currTab,text:Object(b.getLocale)().manualBackups,onClick:()=>this.setState({currTab:"backups"})}]}),s.createElement("div",{className:"root-backup-list",style:{height:window.getHeight()-288}},"backups"===this.state.currTab?s.createElement(Oa,{backups:this.state.manualBackups,onBackupClick:this.onBackupClicked,selectedBackupId:this.state.currBackupId}):null,"snapshots"===this.state.currTab?s.createElement(Na,{snapshots:this.state.snapshots,onSnapshotClick:this.onBackupClicked,selectedSnapshotId:this.state.currBackupId}):null),s.createElement(Ia,{currentTab:this.state.currTab,onDeleteClick:this.removeBackup,onDownloadBackupClick:this.downloadBackup,onRestoreClick:this.restoreBackup,onCloseClick:this.props.closePopup}))}getCurrentSelectionType(){return null===this.state.currBackupId?null:-1===this.state.currBackupId.indexOf(Ra)?"backups":"snapshots"}}o("./src/react/TemplatesList.css");class ja extends s.Component{constructor(e){super(e)}render(){const e={isStored:!0,id:"new",type:"IMAGE",icon:"root-db-icon i-db-icon-big i-db i-database",color:"#9da9ce"};return s.createElement("div",{className:"TemplatesList_root"},s.createElement(Ze.a,{behaviour:"FORCE_RIPPLE",onFastClick:()=>this.props.onClick(null),className:"TemplatesList_templateContainer"},s.createElement(ma,{db:e,onClick:()=>this.props.onClick(null),index:-1}),s.createElement("div",{className:"TemplatesList_templateCopy"},s.createElement("div",{className:"TemplatesList_templateTitle"},Object(b.getLocale)().new),s.createElement("div",{className:"TemplatesList_templateDesc"},Object(b.getLocale)().noTemplate))),0===this.props.templatesList.length?"Loading...":this.props.templatesList.map((e,t)=>{const i={color:e.color,icon:e.icon,type:"IMAGE",id:e.id,isStored:!0};return s.createElement(Ze.a,{key:t,behaviour:"FORCE_RIPPLE",onFastClick:()=>this.props.onClick(e),className:"TemplatesList_templateContainer"},s.createElement(ma,{db:i,onClick:()=>this.props.onClick(e),index:t}),s.createElement("div",{className:"TemplatesList_templateCopy"},s.createElement("div",{className:"TemplatesList_templateTitle"},e.title),s.createElement("div",{className:"TemplatesList_templateDesc"},e.summary)))}))}}function Aa(e){Object(l.f)("Templates","Open");var t=$.backplane({close:m,cls:"templates-root"}),i=$('<div class="nx-popdown-large templates-pane">').appendTo(t);const o=$('<div class="nx-section-head templates-head">').appendTo(i);$(`<div style="width: 100%">${locale.chooseTemplate}</div>`).appendTo(o),$('<div class="i-32-24 i-light-grey i-close" style="position: absolute;right: 24px;">').appendTo(o).touch(p);var a=$('<div class="nx-section-pane templates-body" style="">').appendTo(i),r=$('<div class="templates-list --ul-template-list">').appendTo(a),c=[];function d(){n.render(s.createElement(ja,{templatesList:c,onClick:e=>h(e)}),r[0])}function h(i){t.close(),Object(l.f)("Templates","Click",{template:i?i.title:"empty"}),trackEvent("templates","click-"+(i?i.title:"empty")),e.okay&&e.okay(i?{url:i.file,icon:i.icon,color:i.color,name:i.title}:void 0,t)}function p(){t.close(),e.cancel&&e.cancel()}function u(e){switch(e){case"5996a84f60418b1043550550":case"5995849160418b1043550513":return{icon:"i-db-icon-big i-db i-team",color:"#6691FF"};case"5996ada460418b1043550569":case"5995881860418b104355051f":return{icon:"i-db-icon-big i-db i-calendar",color:"#9485F2"};case"5996aa7b60418b1043550560":case"599582f260418b104355050d":return{icon:"i-db-icon-big i-db i-dj",color:"#52C2CC"};case"59bfeba6244b0e67ed2585dc":case"59bfd6cf244b0e67ed2585d6":return{icon:"i-db-icon-big i-db i-person",color:"#FFB450"};case"599c353160418b1043550581":case"598b323052ed71082bd69faf":return{icon:"i-db-icon-big i-db i-bill",color:"#FF7F66"};case"5996acca60418b1043550564":case"5995859560418b1043550517":return{icon:"i-db-icon-big i-db i-pallet",color:"#52C2CC"};case"5cc6cd632cc4a577c6ee6e41":case"599586d460418b104355051d":return{icon:"i-db-icon-big i-db i-collage",color:"#64C1FA"};case"5996a98460418b104355055b":case"5995599160418b10435504f8":return{icon:"i-db-icon-big i-db i-timer",color:"#9485F2"};case"5996a7d260418b1043550547":case"5995641b60418b1043550500":return{icon:"i-db-icon-big i-db i-tree_structure",color:"#52C2CC"};case"5996a8ff60418b1043550556":case"59955c2560418b10435504fc":return{icon:"i-db-icon-big i-db i-todo_list",color:"#FFB450"};case"5996ae3460418b104355056c":case"5995896860418b1043550522":return{icon:"i-db-icon-big i-db i-cottage",color:"#64C1FA"};case"59a041f0e576076126c2cc0b":case"598b30d652ed71082bd69fab":return{icon:"i-db-icon-big i-db i-frame",color:"#FF7F66"};case"5996a65260418b1043550543":case"599558a860418b10435504f3":return{icon:"i-db-icon-big i-db i-spoon_of_sugar",color:"#6691FF"};default:return null}}async function f(){var e=await localFileSystem.cachedURL("https://ninox.com/api/templates",864e5)||"https://ninox.com/api/templates";$.get(e,(function(e){var t=void 0;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){console.log(e)}else t=e;if(t&&t.length){var i=k.filter(t,(function(e){return e.lang==locale.LOCALE}));i.length||(i=k.filter(t,(function(e){return"en"==e.lang}))),i.sort((function(e,t){return null!=e.position&&null!=t.position?e.position!==t.position?e.position-t.position:e.title.localeCompare(t.title):null!=e.position?-1:null!=t.position?1:e.title.localeCompare(t.title)}));for(const e of i){const t=u(e.id);null!==t&&(e.icon=t.icon,e.color=t.color)}c=i,d()}}))}function m(){n.unmountComponentAtNode(r[0]),window.Appcues&&window.Appcues.page()}trackPageView("templates"),window.Appcues&&window.Appcues.page(),f().then(()=>d())}const Pa=["#FF7F66","#FFB450","#FADA33","#52CC74","#64C1FA","#6691FF","#9485F2","#EC87E2"],Ua=["database","person","team","location","info","document","framed_chart","folder","clipboard","group","calendar","dj","frame","bill","pallet","collage","spoon_of_sugar","todo_list","tree_structure","timer","cottage","beer","bulb","palm","start","symbol","bell","libra","trolley","radar","chart","livingcosts","check","duedate","globe"];function Ha(e){this.color=e.color||"#9da9ce",this.icon=e.icon||Ua[0],this.colorIndex="#CUSTOM",this.latestRenderId=0;for(let e=0;e<Pa.length;e++)Pa[e]===this.color&&(this.colorIndex=e);this.$el=$('<div class="dbics --ul-icon-selector">').appendTo(e.$parent),this.$button=$('<div class="dbics-button">').appendTo(this.$el).touch($.proxy(this.popup,this)),this.updateUI()}function za(e){trackPageView("createdb");var t=e.account,i=$.popdown({close:e.cancel});const o=$('<div class="nx-section-head">').text(e.title||locale.createDatabase).appendTo(i.$pane);$('<div class="i-32-24 i-light-grey i-close" style="position: absolute;right: 24px;top: 18px;">').appendTo(o).touch(y);var n=$('<div class="nx-section-pane">').appendTo(i.$pane),a=$('<div style="display:flex;display:-webkit-flex">').appendTo(n),s=null;e.dontShowIconColor||(s=new Ha({$parent:a,icon:e.icon||null,color:e.color||null}));var r=$('<div class="component editor editor-string --ul-create-db-popdown-input" style="width:100%">').appendTo(a);$("<label>").text(e.label||locale.databaseName).appendTo(r);var l,c,d=$('<input type="text">').val(e.name||"").appendTo($('<div class="stringeditor">').appendTo(r)).keydown((function(e){13===e.which&&v(),27===e.which&&y()})),h=NinoxDocumentInteraction.getUserDefault("ui.new-database-location")||"local";if(!e.dontShowLocations){var p=$('<div class="nx-switch-big">').appendTo(i.$pane);l=$('<div class="nx-switch-big-item-icon-text selected">').append($('<div class="i-32-24 i-light-grey i-local">')).append($("<div>").text(locale.databaseLocationLocal)).appendTo(p).on(TOUCH?EVENT_touchstart:"mousedown",(function(){return h="local",g(),!1})),c=$('<div class="nx-switch-big-item-icon-text">').append($('<div class="i-32-24 i-light-grey i-cloud-okay">')).append($("<div>").text(locale.databaseLocationCloud)).appendTo(p).on(TOUCH?EVENT_touchstart:"mousedown",(function(){return h="cloud",g(),!1}))}var u=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.includeData,required:!0,formWidth:.5}),!0),f=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.includeFiles,required:!0,formWidth:.5}),!0);if(e.includeOptions)new qt.a(void 0,u,n),new qt.a(void 0,f,n);var m=$('<div class="nx-button-bar">').appendTo(n);function g(){e.dontShowLocations||(l.toggleClass("selected","local"===h),c.toggleClass("selected","cloud"===h),NinoxDocumentInteraction.setUserDefault("ui.new-database-location",h))}function v(){var o=d.val().trim();util.isValidDatabaseName(o)?t.getDatabaseNames()[o]?$.alert(locale.duplicateDatabaseName):i.close((function(){e.okay&&e.okay({name:o,location:h,includeData:u.value,includeFiles:f.value,icon:s?s.icon:void 0,color:s?s.color:void 0})})):$.alert(locale.invalidDatabaseName)}function y(){i.close(e.cancel)}$('<div class="nx-hspace-flex">').appendTo(m),$('<div class="nx-hspace-small">').appendTo(m),$('<div class="nx-button-text blue --ul-create-db-popdown-button">').text(e.button||locale.createDatabaseOkay).appendTo(m).click(v),g(),setTimeout((function(){d.focus()}),400)}function Va(e,t){var i=t.account,o=$.popdown({close:t.cancel});$('<div class="nx-section-head">').text(locale.renameDatabase).appendTo(o.$pane);var n=$('<div class="nx-section-pane">').appendTo(o.$pane),a=$('<div style="display:flex;display:-webkit-flex">').appendTo(n),s=new Ha({$parent:a,icon:e.settings&&e.settings.icon||e.icon,color:e.settings&&e.settings.color||e.color}),r=$('<div class="component editor editor-string" style="width:100%">').appendTo(a);$("<label>").text(locale.databaseName).appendTo(r);var l=$('<input type="text">').val(e.name).appendTo($('<div class="stringeditor">').appendTo(r)).keydown((function(e){13===e.which&&d(),27===e.which&&close()})),c=$('<div class="nx-button-bar">').appendTo(n);function d(){var n=l.val().trim();if(util.isValidDatabaseName(n)){if(n!==e.name)if(i.getDatabaseNames()[n])return void $.alert(locale.duplicateDatabaseName);o.close((function(){t.okay&&t.okay({name:n,icon:s.icon,color:s.color})}))}else $.alert(locale.invalidDatabaseName)}$('<div class="nx-hspace-flex">').appendTo(c),$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(c).click((function(){o.close(t.cancel)})),$('<div class="nx-hspace-small">').appendTo(c),$('<div class="nx-button-text blue">').text(locale.renameDatabaseOkay).appendTo(c).click(d),setTimeout((function(){l.focus()}),400)}function Wa(e,t){this.root=e,this.accountId=t,this.resync=$.proxy(this.resync,this),this.resyncInterval=null,this.account=dbms.getRemoteAccount(t),this.account&&this.account.sync()}function Ba(e){this.$user=$('<div id="react-user-icon" class="--ul-user-icon" style="margin-right:8px"/>').appendTo(e),this.updateUI()}function qa(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ya(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?qa(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qa(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function Xa(e,t){this.root=e,this.accountId="local",this.dontUpdateUI=!1,this.resync=$.proxy(this.resync,this),this.resyncInterval=null,this.account=dbms.getLocalAccount(),this.account.sync()}function Ga(){var e={};if(!NinoxDocumentInteraction.isOnline())return $.alert(locale.notConnected);var t=dbms.getRemoteConnection();if(!t.isLoggedIn())return $.alert(locale.notLoggedIn);$.loading(!0);let i=null;function o(e){$.loading(!0),NinoxAppStore.loadReceipt((i,o)=>{if(!o)return $.loading(!1),e(void 0,void 0);t.checkReceipt(o,(function(t,i){$.loading(!1),e(t,i)}))})}function n(){$.loading(!0),NinoxAppStore.loadProducts((function(t,i){return $.loading(!1),t?$.alert(t):!i||k.isEmpty(i)?$.alert(locale.cannotConnectAppStore):(e=i,void s())}))}function a(){var e=new $.popdown({}),o=$('<div class="plan">').appendTo(e.$pane),n=$('<div class="plan-info">').appendTo(o),a=$('<div class="plan-info-current">').appendTo(n),s=$('<div class="plan-info-usage">').appendTo(n),c=$('<div class="plan-other">').appendTo(o),d="";if("apple"===i.provider){var h={mac:"Ninox for Mac",ipad:"Ninox for iPad",iphone:"Ninox for iPhone"}[i.productDevice]||String(i.productDevice);c.html('<div style="padding:8px 0;font-weight:bold">'+htmlEscape(locale.planPurchaseOther.replace("$1",h))+"</div>"),d="https://buy.itunes.apple.com/WebObjects/MZFinance.woa/wa/manageSubscriptions"}else c.html('<div style="padding:8px 0;font-weight:bold">'+htmlEscape(locale.planPurchaseOther.replace("$1",i.provider))+"</div>"),d=t.getUpgradeURL();var p=$('<div class="plan-buttons">').appendTo(e.$pane);function u(){a.html(r(i)),s.html(l(i))}$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(p).touch((function(){e.close()})),$('<div class="nx-hspace-flex">').appendTo(p),$('<div class="nx-button-text blue">').text(locale.upgradePlan).appendTo(p).touch((function(){NinoxDocumentInteraction.openBrowser(d),e.close()})),u()}function s(){trackPageView("purchase");var o=i.product,n=i.productPeriod||"1m",a=i.productCount||5;o||(a=i.accountableUserCount<2||i.accountableUserCount<6?5:10);var s=new $.popdown({}),c=$('<div class="plan">').appendTo(s.$pane),d=$('<div class="plan-info">').appendTo(c),h=$('<div class="plan-info-current">').appendTo(d),p=$('<div class="plan-info-usage">').appendTo(d),u=$('<div class="plan-types">').appendTo(c),f=$('<div class="plan-periods">').appendTo(c);$('<div class="plan-terms">').html(locale.planTerms).appendTo(c);var m=$('<div class="plan-buttons">').appendTo(s.$pane);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(m).touch((function(){s.close()})),$('<div class="nx-hspace-flex">').appendTo(m),$('<div class="nx-button-text grey">').text(locale.restoreAppStoreTransactions).appendTo(m).touch(b),$('<div class="nx-hspace-small">').appendTo(m);var g=$('<div class="nx-button-text blue">').text("Purchase now").appendTo(m).touch((function(){v()!==o?($.loading(!0),NinoxAppStore.canOrderProduct((e,i)=>{if(e||!i)return $.loading(!1),void $.alert("Please sign in to the App Store and verify your payment methods.");trackEvent("purchase","submit"),NinoxAppStore.orderProduct(v(),t.getUserId(),(function(e,t){if($.loading(!1),s.close(),e)return trackEvent("purchase","error"),$.alert(e);trackEvent("purchase","success"),t&&$.alert("failed"===t?"Sorry, we couldn't complete your purchase.":"restored"===t?"Your purchase has been restored":"purchased"===t?"Thanks for your purchase!":"Unknown purchase state: "+t)}))})):s.close()}));function v(){return"nx_mac_"+n+"_"+a}function y(){h.html(r(i)),p.html(l(i));var t=e["nx_mac_1m_"+a],s=e["nx_mac_1y_"+a];if(u.html('<div class="plan-type'+(1===a?" selected":"")+'" data-count="1"><div class="plan-type-count">1</div><div class="plan-type-users">'+htmlEscape(locale.user)+'</div><div class="plan-type-storage">2 GB</div></div><div class="plan-type'+(5===a?" selected":"")+'" data-count="5"><div class="plan-type-offer"><div class="plan-type-offer-text">Special Offer</div></div><div class="plan-type-count">2 - 5</div><div class="plan-type-users">'+htmlEscape(locale.users)+'</div><div class="plan-type-storage">10 GB</div></div><div class="plan-type'+(10===a?" selected":"")+'" data-count="10"><div class="plan-type-count">6 - 10</div><div class="plan-type-users">'+htmlEscape(locale.users)+'</div><div class="plan-type-storage">20 GB</div></div>'),f.html('<div class="plan-period'+("1m"===n?" selected":"")+'" data-period="1m">'+(t?'<div class="plan-period-head">'+htmlEscape(locale.monthly)+'</div><div class="plan-period-body"><div class="plan-period-amount">'+htmlEscape(t.price)+'</div><div class="plan-period-period">'+htmlEscape(locale.perMonth)+"</div></div></div>":"")+(s?'<div class="plan-period'+("1y"===n?" selected":"")+'" data-period="1y"><div class="plan-period-saving"><div class="plan-period-saving-label">'+htmlEscape(locale.planSave)+"<br>"+htmlEscape(s.saving)+'</div></div><div class="plan-period-head">'+htmlEscape(locale.annual)+'</div><div class="plan-period-body"><div class="plan-period-amount">'+htmlEscape(s.price)+'</div><div class="plan-period-period">'+htmlEscape(locale.perYear)+"</div></div>":"")+"</div>"),o){var c=v();o===c?g.text(locale.stayWithPlan).removeClass("blue").addClass("grey"):g.text(locale.switchToPlan).removeClass("grey").addClass("blue")}else g.text(locale.purchaseNow).removeClass("grey").addClass("blue")}function b(){$.loading(!0),NinoxAppStore.restoreProducts((function(){$.loading(!1),s.close()}))}u.touch((function(e){var t=$(e.target).closest(".plan-type").attr("data-count");t&&(trackEvent("plan-type","click",t),a=parseInt(t),y())})),f.touch((function(e){var t=$(e.target).closest(".plan-period").attr("data-period");t&&(trackEvent("plan-period","click",t),n=t,y())})),y()}function r(e){return"trial"===e.name?'<span style="font-weight:bold">'+htmlEscape(locale.planCurrent)+": </span>"+htmlEscape(locale.planTrial)+" "+htmlEscape(locale.planTrialExpiresAt+": "+util.formatLocaleDate(e.expiresAt)):"basic"===e.name?'<span style="font-weight:bold;margin-bottom:4px">'+htmlEscape(locale.planCurrent)+": </span>"+htmlEscape(locale.planCurrentCovers.replace("$1",e.collaborators))+" "+htmlEscape(locale.planRenewsAt.replace("$1",util.formatLocaleDate(e.expiresAt))):'<span style="font-weight:bold">'+htmlEscape(locale.planCurrent)+": </span>"+htmlEscape(locale.planNone)}function l(e){return'<span style="font-weight:bold">'+htmlEscape(locale.planUsage)+": </span>"+htmlEscape(locale.planUsageInfo.replace("$1",e.totalUserCount).replace("$2",e.ownAccountsCount))+(e.freeUserCount>0?+htmlEscape(locale.planUsageCovered.replace("$1",e.freeUserCount))+" ":" ")+htmlEscape(locale.planUsageRequired.replace("$1",e.accountableUserCount))}NinoxAppStore.pendingPurchases((e,s)=>{if(s>0)return $.loading(!1),$.alert("Please wait until your purchase has been processed.");console.log("Purchase 1"),t.refresh((function(e){return $.loading(!1),e?$.alert(e):(i=t.getSessionInfo().getPlan(),"cleverbridge"===i.provider||"avangate"===i.provider||"custom"===i.provider?a():void o((function(e,o){if(o&&o.user&&o.user.id!==t.getUserId())return $.alert(locale.planWrongUser.replace("$1",o.user.email));if("trial"===i.name||"none"===i.name)n();else{if("basic"!==i.name)return $.alert(locale.planUnknown+" (Unknown plan: "+i.name+")");if("apple"!==i.provider)return a();if("mac"===i.productDevice)n();else if("mac"===i.productDevice)a();else if("ipad"===i.productDevice)a();else{if("iphone"!==i.productDevice)return $.alert(locale.planUnknown+" (Unknown device: "+productDevice+")");a()}}})))}))})}function Ja(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Ka(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ja(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ja(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}Ha.prototype.updateUI=async function(){this.latestRenderId++;const e=this.latestRenderId;var t=this.icon,i=!1,o=null;t&&(/^\/\//.test(t)&&(t="https:"+t),/^\https?\:\/\//.test(t)&&(i=!0,o=await localFileSystem.cachedURL(t,null)||t)),e===this.latestRenderId&&(this.$button[0].style.backgroundColor=this.color,i?this.$button.html('<img src="'+o+'" style="width:40px;height:40px;padding:4px">'):this.$button.html('<div class="i-db-icon-big i-db i-'+t+'" style="position: relative"><div class="i-32-24 i-light-grey i-line-down" style="position: absolute; right: 0;"></div>'))},Ha.prototype.popup=function(){var e=this,t=$.backplane({}),i=$('<div class="nx-menu-popup dbics-menu --ul-icon-selector-popup">').appendTo(t),o=$('<div class="dbics-colors">').appendTo(i).touch(d),n=$('<div class="dbics-icons">').appendTo(i).touch(h);r();i.outerWidth();var a=i.outerHeight(),s=this.$el.offset();function r(){l(),c(),e.updateUI()}function l(){for(var t="",i=0;i<Pa.length;i++){t+=`\n            <div class="dbics-color" style="background-color:${Pa[i]}" data-color-index="${i}">\n                ${parseInt(e.colorIndex,10)===i?'<div class="dbics-color-selected"></div>':""}\n            </div>`}t+='<div class="dbics-color dbics-color-more i-32-24 i-light-grey i-line-down" data-color-index="#CUSTOM"></div>',o.html(t)}function c(){for(var t="",i=0;i<Ua.length;i++){var o=Ua[i];t+='<div class="i-db-icon-small i-db i-'+o+'" data-icon="'+o+'"></div></div>'}n.html(t),n[0].style.backgroundColor=e.color}function d(t){var i=$(t.target).closest(".dbics-color").attr("data-color-index");console.log("colorClicked",i),i&&("#CUSTOM"===i?new To.a({$el:$(t.target),update:function(t){e.color=t,e.colorIndex="#CUSTOM",r()}}):(e.colorIndex=i,e.color=Pa[i],r()))}function h(t){var i=$(t.target).closest(".i-db").attr("data-icon");console.log("iconClicked",i),i&&(e.icon=i,r())}s.top+=90,s.top+a>window.getHeight()&&(s.top=window.getHeight()-a),i.offset(s)},Wa.prototype.destroy=function(){this.hide()},Wa.prototype.show=function(){if(!this.visible){this.visible=!0;this.account&&this.account.sync(),this.updateUI(),this.resyncInterval=setInterval(this.resync,1e4),this.account&&this.account.on("change",this.updateUI,this)}},Wa.prototype.hide=function(){this.visible&&(this.visible=!1,this.account&&this.account.off("change",this.updateUI,this),this.resyncInterval&&(clearInterval(this.resyncInterval),this.resyncInterval=null),n.unmountComponentAtNode(this.root.$body[0]))},Wa.prototype.resync=function(){this.account&&this.account.sync()},Wa.prototype.updateUI=function(){this.visible&&n.render(s.createElement(Ea,{isAdmin:this.isAdmin(),localFileSystem:localFileSystem,NinoxDocumentInteraction:NinoxDocumentInteraction,account:this.account,onDatabaseClick:e=>this.callWithDb(e,e=>this.openDatabase(e)),onResetSync:e=>this.account.resetSync(e),onCreateBackup:e=>this.callWithDb(e,e=>this.createBackup(e)),onRemove:e=>this.callWithDb(e,e=>this.removeDialog(e)),onRenameDatabase:e=>this.callWithDb(e,e=>this.renameDatabase(e)),onNewDatabaseClick:()=>this.createDatabase(),onImportArchiveClick:()=>this.importArchive(),onManageBackupsClick:()=>this.manageBackups(),isPrivateCloud:Object(c.f)(),onClickInvitation:e=>this.popupAccountInvitation(e),onClickUser:e=>this.popupAccountUser(e),upgradePlan:()=>this.root.upgradePlan(),invite:()=>this.inviteDialog()}),this.root.$body[0])},Wa.prototype.removeDialog=function(e){Object(l.f)("DatabaseMenu","Remove"),$.dialog({closable:!0,caption:locale.dropDatabase,message:locale.confirmDropDatabase,buttons:[{color:"red",caption:locale.dropDatabase,callback:()=>{Object(l.f)("DatabaseMenu","RemoveConfirm"),this.account.removeDatabase(e,(function(e){e&&$.alert(e)}))}}]})},Wa.prototype.callWithDb=function(e,t){if(this.account){var i=this.account.getDatabase(e);i&&t(i)}},Wa.prototype.openDatabase=function(e,t){Object(l.f)("Database","Open");var i=this;i.account?gt({teamId:i.accountId,dbId:e.id}):t&&t("Account not found")},Wa.prototype.createDatabase=function(e){Object(l.f)("CreateDatabase","Open");var t=this.account;new Aa({cancel:function(){Object(l.f)("CreateDatabase","Cancel")},okay:function(e,i){new za({account:t,name:(e=e||{}).name,color:e.color,icon:e.icon,includeOptions:!1,dontShowLocations:!0,okay:function(o){Object(l.f)("CreateDatabase","Confirm",{template:e.name||"empty"}),o.name&&(i.close(),e.url?($.loading(!0),t.loadArchive({url:e.url,name:o.name,icon:o.icon,color:o.color},(function(e){$.loading(!1),e&&$.alert(e)}))):($.loading(!0),t.createDatabase(o,(function(e){$.loading(!1),e&&$.alert(e)}))))}})}})},Wa.prototype.renameDatabase=function(e,t){Object(l.f)("RenameDatabase","Open");var i=this.account;if(!i)return t("Account not found.");new Va({name:e.name,icon:e.settings&&e.settings.icon,color:e.settings&&e.settings.color},{account:i,okay:function(o){Object(l.f)("RenameDatabase","Confirm"),$.loading(!0),i.renameDatabase(e,o,(function(e,i){$.loading(!1),e&&$.alert(e),t&&t(e,i)}))},cancel:function(){Object(l.f)("RenameDatabase","Cancel"),t&&t()}})},Wa.prototype.isAdmin=function(){return!!this.account&&this.account.isAdmin()},Wa.prototype.isRootUser=function(){return dbms.getRemoteConnection().getSessionInfo().user.isRoot},Wa.prototype.isOwner=function(){var e=dbms.getRemoteConnection();return e.getAccount(this.accountId).owner===e.getUserId()},Wa.prototype.popupOptions=function(e){this.isOwner()||this.isRootUser()?this.popupOptions_Owner(e):this.popupOptions_User(e)},Wa.prototype.popupOptions_Owner=function(){Object(l.f)("TeamSettings","Open",{isOwner:!0});var e=this,t=dbms.getRemoteConnection(),i=this.account;if(i){var o=$.popdown({head:locale.teamSettings,buttons:[{caption:locale.removeTeam,click:a},"-",{cls:"blue",caption:locale.okay,click:s}]}),n=$.input({caption:locale.teamName,val:i.name,$container:o.$content});new ji({$container:o.$content,settings:i.settings||{},updateSettings:function(t,i){Object(l.f)("TeamSettings","Update"),$.loading(!0),e.account.server.updateSettings(t,(function(t,o){$.loading(!1),t||(e.account.settings=o,e.account.sync(!0)),i(t)}))},setBackground:function(t,i){$.loading(!0),Object(l.f)("TeamSettings","UpdateBackground"),e.account.server.updateSettings({bgType:"presets",backgroundClass:t},(function(t,o){$.loading(!1),t||(e.account.settings=o,e.account.sync(!0)),i(t)}))},setBackgroundFile:function(t,i){Object(l.f)("TeamSettings","UploadBackground"),e.account.server.uploadBackground({file:t},(function(t){e.account.sync(!0),i(t)}))}})}function a(){if(!t.canRemoveAccount(i.id))return $.alert(locale.cannotRemoveTeam);Object(l.f)("RemoveTeam","Open"),$.dialog({closable:!0,caption:locale.removeTeam+": "+i.name,message:locale.removeTeamConfirm,buttons:[{color:"red",caption:locale.removeTeam,callback:function(){Object(l.f)("RemoveTeam","Confirm"),o.close(),t.removeAccount(i.id,(function(e){e&&$.alert(e)}))}}]})}function s(){var e=n.val();if(e!=i.name){if(Object(l.f)("RemoveSettings","UpdateName"),!util.isValidDatabaseName(e))return $.alert(locale.invalidTeamName);$.loading(!0),t.updateAccount({id:i.id,name:e},(function(e){if(Object(l.f)("RemoveSettings","Close"),$.loading(!1),e)return $.alert(e);o.close()}))}else Object(l.f)("RemoveSettings","Close"),o.close()}},Wa.prototype.popupOptions_User=function(){if(!Object(c.f)()){Object(l.f)("TeamSettings","Open",{isOwner:!1});var e=this.account;if(e){var t=$.popdown({head:locale.teamName,buttons:[{caption:locale.leaveThisTeam,click:i},"-",{cls:"blue",caption:locale.okay,click:o}]});$.field({caption:"Team Name",val:e.name,$container:t.$content})}}function i(){Object(l.f)("LeaveTeam","Open");var i=dbms.getRemoteConnection(),o=i.getCurrentUser().id;if(!i.hasOtherAdmins(e.id,o))return $.alert(locale.oneAdminRequired);$.dialog({closable:!0,caption:locale.leaveTeam+": "+e.name,message:locale.leaveTeamConfirm,buttons:[{color:"red",caption:locale.leaveTeam,callback:function(){Object(l.f)("LeaveTeam","Confirm"),t.close(),dbms.getRemoteConnection().removeAccountUser(e.id,o,(function(e){e&&$.alert(e)}))}}]})}function o(){Object(l.f)("TeamSettings","Close"),t.close()}},Wa.prototype.importDatabase=function(e){return this.isAdmin()?NinoxDocumentInteraction.isOnline()?void 0:$.alert(locale.notConnected):$.alert(locale.errorNotAuthorized)},Wa.prototype.importArchive=function(){if(!this.isAdmin())return $.alert(locale.errorNotAuthorized);Object(l.f)("ImportArchive","Open");var e=this,t=$.popdown({cls:"small",head:locale.importDatabase,buttons:["-","cancel"," ",{cls:"blue",caption:locale.importDatabase,click:a}]}),i=$.input({caption:locale.createDatabaseName,$container:t.$content}),o=$('<div class="component editor editor-string editor-4col">').appendTo(t.$content);$("<label>").text(locale.importChooseFile).appendTo(o);var n=$('<input name="file" type="file" accept=".ninox" style="width:100%">').appendTo(o);function a(){if(!n[0].files[0])return $.alert("Please select a file for upload.");Object(l.f)("ImportArchive","Upload"),$.loading(!0);var o={name:i.val(),file:n[0].files[0]};e.account.server.uploadArchive(o,(function(i,o){if(Object(l.f)("ImportArchive","Confirm"),$.loading(!1),t.close(),i)return $.alert(i);e.account.sync()}))}},Wa.prototype.popupAccountUser=function(e){Object(l.f)("TeamMember","Open");var t=dbms.getRemoteConnection(),i=t.getAccount(this.accountId),o=this.isAdmin(),n=this;if(e){var a=t.getAccountUser(this.accountId,e);if(a){var s=a.id===i.owner,r=[];o&&!s&&r.push({caption:locale.removeFromTeam,click:h}),r.push("-"),r.push("cancel"),r.push(" "),o&&r.push({cls:"blue",caption:locale.okay,click:p});var c,d=$.popdown({head:locale.teamMember,buttons:r});$.field({caption:locale.name,val:a.name,$container:d.$content}),$.field({caption:locale.email,val:a.email,$container:d.$content}),o&&!s&&(c=this.createRoleModel(a.roles),new qt.a({el:d.$content},c))}}function h(){return Object(l.f)("TeamMember","Remove"),s?$.alert("Cannot remove the team's owner"):t.hasOtherAdmins(n.accountId,a.id)?void $.dialog({closable:!0,caption:locale.removeFromTeamHead,message:locale.removeFromTeamConfirm,buttons:[{color:"red",caption:locale.removeFromTeamOkay,callback:function(){Object(l.f)("TeamMember","RemoveConfirm"),d.close(),$.loading(!0),t.removeAccountUser(n.accountId,a.id,(function(e){if($.loading(!1),e)return $.alert(e)}))}}]}):$.alert(locale.oneAdminRequired)}function p(){if(d.close(),!s){var e=k.keys(a.roles),i=k.keys(c.value||{});if(-1===i.indexOf("admin")&&!t.hasOtherAdmins(n.accountId,a.id))return $.alert(locale.oneAdminRequired);util.equals(e,i)?Object(l.f)("TeamMember","Close"):(Object(l.f)("TeamMember","UpdateRoles"),$.loading(!0),t.updateAccountUser(n.accountId,{id:a.id,roles:i},(function(e){if($.loading(!1),Object(l.f)("TeamMember","Close"),e)return $.alert(e)})))}}},Wa.prototype.popupAccountInvitation=function(e){Object(l.f)("Invitation","Open");var t=dbms.getRemoteConnection();if(this.isAdmin()){var i=this;if(e){var o=t.getInvitation(i.accountId,e);if(o){var n=$.popdown({head:locale.invitation,buttons:[{caption:locale.cancelInvitation,click:a}," ",{caption:locale.resendInvitation,click:s},"-",{cls:"blue",caption:locale.okay,click:r}]});$.field({caption:locale.email,val:o.email,$container:n.$content}),$.field({caption:locale.roles,val:k.keys(o.roles).sort().join(", "),$container:n.$content}),$.field({caption:locale.invitedFrom,val:o.user?o.user.name:locale.unknown,$container:n.$content,width:"50%"}),$.field({caption:locale.invitedAt,val:util.formatLocaleDateTime(o.createdAt),$container:n.$content,width:"50%"})}}}function a(){$.dialog({closable:!0,caption:locale.cancelInvitation,message:locale.cancelInvitationConfirm,buttons:[{color:"red",caption:locale.cancelInvitation,callback:function(){Object(l.f)("Invitation","Remove"),n.close(),$.loading(!0),t.cancelInvitation(i.accountId,o.inviteCode,(function(e){if($.loading(!1),e)return $.alert(e)}))}}]})}function s(){n.close(),$.loading(!0),t.resendInvitation(i.accountId,o.inviteCode,(function(e){if(Object(l.f)("Invitation","Resend"),$.loading(!1),e)return $.alert(e)}))}function r(){Object(l.f)("Invitation","Close"),n.close()}},Wa.prototype.createRoleModel=function(e){var t=this,i={base:"extchoice",required:!0,stringAutocorrect:!1,width:4,formWidth:1,caption:locale.roles,getEditorClass:function(){return"extchoice"},getValues:function(){return dbms.getRemoteConnection().getSessionInfo().getRoles(t.accountId)},createValue:function(e,i){Object(l.f)("Role","Create");var o={id:e,caption:e};dbms.getRemoteConnection().getSessionInfo().addRole(t.accountId,o),i(void 0,o)},validate:function(e){},format:function(e){return e||""},formatEditor:function(e){return e||""},parseEditor:function(e){if("string"==typeof e&&(e=e.toLocaleLowerCase().trim()))for(var i=util.localeSortBy(dbms.getRemoteConnection().getSessionInfo().getRoles(t.accountId),"caption"),o=0;o<i.length;o++){var n=i[o];if(n.caption&&0===n.caption.toLocaleLowerCase().indexOf(e))return n.id}},convert:function(e){return e}};return new util.SimpleModel(i,e||{editor:!0})},Wa.prototype.emailNotVerified=function(){Object(l.f)("VerifyEmail","Show");var e=$.popdown({cls:"small",head:locale.confirmEmail,buttons:["cancel","-",{caption:locale.resendVerificationMail,cls:"blue",click:t}]});function t(){Object(l.f)("VerifyEmail","Resend"),e.close(),dbms.getRemoteConnection().resendVerificationMail({},(function(e){if(e)return $.alert(e)}))}},Wa.prototype.inviteDialog=function(){var e=dbms.getRemoteConnection();if(this.isAdmin()){if(!e.canInvite(this.accountId))return this.emailNotVerified();if(e.getAccount(this.accountId)){Object(l.f)("Invite","Open");var t=this,i=$.popdown({cls:"small",head:locale.inviteHead,buttons:["cancel","-",{caption:locale.sendInvitation,cls:"blue",click:a}]}),o=$.input({caption:locale.email,type:"email",$container:i.$content,focus:!0}),n=this.createRoleModel();new qt.a({el:i.$content},n)}}function a(){var a=o.val().trim().toLocaleLowerCase();if(!util.isValidEmail(a))return $.alert(locale.emailMissing);Object(l.f)("Invite","Send"),$.loading(!0),e.invite({accountId:t.accountId,email:a,roles:Object.keys(n.value)},(function(e){if($.loading(!1),i.close(),Object(l.f)("Invite",e?"Error":"Success"),e)return $.alert(e)}))}},Wa.prototype.removeDatabase=function(e,t){if(!this.isAdmin())return $.alert(locale.errorNotAuthorized);Object(l.f)("Database","Remove"),this.account.removeDatabase(e,t)},Wa.prototype.saveDatabaseArchiveAs=function(e,t){Object(l.f)("Database","Export"),this.saveDatabaseArchiveAsFile(e)},Wa.prototype.saveDatabaseArchiveAsFile=function(e){var t=this;NinoxDocumentInteraction.saveFile(e.name,"ninox",(function(i,o){if(i)return $.alert(i);o&&($.loading(!0),t.saveDatabaseArchiveToURL(e,o,(function(e){$.loading(!1),e&&$.alert(e)})))}))},Wa.prototype.saveDatabaseArchiveAsMenu=function(e,t){var i=this,o=($(t.target),$('<div class="nx-backplane nx-backplane-dark">').touch((function(e){$(e.target).is(".nx-backplane")&&h()}))),n=$('<div class="nx-menu-popup grey">').appendTo(o);$('<div class="nx-menu-head">').text(locale.saveArchiveAs).appendTo(n),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.openIn+"...")).appendTo(n).touch((function(){h(),i.saveDatabaseArchiveShare(e,t)})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.storeOnICloudDrive)).appendTo(n).touch((function(){h(),i.saveDatabaseArchiveICloud(e,t)})),o.appendTo($(document.body));var a=window.getWidth(),s=window.getHeight(),r=n.outerWidth(),l=n.outerHeight(),c=t.touches&&t.touches[0]&&t.touches[0].clientX||t.clientX||0,d=t.touches&&t.touches[0]&&t.touches[0].clientY||t.clientY||0;return c+r>a&&(c=a-r),d+l>s&&(d=s-l),n.offset({left:c,top:d}),!1;function h(){o.remove()}},Wa.prototype.saveDatabaseArchiveICloud=async function(e,t){var i=this,o=await localFileSystem.tempURL(e.name+".ninox");$.loading(!0),i.saveDatabaseArchiveToURL(e,o,(function(e){if($.loading(!1),e)return $.alert(e);NinoxDocumentInteraction.saveFileOnICloud(o,(function(e){e&&$.alert(e),localFileSystem.removeURL(o).catch(e=>console.log(e))}))}))},Wa.prototype.saveDatabaseArchiveShare=async function(e,t){var i=this,o=await localFileSystem.tempURL(e.name+".ninox");$.loading(!0),i.saveDatabaseArchiveToURL(e,o,(function(e){if($.loading(!1),e)return $.alert(e);NinoxDocumentInteraction.showFileOptions(o,t.clientX||0,t.clientY||0,(function(){localFileSystem.removeURL(o).catch(e=>console.log(e))}))}))},Wa.prototype.saveDatabaseArchiveToURL=function(e,t,i){this.account;i("NOT IMPLEMENTED")},Wa.prototype.createBackup=function(e){const t=this,i=$.popdown({cls:"small",head:locale.createBackup+": "+e.name,buttons:["cancel","-",{caption:locale.okay,cls:"blue",click:c}]}),o=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:"Include data",booleanRenderer:"check",formWidth:4}),!0);new qt.a(void 0,o,i.$content);const n=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:"Include files",booleanRenderer:"check",formWidth:4}),!0);new qt.a(void 0,n,i.$content);const a=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:"Include comments",booleanRenderer:"check",formWidth:4}),!0);new qt.a(void 0,a,i.$content);const s=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:"Include history",booleanRenderer:"check",formWidth:4}),!1);new qt.a(void 0,s,i.$content);let r=void 0,l=void 0;if(window.NINOX_BETA){r=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:"Beta: Create historic backup",booleanRenderer:"check",formWidth:4}),!1),new qt.a(void 0,r,i.$content);const e=$('<div style="display:none">').appendTo(i.$content);$('<div class="component text">Try to restore a historic version of this database from the database change history. This will only succeed, if the history has not been cleared out. In case this database has been transferred from another Ninox team, this option will only work, if the history has been included in backups and restores.</div>').appendTo(e),l=new util.SimpleModel(new schemas.TTimestamp(void 0,void 0,{caption:"Date and time of database",booleanRenderer:"check",formWidth:4}),Date.now()),new qt.a(void 0,l,e),r.on("update",()=>{e.css("display",r.value?"":"none")})}function c(){const c={dbid:e.id,data:o.value,files:n.value,comments:a.value,history:s.value,messages:!1,maxAge:r&&r.value?l.value:void 0};$.loading(!0),t.account.createBackup(c,(function(e,o){if($.loading(!1),e)return $.alert(e);i.close(),t.manageBackups("backups",o.id)}))}},Wa.prototype.isPaidPlan=function(){if(Object(c.f)())return!0;var e=dbms.getRemoteConnection().getSessionInfo().getPlan();return e&&"basic"===e.name||!1},Wa.prototype.manageBackups=function(e,t){Object(l.f)("Backups","Open");const i=$.popdown({close:o});function o(){console.log("Unmount Backups?",n.unmountComponentAtNode(i.$pane[0]))}n.render(s.createElement(La,{initialTab:e||"snapshots",initialSelection:t||null,account:this.account,dbms:dbms,ninoxDocumentInteraction:NinoxDocumentInteraction,isPaidPlan:this.isPaidPlan(),alert:$.alert,loading:$.loading,closePopup:()=>i.close()}),i.$pane[0])},Ba.prototype.destroy=function(){n.unmountComponentAtNode(this.$user[0]),this.$user.remove(),this.$user=void 0},Ba.prototype.updateUI=function(){var e=null;if(this.$user){var t=dbms.getRemoteConnection();t.isLoggedIn()&&(e=t.getCurrentUser())}n.render(s.createElement($a,{onClick:()=>this.popup(),user:e||null,size:28,style:{margin:e?"2px":void 0}}),this.$user[0])},Ba.prototype.popup=function(e){var t=this,i=dbms.getRemoteConnection();if(!i.isLoggedIn())return root.ninoxCloudSignup();var o=[];o.push({caption:locale.logout,click:l}),o.push("-"),Object(c.f)()||(o.push({caption:locale.upgradePlan,click:d}),o.push(" ")),o.push("cancel"),o.push(" "),o.push({cls:"blue",caption:locale.okay,click:p});var n=$.popdown({head:locale.yourAccount,buttons:o}),a=i.getCurrentUser(),s=$('<div style="display:flex;display:-webkit-flex">').appendTo(n.$content),r=$.input({caption:locale.name,val:a.displayName||"",$container:s});function l(){n.close(),root.ninoxCloudLogout()}function d(){n.close(),root.upgradePlan()}function h(e){$.chooseFile(e,(function(e,o){o&&i.uploadProfileImage({file:o},(function(e){e&&$.alert(e),setTimeout((function(){t.updateUI()}),2e3)}))}))}function p(){n.close();var e=r.val();e!=a.displayName&&($.loading(!0),i.updateUserProfile({displayName:e},(function(e){$.loading(!1),e&&$.alert(e),t.updateUI()})))}function u(){var e=$.popdown({cls:"small",head:locale.changePassword,closable:!0,buttons:[{caption:locale.cancel,click:a},"-",{caption:locale.okay,click:n,cls:"blue"}]}),t=$.input({type:"password",caption:locale.oldPassword,$container:e.$content,focus:!0,enter:function(){i.focus()}}),i=$.input({type:"password",caption:locale.newPassword,$container:e.$content,enter:function(){o.focus()}}),o=$.input({type:"password",caption:locale.repeatPassword,$container:e.$content,enter:n});function n(){var n=t.val(),a=i.val(),s=o.val();return util.isValidPassword(n)&&util.isValidPassword(a)?a!==s?$.alert(locale.passwordMismatch):void dbms.getRemoteConnection().changePassword({oldPassword:n,newPassword:a},(function(t){t?$.alert(t):e.close()})):$.alert(locale.invalidPassword)}function a(){e.close()}}Object(c.f)()||($('<div class="nx-hspace-small">').appendTo(s),$('<div class="nx-button-text grey">').text(locale.profileImage).appendTo($('<div style="width:160px;margin-right:8px;margin-top:27px">').appendTo(s)).on("click",h)),$.field({caption:locale.email,val:a.email,type:"email",$container:n.$content}),Object(c.g)()||$('<div style="padding:8px 12px 0 12px;color:#3059f0;font-weight:600;cursor:default">'+htmlEscape(locale.changePassword)+"</div>").appendTo(n.$content).touch(u)},Xa.prototype.updateBackground=function(){},Xa.prototype.destroy=function(){this.account.off("change",this.updateUI,this),this.hide()},Xa.prototype.show=function(){var e=this;this.visible||(this.visible=!0,this.$el=$('<div class="root-dblist">').appendTo(e.root.$body),this.$reactContainer=$("<div>").appendTo(this.$el),this.updateUI(),this.resyncInterval=setInterval(this.resync,1e4),this.account&&this.account.on("change",this.updateUI,this))},Xa.prototype.hide=function(){this.visible&&(this.visible=!1,this.resyncInterval&&(clearInterval(this.resyncInterval),this.resyncInterval=null),this.account&&this.account.off("change",this.updateUI,this),a.a.unmountComponentAtNode(this.$reactContainer[0]),this.$el.remove())},Xa.prototype.resync=function(){this.account&&this.account.sync()},Xa.prototype.updateUI=function(){if(this.visible&&!this.dontUpdateUI){var e=this.account,t=[];if(e){t=e.listDatabases();let i=[];for(const e of t)i.push({id:e.id,name:e.name,isStored:!0,localStorageType:e.local?"local":e.cloud?"cloud":"invalid",color:e.color,icon:e.icon,type:/^\/\//.test(e.icon)?"URL":"IMAGE"});a.a.render(r.a.createElement("div",null,r.a.createElement(ga,{databases:i,onContextMenuClick:(e,t)=>this.popupDatabaseMenu(e,t),onDatabaseClick:e=>this.openDatabase(e)}),r.a.createElement(ua,{isEmptyTeam:0===t.length,onNewDatabaseClick:()=>this.createDatabase(),onImportArchiveClick:e=>this.importArchive(e)})),this.$reactContainer[0])}}},Xa.prototype.popupDatabaseMenu=function(e,t){var i=this;if(this.account){var o=$(e),n=this.account.getDatabase(t);if(n){var a=$('<div class="nx-backplane nx-backplane-dark">').touch((function(e){$(e.target).is(".nx-backplane")&&T()})),s=$('<div class="nx-menu-popup" style="border:solid .5px #bbb">').appendTo(a);$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.saveArchiveAs)).appendTo(s).touch(y),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.duplicateDatabase)).appendTo(s).touch(b),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.renameDatabase)).appendTo(s).touch(w),n.cloud&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.reorganizeDatabase)).appendTo(s).touch(x),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.remove)).appendTo(s).touch(v),a.appendTo($(document.body));var r,l,c=s.outerWidth(),d=s.outerHeight(),h=o.offset(),p=o.width(),u=o.height(),f=Math.max(0,Math.min(h.left+Math.round((p-c)/2),window.getWidth()-c)),m=h.top+u,g=h.left+Math.round(p/2)-12;return m+d>window.getHeight()?(r="down",l=(m=Math.max(0,h.top-d))+d-.5):(r="up",l=m-23.5),s.offset({left:f,top:m}),$('<div class="marker-'+r+'" style="position:absolute;left:'+g+"px;top:"+l+'px">').appendTo(a),!1}}function v(){T(),i.removeDatabaseDialog(n)}function y(){T(),i.saveDatabaseArchiveAs(n,event)}function b(){T(),i.duplicateDatabase(n)}function w(){T(),i.renameDatabase(n)}function x(){T(),i.reorganizeDatabase(n)}function T(){a.remove()}},Xa.prototype.openDatabase=function(e,t){var i=this;$.loading(!0);const o=this.account.getDatabase(e);setTimeout((function(){i.account.openDatabase(o,(function(e){e?($.alert(e),$.loading(!1),t&&t(e)):(root.hide(),vt(Ya({},Tt(),{dbId:o.id})),ui.init(),$.loading(!1),t&&t(e))}))}),0)},Xa.prototype.createDatabase=function(){var e=this,t=this.account;new Aa({cancel:function(){},okay:function(i){new za({account:t,name:(i=i||{}).name,color:i.color,icon:i.icon,includeOptions:!1,dontShowLocations:!1,okay:async function(o){if(o.name)if(i.url){var n=i.url,a=o.name,s=o.location;if("local"===s){$.loading(!0);try{await NinoxZIP.unzip(n,await localFileSystem.fileURL("data/"+a)),localFileSystem.ensureLatestThumbnails("data/"+a);var r={},l=await localFileSystem.readFile("data/"+a+"/settings.json","utf8");l&&(r=JSON.parse(l)),o.icon&&(r.icon=o.icon),o.color&&(r.color=o.color),await localFileSystem.writeFile("data/"+a+"/settings.json",JSON.stringify(r),"utf8"),$.loading(!1),e.account.sync()}catch(e){$.loading(!1),$.alert(e)}}else if("cloud"===s){$.loading(!0);var c=util.createUUID(12);try{await NinoxZIP.unzip(n,await localFileSystem.fileURL("data/"+c));const t={id:c,name:c,local:!0};e.account.duplicateDatabase(t,{name:a,location:"cloud",icon:o.icon,color:o.color},(function(i,o){e.account.removeDatabase(t,(function(e){$.loading(!1),i?$.alert(i):e&&$.alert(e)}))}))}catch(e){return $.loading(!1),$.alert(e)}}}else $.loading(!0),t.createDatabase(o,(function(e,t){$.loading(!1),e?$.alert(e):(root.hide(),vt(Ya({},Tt(),{dbId:t.id})),ui.init())}))}})}})},Xa.prototype.createDatabase_X=function(){var e=this.account;new za({account:this.account,includeOptions:!1,okay:function(t){t.name&&($.loading(!0),e.createDatabase(t,(function(e){$.loading(!1),e?$.alert(e):(root.hide(),ui.init())})))}})},Xa.prototype.removeDatabaseDialog=function(e){var t=this.account;t&&$.dialog({closable:!0,caption:locale.dropDatabase,message:locale.confirmDropDatabase,buttons:[{color:"red",caption:locale.dropDatabase,callback:function(){t.removeDatabase(e,(function(e){e&&$.alert(e)}))}}]})},Xa.prototype.removeDatabase=function(e,t){this.account.removeDatabase(e,t)},Xa.prototype.importArchive=function(e){this.importArchive_MAC()},Xa.prototype.importArchive_MAC=function(){var e=this;NinoxDocumentInteraction.chooseFileWithExtensions(["ninox"],(function(t,i){i&&e.importArchiveDialog(i)}))},Xa.prototype.importArchive_IOS=function(e){var t=this,i=$(Ze.b.getTarget(e)),o=$.backplane({}),n=$('<div class="nx-menu-popup">').appendTo(o);$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.icloudDrive)).appendTo(n).touch(l),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.dropbox)).appendTo(n).touch(c);var a=n.outerWidth(),s=n.outerHeight(),r=i.offset();function l(){o.close(),NinoxDocumentInteraction.chooseFileWithExtensionsFromICloud(["ninox"],(function(e,i){i&&t.importArchiveDialog(i)}))}function c(){o.close(),setTimeout((function(){NinoxDocumentInteraction.chooseFile((function(e,i){i&&t.importArchiveDialog(i)}))}),0)}r.left+=i.width()-90,r.top+=70,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)},Xa.prototype.saveDatabaseArchiveAs=function(e,t){this.saveDatabaseArchiveAsFile(e)},Xa.prototype.saveDatabaseArchiveAsFile=function(e){var t=this;NinoxDocumentInteraction.saveFile(e.name,"ninox",(function(i,o){if(i)return $.alert(i);o&&($.loading(!0),t.saveDatabaseArchiveToURL(e,o,(function(e){$.loading(!1),e&&$.alert(e)})))}))},Xa.prototype.saveDatabaseArchiveAsMenu=function(e,t){var i=this,o=($(t.target),$('<div class="nx-backplane nx-backplane-dark">').touch((function(e){$(e.target).is(".nx-backplane")&&h()}))),n=$('<div class="nx-menu-popup grey">').appendTo(o);$('<div class="nx-menu-head">').text(locale.saveArchiveAs).appendTo(n),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.openIn+"...")).appendTo(n).touch((function(){h(),i.saveDatabaseArchiveShare(e,t)})),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.storeOnICloudDrive)).appendTo(n).touch((function(){h(),i.saveDatabaseArchiveICloud(e,t)})),o.appendTo($(document.body));var a=window.getWidth(),s=window.getHeight(),r=n.outerWidth(),l=n.outerHeight(),c=t.touches&&t.touches[0]&&t.touches[0].clientX||t.clientX||0,d=t.touches&&t.touches[0]&&t.touches[0].clientY||t.clientY||0;return c+r>a&&(c=a-r),d+l>s&&(d=s-l),n.offset({left:c,top:d}),!1;function h(){o.remove()}},Xa.prototype.saveDatabaseArchiveICloud=async function(e,t){var i=this,o=await localFileSystem.tempURL(e.name+".ninox");$.loading(!0),i.saveDatabaseArchiveToURL(e,o,(function(e){if($.loading(!1),e)return $.alert(e);NinoxDocumentInteraction.saveFileOnICloud(o,(function(e){e&&$.alert(e),localFileSystem.removeURL(o).catch(()=>{})}))}))},Xa.prototype.saveDatabaseArchiveShare=async function(e,t){var i=this,o=await localFileSystem.tempURL(e.name+".ninox");$.loading(!0),i.saveDatabaseArchiveToURL(e,o,(function(e){if($.loading(!1),e)return $.alert(e);NinoxDocumentInteraction.showFileOptions(o,t.clientX||0,t.clientY||0,(function(){localFileSystem.removeURL(o).catch(()=>{})}))}))},Xa.prototype.saveDatabaseArchiveToURL=async function(e,t,i){var o=this.account;if(!o)return i("Account not found.");if(e.local)try{await NinoxZIP.zip(await localFileSystem.fileURL("data/"+e.name),t),i()}catch(e){i(e)}else if(e.cloud){var n=util.createUUID(12);o.duplicateDatabase(e,{name:n,location:"local"},(async function(e,n){if(e)return i(e);try{await NinoxZIP.zip(await localFileSystem.fileURL("data/"+n.name),t),o.removeDatabase(n,(function(e){i(e)}))}catch(e){return i(e)}}))}else i("Cannot create archive")},Xa.prototype.newDatabaseName=function(e){var t=this.account.getDatabaseNames(),i=void 0,o=/([0-9]+)$/.exec(e);for(o?(e=e.substr(0,o.index),i=parseInt(o[1])+1):i=2;t[e+i];)i++;return e+=i},Xa.prototype.duplicateDatabase=function(e,t){var i=this,o=this.account;if(!o)return t("Account not found.");var n=i.newDatabaseName(e.name);new za({account:this.account,name:n,title:locale.duplicateDatabase,button:locale.duplicateDatabaseOkay,includeOptions:!0,dontShowIconColor:!0,dontShowLocations:!1,okay:function(i){$.loading(!0),o.duplicateDatabase(e,i,(function(e,i){$.loading(!1),e&&$.alert(e),t&&t(e,i)}))},cancel:function(){t&&t()}})},Xa.prototype.renameDatabase=function(e,t){var i=this.account;if(!i)return t("Account not found.");new Va(e,{account:i,okay:function(o){$.loading(!0),i.renameDatabase(e,o,(function(e,i){$.loading(!1),e&&$.alert(e),t&&t(e,i)}))},cancel:function(){t&&t()}})},Xa.prototype.reorganizeDatabase=function(e,t){var i=this.account;$.dialog({closable:!1,caption:locale.reorganizeDatabase,message:locale.confirmReorganizeDatabase,buttons:[{color:"grey float-left",caption:locale.cancel,callback:function(){t&&t()}},{color:"red",caption:locale.reorganizeDatabase,callback:function(){$.loading(!0),i.duplicateDatabase(e,{name:e.name,location:"cloud"},(function(o,n){o?($.loading(!1),$.alert(o),t&&t(o)):i.removeDatabase(e,(function(e){$.loading(!1),e&&$.alert(e),t&&t(e,n)}))}))}}]})},Xa.prototype.popupOptions=function(e){},Xa.prototype.importDatabase=function(e){var t=this,i=/([^\<\>\?\"\:\|\\\/\*\.]+)\.ninox$/i.exec(e);new za({name:i?decodeURIComponent(i[1]):void 0,title:locale.importDatabase,button:locale.importDatabase,includeOptions:!1,account:t.account,dontShowIconColor:!0,dontShowLocations:!1,okay:async function(i){try{$.loading(!0);var o=i.name,n=i.location;if("local"===n)await NinoxZIP.unzip(e,await localFileSystem.fileURL("data/"+o)),localFileSystem.ensureLatestThumbnails("data/"+o),t.account.sync();else if("cloud"===n){var a=util.createUUID(12);await NinoxZIP.unzip(e,await localFileSystem.fileURL("data/"+a));var s={id:a,name:a,local:!0};t.account.duplicateDatabase(s,{name:o,location:"cloud"},(function(e,i){t.account.removeDatabase(s,(function(t){$.loading(!1),e?$.alert(e):t&&$.alert(t)}))}))}}catch(e){$.alert(e)}finally{$.loading(!1)}}})},Xa.prototype.importArchiveDialog=function(e){var t=this,i=/([^\<\>\?\"\:\|\\\/\*\.]+)\.ninox$/i.exec(e),o=i?decodeURIComponent(i[1]):void 0;new za({account:t.account,name:o,title:locale.importDatabase,button:locale.importDatabase,includeOptions:!1,dontShowIconColor:!0,dontShowLocations:!1,okay:async function(i){$.loading(!0);var o=i.name,n=i.location;if("local"===n){try{await NinoxZIP.unzip(e,await localFileSystem.fileURL("data/"+o)),localFileSystem.ensureLatestThumbnails("data/"+o),t.account.sync()}catch(e){$.alert(e)}$.loading(!1)}else if("cloud"===n){var a=util.createUUID(12);try{await NinoxZIP.unzip(e,await localFileSystem.fileURL("data/"+a));var s={id:a,name:a,local:!0};t.account.duplicateDatabase(s,{name:o,location:"cloud"},(function(e,i){t.account.removeDatabase(s,(function(i){$.loading(!1),e?$.alert(e):i&&$.alert(i),t.account.sync()}))}))}catch(e){$.alert(e),$.loading(!1),t.account.sync()}}}})};class Qa{constructor(){Je()(this,"accountId",void 0),Je()(this,"visible",void 0),Je()(this,"accountView",void 0),Je()(this,"refreshRemoteConnection",void 0),Je()(this,"refreshRemoteConnectionInterval",void 0),Je()(this,"$el",void 0),Je()(this,"$controls",void 0),Je()(this,"$accountTabs",void 0),Je()(this,"$controlsButtons",void 0),Je()(this,"$body",void 0),Je()(this,"$admin",void 0),Je()(this,"$header",void 0),Je()(this,"user",void 0),Je()(this,"$verificationContainer",void 0),this.accountId=null,this.visible=!1,this.accountView=null,this.refreshRemoteConnection=()=>{NinoxDocumentInteraction.isOnline()&&dbms.getRemoteConnection().refresh()},this.refreshRemoteConnectionInterval=null,this.show(),this.processSAMLToken(()=>{!dbms.getRemoteConnection().isLoggedIn()&&Object(c.f)()?this.ninoxCloudSignup():this.afterLogin()})}afterLogin(){const e=this.ensureAccount();if(e){this.selectAccount(e.id);const t=_t();t?this.cbTemplate(t):void 0!==Tt().dbId?this.cbDatabase():dbms.on("change",this.dbmsChanged,this)}}cbTeam(e){const t=dbms.getDefaultAccountId();"default"===e.teamId?(vt(Ka({},e,{teamId:dbms.getDefaultAccountId()})),this.selectAccount(t)):(this.selectAccount(e.teamId),null==this.accountId&&dbms.getRemoteConnection().isLoggedIn()&&(vt(Ka({},e,{teamId:dbms.getDefaultAccountId()})),this.selectAccount(t)))}ensureAccount(){const e=Tt(),t=dbms.getDefaultAccountId();let i,o=e.teamId;return"default"===o&&t?(o=t,vt({teamId:o}),e.dbId&&window.location.reload(),i=dbms.getAccount(o)):(i=dbms.getAccount(o),!i&&t&&(o=t,vt({teamId:o}),e.dbId&&window.location.reload(),i=dbms.getAccount(o))),i}cbDatabase(){const e=this.ensureAccount();e&&($.loading(!0),e.ensureDatabase(Tt().dbId,(t,i)=>{if(t||!i)return $.loading(!1),this.show(),void vt({teamId:Tt().teamId});e.openDatabase(i,e=>{$.loading(!1),e?(this.show(),vt({teamId:Tt().teamId})):(this.hide(),ui.init())})}))}cbTemplate(e){ui.isPrivateCloud()&&!dbms.getRemoteConnection().isLoggedIn()&&this.ninoxCloudSignup(),vt({teamId:Tt().teamId})}show(){if(this.visible)return;Ct("team",this.cbTeam,this),Ct("tab",this.cbDatabase,this),Ct("view",this.cbDatabase,this),trackPageView("home"),Object(l.f)("TeamsHome","Open"),this.visible=!0;const e=(Object(c.d)("settings")||{}).windowTitle||"Ninox Database";NinoxDocumentInteraction.setWindowTitle(e),this.$el=$('<div class="root">').appendTo($(document.body)),this.$verificationContainer=$('<div style="position: absolute; left: 0; right: 0;">').appendTo(this.$el).hide(),this.$controls=$('<div class="root-controls">').appendTo(this.$el),this.$accountTabs=$('<div class="root-tabs --ul-account-tabs">').appendTo(this.$controls),this.$controlsButtons=$('<div class="root-controls-buttons">').appendTo(this.$controls),this.$body=$('<div class="root-body">').appendTo(this.$el),this.user=new Ba(this.$controlsButtons),$('<div class="button --ul-app-setting-button"><div class="i-32-24 i-white i-setting-settings"></div></div>').appendTo(this.$controlsButtons).touch($.proxy(this.popupOptions,this)),this.accountView&&this.accountView.show(),this.updateUI(),this.refreshRemoteConnectionInterval||(this.refreshRemoteConnectionInterval=window.setInterval(this.refreshRemoteConnection,2e4)),window.Appcues&&window.Appcues.page()}hide(){this.visible&&(kt("team",this.cbTeam,this),kt("view",this.cbDatabase,this),kt("tab",this.cbDatabase,this),this.visible=!1,this.refreshRemoteConnectionInterval&&(clearInterval(this.refreshRemoteConnectionInterval),this.refreshRemoteConnectionInterval=null),this.accountView&&this.accountView.hide(),n.unmountComponentAtNode(this.$accountTabs[0]),this.$el.remove(),this.$el=null,this.$body=null,this.$controls=null,this.$header=null,this.$accountTabs=null,this.user.destroy(),this.user=null)}updateUI(){if(!this.visible)return;this.$verificationContainer.hide();const e=dbms.getRemoteConnection();e.isLoggedIn(),this.updateUITabs(),this.accountView&&this.accountView.updateUI(),this.user.updateUI();dbms.getRemoteConnection().getSessionInfo().user}updateUITabs(){const e=dbms.listAccounts().map(e=>Ka({},e,{id:e.id,isSelected:e.id===this.accountId,text:""===e.name?Object(b.getLocale)().unknown:e.name,iconClass:"i-32-24 i-light-grey i-people-group"}));n.render(s.createElement(Bt.a,{popupItemBackground:"OFF_WHITE",items:e,currentItemId:this.accountId,onItemSelect:e=>this.accountTabsClicked(e),onContextMenuClick:e=>this.accountTabsContextmenu(e),onNewItemClick:Object(c.f)()?null:()=>this.createAccount(),newButtonText:"+ "+(dbms.getRemoteConnection().isLoggedIn()?Object(b.getLocale)().newTeam:Object(b.getLocale)().signupCreateTeam)}),this.$accountTabs[0])}dbmsChanged(){dbms.getAccount(this.accountId)?this.updateUI():this.selectAccount(dbms.getDefaultAccountId())}accountTabsClicked(e){e===this.accountId?this.popupAccountOptions(e):gt({teamId:e})}accountTabsContextmenu(e){this.popupAccountOptions(e)}createAccount(){dbms.getRemoteConnection().isLoggedIn()?this.createAccountDialog():this.ninoxCloudSignup()}createAccountDialog(){const e=this;if(!dbms.getRemoteConnection().canCreateTestAccount())return $.alert(Object(b.getLocale)().alreadyTrialPlan);const t=$.popdown({cls:"small",head:Object(b.getLocale)().createNewTeam,buttons:["cancel","-",{caption:Object(b.getLocale)().createTeam,cls:"blue",click:o}]}),i=$.input({caption:Object(b.getLocale)().chooseTeamName,$container:t.$content,focus:!0});function o(){const o=i.val().trim();if(!o)return $.alert(Object(b.getLocale)().noTeamName);$.loading(!0),dbms.getRemoteConnection().createAccount({name:o},(i,o)=>{if($.loading(!1),i)return $.alert(i);t.close(),o&&e.afterLogin()})}}selectAccount(e){if(e!==this.accountId){this.accountView&&(this.accountView.destroy(),this.accountView=null);const t=dbms.getAccount(e);t?(this.accountId=e,"local"===t.base?(this.accountView=new Xa(this,e),trackPageView("home/local"),Object(l.f)("MyDatabases","Open")):(this.accountView=new Wa(this,e),trackPageView("home/team"),Object(l.f)("Team","Open"))):this.accountId=null}this.accountView&&this.visible&&this.accountView.show(),this.updateUI()}popupAccountOptions(e){e===this.accountId&&this.accountView&&this.accountView.popupOptions()}selectServer(){const e=$.popdown({cls:"small",head:"Select Server",buttons:["cancel","-",{caption:Object(b.getLocale)().okay,cls:"blue",click:i}]}),t=$.input({caption:"Server",$container:e.$content,focus:!0});function i(){const e=t.val().trim();if(e&&!/^([a-z][a-z0-9\-\_]*)(\.[a-z][a-z0-9\-\_]*)*(\:[0-9]+)?$/.test(e))return $.alert("Invalid address.");e!=NinoxDocumentInteraction.getUserDefault("nx.server")&&(NinoxDocumentInteraction.setUserDefault("nx.server",e),dbms.getRemoteConnection().clearSession(),window.location.reload())}t.$input.attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false"),t.val(NinoxDocumentInteraction.getUserDefault("nx.server"))}popupOptions(e){const t=this,i=dbms.getRemoteConnection(),o=i.getAccount(this.accountId),n=(o&&(o.owner,i.getUserId()),$.backplane({close:c})),a=$('<div class="nx-menu-popup popupeditor">').css({left:"auto",right:0,top:40}).appendTo(n);{let e;e="macappstore://itunes.apple.com/app/id901110441?mt=12",$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-star">')).append($('<div class="nx-menu-label">').text(Object(b.getLocale)().heartNinox)).appendTo(a).touch(()=>{n.close(),trackEvent("RateNinox","Click"),Object(l.f)("RateNinox","Click"),NinoxDocumentInteraction.openBrowser(e)})}$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-question">')).append($('<div class="nx-menu-label">').text(Object(b.getLocale)().onlineHelp)).appendTo(a).touch(()=>{n.close(),trackEvent("UserManual","Click"),Object(l.f)("UserManual","Click"),NinoxDocumentInteraction.openBrowser(Za())}),$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-email">')).append($('<div class="nx-menu-label">').text(Object(b.getLocale)().supportTicket)).appendTo(a).touch(()=>{n.close(),trackEvent("GetSupport","Click"),Object(l.f)("GetSupport","Click"),NinoxDocumentInteraction.openBrowser("mailto:support@ninox.com")}),$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-setting-settings">')).append($('<div class="nx-menu-label">').text("Select server")).appendTo(a).touch(()=>{n.close(),trackEvent("SelectServer","Click"),Object(l.f)("SelectServer","Click"),t.selectServer()});const s=new b.util.SimpleModel(new b.schemas.TChoice(void 0,void 0,{caption:Object(b.getLocale)().language,required:!0,values:{auto:{caption:Object(b.getLocale)().auto,order:1},en:{caption:"English",order:2},fr:{caption:"French (Français)",order:3},de:{caption:"German (Deutsch)",order:4},it:{caption:"Italian (Italiano)",order:5},es:{caption:"Spanish (Español)",order:6},ca:{caption:"Catalan (Català)",order:7},pl:{caption:"Polish (Polski)",order:8},ru:{caption:"Russian (Русский)",order:9},chs:{caption:"Chinese simplified (简体中文)",order:10},cht:{caption:"Chinese traditional (繁體中文)",order:11}}}));s.value=NinoxDocumentInteraction.getUserDefault("ui.language")||"auto";const r=new qt.a(void 0,s,a);function c(){r.destroy()}s.on("update",()=>{NinoxDocumentInteraction.setUserDefault("ui.language",s.value),setTimeout(()=>{t.reload()},0)}),r.el.css({width:240})}openIntegrations(e){const t=$.popdown({}),i=[];$('<div class="nx-section-head">').text(Object(b.getLocale)().zapierIntegration).appendTo(t.$pane);const o=$('<div class="root-backup-list">').css({padding:"0 10px",height:"75vh"}).appendTo(t.$pane),n=$('<table class="w-100">'),a=$('<div class="api-keys-body">').append(n),s=$('<button class="api-generate-btn pointer">'+Object(b.getLocale)().generate+"</button>").click(l);function r(e){const t=e=>{dbms.getRemoteConnection().deleteAPIKey(e,(t,o)=>{if(t)return console.warn(t);const n=i[e];n&&(n.remove(),delete i[e])})},o=$('<span class="nx-menu-icon i-32-24 i-light-grey i-close"></span>').click(()=>t(e));return $("<tr>").append($('<td class="api-data force-select"><span>'+e+"</span></td>")).append($('<td class="api-data text-right pointer" title="Delete Token">').append(o))}function l(){dbms.getRemoteConnection().generateAPIKey((e,t)=>{if(e)return console.warn(e);const o=r(t.token);i[t.token]=o,n.append(o)})}$('<div class="api-keys">').append($('<div class="api-keys-header"><div class="half"><span style="font-size: 1.1rem;">API Keys</span></div></div>').append($('<div class="half text-right">').append(s))).append(a).appendTo(o),dbms.getRemoteConnection().fetchAPIKeys((e,t)=>{if(e)return console.warn(e);t.forEach(e=>{const t=r(e.token);i[e.token]=t,n.append(t)})})}upgradePlan(){trackEvent("upgrade","click"),Object(l.f)("Upgrade","Open"),this.upgradePlan_APPLE()}upgradePlan_APPLE(){new Ga}upgradePlan_CLEVERBRIDGE(){const e=dbms.getRemoteConnection().getUpgradeURL();NinoxDocumentInteraction.openBrowser(e)}ninoxCloudSignup(){const e=this;let t=!1;const i=!Object(c.f)(),o=window.location.hash,a=Et().error;if(/\#signup/.exec(o)&&i&&(t=!0),trackPageView(t?"signup":"login"),Object(l.f)(t?"Signup":"Login","Open"),Object(c.g)()){const e=$.popdown({head:Object(c.f)()?Object(b.getLocale)().signinHead||"Ninox Login":Object(b.getLocale)().signupHead}),t=Object(c.d)("settings")||{},i=t.ssoButtonClasses,o=t.ssoButtonText,n=()=>{close(),dbms.getRemoteConnection().samlLogin()};if($.buttons({classes:"root-sso-popup",items:[{caption:o||Object(b.getLocale)().ssoLogin||"SSO Login",click:n,cls:`blue${i?` ${i}`:""}`}],$container:e.$pane}),a){const t=decodeURI(a);$('<div class="root-sso-error">'+htmlEscape(t)+"</div>").appendTo(e.$pane)}}else(()=>{const o=$.backplane({close:r,scrollable:!0,closable:!1});let a=!Object(c.f)();function r(){n.unmountComponentAtNode(o[0])}a=!1,n.render(s.createElement(pa,{canSignup:i,wantsSignup:t,close:()=>o.close(),afterLogin:()=>e.afterLogin(),isGoogleAvailable:a}),o[0])})()}ninoxCloudLogout(){const e=dbms.getRemoteConnection();window.database?dbms.closeDatabase(()=>{e.logout(e=>{ui&&ui.handleLogout(()=>{vt({teamId:"default"}),window.location.reload()})})}):e.logout(e=>{if(e)return $.alert(e)})}handleOpenURL(e){if(e)if(/^ninox\:\/\/do\:/.test(e)){const t=/^ninox\:\/\/do\:([a-z\-]+)\:(.*)$/.exec(e);if(t){const e=t[1],i=t[2];"set-server"===e?NinoxDocumentInteraction.getUserDefault("nx.server")!==i&&(NinoxDocumentInteraction.setUserDefault("nx.server",i),dbms.getRemoteConnection().clearSession(),window.location.reload()):alert("Unknow command: "+e+":"+i)}else alert("Invalid url: "+e)}else{if(/^ninox\:\/\//.test(e)){const t=e.substr(8);if(!t)return;e=/^[a-z]+\:/i.test(t)?t:"http://"+t}/\.ninox$/i.test(e)?(vt({teamId:Tt().teamId}),ui.destroy(()=>{this.show(),this.accountView?this.accountView.importDatabase(e):$.alert("No account selected.")})):new pi({url:e})}}reload(){window.location.reload()}renameDatabase(e,t){this.accountView&&this.accountView.renameDatabase(e,t)}duplicateDatabase(e,t){this.accountView&&this.accountView.duplicateDatabase(e,t)}reorganizeDatabase(e,t){this.accountView&&this.accountView.reorganizeDatabase(e,t)}saveDatabaseArchiveAs(e,t){this.accountView&&this.accountView.saveDatabaseArchiveAs(e,t)}createDatabase(){this.accountView&&this.accountView.createDatabase()}importArchive(e){this.accountView&&this.accountView.importArchive(e)}removeDatabase(e,t){this.accountView&&this.accountView.removeDatabase(e,t)}trigger(e){}installTemplate(e){this.accountView&&this.accountView.account&&($.loading(!0),this.accountView.account.loadArchive({url:e},e=>{$.loading(!1),e&&$.alert(e)}))}processSAMLToken(e){return e()}}function Za(){const e="de"===Object(b.getLocale)().LOCALE?"de":"en";let t="https://ninox.com";return["qs","alpha"].includes("prod")&&(t="https://q-www.ninox.com"),`${t}/${e}/manual`+"?h=1&utm_medium=ninox-app&utm_campaign=app-mac-manual&utm_source=app-mac"}var es=o("./src/react/util/HorizontalScrollContainer/HorizontalScrollItem.tsx");o("./src/react/tableView/TabsRow.css");const ts=Object(Ft.SortableContainer)(({children:e,className:t})=>s.createElement("div",{className:t},e)),is=Object(Ft.SortableElement)(({children:e})=>e);class os extends s.Component{constructor(e){super(e),Je()(this,"handleScrollStateChange",e=>{this.props.onScrollStateChange(e),this.setState({isScrollable:e})}),this.state={isScrollable:!1,isSorting:!1}}render(){const e=this.props.views[this.props.selectedIndex],t=null==e?void 0:e.id;return s.createElement("div",{className:"TabsRow_root"},s.createElement(Fo.a,{controlsConfig:{position:"AFTER_CHILD",left:{innerElement:this.getElementBeforeControls(),visibility:window.TOUCH?"NONE":"AUTO",containerClassName:"TabsRow_movementControlsContainer TabsRow_movementControlsContainerLeft"},right:{containerClassName:"TabsRow_movementControlsContainer",visibility:window.TOUCH?"NONE":"AUTO"}},useExternalResizeListener:!0,selectedItemId:t,onScrollStateChange:this.handleScrollStateChange},s.createElement(ts,{onSortStart:()=>this.setState({isSorting:!0}),className:"TabsRow_tabsContainer",helperClass:"TabsRow_helperClass",distance:window.TOUCH?0:3,pressDelay:window.TOUCH?200:0,onSortEnd:e=>this.onSortEnd(e.oldIndex,e.newIndex),axis:"x"},this.props.views.map((e,t)=>s.createElement(is,{key:e.id,index:t},s.createElement(es.a,{id:e.id,className:this.getViewClass(t)},s.createElement(Ze.a,{className:"TabsRow_view",preventLongPress:!0,onFastClick:e=>this.props.onTabClick(e,t),onFastContextMenu:e=>this.props.onContext(e,t)},e.caption||Object(b.getLocale)().unnamed)))))),this.getElementAfterControls())}getElementAfterControls(){return this.state.isScrollable?s.createElement("div",{className:"TabsRow_actionsContainer"},s.createElement(Ze.a,{onFastClick:this.props.onShowMoreTabsClick,className:"i-32-16 i-white i-items"})):null}getElementBeforeControls(){return this.props.isAdmin?s.createElement("div",{className:"TabsRow_actionsContainer TabsRow_addContainer"},s.createElement(Ze.a,{onFastClick:this.props.onNewViewClick,className:"i-32-16 i-light-grey i-plus"})):null}getViewClass(e){let t="TabsRow_viewContainer";return e===this.props.selectedIndex&&(t+=" TabsRow_viewSelected"),this.state.isSorting&&(t+=" TabsRow_viewSorting"),t}onSortEnd(e,t){this.setState({isSorting:!1}),this.props.onReorder(e,t)}}class ns extends s.Component{constructor(e){super(e),Je()(this,"handleTabClick",(e,t)=>{t===this.props.selectedIndex?this.handleContextMenu(e,t):this.props.onTabClick(t)}),Je()(this,"handleContextMenu",(e,t)=>{const i=[{text:Object(b.getLocale)().newView+"...",onClick:this.props.onNewViewClick},{text:Object(b.getLocale)().renameView+"...",onClick:()=>this.props.onRenameView(t)},{text:Object(b.getLocale)().removeView,onClick:()=>this.handleRemoveView(t)}];t===this.props.selectedIndex&&i.push({text:Object(b.getLocale)().showHideColumns,onClick:()=>this.props.onEditColumns(t)}),this.displayContextMenu(e,t,i)}),Je()(this,"displayContextMenu",(e,t,i)=>{this.setState({target:Ze.b.getTarget(e),contextMenu:{isOpen:!0,content:i}})}),Je()(this,"handleShowAllClicked",e=>{this.setState({target:Ze.b.getTarget(e),isPopupMenuOpen:!0})}),Je()(this,"handleScrollStateChange",e=>{this.setState({isScrollable:e,isPopupMenuOpen:!1})}),Je()(this,"closeBackplane",()=>{this.setState(e=>({killWhenTargetIsNull:!1,isPopupMenuOpen:!1,contextMenu:{isOpen:!1,content:e.contextMenu.content}}))}),this.state={target:null,isScrollable:!1,isPopupMenuOpen:!1,contextMenu:{isOpen:!1,content:[]},killWhenTargetIsNull:!1}}render(){return s.createElement("div",{style:{width:"100%"}},s.createElement(os,{isAdmin:this.props.isAdmin,onContext:this.handleContextMenu,onScrollStateChange:this.handleScrollStateChange,onNewViewClick:this.props.onNewViewClick,onReorder:this.props.onReorder,onShowMoreTabsClick:this.handleShowAllClicked,onTabClick:this.handleTabClick,selectedIndex:this.props.selectedIndex,views:this.props.views}),this.state.isScrollable?s.createElement(Lo.a,{itemBackground:"OFF_WHITE",items:this.getPopUpItems(),clickTarget:this.state.target,show:this.state.isPopupMenuOpen,onClick:e=>{e!==this.props.selectedIndex&&(null!==e&&this.props.onTabClick(e),this.closeBackplane())},onReorder:this.props.onReorder}):null,s.createElement(Pn,{clickTarget:this.state.target,killWhenTargetIsNull:this.state.killWhenTargetIsNull,show:this.state.contextMenu.isOpen,onClick:this.closeBackplane,items:this.state.contextMenu.content}))}handleRemoveView(e){this.setState({target:null,killWhenTargetIsNull:!0}),this.props.onRemoveView(e)}getPopUpItems(){return this.props.views.map((e,t)=>{let i=e.mode;return"full"===e.mode?i="form":"pivot"===e.mode||"table"===e.mode?i="setting-table":"chart"===e.mode?i="setting-table-chart":"cards"===e.mode&&(i="home"),{id:e.id,isSelected:t===this.props.selectedIndex,text:e.caption,iconClass:i?"i-32-24 i-light-grey i-"+i:"i-32-24 i-light-grey i-setting-table"}})}}o("./node_modules/assert/assert.js");function as(e){var t=e.type,i=$.backplane({}),o=$('<div style="position:absolute;left:'+ui.leftWidth+'px;right:0;bottom:0;top:48px;background-color:#fff">').appendTo(i),n=$('<div style="position:absolute;left:0;top:0;right:0;bottom:48px;overflow:auto">').appendTo(o),a=(window.getWidth(),[]);k.each(t.sorted,(function(e){var i,o,s,r,l,c,d,h;function p(){l.setHidden("function"!==o.value),d.el.setHidden("value"!==o.value)}function u(){new Ai.a({value:h.fn,schema:database.schema,type:t,okay:function(e,t){h.fn=e||"",h.exp=t,r.text(t?t.toHumanString():"")}})}ss(e)&&(i=$('<div style="border-bottom:solid 1px #EFF1F9;display:flex;display:-webkit-flex">').append($('<div style="flex:0 0 auto;-webkit-flex:0 0 auto;width:150px;line-height:48px;overflow:hidden;white-space:nowrap;text-align:right;padding:0 8px">').text(e.caption||e.id)).appendTo(n),(o=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.updateMode,required:!0,width:2,values:{ignore:{caption:locale.updateModeDontChange,order:1},value:{caption:locale.updateModeAssignValue,order:2},function:{caption:locale.updateModeAssignFunction,order:3},null:{caption:locale.updateModeAssignNull,order:4}}}))).value="ignore",o.withoutLabel=!0,o.on("update",p),(s=new qt.a(void 0,o,i)).el.css({width:200,flex:"0 0 auto","-webkit-flex":"0 0 auto"}),l=$('<div class="editor" style="flex:1 1 auto;-webkit-flex:1 1 auto">').appendTo(i),r=$('<div class="input-text">').appendTo($('<div class="stringeditor">').appendTo(l)).click(u),(c=new util.SimpleModel(e)).withoutLabel=!0,(d=new qt.a(void 0,c,i)).el.css({flex:"1 1 auto","-webkit-flex":"1 1 auto"}),h={fn:"",exp:void 0,field:e,updateMode:o,updateModeField:s,value:c},a.push(h),p())}));var s=$('<div style="position:absolute;left:0;bottom:0;right:0;height:48px;background-color:#fff;display:flex;display:-webkit-flex;border-top:solid 1px #D4D9E9">').appendTo(o),r=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:"",required:!0,width:2,values:{visible:{caption:locale.updateVisibleRecords,order:2},selected:{caption:locale.updateSelectedRecords,order:3}}}));function l(){$.loading(!0);for(var i="selected"===r.value?k.keys(e.midChoosen):k.keys(e.models),o=[],n={},s=0;s<a.length;s++){var l=a[s];"function"===l.updateMode.value&&l.exp&&queries.extendDependencies(n,l.exp.dependencies)}function d(){database.loadNodes2(i,n,(function(e){e&&($.loading(!1),$.alert(e)),setTimeout(h,0)}))}function h(){let e=1;for(let n=0;n<i.length;n++){const s=i[n],r=database.loadNodeSync(s);if(r){const i={_id:s};for(let o=0;o<a.length;o++){const n=a[o],s=n.field,l=n.updateMode.value;if("function"===l&&n.exp){const o=n.exp;e++,o.evaluate(database,r,(function(e,n){n&&n._missingNodes?console.log("ERR: Missing nodes: "+JSON.stringify(n._missingNodes)):s.isReference&&"nid"===o.returnType.base?i[s.id]=database.ridOf(n):i[s.id]=s.convert(n),t()}))}else"value"===l?i[s.id]=s.convert(n.value.value):"null"===l&&(i[s.id]=null)}o.push(i)}}function t(){e--,0===e&&setTimeout(p,0)}t()}function p(){$.loading(!1);var i=$('<div class="nx-backplane import-preview">').appendTo($(document.body)),n=t.sorted,a=$('<div style="position:absolute;left:0;bottom:0;right:0;padding:8px;background-color:#fff;border-top:solid 1px #D4D9E9;display:flex;display:-webkit-flex">').appendTo(i);$('<div class="nx-hspace-flex">').appendTo(a),$('<div class="nx-button-text grey">').text(locale.back).appendTo(a).touch(v),$('<div class="nx-hspace-small">').appendTo(a),$('<div class="nx-button-text red">').text(locale.executeUpdate).appendTo(a).touch(y);var s=$('<div style="position:absolute;left:0;top:20px;width:100%;padding:0 16px;box-sizing:border-box;-moz-box-sizing:border-box;text-align:right">').appendTo(i);$('<div style="float:left;height:32px;line-height:32px">').text(locale.importPreview).appendTo(s),s.button("prev",void 0,void 0,f);var r=$('<div style="display:inline-block;height:32px;line-height:32px">').appendTo(s);s.button("next",void 0,void 0,m);var l=$('<div style="position:absolute;left:0;top:68px;width:100%;bottom:51px;overflow:auto">').appendTo(i),d=window.getHeight()-128,h=Math.max(1,Math.floor(d/33)-1),p=0,u=Math.ceil(o.length/h);function f(){--p<0&&(p=u-1),g()}function m(){++p>=u&&(p=0),g()}function g(){r.text(locale.page+" "+(p+1)+" / "+u);for(var e="<table><thead><tr><th>"+htmlEscape(locale.id)+"</th>",t=0;t<n.length;t++){ss(m=n[t])&&(e+="<th>"+htmlEscape(m.caption)+"</th>")}e+="</tr></thead><tbody>";for(var i=p*h,a=Math.min(i+h,o.length),s=i;s<a;s++){var c=o[s];e+="<tr>";var d=c._id,f=database.loadNodeSync(d);e+='<td style="text-align:right">'+htmlEscape(schemas.ridOf(d))+"</td>";for(t=0;t<n.length;t++){var m;if(ss(m=n[t])){var g=c[m.id],v=f?f[m.id]:void 0;e+='<td class="cell-'+m.base+'">',null!=v&&""!==v&&(e+='<div class="import-cell-old">'+htmlEscape(m.format(v))+"</div>"),void 0!==g&&(e+=null===g?'<div class="import-cell-update">'+htmlEscape(locale.empty)+"</div>":'<div class="import-cell-update">'+htmlEscape(m.format(g))+"</div>"),e+="</td>"}}e+="</tr>"}e+="</tbody></table>",l.html(e)}function v(){i.remove()}function y(){i.remove(),$.loading(!0),e.silent=!0,database.updateNodes(o,(function(t){$.loading(!1),e.silent=!1,t&&$.alert(t),c(),e.reload()}))}g()}setTimeout(d,0)}function c(){i.close()}r.value=k.isEmpty(e.midChoosen)?"visible":"selected",r.withoutLabel="true",new qt.a(void 0,r,s).el.css({width:400}),$('<div class="nx-hspace-flex">').appendTo(s),$('<div class="nx-button-text grey" style="margin:8px">').text(locale.cancel).appendTo(s).touch(c),$('<div class="nx-button-text blue" style="margin:8px 8px 8px 0">').text(locale.next).appendTo(s).touch(l)}function ss(e){return(e.isField&&"fn"!==e.base||e.isReference)&&database.canWrite(e)}function rs(){}rs.prototype.destroy=function(){this.hide(),this.el.remove()},rs.prototype.setVisible=function(e){e?this.show():this.hide()},rs.prototype.show=function(e){if(console.log("TableViewRenderer.show",e),!this.visible){this.visible=!0,window.addEventListener("resize",this.resize),database.on("schema",void 0,this.schemaChanged,this),database.on("rename",void 0,this.nodeRenamed,this),database.on("remove",void 0,this.nodeRemoved,this),database.on("create",void 0,this.nodeCreated,this),database.on("admin",void 0,this.adminChanged,this),this.el.appendTo(ui.$body),$.pushInputHandler(this);var t=this.getSelectedNid();t&&this.openEditor(t),ui.recordNavigation.pushController(this),this.didShow(e)}},rs.prototype.didShow=function(e){},rs.prototype.schemaChanged=function(e,t,i){},rs.prototype.hide=function(){console.log("TableViewRenderer.hide"),this.visible&&(this.visible=!1,ui.recordNavigation.popController(this),window.removeEventListener("resize",this.resize),database.off("schema",void 0,this.schemaChanged,this),database.off("rename",void 0,this.nodeRenamed,this),database.off("remove",void 0,this.nodeRemoved,this),database.off("create",void 0,this.nodeCreated,this),database.off("admin",void 0,this.adminChanged,this),$.popInputHandler(this),this.closeEditor(!0),this.el.detach(),this.didHide())},rs.prototype.didHide=function(){},rs.prototype.resize=function(){},rs.prototype.updateUI=function(){},rs.prototype.menuNewViewEnabled=function(){return database.isAdmin()},rs.prototype.menuNewView=function(){database.isAdmin()&&this.tableView.createView()},rs.prototype.menuRenameViewEnabled=function(){return database.isAdmin()},rs.prototype.menuRenameView=function(){database.isAdmin()&&this.tableView.renameView()},rs.prototype.menuDeleteViewEnabled=function(){return database.isAdmin()},rs.prototype.menuDeleteView=function(){database.isAdmin()&&this.tableView.removeView()},rs.prototype.menuEditColumnsEnabled=function(){return database.isAdmin()},rs.prototype.menuEditColumns=function(){database.isAdmin()&&this.tableView.popupColumnMenu()},rs.prototype.menuShowViewAsFormEnabled=function(){return database.isAdmin()},rs.prototype.menuShowViewAsForm=function(){database.isAdmin()&&this.tableView.showForm()},rs.prototype.menuShowViewAsTableEnabled=function(){return database.isAdmin()},rs.prototype.menuShowViewAsTable=function(){database.isAdmin()&&this.tableView.showTable()},rs.prototype.menuShowViewAsChartEnabled=function(){return database.isAdmin()},rs.prototype.menuShowViewAsChart=function(){database.isAdmin()&&this.tableView.showChart()},rs.prototype.hasNextRecord=function(){return this.getQuery().rows.length>0},rs.prototype.nextRecord=function(){this.editorDown()},rs.prototype.hasPrevRecord=function(){return this.getQuery().rows.length>0},rs.prototype.prevRecord=function(){this.editorUp()},rs.prototype.lastRecord=function(){this.editorLast()},rs.prototype.firstRecord=function(){this.editorFirst()},rs.prototype.hasAddRecord=function(){return!(!this.getQuery().type||!database.canCreate(this.getQuery().type))},rs.prototype.addRecord=function(){var e=this;Object(c.a)(this.getQuery().type,(function(t){e.select(t)}))},rs.prototype.hasDuplicateRecord=function(){return!!(this.getSelectedNid()&&this.getQuery().type&&database.canCreate(this.getQuery().type))},rs.prototype.duplicateRecord=function(){var e=this;Object(c.b)(e.getSelectedNid(),(function(t){e.select(t)}))},rs.prototype.hasRemoveRecord=function(){return!!(this.getSelectedNid()&&this.getQuery().type&&database.canDelete(this.getQuery().type))},rs.prototype.removeRecord=function(){Object(c.j)(this.getSelectedNid())},rs.prototype.hasPrintRecord=function(){return!(!this.getSelectedNid()||!1===database.authorizationPrint)},rs.prototype.printRecord=function(){Object(c.i)(this.getSelectedNid())},rs.prototype.getSelectedNid=function(){return this.getQuery().getSelectedNid()},rs.prototype.getSelectedNids=function(){return[]},rs.prototype.getSideEditorOptions=function(){return this.sideEditorOptions||(this.sideEditorOptions={close:$.proxy(this.unselect,this),next:$.proxy(this.editorDown,this),prev:$.proxy(this.editorUp,this),first:$.proxy(this.editorFirst,this),last:$.proxy(this.editorLast,this),duplicate:$.proxy(this.duplicate,this),getSelectedNids:$.proxy(this.getSelectedNids,this)}),this.sideEditorOptions},rs.prototype.select=function(e){e!==this.getSelectedNid()&&this.getQuery().select(e)},rs.prototype.selectionChanged=function(){this.visible&&(ui.recordNavigation.updateUI(),this.openEditor(this.getSelectedNid()),this.updateSelection())},rs.prototype.updateSelection=function(){},rs.prototype.unselect=function(){this.select(void 0)},rs.prototype.toggleGroup=function(e){this.getQuery().toggle(e)},rs.prototype.editorDown=function(){this.getQuery().editorDown()},rs.prototype.editorUp=function(){this.getQuery().editorUp()},rs.prototype.editorLast=function(){this.getQuery().editorLast()},rs.prototype.editorFirst=function(){this.getQuery().editorFirst()},rs.prototype.getQuery=function(){return this.tableView.table},rs.prototype.openEditor=function(e){this.visible&&ui.sideEditor.open(e,this.getSideEditorOptions())},rs.prototype.closeEditor=function(e){ui.sideEditor.close(e)},rs.prototype.queryChanged=function(){},rs.prototype.rowsChanged=function(){},rs.prototype.dataChanged=function(){},rs.prototype.nodeRemoved=function(e,t){},rs.prototype.nodeRenamed=function(e,t,i){},rs.prototype.nodeCreated=function(e,t){},rs.prototype.adminChanged=function(e,t){},rs.prototype.bodyResized=function(){},rs.prototype.keydown=function(e){console.log("TableViewRenderer.keydown",e.which);var t=e.which,i=this.getQuery();switch(t){case 27:i.selectNothing(),e.preventDefault();break;case 32:i.onlyChoosen?i.showAll():k.isEmpty(i.midChoosen)||i.showOnlyChoosen(),e.preventDefault();break;case 33:e.metaKey?i.editorPrevGroup():i.editorPageUp(),e.preventDefault();break;case 34:e.metaKey?i.editorNextGroup():i.editorPageDown(),e.preventDefault();break;case 35:i.editorLast(),e.preventDefault();break;case 36:i.editorFirst(),e.preventDefault();break;case 38:e.metaKey?i.editorFirst(e.shiftKey):e.altKey?i.editorPageUp():i.editorUp(e.shiftKey),e.preventDefault();break;case 40:e.metaKey?i.editorLast(e.shiftKey):e.altKey?i.editorPageDown():i.editorDown(e.shiftKey),e.preventDefault();break;default:(e.metaKey||e.ctrlKey)&&70===t&&(i.openFindMenu(),e.preventDefault())}},rs.prototype.openContextMenu=function(e){this.getQuery().openContextMenu(e)};const ls=1e3;function cs(e){this.visible=e.visible||!1,this.renderHTML=e.render,this.$pane=$('<div class="scrollpane" style="display:'+(this.visible?"":"none")+'">').appendTo(e.$parent),this.$body=$('<div class="scrollpane-body">').appendTo(this.$pane),this.$view=$('<div class="scrollpane-view">').appendTo(this.$body),e.head?(this.$head=$('<div class="scrollpane-head" style="height:'+e.head.height+'px">').appendTo(this.$pane),this.$headView=$('<div class="scrollpane-view">').appendTo(this.$head),this.$body.css("top",e.head.height),this.renderHeadHTML=e.head.render,this.headHeight=e.head.height):this.headHeight=0,e.foot?(this.$foot=$('<div class="scrollpane-foot" style="height:'+e.foot.height+'px">').appendTo(this.$pane),this.$footView=$('<div class="scrollpane-view">').appendTo(this.$foot),this.$body.css("bottom",e.foot.height),this.renderFootHTML=e.foot.render,this.footHeight=e.foot.height):this.footHeight=0,this.createScrollBars(),this.rows=[],this.rowOffsets=[],this.totalHeight=0,this.totalWidth=0,this.viewRow0=0,this.viewRow1=0,this.scrollY=0,this.scrollX=0,this.scrollYTarget=0,this.scrollXTarget=0,this.viewY0=0,this.viewY1=0,this.visibleWidth=100,this.visibleHeight=100,this.leftWidth=0,this.scrollDoneTime=0,this.scrollDoneTimeout=null,this.scrollDone=$.proxy(this.scrollDone,this),this.registerScrollListeners()}function ds(e){var t=this;this.tableView=e,this.visible=!1,this.resize=$.proxy(this.resize,this),this.el=$('<div class="cards-container">').touch($.proxy(this.clicked,this)),this.scrollPane=new cs({$parent:this.el,render:function(e,i){return t.renderHTML(e,i)},head:{height:0,render:function(){return""}},foot:{height:0,render:function(){return""}},left:{width:0,render:function(e,t){return""}},right:{width:0,render:function(e,t){return""}}})}function hs(e){var t=this;window.Chart.defaults.global.maintainAspectRatio=!1,this.visible=!1,this.loading=!1,this.tableView=e,this.el=$('<div style="position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff">'),this.$chart=$('<div style="position:absolute;top:16px;bottom:32px;left:16px;right:216px">').appendTo(this.el),this.$message=$('<div style="text-align:center;font-size:18px;padding:48px;color:#777">').appendTo(this.$chart),this.$canvas=$('<canvas style="position:absolute;top:0;left:0;width:100%;height:100%"></canvas>').appendTo(this.$chart),this.$pane=$('<div style="position:absolute;top:0;bottom:0;right:0;width:200px;background-color:#fff;border-left:solid 1px #D4D9E9">').appendTo(this.el),this.chartType=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{choiceRenderer:"radio",caption:locale.chartType,formWidth:1,required:!0,values:{bar:{id:"bar",caption:locale.chartBar,order:1},line:{id:"line",caption:locale.chartLine,order:2},pie:{id:"pie",caption:locale.chartPie,order:3},doughnut:{id:"doughnut",caption:locale.chartDoughnut,order:4},polarArea:{id:"polarArea",caption:locale.chartPolarArea,order:5},radar:{id:"radar",caption:locale.chartRadar,order:6},bubble:{id:"bubble",caption:locale.chartBubble,order:7}}})),this.chartType.on("update",(function(){t.settingsChanged()})),this.chartTypeField=new qt.a(void 0,this.chartType,this.$pane),this.chartDatasets=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{choiceRenderer:"radio",caption:locale.chartDatasets,formWidth:1,required:!0,values:{cols:{id:"cols",caption:locale.chartDatasetsCols,order:1},rows:{id:"rows",caption:locale.chartDatasetsRows,order:2}}})),this.chartDatasets.on("update",(function(){t.settingsChanged()})),this.chartDatasetsField=new qt.a(void 0,this.chartDatasets,this.$pane),this.chartStacked=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{booleanRenderer:"check",caption:locale.chartStacked,formWidth:1,required:!0})),this.chartStacked.withoutLabel=!0,this.chartStacked.on("update",(function(){t.settingsChanged()})),this.chartStackedField=new qt.a(void 0,this.chartStacked,this.$pane),this.chartLineTension=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{booleanRenderer:"check",caption:locale.chartLineTension,formWidth:1,required:!0})),this.chartLineTension.withoutLabel=!0,this.chartLineTension.on("update",(function(){t.settingsChanged()})),this.chartLineTensionField=new qt.a(void 0,this.chartLineTension,this.$pane),$('<div class="nx-button-text grey">').text(locale.showHideColumns).appendTo($('<div style="padding:0 12px">').appendTo(this.$pane)).touch((function(){e.popupColumnMenu()})),$('<div class="nx-button-text blue">').text(locale.saveImage+"...").appendTo($('<div style="padding:8px 12px 0px 12px">').appendTo(this.$pane)).click($.proxy(this.saveImage,this))}function ps(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function us(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ps(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ps(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function fs(e){this.tableView=e,this.visible=!1,this.el=$('<div class="fullform">'),this.tabsEl=$('<div class="popupeditor2-tabs">').appendTo(this.el),this.editor=void 0}function ms(e){var t=this;this.visible=e.visible||!1,this.renderHTML=e.render,this.leftWidth=0,this.footHeight=0,this.headHeight=0,this.scrollDoneTime=0,this.scrollDoneTimeout=null,this.scrollDone=$.proxy(this.scrollDone,this),this.$pane=$('<div class="scrollpane" style="display:'+(this.visible?"":"none")+'">').appendTo(e.$parent),this.$body=$('<div class="scrollpane-body">').appendTo(this.$pane),this.$view=$('<div class="scrollpane-view">').appendTo(this.$body),e.head&&(this.$head=$('<div class="scrollpane-head" style="height:'+e.head.height+'px">').appendTo(this.$pane),this.$headView=$('<div class="scrollpane-view">').appendTo(this.$head),this.$body.css("top",e.head.height),this.renderHeadHTML=e.head.render,this.headHeight=e.head.height),e.foot&&(this.$foot=$('<div class="scrollpane-foot" style="height:'+e.foot.height+'px">').appendTo(this.$pane),this.$footView=$('<div class="scrollpane-view">').appendTo(this.$foot),this.$body.css("bottom",e.foot.height),this.renderFootHTML=e.foot.render,this.footHeight=e.foot.height),e.left&&(this.$left=$('<div class="scrollpane-left" style="width:'+e.left.width+'px">').appendTo(this.$pane),this.$leftView=$('<div class="scrollpane-view">').appendTo(this.$left),this.$body.css("left",e.left.width),this.$head.css("left",e.left.width),this.$foot.css("left",e.left.width),this.renderLeftHTML=e.left.render,e.head&&(this.renderLeftHeadHTML=e.left.renderHead,this.$left.css("top",e.head.height),this.$leftHead=$('<div class="scrollpane-left-head" style="width:'+e.left.width+"px;height:"+e.head.height+'px">').appendTo(this.$pane),this.$leftHeadView=$('<div class="scrollpane-view">').appendTo(this.$leftHead)),e.foot&&(this.renderLeftFootHTML=e.left.renderFoot,this.$left.css("bottom",e.foot.height),this.$leftFoot=$('<div class="scrollpane-left-foot" style="width:'+e.left.width+"px;height:"+e.foot.height+'px">').appendTo(this.$pane),this.$leftFootView=$('<div class="scrollpane-view">').appendTo(this.$leftFoot)),this.leftWidth=e.left.width,!1!==e.leftDivider&&(this.$leftDivider=$('<div class="scrollpane-divider" style="left:'+e.left.width+'px">').appendTo(this.$pane).nxdraggable({dragStart:function(e){this.w0=t.leftWidth},drag:function(e){t.setLeftWidth(this.w0+(e.x2-e.x0))},dragEnd:function(e){t.leftWidthChanged()}}))),this.$scrollbarVContainer=$('<div class="t-scrollbar-v-container" style="top:0;bottom:0">').appendTo(this.$pane),this.$scrollbarV=$('<div class="t-scrollbar-v">').appendTo(this.$scrollbarVContainer),this.$scrollbarHContainer=$('<div class="t-scrollbar-h-container" style="left:0;bottom:0">').appendTo(this.$pane),this.$scrollbarH=$('<div class="t-scrollbar-h">').appendTo(this.$scrollbarHContainer),this.modX=e.modX,this.modY=e.modY,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.scrollX=0,this.scrollY=0,this.translateX=0,this.translateY=0,this.scrollXTarget=0,this.scrollYTarget=0,this.viewX0=0,this.viewX1=0,this.viewY0=0,this.viewY1=0,this.visibleWidth=100,this.visibleHeight=100,this.viewPaddingX=e.viewPaddingX||200,this.viewPaddingY=e.viewPaddingY||200,this.registerScrollListeners()}cs.prototype.hide=function(){this.visible&&(this.visible=!1,this.$pane[0].style.display="none")},cs.prototype.show=function(){this.visible||(this.visible=!0,this.$pane[0].style.display="",this.rerender())},cs.prototype.destroy=function(){this.$pane.remove()},cs.prototype.setMetrics=function(e,t){this.rows=e,this.totalWidth=t,this.updateRowOffsets(),this.visible&&this.rerender()},cs.prototype.rerender=function(){this.resize(),this.renderHead(),this.renderFoot(),this.updateView(!0)},cs.prototype.resize=function(){var e=this.$body[0];this.visibleWidth=e.clientWidth,this.visibleHeight=e.clientHeight},cs.prototype.updateRowOffsets=function(){for(var e=this.rows,t=[],i=0,o=0;o<e.length;o++){var n=e[o];t[o]=i,i+=n}this.rowOffsets=t,this.totalHeight=i},cs.prototype.scrollTo=function(e,t){this.scrollYTarget=Math.max(0,Math.min(t,this.totalHeight-this.visibleHeight)),this.scrollXTarget=null!=this.totalWidth?Math.max(0,Math.min(e,this.totalWidth-this.visibleWidth)):e,this.startAnimation()},cs.prototype.startAnimation=function(){this.scrollX=this.scrollXTarget,this.scrollY=this.scrollYTarget,this.updateView(!1)},cs.prototype.updateView=function(e){var t=this.visibleHeight,i=this.visibleWidth,o=this.totalHeight,n=this.totalWidth,a=this.viewY0,s=this.viewY1,r=this.scrollY,l=this.scrollX,c=r+t;null!=n&&l+i>n&&(l=Math.max(0,n-i),this.scrollX=l),(e||r<a||c>s&&c<=o)&&(this.rerenderView(),a=this.viewY0,s=this.viewY1);var d=-l,h=-r+a;this.$view[0].style.transform=this.$view[0].style.webkitTransform="translate3d("+d+"px,"+h+"px,0px)",this.$headView&&(this.$headView[0].style.transform=this.$headView[0].style.webkitTransform="translate3d("+d+"px,0px,0px)"),this.$footView&&(this.$footView[0].style.transform=this.$footView[0].style.webkitTransform="translate3d("+d+"px,0px,0px)"),this.updateScrollbar(!0)},cs.prototype.rerenderView=function(){this.rows;for(var e=this.rowOffsets,t=this.scrollY,i=this.visibleHeight,o=t-ls,n=t+i+ls,a=0,s=e.length,r=0;r<e.length;r++){if(e[r]>=o){a=r;break}}for(r=a;r<e.length;r++){if(e[r]>n){s=r;break}}this.viewRow0=a,this.viewRow1=s,this.viewY0=e[a],this.viewY1=s<e.length?e[s]:this.totalHeight,this.renderView(a,s)},cs.prototype.renderView=async function(e,t){this.$view[0].innerHTML=await this.renderHTML(e,t)},cs.prototype.renderHead=async function(){this.renderHeadHTML&&(this.$headView[0].innerHTML=await this.renderHeadHTML())},cs.prototype.renderFoot=async function(){this.renderFootHTML&&(this.$footView[0].innerHTML=await this.renderFootHTML())},cs.prototype.registerScrollListeners=function(){TOUCH?(this.registerScrollTouchListeners(),this.registerScrollbarVTouchListeners()):(this.registerScrollMouseListeners(),this.registerScrollbarVMouseListeners(),this.registerScrollbarHMouseListeners())},cs.prototype.registerScrollMouseListeners=function(){var e=this,t=e.$body[0];function i(t){var i=Math.max(0,e.totalHeight-e.visibleHeight),o=null!=e.totalWidth?Math.max(0,e.totalWidth-e.visibleWidth):null,n=(OSX_10_9_MODE?-t.wheelDeltaY:t.deltaY)*(1==t.deltaMode?32:2==t.deltaMode?window.getHeight():1),a=OSX_10_9_MODE?t.wheelDeltaX:-t.deltaX;Math.abs(a)>Math.abs(n)?n=0:a=0;var s=e.scrollY,r=Math.min(Math.max(s+n,0),i),l=null!=o?Math.min(Math.max(0,e.scrollX-a),o):e.scrollX-a;e.scrollTo(l,r),t.preventDefault()}OSX_10_9_MODE?t.addEventListener("mousewheel",i,!1):t.addEventListener("wheel",i,!1)},cs.prototype.registerScrollTouchListeners=function(){var e,t=this,i=0,o=0,n=0,a=0,s=0,r=0,l=0,c=null,d=!1,h=500,p=h*h,u=h/60,f=t.$body[0];function m(){if(d){var e=t.scrollY,i=t.scrollX,o=Math.max(0,t.totalHeight-t.visibleHeight);if(e<0){var n=e-10*e*u/h;Math.abs(n)<.1&&(n=0),t.scrollTo(i,n),requestAnimationFrame(m)}else if(0===e)d=!1;else if(e>o){n=e-10*(e-o)*u/h;Math.abs(n-o)<.1&&(n=o),t.scrollTo(i,n),requestAnimationFrame(m)}else if(e===o)d=!1;else if(l>=h)d=!1;else{var a=1-l*l/p;if(!isNaN(a)){var c=a*s,f=a*r,g=null!=t.totalWidth?Math.min(Math.max(0,i-c),Math.max(0,t.totalWidth-t.visibleWidth)):i-c;n=e-f;t.scrollTo(g,n)}l+=u,requestAnimationFrame(m)}}}f.addEventListener(EVENT_touchstart,(function(t){1===t.touches.length&&(d=!1,i=n=t.touches[0].clientX,o=a=t.touches[0].clientY,e=(new Date).getTime(),c=null)})),f.addEventListener(EVENT_touchmove,(function(e){if(e.touches&&1===e.touches.length){d=!1;var i=e.touches[0].clientX,o=e.touches[0].clientY,s=i-n,r=o-a;c||(c=Math.abs(s)>Math.abs(r)?"H":"V"),"H"===c?r=0:s=0;var l=null!=t.totalWidth?Math.min(Math.max(0,t.scrollX-s),Math.max(0,t.totalWidth-t.visibleWidth)):t.scrollX-s,h=t.scrollY-r;t.scrollTo(l,h),n=i,a=o,e.preventDefault()}})),f.addEventListener(EVENT_touchend,(function(h){if(!h.touches||0===h.touches.length){var p=(new Date).getTime()-e;s="H"===c?(n-i)*u/p:0,r="V"===c?t.scrollY<0?0:(a-o)*u/p:0,l=0,d=!0,requestAnimationFrame(m)}}))},cs.prototype.scrollDone=function(){var e=Date.now(),t=this.scrollDoneTime-e;t<100?(this.$scrollbarV[0].className="t-scrollbar-v",this.$scrollbarH[0].className="t-scrollbar-h",this.scrollDoneTimeout=null):this.scrollDoneTimeout=setTimeout(this.scrollDone,t)},cs.prototype.updateScrollbar=function(e){var t=this.scrollY,i=this.scrollX,o=0,n=0,a=this.totalWidth,s=this.totalHeight-n,r=a-o,l=this.headHeight,c=(this.footHeight,this.leftWidth),d=this.visibleHeight,h=this.visibleWidth,p=s>d,u=r>h,f=d-(u?16:4),m=h-(p?24:12),g=Math.max(32,Math.min(f,Math.round(f*d/s))),v=Math.max(0,Math.min(f-g,Math.round((t-n)/(s-d)*(f-g))))+l+2,y=Math.max(32,Math.min(m,Math.round(m*(h/r)))),b=Math.max(0,Math.min(m-y,Math.round((i-o)/(r-h)*(m-y))))+c+10,w=this.$scrollbarV[0];w.style.top=v+"px",w.style.height=g+"px";var x=this.$scrollbarH[0];x.style.left=b+"px",x.style.width=y+"px",x.style.bottom="2px",e&&(w.className=p?"t-scrollbar-v scrolling":"t-scrollbar-v",x.className=u?"t-scrollbar-h scrolling":"t-scrollbar-h",this.scrollDoneTime=Date.now()+1e3,this.scrollDoneTimeout||(this.scrollDoneTimeout=setTimeout(this.scrollDone,1e3)))},cs.prototype.registerScrollbarVMouseListeners=function(){var e=this;function t(t){t.target;var i=t.clientY,o=e.scrollY,n=e.visibleHeight,a=n-4,s=0,r=e.totalHeight-s,l=r/a;function c(t){var a=t.clientY-i;e.scrollTo(e.scrollX,Math.max(s,Math.min(s+r-n,Math.round(o+l*a)))),t.preventDefault()}function d(e){window.removeEventListener("mousemove",c,!1),window.removeEventListener("mouseup",d,!1),e.preventDefault()}window.addEventListener("mouseup",d,!1),window.addEventListener("mousemove",c,!1),t.preventDefault()}this.$scrollbarV[0].addEventListener("mousedown",t,!1)},cs.prototype.registerScrollbarVTouchListeners=function(){var e=this;function t(t){if(1===t.touches.length){var i=t.touches[0].clientY,o=e.scrollY,n=e.visibleHeight,a=n-4,s=e.totalHeight,r=0,l=s-r,c=l/a;EVENT_target(t).addEventListener(EVENT_touchmove,d,!1),EVENT_target(t).addEventListener(EVENT_touchend,h,!1)}function d(t){if(1===t.touches.length){var a=t.touches[0].clientY-i;e.scrollTo(e.scrollY,Math.max(r,Math.min(r+l-n,Math.round(o+c*a)))),t.preventDefault()}}function h(e){0===e.touches.length&&(EVENT_target(e).removeEventListener(EVENT_touchmove,d,!1),EVENT_target(e).removeEventListener(EVENT_touchend,h,!1),e.preventDefault())}}this.$scrollbarV[0].addEventListener(EVENT_touchstart,t,!1)},cs.prototype.registerScrollbarHMouseListeners=function(){var e=this;function t(t){var i=t.clientX,o=e.scrollX,n=e.visibleWidth,a=n-4,s=0,r=e.totalWidth-s,l=r/a;function c(t){var a=t.clientX-i;e.scrollTo(Math.max(s,Math.min(s+r-n,Math.round(o+l*a))),e.scrollY),t.preventDefault()}function d(e){window.removeEventListener("mousemove",c,!1),window.removeEventListener("mouseup",d,!1),e.preventDefault()}window.addEventListener("mouseup",d,!1),window.addEventListener("mousemove",c,!1),t.preventDefault()}this.$scrollbarH[0].addEventListener("mousedown",t,!1)},cs.prototype.createScrollBars=function(){this.$scrollbarVContainer=$('<div class="t-scrollbar-v-container" style="top:0;bottom:0">').appendTo(this.$pane),this.$scrollbarV=$('<div class="t-scrollbar-v">').appendTo(this.$scrollbarVContainer),this.$scrollbarHContainer=$('<div class="t-scrollbar-h-container" style="left:0;bottom:0">').appendTo(this.$pane),this.$scrollbarH=$('<div class="t-scrollbar-h">').appendTo(this.$scrollbarHContainer)},Object.assign(ds.prototype,rs.prototype),ds.prototype.isCards=!0,ds.prototype.mode="cards",ds.prototype.didShow=function(e){this.updateMetrics(),this.scrollPane.show(e)},ds.prototype.didHide=function(e){this.scrollPane.hide()},ds.prototype.updateUI=function(){this.visible&&this.scrollPane.updateView(!0)},ds.prototype.dataChanged=function(){this.visible&&this.updateUI()},ds.prototype.rowsChanged=function(){this.visible&&this.updateMetrics()},ds.prototype.renderHTML=async function(e,t){var i=Date.now(),o=this.getSelectedNid(),n=this.getQuery();if(!n.ready)return"";var a=n.rows,s=n.cols,r=n.models,l=n.groups||{},c=n.cidxGroup,d=null!=c?s[c]:void 0;if(d&&!d.isReadable)return'<h1 style="padding:16px;margin:0 auto">'+htmlEscape(locale.errorNotAuthorized)+"</h1>";for(var h=d&&d.expression.returnType,p=this.cardsPerRow,u=this.cardMargin,f=this.cardHeight,m=this.cardWidth,g=(t+1)*p,v="",y=0,b=e%2==0?u:0,w=e*p;w<g&&w<a.length;w++){var x=a[w],T=r[x];if(T){var C="position:absolute;width:"+m+"px;height:"+f+"px;left:"+(u+y*(m+u))+"px;top:"+b+"px",k=x===o?" selected":"";v+=await this.renderCard(T,s,c,k,C,!1),++y===p&&(y=0,b+=f+u)}else{var $=l[x];if($){y>0&&(y=0,b+=f+u);var S=$.values[c],_=this.getGroupColor(h,S),E=this.getGroupIcon(h,S),D=!!n.expanded[x];v+='<div class="card-group" style="position:absolute;left:'+u+"px;top:"+b+"px;width:"+(p*(m+u)-u)+"px;background-color:"+_.light+'" data-gid="'+encodeURIComponent($.id)+'"><div class="card-group-expander i-white i-32-24 i-line-'+(D?"down":"right")+'"></div><div class="card-group-title">'+(E?'<div class="card-group-icon ic ic-'+E+'"></div>':"")+'<div class="card-group-label">'+htmlEscape(h.format(S))+'</div></div><div class="card-group-right"></div></div>',y=0,b+=32+u}}}var N=Date.now();return console.log("Cards.renderHTML in "+(N-i)+"ms"),v},ds.prototype.queryLoaded=function(){this.updateMetrics()},ds.prototype.updateMetrics=function(){if(this.visible){var e=this.scrollPane.totalWidth>0?this.scrollPane.scrollX/this.scrollPane.totalWidth:0,t=this.scrollPane.totalHeight>0?this.scrollPane.scrollY/this.scrollPane.totalHeight:0,i=this.getQuery(),o=i.rows,n=i.cols,a=(i.models,i.groups||{}),s=i.cidxGroup,r=16,l=196,c=0,d=32;n.length>0&&"file"===n[0].expression.returnType.base||(c+=16);for(var h=0;h<n.length;h++){if(h!==s)switch(n[h].expression.returnType.base){case"file":c+=128;break;default:c+=24}}n.length>0&&"file"===n[n.length-1].expression.returnType.base||(c+=16);for(var p=ui.bodyWidth+(ui.rightVisible?0:ui.rightWidth),u=this.el[0].clientHeight,f=Math.max(1,Math.floor((p-r)/(l+r))),m=Math.max(l,Math.floor((p-(f+1)*r)/f)),g=[],v=d+r,y=c+r,b=0,w=0,x=0;x<o.length;x++){a[o[x]]?(b>0&&(g[w]=y,w++,b=0),g[w]=v,w++,b=0):(0===b&&(g[w]=y),++b===f&&(b=0,w++))}b>0&&w++,g[w]=r,this.width=p,this.cardMargin=r,this.cardMinWidth=l,this.cardWidth=m,this.cardHeight=c,this.cardsPerRow=f,this.viewRowHeights=g,this.groupRowHeight=v,this.rowHeight=y,this.scrollPane.setMetrics(g,f*m+(f+1)*r);var T=Math.max(0,Math.min(this.scrollPane.totalWidth-p,Math.round(e*this.scrollPane.totalWidth))),C=Math.max(0,Math.min(this.scrollPane.totalHeight-u,Math.round(t*this.scrollPane.totalHeight)));this.scrollPane.scrollTo(T,C)}},ds.prototype.bodyResized=function(){this.visible&&this.updateMetrics()},ds.prototype.clicked=function(e){var t=$(e.target).closest(".card").attr("data-nid");if(t)this.select(t);else{var i=$(e.target).closest(".card-group").attr("data-gid");i&&(i=decodeURIComponent(i),this.toggleGroup(i),this.updateMetrics())}},ds.prototype.renderCard=async function(e,t,i,o,n,a){var s='<div class="card'+(o||"")+'" data-nid="'+e.id+'"'+(n?' style="'+n+'"':"")+">";t.length>0&&"file"===t[0].expression.returnType.base&&(e.values[0]||!a)||(s+='<div class="card-padding-top"></div>');for(var r=0;r<t.length;r++)if(r!==i){var l=t[r];if(l.isReadable){var c=l.field,d=c.base,h=e.values[r],p="",u="",f=0===i?1===r:0===r,m=!f;if(!a||null!=h){switch(d){case"choice":case"dchoice":{m=!1;const t=await new Promise(t=>c.loadValue(e.id,h,t));t&&(p='<div class="card-row-value multicombo-item" style="'+(t.color?"background-color:"+t.color+";color:"+util.contrastingTextColorTo(t.color):"")+'">'+(t.icon?'<div class="choice-symbol ic ic-'+t.icon+'"></div>':"")+"<span>"+htmlEscape(t.caption||"")+"</span></div>");break}case"multi":case"dmulti":m=!1;var g=util.multiDecode(h);if(g){const t=await new Promise(t=>c.loadValues(e.id,(e,i)=>t(i||{})));g.sort((function(e,i){var o=t[e],n=t[i];return o?n?o.order-n.order:-1:0}));for(var v=0;v<g.length;v++){var y=t[g[v]];y&&(p+='<div class="card-row-value multicombo-item" style="margin:0 4px 0 0;'+(y.color?"background-color:"+y.color+";color:"+util.contrastingTextColorTo(y.color):"")+'">'+(y.icon?'<div class="choice-symbol ic ic-'+y.icon+'"></div>':"")+"<span>"+htmlEscape(y.caption||"")+"</span></div>")}}break;case"color":m=!1,h&&(p='<div class="card-row-value" style="width:20px;height:20px;border-radius:10px;margin:2px 0;background-color:'+h+'"></div>');break;case"icon":m=!1,h&&(p='<div class="choice-symbol ic ic-'+h+'"></div>');break;case"styled":m=!1,h&&(p='<div class="card-row-value multicombo-item" style="background-color:'+h.background+";color:"+h.color+'">'+(h.icon?'<div class="choice-symbol ic ic-'+h.icon+'"></div>':"")+"<span>"+htmlEscape(h.text||"")+"</span></div>");break;case"file":if(m=!1,h){var b=database.thumb2URL1(h);b&&(p=" ",u="background-image:url('"+b+"')")}break;default:p='<div class="card-row-value">'+htmlEscape(c.format(h))+"</div>"}s+='<div class="card-row card-row-'+d+(f?" card-header":"")+'"'+(u?' style="'+u+'"':"")+">"+(m?'<div class="card-row-label">'+htmlEscape(l.caption||l.expression.caption)+": </div>":"")+p+"</div>"}}}return t.length>0&&"file"===t[t.length-1].expression.returnType.base&&(e.values[t.length-1]||!a)||(s+='<div class="card-padding-bottom"></div>'),s+="</div>"},ds.prototype.getGroupColor=function(e,t){var i="#D4D5DB";if("choice"===e.base){var o=e.getValues()[t];o&&o.color&&(i=o.color)}else"styled"===e.base&&t&&t.background&&(i=t.background);return{light:i,dark:util.darken(i,.9)}},ds.prototype.getGroupIcon=function(e,t){if("choice"===e.base){var i=e.getValues()[t];return i&&i.icon||void 0}return"styled"===e.base&&t&&t.icon||void 0},ds.prototype.updateSelection=function(){var e=this.getSelectedNid();this.scrollPane.$view.children(".selected").removeClass("selected"),this.scrollPane.$view.children('[data-nid="'+e+'"]').addClass("selected")},hs.prototype.isChart=!0,hs.prototype.mode="chart",hs.prototype.destroy=function(){this.visible&&(this.visible=!1,$.popInputHandler(this)),this.chart&&(this.chart.destroy(),this.chart=void 0),this.el.remove()},hs.prototype.setVisible=function(e){e?this.show():this.hide()},hs.prototype.show=function(){this.visible||(this.visible=!0,$.pushInputHandler(this),this.el.appendTo(ui.$body)),this.loadSettings(),this.updateControls(),this.updateUI()},hs.prototype.hide=function(){this.visible&&(this.visible=!1,this.chart&&(this.chart.destroy(),this.chart=void 0),$.popInputHandler(this),this.el.detach())},hs.prototype.loadSettings=function(){this.loading=!0,this.chartType.setValue(this.tableView.getViewProperty("chartType")||"bar"),this.chartDatasets.setValue(this.tableView.getViewProperty("chartDatasets")||"cols"),this.chartStacked.setValue(this.tableView.getViewProperty("chartStacked")||!1),this.chartLineTension.setValue(this.tableView.getViewProperty("chartLineTension")||!1),this.loading=!1},hs.prototype.saveSettings=function(){this.tableView.setViewProperties({chartType:this.chartType.value,chartDatasets:this.chartDatasets.value,chartStacked:this.chartStacked.value,chartLineTension:this.chartLineTension.value})},hs.prototype.settingsChanged=function(){this.loading||(this.saveSettings(),this.updateControls(),this.updateUI())},hs.prototype.updateControls=function(){var e=this.chartType.value;"bar"===e||"line"===e?this.chartStackedField.show():this.chartStackedField.hide(),"line"===e?this.chartLineTensionField.show():this.chartLineTensionField.hide(),"bubble"!==e?this.chartDatasetsField.show():this.chartDatasetsField.hide()},hs.prototype.updateUI=function(){if(this.visible){this.chart&&(this.chart.destroy(),this.chart=void 0),this.$message.text("");try{this.chart=co({query:this.tableView.table,chartType:this.chartType.value,chartDatasets:this.chartDatasets.value,chartStacked:this.chartStacked.value,chartLineTension:this.chartLineTension.value,animationDuration:1e3,$canvas:this.$canvas}),this.chart.resize()}catch(e){this.$message.text(e)}}},hs.prototype.saveImage=async function(){var e,t=util.escapeFileName(this.tableView.table.type.caption+" "+this.tableView.getViewCaption());try{var i=this.$canvas[0].toDataURL();i||$.alert("Cannot render PNG");var o=i.indexOf(",");if(o<0)return $.alert("Cannot render PNG: Invalid data URL");e=i.substr(o+1),NinoxDocumentInteraction.saveFile(t,"png",(async function(t,i){if(t)return $.alert(t);i&&await localFileSystem.writeURLBase64(i,e)}))}catch(e){return void $.alert(e)}},hs.prototype.menuNewViewEnabled=function(){return database.isAdmin()},hs.prototype.menuNewView=function(){database.isAdmin()&&this.tableView.createView()},hs.prototype.menuRenameViewEnabled=function(){return database.isAdmin()},hs.prototype.menuRenameView=function(){database.isAdmin()&&this.tableView.renameView()},hs.prototype.menuDeleteViewEnabled=function(){return database.isAdmin()},hs.prototype.menuDeleteView=function(){database.isAdmin()&&this.tableView.removeView()},hs.prototype.menuEditColumnsEnabled=function(){return database.isAdmin()},hs.prototype.menuEditColumns=function(){database.isAdmin()&&this.tableView.popupColumnMenu()},hs.prototype.menuShowViewAsFormEnabled=function(){return database.isAdmin()},hs.prototype.menuShowViewAsForm=function(){database.isAdmin()&&this.tableView.showForm()},hs.prototype.menuShowViewAsTableEnabled=function(){return database.isAdmin()},hs.prototype.menuShowViewAsTable=function(){database.isAdmin()&&this.tableView.showTable()},hs.prototype.menuShowViewAsChartEnabled=function(){return database.isAdmin()},hs.prototype.menuShowViewAsChart=function(){database.isAdmin()&&this.tableView.showChart()},hs.prototype.selectionChanged=function(){},hs.prototype.queryLoaded=function(){this.visible&&this.updateUI()},hs.prototype.dataChanged=function(){this.visible&&this.updateUI()},hs.prototype.rowsChanged=function(){this.visible&&this.updateUI()},hs.prototype.bodyResized=function(){this.visible&&this.chart&&this.chart.resize()},Object.assign(fs.prototype,rs.prototype),fs.prototype.mode="full",fs.prototype.didShow=function(){this.updateTools(),ui.on("widgets.tools.updated",this.updateTools,this)},fs.prototype.didHide=function(e){ui.off("widgets.tools.updated",this.updateTools,this),this.updateTools(),this.editor&&(this.editor.destroy(),this.editor=void 0)},fs.prototype.nodeRenamed=function(e,t,i){},fs.prototype.nodeRemoved=function(e,t){},fs.prototype.schemaChanged=function(e,t,i){this.visible&&this.updateStructure()},fs.prototype.adminChanged=function(e,t){this.visible&&this.updateStructure()},fs.prototype.updateStructure=function(){if(this.visible){var e=this;if(e.editor){e.editor.updateStructure();var t=e.getSelectedNid();t!==Tt().nid&&vt(us({},Tt(),{nid:t})),database.loadNode(t,(function(t,i){e.editor.bind(i)}))}e.updateTools()}},fs.prototype.updateBackground=function(e){var t=util.luminosity(e)<.5;this.el.css("background-color",e||"#FFF"),this.el.toggleClass("darkmode",t)},fs.prototype.createEditor=function(e){this.editor&&this.editor.tid!==e&&(this.editor.destroy(),this.editor=void 0),this.editor||(this.editor=new Ao(this,e,{},void 0))},fs.prototype.editorTabChanged=function(e){const t=Tt();t.tabId!==e&&vt(us({},t,{tabId:e}))},fs.prototype.destroyEditor=function(){console.log("FullForm.destroyEditor"),this.editor&&(this.editor.destroy(),this.editor=void 0)},fs.prototype.openEditor=function(e){if(this.visible){var t=this;if(e){var i=(t._loadingId||0)+1;t._loadingId=i,console.log("FullForm.openEditor: "+e,i),$.loading(!0),database.loadNode(e,(function(o,n){$.loading(!1),console.log("FullForm.openEditor: "+e,i," go on ",t._loadingId),t._loadingId===i&&(t.createEditor(schemas.tidOf(e)),e===t.getSelectedNid()&&(n?(t.editor.bind(n),e!==Tt().nid&&vt(us({},Tt(),{nid:e}))):t.destroyEditor()))}))}else t.destroyEditor()}},fs.prototype.queryLoaded=function(){this.visible&&(this.getSelectedNid()||this.editorFirst())},fs.prototype.isOnTop=function(){return!widgets.popupEditorStack.length},fs.prototype.showTools=Vo.prototype.showTools,fs.prototype.hideTools=Vo.prototype.hideTools,fs.prototype.updateTools=function(){database.adminMode&&this.visible&&this.isOnTop()?this.showTools():this.hideTools()},Object.assign(ms.prototype,util.events),ms.prototype.hide=function(){this.visible&&(this.visible=!1,this.$pane[0].style.display="none")},ms.prototype.show=function(){this.visible||(this.visible=!0,this.$pane[0].style.display="",this.rerender())},ms.prototype.destroy=function(){this.$pane.remove()},ms.prototype.setMetrics=function(e,t,i,o){this.minX=e,this.minY=t,this.maxX=i,this.maxY=o,this.visible&&this.rerender()},ms.prototype.rerender=function(){this.resize(),this.updateView(!0)},ms.prototype.resize=function(){var e=this.$body[0];this.visibleWidth=e.clientWidth,this.visibleHeight=e.clientHeight,this.updateScrollbar(!0)},ms.prototype.scrollTo=function(e,t){this.scrollXTarget=Math.max(this.minX,Math.min(e,this.maxX-this.visibleWidth)),this.scrollYTarget=Math.max(this.minY,Math.min(t,this.maxY-this.visibleHeight)),this.startAnimation()},ms.prototype.startAnimation=function(){this.scrollX=this.scrollXTarget,this.scrollY=this.scrollYTarget,this.updateView(!1)},ms.prototype.updateView=function(e){this.scrollX<this.minX&&(this.scrollX=this.minX),this.scrollX+this.visibleWidth>this.maxX&&(this.scrollX=Math.max(this.minX,this.maxX-this.visibleWidth)),this.scrollY<this.minY&&(this.scrollY=this.minY),this.scrollY+this.visibleHeight>this.maxY&&(this.scrollY=Math.max(this.minY,this.maxY-this.visibleHeight)),(e||this.scrollY<this.viewY0||this.scrollY+this.visibleHeight>this.viewY1||this.scrollX<this.viewX0||this.scrollX+this.visibleWidth>this.viewX1)&&this.renderView();var t=-this.scrollX+this.viewX0,i=-this.scrollY+this.viewY0;this.translateX=t,this.translateY=i,this.$view[0].style.transform=this.$view[0].style.webkitTransform="translate3d("+t+"px,"+i+"px,0px)",this.$headView&&(this.$headView[0].style.transform=this.$headView[0].style.webkitTransform="translate3d("+t+"px,0px,0px)"),this.$footView&&(this.$footView[0].style.transform=this.$footView[0].style.webkitTransform="translate3d("+t+"px,0px,0px)"),this.$leftView&&(this.$leftView[0].style.transform=this.$leftView[0].style.webkitTransform="translate3d(0px,"+i+"px,0px)"),this.updateScrollbar(!0)},ms.prototype.renderView=async function(){var e=this.scrollX-this.viewPaddingX,t=this.scrollX+this.visibleWidth+this.viewPaddingX,i=this.scrollY-this.viewPaddingY,o=this.scrollY+this.visibleHeight+this.viewPaddingY;e-=e%this.modX,i-=i%this.modY,this.viewX0=e,this.viewY0=i,this.viewX1=t,this.viewY1=o,this.$view[0].innerHTML=await this.renderHTML(this.viewX0,this.viewY0,this.viewX1,this.viewY1),this.renderLeftHeadHTML&&(this.$leftHeadView[0].innerHTML=await this.renderLeftHeadHTML()),this.renderLeftFootHTML&&(this.$leftFootView[0].innerHTML=await this.renderLeftFootHTML()),this.renderLeftHTML&&(this.$leftView[0].innerHTML=await this.renderLeftHTML(this.viewY0,this.viewY1)),this.renderHeadHTML&&(this.$headView[0].innerHTML=await this.renderHeadHTML(this.viewX0,this.viewX1)),this.renderFootHTML&&(this.$footView[0].innerHTML=await this.renderFootHTML(this.viewX0,this.viewX1))},ms.prototype.registerScrollListeners=function(){TOUCH?(this.registerScrollTouchListeners(),this.registerScrollbarVTouchListeners()):(this.registerScrollMouseListeners(),this.registerScrollbarVMouseListeners(),this.registerScrollbarHMouseListeners())},ms.prototype.registerScrollMouseListeners=function(){var e=this,t=e.$pane[0];function i(t){var i=e.minX,o=e.minY,n=Math.max(e.minX,e.maxX-e.visibleWidth),a=Math.max(e.minY,e.maxY-e.visibleHeight),s=(OSX_10_9_MODE?-t.wheelDeltaY:t.deltaY)*(1==t.deltaMode?32:2==t.deltaMode?window.getHeight():1),r=OSX_10_9_MODE?-t.wheelDeltaX:t.deltaX;Math.abs(r)>Math.abs(s)?s=0:r=0;var l=e.scrollY,c=Math.min(Math.max(l+s,o),a),d=e.scrollX,h=Math.min(Math.max(d+r,i),n);e.scrollTo(h,c),t.preventDefault()}OSX_10_9_MODE?t.addEventListener("mousewheel",i,!1):t.addEventListener("wheel",i,!1)},ms.prototype.registerScrollTouchListeners=function(){var e,t=this,i=0,o=0,n=0,a=0,s=0,r=0,l=0,c=null,d=!1,h=500,p=h*h,u=h/60,f=t.$pane[0];function m(){if(d){var e=t.scrollY,i=t.scrollX,o=Math.max(0,t.totalHeight-t.visibleHeight);if(e<0){var n=e-10*e*u/h;Math.abs(n)<.1&&(n=0),t.scrollTo(i,n),requestAnimationFrame(m)}else if(0===e)d=!1;else if(e>o){n=e-10*(e-o)*u/h;Math.abs(n-o)<.1&&(n=o),t.scrollTo(i,n),requestAnimationFrame(m)}else if(e===o)d=!1;else if(l>=h)d=!1;else{var a=1-l*l/p;if(!isNaN(a)){var c=a*s,f=a*r,g=null!=t.totalWidth?Math.min(Math.max(0,i-c),Math.max(0,t.totalWidth-t.visibleWidth)):i-c;n=e-f;t.scrollTo(g,n)}l+=u,requestAnimationFrame(m)}}}f.addEventListener(EVENT_touchstart,(function(t){1===t.touches.length&&(d=!1,i=n=t.touches[0].clientX,o=a=t.touches[0].clientY,e=(new Date).getTime(),c=null)})),f.addEventListener(EVENT_touchmove,(function(e){if(e.touches&&1===e.touches.length){d=!1;var i=e.touches[0].clientX,o=e.touches[0].clientY,s=i-n,r=o-a;c||(c=Math.abs(s)>Math.abs(r)?"H":"V"),"H"===c?r=0:s=0;var l=t.scrollX-s,h=t.scrollY-r;t.scrollTo(l,h),n=i,a=o,e.preventDefault()}})),f.addEventListener(EVENT_touchend,(function(h){if(!h.touches||0===h.touches.length){var p=(new Date).getTime()-e;s="H"===c?(n-i)*u/p:0,r="V"===c?t.scrollY<0?0:(a-o)*u/p:0,l=0,d=!0,requestAnimationFrame(m)}}))},ms.prototype.setLeftWidth=function(e){e>32&&e<this.$pane[0].clientWidth-32&&(this.leftWidth=e,this.$left.css("width",e),this.$leftHead.css("width",e),this.$leftFoot.css("width",e),this.$head.css("left",e),this.$foot.css("left",e),this.$body.css("left",e),this.$leftDivider&&this.$leftDivider.css("left",e))},ms.prototype.leftWidthChanged=function(){this.trigger("leftWidthChanged")},ms.prototype.updateScrollbar=function(e){var t=this.scrollY,i=this.scrollX,o=this.minX,n=this.minY,a=this.maxX,s=this.maxY-n,r=a-o,l=this.headHeight,c=(this.footHeight,this.leftWidth),d=this.visibleHeight,h=this.visibleWidth,p=s>d,u=r>h,f=d-4,m=h-(p?24:12),g=Math.max(32,Math.min(f,Math.round(f*d/s))),v=Math.max(0,Math.min(f-g,Math.round((t-n)/(s-d)*(f-g))))+l+2,y=Math.max(32,Math.min(m,Math.round(m*(h/r)))),b=Math.max(0,Math.min(m-y,Math.round((i-o)/(r-h)*(m-y))))+c+10,w=this.$scrollbarV[0];w.style.top=v+"px",w.style.height=g+"px";var x=this.$scrollbarH[0];x.style.left=b+"px",x.style.width=y+"px",x.style.bottom="2px",e&&(w.className=p?"t-scrollbar-v scrolling":"t-scrollbar-v",x.className=u?"t-scrollbar-h scrolling":"t-scrollbar-h",this.scrollDoneTime=Date.now()+1e3,this.scrollDoneTimeout||(this.scrollDoneTimeout=setTimeout(this.scrollDone,1e3)))},ms.prototype.scrollDone=function(){var e=Date.now(),t=this.scrollDoneTime-e;t<100?(this.$scrollbarV[0].className="t-scrollbar-v",this.$scrollbarH[0].className="t-scrollbar-h",this.scrollDoneTimeout=null):this.scrollDoneTimeout=setTimeout(this.scrollDone,t)},ms.prototype.registerScrollbarVMouseListeners=function(){var e=this;function t(t){t.target;var i=t.clientY,o=e.scrollY,n=e.visibleHeight,a=n-4,s=e.maxY,r=e.minY,l=s-r,c=l/a;function d(t){var a=t.clientY-i;e.scrollTo(e.scrollX,Math.max(r,Math.min(r+l-n,Math.round(o+c*a)))),t.preventDefault()}function h(e){window.removeEventListener("mousemove",d,!1),window.removeEventListener("mouseup",h,!1),e.preventDefault()}window.addEventListener("mouseup",h,!1),window.addEventListener("mousemove",d,!1),t.preventDefault()}this.$scrollbarV[0].addEventListener("mousedown",t,!1)},ms.prototype.registerScrollbarVTouchListeners=function(){var e=this;function t(t){if(1===t.touches.length){var i=t.touches[0].clientY,o=e.scrollY,n=e.visibleHeight,a=n-4,s=e.maxY,r=e.minY,l=s-r,c=l/a;EVENT_target(t).addEventListener(EVENT_touchmove,d,!1),EVENT_target(t).addEventListener(EVENT_touchend,h,!1)}function d(t){if(1===t.touches.length){var a=t.touches[0].clientY-i;e.scrollTo(e.scrollY,Math.max(r,Math.min(r+l-n,Math.round(o+c*a)))),t.preventDefault()}}function h(e){0===e.touches.length&&(EVENT_target(e).removeEventListener(EVENT_touchmove,d,!1),EVENT_target(e).removeEventListener(EVENT_touchend,h,!1),e.preventDefault())}}this.$scrollbarV[0].addEventListener(EVENT_touchstart,t,!1)},ms.prototype.registerScrollbarHMouseListeners=function(){var e=this;function t(t){var i=t.clientX,o=e.scrollX,n=e.visibleWidth,a=n-4,s=e.minX,r=e.maxX-s,l=r/a;function c(t){var a=t.clientX-i;e.scrollTo(Math.max(s,Math.min(s+r-n,Math.round(o+l*a))),e.scrollY),t.preventDefault()}function d(e){window.removeEventListener("mousemove",c,!1),window.removeEventListener("mouseup",d,!1),e.preventDefault()}window.addEventListener("mouseup",d,!1),window.addEventListener("mousemove",c,!1),t.preventDefault()}this.$scrollbarH[0].addEventListener("mousedown",t,!1)};const gs=1,vs=1e3,ys=60*vs,bs=60*ys,ws=24*bs,xs=7*ws,Ts=30*ws,Cs=365*ws,ks=40,$s=40,Ss=44;function _s(e){var t=this;this.tableView=e,this.visible=!1,this.resize=$.proxy(this.resize,this),this.el=$('<div class="gantt-container">'),this.$controls=$('<div class="hud-menu-group">'),this.$smallControlsContainer=$('<div class="gantt-controls">'),this.zoom=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:"Zoom",required:!0,choiceRenderer:"switch",values:{hours:{id:"hours",caption:locale.hours,order:1},days:{id:"days",caption:locale.days,order:2},weeks:{id:"weeks",caption:locale.weeks,order:3},months:{id:"months",caption:locale.months,order:4},years:{id:"years",caption:locale.years,order:5}}}),"years"),this.zoom.on("update",this.zoomUpdated,this),this.zoom.withoutLabel=!0,this.zoomField=new qt.a(this,this.zoom,this.$controls),this.zoomField.el.css("width",""),this.$pane=$('<div class="gantt-pane">').appendTo(this.el).touch($.proxy(this.clicked,this)),this.cidxMode="date",this.cidxStart=-1,this.cidxEnd=-1,this.scale=void 0;var i=NinoxDocumentInteraction.getUserDefault("ui.gantt.leftWidth"),o=i?parseInt(i):200;isNaN(o)&&(o=200),this.scrollPane=new ms({viewPaddingX:400,viewPaddingY:400,modX:100,modY:ks,$parent:this.$pane,render:function(e,i,o,n){return t.renderHTML(e,i,o,n)},head:{height:ks,render:function(e,i){return t.renderHeadHTML(e,i)}},foot:{height:0,render:function(){return""}},left:{width:o,render:function(e,i){return t.renderLeftHTML(e,i)},renderHead:function(){return t.renderLeftHeadHTML()}},right:{width:0,render:function(e,t){return""}}}),this.scrollPane.$leftHeadView.nxdraggable({selector:".t-head-resizer",dragStart:function(e){this.cidx=e.$el.closest(".t-head-cell").attr("data-cidx");var i=t.getQuery().cols[this.cidx];this.width0=i.width},drag:function(e){t.getQuery().cols[this.cidx].width=Math.max(ks,this.width0+(e.x2-e.x0)),t.resizeColumns()}}),this.scrollPane.$leftHeadView.nxdraggable({selector:".t-head-cell",dismiss:".t-head-resizer",dragStart:function(e){this.cidx=e.$el.attr("data-cidx");t.getQuery().cols[this.cidx]},drag:function(e){t.getQuery().cols[this.cidx]},click:function(e){}}),this.scrollPane.$leftHeadView.touch((function(e){var i=$(e.target);if(!i.is(".t-head-resizer"))return i.closest(".t-head-cell").length?(t.tableView.table.touchHead(e),!1):i.is(".i-reload")?(t.getQuery().reload(),!1):void 0})),this.scrollPane.$view.nxdraggable({selector:TOUCH?".gantt-row-grab,.gantt-row-bar,.gantt-row-square":void 0,dragStart:function(e){this.direction=void 0;var i=e.$el.closest(".gantt-row");if(i.length&&(this.nid=i.attr("data-nid"),this.ridx=parseInt(i.attr("data-ridx")),this.nid)){var o=t.getQuery(),n=o.models[this.nid];if(n){if(this.startEditable=o.isEditable(t.cidxStart,this.ridx),this.endEditable=o.isEditable(t.cidxEnd,this.ridx),null==t.getStartValue(n)&&null==t.getEndValue(n)){if(!this.startEditable||!this.endEditable)return;this.direction="create",$('<div class="gantt-row-bar">').appendTo(i).css({left:e.x0-t.scrollPane.$view.offset().left,width:0})}else{if(this.direction=this.startEditable&&e.$el.is(".gantt-row-grab-left")?"left":this.endEditable&&e.$el.is(".gantt-row-grab-right")?"right":(this.startEditable||this.endEditable)&&e.$el.is(".gantt-row-bar,.gantt-row-arrow-right,.gantt-row-arrow-left")||(this.startEditable||this.endEditable)&&e.$el.closest(".gantt-row-square").length?"drag":void 0,!this.direction)return;i.find(".gantt-row-bar-label").css("display","none")}var a=i.find(".gantt-row-bar,.gantt-row-square,.gantt-row-arrow-right,.gantt-row-arrow-left");this.$bar=a,this.left0=parseInt(a.css("left")),this.width0=parseInt(a.css("width"))}}},drag:function(e){this.direction&&("left"===this.direction?this.$bar.css({left:this.left0+e.x2-e.x0,width:this.width0+e.x0-e.x2}):"right"===this.direction?this.$bar.css({width:this.width0+e.x2-e.x0}):"drag"===this.direction?this.$bar.css({left:this.left0+e.x2-e.x0}):"create"===this.direction&&this.$bar.css({width:this.width0+e.x2-e.x0}))},dragEnd:function(e){if(this.direction){e.$el.closest(".gantt-row").find(".gantt-row-bar-label").css("display","");var i=t.getQuery();if("drag"===this.direction){var o=(e.x2-e.x0)/t.scale.timeZoom;if(!(d=i.cols[t.cidxStart])||!d.directFid)return;if(!(h=i.cols[t.cidxEnd])||!h.directFid)return;if(!(p=i.models[this.nid]))return;var n=t.getStartValue(p),a=t.getEndValue(p),s=null!=n?n+o:void 0,r=null!=a?a+o:void 0,l=d.expression.returnType.base,c=d.expression.returnType.base;"date"===l&&(s=Ns(s).getTime()),"date"===c&&(r=Ns(r).getTime()),"appointment"===t.cidxMode?database.update(this.nid,d.directFid,s+"/"+(r-s)):(null==s||isNaN(s)||database.update(this.nid,d.directFid,s),null==r||isNaN(r)||database.update(this.nid,h.directFid,r))}else if("create"===this.direction){var d,h;if(!(d=i.cols[t.cidxStart])||!d.directFid)return;if(!(h=i.cols[t.cidxEnd])||!h.directFid)return;if(!(p=i.models[this.nid]))return;s=t.pixelToTime(e.x0),r=t.pixelToTime(e.x2),l=d.expression.returnType.base,c=d.expression.returnType.base;"date"===l&&(s=Ns(s).getTime()),"date"===c&&(r=Ns(r).getTime()),"appointment"===t.cidxMode?database.update(this.nid,d.directFid,s+"/"+(r-s)):(null==s||isNaN(s)||database.update(this.nid,d.directFid,s),null==r||isNaN(r)||database.update(this.nid,h.directFid,r))}else if("appointment"===t.cidxMode){var p,u=t.cidxStart;if(!(b=i.cols[u])||!b.directFid)return;if(!(p=i.models[this.nid]))return;var f=p.values[u];if(!f)return;var m=f.split("/"),g=parseInt(m[0]),v=g+parseInt(m[1]),y=t.pixelToTime(e.x2);"left"===this.direction?y<=v?database.update(this.nid,b.directFid,y+"/"+(v-y)):database.update(this.nid,b.directFid,v+"/"+(y-v)):"right"===this.direction&&(y>=g?database.update(this.nid,b.directFid,g+"/"+(y-g)):database.update(this.nid,b.directFid,y+"/"+(g-y)))}else{var b;u="left"===this.direction?t.cidxStart:t.cidxEnd;if(!(b=i.cols[u])||!b.directFid)return;var w=b.expression.returnType.base;"date"===w?y=t.pixelToDate(e.x2).getTime():"appointment"===w||(y=t.pixelToTime(e.x2)),null==y||isNaN(y)||database.update(this.nid,b.directFid,y)}}}}),TOUCH||(this.scrollPane.$body[0].addEventListener("mouseover",(function(e){var i=t.scrollPane.$view[0].childNodes,o=i[i.length-2];o&&(o.style.display="")})),this.scrollPane.$body[0].addEventListener("mouseleave",(function(e){var i=t.scrollPane.$view[0].childNodes,o=i[i.length-2];o&&(o.style.display="none")})),this.scrollPane.$body[0].addEventListener("mousemove",(function(e){var i=t.scrollPane.$view[0].childNodes,o=i[i.length-2];o&&(o.style.left=e.clientX-t.scrollPane.$view.offset().left+"px")}))),this.scrollPane.$body[0].addEventListener("contextmenu",$.proxy(this.openContextMenu,this),!1),this.scrollPane.$head[0].addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.scrollPane.$foot[0].addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.scrollPane.on("leftWidthChanged",(function(){NinoxDocumentInteraction.setUserDefault("ui.gantt.leftWidth",String(t.scrollPane.leftWidth))})),this.registerMouseListeners()}function Es(e,t){var i=Ds(new Date(e),t),o=Is(i,t),n=i.getTime();return n/t+(e-n)/(o.getTime()-n)}function Ds(e,t){switch(t){case gs:return new Date(e.getTime());case vs:return new Date(Math.floor(e.getTime()/vs)*vs);case ys:return new Date(Math.floor(e.getTime()/ys)*ys);case bs:return new Date(Math.floor(e.getTime()/bs)*bs);case ws:return new Date(e.getFullYear(),e.getMonth(),e.getDate());case xs:return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()+locale.firstDayOfWeek);case Ts:return new Date(e.getFullYear(),e.getMonth(),1);case Cs:return new Date(e.getFullYear(),0,1);default:throw new Error("Illegal scale configuration.")}}function Ns(e,t){var i=new Date(e);return new Date(i.getFullYear(),i.getMonth(),i.getDate()+(t||0))}function Is(e,t){switch(t){case gs:return new Date(e.getTime()+1);case vs:return new Date(e.getTime()+vs);case ys:return new Date(e.getTime()+ys);case bs:return new Date(e.getTime()+bs);case ws:return new Date(e.getFullYear(),e.getMonth(),e.getDate()+1);case xs:return new Date(e.getFullYear(),e.getMonth(),e.getDate()+7);case Ts:return new Date(e.getFullYear(),e.getMonth()+1,1);case Cs:return new Date(e.getFullYear()+1,0,1);default:throw new Error("Invalid state")}}function Os(e){switch(this.scale){case gs:case vs:return util.formatDate(e,"hh:mm:ss");case ys:case bs:return util.formatDate(e,"hh:mm");case ws:case xs:return util.formatDate(e,"ddd, DD.MM.YY");case Ts:return util.formatDate(e,"MM / YYYY");case Cs:return util.formatDate(e,"YYYY");default:throw new Error("Invalid state")}}function Ms(e,t,i,o){for(var n=1/0,a=-1/0,s=!1,r=!1,l=0;l<t.length;l++){var c=e[t[l]];if(c){var d=c.values[i],h=c.values[o];null==d?s=!0:(d<n&&(n=d),d>a&&(a=d)),null==h?r=!0:(h<n&&(n=h),h>a&&(a=h))}}return{min:n===1/0?null:n,max:a===-1/0?null:a,hasStartNull:s,hasEndNull:r}}Object.assign(_s.prototype,rs.prototype),_s.prototype.isGantt=!0,_s.prototype.mode="gantt",_s.prototype.destroy=function(){this.$controls.remove(),rs.prototype.destroy.call(this)},_s.prototype.pixelToTime=function(e){var t=this.scale,i=Es(this.scrollPane.viewX0/t.timeZoom,t.scale)*t.scale,o=e-this.scrollPane.$body.offset().left-this.scrollPane.translateX;return Math.round(i+o/t.timeZoom)},_s.prototype.pixelToDate=function(e){return Ns(this.pixelToTime(e))},_s.prototype.resizeColumns=function(){for(var e=this.getQuery().cols,t=Ss,i=this.scrollPane.$leftHeadView[0].childNodes,o=this.scrollPane.$leftView[0].childNodes,n=0;n<e.length;n++){var a=e[n],s=i[n+1];s&&(s.style.left=t+"px",s.style.width=a.width+"px");for(var r=0;r<o.length;r++){var l=o[r].childNodes[n+1];l&&(l.style.left=t+"px",l.style.width=a.width+"px")}t+=a.width}$(this.scrollPane.$leftView[0]).find(".t-selection").css("width",t)},_s.prototype.didShow=function(e){this.$controls.appendTo(ui.$menuCenter),this.updateMetrics(),this.scrollPane.show(e),this.bodyResized()},_s.prototype.didHide=function(e){this.$controls.detach(),this.scrollPane.hide()},_s.prototype.zoomUpdated=function(){var e={hours:[bs,60],days:[ws,192],weeks:[xs,112],months:[Ts,200],years:[Cs,288]}[this.zoom.value];e&&(this.scale=this.getScaleConfiguration(this.scale.date0,e[0],e[1]),this.updateMetrics())},_s.prototype.updateUI=function(){this.visible&&this.scrollPane.updateView(!0)},_s.prototype.renderLeftHeadHTML=function(){if(!this.tableView.table.ready)return"";for(var e=this.tableView.table,t=e.cols,i=e.sortDescending,o=e.cidxGroup,n=e.cidxSort,a='<div class="t-head-ruler i-16 i-light-grey i-reload"></div>',s=Ss,r=0;r<t.length;r++){var l=t[r],c=r===o,d=r===n,h=!!l.filter;a+='<div class="t-head-cell" data-cidx="'+r+'" style="left:'+s+"px;width:"+l.width+'px"><div class="t-head-resizer"></div><span>'+htmlEscape(l.caption||l.expression.caption)+"</span>"+(h?'<div class="i-40-16 i-light-grey i-setting-filter" style="width: 12px;"></div>':"")+(c?'<div class="i-40-18 i-light-grey i-table-group" style="width: 24px"></div>':d?i?'<div class="i-40-12 i-light-grey i-line-down-thick"></div>':'<div class="i-40-12 i-light-grey i-line-up-thick"></div>':"")+"</div>",s+=l.width}return a},_s.prototype.renderLeftHTML=async function(e,t){if(!this.tableView.table.ready)return"";for(var i=this.tableView.table,o=i.rows,n=i.cols,a=i.models,s=i.groups||{},r=i.expanded||{},l=(this.rowHeight,i.cidxGroup),c=(this.cidxStart,this.cidxEnd,""),d=0;;d++){var h=e+d*ks;if(h>t)break;if(!((O=Math.floor(h/ks))<0)&&!(O>=o.length)){var p=o[O],u=a[p],f=u?void 0:s[p],m=u?u.values:f.values,g=!u,v=!1,y=g&&r[p];c+='<div class="t-row'+(g?" group":"")+(null==l&&O%2==0?" t-row-2nd":" t-row-1st")+'" style="top:'+(h-e)+'px"'+(g?' data-gid="'+encodeURIComponent(f.id):' data-nid="'+p)+'">',c+='<div class="'+("t-rowhead"+(O===o.length?" icon-big-black icon-big-add-light":O<0||O>o.length?"empty":v?" choosen icon-big-grey icon-big-okay":g?y?" group i-40-24 i-light-grey i-line-down":" group i-40-24 i-light-grey i-line-right":""))+'"><div class="t-rowhead-content">'+(g?"":O+1)+"</div></div>";for(var b=Ss,w=0;w<n.length;w++){var x="",T="";if((I=n[w]).isReadable){var C=m[w];if(g&&I.agg&&w!==l){null!=(N=I.aggType.format(C))&&(x=tables.aggTypeToSymbol(I.agg,N))}else{var k=I.field,$=k.base;if("choice"===$||"dchoice"===$){const e=await new Promise(e=>k.loadValue(p,C,e));e&&(x+='<div class="multicombo-item" style="'+(e.color?"background-color:"+e.color+";color:"+e.textColor:"")+'">'+(e.icon?'<div class="choice-symbol ic ic-'+e.icon+'"></div>':"")+"<span>"+htmlEscape(e.caption||"")+"</span></div>")}else if("multi"===$||"dmulti"===$){var S=util.multiDecode(C);if(S){const e=await new Promise(e=>k.loadValues(p,(t,i)=>e(i||{})));S.sort((function(t,i){var o=e[t],n=e[i];return o?n?o.order-n.order:-1:0}));for(var _=0;_<S.length;_++){var E=e[S[_]];E&&(x+='<div class="multicombo-item" style="'+(E.color?"background-color:"+E.color+";color:"+E.textColor:"")+'">'+(E.icon?'<div class="choice-symbol ic ic-'+E.icon+'"></div>':"")+"<span>"+htmlEscape(E.caption||"")+"</span></div>")}}}else if("color"===$)C&&(T="background-color:"+C);else if("icon"===$)C&&(x='<div class="choice-symbol ic ic-'+C+'"></div>');else if("styled"===$)C&&(x='<div class="choice-symbol'+(C.icon?" ic ic-"+C.icon:"")+'"></div><span style="color:'+(g?"":C.color)+'">'+htmlEscape(C.text)+"</span>",C.background&&(T="background-color:"+C.background));else if("file"===k.base){if(C){var D=database.thumbURL1(C);D&&(x='<img style="height:'+$s+'px" src="'+D+'">')}}else{var N=k.format(C);x=htmlEscape(N)}}c+='<div class="t-cell t-cell-'+I.field.base+'" style="left:'+b+"px;width:"+I.width+"px;"+T+'">'+x+"</div>",b+=I.width}else T="backgroundColor:#f7f7f7";c+="</dv>"}c+="</div>"}}for(b=Ss,w=0;w<n.length;w++){var I;b+=(I=n[w]).width}var O,M=0,F="none";return-1!==(O=this.getSelectedNid()?o.indexOf(this.getSelectedNid()):-1)&&(M=(O-e/ks)*ks,F=""),c+='<div class="t-selection t-selection-row" style="display:'+F+";top:"+M+"px;left:0;width:"+b+"px;height:"+$s+'px"></div>'},_s.prototype.renderHeadHTML=function(e,t){if(!this.tableView.table.ready)return"";for(var i,o=this.getScale(),n=Es(e/o.timeZoom,o.scale)*o.scale,a=Ds(new Date(e/o.timeZoom),o.scale),s="",r=0;r<100;){i=Is(a,o.scale);var l=(a.getTime()-n)*o.timeZoom,c=(i.getTime()-n)*o.timeZoom;if(e+l>t)break;s+='<div class="gantt-head-cell" style="left:'+l+"px;width:"+(c-l)+'px">'+htmlEscape(o.formatScaleDate(a))+"</div>",a=i,r++}return s},_s.prototype.renderHTML=function(e,t,i,o){if(!this.tableView.table.ready)return"";for(var n=this.tableView.table,a=n.rows,s=n.cols,r=n.models,l=n.groups||{},c=n.cidxGroup,d=(this.rowHeight,this.cidxStart),h=this.cidxEnd,p=s[d],u=s[h],f=!!p&&"date"===p.expression.returnType.base,m=!!u&&"date"===u.expression.returnType.base,g=this.getScale(),v=Es(e/g.timeZoom,g.scale)*g.scale,y=Ds(new Date(e/g.timeZoom),g.scale),b=g.ticks,w=i-e,x=o-t,T="",C=(this.scrollPane.visibleHeight,y),k=0;k<100;){var $=Math.round((C.getTime()-v)*g.timeZoom),S=Is(C,g.scale);if($>w)break;if(T+='<div class="gantt-grid-line" style="height:'+x+"px;left:"+$+'px"></div>',null!=b)for(var _=(Math.round((S.getTime()-v)*g.timeZoom)-$)/b,E=1;E<b;E++){T+='<div class="gantt-grid-line2" style="height:'+x+"px;left:"+($+Math.round(E*_))+'px"></div>'}C=S,k++}var D=(Date.now()-v)*g.timeZoom;for(k=0;;k++){var N=t+k*ks;if(N>o)break;if(!((Q=Math.floor(N/ks))<0)&&!(Q>=a.length)){var I=a[Q],O=r[I];if(O){T+='<div class="gantt-row '+(null==c&&Q%2==0?"gantt-row-1st":"gantt-row-2nd")+'" style="left:0px;width:'+w+"px;top:"+(N-t)+'px" data-ridx="'+Q+'" data-nid="'+I+'">';var M=!1,F=!1;if(-1!==d&&(W=this.getStartValue(O),M=n.isEditable(d,Q)),-1!==h&&(B=this.getEndValue(O),F=n.isEditable(h,Q)),W!==B?(null!=W&&f&&(W=Ns(W).getTime()),null!=B&&m&&(B=Ns(B,1).getTime())):W===B&&null!=W&&f&&(B=W=Ns(W,1).getTime()),null!=W||null!=B){X=null==W?null:Math.round((W-v)*g.timeZoom),G=null==B?null:Math.round((B-v)*g.timeZoom);if(null!=X&&null!=G&&X>G){var R=G;G=X,X=R}for(var L=[],j=0;j<s.length;j++)if(j!==d&&j!==h){var A=s[j],P=O.values[j],U=A.expression.returnType.format(P);U&&L.push(U)}var H=htmlEscape(L.join(" "));if(W===B)T+='<div class="gantt-row-square" style="left:'+(null==W?G:X)+'px"><div class="gantt-row-square-square"></div><div class="gantt-row-square-label">'+H+"</div>"+(M?'<div class="gantt-row-grab gantt-row-grab-left"></div>':"")+(F?'<div class="gantt-row-grab gantt-row-grab-right"></div>':"")+"</div>";else T+='<div class="'+(null==X?"gantt-row-arrow-right":null==G?"gantt-row-arrow-left":"gantt-row-bar")+'" style="left:'+(J=null==X?G-64:X)+"px;width:"+(K=null==X||null==G?64:G-X+1)+'px"><div class="gantt-row-bar-label" style="left:'+(K+4)+'px">'+H+"</div>"+(M?'<div class="gantt-row-grab gantt-row-grab-left"></div>':"")+(F?'<div class="gantt-row-grab gantt-row-grab-right"></div>':"")+"</div>"}}else{var z=l[I];if(z){T+='<div class="gantt-row gantt-group" style="left:0px;width:'+w+"px;top:"+(N-t)+'px" data-ridx="'+Q+'" data-gid="'+encodeURIComponent(z.id)+'">';var V=Ms(r,z.children,d,h),W=V.min,B=V.max,q=V.hasStartNull,Y=V.hasEndNull;W!==B?(null!=W&&f&&(W=Ns(W).getTime()),null!=B&&m&&(B=Ns(B,1).getTime())):W===B&&null!=W&&f&&(B=W=Ns(W,1).getTime());var X,G,J=X=null==W?null:Math.round((W-v)*g.timeZoom),K=(G=null==B?null:Math.round((B-v)*g.timeZoom))-X;q&&(J-=64,K+=64),Y&&(K+=64),null!=W&&null!=B&&(T+=W!==B||q||Y?'<div class="gantt-group-bar" style="left:'+J+"px;width:"+K+'px">'+(q?'<div class="gantt-group-bar-startopen"></div>':'<div class="gantt-group-bar-start"></div>')+'<div class="gantt-group-bar-range"></div>'+(Y?'<div class="gantt-group-bar-endopen"></div>':'<div class="gantt-group-bar-end"></div>')+"</div>":'<div class="gantt-group-square" style="left:'+J+'px"><div class="gantt-group-square-square"></div></div>'),T+="</div>"}}T+="</div>"}}T+='<div class="gantt-grid-now" style="height:'+x+"px;left:"+D+'px"></div>',T+='<div class="gantt-grid-indicator" style="height:'+x+"px;left:"+D+'px;display:none"></div>';var Q,Z=0,ee="none";return-1!==(Q=this.getSelectedNid()?a.indexOf(this.getSelectedNid()):-1)&&(Z=(Q-t/ks)*ks,ee=""),T+='<div class="t-selection t-selection-row" style="display:'+ee+";top:"+Z+"px;left:0;width:"+w+"px;height:"+$s+'px"></div>'},_s.prototype.selectionChanged=function(){this.visible&&(this.openEditor(this.getSelectedNid()),this.updateMetrics())},_s.prototype.udpateSelection=function(){},_s.prototype.queryLoaded=function(){this.visible&&this.updateMetrics()},_s.prototype.dataChanged=function(){this.visible&&this.updateUI()},_s.prototype.rowsChanged=function(){this.visible&&this.updateMetrics()},_s.prototype.updateMetrics=function(){if(this.visible){this.scrollPane.totalWidth>0&&(this.scrollPane.scrollX,this.scrollPane.totalWidth),this.scrollPane.totalHeight>0&&(this.scrollPane.scrollY,this.scrollPane.totalHeight);var e=this.getQuery(),t=e.rows,i=(e.cols,e.models),o=(e.groups,ks),n=this.el[0].clientWidth;this.el[0].clientHeight;this.width=n,this.rowHeight=o,this.setupColumns();var a=this.getScale(),s=a.date0Normalized.getTime(),r=a.getNextDate(a.date0Normalized).getTime();for(var l in i)if(i.hasOwnProperty(l)){var c=i[l];if(c){var d=this.getStartValue(c),h=this.getEndValue(c);null!=d&&(d<s&&(s=d),d>r&&(r=d)),null!=h&&(h<s&&(s=h),h>r&&(r=h))}}var p=0,u=t.length*o,f=Math.round(s*a.timeZoom-n/2)-1,m=Math.round(r*a.timeZoom+n/2)+1;this.scrollPane.setMetrics(f,p,m,u)}},_s.prototype.setupColumns=function(){var e=this.getQuery().cols,t=-1,i=-1,o="date";e:for(var n=0;n<e.length;n++){switch(e[n].expression.returnType.base){case"date":case"timestamp":if(-1===t)t=n;else if(-1===i){i=n;break e}break;case"appointment":o="appointment",t=n,i=n;break e}}this.cidxMode=o,this.cidxStart=t,this.cidxEnd=i},_s.prototype.getStartValue=function(e){if(e){var t=e.values[this.cidxStart];switch(this.cidxMode){case"appointment":var i=util.RE_APPOINTMENT.exec(t);return i?parseInt(i[1]):void 0;default:return t}}},_s.prototype.getEndValue=function(e){if(e){var t=e.values[this.cidxEnd];switch(this.cidxMode){case"appointment":var i=util.RE_APPOINTMENT.exec(t);return i?parseInt(i[1])+parseInt(i[2]):void 0;default:return t}}},_s.prototype.bodyResized=function(){this.visible&&(this.updateMetrics(),this.$controls.detach(),ui.fullWidth<1171?(this.$smallControlsContainer.appendTo(this.el),this.$controls.appendTo(this.$smallControlsContainer)):(this.$smallControlsContainer.detach(),this.$controls.appendTo(ui.$menuCenter)))},_s.prototype.clicked=function(e){var t=$(e.target).closest(".gantt-row").attr("data-nid"),i=$(e.target).closest(".t-row").attr("data-nid"),o=t||i;if(i)this.select(o);else{var n=$(e.target).closest(".gantt-row").attr("data-gid"),a=$(e.target).closest(".t-row").attr("data-gid"),s=n||a;s&&(s=decodeURIComponent(s),this.tableView.table.toggle(s))}},_s.prototype.registerMouseListeners=function(){var e,t;function i(i){if(!e){var a=$(i.target);(t=a.closest(".gantt-row").attr("data-nid"))&&(a.is(".gantt-row-grab-left")?e="drag-left":a.is(".gantt-row-grab-left")&&(e="drag-right")),e&&(i.clientX,window.addEventListener("mousemove",o,!1),window.addEventListener("mouseup",n,!1),i.preventDefault(),i.stopPropagation())}}function o(e){e.clientX;database.loadNodeSync(t)&&(e.preventDefault(),e.stopPropagation())}function n(e){window.removeEventListener("mousemove",o,!1),window.removeEventListener("mouseup",n,!1),e.preventDefault(),e.stopPropagation()}this.$pane[0].addEventListener("mousedown",i,!1)},_s.prototype.getScale=function(){return this.scale||(this.scale=this.getScaleConfiguration(new Date,Cs,288)),this.scale},_s.prototype.getScaleConfiguration=function(e,t,i){var o=i/t;return{scale:t,width:i,date0:e,date0Normalized:Ds(e,t),ticks:t===Cs?12:t===xs?7:t===ws?4:null,timeZoom:o,pixelPerScale:o/t,getNextDate:function(e){return Is(e,this.scale)},formatScaleDate:Os}};var Fs=o("./src/js/widgets/editors/IconSelector.js");function Rs(e){this.dontUpdateUI=!1,this.panes=[],this.tableView=e,this.visible=!1,this.resize=$.proxy(this.resize,this),this.el=$('<div class="kanban-container">').sortable({handle:".kanban-head",cancel:".not-draggable",update:$.proxy(this.userSortedPanes,this),zIndex:999999,tolerance:"pointer"}),this.mousedown=$.proxy(this.mousedown,this),this.el[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",this.mousedown,!1),this.el.touch($.proxy(this.clicked,this)),this.updateUI=util.debounceFast(this.updateUI,this)}Object.assign(Rs.prototype,rs.prototype),Rs.prototype.isKanban=!0,Rs.prototype.mode="kanban",Rs.prototype.didShow=function(e){},Rs.prototype.didHide=function(e){},Rs.prototype.updateUI=async function(){if(!this.dontUpdateUI&&this.visible){var e=this.getQuery();if(e.ready){var t=e.cols,i=e.models,o=e.groups,n=e.groupsSorted,a=e.cidxGroup,s=this.canCreateRecord(),r=this.getSelectedNid(),l=this.panes=this.getPanes(this.panes,t,a,o,n),c="";if(null!=a){var d=t[a];if(d&&!d.isReadable)return void this.el.html('<h1 style="padding:16px;margin:0 auto">'+htmlEscape(locale.errorNotAuthorized)+"</h1>");for(var h=0;h<l.length;h++){if(h>100){c+='<div class="kanban-pane not-draggable"><div class="kanban-head"><div class="kanban-head-label">'+htmlEscape(l.length-100+" more ...")+"</div></div></div>";break}var p=l[h],u=o[p.gid],f=u&&u.children||[],m=p.icon;c+='<div class="kanban-pane'+(null==p.value?"  not-draggable":"")+'" style="background-color:'+p.color.light+'" data-pane="'+p.index+'">',c+='<div class="kanban-head" style="background-color:'+p.color.light+'">'+(m?'<div class="kanban-head-icon ic ic-'+m+'"></div>':"")+'<div class="kanban-head-label" style="color:'+util.contrastingTextColorTo(p.color.light)+'">'+htmlEscape(p.caption)+"</div></div>",c+=`<div class="kanban-cards" style="background-color: ${p.color.dark}">`;for(var g=0;g<f.length;g++){if(g>1e3){c+='<div class="card"><div class="card-padding-top"></div><div style="text-align:center">'+htmlEscape(f.length-1e3+" more ...")+'</div><div class="card-padding-bottom"></div></div>';break}var v=f[g],y=i[v],b=v===r;c+=await this.renderCard(y,t,a,b?" selected":"",void 0,!0)}c+="</div>",s&&(c+=`<div class="kanban-bottom" style="background-color:${p.color.light};padding: 8px 8px 0 8px;">\n                        <div class="nx-button-text grey" style="border: none">\n                            <div class="kanban-bottom-icon i-32-24 i-light-grey i-setting-add" style="margin-top: 1px;"></div>\n                            <span class="kanban-bottom-label">${htmlEscape(locale.createRecord)}</span>\n                        </div>\n                    </div>`),c+="</div>"}c+='<div class="kanban-add-pane not-draggable"><div class="kanban-add" data-action="add"><div class="kanban-add-label">+ '+htmlEscape(locale.choiceAddValue)+"</div></div></div>"}else{c+='<div class="kanban-options">',c+=`<div class="kanban-options-head"><div style="width: 250px;">${htmlEscape(locale.kanbanRecommend)}</div></div>`;var w={};for(let e=0;e<t.length;e++){var x=t[e];"choice"===x.expression.returnType.base&&(c+='<div class="nx-button-text grey kanban-options-col" data-col="'+e+'">'+htmlEscape(x.caption||x.expression.caption)+"</div>",x.directFid&&(w[x.directFid]=!0))}k.each(e.type.sorted,(function(e){"choice"!==e.base||w[e.id]||(c+='<div class="nx-button-text grey kanban-options-col" data-fid="'+e.id+'">'+htmlEscape(e.caption)+"</div>")})),database.isAdmin()&&(c+='<div class="nx-button-text blue kanban-options-col blue" data-action="create-choice">+ '+htmlEscape(locale.createChoiceField)+"</div>"),c+='<div class="kanban-options-head">'+htmlEscape(locale.otherOptions+":")+"</div>";for(let e=0;e<t.length;e++){const i=t[e];"choice"!==i.expression.returnType.base&&(c+='<div class="nx-button-text grey kanban-options-col" data-col="'+e+'">'+htmlEscape(i.caption||i.expression.caption)+"</div>")}c+="</div>"}this.el.html(c)}}},Rs.prototype.queryLoaded=function(){this.visible&&(this.getQuery().expandAll(),this.updateUI())},Rs.prototype.rowsChanged=function(){this.visible&&this.updateUI()},Rs.prototype.dataChanged=function(){this.visible&&(this.getQuery().resort(),this.updateUI())},Rs.prototype.bodyResized=function(){this.visible},Rs.prototype.mousedown=function(e){if(!TOUCH||1===e.touches.length){var t=e.target,i=$(t),o=this,n=o.getQuery(),a=n.cols[n.cidxGroup];if(a){var s=i.closest(".card");if(s.length){var r=s.attr("data-nid");if(r){var l=database.loadNodeSync(r);if(l){var c,d=a.directFid&&n.type.fields[a.directFid],h=d&&database.canWrite(d)&&database.canWriteNodeField2(l,d),p=s.offset(),u=s.width(),f=s.height(),m=p.left,g=p.top,v=TOUCH?e.touches[0].clientX:e.clientX,y=TOUCH?e.touches[0].clientY:e.clientY,b=s.closest(".kanban-pane")[0],w=!1;o.dontUpdateUI=!0;var x=Date.now(),T=!1,C=window.NINOX_APP_TAB?t:window;TOUCH?(C.addEventListener(EVENT_touchmove,k,!1),C.addEventListener(EVENT_touchend,S,!1)):(window.addEventListener("mousemove",k,!1),window.addEventListener("mouseup",S,!1))}}}}}function k(e){if(console.log("mousemove"),!(TOUCH&&1!==e.touches.length||T)){var t=Date.now(),i=(TOUCH?e.touches[0].clientX:e.clientX)-v,n=(TOUCH?e.touches[0].clientY:e.clientY)-y;if(w){s.css({left:m+i,top:g+n});var a=o.findPaneAt(TOUCH?e.touches[0].clientX:e.clientX,TOUCH?e.touches[0].clientY:e.clientY),r=a&&a[0];if(r!==b){if(b&&$(b).removeClass("dropping").css("border-color",""),r){const e=o.panes[$(r).attr("data-pane")]||{color:{}};$(r).addClass("dropping").css("border-color",e.color.light||"")}b=r}}else if(i*i+n*n>10){if(TOUCH&&t-x<250)return T=!0,C.removeEventListener(EVENT_touchmove,k,!1),C.removeEventListener(EVENT_touchend,S,!1),void(o.dontUpdateUI=!1);if(h){w=!0,c=$('<div class="kanban-cards-placeholder">').css({width:u,height:f}).insertBefore(s),s.detach().appendTo(document.body).css({position:"absolute",left:m+i,top:g+n,width:u,height:f,"box-shadow":"0 0 32px rgba(0,0,0,0.5)"});var l=o.panes[$(b).attr("data-pane")]||{color:{}};$(b).addClass("dropping").css("border-color",l.color.light||"")}}e.preventDefault()}}function S(e){if(console.log("mouseup"),!(TOUCH&&0!==e.touches.length||T)){if(w){s.css({"box-shadow":"none"});var t=!0;if(b){$(b).removeClass("dropping").css("border-color","");var i=$(b).attr("data-pane");if(i){var a=o.panes[i];a&&(t=!1,s.remove(),c.remove(),$.loading(!0),database.update(r,d.id,a.value,(function(e){$.loading(!1),e&&$.alert(e),n.resort(),n.expandAll(),o.dontUpdateUI=!1,o.updateUI()})))}}t&&_()}else o.getQuery().expandAll(),o.select(r);o.dontUpdateUI=!1,TOUCH?(C.removeEventListener(EVENT_touchmove,k,!1),C.removeEventListener(EVENT_touchend,S,!1)):(window.removeEventListener("mousemove",k,!1),window.removeEventListener("mouseup",S,!1)),e.preventDefault()}}function _(){console.log("revertDrag"),s.detach().insertBefore(c).css({position:"",left:"",top:"",width:"",height:"","box-shadow":""}),c.remove(),c=void 0}},Rs.prototype.setup=function(e){var t=this,i=$(e.target).closest(".kanban-options-col"),o=this.getQuery();if("create-choice"===i.attr("data-action")){var n=o.type.schema.createField(o.type,o.type.createNewFieldName("choice"),"choice");const e=o.getConfig();e.cols.splice(0,0,{expression:n.id}),e.group=0,e.sort&&e.sort++,o.setConfig(e),o.load((function(){t.updateUI()})),t.tableView.saveView()}else if(i.attr("data-fid")){var a=i.attr("data-fid");const e=o.getConfig();e.cols.splice(0,0,{expression:a}),e.group=0,e.sort&&e.sort++,o.setConfig(e),o.load((function(){t.updateUI()})),t.tableView.saveView()}else{var s=i.attr("data-col");s&&(o.group(parseInt(s,10)),this.updateUI()),t.tableView.saveView()}},Rs.prototype.clicked=function(e){var t=$(e.target);t.closest(".kanban-options-col").length?this.setup(e):t.closest(".kanban-add").length?this.popupCreateChoiceValue(e):t.closest(".kanban-head").length?this.popupChoiceValue(e):t.closest(".kanban-bottom").length&&this.createRecord(e)},Rs.prototype.createRecord=function(e){if(this.canCreateRecord()){var t=this,i=$(e.target),o=t.getQuery(),n=t.getGroupField(),a=i.closest(".kanban-pane").attr("data-pane");if(a){var s=t.panes[a];if(s){$.loading(!0);var r={};r[n.id]=s.value,database.create(o.type.id,r,(function(e,i){$.loading(!1),e&&$.alert(e),i&&(t.getQuery().expandAll(),t.select(i._id))}))}}}},Rs.prototype.getPanes=function(e,t,i,o,n){if(null==i)return[];var a=[],s=t[i].expression.returnType;if("choice"===s.base||"boolean"===s.base){var r=k.sortBy(s.getValues(),"order");s.required||r.unshift({id:void 0,value:null});for(let e=0;e<r.length;e++){const t=r[e].id;a.push({caption:null==t?locale.empty:s.format(t),value:t,index:e,color:this.getGroupColor(s,t),icon:this.getGroupIcon(s,t),gid:"_group_"+(null==t?"":JSON.stringify(t))})}}else for(let e=0;e<n.length;e++){var l=o[n[e]];if(l){var c=l.value;a.push({caption:null==c?locale.empty:s.format(c),value:c,index:e,color:this.getGroupColor(s,c),icon:this.getGroupIcon(s,c),gid:l.id})}}return a},Rs.prototype.renderCard=ds.prototype.renderCard,Rs.prototype.getGroupColor=ds.prototype.getGroupColor,Rs.prototype.getGroupIcon=ds.prototype.getGroupIcon,Rs.prototype.findPaneAt=function(e,t){for(var i=this.el.children(),o=0;o<i.length;o++){var n=$(i[o]),a=n.offset(),s=n.width(),r=n.height();if(e>=a.left&&e<=a.left+s&&t>=a.top&&t<=a.top+r)return n}},Rs.prototype.userSortedPanes=function(e,t){if(this.canChangeStructure()){var i=this.getQuery();if(i.ready){var o=i.cols[i.cidxGroup];if(o){var n=o.expression.returnType;if("choice"===n.base){for(var a=n.values,s=this.panes,r=this.el.children(),l=1,c=!1,d=0;d<r.length;d++){console.log("  pane "+d);var h=$(r[d]),p=s[parseInt(h.attr("data-pane"),10)];if(p){var u=a[p.value];console.log("  pane "+d+" with value "+p.value+"=> "+u),u&&(u.order!=l&&(console.log("  pane "+d+" with value "+p.value+"=> "+u+" changes order from "+u.order+" to "+l),u.order=l,c=!0),l++)}}c&&database.schema.trigger("change")}}}}},Rs.prototype.getGroupColumn=function(){var e=this.getQuery();return e.cols[e.cidxGroup]},Rs.prototype.getGroupField=function(){this.getQuery().cols;var e=this.getGroupColumn();if(e)return e.expression.returnType},Rs.prototype.getPaneInfo=function(e){var t=$(e.target).closest(".kanban-pane");if(t.length){var i=parseInt(t.attr("data-pane"),10),o=this.panes[i];if(o){var n=this.getGroupField();if(n){var a=void 0,s=void 0;return"choice"===n.base&&(s=(a=n.values)[o.value]),{pane:o,field:n,fieldValues:a,choice:s}}}}},Rs.prototype.popupCreateChoiceValue=function(e){if(this.canChangeStructure()){var t=this.getGroupField();if(t&&"choice"===t.base){var i={icon:void 0,color:void 0,caption:""};new this.inlineChoiceValueEditor({$el:$(e.target).closest(".kanban-add"),field:t,updateUI:function(){},closed:function(){i.caption&&t.createValue(i.caption,i.color,i.icon)}},i)}}},Rs.prototype.popupChoiceValue=function(e){if(this.canChangeStructure()){var t=this.getPaneInfo(e);t&&t.choice&&new this.inlineChoiceValueEditor({$el:$(e.target).closest(".kanban-head"),field:t.field,updateUI:function(){}},t.choice)}},Rs.prototype.inlineChoiceValueEditor=function(e,t){var i=$.backplane({beforeClose:g}),o=e.$el,n=o.offset(),a=o.width(),s=o.height(),r=$('<div class="inline-choice-value-editor">').css({top:n.top,left:n.left,width:a,height:s}).appendTo(i),l=$('<div class="inline-choice-value-editor-icon">').appendTo(r).touch(u),c=$('<input class="inline-choice-value-editor-input" type="text">').val(t.caption).appendTo(r).on("change",f),d=$('<div class="inline-choice-value-editor-color">').appendTo(r).touch(p);function h(){l.attr("class","inline-choice-value-editor-icon"+(t.icon?" ic ic-"+t.icon:"")),d.css("background-color",t.color||"#fff")}function p(){new To.a({$el:d,value:t.color,update:function(e){t.color=e,h(),m()}})}function u(){new Fs.a({$el:l,value:t.icon,update:function(e){t.icon=e,h(),m()}})}function f(){var e=c.val();e!==t.caption&&(t.caption=e,m())}function m(){e.field.trigger("change"),e.field.schema.trigger("change"),e.updateUI()}function g(){f(),e.closed&&e.closed()}h(),c.focus()},Rs.prototype.canCreateRecord=function(){var e=this.getQuery(),t=this.getGroupColumn();return null!=t&&t.directFid&&database.canCreate(e.type)&&database.canWrite(t.field)},Rs.prototype.canMoveRecord=function(){var e=this.getGroupColumn();return null!=e&&e.directFid&&database.canWrite(e.field)},Rs.prototype.canChangeStructure=function(){return database.isAdmin()},Rs.prototype.updateSelection=function(){var e=this.getSelectedNid();this.el.find(".card.selected").removeClass("selected"),e&&b.schemas.RE_NID.test(e)&&this.el.find('.card[data-nid="'+e+'"]').addClass("selected")};const Ls=40,js=40;function As(e){this.dontUpdateUI=!1,this.panes=[],this.tableView=e,this.visible=!1,this.resize=$.proxy(this.resize,this),this.el=$('<div class="pivot-container">'),this.pivotCellCols=[],this.pivotRows=[],this.pivotCols=[],this.pivotCells={},this.pivotRowValues=[],this.cellColsWidth=0,this.mousedown=$.proxy(this.mousedown,this),this.el[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",this.mousedown,!1);var t=this;this.scrollPane=new ms({viewPaddingX:400,viewPaddingY:400,modX:100,modY:Ls,$parent:this.el,leftDivider:!1,render:function(e,i,o,n){return t.renderHTML(e,i,o,n)},head:{height:2*Ls,render:function(e,i){return t.renderHeadHTML(e,i)}},foot:{height:Ls,render:function(e,i){return t.renderFootHTML(e,i)}},left:{width:js,render:function(e,i){return t.renderLeftHTML(e,i)},renderHead:function(){return t.renderLeftHeadHTML()},renderFoot:function(){return t.renderLeftFootHTML()}},right:{width:0,render:function(e,t){return""}}}),this.scrollPane.$headView.nxdraggable({selector:".t-head-resizer",dragStart:function(e){if(this.cidx=e.$el.closest(".t-head-cell").attr("data-cidx"),this.gidx=e.$el.closest(".t-head-cell").attr("data-gidx"),this.cidx){var i=t.getQuery().cols[this.cidx];this.width0=i.width}else if(this.gidx){var o=t.getQuery().cols.slice(2);this.colWidth0=[];for(var n=0;n<o.length;n++){i=o[n];this.colWidth0[n]=i.width}this.width0=t.cellColsWidth}},drag:function(e){if(this.cidx)t.getQuery().cols[this.cidx].width=Math.max(js,this.width0+(e.x2-e.x0)),t.resizeColumns();else if(this.gidx){for(var i=t.getQuery().cols.slice(2),o=this.width0,n=Math.max(js*i.length,o+(e.x2-e.x0)),a=this.colWidth0,s=0;s<i.length;s++){i[s].width=Math.round(a[s]*n/o)}t.resizeColumns()}}}),this.scrollPane.$leftHeadView.nxdraggable({selector:".t-head-resizer",dragStart:function(e){console.log("left drag start");var i=t.getQuery().cols[0];this.width0=i.width},drag:function(e){console.log("left drag",this.width0,e.x2,e.x0),t.getQuery().cols[0].width=Math.max(js,this.width0+(e.x2-e.x0)),t.resizeColumns()}})}Object.assign(As.prototype,rs.prototype),As.prototype.isPivot=!0,As.prototype.mode="pivot",As.prototype.didShow=function(e){this.updateStructure(),this.scrollPane.show(e)},As.prototype.didHide=function(e){this.scrollPane.hide()},As.prototype.updateUI=function(){this.visible&&this.updateStructure()},As.prototype.updateStructure=function(){var e=this.getQuery(),t=e.rows,i=e.cols,o=e.models||{},n=e.groups||{},a=(i[0],i[1]),s=i.slice(2),r=[],l=[],c={},d={},h={};if(i.length>2){if(e.ready){for(var p=0;p<t.length;p++){var u=t[p],f=o[u]||n[u];if(f){var m=f.values[0],g=JSON.stringify(m),v=f.values[1],y=JSON.stringify(v),b=g+"#"+y;if(d[g]||(d[g]=!0,r.push(m)),h[y]||(h[y]=!0,l.push(v)),!(T=c[b])){T=c[b]={cellCols:[],cellAggs:[]};for(var w=2;w<i.length;w++)T.cellCols[w-2]=[]}for(w=2;w<i.length;w++){var x=f.values[w];null!=x&&T.cellCols[w-2].push(x)}}}for(var b in c)if(c.hasOwnProperty(b)){var T=c[b];for(w=2;w<i.length;w++){var C=i[w],k=T.cellCols[w-2];C.agg&&(T.cellAggs[w-2]=this.aggregate(C,k))}}}l.sort((function(e,t){return a.field.compare(e,t)}))}this.pivotCellCols=s,this.pivotRows=r,this.pivotCols=l,this.pivotCells=c,this.pivotRowValues=d,this.updateMetrics()},As.prototype.aggregate=function(e,t){var o,n;switch(e.agg){case"sum":case"cnt":o=0;break;case"avg":o=[0,0];break;case"min":o=1/0;break;case"max":o=-1/0;break;case"first":case"last":o=null;break;case"concat":o=[]}for(var a=0;a<t.length;a++){var s=t[a],r=Number(s);switch(e.agg){case"sum":isNaN(r)||(o+=r);break;case"cnt":null!=s&&!1!==s&&""!==s&&o++;break;case"avg":null==s||"number"!=typeof s||isNaN(r)||(o[0]+=r,o[1]++);break;case"min":null!==s&&s<o&&(o=s);break;case"max":null!==s&&s>o&&(o=s);break;case"first":0===i&&(o=s);break;case"last":i===t.length-1&&(o=s);break;case"concat":null!=s&&(o.length<20?o.push(e.field.format(s)):20===o.length&&o.push("..."))}}switch(e.agg){case"sum":case"cnt":n=o;break;case"avg":n=o[1]>0?o[0]/o[1]:void 0;break;case"min":n=o===1/0?void 0:o;break;case"max":n=o===-1/0?void 0:o;break;case"first":case"last":n=o;break;case"concat":n=o.join(", ")}return n},As.prototype.updateMetrics=function(){for(var e=this.getQuery().cols,t=e[0],i=0,o=2;o<e.length;o++){i+=e[o].width}this.cellColsWidth=i;var n=i*this.pivotCols.length,a=this.pivotRows.length*Ls;this.scrollPane.setLeftWidth(t&&t.width||0),this.scrollPane.setMetrics(0,0,n,a)},As.prototype.resizeColumns=function(){this.updateMetrics()},As.prototype.renderLeftHeadHTML=function(){var e=this.getQuery().cols,t=e[0],i=e[1];return'<div class="t-row" style="top:0"><div class="t-head-cell" style="left:0;width:'+(t&&t.width||0)+'px"><div class="t-head-resizer"></div><span>'+htmlEscape(i&&(i.caption||i.expression.caption)||"")+'</span></div><div class="t-row" style="top:'+Ls+'px"><div class="t-head-cell" style="left:0;width:'+(t&&t.width||0)+'px"><div class="t-head-resizer"></div><span>'+htmlEscape(t&&(t.caption||t.expression.caption)||"")+"</span></div>"},As.prototype.renderLeftHTML=function(e,t){for(var i=this.getQuery().cols[0],o=i&&i.width||0,n=this.pivotRows,a=Math.floor(e/Ls),s=Math.floor(t/Ls),r="",l=a;l<=s;l++){var c=l%2==0;if(r+='<div class="'+("t-row"+(l>=0&&l<n.length?c?" t-row-2nd":" t-row-1st":" t-row-empty"))+'" style="top:'+(l*Ls-e)+'px">',l>=0&&l<n.length){var d=n[l];r+='<div class="t-cell t-cell-emph" style="left:0;width:'+o+'px">'+(i?htmlEscape(i.field.format(d)):"")+"</div>"}else r+='<div class="t-cell t-cell-emph" style="left:0;width:'+o+'px"></div>';r+="</div>"}return r},As.prototype.renderHTML=function(e,t,i,o){for(var n=this.getQuery(),a=this.pivotRows,s=this.pivotCols,r=this.pivotCells,l=n.cols,c=Math.floor(t/Ls),d=Math.floor(o/Ls),h="",p=c;p<=d;p++){var u=p%2==0,f=0;if(h+='<div class="'+("t-row"+(p>=0&&p<a.length?u?" t-row-2nd":" t-row-1st":" t-row-empty"))+'" style="top:'+(p*Ls-t)+"px;left:"+-e+'px">',p>=0&&p<a.length)for(var m=a[p],g=JSON.stringify(m),v=0;v<s.length;v++)for(var y=s[v],b=r[g+"#"+JSON.stringify(y)],w=2;w<l.length;w++){h+='<div class="t-cell t-cell-'+((x=l[w]).aggType&&x.aggType.base||"number")+'" style="left:'+f+"px;width:"+x.width+'px">',b&&x.aggType&&(h+=htmlEscape(x.aggType.format(b.cellAggs[w-2]))),h+="</div>",f+=x.width}else for(v=0;v<s.length;v++)for(w=2;w<l.length;w++){var x;h+='<div class="t-cell t-cell-empty" style="left:'+f+"px;width:"+(x=l[w]).width+'px"></div>',f+=x.width}h+="</div>"}return h},As.prototype.renderHeadHTML=function(e,t){var i=this.getQuery().cols,o=i[1],n=this.pivotCols,a=this.cellColsWidth,s="";s+='<div class="t-row" style="top:0;left:'+-e+'px">';for(var r=0,l=0;l<n.length;l++)s+='<div class="t-head-cell" style="left:'+r+"px;width:"+a+'px" data-gidx="'+l+'"><div class="t-head-resizer"></div><span>'+(o?htmlEscape(o.expression.returnType.format(n[l])):"")+"</span></div>",r+=a;s+="</div>",r=0,s+='<div class="t-row" style="top:'+Ls+"px;left:"+-e+'px">';for(l=0;l<n.length;l++)for(var c=2;c<i.length;c++){var d=i[c];s+='<div class="t-head-cell" style="left:'+r+"px;width:"+d.width+'px" data-cidx="'+c+'"><div class="t-head-resizer"></div><span>'+htmlEscape(d.caption||d.expression.caption||"")+"</span></div>",r+=d.width}return s+="</div>"},As.prototype.renderLeftFootHTML=function(){var e=this.getQuery().cols[0];return'<div class="t-row"><div class="t-foot-cell" style="width:'+(e&&e.width||0)+'px"></div></div>'},As.prototype.renderFootHTML=function(e,t){var i=this.getQuery().cols,o=this.pivotCols,n="",a=0;n+='<div class="t-row" style="left:'+-e+'px">';for(var s=0;s<o.length;s++)for(var r=2;r<i.length;r++){var l=i[r];n+='<div class="t-foot-cell" style="left:'+a+"px;width:"+l.width+'px"></div>',a+=l.width}return n+="</div>"},As.prototype.queryLoaded=function(){this.updateUI()},As.prototype.dataChanged=function(){this.updateUI()},As.prototype.rowsChanged=function(){this.updateUI()},As.prototype.bodyResized=function(){this.visible&&this.scrollPane.resize()};var Ps=o("./src/js/admin/ViewEditor.js");const Us={xlsUseFieldFormat:!1};function Hs(e){var t=e.$container;function i(){e.onUpdate&&e.onUpdate()}this.xlsUseFieldFormat=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:"Maintain number and date formats",required:!0,formWidth:1,booleanRenderer:"check"})),this.xlsUseFieldFormat.value=Us.xlsUseFieldFormat,this.xlsUseFieldFormat.onUpdate(i),this.xlsUseFieldFormatField=new qt.a(void 0,this.xlsUseFieldFormat,t)}function zs(e){if(!database.authorizationExport)return $.alert(locale.notAuthorized);this.table=e;var t=this.popdown=$.popdown({close:$.proxy(this.closed,this)});Object(l.f)("TableExportData","Open"),$('<div class="nx-section-head">').text(locale.exportData).appendTo(t.$pane);var i=$('<div class="nx-switch-big">').appendTo(t.$pane),o=$('<div class="nx-switch-big-item selected">').text(locale.exportCSV).appendTo(i),n=$('<div class="nx-section-pane">').appendTo(t.$pane);this.exportCSVSettings=new Jt({$container:n});var a=$('<div class="nx-button-bar">').appendTo(n);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(a).touch($.proxy(this.destroy,this)),$('<div class="nx-hspace-flex">').appendTo(a),$('<div class="nx-button-text grey">').text(locale.csvExportSaveAs).appendTo(a).touch($.proxy(this.csvExportSaveAs,this)),$('<div class="nx-hspace-small">').appendTo(a),$('<div class="nx-button-text blue">').text(locale.csvExportOpen).appendTo(a).touch($.proxy(this.csvExportOpen,this));var s=$('<div class="nx-switch-big-item">').text(locale.exportXLS).appendTo(i),r=$('<div class="nx-section-pane">').hide().appendTo(t.$pane);this.exportXLSSettings=new Hs({$container:r});var c=$('<div class="nx-button-bar">').appendTo(r);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(c).touch($.proxy(this.destroy,this)),$('<div class="nx-hspace-flex">').appendTo(c),$('<div class="nx-button-text grey">').text(locale.xlsExportSaveAs).appendTo(c).touch($.proxy(this.xlsExportSaveAs,this)),$('<div class="nx-hspace-small">').appendTo(c),$('<div class="nx-button-text blue">').text(locale.xlsExportOpen).appendTo(c).touch($.proxy(this.xlsExportOpen,this)),o.touch((function(){o.addClass("selected"),s.removeClass("selected"),n.show(),r.hide()})),s.touch((function(){s.addClass("selected"),o.removeClass("selected"),r.show(),n.hide()}))}function Vs(e){e.prototype.cutEnabled=function(){return"cell"===this.selectionMode||"block"===this.selectionMode},e.prototype.cut=function(){var e=this.getSelectedText();return this.editorDelete(),e},e.prototype.copyEnabled=function(){return!!this.selectionMode},e.prototype.copy=function(){return this.getSelectedText()},e.prototype.pasteEnabled=function(){var e=this.getSelectedColumn(),t=this.getSelectedRow();return null!=e&&null!=t},e.prototype.paste=function(e){var t=this,i=this.getSelectedColumn(),o=this.getSelectedRow();if(null==i||null==o)return!1;for(var n=util.parseTABDelimitedTable(e),a=this.type,s=a.id,r=this.rows,l=this.cols,c=this.models,d=(this.groups,null!=this.cidxGroup),h=database.canCreate(a),p=[],u=i,f=o,m=1,g=0;g<n.length;g++){var v=o+g,y=n[g],b=v>=r.length,w=b?void 0:r[v],x=b?void 0:c[w];if(b||x){var T={};b?(T._type=s,T._clientId=m++):T._id=w;for(var C=0;C<y.length;C++){var k=i+C,S=y[C];if(l[k]){var _=this.getWritableField(k);if(_){var E=_.id;if((b||database.canWriteNodeField(w,E))&&(!b||h)){var D=b?void 0:x.values[E],N=_.parseClipboard(S);_.equals(D,N)||(T[E]=N,!0)}}}}p.push(T),u=Math.max(u,i+y.length),f++}}function I(){d?(t.reload(),$.loading(!1)):t.calc(t._reloadId,r,(function(){$.loading(!1),t.aggregate(),t.updateRows(),t.updateFoot(),t.selectBlock(o,i,f-1,u-1)}))}p.length&&($.loading(!0),t.silent=!0,database.updateNodes(p,(function(e,i){if(t.silent=!1,e)return $.loading(!1),void $.alert(e);if(m>1){r=r.slice();for(var o=[],n=1;n<=m;n++){var a=i[n];a&&(r.push(a),o.push(a))}database.loadNodes2(o,t.getDependencies(),(function(e){I()}))}else I()})))},e.prototype.getTextAtCell=function(e,t){var i=this.rows,o=this.cols,n=this.models,a=this.groups,s=i[t];if(!s)return"";var r=n[s],l=a[s],c=o[e];return c?r?c.field.formatClipboard(r.values[e]):l?e===this.cidxGroup?c.field.formatClipboard(l.values[e]):c.agg?c.aggType.formatClipboard(l.values[e]):"":"":""},e.prototype.getTextAtRange=function(e,t,i,o){if(e>i){var n=i;i=e,e=n}if(t>o){var a=o;o=t,t=a}for(var s=this.rows,r=this.cols,l=this.models,c=this.groups,d="",h=t;h<=o;h++){for(var p=e;p<=i;p++){var u="",f=s[h];if(f){var m=l[f],g=c[f],v=r[p];v&&(m?u=v.field.formatClipboard(m.values[p]):g&&(p===this.cidxGroup?u=v.field.formatClipboard(g.values[p]):v.agg&&(u=v.aggType.formatClipboard(g.values[p]))))}d+=util.formatTABDelimitedCell(u),p<i&&(d+="\t")}h<o&&(d+="\r\n")}return d}}function Ws(e){e.prototype.isEditable=function(e,t){var i=this.cols[e];if(!i)return!1;if(!i.expression)return!1;var o=i.expression.toString(),n=this.type.fields[o];if(!n)return!1;if("file"===n.base||"html"===n.base)return!1;if(!database.canWrite(n))return!1;var a=this.rows[t];return!!a&&(!!this.models[a]&&!!database.canWriteNodeField(a,o))},e.prototype.startEdit=function(e,t){if(null==e&&(e=this.getSelectedColumn()),null==t&&(t=this.getSelectedRow()),this.editor){if(this.editor.isCell(e,t))return void this.editor.startEdit();this.editor.destroy(),this.editor=void 0}var i=this.cols[e];if(i&&i.expression){var o=i.expression.toString(),n=this.type.fields[o];if(n&&"file"!==n.base&&"html"!==n.base&&database.canWrite(n)){var a=this.rows[t];a&&this.models[a]&&(this.editor=tables.createCellEditor(this,o,a,e,t),this.editor.startEdit())}}},e.prototype.stopEdit=function(e){this.editor&&(this.editor.stopEdit(e),this.editor.destroy(),this.editor=void 0)},e.prototype.updateEditor=function(){this.editor&&this.editor.update()},e.prototype.editorInsert=function(e){var t=this,i=!!this.editor;t.stopEdit(!0);var o=this.type;if(database.canCreate(o)){var n=this.getSelectedColumn(),a=this.getSelectedRow(),s="start"===e?0:"end"===e?t.rows.length:"up"===e?null!=a?a:0:"down"===e&&null!=a?a+1:t.rows.length;t.silent=!0,$.loading(!0),database.create(this.type.id,{},(function(e,o){if(t.silent=!1,$.loading(!1),e)return $.alert(e);if(o){var a=o._id;t.models[a]={id:a,values:[]},t.rows.splice(s,0,a),t.recalc(a,(function(){t.aggregate(),t.updateRows(),t.updateFoot(),t.selectCell(s,n),i&&t.startEdit(n,s)}))}}))}},e.prototype.editorPageUp=function(){this.rows;var e=this.selectionR0||0,t=Math.max(0,e-this.rowsPerPage()+1);this.selectCell(t,this.selectionC0)},e.prototype.editorPageDown=function(){var e=this.rows.length-1,t=this.rowsPerPage(),i=this.selectionR0||0,o=Math.min(e,i+t),n=Math.min(e,o+t-1);this.scrollToCell(void 0,n),this.selectCell(o,this.selectionC0)},e.prototype.editorNextGroup=function(){if(null!=this.cidxGroup)for(var e=this.rows,t=this.groups,i=(null==this.selectionR0?-1:this.selectionR0)+1;i<e.length;i++)if(t[e[i]])return void this.selectCell(i,void 0)},e.prototype.editorPrevGroup=function(){if(null!=this.cidxGroup)for(var e=this.rows,t=this.groups,i=(this.selectionR0||e.length)-1;i>=0;i--)if(t[e[i]])return void this.selectCell(i,void 0)},e.prototype.editorUp=function(e){var t=this.cols,i=this.rows,o=!!this.editor;if(this.stopEdit(!0),t.length&&i.length)if(!e||"cell"!==this.selectionMode&&"block"!==this.selectionMode){var n=void 0,a=0;this.selectionMode?(n=this.getSelectedColumn(),a=this.selectionR0-1):a=i.length-1,a<0&&(a=i.length-1),this.selectCell(a,n),o&&this.startEdit(n,a)}else this.selectionR0===this.selectionR1&&(this.extendSelectionUp=!0),this.extendSelectionUp?this.selectBlock(this.selectionR1,this.selectionC0,Math.max(0,this.selectionR0-1),this.selectionC1):this.selectBlock(this.selectionR0,this.selectionC0,Math.max(0,this.selectionR1-1),this.selectionC1),this.scrollToCell(void 0,this.selectionR1)},e.prototype.editorDown=function(e){var t=this.cols,i=this.rows,o=!!this.editor;if(this.stopEdit(!0),t.length&&i.length)if(!e||"cell"!==this.selectionMode&&"block"!==this.selectionMode){var n=void 0,a=0;this.selectionMode&&(n=this.getSelectedColumn(),a=this.selectionR0+1),a>=i.length&&(a=0),this.selectCell(a,n),o&&this.startEdit(n,a)}else this.selectionR0===this.selectionR1&&(this.extendSelectionUp=!1),this.extendSelectionUp?this.selectBlock(this.selectionR1,this.selectionC0,Math.min(i.length-1,this.selectionR0+1),this.selectionC1):this.selectBlock(this.selectionR0,this.selectionC0,Math.min(i.length-1,this.selectionR1+1),this.selectionC1),this.scrollToCell(void 0,this.selectionR1)},e.prototype.editorPrev=function(e){if("cell"===this.selectionMode||"block"===this.selectionMode){var t=!!this.editor;this.stopEdit(!0);var i=this.cols,o=this.rows;if(i.length&&o.length)if(!e||"cell"!==this.selectionMode&&"block"!==this.selectionMode){var n=this.selectionC0-1,a=this.selectionR0;n<0&&(n=i.length-1,a--),a<0&&(a=o.length-1),this.selectCell(a,n),t&&this.startEdit(n,a)}else this.selectionC0===this.selectionC1&&(this.extendSelectionLeft=!0),this.extendSelectionLeft?(this.selectBlock(this.selectionR0,this.selectionC1,this.selectionR1,Math.max(0,this.selectionC0-1)),this.scrollToCell(this.selectionC0,void 0)):(this.selectBlock(this.selectionR0,this.selectionC0,this.selectionR1,Math.max(0,this.selectionC1-1)),this.scrollToCell(this.selectionC1,void 0))}},e.prototype.editorNext=function(e){if("cell"===this.selectionMode||"block"===this.selectionMode){var t=!!this.editor;this.stopEdit(!0);var i=this.cols,o=this.rows;if(i.length&&o.length)if(!e||"cell"!==this.selectionMode&&"block"!==this.selectionMode){var n=this.selectionC0+1,a=this.selectionR0;n>=i.length&&(n=0,a++),a>=o.length&&(a=0),this.selectCell(a,n),t&&this.startEdit(n,a)}else this.selectionC0===this.selectionC1&&(this.extendSelectionLeft=!1),this.extendSelectionLeft?(this.selectBlock(this.selectionR0,this.selectionC1,this.selectionR1,Math.min(this.selectionC0+1,i.length-1)),this.scrollToCell(this.selectionC0,void 0)):(this.selectBlock(this.selectionR0,this.selectionC0,this.selectionR1,Math.min(this.selectionC1+1,i.length-1)),this.scrollToCell(this.selectionC1,void 0))}},e.prototype.editorFirst=function(e){var t=!!this.editor;if(this.stopEdit(!0),!e||"cell"!==this.selectionMode&&"block"!==this.selectionMode){var i=this.getSelectedColumn();this.rows.length>0&&(this.selectCell(0,i),t&&this.startEdit(i,0))}else this.selectBlock(0,this.selectionC0,this.selectionR1,this.selectionC1)},e.prototype.editorLast=function(e){var t=!!this.editor;if(this.stopEdit(!0),!e||"cell"!==this.selectionMode&&"block"!==this.selectionMode){var i=this.getSelectedColumn(),o=this.rows.length-1;o>=0&&(this.selectCell(o,i),t&&this.startEdit(i,o))}else this.selectBlock(this.selectionR0,this.selectionC0,this.rows.length-1,this.selectionC1)},e.prototype.editorDelete=function(){var e=this.type,t=this.rows,i=this.cols,o=this.models,n=this.selectionR0,a=this.selectionR1,s=this.selectionC0,r=this.selectionC1,l=this.selectionMode;if("block"===l){for(var c=[],d=n;d<=a;d++){if(o[m=t[d]]){for(var h=0,p={_id:m},u=s;u<=r;u++){var f=i[u].expression.toString();(g=e.fields[f])&&database.canWrite(g)&&(p[f]=null,h++)}h>0&&c.push(p)}}c.length&&($.loading(!0),database.updateNodes(c,(function(e){$.loading(!1),e&&$.alert(e)})))}else if("cell"===l){var m;if(o[m=t[n]]){var g;f=i[s].expression.toString();(g=e.fields[f])&&database.canWrite(g)&&database.update(m,f,null)}}},e.prototype.isEditing=function(){return!!this.editor}}function Bs(e){e.prototype.menuNextRecordEnabled=function(){return this.rows.length>0},e.prototype.menuNextRecord=function(){this.editorDown()},e.prototype.menuPrevRecordEnabled=function(){return this.rows.length>0},e.prototype.menuPrevRecord=function(){this.editorUp()},e.prototype.menuFirstRecordEnabled=function(){return this.rows.length>0},e.prototype.menuFirstRecord=function(){this.editorFirst()},e.prototype.menuLastRecordEnabled=function(){return this.rows.length>0},e.prototype.menuLastRecord=function(){this.editorLast()},e.prototype.menuCreateRecordEnabled=function(){return!(!this.type||!database.canCreate(this.type))},e.prototype.menuCreateRecord=function(){this.create()},e.prototype.menuDuplicateRecordEnabled=function(){return!!(this.getSelectedNid()&&this.type&&database.canCreate(this.type))},e.prototype.menuDuplicateRecord=function(){this.duplicate()},e.prototype.menuDeleteRecordEnabled=function(){return!!(this.getSelectedNid()&&this.type&&database.canDelete(this.type))},e.prototype.menuDeleteRecord=function(){this.remove()},e.prototype.menuPrintRecordEnabled=function(){return null!=this.getSelectedNid()&&!1!==database.authorizationPrint},e.prototype.menuPrintRecord=function(){this.print()},e.prototype.menuCloseRecordEnabled=function(){return null!=this.getSelectedNid()},e.prototype.menuCloseRecord=function(){this.unselect()},e.prototype.menuNewViewEnabled=function(){return database.isAdmin()},e.prototype.menuNewView=function(){database.isAdmin()&&this.container.createView()},e.prototype.menuRenameViewEnabled=function(){return database.isAdmin()},e.prototype.menuRenameView=function(){database.isAdmin()&&this.container.renameView()},e.prototype.menuDeleteViewEnabled=function(){return database.isAdmin()},e.prototype.menuDeleteView=function(){database.isAdmin()&&this.container.removeView()},e.prototype.menuEditColumnsEnabled=function(){return database.isAdmin()},e.prototype.menuEditColumns=function(){database.isAdmin()&&this.container.popupColumnMenu()},e.prototype.menuShowViewAsFormEnabled=function(){return database.isAdmin()},e.prototype.menuShowViewAsForm=function(){database.isAdmin()&&this.container.showForm()},e.prototype.menuShowViewAsTableEnabled=function(){return database.isAdmin()},e.prototype.menuShowViewAsTable=function(){database.isAdmin()&&this.container.showTable()},e.prototype.menuShowViewAsChartEnabled=function(){return database.isAdmin()},e.prototype.menuShowViewAsChart=function(){database.isAdmin()&&this.container.showChart()},e.prototype.menuFindInViewEnabled=function(){return!0},e.prototype.menuFindInView=function(){this.openFindMenu()},e.prototype.menuSelectAllRecordsEnabled=function(){return!0},e.prototype.menuSelectAllRecords=function(){this.chooseAll()},e.prototype.menuClearSelectionEnabled=function(){return!k.isEmpty(this.midChoosen)},e.prototype.menuClearSelection=function(){this.clearChoosen()},e.prototype.menuToggleSelectionEnabled=function(){return!k.isEmpty(this.midChoosen)},e.prototype.menuToggleSelection=function(){this.toggleChoosen()},e.prototype.menuShowAllRecordsEnabled=function(){return!k.isEmpty(this.midChoosen)},e.prototype.menuShowAllRecords=function(){this.showAll()},e.prototype.menuShowSelectedRecordsEnabled=function(){return!k.isEmpty(this.midChoosen)},e.prototype.menuShowSelectedRecords=function(){this.showOnlyChoosen()},e.prototype.menuExpandAllGroupsEnabled=function(){return null!=this.cidxGroup},e.prototype.menuExpandAllGroups=function(){this.expandAll()},e.prototype.menuCollapseAllGroupsEnabled=function(){return null!=this.cidxGroup},e.prototype.menuCollapseAllGroups=function(){this.collapseAll()},e.prototype.menuPrintViewEnabled=function(){return!!database.authorizationPrint},e.prototype.menuPrintView=function(){database.authorizationPrint&&Object(Ee.a)(this)},e.prototype.menuImportDataEnabled=function(){return!!database.authorizationImport},e.prototype.menuImportData=function(){database.authorizationImport&&new pi({tid:this.type.id})},e.prototype.menuExportDataEnabled=function(){return!!database.authorizationExport},e.prototype.menuExportData=function(){database.authorizationExport&&this.exportData((function(e){e&&$.alert(e)}))},e.prototype.menuMassDataUpdateEnabled=function(){return!!database.authorizationMassDataUpdate},e.prototype.menuMassDataUpdate=function(){database.authorizationMassDataUpdate&&new as(this)},e.prototype.menuReloadViewEnabled=function(){return!0},e.prototype.menuReloadView=function(){this.reload()},e.prototype.menuNewTableEnabled=function(){return database.isAdminEnabled()},e.prototype.menuNewTable=function(){database.isAdminEnabled()&&new eo({})},e.prototype.menuEditTableEnabled=function(){return database.isAdminEnabled()},e.prototype.menuEditTable=function(){database.isAdminEnabled()&&new eo({type:this.tid})},e.prototype.menuDeleteTableEnabled=function(){return database.isAdminEnabled()},e.prototype.menuDeleteTable=function(){var e=this;$.dialog({closable:!0,caption:locale.removeTable,message:locale.confirmRemoveTable,buttons:[{color:"red",caption:locale.removeTable,callback:function(){database.schema.removeType(e.type)}}]})},e.prototype.menuPageUpEnabled=function(){return this.rows.length>0},e.prototype.menuPageUp=function(){this.editorPageUp()},e.prototype.menuPageDownEnabled=function(){return this.rows.length>0},e.prototype.menuPageDown=function(){this.editorPageDown()},e.prototype.menuNextGroupEnabled=function(){return null!=this.cidxGroup},e.prototype.menuNextGroup=function(){this.editorNextGroup()},e.prototype.menuPrevGroupEnabled=function(){return null!=this.cidxGroup},e.prototype.menuPrevGroup=function(){this.editorPrevGroup()},e.prototype.menuExpandGroupEnabled=e.prototype.menuCollapseGroupEnabled=e.prototype.menuToggleGroupEnabled=function(){return!!this.groups[this.rows[this.selectionR0]]},e.prototype.menuExpandGroup=function(){this.expand(this.rows[this.selectionR0])},e.prototype.menuCollapseGroup=function(){this.collapse(this.rows[this.selectionR0])},e.prototype.menuToggleGroup=function(){this.toggle(this.rows[this.selectionR0])}}function qs(e){const t=0;e.prototype.registerScrollListeners=function(){TOUCH?(this.registerScrollTouchListeners(),this.registerScrollbarVTouchListeners()):(this.registerScrollMouseListeners(),this.registerScrollbarVMouseListeners(),this.registerScrollbarHMouseListeners()),this.registerRowResizeListeners()},e.prototype.registerRowResizeListeners=function(){var e=this;function t(t){if(!TOUCH||1===t.touches.length){var i=t.target;if($(i).is(".t-rowhead-resizer")){var o=TOUCH?t.touches[0].clientY:t.clientY,n=e.rowHeight,a=e.scrollTop;TOUCH?(EVENT_target(t).addEventListener(EVENT_touchend,r,!1),EVENT_target(t).addEventListener(EVENT_touchmove,s,!1)):(window.addEventListener("mouseup",r,!1),window.addEventListener("mousemove",s,!1)),t.preventDefault(),t.stopPropagation()}}function s(t){if(!TOUCH||1===t.touches.length){var i=(TOUCH?t.touches[0].clientY:t.clientY)-o;n<40?n+i>40&&(i=Math.max(40-n,i-24)):n+i<40&&(i=Math.min(40-n,i+24));var s=Math.min(120,Math.max(28,Math.round(n+i))),r=s-n;e.rowHeight=s,e.scrollTop=a+a/n*r,e.resizeRows(),e.updateSelection(),e.updateRows(),t.preventDefault()}}function r(t){TOUCH&&0!==t.touches.length||(TOUCH?(EVENT_target(t).removeEventListener(EVENT_touchend,r,!1),EVENT_target(t).removeEventListener(EVENT_touchmove,s,!1)):(window.removeEventListener("mousemove",s,!1),window.removeEventListener("mouseup",r,!1)),t.preventDefault(),e.saveTableRowHeight(e.rowHeight))}}this.$view.addEventListener(TOUCH?EVENT_touchstart:"mousedown",t,!1)},e.prototype.registerScrollbarVMouseListeners=function(){var e=this;function i(i){i.target;var o=i.clientY,n=e.scrollTop,a=e.rows.length+1,s=e.containerHeight()-e.headHeight-e.footHeight,r=s-4,l=Math.max(s,(e.rowHeight+t)*a),c=l/r;function d(t){var i=t.clientY-o;e.scrollTo(e.scrollLeft,Math.max(0,Math.min(l-s,Math.round(n+c*i)))),t.preventDefault()}function h(e){window.removeEventListener("mousemove",d,!1),window.removeEventListener("mouseup",h,!1),e.preventDefault()}window.addEventListener("mouseup",h,!1),window.addEventListener("mousemove",d,!1),i.preventDefault()}this.$scrollbarV.addEventListener("mousedown",i,!1)},e.prototype.registerScrollbarVTouchListeners=function(){var e=this;function i(i){if(1===i.touches.length){var o=i.touches[0].clientY,n=e.scrollTop,a=e.rows.length+1,s=e.containerHeight()-e.headHeight-e.footHeight,r=s-4,l=Math.max(s,(e.rowHeight+t)*a),c=l/r;EVENT_target(i).addEventListener(EVENT_touchmove,d,!1),EVENT_target(i).addEventListener(EVENT_touchend,h,!1)}function d(t){if(1===t.touches.length){var i=t.touches[0].clientY-o;e.scrollTo(e.scrollLeft,Math.max(0,Math.min(l-s,Math.round(n+c*i)))),t.preventDefault()}}function h(e){0===e.touches.length&&(EVENT_target(e).removeEventListener(EVENT_touchmove,d,!1),EVENT_target(e).removeEventListener(EVENT_touchend,h,!1),e.preventDefault())}}this.$scrollbarV.addEventListener(EVENT_touchstart,i,!1)},e.prototype.registerScrollbarHMouseListeners=function(){var e=this;function t(t){t.target;var i=t.clientX,o=e.scrollLeft,n=e.$container.clientWidth,a=n-4,s=e.viewWidth+40,r=s/a;function l(t){var a=t.clientX-i;e.scrollTo(Math.max(0,Math.min(s-n,Math.round(o+r*a))),e.scrollTop),t.preventDefault()}function c(e){window.removeEventListener("mousemove",l,!1),window.removeEventListener("mouseup",c,!1),e.preventDefault()}window.addEventListener("mouseup",c,!1),window.addEventListener("mousemove",l,!1),t.preventDefault()}this.$scrollbarH.addEventListener("mousedown",t,!1)},e.prototype.registerScrollMouseListeners=function(){var e=this;function i(i){var o=Math.max(0,(e.rows.length+1)*(e.rowHeight+t)-e.containerHeight()+e.headHeight+e.footHeight),n=(OSX_10_9_MODE?-i.wheelDeltaY:i.deltaY)*(1==i.deltaMode?e.rowHeight+t:2==i.deltaMode?window.getHeight():1),a=OSX_10_9_MODE?i.wheelDeltaX:-i.deltaX;Math.abs(a)>Math.abs(n)?n=0:a=0;var s=e.scrollTop,r=Math.min(Math.max(s+n,0),o),l=Math.min(Math.max(0,e.scrollLeft-a),Math.max(0,e.viewWidth+40-e.$container.clientWidth));e.scrollTo(l,r),i.preventDefault()}OSX_10_9_MODE?e.$body.addEventListener("mousewheel",i,!1):e.$body.addEventListener("wheel",i,!1)},e.prototype.registerScrollTouchListeners=function(){var e,i=this,o=0,n=0,a=0,s=0,r=0,l=0,c=0,d=null,h=!1,p=500,u=p*p,f=p/60,m=!1;function g(t){1===t.touches.length&&(h=!1,o=a=t.touches[0].clientX,n=s=t.touches[0].clientY,e=(new Date).getTime(),d=null,m=!1,window.addEventListener(EVENT_touchmove,v,!1),window.addEventListener(EVENT_touchend,y,!1))}function v(e){if(1===e.touches.length){h=!1;var t=e.touches[0].clientX,o=e.touches[0].clientY,n=t-a,r=o-s;if(!m){if(n*n+r*r<=4)return;m=!0}d||(d=Math.abs(n)>Math.abs(r)?"H":"V"),"H"===d?r=0:n=0;var l=Math.min(Math.max(0,i.scrollLeft-n),Math.max(0,i.viewWidth+40-i.$container.clientWidth)),c=i.scrollTop-r;i.scrollTo(l,c),a=t,s=o,e.preventDefault()}}function y(t){if(0===t.touches.length&&(window.removeEventListener(EVENT_touchmove,v,!1),window.removeEventListener(EVENT_touchend,y,!1),m)){var p=(new Date).getTime()-e;r="H"===d?(a-o)*f/p:0,l="V"===d?i.scrollTop<0?0:(s-n)*f/p:0,c=0,h=!0,requestAnimationFrame(b)}}function b(){if(h){var e=i.scrollTop,o=i.scrollLeft,n=Math.max(0,(i.rows.length+1)*(i.rowHeight+t)-i.containerHeight()+i.headHeight+i.footHeight);if(e<0){var a=e-10*e*f/p;Math.abs(a)<.1&&(a=0),i.scrollTo(o,a),requestAnimationFrame(b)}else if(0===e)h=!1;else if(e>n){a=e-10*(e-n)*f/p;Math.abs(a-n)<.1&&(a=n),i.scrollTo(o,a),requestAnimationFrame(b)}else if(e===n)h=!1;else if(c>=p)h=!1;else{var s=1-c*c/u;if(!isNaN(s)){var d=s*r,m=s*l,g=Math.min(Math.max(0,o-d),Math.max(0,i.viewWidth+40-i.$container.clientWidth));a=e-m;i.scrollTo(g,a)}c+=f,requestAnimationFrame(b)}}}i.$body.addEventListener(EVENT_touchstart,g,!1)},e.prototype.registerHeadResizeListeners=function(){var e=this;function t(t){if(!TOUCH||1===t.touches.length){var o=t.target;if("t-head-resizer"===o.className){var n=o.parentNode.getAttribute("data-cidx");if(n){n=parseInt(n);var a=e.cols[n];if(a){var s=a.width,r=TOUCH?t.touches[0].clientX:t.clientX,l=TOUCH?t.touches[0].clientY:t.clientY,c=!1;return TOUCH?(EVENT_target(t).addEventListener(EVENT_touchmove,d,!1),EVENT_target(t).addEventListener(EVENT_touchend,h,!1)):(document.addEventListener("mousemove",d,!1),document.addEventListener("mouseup",h,!1)),i(t),!1}}}}function d(t){if(!TOUCH||1===t.touches.length){var o=TOUCH?t.touches[0].clientX:t.clientX,n=TOUCH?t.touches[0].clientY:t.clientY,d=o-r,h=n-l,p=Math.abs(d)>Math.abs(h)?d:h;if(Math.abs(p)>1&&(c=!0),c){c=!0;var u=Math.max(e.minColWidth,s+p);a.width=u,e.resizeColumns()}return i(t),!1}}function h(t){if(!TOUCH||0===t.touches.length)return TOUCH?(EVENT_target(t).removeEventListener(EVENT_touchmove,d,!1),EVENT_target(t).removeEventListener(EVENT_touchend,h,!1)):(document.removeEventListener("mousemove",d,!1),document.removeEventListener("mouseup",h,!1)),c?e.setColumnWidth(n,s,a.width):e.touchHead(t),e.saveView(),i(t),!1}}function i(e){e.preventDefault(),e.stopPropagation()}TOUCH?e.$head.addEventListener(EVENT_touchstart,t,!1):e.$head.addEventListener("mousedown",t,!1)},e.prototype.registerHeadDragListeners=function(){var e=this;function t(t){if(!TOUCH||1===t.touches.length){var i=t.target;if("t-head-resizer"!==i.className){for(;i&&"t-head-cell"!==i.className;)i=i.parentNode;if(i)if(i.getAttribute("data-action"))e.touchHead(t);else{var o=i.getAttribute("data-cidx");if(o){o=parseInt(o);var n=e.cols,a=n[o];if(a){var s=e.$container.getBoundingClientRect(),r=a.left,l=TOUCH?t.touches[0].clientX:t.clientX,c=(e.scrollLeft,!1),d=o,h=[];f(),TOUCH?(EVENT_target(t).addEventListener(EVENT_touchmove,p,!0),EVENT_target(t).addEventListener(EVENT_touchend,u,!0)):(window.addEventListener("mousemove",p,!0),window.addEventListener("mouseup",u,!0)),t.preventDefault(),t.stopPropagation()}}}}}function p(t){if(!TOUCH||1===t.touches.length){var i=TOUCH?t.touches[0].clientX:t.clientX,p=i-l;if(Math.abs(p)>3){c=!0,a.$headCell.style.zIndex="1",a.$headCell.style.backgroundColor="rgba(200,200,200,.5)",a.$footCell.style.zIndex="1",a.$footCell.style.backgroundColor="rgba(200,200,200,.5)";for(var u=e.viewRows,m=0;m<u.length;m++){u[m].$cells[o].style.zIndex=1}}if(c){var g=r+p+"px";a.$headCell.style.left=g,a.$footCell.style.left=g;for(u=e.viewRows,m=0;m<u.length;m++)u[m].$cells[o].style.left=g;for(var v=e.leftWidth+s.left,y=0;y<h.length;y++){var b=n[h[y]],w=v-e.scrollLeft,x=w+b.width/3,T=w+2*b.width/3,C=w+b.width;if(y!==d){if(w<=i&&x>i){d=y,f();break}if(T<i&&C>=i){d=y+1,f();break}}v+=b.width}}t.preventDefault(),t.stopPropagation()}}function u(t){if(!TOUCH||0===t.touches.length){if(TOUCH?(EVENT_target(t).removeEventListener(EVENT_touchmove,p,!0),EVENT_target(t).removeEventListener(EVENT_touchend,u,!0)):(window.removeEventListener("mousemove",p,!0),window.removeEventListener("mouseup",u,!0)),c){a.$headCell.style.zIndex="",a.$headCell.style.backgroundColor="",a.$footCell.style.zIndex="",a.$footCell.style.backgroundColor="";for(var i=e.viewRows,s=0;s<i.length;s++){i[s].$cells[o].style.zIndex=""}if(o===d)e.resizeColumns();else{var r=void 0!==e.cidxSort?n[e.cidxSort]:void 0,l=void 0!==e.cidxSort?n[e.cidxGroup]:void 0;Object(Ko.b)(n,o,d),r&&(e.cidxSort=n.indexOf(r)),l&&(e.cidxGroup=n.indexOf(l));e.rows;var h=e.models,f=e.groups;for(var m in h)if(h.hasOwnProperty(m)){var g=h[m];Object(Ko.b)(g.values,o,d)}for(var v in f)if(f.hasOwnProperty(v)){var y=f[v];Object(Ko.b)(y.values,o,d)}Object(Ko.b)(e.foot.values,o,d),e.createCells(),e.resizeColumns(),e.updateHead(),e.updateRows(),e.updateFoot(),e.saveView(),e.retainSelection()}}else e.touchHead(t);t.preventDefault(),t.stopPropagation()}}function f(){h=[];for(var t=0;t<n.length;t++)h[t]=t;h.splice(o,1),h.splice(d,0,o);for(var i=e.leftWidth,a=e.viewRows,s=0;s<a.length;s++){var r=a[s];i=e.leftWidth;for(t=0;t<h.length;t++){var l=(c=n[h[t]]).width;if(t!==d)r.$cells[h[t]].style.left=i+"px";i+=l}}i=e.leftWidth;for(t=0;t<h.length;t++){var c;l=(c=n[h[t]]).width;if(t!==d)c.$headCell.style.left=i+"px",c.$footCell.style.left=i+"px";i+=l}}}TOUCH?e.$head.addEventListener(EVENT_touchstart,t,!1):e.$head.addEventListener("mousedown",t,!1)},e.prototype.registerBodyListeners=function(){TOUCH?this.registerBodyListeners_TOUCH():this.registerBodyListeners_NOTOUCH()},e.prototype.registerBodyListeners_TOUCH=function(){var e=this;function i(i){if(1===i.touches.length){i.preventDefault(),i.stopPropagation();var o=e.cols,n=e.$container.getBoundingClientRect(),a=n.height,s=(n.top,i.touches[0].clientX),r=i.touches[0].clientY,c=s,d=r,h=0,p=0,u=w(s),f=x(r),m=!1,g=e.rows[f],v=e.groups[g];EVENT_target(i).addEventListener(EVENT_touchmove,y,!1),EVENT_target(i).addEventListener(EVENT_touchend,b,!1)}function y(e){1===e.touches.length&&(c=e.touches[0].clientX,d=e.touches[0].clientY,(h=c-s)*h+(p=d-d)*p>4&&(m=!0))}function b(t){if(0===t.touches.length&&(EVENT_target(t).removeEventListener(EVENT_touchmove,y,!1),EVENT_target(t).removeEventListener(EVENT_touchend,b,!1),!m)){if(v)return void e.toggle(g);if(f>e.rows.length||f<0)return void e.selectNothing();if(f===e.rows.length)return e.create(),void Object(l.f)("Table","CreateRecord");if(-1===u)return void(e.isTableEditMode()?e.selectRow(f):e.toggleRowChoosen(f,t.shiftKey));e.getSelectedRow()===f?e.selectNothing():e.selectRow(f)}}function w(t){var i=n.left,a=i+e.leftWidth;if(t>=i&&t<=a)return-1;for(var s=a-e.scrollLeft,r=0;r<o.length;r++){var l=o[r];if(t>=s&&t<=s+l.width)return r;s+=l.width}return o.length-1}function x(i){var o=n.top+e.headHeight;return Math.floor((i+e.scrollTop-o)/(e.rowHeight+t))}}e.$body.addEventListener(EVENT_touchstart,i,!1)},e.prototype.registerBodyListeners_NOTOUCH=function(){var e=this;function i(i){if((!TOUCH||1===i.touches.length)&&(TOUCH||1===i.which)){var o,n,a=e.cols,s=e.$container.getBoundingClientRect(),r=s.height,c=s.top,d=c+r,h=TOUCH?i.touches[0].clientX:i.clientX,p=TOUCH?i.touches[0].clientY:i.clientY,u=h,f=p,m=0,g=0,v=L(h),y=j(p),b=v,w=y,x=null,T=null,C=0,k=0,$=Date.now(),S=Math.abs($-e.lastMouseDown);e.lastMouseDown=$;var _=e.rows[y],E=e.groups[_];if(!e.editor||v!==e.editor.c||y!==e.editor.r)if(e.stopEdit(!0),i.preventDefault(),i.stopPropagation(),E)e.toggle(_);else if(y>e.rows.length||y<0)e.selectNothing();else{if(y===e.rows.length)return e.create(),void Object(l.f)("Table","CreateRecord");if(-1!==v)if(S<400&&!e.isTableEditMode())e.selectCell(y,v);else{if("t-selection-drag"===i.target.className){if(o=e.getSelectedRow(),n=e.getSelectedColumn(),!e.getWritableField(n))return;x="drag",T=$DIV("t-drag",e.$view),w=o,O()}else if(i.shiftKey)return y=e.getSelectedRow(),v=e.getSelectedColumn(),null==y&&(y=0),null==v&&(v=0,b=a.length-1),void e.selectBlock(y,v,w,b);window.addEventListener(TOUCH?EVENT_touchmove:"mousemove",D,!1),window.addEventListener(TOUCH?EVENT_touchend:"mouseup",I,!1)}else e.isTableEditMode()?e.selectRow(y):e.toggleRowChoosen(y,i.shiftKey)}}function D(i){if(!TOUCH||1===i.touches.length){u=TOUCH?i.touches[0].clientX:i.clientX,f=TOUCH?i.touches[0].clientY:i.clientY,m=u-h,g=f-p;var o=f-c,n=f-d;o<e.rowHeight+t?M(o-(e.rowHeight+t)):n>-(e.rowHeight+t)?M(n+(e.rowHeight+t)):F(),i.preventDefault(),i.stopPropagation(),N()}}function N(){(b=L(u))<0&&(b=0),(w=j(f))<0&&(w=0),w>e.rows.length&&(w=e.rows.length-1),x?"select"===x?e.selectBlock(y,v,w,b):"drag"===x&&(w>e.rows.length-1&&(w=e.rows.length-1),O()):m*m+g*g>4&&(x="select",e.selectBlock(y,v,w,b))}function I(t){TOUCH&&0!==t.touches.length||(window.removeEventListener(TOUCH?EVENT_touchmove:"mousemove",D,!1),window.removeEventListener(TOUCH?EVENT_touchend:"mouseup",I,!1),F(),"select"===x?v===b&&y===w&&(x=null):"drag"===x&&($REMOVE(T),o!==w&&e.dragValue(n,o,w<o?w:o+1,w<o?o-1:w,t.shiftKey,w<o)),x||(e.isCellSelection()?e.isCellSelected(y,v)?e.startEdit(v,y):e.selectCell(y,v):e.isTableEditMode()?e.selectCell(y,v):e.isRowSelected(y)?e.selectNothing():e.selectRow(y)),x=null,t.preventDefault(),t.stopPropagation())}function O(){if(o===w)T.style.display="none";else{var t=o<w?o+1:w,i=o<w?w:o-1;T.style.display="",T.style.left=e.colX(n,n)+"px",T.style.width=e.colW(n,n)+"px",T.style.top=e.rowY(t,t)+"px",T.style.height=e.rowHWithMargin(t,i)+"px"}}function M(e){var t=Math.min(1,Math.max(-1,e/80)),i=Math.sign(t)*(Math.sin(t*Math.PI-Math.PI/2)+1)*1024;0===C?(C=i,k=performance.now(),requestAnimationFrame(R)):C=i}function F(){C=0}function R(){if(0!==C){var i=performance.now(),o=Math.abs(i-k),n=Math.round(C*o/1e3),a=e.scrollTop+n,s=e.rows.length+1,r=e.containerHeight()-2*(e.rowHeight+t),l=Math.max(r,(e.rowHeight+t)*(s-1));e.scrollTo(e.scrollLeft,Math.max(0,Math.min(l-r,a))),k=i,N(),requestAnimationFrame(R)}}function L(t){var i=s.left,o=i+e.leftWidth;if(t>=i&&t<=o)return-1;for(var n=o-e.scrollLeft,r=0;r<a.length;r++){var l=a[r];if(t>=n&&t<=n+l.width)return r;n+=l.width}return a.length-1}function j(i){var o=s.top+e.headHeight;return Math.floor((i+e.scrollTop-o)/(e.rowHeight+t))}}e.$body.addEventListener(TOUCH?EVENT_touchstart:"mousedown",i,!1)}}function Ys(e){e.prototype.selectLastRow=function(){this.selectRow(void 0===this.lastSelectedRow?0:this.lastSelectedRow,"row"),this.scrollToCell(0,this.lastSelectedRow)},e.prototype.isTableEditMode=function(){return"cell"===this.selectionMode||"block"===this.selectionMode},e.prototype.isRowSelection=function(){return"row"===this.selectionMode},e.prototype.isRowSelected=function(e){return"row"===this.selectionMode&&this.selectionR0===e},e.prototype.isCellSelection=function(){return"cell"===this.selectionMode},e.prototype.isCellSelected=function(e,t){return"cell"===this.selectionMode&&this.selectionR0===e&&this.selectionC0===t},e.prototype.getSelectedRow=function(){return this.selectionMode?this.selectionR0:void 0},e.prototype.getSelectedColumn=function(){var e=this.selectionMode;return"cell"===e||"block"===e?this.selectionC0:void 0},e.prototype.getSelectedNid=function(){return this.selectionMid0},e.prototype.selectNothing=function(){this.stopEdit(),this.setSelection(void 0,void 0,void 0,void 0,void 0,!1)},e.prototype.selectRow=function(e,t){this.lastSelectedRow=e,this.stopEdit();var i=this.rows,o=this.models;e>=0&&e<i.length&&o[i[e]]?this.setSelection("row",e,void 0,e,void 0,!!t):this.selectNothing()},e.prototype.selectCell=function(e,t,i){this.lastSelectedRow=e;var o=this.rows,n=this.cols;e>=0&&e<o.length&&(null==t||t>=0&&t<n.length)?(null!=t?this.setSelection("cell",e,t,e,t,!!i):this.setSelection("row",e,void 0,e,void 0,!!i),this.scrollToCell(t,e)):this.selectNothing()},e.prototype.selectBlock=function(e,t,i,o,n){this.lastSelectedRow=e,this.stopEdit();var a=this.rows,s=this.cols;e>=0&&e<a.length&&i>=0&&i<a.length&&t>=0&&t<s.length&&o>=0&&o<s.length?this.setSelection("block",Math.min(e,i),Math.min(t,o),Math.max(e,i),Math.max(t,o),!!n):this.selectNothing()},e.prototype.setSelection=function(e,t,i,o,n,a){var s=this.selectionMode!==e;if(s&&this.removeSelection(),this.selectionMode=e,this.selectionR0=t,this.selectionC0=i,this.selectionR1=o,this.selectionC1=n,e){var r=this.rows;this.selectionMid0=r[t],this.selectionMid1=r[o]}else this.selectionMid0=void 0,this.selectionMid1=void 0;s&&this.createSelection(),this.updateSelection(),this.retainSideEditor(a),this.container.selectionChanged()},e.prototype.createSelection=function(){if(!this.selectionIsCreated)switch(this.selectionIsCreated=!0,this.selectionMode){case"row":this.$selectionEl1=$DIV("t-selection t-selection-row",this.$selectionContainer),this.$headSelection=$DIV("t-selection t-selection-row-head",this.$headSelectionContainer);break;case"cell":this.$selectionEl1=$DIV("t-selection t-selection-cell-1",this.$selectionContainer),this.$selectionElDrag=$DIV("t-selection-drag",this.$selectionContainer);break;case"block":this.$selectionEl1=$DIV("t-selection t-selection-block",this.$selectionContainer)}},e.prototype.removeSelection=function(){if(this.selectionIsCreated)switch(this.selectionIsCreated=!1,this.selectionMode){case"row":$REMOVE(this.$selectionEl1),$REMOVE(this.$headSelection),this.$selectionEl1=void 0;break;case"cell":$REMOVE(this.$selectionEl1),$REMOVE(this.$selectionElDrag),this.$selectionEl1=void 0,this.$selectionElDrag=void 0;break;case"block":$REMOVE(this.$selectionEl1),this.$selectionEl1=void 0}},e.prototype.updateSelection=function(){const e=this.leftWidth;switch(this.selectionMode){case"row":var t=this.rowY(this.selectionR0,this.selectionR0),i=this.rowH(this.selectionR0,this.selectionR0)-1,o=this.viewWidth,n=this.$selectionEl1,a=this.$headSelection;a.style.left="2px",a.style.top=t+"px",a.style.width="40px",a.style.height=i+"px",n.style.left=e+1+"px",n.style.top=t+"px",n.style.width=o-e-2+"px",n.style.height=i+"px";break;case"cell":n=this.$selectionEl1;var s=this.$selectionElDrag,r=this.selectionC0,l=this.selectionR0,c=(t=this.rowY(l,l),i=this.rowH(l,l)-1,this.colX(r,r)),d=c+this.colW(r,r)-1;this.viewWidth;n.style.left=c+"px",n.style.top=t+"px",n.style.width=d-c+"px",n.style.height=i+"px",this.isEditable(r,l)?n.className="t-selection t-selection-cell-2 editable":n.className="t-selection t-selection-cell-2",!!this.getWritableField(r)?(s.style.display="",s.style.left=d-4+"px",s.style.top=t+i-5+"px"):s.style.display="none";break;case"block":var h=this.$selectionEl1,p=this.selectionC0,u=this.selectionC1,f=this.selectionR0,m=this.selectionR1,g=this.colX(p,u);o=this.colW(p,u)-1,t=this.rowY(f,m),i=this.rowHWithMargin(f,m);h.style.left=g+"px",h.style.width=o+"px",h.style.top=t+"px",h.style.height=i+"px"}},e.prototype.getSelectedText=function(){switch(this.selectionMode){case"row":return this.getTextAtRange(0,this.selectionR0,this.cols.length-1,this.selectionR0);case"cell":return this.getTextAtCell(this.selectionC0,this.selectionR0);case"block":return this.getTextAtRange(this.selectionC0,this.selectionR0,this.selectionC1,this.selectionR1);default:return""}},e.prototype.retainSelection=function(e){if(console.log("Table.retainSelection"),this.selectionMode){var t=this.rows,i=this.cols.length-1,o=t.indexOf(this.selectionMid0),n=t.indexOf(this.selectionMid1);if(-1===o||-1===n){let t=!1;if(!e&&null!=this.cidxGroup)for(const e in this.groups)if(this.groups.hasOwnProperty(e)&&-1!==this.groups[e].children.indexOf(this.selectionMid0)){this.expanded[e]||(this.expandSilently(e),this.updateRows(),this.rowsChanged()),t=!0;break}return t?void this.select(this.selectionMid0):void this.selectNothing()}this.selectionR0=Math.min(o,n),this.selectionR1=Math.max(o,n),null!=this.selectionC0&&(this.selectionC0=Math.min(i,Math.max(0,this.selectionC0)),null!=this.selectionC1&&(this.selectionC1=Math.min(i,Math.max(0,this.selectionC0,this.selectionC1)))),this.updateSelection()}this.retainSideEditor(!1)},e.prototype.retainSideEditor=function(e){if(this.visible){var t=this.selectionMid0;t&&!!this.models[t]&&"row"===this.selectionMode?ui.sideEditor.open(t,this.sideEditorOptions,!!e):ui.sideEditor.close(!0),ui.recordNavigation.updateUI()}}}Hs.prototype.destroy=function(){this.xlsUseFieldFormatField.destroy()},Hs.prototype.getXLSExportOptions=function(){return{useFieldFormat:this.xlsUseFieldFormat.value}},Hs.prototype.saveXLSExportOptions=function(){Us.xlsUseFieldFormat=this.xlsUseFieldFormat.value},zs.prototype.destroy=function(){this.popdown.close($.proxy(this.closed,this))},zs.prototype.closed=function(){this.exportCSVSettings.destroy(),this.exportXLSSettings.destroy()},zs.prototype.close=function(){this.destroy()},zs.prototype.csvExportOpen=async function(){Object(l.f)("ExportData","TableCSVOpen");var e=this;this.exportCSVSettings.saveCSVExportOptions();var t=this.exportCSVSettings.csvEncoding.value,i=this.renderCSV(),o=await localFileSystem.tempURL(e.suggestFileName()+".csv");try{await localFileSystem.writeURL(o,i,t),e.destroy(),NinoxDocumentInteraction.previewDocument(o,(async function(){0}))}catch(e){$.alert(e)}},zs.prototype.csvExportOpen_WEB=function(){Object(l.f)("ExportData","TableCSVOpenWeb");var e=this;this.exportCSVSettings.saveCSVExportOptions();this.exportCSVSettings.csvEncoding.value;var t=this.renderCSV(),i=e.suggestFileName()+".csv",o="text/csv";NinoxDocumentInteraction.openFileWithServer(i,o,t,!1,!0),e.destroy()},zs.prototype.csvExportSaveAs=function(){Object(l.f)("ExportData","TableCSVSaveAs");var e=this;this.exportCSVSettings.saveCSVExportOptions(),NinoxDocumentInteraction.saveFile(e.suggestFileName(),"csv",(async function(t,i){if(t)return $.alert(t);if(i){var o=e.exportCSVSettings.csvEncoding.value,n=e.renderCSV();try{await localFileSystem.writeURL(i,n,o),e.destroy()}catch(t){$.alert(t)}}}))},zs.prototype.suggestFileName=function(){var e=this.table,t=e.type&&e.type.caption||locale.unnamed,i=e.container&&e.container.getViewCaption()||void 0;i==locale.all&&(i=void 0);var o=t+(i?" - "+i:"");return util.escapeFileName(o)},zs.prototype.csvExportSaveICloud=async function(){Object(l.f)("ExportData","TableCSVSaveICloud")},zs.prototype.renderCSV=function(){return util.renderCSV(database,this.table,this.exportCSVSettings.getCSVExportOptions())},zs.prototype.xlsExportOpen=async function(){Object(l.f)("ExportData","TableExcelOpen");var e=this;this.exportXLSSettings.saveXLSExportOptions();var t=this.renderXLS();try{var i=await localFileSystem.tempURL(e.suggestFileName()+".xlsx");await localFileSystem.writeURLBase64(i,t),e.destroy(),NinoxDocumentInteraction.previewDocument(i,(async function(){0}))}catch(e){$.alert(e)}},zs.prototype.xlsExportOpen_WEB=function(){Object(l.f)("ExportData","TableExcelOpenWeb");var e=this;this.exportXLSSettings.saveXLSExportOptions();var t=this.renderXLS(),i=e.suggestFileName()+".xlsx",o="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";NinoxDocumentInteraction.openFileWithServer(i,o,t,!0,!0),e.destroy()},zs.prototype.xlsExportSaveAs=function(){Object(l.f)("ExportData","TableExcelSaveAs");var e=this;this.exportXLSSettings.saveXLSExportOptions(),NinoxDocumentInteraction.saveFile(e.suggestFileName(),"xlsx",(async function(t,i){if(t)return $.alert(t);if(i){var o=e.renderXLS();try{await localFileSystem.writeURLBase64(i,o),e.destroy()}catch(t){$.alert(t)}}}))},zs.prototype.xlsExportSaveICloud=async function(){Object(l.f)("ExportData","TableExcelSaveICloud")},zs.prototype.renderXLS=function(){var e=this.exportXLSSettings.getXLSExportOptions(),t=e&&e.useFieldFormat,i={},o=this.table,n=o.cols,a=o.rows,s=o.groups,r=o.models,l=[],c=[];l.push(c);for(var d={},h=0;h<n.length;h++){for(var p=n[h],u=util.escapeXLSColumnHead(p.caption||p.expression.caption,h),f=u,m=2;d[f.toLocaleLowerCase()];m++)f=u+m;d[f.toLocaleLowerCase()]=!0,c[h]={value:f,autoWidth:!0}}if(a.length)for(var g=0;g<a.length;g++){var v=a[g],y=s[v];c=[];if(l.push(c),y)for(h=0;h<n.length;h++){p=n[h];database.canRead(p.expression)?h===o.cidxGroup?c[h]=x(p.field,y.values[h]):p.aggType?c[h]=x(p.aggType,y.values[h]):c[h]="":c[h]=""}else{var b=r[v];for(h=0;h<n.length;h++){p=n[h];database.canRead(p.expression)?c[h]=x(p.field,b.values[h]):c[h]=""}}}else{var c=[];l.push(c);for(var h=0;h<n.length;h++)c[h]=""}var w={worksheets:[{table:!0,name:util.escapeFileName(o.type.caption).substr(0,30),data:l}]};return xlsx(w).base64;function x(e,i){if(t)switch(e.base){case"number":return{value:null==i?"":i,formatCode:T(e.numberFormat)};case"date":case"timestamp":return null==i?"":new Date(i);case"html":return i?String(i):"";default:return e.format(i)}else switch(e.base){case"number":return null==i?"":i;case"date":case"timestamp":return null==i?"":new Date(i);case"html":return i?String(i):"";default:return e.format(i)}}function T(e){if(e){var t=i[e];if(t)return i[e];var o=util.parseNumberFormat(e);return t=C(o.prefix)+(o.group?"#,##0":"0")+(o.allDigits?".#":o.trailingZeros?"."+k("0",o.trailingZeros):"")+C(o.suffix),i[e]=t,t}}function C(e){return(e?'"'+e.replace(/\"/g,'"\\""')+'"':"").replace(/\"/g,"&quot;")}function k(e,t){for(var i="",o=0;o<t;o++)i+=e;return i}};var Xs=0,Gs=20,Js=void 0;function Ks(e){var t=this;this.contextState={},this._reloadId=0,this._loadCallbacks=[],this.rowHeight=this.loadTableRowHeight(),this.headHeight=40,this.footHeight=40,this.leftWidth=44,this.minColWidth=32,this.rowHeadWidth=44,this.container=e,this.models={},this.groups={},this.groupsSorted=[],this.rows=[],this.cols=[],this.ridxTop=0,this.viewRows=[],this.removedIndex={},this.selectionMode=void 0,this.selectionR0=void 0,this.selectionC0=void 0,this.selectionR1=void 0,this.selectionC1=void 0,this.selectionMid0=void 0,this.selectionMid1=void 0,this.selectionIsCreated=!1,this.extendSelectionUp=!1,this.extendSelectionLeft=!1,this.editor=void 0,this.midChoosen={},this.expanded={},this.cidxSort=0,this.cidxGroup=void 0,this.sortDescending=!1,this.onlyChoosen=!1,this.ready=!1,this.visible=!1,this.silent=!1,this.mouseover=!1,this.scrollTop=0,this.scrollLeft=0,this.viewX=0,this.viewY=0,this.scrollDoneTimeout=null,this.scrollDoneTime=0,this.scrollDone=$.proxy(this.scrollDone,this),this.viewTop=0,this.viewLeft=0,this.viewHeight=0,this.viewWidth=0,this.viewRows=0,this.isMouseOver=!1,this.lastMouseDown=0,this.recordController={hasNextRecord:function(){return t.rows.length>0},nextRecord:function(){t.editorDown()},hasPrevRecord:function(){return t.rows.length>0},prevRecord:function(){t.editorUp()},lastRecord:function(){t.editorLast()},firstRecord:function(){t.editorFirst()},hasAddRecord:function(){return!(!t.type||!database.canCreate(t.type))},addRecord:function(){t.create()},hasDuplicateRecord:function(){return!!(t.getSelectedNid()&&t.type&&database.canCreate(t.type))},duplicateRecord:function(){t.duplicate()},hasRemoveRecord:function(){return!!(t.getSelectedNid()&&t.type&&database.canDelete(t.type))},removeRecord:function(){t.remove()},hasPrintRecord:function(){return!(!t.getSelectedNid()||!1===database.authorizationPrint)},printRecord:function(){t.print()}},this.$container=$DIV("t-container"),this.$selectionContainer=void 0,this.$headSelectionContainer=void 0,this.$head=$DIV("t-head",this.$container),this.$foot=$DIV("t-foot",this.$container);this.$body=$DIV("t-body",this.$container);this.$content=$DIV("t-content --ul-table-content",this.$body),this.$view=$DIV("t-view",this.$content),this.$rowHeads=$DIV("t-rowheads",this.$view),this.$headRuler=$DIV("t-head-ruler i-16 i-light-grey i-reload",this.$container),$(this.$headRuler).touch($.proxy(this.reload,this)),this.$footRuler=$DIV("t-foot-ruler",this.$container),this.$scrollbarVContainer=$DIV("t-scrollbar-v-container",this.$container),this.$scrollbarV=$DIV("t-scrollbar-v",this.$scrollbarVContainer),this.$scrollbarHContainer=$DIV("t-scrollbar-h-container",this.$container),this.$scrollbarH=$DIV("t-scrollbar-h",this.$scrollbarHContainer),this.$scrollHIndicator=$DIV("t-scroll-h-indicator",this.$container),this.$scrollVIndicator=$DIV("t-scroll-v-indicator",this.$container),this.registerHeadResizeListeners(),this.registerHeadDragListeners(),this.registerScrollListeners(),this.registerBodyListeners(),this.$body.addEventListener("contextmenu",$.proxy(this.openContextMenu,this),!1),this.$head.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.$foot.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),this.resizeListener=k.debounce($.proxy(this.resizeListener,this),100),this.sideEditorOptions={close:$.proxy(this.unselect,this),next:$.proxy(this.editorDown,this),prev:$.proxy(this.editorUp,this),first:$.proxy(this.editorFirst,this),last:$.proxy(this.editorLast,this),duplicate:$.proxy(this.duplicate,this),getSelectedNids:$.proxy(this.getSelectedNids,this)},database.on("rename",void 0,this.nodeRenamed,this),database.on("create",void 0,this.nodeCreated,this),database.on("change",void 0,this.nodeChanged,this),database.on("remove",void 0,this.nodeRemoved,this),database.on("schema",void 0,this.schemaChanged,this)}function Qs(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function Zs(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Qs(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qs(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function er(){var e=this;this.popupTabsOpen=null,this.$controls=$('<div class="hud-menu-group" style="margin-left:12px">'),database.isAdmin()&&$('<div class="hud-menu-button i-32-24 i-light-grey i-setting-filter" title="'+htmlEscape(locale.editColumns)+'" style="margin-right:2px">').appendTo(this.$controls).touch((function(){e.popupColumnMenu()})),this.$popupActions=$(`<div \n            class="hud-menu-button i-32-24 i-light-grey i-setting-settings" \n            title="${htmlEscape(locale.actions)}" \n         />\n        <div class="hud-menu-button i-24-12 i-light-grey i-line-down-thick table-head-settings-arrow"/>`).appendTo(this.$controls).touch((function(){e.popupActions()})),this.$searchContainer=$('<div class="hud-menu-search">').appendTo(this.$controls),this.$menuSmall=$('<span style="display: none">').appendTo(this.$controls),this.$popupContext=$('<div class="hud-menu-button i-24-24 i-light-grey i-column">').appendTo(this.$menuSmall).touch((function(t){e.popupContextMenu(t)})),this.$searchPlaceholder=$('<div class="hud-menu-search-placeholder">').appendTo(this.$searchContainer),$('<div class="i-24-16 i-light-grey i-search table-head-search">').appendTo(this.$searchPlaceholder),this.$searchText=$('<div class="table-head-search-text">').appendTo(this.$searchPlaceholder),this.$search=$('<input type="text" class="hud-menu-search-input" style="display:none" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">').appendTo(this.$searchContainer).change($.proxy(this.searchChanged,this)),this.$searchCancel=$('<div class="i-32-16 i-light-grey i-close" style="margin-left:-32px;margin-top:4px;display:none">').appendTo($('<div style="width:0;flex:0 0 0px;-webkit-flex:0 0 0px">').appendTo(this.$searchContainer)).touch((function(){e.$search.val(""),e.searchChanged()})),this.$searchPlaceholder.touch((function(){e.$searchPlaceholder.css("display","none"),e.$search.css("display","").focus()})),this.$search.blur((function(){e.$searchPlaceholder.css("display",""),e.$search.css("display","none")})),this.$menuContainer=$("<div>"),this.$tabs=$('<div style="display:flex;display:-webkit-flex;align-items:center;-webkit-align-items:center;width:100%;">'),this.views=[],this.selectedView={},this.navigationStateByTid={},this.table=new Ks(this),this.renderers={chart:new hs(this),cards:new ds(this),gantt:new _s(this),kanban:new Rs(this),full:new fs(this),pivot:new As(this)},database.on("schema",void 0,this.schemaChanged,this),database.on("change",void 0,this.dataChanged,this),database.on("create",void 0,this.dataChanged,this),database.on("remove",void 0,this.dataChanged,this),database.on("view",void 0,this.viewsChanged,this)}function tr(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function ir(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?tr(Object(i),!0).forEach((function(t){Je()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tr(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}Ks.prototype.mode="table",Ks.prototype.destroy=function(){database.off("rename",void 0,this.nodeRenamed,this),database.off("create",void 0,this.nodeCreated,this),database.off("change",void 0,this.nodeChanged,this),database.off("remove",void 0,this.nodeRemoved,this),database.off("schema",void 0,this.schemaChanged,this),this.hide(),this.$container.parentNode&&this.$container.parentNode.removeChild(this.$container)},Vs(Ks),Ws(Ks),Bs(Ks),qs(Ks),Ys(Ks),Ks.prototype.updateUI=function(){a.a.render(r.a.createElement(Pn,{items:this.contextState.items,clickTarget:this.contextState.target,onClick:()=>{this.contextState.target=null,this.updateUI()},show:null!==this.contextState.target}),ui.$tableContextMenuContainer[0])},Ks.prototype.setVisible=function(e){e?this.show():this.hide()},Ks.prototype.show=function(){this.visible||(this.visible=!0,$(this.$container).appendTo(ui.$body),window.addEventListener("resize",this.resizeListener,!1),$.pushInputHandler(this),ui.recordNavigation.pushController(this.recordController),this.resize(),this.scroll(!0,!1))},Ks.prototype.hide=function(){this.visible&&(this.visible=!1,ui.sideEditor.close(!0),a.a.unmountComponentAtNode(ui.$tableContextMenuContainer[0]),$(this.$container).detach(),window.removeEventListener("resize",this.resizeListener,!1),$.popInputHandler(this),ui.recordNavigation.popController(this.recordController))},Ks.prototype.update=function(){},Ks.prototype.addRow=function(e,t){if(console.log("Table.addRow",e,t),!this.silent){var i=this;i.models[e]||o((function(t){t&&database.filterReadable(i.type,[e],(function(t){if(t&&1===t.length&&!i.models[e]){var o=i.removedIndex[e];i.models[e]={id:e,values:[]},null!=o&&o>=0&&o<i.rows.length?i.rows.splice(o,0,e):i.rows.push(e),i.recalc(e,(function(){i.aggregate(),i.updateRows(),i.updateFoot(),i.rowsChanged()}))}}))}))}function o(o){if(!t)return o(!0);database.loadNode(e,(function(e,t){if(!t)return o(!1);var n=i.getWhereExpression();if(!n)return o(!0);n.evaluate(database,t,(function(e,t){o(t)}))}))}},Ks.prototype.nodeCreated=function(e,t,i){this.ready&&(this.silent||t===this.type.id&&this.addRow(i,!0))},Ks.prototype.nodeChanged=function(e,t){if(this.ready&&!this.silent){var i=this,o=i.models,n=[],a={};s(t,0),r()}function s(e,t){if(!(t>2||a[e])){a[e]=!0;var i=database.loadNodeSync(e);if(i){o[e]&&n.push(e);var r=database.typeOf(e);if(r){var l=r.fields;if(l)for(var c in l)if(l.hasOwnProperty(c)){var d=l[c];if(d.isReference){if(u=i[c])s(d.refType.id+u,t+1)}else if(d.isReverse){var h=i[c];if(h)for(var p=0;p<h.length;p++){var u=h[p];s(d.refType.id+u,t+1)}}}}}}}function r(){var e=n.length;if(e)for(var t=0;t<n.length;t++)i.recalc(n[t],(function(){0===--e&&l()}))}function l(){i.aggregate(),i.updateRows(),i.updateFoot()}},Ks.prototype.nodeRemoved=function(e,t){if(this.ready){var i=this.models[t];if(delete this.midChoosen[t],i){delete this.models[t];var o=this.rows.indexOf(t);-1!==o&&this.rows.splice(o,1),this.removedIndex[t]=o;var n=this.groups;for(var a in n)if(n.hasOwnProperty(a)){var s=n[a],r=s.children.indexOf(t);if(-1!==r&&(s.children.splice(r,1),!s.children.length)){var l=this.rows.indexOf(a);-1!==l&&this.rows.splice(l,1)}}this.aggregate(),this.updateRows(),this.updateFoot(),this.retainSelection(),this.rowsChanged()}}},Ks.prototype.schemaChanged=function(e,t,i){if(this.ready)if(!0===t||!0===i){var o=this.getConfiguration();this.configureAndLoad(o)}else this.reload()},Ks.prototype.configureAndLoad=function(e){this.setConfig(e),this.reload()},Ks.prototype.reload=function(){this.load((function(e){e&&console.log(e)}))},Ks.prototype.setConfig=function(e,t){console.log("Table.setConfig: "+e.type),this.ready=!1;var i=e.type,o=database.schema.types[i];if(o){this.config=e,this.type=o;var n=[];if(e.cols&&0!==e.cols.length)for(var a=0;a<e.cols.length;a++){var s=e.cols[a],r=s.expression,l=(m=void 0,o.fields[r]);l&&l.isField&&"fn"!==l.base&&"file"!==l.base&&"memory-global"!==l.binding&&"memory-record"!==l.binding&&(m=l.id);try{g=queries.parseSystem(database.schema,o,r,{},!1)}catch(e){console.warn(e,e.stack);continue}if(g)if(g.hasErrors())console.log("Invalid expression at column "+a,g.errorMessage());else if(!g.isMultiple()&&!g.isUpdating()){var c=s.agg,d=c?aggregations.aggType(c,g.returnType):void 0;v={caption:s.caption,expression:g,field:g.returnType,width:s.width||g.returnType.columnWidth,agg:c,aggType:d,filter:s.filter,directFid:m,isReadable:database.canRead(g),conditionalStyling:s.conditionalStyling};n.push(v)}}else{for(var h=8,p=o.sorted,u=0;u<p.length&&n.length<h;u++){var f=p[u];if(f.isField){var m=void 0;"fn"!==f.base&&"file"!==f.base&&"memory-local"!==f.binding&&"memory-record"!==f.binding&&(m=f.id);try{var g;if(!(g=queries.parseSystem(database.schema,o,f.id,{},!1)).hasErrors()&&!g.isMultiple()&&!g.isUpdating()){var v={width:f.columnWidth,expression:g,field:g.returnType,agg:void 0,aggType:d,directFid:m,isReadable:database.canRead(f)};n.push(v)}}catch(e){}}}if(!n.length){var y=queries.parseSystem(database.schema,o,"_id",{});n.push({width:50,expression:y,field:y.returnType,agg:"cnt",aggType:aggregations.aggType("cnt",y.returnType),isReadable:!0})}}this.cols=n,this.tid=i,this.cidxSort=parseInt(e.sort),isNaN(this.cidxSort)&&(this.cidxSort=0),this.sortDescending=!0===e.descending,this.cidxGroup=void 0===e.group?void 0:parseInt(e.group),isNaN(this.cidxGroup)&&(this.cidxGroup=void 0),this.midChoosen=e.choosen||{},this.onlyChoosen=!0===e.onlyChoosen,t&&(this.midChoosen=t.midChoosen||{},this.onlyChoosen=!0===t.onlyChoosen,this.expanded=t.expanded||{},this.scrollTop=null==t.scrollTop?0:t.scrollTop,this.scrollLeft=null==t.scrollLeft?0:t.scrollLeft,this.removeSelection(),this.lastSelectedRow=t.selectionR0,this.selectionMode=t.selectionMode,this.selectionR0=t.selectionR0,this.selectionR1=t.selectionR1,this.selectionC0=t.selectionC0,this.selectionC1=t.selectionC1,this.selectionMid0=t.selectionMid0,this.selectionMid1=t.selectionMid1),this.createCells()}},Ks.prototype.getNavigationState=function(){return{scrollLeft:this.scrollLeft,scrollTop:this.scrollTop,midChoosen:this.midChoosen,onlyChoosen:this.onlyChoosen,expanded:this.expanded,selectionMode:this.selectionMode,selectionR0:this.selectionR0,selectionR1:this.selectionR1,selectionC0:this.selectionC0,selectionC1:this.selectionC1,selectionMid0:this.selectionMid0,selectionMid1:this.selectionMid1}},Ks.prototype.getConfig=Ks.prototype.getConfiguration=function(){for(var e=this.cols,t=[],i=0;i<e.length;i++){var o=e[i],n={caption:o.caption,expression:o.expression.toString(),width:o.width,agg:o.agg,filter:o.filter,conditionalStyling:o.conditionalStyling};t.push(n)}return{type:this.tid,cols:t,sort:this.cidxSort,descending:this.sortDescending,group:this.cidxGroup,choosen:this.midChoosen,onlyChoosen:this.onlyChoosen}},Ks.prototype.showOnlyChoosen=function(){this.onlyChoosen=!0,this.reload()},Ks.prototype.showAll=function(){this.onlyChoosen=!1,this.reload()},Ks.prototype.clearChoosen=function(){this.midChoosen={},this.updateRows(),this.aggregateFoot(),this.updateFoot()},Ks.prototype.toggleChoosen=function(){var e=this.midChoosen,t=this.midChoosen={},i=this.models;for(var o in i)i.hasOwnProperty(o)&&(e[o]||(t[o]=!0));this.updateRows(),this.aggregateFoot(),this.updateFoot()},Ks.prototype.chooseAll=function(){var e=this.midChoosen={},t=this.models;for(var i in t)t.hasOwnProperty(i)&&(e[i]=!0);this.updateRows(),this.aggregateFoot(),this.updateFoot()},Ks.prototype.removeAllChoosen=function(){var e=this,t=this.type;if(!database.canDelete(t))return $.alert(locale.errorNotAuthorized);$.dialog({closable:!0,caption:locale.removeNRecords.replace("$",Object.keys(e.midChoosen).length),message:locale.confirmRemoveAllChoosen,buttons:[{color:"red",caption:locale.removeNRecords.replace("$",Object.keys(e.midChoosen).length),callback:function(){var t=e.midChoosen;e.midChoosen={},database.removeAll(k.keys(t))}}]})},Ks.prototype.touchHead=function(e){var t=$(e.target).closest(".t-head-cell");if(t.length){var i=t.attr("data-cidx");i&&this.popupColumnMenu(parseInt(i),e)}},Ks.prototype.unselect=function(){this.selectNothing()},Ks.prototype.select=function(e,t,i){if(e){null==i&&(i=this.getSelectedColumn());var o=this.rows.indexOf(e);-1!==o?this.selectCell(o,i,t):this.selectNothing()}else this.selectNothing()},Ks.prototype.scrollToRow=function(e){var t=this.scrollTop,i=this.bodyHeight(),o=e*(this.rowHeight+Xs);o<t?this.scrollTo(this.scrollLeft,o):o>t+i-(this.headHeight+this.footHeight)&&this.scrollTo(this.scrollLeft,o+(this.headHeight+this.footHeight)-i)},Ks.prototype.scrollToCell=function(e,t){var i=this.scrollLeft,o=this.scrollTop,n=this.bodyHeight(),a=this.$container.clientWidth-this.leftWidth,s=o;if(null!=t){var r=t*(this.rowHeight+Xs);r<o?s=r:r>o+n-(this.headHeight+this.footHeight)&&(s=r+(this.headHeight+this.footHeight)-n)}var l=i;if(null!=e){var c=this.colX(e,e)-this.leftWidth,d=c+this.colW(e,e);d>i+a&&(l=Math.max(0,d-a)),c<i&&(l=c)}s===o&&l===i||this.scrollTo(l,s)},Ks.prototype.scroll=function(e,t){var i=this.scrollTop,o=this.scrollLeft,n=Math.floor(i/(this.rowHeight+Xs)),a=this.ridxTop;n>this.ridxTop+Gs-1?a=n:n<this.ridxTop&&(a=n-Gs+1),a!==this.ridxTop&&(this.ridxTop=a,this.updateRows(),this.updateSelection(),this.updateEditor());var s=i%(this.rowHeight+Xs);s<0&&(s+=this.rowHeight+Xs);var r=-(s+(n-a)*(this.rowHeight+Xs)),l=-o;this.$head.style.transform=this.$head.style.WebkitTransform="translate3d("+l+"px,0px,0px)",this.$rowHeads.style.transform=this.$rowHeads.style.WebkitTransform="translate3d("+Math.max(-l,0)+"px,0px,0px)",this.$view.style.transform=this.$view.style.WebkitTransform="translate3d("+l+"px,"+r+"px,0px)",this.viewX=l,this.viewY=r,this.updateFootPosition(),this.updateScrollbar(t)},Ks.prototype.updateFootPosition=function(){var e=this.rows.length+1,t=this.containerHeight()-2*(this.rowHeight+Xs);Math.max(t,(this.rowHeight+Xs)*e)>t?(this.$foot.style.bottom=0,this.$foot.style.top="",this.$footRuler.style.bottom=0,this.$footRuler.style.top="",this.$foot.style.transform=this.$foot.style.WebkitTransform="translate3d("+this.viewX+"px,0px,0px)",this.$footRuler.style.transform=this.$footRuler.style.WebkitTransform=""):(this.$scrollbarHContainer.style.bottom=0,this.$footRuler.style.top=e*(this.rowHeight+Xs)+this.headHeight+"px",this.$footRuler.style.bottom="",this.$footRuler.style.zIndex=1,this.$foot.style.top=e*(this.rowHeight+Xs)+this.headHeight-1+"px",this.$foot.style.bottom="",this.$foot.style.zIndex=1,this.$foot.style.transform=this.$foot.style.WebkitTransform="translate3d("+this.viewX+"px,"+-this.scrollTop+"px,0px)",this.$footRuler.style.transform=this.$footRuler.style.WebkitTransform="translate3d(0px,"+-this.scrollTop+"px,0px)")},Ks.prototype.updateScrollbar=function(e){var t=this.rows.length+1,i=this.scrollTop,o=this.scrollLeft,n=this.containerHeight()-(this.headHeight+this.footHeight),a=Math.max(n,(this.rowHeight+Xs)*t),s=this.viewWidth+40,r=this.$container.clientWidth-this.rowHeadWidth,l=a>n,c=s>r+this.leftWidth,d=n,h=r,p=Math.max(40,Math.round(d*n/a)),u=Math.max(0,Math.min(d-p,Math.round(i/(a-n)*(d-p))))+2,f=Math.max(40,Math.min(h,Math.round(h*(r/s)))),m=Math.max(0,Math.min(h-f,Math.round(o/(s-40-r)*(h-f)))),g=this.$scrollbarV;g.style.top=u+"px",g.style.height=p+"px";var v=this.$scrollbarH;v.style.left=m+"px",v.style.width=f+"px",e&&(this.scrollDoneTime=Date.now()+1e3,this.scrollDoneTimeout||(l&&(g.className="t-scrollbar-v scrolling"),c&&(v.className="t-scrollbar-h scrolling"),this.scrollDoneTimeout=setTimeout(this.scrollDone,1e3))),this.$scrollHIndicator.style.opacity=0!=o?1:0,this.$scrollVIndicator.style.opacity=0!=i?1:0},Ks.prototype.scrollDone=function(){var e=Date.now(),t=this.scrollDoneTime-e;t<100?(this.$scrollbarV.className="t-scrollbar-v",this.$scrollbarH.className="t-scrollbar-h",this.scrollDoneTimeout=null):this.scrollDoneTimeout=setTimeout(this.scrollDone,t)},Ks.prototype.scrollTo=function(e,t){this.scrollTop=t,this.scrollLeft=e,this.scroll(!1,!0)},Ks.prototype.scrollToVisible=function(){var e=this.scrollTop,t=this.bodyHeight(),i=Math.max(0,(this.rows.length+1)*(this.rowHeight+Xs)-t);e>i&&(this.scrollTop=i),this.scroll(!0,!1)},Ks.prototype.resizeListener=function(){this.resize()},Ks.prototype.resize=function(){this.createCells(),this.updateHead(),this.updateRows(),this.updateFoot(),this.updateScrollbar(!1),this.updateSelection()},Ks.prototype.rowsPerPage=function(){var e=this.bodyHeight();return Math.floor(e/(this.rowHeight+Xs))},Ks.prototype.createCells=function(){var e=this.$head,t=this.$foot,i=this.$view,o=(this.$body,this.cols);this.removeSelection(),$EMPTY(e),$EMPTY(t),$EMPTY(i);for(var n=0;n<o.length;n++){(p=o[n]).$headCell=$DIV("t-head-cell",e,{"data-cidx":n}),$DIV("t-head-resizer",p.$headCell),$EL("span",p.$headCell).innerHTML=htmlEscape(p.caption||p.expression.caption),p.$footCell=$DIV("t-foot-cell t-foot-cell-"+p.field.base,t)}var a=this.$rowHeads=$DIV("t-rowheads");this.$selectionContainer=$DIV("t-selection-container"),this.$headSelectionContainer=$DIV("t-head-selection-container");for(var s=this.bodyHeight(),r=Gs+Math.ceil(s/(this.rowHeight+Xs)),l=[],c=0;c<r;c++){var d=$DIV("t-row",i,{"data-ridx":c});d.style.top=c*(this.rowHeight+Xs)+"px",d.style.height=this.rowHeight+"px",(e=$DIV("t-rowhead",a,{"data-ridx":c})).style.top=c*(this.rowHeight+Xs)+"px",e.style.height=this.rowHeight+"px",$DIV("t-rowhead-content",e),$DIV("t-rowhead-resizer",e);var h=[];for(n=0;n<o.length;n++){var p=o[n];h[n]=$DIV("--ul-row-cell t-cell t-cell-"+p.field.base,d)}var u={$row:d,$head:e,$cells:h};l.push(u)}a.appendChild(this.$headSelectionContainer),i.appendChild(this.$selectionContainer),i.appendChild(a),this.viewRows=l,this.createSelection(),this.resizeColumns(),this.resizeRows()},Ks.prototype.resizeRows=function(){for(var e=this.viewRows,t=0;t<e.length;t++){var i=e[t];i.$head.style.top=t*(this.rowHeight+Xs)+"px",i.$head.style.height=this.rowHeight+"px",i.$row.style.top=t*(this.rowHeight+Xs)+"px",i.$row.style.height=this.rowHeight+"px";for(var o=i.$cells,n=this.cols,a=this.rowHeight<40?Math.floor((this.rowHeight-18)/2)+"px":"",s=0;s<n.length;s++)o[s].style.paddingTop=a}this.$view.className=this.rowHeight<="40"?"t-view":"t-view t-view-resized-rows"},Ks.prototype.containerHeight=function(){return window.getHeight()-ui.headHeight-ui.footHeight-ui.topPadding},Ks.prototype.bodyHeight=function(){return this.containerHeight()-(this.headHeight+this.footHeight)},Ks.prototype.updateRows=function(){this._updateRowsId=(this._updateRowsId||0)+1;const e=this._updateRowsId;if(!this.visible)return;if(!this.ready)return;if(this.silent)return;const t=this.viewRows,i=this.midChoosen,o=this.expanded,n=this.models,a=this.groups,s=this.ridxTop,r=this.cidxGroup,l=this.rows,c=this.cols;this.updateFootPosition();let d=0;for(let h=0;h<t.length;h++){const p=t[h],u=p.$row,f=p.$head,m=h+s,g=p.$cells;let v=!1,y=!1,b=!1;if(m<0||m>=l.length)for(let e=0;e<c.length;e++){c[e];const t=g[e];t.innerHTML="",t.style.backgroundColor=""}else{const t=l[m],s=a[t]||n[t];if(s){const n=s.values;v=!!i[t],y=!!a[t],b=y&&!!o[t],y?d=0:d++;for(let i=0;i<c.length;i++){const o=c[i],a=g[i];if(o.isReadable){const s=n[i],l=a.innerHTML;let c="",d="",h=!1;if(y&&o.agg&&i!==r){const e=o.aggType.format(s);null!=e&&(c=tables.aggTypeToSymbol(o.agg,e))}else{const i=o.field,n=i.base;if("choice"===n){const e=i.getValues()[s];e&&(c+=`\n                                            <div \n                                                class="multicombo-item" \n                                                style="${e.color?"background-color:"+e.color+";color:"+util.contrastingTextColorTo(e.color):""}"\n                                            >\n                                                ${e.icon?`<div class="choice-symbol ic ic-${e.icon}"></div>`:""}\n                                                <span>${htmlEscape(e.caption||"")}</span>\n                                            </div>`)}else if("dchoice"===n)h=!0,i.loadValue(t,s,t=>{if(e===this._updateRowsId)if(t){const e=`\n                                                <div \n                                                    class="multicombo-item" \n                                                    style="${t.color?"background-color:"+t.color+";color:"+util.contrastingTextColorTo(t.color):""}"\n                                                >\n                                                    ${t.icon?`<div class="choice-symbol ic ic-${t.icon}"></div>`:""}\n                                                    <span>${htmlEscape(t.caption||"")}</span>\n                                                </div>`;a.innerHTML=e,a.style.background=""}else a.innerHTML="",a.style.background=""});else if("multi"===n){const e=util.multiDecode(s);if(e){const t=i.getValues();e.sort((function(e,i){const o=t[e],n=t[i];return o?n?o.order-n.order:-1:0}));for(let i=0;i<e.length;i++){const o=t[e[i]];o&&(c+=`\n                                            <div \n                                                class="multicombo-item" \n                                                style="${o.color?"background-color:"+o.color+";color:"+util.contrastingTextColorTo(o.color):""}"\n                                            >\n                                                ${o.icon?`<div class="choice-symbol ic ic-${o.icon}"></div>`:""}\n                                                <span>${htmlEscape(o.caption||"")}</span>\n                                            </div>`)}}}else if("dmulti"===n){const o=util.multiDecode(s);o&&(h=!0,i.loadValues(t,(t,i)=>{if(e===this._updateRowsId){i=i||{};let e="";o.sort((function(e,t){const o=i[e],n=i[t];return o?n?o.order-n.order:-1:0}));for(let t=0;t<o.length;t++){const n=i[o[t]];n&&(e+=`\n                                                    <div \n                                                        class="multicombo-item" \n                                                        style="${n.color?"background-color:"+n.color+";color:"+util.contrastingTextColorTo(n.color):""}"\n                                                    >\n                                                        ${n.icon?`<div class="choice-symbol ic ic-${n.icon}"></div>`:""}\n                                                        <span>${htmlEscape(n.caption||"")}</span>\n                                                    </div>`)}a.innerHTML=e,a.style.background=""}}))}else if("color"===n)s&&(c+=`<div\n                                        class="t-cell-content-colored" \n                                        style="background-color:${s}"></div>`);else if("icon"===n)s&&(c='<div class="choice-symbol ic ic-'+s+'"></div>');else if(("number"===n||"string"===n)&&null!=o.conditionalStyling&&o.conditionalStyling.length>0){let e=!1;for(let n=0;n<o.conditionalStyling.length&&!e;n++){const a=o.conditionalStyling[n];switch(a.operand){case"=":s===a.value&&(e=!0);break;case">":s>a.value&&(e=!0);break;case">=":s>=a.value&&(e=!0);break;case"<":s<a.value&&(e=!0);break;case"<=":s<=a.value&&(e=!0);break;case"!=":null!=s&&s!==a.value&&(e=!0);break;case"startsWith":null!=s&&String(s).startsWith(a.value)&&(e=!0);break;case"endsWith":null!=s&&String(s).endsWith(a.value)&&(e=!0);break;case"contains":null!=s&&String(s).includes(a.value)&&(e=!0);break;case"f(x)":{const i=database.loadNodeSync(t),o=queries.parseSystem(database.schema,this.type,a.value,{});if(i&&o){o.evaluateSync(database,i)&&(e=!0)}break}}e&&(c=`\n                                            <div \n                                                class="multicombo-item" \n                                                style="${"background-color:"+(a.background||"")+";color:"+a.color||!1}"\n                                            >\n                                                ${a.icon?`<div class="choice-symbol ic ic-${a.icon}"></div>`:""}\n                                                <span>${htmlEscape(i.format(s))}</span>\n                                            </div>`,d=a.cell||"")}e||(c=htmlEscape(i.format(s)))}else if("styled"===n)s&&(c+=`<div \n                                        class="multicombo-item" \n                                        style="${s.background?`background-color:${s.background};`:""}${s.color?`color:${s.color};`:""}"\n                                    >\n                                        ${s.icon?`<div class="choice-symbol ic ic-${s.icon}"></div>`:""}\n                                        <span>${htmlEscape(s.text||"")}</span>\n                                    </div>`);else if("file"===i.base){if(s){const e=database.thumbURL1(s);e&&(c='<img style="height:100%" src="'+e+'">')}}else{const e=i.format(s);c=htmlEscape(e)}}h||(l!==c&&(a.innerHTML=c),a.style.background=d)}else a.innerHTML="",a.style.backgroundColor="#f7f7f7"}}}const w=null==r&&(h+s)%2==0,x="t-row"+(m===l.length?" new --ul-new-row":m<0||m>l.length?" empty":(v?" choosen":y?" group":"")+(w?" t-row-2nd":" t-row-1st"));x!==u.className&&(u.className=x),f.firstChild.innerHTML=m<0||m>=l.length||v||y?"":String(m+1);const T="t-rowhead"+(m===l.length?" i-16 i-light-grey i-plus":m<0||m>l.length?"empty":v?" choosen i-16 i-blue i-check":y?b?" group i-24 i-light-grey i-line-down":" group i-24 i-light-grey i-line-right":"");T!==f.className&&(f.className=T)}},Ks.prototype.resizeColumns=function(){for(var e=this.viewRows,t=this.cols,i=0,o=0;o<e.length;o++){var n=e[o];i=this.leftWidth;for(var a=0;a<t.length;a++){var s=(l=t[a]).width,r=n.$cells[a];r.style.left=i+"px",r.style.width=s+"px",i+=s}}i=this.leftWidth;for(a=0;a<t.length;a++){var l;(l=t[a]).left=i;s=l.width;var c=l.$headCell;c.style.left=i+"px",c.style.width=s+"px";var d=l.$footCell;d.style.left=i+"px",d.style.width=s+"px",i+=s}this.viewWidth=i,this.$head.style.width=i+"px",this.$foot.style.width=i+"px",this.updateScrollbar(),this.updateSelection(),this.updateEditor()},Ks.prototype.toggle=function(e){this.groups[e]&&(this.expanded[e]?this.collapse(e):this.expand(e))},Ks.prototype.expandSilently=function(e){var t=this.groups[e];if(t&&!this.expanded[e]){var i=this.rows.indexOf(e);-1!==i&&(this.expanded[e]=!0,this.rows=this.rows.slice(0,i+1).concat(t.children).concat(this.rows.slice(i+1)))}},Ks.prototype.expand=function(e){this.expandSilently(e),this.updateRows(),this.rowsChanged(),this.retainSelection()},Ks.prototype.expandAll=function(){var e=this.expanded,t=this.groups,i=this.rows,o=!1;for(var n in t)if(t.hasOwnProperty(n)&&!e[n]){var a=t[n],s=i.indexOf(n);i=i.slice(0,s+1).concat(a.children).concat(i.slice(s+1)),e[n]=!0,o=!0}o&&(this.rows=i,this.updateRows(),this.rowsChanged(),this.retainSelection())},Ks.prototype.collapse=function(e){var t=this.groups[e];if(t&&this.expanded[e]){delete this.expanded[e];var i=this.rows.indexOf(e);-1!==i&&(this.rows=this.rows.slice(0,i+1).concat(this.rows.slice(i+1+t.children.length)),this.updateRows(),this.rowsChanged(),this.retainSelection(!0))}},Ks.prototype.collapseAll=function(){var e=this.expanded,t=this.groups,i=this.rows,o=!1;for(var n in t)if(t.hasOwnProperty(n)&&e[n]){var a=t[n],s=i.indexOf(n);i=i.slice(0,s+1).concat(i.slice(s+1+a.children.length)),delete e[n],o=!0}o&&(this.rows=i,this.updateRows(),this.rowsChanged(),this.retainSelection(!0))},Ks.prototype.getDependencies=function(){for(var e=this.cols,t={},i=0;i<e.length;i++){var o=e[i];t=queries.extendDependencies(t,o.expression.dependencies)}return t},Ks.prototype.load=function(e){console.log("Table.load: "+this.tid);var t=this;t._loadCallbacks.push(e),t.ready=!1;var i=(t._reloadId||0)+1;t._reloadId=i;var o=database.schema.types[t.tid];if(!o)return c("Type not found "+t.tid);if(o.isNew)return c();var n=t.getWhereExpression(),a=t.getDependencies();function s(){database.selectFromTypeWhere(o.id,n,(function(e,o){if(i===t._reloadId){Date.now();if(e)return c(e);l(o)}}))}function r(){var e=t.getSQLFilter();database.selectFromTypeWhereSQL(o.id,n,e,(function(e,o){if(i===t._reloadId)return e?c(e):void l(o)}))}function l(e){database.loadNodes2(e,a,(function(n){if(i===t._reloadId)return n?c(n):void database.filterReadable(o,e,(function(e){i===t._reloadId&&t.calc(i,e,(function(){i===t._reloadId&&(t.resort(),t.scrollToVisible(),console.log("Table.load loaded: "+t.tid,t.rows),t.container.loaded(),c())}))}))}))}function c(e){console.log("Table.load done: "+t.tid);var i=t._loadCallbacks;t._loadCallbacks=[];for(var o=0;o<i.length;o++)try{i[o](e)}catch(e){console.log(e)}}database.selectFromTypeWhereSQL?r():s()},Ks.prototype.getSQLFilter=function(){this.type;for(var e=[],t=this.cols,i=0;i<t.length;i++){var o=t[i];if(o.filter&&o.directFid&&o.field.isSQLFilterable)try{var n=queries.parseFilter(o.filter);n.isSQLFilterable&&e.push(n.toSQLFilter("f_"+o.directFid))}catch(e){console.warn(e)}}return e.join(" AND ")},Ks.prototype.getWhereExpression=function(){for(var e=[],t=this.cols,i=0;i<t.length;i++){var o=t[i];if(o.filter)try{var n=queries.parseFilter(o.filter);n&&e.push("("+n.toQueryPart(o.expression.toString())+")")}catch(e){console.warn(e)}}if(e.length){var a=e.join(" and ");return queries.parseSystem(database.schema,this.type,a,{})}},Ks.prototype.calc=function(e,t,i){for(var o=this,n=database.isSync,a={},s=[],r=o.cols,l=[],c=[],d=o.midChoosen,h=o.onlyChoosen,p=1,u=0;u<r.length;u++){var f=(x=r[u]).expression;x.directFid?(l[u]=x.directFid,c[u]=void 0):(l[u]=void 0,n||f.isSync()?c[u]=f.getSyncJS():c[u]=void 0)}for(var m=0;m<t.length;m++){var g=t[m],v=[],y=database.loadNodeSync(g);if(y){var b={id:g,values:v=[]};a[g]=b,h?d[g]&&s.push(g):s.push(g);for(u=0;u<r.length;u++){var w=l[u];if(w)v[u]=y[w];else{var x,T=c[u];if(T)v[u]=T(T.ctx,database,y);else C(f=(x=r[u]).expression,y,v,u)}}}}function C(t,i,n,a){p++;var s=t.getAsyncJS();s(s.ctx,database,i,{},(function(t){e===o._reloadId&&(n[a]=t,0===--p&&k())}))}function k(){if(e===o._reloadId){o.groups={},o.groupsSorted=[],o.models=a,o.rows=s,o.removedIndex={};var t=o.midChoosen,n={};for(var r in t)t.hasOwnProperty(r)&&a[r]&&(n[r]=!0);o.midChoosen=n,i()}}0===--p&&k()},Ks.prototype.recalc=function(e,t){var i=1,o=database.isSync,n=this.models[e];if(n){var a=n.values,s=database.loadNodeSync(e),r=this.cols;if(s)for(var l=0;l<r.length;l++){var c=r[l],d=c.expression,h=c.directFid;h?a[l]=s[h]:o||d.isSync()?a[l]=d.evaluateSync(database,s):p(d,s,a,l)}else{console.warn("MISSING NODE",e);for(l=0;l<r.length;l++)a[l]=void 0}0===--i&&u()}function p(e,t,o,n){i++;var a=e.getAsyncJS();a(a.ctx,database,t,{},(function(e){o[n]=e,0===--i&&u()}))}function u(){t()}},Ks.prototype.aggregate=function(){this.aggregateGroups(),this.aggregateFoot()},Ks.prototype.aggregateGroups=function(){var e=this.groups,t=this.cols,i=this.cidxGroup;for(var o in e)if(e.hasOwnProperty(o))for(var n=e[o],a=this._aggregate(n.children),s=0;s<t.length;s++){if(s!==i)t[s].agg?n.values[s]=a[s]:n.values[s]=void 0}},Ks.prototype.aggregateFoot=function(){var e,t,i,o,n,a,s=this.rows,r=this.midChoosen,l=this.models,c=this.groups,d=this.expanded,h=[];if(null!=this.cidxGroup){if(k.isEmpty(r))for(t=0;t<s.length;t++)l[i=s[t]]?h.push(i):(e=c[i])&&!d[i]&&(h=h.concat(e.children));else for(t=0;t<s.length;t++)if(l[i=s[t]]&&r[i])h.push(i);else if((e=c[i])&&!d[i])for(n=e.children,o=0;o<n.length;o++)l[a=n[o]]&&r[a]&&h.push(a)}else if(k.isEmpty(r))for(t=0;t<s.length;t++)l[i=s[t]]&&h.push(i);else for(t=0;t<s.length;t++)r[i=s[t]]&&h.push(i);this.foot={values:this._aggregate(h)}},Ks.prototype._aggregate=function(e){for(var t=this.cols,i=this.models,o=[],n=0;n<t.length;n++){switch((h=t[n]).agg){case"sum":case"cnt":o[n]=0;break;case"avg":o[n]=[0,0];break;case"min":o[n]=1/0;break;case"max":o[n]=-1/0;break;case"first":case"last":o[n]=null;break;case"concat":o[n]=[]}}for(var a=0;a<e.length;a++){var s=i[e[a]];if(s){var r=s.values;for(n=0;n<t.length;n++){if((h=t[n]).agg){var l=r[n],c=Number(l);switch(h.agg){case"sum":isNaN(c)||(o[n]+=c);break;case"cnt":null!=l&&!1!==l&&""!==l&&o[n]++;break;case"avg":null==l||"number"!=typeof l||isNaN(c)||(o[n][0]+=c,o[n][1]++);break;case"min":null!==l&&l<o[n]&&(o[n]=l);break;case"max":null!==l&&l>o[n]&&(o[n]=l);break;case"first":0===a&&(o[n]=l);break;case"last":a===e.length-1&&(o[n]=l);break;case"concat":null!=l&&(o[n].length<20?o[n].push(h.field.format(l)):20===o[n].length&&o[n].push("..."))}}}}}var d=[];for(n=0;n<t.length;n++){var h;switch((h=t[n]).agg){case"sum":case"cnt":d[n]=o[n];break;case"avg":d[n]=o[n][1]>0?o[n][0]/o[n][1]:void 0;break;case"min":d[n]=o[n]===1/0?void 0:o[n];break;case"max":d[n]=o[n]===-1/0?void 0:o[n];break;case"first":case"last":d[n]=o[n];break;case"concat":d[n]=o[n].join(", ");break;default:d[n]=void 0}}return d},Ks.prototype.updateHead=function(){for(var e=this.cols,t=this.sortDescending,i=this.cidxGroup,o=this.cidxSort,n=0;n<e.length;n++){var a=e[n],s=a.$headCell,r=n===i,l=n===o,c=!!a.filter,d='<div class="t-head-resizer"></div><span>'+htmlEscape(a.caption||a.expression.caption)+"</span>"+(c?'<div class="i-40-16 i-light-grey i-setting-filter" style="width: 12px;"></div>':"")+(r?'<div class="i-40-18 i-light-grey i-table-group" style="width: 24px"></div>':l?t?'<div class="i-40-12 i-light-grey i-line-down-thick" style="width: 12px;"></div>':'<div class="i-40-12 i-light-grey i-line-up-thick" style="width: 12px;"></div>':"");s.innerHTML=d}},Ks.prototype.updateFoot=function(){if(this.visible&&this.ready&&!this.silent){for(var e=this.cols,t=this.foot,i=0;i<e.length;i++){var o=e[i];if(o.isReadable)if(o.agg){o.aggType.base;var n=o.aggType.format(t.values[i]);null==n&&(n="");var a=tables.aggTypeToSymbol(o.agg,n);o.$footCell.innerHTML=a}else o.$footCell.innerHTML="";else o.$footCell.innerHTML=""}k.isEmpty(this.midChoosen)&&!this.onlyChoosen?(this.$footRuler.className="t-foot-ruler",this.$foot.className="t-foot"):(this.$footRuler.className="t-foot-ruler choosen",this.$foot.className="t-foot choosen")}},Ks.prototype.resort=function(){void 0===this.cidxGroup?this.sort(this.cidxSort,this.sortDescending):this.group(this.cidxGroup,this.cidxSort,this.sortDescending)},Ks.prototype.sort=function(e,t){if(void 0!==this.cidxGroup)return this.group(this.cidxGroup,e,t);var i=this.models,o=this.rows;this.removedIndex={},this.groups={},this.groupsSorted=[];var n=this.cols[e];if(n){var a=n.field;this.cidxSort=e,this.cidxGroup=void 0,this.sortDescending=!0===t;var s=this.sortDescending?-1:1,r=a.comparator;if(r){for(var l=[],c=0;c<o.length;c++){var d=o[c],h=i[d];l[c]=[a.comparable(h.values[e]),d]}"string"===r?l.sort((function(e,t){return s*e[0].localeCompare(t[0])})):"number"===r&&l.sort((function(e,t){return s*(e[0]-t[0])}));for(c=0;c<o.length;c++)o[c]=l[c][1]}}this.aggregate(),this.ready=!0,this.updateRows(),this.updateHead(),this.updateFoot(),this.retainSelection()},Ks.prototype.ungroup=function(){this.cidxGroup=void 0,this.expanded={},this.rows=k.keys(this.models),this.sort(this.cidxSort,this.sortDescending)},Ks.prototype.group=function(e,t,i){i=this.sortDescending=!0===i,t=this.cidxSort=void 0===t?this.cidxSort:t;var o=this.models,n=this.cols,a=n[e],s=n[t];if(!a)return this.cidxGroup=void 0,void this.sort(t,i);if(this.cidxGroup=e,this.removedIndex={},s||(this.cidxSort=0,s=n[0]),s&&a){var r=a.field,l=s.field,c={},d=[];for(var h in o)if(o.hasOwnProperty(h)&&(!this.onlyChoosen||this.midChoosen[h])){var p=o[h].values[e],u="_group_"+(null==p?"":JSON.stringify(p));(y=c[u])||(y={id:u,value:p,children:[],values:[]},c[u]=y,y.values[e]=p,d.push(u)),y.children.push(h)}var f=this.sortDescending?-1:1;for(var m in c){if(c.hasOwnProperty(m))(y=c[m]).children.sort((function(e,i){var n=o[e],a=o[i],s=n.values[t],r=a.values[t];return f*l.compare(s,r)}))}f=e===t&&i?-1:1,d.sort((function(e,t){var i=c[e],o=c[t];return f*r.compare(i.value,o.value)})),this.cidxGroup=e,this.groups=c,this.groupsSorted=d,this.rows=d;var g=this.expanded,v={};for(var m in g){var y;if(g.hasOwnProperty(m))if(y=c[m]){var b=this.rows.indexOf(m);this.rows=this.rows.slice(0,b+1).concat(y.children).concat(this.rows.slice(b+1)),v[m]=!0}}this.expanded=v}this.aggregate(),this.ready=!0,this.updateRows(),this.updateHead(),this.updateFoot(),this.retainSelection()},Ks.prototype.openFindMenu=function(){var e=this,t=$.backplane({}),i=$('<div class="nx-menu-popup grey find-popup-width" style="border-radius:4px">').appendTo(t);$("<h1>").text(locale.search).appendTo(i);var o=$.input({$container:i,enter:a,escape:r}),n=[];function a(){var t=o.val();r(),e.applyFind(t)}function s(){r(),e.clearFind()}function r(){t.close()}n.push({caption:locale.cancel,click:r}),n.push("-"),!e.onlyChoosen&&k.isEmpty(e.midChoosen)||(n.push({caption:locale.showAll,click:s}),n.push(" ")),n.push({caption:locale.search,click:a,cls:"blue"}),$.buttons({$container:i,items:n}),i.center(),o.focus()},Ks.prototype.clearFind=function(){this.midChoosen={},this.showAll()},Ks.prototype.applyFind=function(e){if(e&&"string"==typeof e){Object(l.f)("TableSearch","Apply");var t=e.toLocaleLowerCase().trim().split(" ");if(!(t.length<1)){for(var i=[],o=[],n=[],a=0;a<t.length;a++){var s=t[a];s.length>0&&(i.push(s),o.push(Number(s)),n.push(util.containsRegExp(s)))}if(!(i.length<1)){var r={},c=this.cols,d=this.models;for(var h in d){if(d.hasOwnProperty(h))p(d[h])&&(r[h]=!0)}this.midChoosen=r,this.showOnlyChoosen()}}}function p(e){var t,a,s,r,l,d,h=e.values,p=!0;e:for(t=0;t<n.length;t++){for(s=n[t],o[t],i[t],a=0;a<c.length;a++)if(r=c[a].field,null!=(l=h[a]))switch(r.base){case"string":case"html":case"file":case"link":case"email":if(s.test(l))continue e;break;case"choice":if((d=r.values[l])&&s.test(d.caption))continue e;break;default:if(s.test(r.format(l)))continue e}p=!1;break e}return p}},Ks.prototype.openContextMenu=function(e){this.contextState={target:{getBoundingClientRect:()=>({bottom:e.clientY,height:0,left:e.clientX,right:e.clientX,top:e.clientY,width:0})}},this.isTableEditMode()?this.contextState.items=this.openContextMenu_TABLE(e):this.contextState.items=this.openContextMenu_FORM(e),this.updateUI()},Ks.prototype.openContextMenu_TABLE=function(e){return e.preventDefault(),[{text:locale.cut,onClick:()=>NinoxDocumentInteraction.execCut()},{text:locale.copy,onClick:()=>NinoxDocumentInteraction.execCopy()},{text:locale.paste,onClick:()=>NinoxDocumentInteraction.execPaste()}]},Ks.prototype.openContextMenu_FORM=function(e){var t=this.type,i=$(e.target).closest(".t-head-cell");if(i.length){var o=parseInt(i.attr("data-cidx"));return null!=o&&this.popupColumnMenu(o,e),void e.preventDefault()}var n=!k.isEmpty(this.midChoosen),a=this;const s=[];return s.push({text:locale.clearSelection,onClick:()=>a.clearChoosen(),disabled:!n}),s.push({text:locale.toggleSelection,onClick:()=>a.toggleChoosen(),disabled:!n}),s.push({text:locale.selectAll,onClick:()=>a.chooseAll()}),s.push({topBorder:!0,text:locale.showOnlyChoosen,onClick:()=>a.showOnlyChoosen(),disabled:!n||a.onlyChoosen}),s.push({text:locale.showAll,onClick:()=>a.showAll(),disabled:!a.onlyChoosen}),null!=a.cidxGroup&&(s.push({topBorder:!0,text:locale.expandAll,onClick:()=>a.expandAll()}),s.push({text:locale.collapseAll,onClick:()=>a.collapseAll()})),s.push({topBorder:!0,text:locale.removeAllChoosen,onClick:()=>a.removeAllChoosen(),disabled:!n||n&&!database.canDelete(t)}),e.preventDefault(),s},Ks.prototype.exportData=function(){new zs(this)},Ks.prototype.setColumnWidth=function(e,t,i,o){var n=this.cols[e];n&&(null==t&&(t=n.width),n.width=i,this.resizeColumns(),this.saveView(),o&&o())},Ks.prototype.duplicate=function(){var e=this;Object(c.b)(this.getSelectedNid(),(function(t){e.addRow(t,!1),e.select(t,!0,void 0)}))},Ks.prototype.create=function(){var e=this;Object(c.a)(this.type,(function(t){e.addRow(t,!1),e.select(t,!0)}))},Ks.prototype.remove=function(){Object(c.j)(this.getSelectedNid())},Ks.prototype.print=function(){Object(c.i)(this.getSelectedNid(),this.getChoosenOrSelectedNids())},Ks.prototype.popupColumnMenu=function(e,t){var i=this,o=i.cols[e];if(!o)return;var n=$(t.target).closest(".t-head-cell").offset();t&&null!=t.clientX&&(n.left=t.clientX);var a=e===i.cidxSort&&!i.sortDescending,s=e===i.cidxSort&&i.sortDescending,r=e===i.cidxGroup,l=$.backplane({closed:N});const c="number"===o.expression.returnType.base?"number":"string"===o.expression.returnType.base?"string":null;var d=$('<div class="nx-menu-popup grey column-menu">').appendTo(l);if(database.isAdmin())var h=$('<div class="column-menu-section" style="display:flex;display:-webkit-flex;flex-direction:row;-webkit-flex-direction:row">').appendTo(d),p=$('<div style="flex-grow:1;-webkit-flex-grow:1;width:48px">').appendTo(h),u=($('<div style="width:32px;padding:8px"><div class="nx-button-icon blue"><div class="type-symbol type-symbol-white type-symbol-fn"></div></div></div>').appendTo(h).click((function(){new Ai.a({schema:i.type.schema,type:i.type,variables:{},supportsCommands:!1,value:o.expression.toString(),okay:function(e,t){if(l.close(),e&&t){o.expression=t,o.field=t.returnType,o.agg&&(-1===t.returnType.aggregations.indexOf(o.agg)?o.agg=void 0:o.aggType=aggregations.aggType(o.agg,t.returnType));var n=i.type.fields[t.toString()];n&&n.isField&&"fn"!==n.base&&"file"!==n.base?o.directFid=n.id:o.directFid=void 0}i.reload(),i.resize(),i.saveView()},cancel:function(){}})})),$('<div class="component editor" style="width:100%">').appendTo(p)),f=$('<input type="text">').val(o.caption).attr("placeholder",o.expression.caption).appendTo($('<div class="stringeditor">').appendTo(u)).change((function(){o.caption=f.val()||void 0,l.close(),i.resize(),i.saveView()}));var m=$('<div class="column-menu-section">').appendTo(d),g=$('<div class="component editor" style="width:100%">').appendTo(m),v=tables.createFilterEditor({updateFilter:function(e){e&&l.close(),o.filter=v.getFilter(),i.reload(),i.rowsChanged(),i.saveView()}},g,o.field,o.filter),y=$('<div class="column-menu-section">').appendTo(d),b=$('<div class="component editor" style="width:100%;padding:0 8px">').appendTo(y),w=$('<div class="switch table-popup-sorting">').appendTo(b);$('<div class="switch-item'+(a?" selected":"")+'">').append($('<div class="icon i-32-12 i-light-grey i-line-up-thick inline-block">')).append($("<span>").text(locale.sortAscending)).appendTo(w).click((function(){l.close(),i.sort(e,!1),i.rowsChanged(),i.saveView()})),$('<div class="switch-item'+(s?" selected":"")+'">').append($('<div class="icon i-32-12 i-light-grey i-line-down-thick inline-block">')).append($("<span>").text(locale.sortDescending)).appendTo(w).click((function(){l.close(),i.sort(e,!0),i.rowsChanged(),i.saveView()})),$('<div class="switch-item'+(r?" selected":"")+'" style="margin-top: 4px;">').append($('<div class="icon i-32-16 i-light-grey i-table-group inline-block">')).append($("<span>").text(locale.grouped)).appendTo(w).click((function(){l.close(),r?i.ungroup():i.group(e),i.rowsChanged(),i.saveView()}));var x=o.field.aggregations;if(x&&x.length){var T=$('<div class="column-menu-section">').appendTo(d),C=$('<div class="component editor" style="width:100%;padding:0 8px 8px 0">').appendTo(T),S=$('<div class="switch">').appendTo(C);k.each(x,(function(e){$('<div class="switch-item'+(e===o.agg?" selected":"")+'">').text(locale.agg[e]).appendTo(S).click((function(){l.close(),e!==o.agg?(o.agg=e,o.aggType=aggregations.aggType(e,o.field)):(o.agg=void 0,o.aggType=void 0),i.aggregate(),i.updateRows(),i.updateFoot(),i.rowsChanged(),i.saveView()}))}))}if(null!==c&&$('<div class="buttons">').appendTo(d).append(`<div class="root-help-link">${locale.conditionalStyling}...</div>`).touch((function(){l.close(),new Jo(i.type,o,(function(t){const o=i.getConfig();o.cols[e].conditionalStyling=t,i.configureAndLoad(o),i.saveView()}),c)})),"email"===o.field.base&&$('<div class="buttons">').appendTo(d).append('<div class="nx-button-text grey">Send mail...</div>').touch((function(){l.close(),i.sendMailForColumn(o)})),database.isAdmin()){var _=$('<div class="buttons">').appendTo(d);$('<div class="nx-button-text grey">').text(locale.hideColumn).appendTo(_).click((function(){l.close(),i.removeColumn(e)})),$('<div class="nx-hspace-flex">').appendTo(_),$('<div class="nx-button-text blue">').text(locale.showColumn+"...").appendTo(_).click((function(){l.close(),i.popupAddColumnMenu(e,void 0,t)}))}var E=d.outerWidth(),D=d.outerHeight();function N(){v.destroy()}n.left-=8,n.top+=this.rowHeight+Xs,n.left+E>window.getWidth()&&(n.left=window.getWidth()-E),n.top+D>window.getHeight()&&(n.top=window.getHeight()-D),d.offset(n)},Ks.prototype.sendMailForColumn=function(e){var t=this.cols.indexOf(e);if(-1!==t){for(var i=this.rows,o=this.models,n={},a=0;a<i.length;a++){var s=o[i[a]];if(s){var r=s.values[t];r&&util.isValidEmail(r)&&(n[r]=1)}}var l=Object.keys(n);for(a=0;a<l.length;a++)l[a]=encodeURIComponent(l[a]);var c="mailto:"+l.join(",");NinoxDocumentInteraction.openBrowser(c)}},Ks.prototype.popupAddColumnMenu=function(e,t,i){var o=this.cols;null==e&&(e=o.length);o[e];var n=$(i.target).closest(".t-head-cell").offset();n.top+=this.rowHeight+Xs;var a=this;t||(t=[{type:this.type,path:"",multiple:!1}]);var s=!1,r=[];s&&(r.push({icon:"i-32-24 i-light-grey i-plus",caption:locale.createField}),r.push(locale.showColumn));for(var l={},c=0;c<o.length;c++){var d=o[c].expression;d&&(l[d.toString()]=!0)}t.length>1?r.push({icon:"i-32-24 i-light-grey i-arrow-solid-left",caption:locale.back,click:x}):r.push({icon:"i-light-grey i-32-24 i-field-fn",caption:locale.function,click:b});var h=t[0].type,p=t[0].path,u=t[0].multiple;l[p+"_id"]||r.push({icon:"i-32-24 i-light-grey i-field-number",caption:locale.id,field:h.field_id,click:v});var f=h.sorted;database.supports.authentication&&(f=f.concat([h.field_cu,h.field_cd,h.field_mu,h.field_md]));for(var m=0;m<f.length;m++){var g=f[m];(g.isField||g.isReverse||g.isReference)&&database.canRead(g)&&(l[p+g.id]||r.push({icon:"i-light-grey i-32-24 i-field-"+g.base,caption:g.caption,field:g,click:v}))}function v(){var o=this.field;if(o.isReference){var s=[{type:o.refType,path:p+o.id+".",multiple:u}].concat(t);a.popupAddColumnMenu(e,s,i)}else if(o.isReverse){s=[{type:o.refType,path:p+o.id+".",multiple:!0}].concat(t);a.popupAddColumnMenu(e,s,i)}else if(o.isField)if(u){for(var r=[{icon:"i-32-24 i-light-grey i-arrow-solid-left",caption:locale.back,click:w}],l=o.aggregations,c=0;c<l.length;c++){var d=l[c];r.push({caption:locale.agg[d]+"("+o.caption+")",field:o,agg:d,click:y})}new Xo({offset:n,head:{caption:locale.showColumn},items:r})}else a.addColumn(e+1,p+o.id)}function y(){var t=this.agg,i=this.field;a.addColumn(e+1,t+"("+p+i.id+")")}function b(){new Ai.a({schema:a.type.schema,type:a.type,variables:{},supportsCommands:!1,value:"",okay:function(t,i){t&&i&&a.addColumn(e+1,t)},cancel:function(){}})}function w(){a.popupAddColumnMenu(e,t,i)}function x(){var o=t.slice(1);a.popupAddColumnMenu(e,o,i)}new Xo({offset:n,head:s?void 0:{caption:locale.showColumn},items:r})},Ks.prototype.removeColumn=function(e){var t=this.getConfiguration();t.cols.splice(e,1),e===t.sort?t.sort=void 0:e<t.sort&&t.sort--,e===t.group&&(t.group=void 0),e<t.group&&t.group--,this.configureAndLoad(t),this.saveView()},Ks.prototype.addColumn=function(e,t){var i=this.getConfiguration();i.cols.splice(e,0,{expression:t}),e<=i.sort&&i.sort++,e<=i.group&&i.group++,this.configureAndLoad(i),this.saveView()},Ks.prototype.saveView=function(){this.container.saveView()},Ks.prototype.getSelectedNids=function(){for(var e=this.rows,t=this.models,i=[],o=0;o<e.length;o++){var n=e[o];t[n]&&i.push(n)}return i},Ks.prototype.getChoosenNids=function(){for(var e=this.midChoosen,t=this.rows,i=this.models,o=[],n=0;n<t.length;n++){var a=t[n];i[a]&&e[a]&&o.push(a)}return o},Ks.prototype.getChoosenOrSelectedNids=function(){return k.isEmpty(this.midChoosen)?this.getSelectedNids():this.getChoosenNids()},Ks.prototype.dragValue=function(e,t,i,o,n,a){var s=this,r=this.rows,l=this.models,c=this.getWritableField(e);if(c){var d=c.base,h=c.id,p=n?"date"===d?E:"datx"===d?D:"timestamp"===d?E:"time"===d||"timeinterval"===d?N:"number"===d?_:S:S,u=r[t];if(u){var f=l[u];if(f){var m=f.values[e];void 0===m&&(m=null);for(var g=[],v=a?i-o-1:1,y=i;y<=o;y++){var b=r[y];if(b){var w=l[b];if(w){var x=p(m,v),T=w.values[e];if(!c.equals(x,T)&&database.canWriteNodeField(b,h)){var C={_id:b};C[h]=x,g.push(C)}v++}}}g.length?($.loading(!0),s.silent=!0,database.updateNodes(g,(function(e){$.loading(!1),s.silent=!1,e&&$.alert(e),s.calc(s._reloadId,r,(function(){s.aggregate(),s.updateRows(),s.updateFoot(),k()}))}))):k()}}}function k(){s.selectBlock(Math.min(t,i,o),e,Math.max(t,i,o),e)}function S(e,t){return null==e?null:e}function _(e,t){return null==e?null:e+t}function E(e,t){if(null==e)return null;var i=new Date(e);return i.setDate(i.getDate()+t),i.getTime()}function D(e,t){if(null==e)return null;var i=new Date(e);return i.setDate(i.getDate()+t),i.getTime()}function N(e,t){return null==e?null:e+36e5*t}},Ks.prototype.getWritableField=function(e){var t=this.type,i=this.cols[e];if(i){var o=i.expression?i.expression.toString():void 0,n=t.fields[o];if(n&&database.canWrite(n))return n}},Ks.prototype.toggleRowChoosen=function(e,t){var i=this.rows,o=i[e];if(o){var n=this.models;if(n[o]){var a,s=this.midChoosen;if(s[o]){if(delete s[o],!1,t)if(null!=(a=this.selectionR0)){a>e?(l=a,a=e):l=e;for(var r=a;r<=l;r++){n[c=i[r]]&&delete s[c]}}}else if(s[o]=!0,!0,t)if(null!=(a=this.selectionR0)){var l;a>e?(l=a,a=e):l=e;for(r=a;r<=l;r++){var c;n[c=i[r]]&&(s[c]=!0)}}this.updateRows(),this.aggregateFoot(),this.updateFoot()}}},Ks.prototype.colX=function(e,t){var i=this.cols;return i[Math.max(0,Math.min(e,t,i.length-1))].left},Ks.prototype.colW=function(e,t){var i=this.cols,o=i.length-1;e>=0||(e=0),t>=0||(t=0),e<=o||(e=o),t<=o||(t=o);var n=i[Math.min(e,t)],a=i[Math.max(e,t)];return a.left+a.width-n.left},Ks.prototype.rowY=function(e,t){var i=e<t?e:t;return(i-this.ridxTop)*this.rowHeight+(i-this.ridxTop)*Xs},Ks.prototype.rowH=function(e,t){return(Math.abs(t-e)+1)*this.rowHeight},Ks.prototype.rowHWithMargin=function(e,t){return(Math.abs(t-e)+1)*(this.rowHeight+Xs)-Xs},Ks.prototype.keydown=function(e){console.log("Table.keydown",e.which);var t=e.which,i=this.isEditing(),o=this.isTableEditMode();switch(t){case 8:i||"cell"!==this.selectionMode&&"block"!==this.selectionMode?e.metaKey&&!i&&"row"===this.selectionMode&&(k.isEmpty(this.midChoosen)?this.remove():this.removeAllChoosen(),e.preventDefault()):(this.editorDelete(),e.preventDefault());break;case 9:o?e.shiftKey?this.editorPrev():this.editorNext():ui.sideEditor.focus(),e.preventDefault();break;case 13:if(e.shiftKey)this.editorInsert("down");else{var n=this.rows[this.selectionR0];"row"===this.selectionMode&&n&&this.groups[n]?this.toggle(n):i?this.editorDown():this.startEdit()}e.preventDefault();break;case 27:i?this.stopEdit(!1):this.selectNothing(),e.preventDefault();break;case 32:this.onlyChoosen?this.showAll():k.isEmpty(this.midChoosen)||this.showOnlyChoosen(),e.preventDefault();break;case 33:e.metaKey?this.editorPrevGroup():this.editorPageUp(),e.preventDefault();break;case 34:e.metaKey?this.editorNextGroup():this.editorPageDown(),e.preventDefault();break;case 35:this.editorLast(),e.preventDefault();break;case 36:this.editorFirst(),e.preventDefault();break;case 37:n=this.rows[this.selectionR0];"row"===this.selectionMode&&n&&this.groups[n]?this.collapse(n):this.editorPrev(e.shiftKey),e.preventDefault();break;case 38:e.metaKey?this.editorFirst(e.shiftKey):e.altKey?this.editorPageUp():this.editorUp(e.shiftKey),e.preventDefault();break;case 39:n=this.rows[this.selectionR0];"row"===this.selectionMode&&n&&this.groups[n]?this.expand(n):this.editorNext(e.shiftKey),e.preventDefault();break;case 40:e.metaKey?this.editorLast(e.shiftKey):e.altKey?this.editorPageDown():this.editorDown(e.shiftKey),e.preventDefault();break;default:i||((e.metaKey||e.ctrlKey)&&70===t?(this.openFindMenu(),e.preventDefault()):!o||e.metaKey||e.ctrlKey||8===t||16===t||17===t||18===t||91===t||93===t||t>=112&&t<=123||this.startEdit())}},Ks.prototype.nodeRenamed=function(e,t,i){var o=this,n=this.models[t];n&&(n.id=i,delete this.models[t],this.models[i]=n);var a=this.rows.indexOf(t);-1!==a&&(this.rows[a]=i),this.midChoosen[t]&&(delete this.midChoosen[t],this.midChoosen[i]=!0),(this.selectionMid0=t)&&(this.selectionMid0=i),(this.selectionMid1=t)&&(this.selectionMid1=i),o.recalc(i,(function(){o.aggregate(),o.updateRows(),o.updateFoot()}))},Ks.prototype.rowsChanged=function(){this.container.rowsChanged()},Ks.prototype.loadTableRowHeight=function(){if(void 0===Js){Js=40;const e=NinoxDocumentInteraction.getUserDefault("ui.table.rowHeight");if(e){const t=parseInt(e);t>=28&&t<=120&&(Js=t)}}return Js},Ks.prototype.saveTableRowHeight=function(e){Js=e,NinoxDocumentInteraction.setUserDefault("ui.table.rowHeight",String(e))},er.prototype.base="table",er.prototype.destroy=function(){return database.off("schema",void 0,this.schemaChanged,this),database.off("change",void 0,this.dataChanged,this),database.off("create",void 0,this.dataChanged,this),database.off("remove",void 0,this.dataChanged,this),database.off("view",void 0,this.viewsChanged,this),this.$controls.remove(),n.unmountComponentAtNode(this.$tabs[0]),this.$tabs.remove(),this.table.destroy(),k.each(this.renderers,(function(e){e.destroy()})),!1},er.prototype.show=function(){this.visible||(ui.currentTab&&ui.currentTab.hide(),this.visible=!0,ui.currentTab=this,this.$controls.appendTo(ui.$menuCenter),this.$tabs.appendTo(ui.$header),this.updateTabs(),this.reloadViews(),this.showView())},er.prototype.hide=function(){this.visible&&(this.visible=!1,this.saveView(),this.$controls.detach(),n.unmountComponentAtNode(this.$tabs[0]),this.$tabs.detach(),this.hideView())},er.prototype.schemaChanged=function(e,t,i){this.visible&&(database.schema.types[this.tid]?this.updateSwitch():ui.openHome())},er.prototype.dataChanged=function(e){this.visible&&k.each(this.renderers,(function(e){e.dataChanged()}))},er.prototype.viewsChanged=function(e,t,i){this.visible&&(this.reloadViews(),this.updateTabs(),this.showView())},er.prototype.reloadViews=function(){var e=this,t=this.tid;if(e.views=[],k.each(util.localeSortBy(k.filter(k.where(database.views,{type:t}),(function(e){return database.canReadView(e)})),"caption"),(function(t){t&&(t.config&&t.config.type!==t.type&&(console.log("Correct view config"),t.config.type=t.type),e.views.push(t))})),0===this.views.length){var i={id:util.createUUID(16),type:t,caption:locale.all,order:10,config:{type:t}};this.views.push(i),database.saveView(i,(function(){}))}else{for(let e=0;e<this.views.length;e++)void 0===this.views[e].order&&(this.views[e].order=10*(e+1));this.views=util.localeSortBy(this.views,"order")}this.updateSwitch()},er.prototype.reorderView=function(e,t,i){const o=this.views[e];let n=null;this.selectedView[this.tid]===e&&(n=t),e>t?(null===n&&this.selectedView[this.tid]<=e&&this.selectedView[this.tid]>=t&&(n=this.selectedView[this.tid]+1),o.order=0===t?this.views[0].order/2:(this.views[t-1].order+this.views[t].order)/2):t>e&&(null===n&&this.selectedView[this.tid]>=e&&this.selectedView[this.tid]<=t&&(n=this.selectedView[this.tid]-1),t===this.views.length-1?o.order=this.views[this.views.length-1].order+10:o.order=(this.views[t+1].order+this.views[t].order)/2),null!==n&&(this.selectedView[this.tid]=n),this.views=util.localeSortBy(this.views,"order"),database.saveView(o,(function(){})),this.updateTabs(),this.popupTabsOpen&&this.popupTabs(null,i)},er.prototype.updateTabs=function(){this.visible&&(null==this.selectedView[this.tid]&&0!==this.views.length||n.render(s.createElement(ns,{onReorder:(e,t)=>this.reorderView(e,t),isAdmin:database.isAdmin(),selectedIndex:this.selectedView[this.tid],views:this.views,onNewViewClick:()=>this.createView(),onTabClick:e=>this.tabsClicked(e),onRemoveView:e=>this.removeView(e),onRenameView:e=>this.renameView(e),onEditColumns:e=>this.popupColumnMenu(e)}),this.$tabs[0]))},er.prototype.updateSwitch=function(){var e=this.views[this.selectedView[this.tid]];e&&e.mode;this.showSearch(),this.showSmallMenu();var t=e&&e.searchString||"";this.$search.val(t),this.$searchText.text(t||locale.searchIn$.replace("$",database.schema.types[this.tid].caption)).css("color",t?"":"#676d82"),this.$searchCancel.css("display",t?"":"none")},er.prototype.showSearch=function(){ui.fullWidth-ui.leftWidth<=510?this.$searchContainer.css("width","162px"):this.$searchContainer.css("width","236px")},er.prototype.showSmallMenu=function(){TOUCH||ui.fullWidth<=640?this.$menuSmall.css("display","flex"):this.$menuSmall.css("display","none")},er.prototype.tabsClicked=function(e){var t=this.views[e];t&&ui.openTable(t.type,t.id)},er.prototype.showView=function(){var e=this.views[this.selectedView[this.tid]];if(e){var t=e.mode,i=this.renderers[t]?t:"table";this.table.setVisible("table"===i),k.each(this.renderers,(function(e){e.setVisible(i===e.mode)})),this.updateSwitch()}},er.prototype.hideView=function(){this.table.hide(),k.each(this.renderers,(function(e){e.hide()}))},er.prototype.removeView=function(e){if(Object(l.f)("View","Remove"),console.log("TableView.removeView"),null==e&&(e=this.selectedView[this.tid]),null==e)return;const t=this.views[e];if(!t)return;const i=this.selectedView[this.tid],o=this.views[i]?this.views[i].id:void 0,n=e===i?i-1:i,a=this.views[n],s=a?a.id:void 0;$.loading(!0),database.removeView(t.id,()=>{this.selectedView[this.tid]=n,$.loading(!1),s===o?(this.selectedView[this.tid]=e<i?i-1:i,this.viewsChanged()):ui.openTable(t.type,s)})},er.prototype.renameView=function(e){Object(l.f)("View","Rename");var t=this;null==e&&(e=this.selectedView[this.tid]);var i=this.views[e];if(i){var o=$.popdown({cls:"small"});$('<div class="nx-section-head">').text(locale.renameView).appendTo(o.$pane);var n=$('<div class="nx-section-pane">').appendTo(o.$pane),a=$('<div class="component editor editor-string" style="width:100%">').appendTo(n);$("<label>").text(locale.enterViewName).appendTo(a);var s=$('<input type="text">').val(i.caption||"").appendTo($('<div class="stringeditor">').appendTo(a)).keydown((function(e){13===e.which&&c(),27===e.which&&d()})),r=$('<div class="nx-button-bar">').appendTo(n);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(r).click(d),$('<div class="nx-hspace-flex">').appendTo(r),$('<div class="nx-button-text blue">').text(locale.rename).appendTo(r).click(c),setTimeout((function(){s.focus()}),400)}function c(){var e=s.val().trim();e?(Object(l.f)("View","RenameConfirm"),d(),i.caption=e,database.saveView(i,(function(){})),t.selectedIndex=t.views.indexOf(i),t.updateTabs(),t.updateSwitch()):s.focus()}function d(){o.close()}},er.prototype.createView=function(){if(database.isAdmin()){Object(l.f)("View","Create");var e=this,t=this.tid,i=this.views[this.selectedView[this.tid]];i||(i={type:t,mode:"table",config:{type:t}});var o=$.popdown({cls:"small"});$('<div class="nx-section-head">').text(locale.newView).appendTo(o.$pane);var n=$('<div class="nx-section-pane">').appendTo(o.$pane),a=$('<div class="component editor editor-string" style="width:100%">').appendTo(n),s=$('<input type="text">').attr("placeholder",locale.enterViewName).appendTo($('<div class="stringeditor">').appendTo(a)).keydown((function(e){13===e.which&&d(),27===e.which&&h()})),r=i.mode||"table";$.switchpane({items:[{id:"table",caption:locale.table,icon:"i-32-24 i-light-grey i-setting-table"},{id:"full",caption:locale.form,icon:"i-32-24 i-light-grey i-form"},{id:"chart",caption:locale.chartView,icon:"i-32-24 i-light-grey i-setting-table-chart"},{id:"cards",caption:locale.cards,icon:"i-32-24 i-light-grey i-home"},{id:"kanban",caption:locale.kanban,icon:" i-32-24 i-light-grey i-kanban"},{id:"gantt",caption:locale.gantt,icon:"i-32-24 i-light-grey i-gantt"},{id:"pivot",caption:"Pivot",icon:"i-32-24 i-light-grey i-setting-table"}],value:r,update:function(e){r=e,s.focus()}}).appendTo(n);var c=$('<div class="nx-button-bar">').appendTo(n);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(c).click(h),$('<div class="nx-hspace-flex">').appendTo(c),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(c).click(d),setTimeout((function(){s.focus()}),400)}function d(){Object(l.f)("View","CreateConfirm",{viewType:r});var t=s.val().trim();t||(t={table:locale.table,chart:locale.chartView,cards:"Cards",kanban:"Kanban",gantt:"GANTT",calendar:"Calendar",full:locale.form,pivot:"Pivot"}[r]),h();var o=util.getPersistentView(i);let n;o.id=util.createUUID(16),o.mode=r,o.caption=t||locale.unnamed;const a=e.views[e.views.length-1].order;n=void 0!==a?a+10:10*(e.views.length+1),o.order=n,$.loading(!0),database.saveView(o,()=>{$.loading(!1),e.reloadViews(),ui.openTable(o.type,o.id)})}function h(){o.close()}},er.prototype.setViewMode=function(e){var t=this.selectedView[this.tid],i=this.views[t];i&&(i.mode="form"===e?"table":e,this.saveView(),this.showView())},er.prototype.getViewCaption=function(){var e=this.selectedView[this.tid],t=this.views[e];if(t)return t.caption},er.prototype.getViewProperty=function(e){var t=this.selectedView[this.tid],i=this.views[t];if(i)return i[e]},er.prototype.setViewProperties=function(e){var t=this.selectedView[this.tid],i=this.views[t];if(i){var o=!1;for(var n in e)if(e.hasOwnProperty(n)){var a=e[n];i[n]!==a&&(i[n]=a,o=!0)}o&&this.saveView()}},er.prototype.showPrint=function(){Object(l.f)("Table","PrintView"),Object(Ee.a)(this.table)},er.prototype.popupColumnMenu=function(e){Object(l.f)("Table","EditColumns"),null==e&&(e=this.selectedView[this.tid]);var t=this,i=this.views[e];if(i){var o=this.table;new Ps.a({hasTop:!0,caption:i.caption,readRoles:i.readRoles,config:o.getConfiguration(),save:function(e){var n=e.config;i.caption=e.caption,i.readRoles=e.readRoles,i.config=n,database.saveView(i,(function(){})),t.updateTabs(),t.updateSwitch(),o.setConfig(i.config),t.showView(),t.reload()}})}},er.prototype.popupActions=function(){var e=this,t=this.tid,i=this.table,o=$.backplane(),n=$('<div class="nx-menu-popup" style="border-radius:4px">').appendTo(o);database.isAdminEnabled()&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.editFields+"...")).touch((function(){Object(l.f)("Table","EditFields"),c(),new eo({type:t})})).appendTo(n),database.authorizationMassDataUpdate&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.updateAssistant+"...")).appendTo(n).touch((function(){c(),new as(i)})),database.authorizationImport&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.importData+"...")).appendTo(n).touch((function(){Object(l.f)("Table","ImportData"),c(),new pi({tid:t})})),database.authorizationExport&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.exportData+"...")).appendTo(n).touch((function(){c(),Object(l.f)("Table","ExportData"),i.exportData((function(e){e&&$.alert(e)}))})),database.authorizationExport&&database.supports.sharing&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.shareView+"...")).appendTo(n).touch((function(){c(),e.shareView()})),database.authorizationPrint&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.printView)).appendTo(n).touch((function(){c(),e.showPrint()}));var a=n.outerWidth(),s=n.outerHeight(),r=e.$popupActions.offset();function c(){o.close()}r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)},er.prototype.saveView=function(){if(database.schema.types[this.tid]){var e=this.selectedView[this.tid];if(null!==e){var t=this.views[e];t&&(t.config=this.table.getConfiguration(),database.saveView(t,(function(){})))}}},er.prototype.getNavigationState=function(){var e=this.views[this.selectedView[this.tid]],t=e?e.id:void 0;return{base:"table",tid:this.tid,vid:t,table:this.table.getNavigationState()}},er.prototype.setNavigationState=function(e){var t=this;console.log("TableView.setNavigationState",e);var i=e.tid,o=e.nid;const n=this.views[this.selectedView[i]];if(i!==this.tid){if(this.navigationStateByTid[i]&&(void 0===e.nid||void 0===e.tabId)){const e=this.navigationStateByTid[i];console.log("TableView.setNavigationState => new state 1"),vt(Zs({},Tt(),{nid:e.nid,tabId:e.tabId}))}}else if(n){const t=Tt(),i=ui.getCurrentEditor();if(!(i&&i.getSelectedTab()!==t.tabId||this.table.getSelectedNid()!==t.nid&&"table"!==n.mode||e.vid!==n.id))return void console.log("TableView.setNavigationState: no change")}this.selectedView[this.tid];var a=e.vid,s=e.tab,r=e.table||{};o&&(r.selectionMid0=o,r.selectionMid1=o,r.selectionMode="row"),this.tid=i,this.navigationStateByTid[i]={nid:o,tabId:s},this.reloadViews();var l=0;if("default"===a)l=null!=this.selectedView[i]?this.selectedView[i]:0;else for(var c=0;c<this.views.length;c++){if(this.views[c].id===a){l=c;break}}var d=this.views[l];if(d){this.selectedView[i]=d.id,a!==d.id&&vt(Zs({},Tt(),{vid:d.id})),this.selectedView[i]=l,this.updateSwitch(),this.table.setConfig(d.config,r),this.selectionChanged(),this.visible?this.showView():this.show(),this._reloadId=(this._reloadId||0)+1;var h=this._reloadId;this.reload((function(){if(t.visible&&h===t._reloadId&&(t.updateTabs(),o&&!t.table.groups[o]))if(t.table.models[o]){for(let e=0;e<t.table.rows.length;e++)if(t.table.rows[e]===o){t.table.scrollToRow(e);break}if(s){const e=ui.getCurrentEditor();null!=e&&e.selectTab(s)}}else vt(Zs({},Tt(),{nid:void 0,tab:void 0}))}))}else $.alert("View not found.")},er.prototype.reload=function(e){console.log("TableView.reload");var t=this;$.loading(!0),t.table.load((function(t){console.log("TableView.reload: done"),$.loading(!1),t&&console.warn(t),e&&e()}))},er.prototype.loaded=function(){k.each(this.renderers,(function(e){e.queryLoaded()}))},er.prototype.rowsChanged=function(){this.visible&&k.each(this.renderers,(function(e){e.rowsChanged()}))},er.prototype.popupContextMenu=function(e){var t=this.views[this.selectedView[this.tid]],i=t&&"chart"!==t.mode||!1;this.table&&i&&this.table.openContextMenu(e)},er.prototype.shareView=function(){Object(l.f)("Table","ShareView");var e=this.views[this.selectedView[this.tid]];e&&($.loading(!0),database.loadSharedView(e.id,(function(t,i){if($.loading(!1),t)return $.alert(t);var o=!1,n=$.popdown({head:locale.shareView,buttons:[{caption:locale.cancel,cls:"grey",click:y},"-",{caption:locale.okay,cls:"blue",click:v}],closable:!1}),a=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.activateSharing,required:!0,booleanRenderer:"switch",width:1}));a.value=!!i.url,a.on("update",(function(){a.value?m((function(e){e&&$.alert(e)})):g((function(e){e&&$.alert(e)}))}));new qt.a(void 0,a,n.$content);var s=new util.SimpleModel(new schemas.TLink(void 0,void 0,{caption:locale.shareURL,width:3}));s.isWritable=function(){return!1};var r=new qt.a(void 0,s,n.$content),l=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.showAs,width:4,required:!0,choiceRenderer:"switch",values:{html:{id:"html",caption:"HTML",order:1},pdf:{id:"pdf",caption:"PDF",order:2},xlsx:{id:"xlsx",caption:"Excel",order:3},csv:{id:"csv",caption:"CSV",order:4},json:{id:"json",caption:"JSON",order:5}}}));l.value=i.options&&i.options.contentType||"html",l.on("update",(function(){u(),f(),m((function(e){e&&$.alert(e)}))}));var c=new qt.a(void 0,l,n.$content),d=$("<div>").appendTo(n.$content),h=new Jt(Object.assign({},i.csv,{$container:d,onUpdate:p}));function p(){u(),m((function(e){e&&$.alert(e)}))}function u(){o=!0}function f(){r.el.css("display",i.url?"":"none"),c.el.css("display",i.url?"":"none"),d.css("display",i.url&&"csv"===l.value?"":"none"),s.setValue(i.url||"")}function m(t){$.loading(!0),database.shareView(e.id,{contentType:l.value,csv:h.getCSVExportOptions()},(function(e,n){if($.loading(!1),e)return t(e);i=n,o=!1,f(),t()}))}function g(t){$.loading(!0),database.unshareView(e.id,(function(e){if($.loading(!1),e)return t(e);i={},o=!1,f(),t()}))}function v(){if(!o)return b();m((function(e){if(e)return $.alert(e);b()}))}function y(){b()}function b(){n.close((function(){c.destroy(),r.destroy(),h.destroy()}))}f()})))},er.prototype.bodyResized=function(){k.each(this.renderers,(function(e){e.bodyResized()})),this.updateTabs(),this.showSearch(),this.showSmallMenu()},er.prototype.selectionChanged=function(){k.each(this.renderers,(function(e){e.selectionChanged()}));const e=Tt(),t=this.table.getSelectedNid();t!==e.nid&&"form"===this.views[this.selectedView[this.tid]].mode&&vt(Zs({},e,{nid:t}))},er.prototype.searchChanged=function(e){var t=this.$search.val();this.$searchText.text(t||locale.searchIn$.replace("$",database.schema.types[this.tid].caption)).css("color",t?"":"#676d82"),this.$searchCancel.css("display",t?"":"none");var i=this.views[this.selectedView[this.tid]];i&&(i.searchString=t),t?this.table.applyFind(t):this.table.clearFind()},er.prototype.hasLash=function(){var e=this.views[this.selectedView[this.tid]];return e&&("table"===e.mode||void 0===e.mode)};const or=0,nr=48,ar=48;function sr(){const e={};return window.log=ia,Object.assign(e,b.util.events),e.Views={home:jn,calendar:Gn,search:Zn},e.leftDivider=void 0,e.rightDivider=void 0,e.$head=void 0,e.$left=void 0,e.$right=void 0,e.$body=void 0,e.$overlays=void 0,e.$tableContextMenuContainer=void 0,e.$foot=void 0,e.$header=void 0,e.$menu=void 0,e.$menuCenter=void 0,e.$menuRight=void 0,e.setIsInitialized=t=>{e.isInitialized=t,NinoxViewController.setMenuState({ninox_menuEnabled:{menuNewDatabase:!e.isInitialized,menuImportArchive:!e.isInitialized,menuSaveArchiveAs:!!e.isInitialized&&window.database&&!window.database.sql,menuDuplicateDatabase:!!e.isInitialized&&window.database&&!window.database.sql,menuRenameDatabase:!!e.isInitialized,menuReorganizeDatabase:!!(e.isInitialized&&window.database&&database.cloud),menuDeleteDatabase:!!e.isInitialized,menuCloseDatabase:!!e.isInitialized}})},e.setIsInitialized(!1),e.topPadding=or,e.planInfo=void 0,e.$planInfo=void 0,e.setTopPadding=Tr,e.currentView=void 0,e.navigationStates={},e.destroy=Yr,e.backToRoot=Jr,e.handleLogout=Kr,e.init=il,e.updateBackground=Xr,e.showRight=Wr,e.hideRight=qr,e.getAvailableTypes=cr,e.openTable=_r,e.createTable=Er,e.openCalendar=kr,e.openSearch=$r,e.openHome=Sr,e.openRecord=Dr,e.popupRecord=Nr,e.openFullscreen=Mr,e.closeFullscreen=Fr,e.closeRecord=Or,e.closeAllRecords=Rr,e.navigate=Cr,e.getCurrentEditor=Lr,e.dropDatabase=sl,e.saveArchiveAs=rl,e.duplicateDatabase=ll,e.renameDatabase=cl,e.evictDatabase=dl,e.reorganizeDatabase=hl,e.createDatabase=pl,e.importArchive=ul,e.showLeftPanel=ur,e.hideLeftPanel=fr,e.setCloudSyncState=ol,e.views={},e.fullscreenStack=[],e.rightVisible=!1,e.fullWidth=0,e.bodyWidth=0,e.leftWidth=180,e.isLeftOpen=!0,e.isLeftOpenSaved=!0,e.isLeftOpenVerticalSaved=!0,e.rightWidth=672,e.leftWidthSaved=180,e.rightWidthSaved=672,e.leftWidthVerticalSaved=180,e.rightWidthVerticalSaved=672,e.footHeight=0,e.headHeight=96,e.initRoot=function(){window.root=new Qa},e}function rr(e){let t,i=void 0,o=void 0,n=void 0,a=e.moduleId;switch(e.moduleId){case"default":a="home",t="home";break;case"home":case"calendar":case"search":t=e.moduleId;break;default:let s=void 0;const r=cr(!0);for(const t of r)if(s=t.id===e.moduleId?t:t.children.find(t=>t.id===e.moduleId),s)break;void 0===s?(a="default",i="default"):i=s.id,o=e.nid,n=e.tabId,t="table"}return"default"===e.moduleId||"default"===i?(vt(ir({},e,{moduleId:a,vid:"default"})),rr(ir({},e,{moduleId:a,vid:"default"}))):{base:t,tid:i,vid:e.vid,nid:o,tab:n}}function lr(){const e=e=>{window.database&&(e.teamId!==database.account.id||e.dbId!==database.id?dbms.closeDatabase((function(){window.location.reload()})):jr(rr(e)))};Ct("tab",e,null),Ct("view",e,null),Ct("team",e=>{window.database&&dbms.closeDatabase((function(){window.location.reload()}))},null)}function cr(e){const t=b.util.localeSortBy(database.schema.types,"order").filter(t=>dr(t,e)),i=[];for(const o of t){if(o.master)continue;const t=o.getAllChildren().filter(t=>dr(t,e));o.children=b.util.localeSortBy(t,"order"),i.push(o)}return i}function dr(e,t){return database.canRead(e)&&(t||!e.hidden)||database.adminMode&&database.isAdminEnabled()}function hr(){return 0===window.orientation||180===window.orientation}function pr(){wr(!0)}function ur({shouldResetWidth:e}){ui.isLeftOpenSaved=!0,e?mr(ui.leftWidth||180):wr(),yr()}function fr(){ui.isLeftOpenSaved=!1,wr(),yr()}function mr(e){e=e<20?0:vr(e,180,54,640),ui.leftWidthSaved=e,wr()}function gr(){var e=NinoxDocumentInteraction.getUserDefault("ui.left.width");ui.leftWidthSaved=0===e||"0"===e?0:vr(e,180,54,640);var t=NinoxDocumentInteraction.getUserDefault("ui.left.isOpen");ui.isLeftOpenSaved=!("false"===t||!1===t);var i=NinoxDocumentInteraction.getUserDefault("ui.right.width");ui.rightWidthSaved=vr(i,672,128,2048)}function vr(e,t,i,o){return e||(e=t),e="number"!=typeof e?parseInt(e,10):Math.round(e),isNaN(e)&&(e=t),e<i&&(e=i),e>o&&(e=o),e}function yr(){NinoxDocumentInteraction.setUserDefault("ui.left.width",ui.leftWidthSaved),NinoxDocumentInteraction.setUserDefault("ui.right.width",ui.rightWidthSaved),NinoxDocumentInteraction.setUserDefault("ui.left.isOpen",ui.isLeftOpenSaved)}function br(e){e=vr(e,672,128,2048),ui.rightWidthSaved=e,wr()}function wr(e){hr();var t=ui.isLeftOpenSaved,i=ui.leftWidthSaved,o=ui.rightWidthSaved,n=window.getWidth(),a=n-(i=0===i||"0"===i?0:Math.max(54,Math.min(Math.floor(n-480),Math.floor(n/3),i)))-(o=Math.max(320,Math.min(n-i,o)));ui.fullWidth!==n||ui.leftWidth!==i||ui.rightWidth!==o||ui.bodyWidth!==a||ui.isLeftOpen!==t?(ui.fullWidth=n,ui.leftWidth=i,ui.rightWidth=o,ui.bodyWidth=a,ui.isLeftOpen=t,xr()):e&&ui.currentView&&ui.currentView.bodyResized&&ui.currentView.bodyResized(),ui.fullWidth<=640?(ui.$foot[0].style.display="",ui.footHeight=48+$.getDevicePadding().bottom):(ui.$foot[0].style.display="none",ui.footHeight=0+$.getDevicePadding().bottom),ui.$foot[0].style.height=ui.footHeight+"px",ui.$body[0].style.bottom=ui.footHeight+"px",ui.$right[0].style.bottom=ui.footHeight+"px",ui.$left[0].style.bottom=ui.footHeight+"px"}function xr(){var e=window.getWidth()<=640,t=ui.isLeftOpen?ui.leftWidth:0,i=ui.rightVisible?ui.rightWidth:0;NinoxViewController.setLeftWidth&&NinoxViewController.setLeftWidth(t),ui.$left[0].style.width=t+"px",ui.$body[0].style.left=t+"px",ui.$body[0].style.right=i+"px",ui.$head[0].style.left=t+"px",ui.$headerContainer[0].style.left=t+"px",ui.$menu[0].style.left=t+"px",ui.$head[0].style.top=ui.topPadding+ar+"px",ui.$headerContainer[0].style.top=ui.topPadding+"px",ui.$menu[0].style.top=ui.topPadding+ar+8+"px",ui.$menuRight[0].style.top=ui.topPadding+ar+8+"px",ui.$left[0].style.top=ui.topPadding+"px",ui.$body[0].style.top=ui.topPadding+nr+ar+"px",e?(ui.$right[0].style.top="0",ui.$right[0].style.left="0",ui.$right[0].style.right="0",ui.$right[0].style.width="",ui.$right[0].style.zIndex=10,ui.rightDivider[0].style.display="none"):(ui.saveSchemaDialog[0].style.top=ui.topPadding+6+"px",ui.$adminContainer[0].style.top=ui.topPadding+8+"px",ui.$right[0].style.top=ui.topPadding+nr+ar+"px",ui.$right[0].style.width=ui.rightWidth+"px",ui.$right[0].style.left="",ui.$right[0].style.right="",ui.$right[0].style.zIndex="",ui.rightDivider[0].style.display=""),ui.currentView&&ui.currentView.bodyResized&&ui.currentView.bodyResized(),ui.sideEditor&&ui.sideEditor.resize(),ui.navigation&&ui.navigation.resize(),ui.recordNavigation&&ui.recordNavigation.resize(),Bo()}function Tr(e){ui.topPadding=0===e?or:e,ui.isInitialized&&xr()}function Cr(e){jr(e)}function kr(){Object(l.f)("Calendar","Open"),gt(ir({},Tt(),{moduleId:"calendar",vid:"default",nid:void 0,tabId:void 0}))}function $r(){Object(l.f)("Search","Open"),gt(ir({},Tt(),{moduleId:"search",vid:"default",nid:void 0,tabId:void 0}))}function Sr(){Object(l.f)("DatabaseHome","Open"),gt(ir({},Tt(),{moduleId:"home",vid:"default",nid:void 0,tabId:void 0}))}function _r(e,t,i,o){Object(l.f)("Table","Open"),gt(ir({},Tt(),{moduleId:e,vid:t||"default",nid:i,tabId:o}))}function Er(){Object(l.f)("Table","Create"),new eo({afterSaveType:function(e){}})}function Dr(e,t){const i=Ir(b.schemas.tidOf(e),t);_r(b.schemas.tidOf(e),void 0,e,i)}function Nr(e,t){const i=new kn.PopupEditor(e),o=Ir(b.schemas.tidOf(e),t);o&&i.editor.selectTab(o)}function Ir(e,t){if(!t)return;const i=database.schema.types[e],o=i&&i.sorted.find(e=>"tab"===e.base&&e.caption===t);return o&&o.id}function Or(){widgets.popupEditorStack.length>0?widgets.popupEditorStack[widgets.popupEditorStack.length-1].close():ui.sideEditor&&ui.sideEditor.close()}function Mr(e,t,i){const o=new ea(e,t);ui.fullscreenStack.push(o);const n=Ir(b.schemas.tidOf(e),t.tab||i);n&&o.editor.selectTab(n)}function Fr(){var e=ui.fullscreenStack.pop();e&&e.close()}function Rr(){for(;widgets.popupEditorStack.length>0;){widgets.popupEditorStack[widgets.popupEditorStack.length-1].close()}ui.sideEditor&&ui.sideEditor.close()}function Lr(){return ui.currentView&&"table"===ui.currentView.base&&ui.currentView.renderers&&ui.currentView.renderers.full&&ui.currentView.renderers.full.visible?ui.currentView.renderers.full.editor:ui.sideEditor.editor}function jr(e){if(null!==e){var t;if(ui.currentView){var i=ui.currentView.getNavigationState();Pr(i),(t=Ar(e)).base!==i.base?(ui.currentView.hide(),ui.currentView=Ur(t),ui.currentView.show()):ui.currentView.setNavigationState(t)}else t=Ar(e),ui.currentView=Ur(t),ui.currentView.show();ui.navigation.updateState(t),trackPageView({home:"database"}[e.base]||e.base),"home"===t.base&&"history"===t.vid?ui.$head.css("display",""):ui.$head.css("display",{table:1,calendar:1,search:1}[t.base]?"":"none"),ui.currentView&&ui.currentView.hasLash&&ui.currentView.hasLash()?ui.rightVisible||zr():Vr()}}function Ar(e){switch(e.base){case"table":return Object.assign({},e.tid&&e.vid&&ui.navigationStates["table:"+e.tid+":"+e.vid]||e.tid&&ui.navigationStates["table:"+e.tid]||{},e);default:return Object.assign(ui.navigationStates[e.base]||{},e)}}function Pr(e){switch(e.base){case"table":ui.navigationStates["table:"+e.tid]=e,ui.navigationStates["table:"+e.tid+":"+e.vid]=e;break;default:ui.navigationStates[e.base]=e}}function Ur(e){const t=ui.views[e.base];return null==t&&vt(ir({},Tt(),{vid:"default"})),t.setNavigationState(e),t}function Hr(e){}function zr(){ui.fullWidth>640&&!TOUCH&&(ui.$lashRight.show(),ui.$lashRight[0].style.transform=ui.$lashRight[0].style.WebkitTransform="translateX(0)")}function Vr(){ui.$lashRight[0].style.transform=ui.$lashRight[0].style.WebkitTransform="translateX(100%)",ui.$lashRight.hide()}function Wr(){Br(),ui.rightVisible||(Vr(),ui.rightVisible=!0,ui.$right[0].style.display="",ui.rightAnimationTimeout=setTimeout((function(){ui.$right[0].style.transform=ui.$right[0].style.WebkitTransform="translateX(0px)",ui.rightAnimationTimeout=setTimeout((function(){xr()}),400)}),0))}function Br(){ui.rightAnimationTimeout&&(clearTimeout(ui.rightAnimationTimeout),ui.rightAnimationTimeout=void 0),ui.rightHidingCallback&&(ui.rightHidingCallback(),ui.rightHidingCallback=void 0)}function qr(e){Br(),ui.rightVisible?(ui.rightVisible=!1,ui.$right[0].style.transform=ui.$right[0].style.WebkitTransform="translateX(100%)",xr(),ui.rightHidingCallback=e,ui.rightAnimationTimeout=setTimeout((function(){ui.rightHidingTimeout=void 0,ui.rightHidingCallback=void 0,ui.$right[0].style.display="none",e&&e()}),400),zr()):e&&e()}function Yr(e){if(n.unmountComponentAtNode(ui.leftDivider[0]),n.unmountComponentAtNode(ui.rightDivider[0]),!ui.isInitialized)return e();window.removeEventListener("popstate",Hr,!1),ui.views.home.destroy(),ui.views.calendar.destroy(),ui.views.search.destroy(),ui.views.table.destroy(),ui.views={},ui.currentView=void 0,ui.rightDivider=void 0,ui.leftDivider=void 0,ui.$head=void 0,ui.$left=void 0,ui.$right=void 0,ui.$body=void 0,ui.$foot=void 0,ui.$header=void 0,ui.$menu=void 0,ui.$menuCenter=void 0,ui.$menuRight=void 0,ui.setIsInitialized(!1),ui.rightVisible=!1,ui.currentView=void 0,ui.$overlays=void 0,ui.$tableContextMenuContainer=void 0,ui.navigationStates={},ui.undoManager=void 0,$(document.body).empty(),window.removeEventListener("resize",pr),dbms.closeDatabase(e)}function Xr(e){ui.currentView&&ui.currentView.updateBackground&&ui.currentView.updateBackground(e)}function Gr(){ui.isInitialized&&(ui.setIsInitialized(!1),window.removeEventListener("resize",pr))}function Jr(){Gr();const e=database.account.id;dbms.closeDatabase((function(){gt({teamId:e}),ui.destroy(()=>{}),window.location.reload()}))}function Kr(e){Gr(),ui.destroy(()=>e())}function Qr(){el(),tl(),Zr()}function Zr(){n.render(s.createElement(Nt,{adminMode:database.adminMode}),ui.rightDivider[0]),n.render(s.createElement(Nt,{adminMode:database.adminMode}),ui.leftDivider[0])}function el(){ui.leftDivider=$('<div class="hud-left-divider">').appendTo(ui.$left),TOUCH?ui.leftDivider[0].addEventListener(EVENT_touchstart,n):ui.leftDivider[0].addEventListener("mousedown",n);var e=0,t=0,i=0,o=!1;function n(n){if(TOUCH){if(1!==n.touches.length)return;e=n.touches[0].clientX,t=n.touches[0].clientY,EVENT_target(n).addEventListener(EVENT_touchmove,a),EVENT_target(n).addEventListener(EVENT_touchend,s),EVENT_target(n).addEventListener("touchcancel",s)}else e=n.clientX,t=n.clientY,window.addEventListener("mousemove",a),window.addEventListener("mouseup",s);o=!1,i=ui.leftWidth,ui.leftDivider.addClass("selected"),!1!==n.cancelable&&n.preventDefault()}function a(n){var a,s;if(TOUCH){if(1!==n.touches.length)return;a=n.touches[0].clientX,s=n.touches[0].clientY}else a=n.clientX,s=n.clientY;var r=a-e,l=s-t;o||r*r+l*l>4&&(o=!0),o&&mr(i+r),n.preventDefault()}function s(e){if(TOUCH){if(0!==e.touches.length)return;EVENT_target(e).removeEventListener(EVENT_touchmove,a),EVENT_target(e).removeEventListener(EVENT_touchend,s),EVENT_target(e).removeEventListener("touchcancel",s)}else window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",s);ui.leftDivider.removeClass("selected"),yr(),e.preventDefault()}}function tl(){ui.rightDivider=$('<div class="hud-right-divider">').appendTo(ui.$right),TOUCH?ui.rightDivider[0].addEventListener(EVENT_touchstart,o):ui.rightDivider[0].addEventListener("mousedown",o);var e=0,t=0,i=0;function o(o){var s=Date.now();if(Math.abs(s-i)<1e3)br(672),yr();else{if(i=Date.now(),TOUCH){if(1!==o.touches.length)return;e=o.touches[0].clientX,EVENT_target(o).addEventListener(EVENT_touchmove,n),EVENT_target(o).addEventListener(EVENT_touchend,a),EVENT_target(o).addEventListener("touchcancel",a)}else e=o.clientX,window.addEventListener("mousemove",n),window.addEventListener("mouseup",a);t=ui.rightWidth,ui.rightDivider.addClass("selected")}o.preventDefault()}function n(i){var o;if(TOUCH){if(1!==i.touches.length)return;o=i.touches[0].clientX}else o=i.clientX;br(t+(e-o)),i.preventDefault()}function a(e){if(TOUCH){if(0!==e.touches.length)return;EVENT_target(e).removeEventListener(EVENT_touchmove,n),EVENT_target(e).removeEventListener(EVENT_touchend,a),EVENT_target(e).removeEventListener("touchcancel",a)}else window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",a);ui.rightDivider.removeClass("selected"),yr(),e.preventDefault()}}function il(){if(ui.isInitialized)return;ui.setIsInitialized(!0),lr(),window.addEventListener("popstate",Hr,!1);const e=Object(c.d)("settings")||{},t=e.windowTitle?e.windowTitle+" - ":"";NinoxDocumentInteraction.setWindowTitle(t+database.name+(database.accountName?" | "+database.accountName:"")),ui.currentView=void 0,ui.navigationStates={},ui.updateBackground(),ui.$left=$('<div class="hud-left">').appendTo($(document.body)),ui.$body=$('<div class="hud-body">').appendTo($(document.body)),ui.$foot=$('<div class="hud-foot" style="display:none;">').appendTo($(document.body)),ui.$right=$('<div class="hud-right" style="transform:translateX(100%);-webkit-transform:translateX(100%)">').hide().appendTo($(document.body)),ui.$lashRight=$('<div class="hud-right-lash"><div class="i-40-24 i-white i-line-left"/>').touch(()=>ui.currentView.table.selectLastRow()).hide().appendTo($(document.body)),zr(),$('<div class="hud-right-border">').appendTo(ui.$right),ui.$head=$('<div class="hud-title">').appendTo($(document.body)),ui.$overlays=$('<div style="z-index: 10">').appendTo($(document.body)),ui.$tableContextMenuContainer=$("<div>").appendTo($(document.body)),ui.$menu=$('<div class="hud-menu">').appendTo($(document.body)),ui.$menuCenter=$('<div class="hud-menu-center">').appendTo(ui.$menu),$('<div class="nx-hspace-flex">').appendTo(ui.$menu),ui.$menuRight=$('<div class="hud-menu-right">').appendTo($(document.body)),ui.$headerContainer=$('<div class="header">').appendTo($(document.body)),ui.navigation=new Vt,ui.$header=$('<div class="header-body">').appendTo(ui.$headerContainer),$('<div class="header-admin-placeholder">').appendTo(ui.$header),ui.$adminContainer=$('<div class="header-admin-container">').appendTo($(document.body)),new Ba(ui.$adminContainer),database.adminEnabled&&database.isAdmin()&&new Pi(ui.$adminContainer),gr(),ui.rightVisible=!1,Qr(),database.on("admin",void 0,al),ui.undoManager=new It,window.performUndo=function(e){ui.undoManager&&ui.undoManager.performUndo(e,(function(){}))},window.performRedo=function(e){ui.undoManager&&ui.undoManager.performUndo(e,(function(){}))},ui.recordNavigation=new Wt,ui.sideEditor=new Vo,ui.saveSchemaDialog=$('<div class="admin-saveschema">').hide().appendTo($(document.body)),$('<div class="nx-button-text red admin-saveschema-button" style="margin-right: 2px;">').append($('<div class="i-24-16 i-red i-close admin-saveschema-icon">')).append($("<span>").text(locale.resetSchema)).appendTo(ui.saveSchemaDialog).touch((function(){$.loading(!0),database.resetSchema((function(){Object(l.f)("Database","RevertChanges"),$.loading(!1),ui.saveSchemaDialog.hide()}))})),$('<div class="nx-button-text blue --ul-save-schema-button admin-saveschema-button">').append($('<div class="i-24-16 i-white i-check admin-saveschema-icon">')).append($("<span>").text(locale.saveSchema)).appendTo(ui.saveSchemaDialog).touch((function(){$.loading(!0),ui.trigger("saveSchema"),database.saveSchema((function(){Object(l.f)("Database","SaveChanges"),$.loading(!1),ui.saveSchemaDialog.hide()}))})),database.on("schema",void 0,nl),k.isEmpty(database.schema.types)&&database.adminEnabled&&database.setAdminMode(!0),wr(),ui.navigation.initialResize(),window.addEventListener("resize",pr),ui.views={},ui.views.home=new jn,ui.views.calendar=new Gn,ui.views.search=new Zn,ui.views.table=new er,oa(),window.Appcues&&window.Appcues.page();const i=Tt();i.moduleId&&jr(rr(i)),Object(c.c)(database.schema.afterOpen)}function ol(e){ui.navigation&&ui.navigation.setCloudSyncState(e)}function nl(e,t,i){!0===t?ui.saveSchemaDialog.show():!1===t&&ui.saveSchemaDialog.hide()}function al(){Zr()}function sl(){$.dialog({closable:!0,caption:locale.dropDatabase,message:locale.confirmDropDatabase,buttons:[{color:"red",caption:locale.dropDatabase,callback:function(){var e=database.descriptor();Yr((function(){root.removeDatabase(e,(function(e){e&&alert(e),vt({teamId:Tt().teamId}),window.location.reload()}))}))}}]})}function rl(e){database.saveEverything((function(){var t=database.descriptor();root.saveDatabaseArchiveAs(t,e)}))}function ll(){database.saveEverything((function(){var e=database.descriptor();root.duplicateDatabase(e,(function(e,t){!e&&t&&(gt(ir({},Tt(),{dbId:t.id})),window.location.reload())}))}))}function cl(){database.saveEverything((function(){var e=database.descriptor();root.renameDatabase(e,(function(e,t){!e&&t&&(vt(ir({},Tt(),{dbId:t.id})),window.location.reload())}))}))}function dl(){database.saveEverything((function(){var e=database.descriptor();Yr((function(){root.evictDatabase(e,(function(e){window.location.reload()}))}))}))}function hl(){database.saveEverything((function(){var e=database.descriptor();Yr((function(){root.reorganizeDatabase(e,(function(e,t){!e&&t?(gt(ir({},Tt(),{dbId:t.id})),window.location.reload()):window.location.reload()}))}))}))}function pl(){ui.isInitialized?database.saveEverything((function(){root.createDatabase()})):root.createDatabase()}function ul(){ui.isInitialized?database.saveEverything((function(){root.importArchive()})):root.importArchive()}function fl(e,t,i,o){i.base;this.parent=e,this.field=i,this.filter=o,this.silent=!1,this.el=$('<div style="margin:-8px">').appendTo(t),this.fromModel=new util.SimpleModel(new schemas.TTime(void 0,void 0,{caption:locale.fromDate,formWidth:.5})),this.fromModel.on("update",this.filtersChanged,this),this.fromField=new qt.a(void 0,this.fromModel,this.el),this.toModel=new util.SimpleModel(new schemas.TTime(void 0,void 0,{caption:locale.toDate,formWidth:.5})),this.toModel.on("update",this.filtersChanged,this),this.toField=new qt.a(void 0,this.toModel,this.el),this.updateUI()}function ml(e,t,i,o){this.parent=e,this.value=o,this.field=i,this.el=$('<div class="stringeditor">').appendTo(t).touch($.proxy(this.popup,this)),this.text=$('<div class="input-text">').appendTo(this.el),$('<div class="choice-dropdown">').appendTo(this.el),this.updateUI()}function gl(e,t,i,o,n){this.table=e,this.fid=t,this.nid=i,this.c=o,this.r=n,this.isEditing=!1,this.$input=void 0,this.val=void 0,this.str=void 0,this.stringMultiline=!1}function vl(e,t,i,o,n){tables.editors.string.apply(this,arguments),this.$aux=void 0,this.orderedValues=[],this.visibleValues=[],this.selectedValueId=void 0,this.filterString="",this.currentString="",this.nid=i}function yl(e,t){for(var i=0;i<e.length;i++){if(e[i].id===t)return i}return-1}function bl(e,t,i,o){this.parent=e,this.field=i,this.filter=o,t.addClass("editor-choice"),this.el=$('<div class="stringeditor">').appendTo(t).touch($.proxy(this.popup,this)),this.text=$('<div class="input-text multicombo">').appendTo(this.el),$('<div class="choice-dropdown">').appendTo(this.el),this.updateUI()}function wl(e,t){return"multi"===e.base||"dmulti"===e.base?xl(e,t):Tl(e,t)}function xl(e,t){var i={},o=/^\s*\>\s*\[\s*((?:[0-9]+(?:\s*\,\s*[0-9]+)*)?)\s*\]$/.exec(t);if(o)for(var n=o[1].split(","),a=0;a<n.length;a++)i[parseInt(n[a].trim())]=!0;return i}function Tl(e,t){var i={};if(t)for(var o=t.split(" or "),n=0;n<o.length;n++){var a=/=\s*(?:([0-9]+|true|false|null)|\"([a-zA-Z0-9\.\_\-]+)\")/.exec(o[n]);a&&(i[null!=a[1]?a[1]:a[2]]=!0)}return i}function Cl(e,t){return"multi"===e.base||"dmulti"===e.base?kl(e,t):$l(e,t)}function kl(e,t){var i=">[",o=0;for(var n in t)t.hasOwnProperty(n)&&t[n]&&(i+=(o>0?",":"")+n,o++);return i+="]",o>0?i:""}function $l(e,t){var i="";for(var o in t)t.hasOwnProperty(o)&&t[o]&&(i+=(i?" or ":"")+"="+Sl(o));return i}function Sl(e){return/^[0-9]+|true|false|null$/.test(e)?String(e):'"'+String(e)+'"'}function _l(e,t,i,o){var n=this,a=i.base;this.parent=e,this.field=i,this.filter=o,this.silent=!1,this.el=$('<div style="margin:-8px">').appendTo(t);var s=$('<div class="switch">').appendTo(this.el);this.$switchRange=$('<div class="switch-item selected">').text(locale.filter).appendTo(s).touch((function(){"range"!==util.getFilterDateRange(n.filter).mode&&n.updateModel("")})),this.$switchEmpty=$('<div class="switch-item">').text(locale.empty).appendTo(s).touch((function(){"empty"!==util.getFilterDateRange(n.filter).mode?n.updateModel("=null"):n.updateModel(null)})),this.$switchNotEmpty=$('<div class="switch-item">').text(locale.notEmpty).appendTo(s).touch((function(){"not-empty"!==util.getFilterDateRange(n.filter).mode?n.updateModel("!=null"):n.updateModel(null)})),this.$range=$("<div>").appendTo(this.el),this.fromModel="date"===a?new util.SimpleModel(new schemas.TDate(void 0,void 0,{caption:locale.fromDate,formWidth:.5})):"datx"===a?new util.SimpleModel(new schemas.TDatx(void 0,void 0,{caption:locale.fromDate,formWidth:.5})):new util.SimpleModel(new schemas.TTimestamp(void 0,void 0,{caption:locale.fromDate,formWidth:.5})),this.fromModel.on("update",this.filtersChanged,this),this.fromField=new qt.a(void 0,this.fromModel,this.$range),this.toModel="date"===a?new util.SimpleModel(new schemas.TDate(void 0,void 0,{caption:locale.toDate,formWidth:.5})):"datx"===a?new util.SimpleModel(new schemas.TDatx(void 0,void 0,{caption:locale.toDate,formWidth:.5})):new util.SimpleModel(new schemas.TTimestamp(void 0,void 0,{caption:locale.toDate,formWidth:.5})),this.toModel.on("update",this.filtersChanged,this),this.toField=new qt.a(void 0,this.toModel,this.$range),this.updateUI()}function El(e,t,i,o){this.parent=e,this.parentEl=t,this.value=o,this.el=$('<div class="stringeditor">').appendTo(t),this.input=$('<input type="text" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">').attr("placeholder",locale.filter).appendTo(this.el).val(this.value||"").change($.proxy(this.updateModel,this)),this.button=$('<div class="stringeditor-button"><div class="icon-big-black icon-big-close2"></div></div>').appendTo(this.el).touch($.proxy(this.clear,this)),this.updateUI()}function Dl(e,t,i,o,n){tables.editors.string.apply(this,arguments),this.$aux=void 0,this.orderedValues=[],this.visibleValues=[],this.selectedValues=[],this.filterString="",this.currentString="",this.nid=i,this.$backplane=null}function Nl(e,t){for(var i=0;i<e.length;i++){if(e[i].id===t)return i}return-1}function Il(){const e={};return e.editors={choice:vl,dchoice:vl,multi:Dl,dmulti:Dl,string:gl},e.createFilterEditor=Ml,e.createCellEditor=Ol,e.aggTypeToSymbol=Fl,e}function Ol(e,t,i,o,n){var a=e.type.fields[t];return new(tables.editors[a.base]||tables.editors.string)(e,t,i,o,n)}function Ml(e,t,i,o){switch(i.base){case"boolean":return new ml(e,t,i,o);case"user":case"choice":case"multi":case"dchoice":case"dmulti":return new bl(e,t,i,o);case"date":case"datx":case"timestamp":case"appointment":return new _l(e,t,i,o);case"time":return new fl(e,t,i,o);case"number":case"string":default:return new El(e,t,i,o)}}function Fl(e,t){var i={sum:"Σ",first:"⤒",last:"⤓",avg:"Ø",cnt:"#",min:"⬇",max:"⬆"}[e];return(i?'<span class="table-summary-agg">'+i+"</span> ":"")+"<span>"+htmlEscape(t)+"</span>"}fl.prototype.destroy=function(){this.fromField.destroy(),this.toField.destroy(),this.el.remove(),this.menu.remove()},fl.prototype.updateModel=function(e){this.filter=e,this.updateUI(),this.parent.updateFilter(!1)},fl.prototype.filtersChanged=function(){if(!this.silent){this.field.base;var e=this.fromModel.value,t=this.toModel.value;if(null!=e&&null!=t&&t<e){var i=e;e=t,t=i}this.updateModel(util.getTimeRangeFilter({from:e,to:t}))}},fl.prototype.updateUI=function(){this.field.base;var e=this.filter,t=util.getFilterTimeRange(e)||{},i=t.from,o=t.to;this.silent=!0,this.fromModel.setValue(i),this.toModel.setValue(o),this.silent=!1},fl.prototype.setFilter=function(e){this.filter=e,this.updateUI()},fl.prototype.getFilter=function(){return this.filter},fl.prototype.show=function(){this.el.show()},fl.prototype.hide=function(){this.el.hide()},ml.prototype.destroy=function(){this.el.remove()},ml.prototype.updateModel=function(e){this.value=e,this.updateUI(),this.parent.updateFilter(!0)},ml.prototype.updateUI=function(){var e=this.value,t="";t=e?/^\s*\=\s*null\s*$/.test(e)?"<span>"+htmlEscape(locale.empty)+"</span>":/^\s*\!\=\s*null\s*$/.test(e)?"<span>"+htmlEscape(locale.notEmpty)+"</span>":/^\s*\=\s*true\s*$/.test(e)?"<span>"+htmlEscape(locale.yes)+"</span>":/^\s*\=\s*false\s*$/.test(e)?"<span>"+htmlEscape(locale.no)+"</span>":'<span color="#f00">'+htmlEscape(e)+"</span>":'<span style="color:#999">'+htmlEscape(locale.filter)+"</span>",this.text.html(t)},ml.prototype.setFilter=function(e){this.value=e,this.updateUI()},ml.prototype.show=function(){this.el.show()},ml.prototype.hide=function(){this.el.hide()},ml.prototype.getFilter=function(){return this.value},ml.prototype.popup=function(){var e=this,t=this.value,i=$.backplane({}),o=$('<div class="choice-menu">').css({"min-width":this.el.width()}).appendTo(i),n=$('<div class="choice-menu-head">').appendTo(o);$('<div class="choice-menu-item"><div class="choice-label">'+locale.all+"</div></div>").click((function(){e.updateModel(void 0),i.close()})).appendTo(n),$('<div class="choice-menu-item"><div class="choice-label">'+locale.empty+"</div></div>").touch((function(){i.close(),e.updateModel("=null")})).appendTo(n),$('<div class="choice-menu-item"><div class="choice-label">'+locale.notEmpty+"</div></div>").touch((function(){i.close(),e.updateModel("!=null")})).appendTo(n),$('<div class="choice-menu-item"><div class="choice-indicator'+("=true"===t?" selected":"")+'"></div><div class="choice-symbol"></div><div class="choice-label">'+locale.yes+"</div></div>").click((function(){e.updateModel("=true"),i.close()})).appendTo(o),$('<div class="choice-menu-item"><div class="choice-indicator'+("=false"===t?" selected":"")+'"></div><div class="choice-symbol"></div><div class="choice-label">'+locale.no+"</div></div>").click((function(){e.updateModel("=false"),i.close()})).appendTo(o);var a=o.outerWidth(),s=o.outerHeight(),r=this.el.offset();r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),o.offset(r)},gl.prototype.showAux=function(){},gl.prototype.hideAux=function(){},gl.prototype.updateAux=function(){},gl.prototype.keyupCallback=function(){},gl.prototype.keydownCallback=function(){},gl.prototype.destroy=function(){this.stopEdit(!1)},gl.prototype.getNid=function(){return this.nid},gl.prototype.isCell=function(e,t){return this.c===e&&this.r===t},gl.prototype.getRow=function(){return this.r},gl.prototype.getColumn=function(){return this.c},gl.prototype.keydown=function(e){if(!1!==this.keydownCallback(e)){var t=this.table,i=this.stringMultiline;switch(e.which){case 9:e.shiftKey?(t.stopEdit(!0),t.editorPrev()):(t.stopEdit(!0),t.editorNext()),e.preventDefault();break;case 13:i||(e.shiftKey?t.editorInsert("down"):(t.stopEdit(!0),t.editorDown()),e.preventDefault());break;case 27:t.stopEdit(!1),e.preventDefault()}}},gl.prototype.keyup=function(e){this.keyupCallback(e)},gl.prototype.blur=function(e){this.isEditing&&this.table.stopEdit()},gl.prototype.startEdit=function(){if(!this.isEditing&&this.isWritable()){var e=this.table,t=this.nid,i=this.fid,o=e.type.fields[i];if(o){var n=database.loadNodeSync(t);n&&(this.val=n[i],this.str=o.formatEditor(this.val),this.isEditing=!0,o.stringMultiline?(this.$input=$EL("textarea","t-editor-textarea",e.$view),this.stringMultiline=!0):(o.base,this.$input=$EL("input","t-editor-input",e.$view,{type:"text",autocomplete:"off",autocorrect:"off",spellcheck:"false"}),this.stringMultiline=!1),this.$input.addEventListener("keydown",$.proxy(this.keydown,this),!1),this.$input.addEventListener("keyup",$.proxy(this.keyup,this),!1),this.$input.addEventListener("blur",$.proxy(this.blur,this),!1),this.update(),this.$input.value=this.str,this.$input.focus(),this.$input.select(),this.showAux())}}},gl.prototype.isWritable=function(){return database.canWriteNodeField(this.nid,this.fid)},gl.prototype.stopEdit=function(e){if(this.isEditing){this.isEditing=!1,this.hideAux();var t=this.$input;this.$input=void 0;var i=t.value;if($REMOVE(t),e&&i!==this.str){var o=this.table,n=(this.nid,this.fid),a=o.type.fields[n];if(!a)return;var s=a.parseEditor(i);this.str=i,this.val=s,this.saveValue(s,(function(e){e&&$.alert(e)}))}}},gl.prototype.saveValue=function(e,t){database.update(this.nid,this.fid,e,t)},gl.prototype.update=function(){if(this.isEditing){var e=this.c,t=this.r,i=this.table,o=this.$input;o.style.left=i.colX(e,e)-1+"px",o.style.top=i.rowY(t,t)+"px",o.style.width=i.colW(e,e)+2+"px",o.style.height=i.rowH(t,t)+"px",this.updateAux()}},Object.assign(vl.prototype,gl.prototype),vl.prototype.showAux=function(){if(!this.$aux){var e=this,t=this.table.type.fields[this.fid];t.loadValuesSorted(this.getNid(),e=>{this.selectedValueId=null==this.val?"###NULL###":this.val,this.orderedValues=e,this.filterString="",this.currentString=this.$input.value||"",this.visibleValues=[],this.$aux=$('<div class="choice-menu" style="min-width:'+this.$input.clientWidth+'px;overflow:auto;z-index:12">').appendTo($(document.body)).on(TOUCH?EVENT_touchstart:"mousedown",(function(e){var o=$(e.target).closest(".choice-menu-item").attr("data-id");null!=o&&i("###NULL###"===o?null:t.convert(o))})),this.updateAux()})}function i(t){e.saveValue(t,(function(t){e.table.stopEdit(!1)}))}},vl.prototype.hideAux=function(){this.$aux&&(this.$aux.remove(),this.$aux=null,this.orderedValues=[],this.visibleValues=[],this.selectedValueId=void 0)},vl.prototype.updateAux=function(){var e=this,t=this.$aux,i=this.table.type.fields[this.fid];if(t){var o=0,n="",a=this.filterString,s=!a,r=this.selectedValueId,l=this.visibleValues=[];if(!i.required&&s)l.push({id:"###NULL###",caption:""}),n+=`<div class="choice-menu-item" data-id="###NULL###">\n                <div class="choice-indicator${"###NULL###"===r?" selected":""}"></div>\n                <div class="choice-label">${htmlEscape(locale.empty)}</div>\n            </div>`,o++;k.each(this.orderedValues,(function(e){if(s||0===(e.caption||"").toLocaleLowerCase().indexOf(a)){l.push(e);var t=e.id===r;n+='<div data-id="'+e.id+'" class="choice-menu-item" style="'+(e.color?"background-color:"+e.color+";color:"+e.textColor:"")+'"><div class="choice-indicator'+(t?" selected":"")+'"></div><div class="multicombo-item" style="background-color:transparent;color:'+e.textColor+'">'+(e.icon?'<div class="choice-symbol ic ic-'+e.icon+'"></div>':"")+"<span>"+htmlEscape(e.caption||"")+"</span></div></div>",o++}})),t.html(n),c()}function c(){var i=$(e.$input).offset(),n=window.getWidth(),a=window.getHeight(),s=i.left,r=i.top+36,l=t.outerWidth(),c=32*o;c>a-r&&(a-r>=i.top-4?c=a-r:(c=Math.min(i.top-4,c),r=i.top-4-c)),s+l>n&&(s=n-l),t.css({left:s,top:r,height:c});var d=t.children(".selected");if(d.length){var h=d.offset().top,p=h+32;h<r?t.scrollTop(t.scrollTop()+h-r):p>r+c&&t.scrollTop(t.scrollTop()+p-r-c)}}},vl.prototype.keyupCallback=function(e){switch(e.which){case 38:case 40:return e.preventDefault(),e.stopPropagation(),this.updateAux(),!1;default:var t=this.$input.value||"";return t!==this.currentString&&(this.filterString=t.toLocaleLowerCase(),this.currentString=t,this.updateAux()),!0}},vl.prototype.keydownCallback=function(e){switch(e.which){case 38:if((i=this.visibleValues)&&i.length){if(-1===(o=yl(i,this.selectedValueId))){var t=i[i.length-1];this.selectedValueId=t.id,this.$input.value=t.caption}else if(o>0){t=i[o-1];this.selectedValueId=t.id,this.$input.value=t.caption}}else this.selectedValueId=void 0;return this.updateAux(),e.preventDefault(),e.stopPropagation(),!1;case 40:var i,o;if((i=this.visibleValues)&&i.length){if(-1===(o=yl(i,this.selectedValueId))){t=i[0];this.selectedValueId=t.id,this.$input.value=t.caption}else if(o<i.length-1){t=i[o+1];this.selectedValueId=t.id,this.$input.value=t.caption}}else this.selectedValueId=void 0;return this.updateAux(),e.preventDefault(),e.stopPropagation(),!1}},bl.prototype.destroy=function(){this.el.remove()},bl.prototype.updateModel=function(e,t){this.filter=e,this.updateUI(),this.parent.updateFilter(t)},bl.prototype.updateUI=function(){const e=this.field;null==this.filter?this.text.html('<span style="color:#999">'+htmlEscape(locale.filter)+"</span>"):/^\s*\=\s*null\s*$/.test(this.filter)?this.text.html('<div class="multicombo-item"><span>'+htmlEscape(locale.empty)+"</span></div>"):/^\s*\!\=\s*null\s*$/.test(this.filter)?this.text.html('<div class="multicombo-item"><span>'+htmlEscape(locale.notEmpty)+"</span></div>"):e.loadValuesSorted(void 0,e=>{const t=wl(this.field,this.filter);let i="";for(var o=0;o<e.length;o++){var n=e[o];t[n.id]&&(i+='<div class="multicombo-item" style="'+(n.color?"background-color:"+n.color+";color:"+n.textColor:"")+'" data-id="'+n.id+'">'+(n.icon?'<div class="choice-symbol ic ic-'+n.icon+'"></div>':"")+"<span>"+htmlEscape(n.caption||"")+"</span></div>")}this.text.html(i)})},bl.prototype.setFilter=function(e){this.filter=e,this.updateUI()},bl.prototype.getFilter=function(){return this.filter},bl.prototype.show=function(){this.el.show()},bl.prototype.hide=function(){this.el.hide()},bl.prototype.popup=function(){var e=this,t=this.field,i={"=null":1,"!=null":1}[this.filter]?{}:wl(t,this.filter),o=$.backplane({}),n=$('<div class="choice-menu" style="min-width:'+this.el.width()+"px;max-height:"+(window.getHeight()-64)+'px;overflow:auto">').appendTo(o).touch(c);l();var a=n.outerWidth(),s=n.outerHeight(),r=this.el.offset();function l(){t.loadValuesSorted(void 0,e=>{var t='<div class="choice-menu-head">';t+='<div data-id="#all" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.all)+"</div></div>",t+='<div data-id="#empty" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.empty)+"</div></div>",t+='<div data-id="#full" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.notEmpty)+"</div></div>",t+="</div>",e.forEach(e=>{t+='<div data-id="'+e.id+'" class="choice-menu-item"><div class="choice-indicator'+(i[e.id]?" selected":"")+'"></div><div class="multicombo-item" style="'+(e.color?"background-color:"+e.color+";color:"+e.textColor:"")+'" data-id="'+e.id+'">'+(e.icon?'<div class="choice-symbol ic ic-'+e.icon+'"></div>':"")+"<span>"+htmlEscape(e.caption||"")+"</span></div></div>"}),n.html(t)})}function c(e){var t=$(e.target).closest(".choice-menu-item").attr("data-id");t&&("#all"===t?(i={},h(void 0,!0)):"#empty"===t?(i={},h("=null",!0)):"#full"===t?(i={},h("!=null",!0)):h(d(t),!1))}function d(e){return i[e]=!i[e],l(),Cl(t,i)}function h(t,i){i&&o.close(),e.updateModel(t,!1)}r.top+=32,r.left+a>window.getWidth()&&(r.left=window.getWidth()-a),r.top+s>window.getHeight()&&(r.top=window.getHeight()-s),n.offset(r)},_l.prototype.destroy=function(){this.fromField.destroy(),this.toField.destroy(),this.el.remove()},_l.prototype.updateModel=function(e){this.filter=e,this.updateUI(),this.parent.updateFilter(!1)},_l.prototype.filtersChanged=function(){if(!this.silent){var e=this.field.base,t=this.fromModel.value,i=this.toModel.value;if(null!=t&&null!=i&&i<t){var o=t;t=i,i=o}if("date"===e){if(null!=t){var n=new Date(t);t=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()}if(null!=i){var a=new Date(i);i=new Date(a.getFullYear(),a.getMonth(),a.getDate()+1).getTime()}}else if("datx"===e){if(null!=t){n=new Date(t);t=Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate())}if(null!=i){a=new Date(i);i=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()+1)}}this.updateModel(util.getDateRangeFilter({from:t,to:i}))}},_l.prototype.updateUI=function(){var e=this.field.base,t=this.filter,i=util.getFilterDateRange(t),o=i.from,n=i.to;if("date"===e){if(null!=o){var a=new Date(o);o=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime()}if(null!=n){var s=new Date(n);n=new Date(s.getFullYear(),s.getMonth(),s.getDate()-1).getTime()}}else if("datx"===e){if(null!=o){a=new Date(o);o=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())}if(null!=n){s=new Date(n);n=Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()-1)}}this.silent=!0,this.fromModel.setValue(o),this.toModel.setValue(n),this.silent=!1;var r="empty"!==i.mode&&"not-empty"!==i.mode;this.$range.css("display",r?"":"none"),this.$switchRange.toggleClass("selected",r),this.$switchEmpty.toggleClass("selected","empty"===i.mode),this.$switchNotEmpty.toggleClass("selected","not-empty"===i.mode)},_l.prototype.setFilter=function(e){this.filter=e,this.updateUI()},_l.prototype.getFilter=function(){return this.filter},_l.prototype.show=function(){this.el.show()},_l.prototype.hide=function(){this.el.hide()},El.prototype.updateModel=function(){try{var e=(this.input.val()||"").trim();0===e.length?this.value=void 0:(queries.parseFilter(e),this.parentEl.removeClass("error"),this.value=e)}catch(e){log(e),this.parentEl.addClass("error"),this.value=void 0}this.updateUI(),this.parent.updateFilter(!0)},El.prototype.getFilter=function(){return this.value},El.prototype.setFilter=function(e){this.value=e,this.input.val(e||""),this.updateUI()},El.prototype.destroy=function(){this.el.remove()},El.prototype.show=function(){this.el.show()},El.prototype.hide=function(){this.el.hide()},El.prototype.updateUI=function(){this.button.css("display",this.value?"":"none")},El.prototype.clear=function(){this.input.val(""),this.updateModel()},Object.assign(Dl.prototype,gl.prototype),Dl.prototype.showAux=function(){if(!this.$aux){this.$backplane=$.backplane({close:()=>{this.$backplane=null}});var e=this;this.table.type.fields[this.fid].loadValuesSorted(this.getNid(),t=>{function i(i){var o=util.multiDecode(e.selectedValues[0]),n=$(i.target).closest(".choice-menu-item").attr("data-id");if(n){if("#all"===n){o=[];for(var a=0;a<t.length;a++)o.push(t[a].id)}else if("#none"===n)o=[];else{var s=parseInt(n),r=o.indexOf(s);-1===r?o.push(s):o.splice(r,1)}e.selectedValues[0]=util.multiEncode(o),e.saveValue(e.selectedValues[0]||null,(function(){e.updateAux()}))}}this.$backplane&&(this.selectedValues.push(null==this.val?"":this.val),this.orderedValues=t,this.filterString="",this.currentString=this.$input.value||"",this.visibleValues=[],this.$aux=$(`<div class="choice-menu" style="min-width:${this.$input.clientWidth}px;overflow:auto;z-index:12">`).appendTo(this.$backplane).touch(i),this.updateAux())})}},Dl.prototype.updateAux=function(){var e=this,t=this.$aux;if(t){var i=0,o="",n=this.filterString,a=!n,s=this.selectedValues,r=this.visibleValues=[];o+=`<div class="choice-menu-head">\n            <div data-id="#all" class="choice-menu-item">\n                <div class="choice-label">${htmlEscape(locale.all)}</div>\n            </div>\n            <div data-id="#none" class="choice-menu-item">\n                <div class="choice-label">${htmlEscape(locale.none)}</div>\n            </div>\n        </div>`,i++,k.each(this.orderedValues,(function(e){if(a||0===(e.caption||"").toLocaleLowerCase().indexOf(n)){r.push(e);var t=util.multiDecode(s[0]),l=k.first(k.filter(t,t=>t==e.id));o+=`<div data-id="${e.id}" class="choice-menu-item">\n                    <div class="choice-indicator${l?" selected":""}"></div>\n                    <div class="multicombo-item" style="${e.color?"background-color:"+e.color+";color:"+e.textColor:""}" data-id="${e.id}">\n                        ${e.icon?`<div class="choice-symbol ic ic-${e.icon}"></div>`:""}\n                        <span>${htmlEscape(e.caption||"")}</span>\n                    </div>\n                </div>`,i++}})),t.html(o);try{l()}catch(e){}}function l(){var o=$(e.$input).offset(),n=window.getWidth(),a=window.getHeight(),s=o.left,r=o.top+36,l=t.outerWidth(),c=32*i;c>a-r&&(a-r>=o.top-4?c=a-r:(c=Math.min(o.top-4,c),r=o.top-4-c)),s+l>n&&(s=n-l),t.css({left:s,top:r,height:c});var d=t.children(".selected");if(d.length){var h=d.offset().top,p=h+32;h<r?t.scrollTop(t.scrollTop()+h-r):p>r+c&&t.scrollTop(t.scrollTop()+p-r-c)}}},Dl.prototype.keyupCallback=function(e){switch(e.which){case 38:case 40:return e.preventDefault(),e.stopPropagation(),this.updateAux(),!1;default:var t=this.$input.value||"";return t!==this.currentString&&(this.filterString=t.toLocaleLowerCase(),this.currentString=t,this.updateAux()),!0}},Dl.prototype.keydownCallback=function(e){switch(e.which){case 38:if((i=this.visibleValues)&&i.length){if(-1===(o=Nl(i,this.selectedValueId))){var t=i[i.length-1];this.selectedValueId=t.id,this.$input.value=t.caption}else if(o>0){t=i[o-1];this.selectedValueId=t.id,this.$input.value=t.caption}}else this.selectedValueId=void 0;return this.updateAux(),e.preventDefault(),e.stopPropagation(),!1;case 40:var i,o;if((i=this.visibleValues)&&i.length){if(-1===(o=Nl(i,this.selectedValueId))){t=i[0];this.selectedValueId=t.id,this.$input.value=t.caption}else if(o<i.length-1){t=i[o+1];this.selectedValueId=t.id,this.$input.value=t.caption}}else this.selectedValues=void 0;return this.updateAux(),e.preventDefault(),e.stopPropagation(),!1}},window.dbms=new Se,window.dbms.RemoteConnection=T,window.dbms.SessionInfo=h,window.dbms.MessageService=S,window.dbms.AccountRemote=I,window.dbms.HTTPServer=E,window.dbms.RemoteDB=N.a,Ye($),Xe(),window.ui=sr(),window.widgets=Object(bo.a)(),window.tables=Il(),window.Chart.defaults.global.animation.duration=0,window.printer=Ie(),window.reports=qe(),Dt(),window.ninox_init()},"./src/init_lib.js":function(e,t,i){"use strict";i.r(t);i("./node_modules/core-js/stable/index.js"),i("./node_modules/regenerator-runtime/runtime.js"),i("./node_modules/script-loader/index.js!./node_modules/jquery/dist/jquery.min.js"),i("./node_modules/core-js/modules/es.string.replace.js");!function(e,t){var i,o,n=0,a=/^ui-id-\d+$/;function s(t,i){var o,n,a,s=t.nodeName.toLowerCase();return"area"===s?(n=(o=t.parentNode).name,!(!t.href||!n||"map"!==o.nodeName.toLowerCase())&&(!!(a=e("img[usemap=#"+n+"]")[0])&&r(a))):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s&&t.href||i)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter((function(){return"hidden"===e.css(this,"visibility")})).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:(i=e.fn.focus,function(t,o){return"number"==typeof t?this.each((function(){var i=this;setTimeout((function(){e(i).focus(),o&&o.call(i)}),t)})):i.apply(this,arguments)}),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter((function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))})).eq(0):this.parents().filter((function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))})).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var o,n,a=e(this[0]);a.length&&a[0]!==document;){if(("absolute"===(o=a.css("position"))||"relative"===o||"fixed"===o)&&(n=parseInt(a.css("zIndex"),10),!isNaN(n)&&0!==n))return n;a=a.parent()}return 0},uniqueId:function(){return this.each((function(){this.id||(this.id="ui-id-"+ ++n)}))},removeUniqueId:function(){return this.each((function(){a.test(this.id)&&e(this).removeAttr("id")}))}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo((function(t){return function(i){return!!e.data(i,t)}})):function(t,i,o){return!!e.data(t,o[3])},focusable:function(t){return s(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),o=isNaN(i);return(o||i>=0)&&s(t,!o)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],(function(i,o){var n="Width"===o?["Left","Right"]:["Top","Bottom"],a=o.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};function r(t,i,o,a){return e.each(n,(function(){i-=parseFloat(e.css(t,"padding"+this))||0,o&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)})),i}e.fn["inner"+o]=function(i){return i===t?s["inner"+o].call(this):this.each((function(){e(this).css(a,r(this,i)+"px")}))},e.fn["outer"+o]=function(t,i){return"number"!=typeof t?s["outer"+o].call(this,t):this.each((function(){e(this).css(a,r(this,t,!0,i)+"px")}))}})),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=(o=e.fn.removeData,function(t){return arguments.length?o.call(this,e.camelCase(t)):o.call(this)})),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",(function(e){e.preventDefault()}))},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,o){var n,a=e.ui[t].prototype;for(n in o)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,o[n]])},call:function(e,t,i){var o,n=e.plugins[t];if(n&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(o=0;o<n.length;o++)e.options[n[o][0]]&&n[o][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var o=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[o]>0||(t[o]=1,n=t[o]>0,t[o]=0,n)}})}(jQuery),function(e,t){var i=0,o=Array.prototype.slice,n=e.cleanData;e.cleanData=function(t){for(var i,o=0;null!=(i=t[o]);o++)try{e(i).triggerHandler("remove")}catch(e){}n(t)},e.widget=function(t,i,o){var n,a,s,r,l={},c=t.split(".")[0];t=t.split(".")[1],n=c+"-"+t,o||(o=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[c]=e[c]||{},a=e[c][t],s=e[c][t]=function(e,t){if(!this._createWidget)return new s(e,t);arguments.length&&this._createWidget(e,t)},e.extend(s,a,{version:o.version,_proto:e.extend({},o),_childConstructors:[]}),(r=new i).options=e.widget.extend({},r.options),e.each(o,(function(t,o){var n,a;e.isFunction(o)?l[t]=(n=function(){return i.prototype[t].apply(this,arguments)},a=function(e){return i.prototype[t].apply(this,e)},function(){var e,t=this._super,i=this._superApply;return this._super=n,this._superApply=a,e=o.apply(this,arguments),this._super=t,this._superApply=i,e}):l[t]=o})),s.prototype=e.widget.extend(r,{widgetEventPrefix:a&&r.widgetEventPrefix||t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,(function(t,i){var o=i.prototype;e.widget(o.namespace+"."+o.widgetName,s,i._proto)})),delete a._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var n,a,s=o.call(arguments,1),r=0,l=s.length;r<l;r++)for(n in s[r])a=s[r][n],s[r].hasOwnProperty(n)&&a!==t&&(e.isPlainObject(a)?i[n]=e.isPlainObject(i[n])?e.widget.extend({},i[n],a):e.widget.extend({},a):i[n]=a);return i},e.widget.bridge=function(i,n){var a=n.prototype.widgetFullName||i;e.fn[i]=function(s){var r="string"==typeof s,l=o.call(arguments,1),c=this;return s=!r&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,r?this.each((function(){var o,n=e.data(this,a);return n?e.isFunction(n[s])&&"_"!==s.charAt(0)?(o=n[s].apply(n,l))!==n&&o!==t?(c=o&&o.jquery?c.pushStack(o.get()):o,!1):void 0:e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+s+"'")})):this.each((function(){var t=e.data(this,a);t?t.option(s||{})._init():e.data(this,a,new n(s,this))})),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,o){o=e(o||this.defaultElement||this)[0],this.element=e(o),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),o!==this&&(e.data(o,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===o&&this.destroy()}}),this.document=e(o.style?o.ownerDocument:o.document||o),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,o){var n,a,s,r=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(r={},n=i.split("."),i=n.shift(),n.length){for(a=r[i]=e.widget.extend({},this.options[i]),s=0;s<n.length-1;s++)a[n[s]]=a[n[s]]||{},a=a[n[s]];if(i=n.pop(),1===arguments.length)return a[i]===t?null:a[i];a[i]=o}else{if(1===arguments.length)return this.options[i]===t?null:this.options[i];r[i]=o}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,o){var n,a=this;"boolean"!=typeof t&&(o=i,i=t,t=!1),o?(i=n=e(i),this.bindings=this.bindings.add(i)):(o=i,i=this.element,n=this.widget()),e.each(o,(function(o,s){function r(){if(t||!0!==a.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof s?a[s]:s).apply(a,arguments)}"string"!=typeof s&&(r.guid=s.guid=s.guid||r.guid||e.guid++);var l=o.match(/^(\w+)\s*(.*)$/),c=l[1]+a.eventNamespace,d=l[2];d?n.delegate(d,c,r):i.bind(c,r)}))},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?o[e]:e).apply(o,arguments)}var o=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,o){var n,a,s=this.options[t];if(o=o||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,o),!(e.isFunction(s)&&!1===s.apply(this.element[0],[i].concat(o))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},(function(t,i){e.Widget.prototype["_"+t]=function(o,n,a){"string"==typeof n&&(n={effect:n});var s,r=n?!0===n||"number"==typeof n?i:n.effect||i:t;"number"==typeof(n=n||{})&&(n={duration:n}),s=!e.isEmptyObject(n),n.complete=a,n.delay&&o.delay(n.delay),s&&e.effects&&e.effects.effect[r]?o[t](n):r!==t&&o[r]?o[r](n.duration,n.easing,a):o.queue((function(i){e(this)[t](),a&&a.call(o[0]),i()}))}}))}(jQuery),function(e,t){var i=!1;e(document).mouseup((function(){i=!1})),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,(function(e){return t._mouseDown(e)})).bind("click."+this.widgetName,(function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1})),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!i){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var o=this,n=1===t.which,a=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(n&&!a&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){o.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return o._mouseMove(e)},this._mouseUpDelegate=function(e){return o._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),i=!0,!0))}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){e.ui=e.ui||{};var i,o=Math.max,n=Math.abs,a=Math.round,s=/left|center|right/,r=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,d=/%$/,h=e.fn.position;function p(e,t,i){return[parseFloat(e[0])*(d.test(e[0])?t/100:1),parseFloat(e[1])*(d.test(e[1])?i/100:1)]}function u(t,i){return parseInt(e.css(t,i),10)||0}function f(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.position={scrollbarWidth:function(){if(i!==t)return i;var o,n,a=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=a.children()[0];return e("body").append(a),o=s.offsetWidth,a.css("overflow","scroll"),o===(n=s.offsetWidth)&&(n=a[0].clientWidth),a.remove(),i=o-n},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),o=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth;return{width:"scroll"===o||"auto"===o&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),o=e.isWindow(i[0]);return{element:i,isWindow:o,isDocument:!!i[0]&&9===i[0].nodeType,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:o?i.width():i.outerWidth(),height:o?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return h.apply(this,arguments);t=e.extend({},t);var i,d,m,g,v,y,b=e(t.of),w=e.position.getWithinInfo(t.within),x=e.position.getScrollInfo(w),T=(t.collision||"flip").split(" "),C={};return y=f(b),b[0].preventDefault&&(t.at="left top"),d=y.width,m=y.height,g=y.offset,v=e.extend({},g),e.each(["my","at"],(function(){var e,i,o=(t[this]||"").split(" ");1===o.length&&(o=s.test(o[0])?o.concat(["center"]):r.test(o[0])?["center"].concat(o):["center","center"]),o[0]=s.test(o[0])?o[0]:"center",o[1]=r.test(o[1])?o[1]:"center",e=l.exec(o[0]),i=l.exec(o[1]),C[this]=[e?e[0]:0,i?i[0]:0],t[this]=[c.exec(o[0])[0],c.exec(o[1])[0]]})),1===T.length&&(T[1]=T[0]),"right"===t.at[0]?v.left+=d:"center"===t.at[0]&&(v.left+=d/2),"bottom"===t.at[1]?v.top+=m:"center"===t.at[1]&&(v.top+=m/2),i=p(C.at,d,m),v.left+=i[0],v.top+=i[1],this.each((function(){var s,r,l=e(this),c=l.outerWidth(),h=l.outerHeight(),f=u(this,"marginLeft"),y=u(this,"marginTop"),k=c+f+u(this,"marginRight")+x.width,$=h+y+u(this,"marginBottom")+x.height,S=e.extend({},v),_=p(C.my,l.outerWidth(),l.outerHeight());"right"===t.my[0]?S.left-=c:"center"===t.my[0]&&(S.left-=c/2),"bottom"===t.my[1]?S.top-=h:"center"===t.my[1]&&(S.top-=h/2),S.left+=_[0],S.top+=_[1],e.support.offsetFractions||(S.left=a(S.left),S.top=a(S.top)),s={marginLeft:f,marginTop:y},e.each(["left","top"],(function(o,n){e.ui.position[T[o]]&&e.ui.position[T[o]][n](S,{targetWidth:d,targetHeight:m,elemWidth:c,elemHeight:h,collisionPosition:s,collisionWidth:k,collisionHeight:$,offset:[i[0]+_[0],i[1]+_[1]],my:t.my,at:t.at,within:w,elem:l})})),t.using&&(r=function(e){var i=g.left-S.left,a=i+d-c,s=g.top-S.top,r=s+m-h,p={target:{element:b,left:g.left,top:g.top,width:d,height:m},element:{element:l,left:S.left,top:S.top,width:c,height:h},horizontal:a<0?"left":i>0?"right":"center",vertical:r<0?"top":s>0?"bottom":"middle"};d<c&&n(i+a)<d&&(p.horizontal="center"),m<h&&n(s+r)<m&&(p.vertical="middle"),o(n(i),n(a))>o(n(s),n(r))?p.important="horizontal":p.important="vertical",t.using.call(this,e,p)}),l.offset(e.extend(S,{using:r}))}))},e.ui.position={fit:{left:function(e,t){var i,n=t.within,a=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,r=e.left-t.collisionPosition.marginLeft,l=a-r,c=r+t.collisionWidth-s-a;t.collisionWidth>s?l>0&&c<=0?(i=e.left+l+t.collisionWidth-s-a,e.left+=l-i):e.left=c>0&&l<=0?a:l>c?a+s-t.collisionWidth:a:l>0?e.left+=l:c>0?e.left-=c:e.left=o(e.left-r,e.left)},top:function(e,t){var i,n=t.within,a=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,r=e.top-t.collisionPosition.marginTop,l=a-r,c=r+t.collisionHeight-s-a;t.collisionHeight>s?l>0&&c<=0?(i=e.top+l+t.collisionHeight-s-a,e.top+=l-i):e.top=c>0&&l<=0?a:l>c?a+s-t.collisionHeight:a:l>0?e.top+=l:c>0?e.top-=c:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,o,a=t.within,s=a.offset.left+a.scrollLeft,r=a.width,l=a.isWindow?a.scrollLeft:a.offset.left,c=e.left-t.collisionPosition.marginLeft,d=c-l,h=c+t.collisionWidth-r-l,p="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,u="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];d<0?((i=e.left+p+u+f+t.collisionWidth-r-s)<0||i<n(d))&&(e.left+=p+u+f):h>0&&((o=e.left-t.collisionPosition.marginLeft+p+u+f-l)>0||n(o)<h)&&(e.left+=p+u+f)},top:function(e,t){var i,o,a=t.within,s=a.offset.top+a.scrollTop,r=a.height,l=a.isWindow?a.scrollTop:a.offset.top,c=e.top-t.collisionPosition.marginTop,d=c-l,h=c+t.collisionHeight-r-l,p="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,u="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,f=-2*t.offset[1];d<0?(o=e.top+p+u+f+t.collisionHeight-r-s,e.top+p+u+f>d&&(o<0||o<n(d))&&(e.top+=p+u+f)):h>0&&(i=e.top-t.collisionPosition.marginTop+p+u+f-l,e.top+p+u+f>h&&(i>0||n(i)<h)&&(e.top+=p+u+f))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,o,n,a,s=document.getElementsByTagName("body")[0],r=document.createElement("div");for(a in t=document.createElement(s?"div":"body"),o={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(o,{position:"absolute",left:"-1000px",top:"-1000px"}),o)t.style[a]=o[a];t.appendChild(r),(i=s||document.documentElement).insertBefore(t,i.firstChild),r.style.cssText="position: absolute; left: 10.7432222px;",n=e(r).offset().left,e.support.offsetFractions=n>10&&n<11,t.innerHTML="",i.removeChild(t)}()}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(e(!0===i.iframeFix?"iframe":i.iframeFix).each((function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")})),!0))},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var o=this._uiHash();if(!1===this._trigger("drag",t,o))return this._mouseUp({}),!1;this.position=o.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,o=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(o=e.ui.ddmanager.drop(this,t)),this.dropped&&(o=this.dropped,this.dropped=!1),!("original"===this.options.helper&&!e.contains(this.element[0].ownerDocument,this.element[0]))&&("invalid"===this.options.revert&&!o||"valid"===this.options.revert&&o||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,o)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),(function(){!1!==i._trigger("stop",t)&&i._clear()})):!1!==this._trigger("stop",t)&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each((function(){this.parentNode.removeChild(this)})),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(t){var i=this.options,o=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return o.parents("body").length||o.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),o[0]===this.element[0]||/(fixed|absolute)/.test(o.css("position"))||o.css("position","absolute"),o},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,o,n=this.options;n.containment?"window"!==n.containment?"document"!==n.containment?n.containment.constructor!==Array?("parent"===n.containment&&(n.containment=this.helper[0].parentNode),(o=(i=e(n.containment))[0])&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(o.scrollWidth,o.offsetWidth):o.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(o.scrollHeight,o.offsetHeight):o.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i)):this.containment=n.containment:this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(t,i){i||(i=this.position);var o="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:n.scrollTop(),left:n.scrollLeft()}),{top:i.top+this.offset.relative.top*o+this.offset.parent.top*o-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*o,left:i.left+this.offset.relative.left*o+this.offset.parent.left*o-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*o}},_generatePosition:function(t){var i,o,n,a,s=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,c=t.pageY;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(o=this.relative_container.offset(),i=[this.containment[0]+o.left,this.containment[1]+o.top,this.containment[2]+o.left,this.containment[3]+o.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),s.grid&&(n=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-s.grid[1]:n+s.grid[1]:n,a=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-s.grid[0]:a+s.grid[0]:a)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,o){return o=o||this._uiHash(),e.ui.plugin.call(this,t,[i,o]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,o)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var o=e(this).data("ui-draggable"),n=o.options,a=e.extend({},i,{item:o.element});o.sortables=[],e(n.connectToSortable).each((function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(o.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,a))}))},stop:function(t,i){var o=e(this).data("ui-draggable"),n=e.extend({},i,{item:o.element});e.each(o.sortables,(function(){this.instance.isOver?(this.instance.isOver=0,o.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===o.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,n))}))},drag:function(t,i){var o=e(this).data("ui-draggable"),n=this;e.each(o.sortables,(function(){var a=!1,s=this;this.instance.positionAbs=o.positionAbs,this.instance.helperProportions=o.helperProportions,this.instance.offset.click=o.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(a=!0,e.each(o.sortables,(function(){return this.instance.positionAbs=o.positionAbs,this.instance.helperProportions=o.helperProportions,this.instance.offset.click=o.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(s.instance.element[0],this.instance.element[0])&&(a=!1),a}))),a?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=o.offset.click.top,this.instance.offset.click.left=o.offset.click.left,this.instance.offset.parent.left-=o.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=o.offset.parent.top-this.instance.offset.parent.top,o._trigger("toSortable",t),o.dropped=this.instance.element,o.currentItem=o.element,this.instance.fromOutside=o),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),o._trigger("fromSortable",t),o.dropped=!1)}))}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var o=e(i.helper),n=e(this).data("ui-draggable").options;o.css("opacity")&&(n._opacity=o.css("opacity")),o.css("opacity",n.opacity)},stop:function(t,i){var o=e(this).data("ui-draggable").options;o._opacity&&e(i.helper).css("opacity",o._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),o=i.options,n=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(o.axis&&"x"===o.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(t.pageY-e(document).scrollTop()<o.scrollSensitivity?n=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(n=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(t.pageX-e(document).scrollLeft()<o.scrollSensitivity?n=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(n=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed)))),!1!==n&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each((function(){var i=e(this),o=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:o.top,left:o.left})}))},drag:function(t,i){var o,n,a,s,r,l,c,d,h,p,u=e(this).data("ui-draggable"),f=u.options,m=f.snapTolerance,g=i.offset.left,v=g+u.helperProportions.width,y=i.offset.top,b=y+u.helperProportions.height;for(h=u.snapElements.length-1;h>=0;h--)l=(r=u.snapElements[h].left)+u.snapElements[h].width,d=(c=u.snapElements[h].top)+u.snapElements[h].height,v<r-m||g>l+m||b<c-m||y>d+m||!e.contains(u.snapElements[h].item.ownerDocument,u.snapElements[h].item)?(u.snapElements[h].snapping&&u.options.snap.release&&u.options.snap.release.call(u.element,t,e.extend(u._uiHash(),{snapItem:u.snapElements[h].item})),u.snapElements[h].snapping=!1):("inner"!==f.snapMode&&(o=Math.abs(c-b)<=m,n=Math.abs(d-y)<=m,a=Math.abs(r-v)<=m,s=Math.abs(l-g)<=m,o&&(i.position.top=u._convertPositionTo("relative",{top:c-u.helperProportions.height,left:0}).top-u.margins.top),n&&(i.position.top=u._convertPositionTo("relative",{top:d,left:0}).top-u.margins.top),a&&(i.position.left=u._convertPositionTo("relative",{top:0,left:r-u.helperProportions.width}).left-u.margins.left),s&&(i.position.left=u._convertPositionTo("relative",{top:0,left:l}).left-u.margins.left)),p=o||n||a||s,"outer"!==f.snapMode&&(o=Math.abs(c-y)<=m,n=Math.abs(d-b)<=m,a=Math.abs(r-g)<=m,s=Math.abs(l-v)<=m,o&&(i.position.top=u._convertPositionTo("relative",{top:c,left:0}).top-u.margins.top),n&&(i.position.top=u._convertPositionTo("relative",{top:d-u.helperProportions.height,left:0}).top-u.margins.top),a&&(i.position.left=u._convertPositionTo("relative",{top:0,left:r}).left-u.margins.left),s&&(i.position.left=u._convertPositionTo("relative",{top:0,left:l-u.helperProportions.width}).left-u.margins.left)),!u.snapElements[h].snapping&&(o||n||a||s||p)&&u.options.snap.snap&&u.options.snap.snap.call(u.element,t,e.extend(u._uiHash(),{snapItem:u.snapElements[h].item})),u.snapElements[h].snapping=o||n||a||s||p)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,o=e.makeArray(e(i.stack)).sort((function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)}));o.length&&(t=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each((function(i){e(this).css("zIndex",t+i)})),this.css("zIndex",t+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var o=e(i.helper),n=e(this).data("ui-draggable").options;o.css("zIndex")&&(n._zIndex=o.css("zIndex")),o.css("zIndex",n.zIndex)},stop:function(t,i){var o=e(this).data("ui-draggable").options;o._zIndex&&e(i.helper).css("zIndex",o._zIndex)}})}(jQuery),function(e,t){function i(e,t,i){return e>t&&e<t+i}e.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,o=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(o)?o:function(e){return e.is(o)},this.proportions=function(){if(!arguments.length)return t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});t=arguments[0]},e.ui.ddmanager.droppables[i.scope]=e.ui.ddmanager.droppables[i.scope]||[],e.ui.ddmanager.droppables[i.scope].push(this),i.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,i=e.ui.ddmanager.droppables[this.options.scope];t<i.length;t++)i[t]===this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"===t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var o=i||e.ui.ddmanager.current,n=!1;return!(!o||(o.currentItem||o.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each((function(){var t=e.data(this,"ui-droppable");if(t.options.greedy&&!t.options.disabled&&t.options.scope===o.options.scope&&t.accept.call(t.element[0],o.currentItem||o.element)&&e.ui.intersect(o,e.extend(t,{offset:t.element.offset()}),t.options.tolerance))return n=!0,!1})),!n&&(!!this.accept.call(this.element[0],o.currentItem||o.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(o)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,t,o){if(!t.offset)return!1;var n,a=(e.positionAbs||e.position.absolute).left,s=(e.positionAbs||e.position.absolute).top,r=a+e.helperProportions.width,l=s+e.helperProportions.height,c=t.offset.left,d=t.offset.top,h=c+t.proportions().width,p=d+t.proportions().height;switch(o){case"fit":return c<=a&&r<=h&&d<=s&&l<=p;case"intersect":return c<a+e.helperProportions.width/2&&r-e.helperProportions.width/2<h&&d<s+e.helperProportions.height/2&&l-e.helperProportions.height/2<p;case"pointer":return n=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,i((e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,d,t.proportions().height)&&i(n,c,t.proportions().width);case"touch":return(s>=d&&s<=p||l>=d&&l<=p||s<d&&l>p)&&(a>=c&&a<=h||r>=c&&r<=h||a<c&&r>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var o,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(o=0;o<a.length;o++)if(!(a[o].options.disabled||t&&!a[o].accept.call(a[o].element[0],t.currentItem||t.element))){for(n=0;n<r.length;n++)if(r[n]===a[o].element[0]){a[o].proportions().height=0;continue e}a[o].visible="none"!==a[o].element.css("display"),a[o].visible&&("mousedown"===s&&a[o]._activate.call(a[o],i),a[o].offset=a[o].element.offset(),a[o].proportions({width:a[o].element[0].offsetWidth,height:a[o].element[0].offsetHeight}))}},drop:function(t,i){var o=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),(function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(o=this._drop.call(this,i)||o),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))})),o},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",(function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}))},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],(function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var o,n,a,s=e.ui.intersect(t,this,this.options.tolerance),r=!s&&this.isover?"isout":s&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,(a=this.element.parents(":data(ui-droppable)").filter((function(){return e.data(this,"ui-droppable").options.scope===n}))).length&&((o=e.data(a[0],"ui-droppable")).greedyChild="isover"===r)),o&&"isover"===r&&(o.isover=!1,o.isout=!0,o._out.call(o,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),o&&"isout"===r&&(o.isout=!1,o.isover=!0,o._over.call(o,i)))}}))},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e,t){function i(e){return parseInt(e,10)||0}function o(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,i,o,n,a=this,s=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!s.aspectRatio,aspectRatio:s.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:s.helper||s.ghost||s.animate?s.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=s.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)o=e.trim(t[i]),(n=e("<div class='ui-resizable-handle "+("ui-resizable-"+o)+"'></div>")).css({zIndex:s.zIndex}),"se"===o&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[o]=".ui-resizable-"+o,this.element.append(n);this._renderAxis=function(t){var i,o,n,a;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(o=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?o.outerHeight():o.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,a),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover((function(){a.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=n&&n[1]?n[1]:"se")})),s.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter((function(){s.disabled||(e(this).removeClass("ui-resizable-autohide"),a._handles.show())})).mouseleave((function(){s.disabled||a.resizing||(e(this).addClass("ui-resizable-autohide"),a._handles.hide())}))),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,o,n=!1;for(i in this.handles)((o=e(this.handles[i])[0])===t.target||e.contains(o,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var o,n,a,s=this.options,r=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:r.top,left:r.left}),this._renderProxy(),o=i(this.helper.css("left")),n=i(this.helper.css("top")),s.containment&&(o+=e(s.containment).scrollLeft()||0,n+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:o,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:o,top:n},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,a=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===a?this.axis+"-resize":a),l.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,o=this.helper,n={},a=this.originalMousePosition,s=this.axis,r=this.position.top,l=this.position.left,c=this.size.width,d=this.size.height,h=t.pageX-a.left||0,p=t.pageY-a.top||0,u=this._change[s];return!!u&&(i=u.apply(this,[t,h,p]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),this.position.top!==r&&(n.top=this.position.top+"px"),this.position.left!==l&&(n.left=this.position.left+"px"),this.size.width!==c&&(n.width=this.size.width+"px"),this.size.height!==d&&(n.height=this.size.height+"px"),o.css(n),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(n)||this._trigger("resize",t,this.ui()),!1)},_mouseStop:function(t){this.resizing=!1;var i,o,n,a,s,r,l,c=this.options,d=this;return this._helper&&(n=(o=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&e.ui.hasScroll(i[0],"left")?0:d.sizeDiff.height,a=o?0:d.sizeDiff.width,s={width:d.helper.width()-a,height:d.helper.height()-n},r=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null,c.animate||this.element.css(e.extend(s,{top:l,left:r})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,i,n,a,s,r=this.options;s={minWidth:o(r.minWidth)?r.minWidth:0,maxWidth:o(r.maxWidth)?r.maxWidth:1/0,minHeight:o(r.minHeight)?r.minHeight:0,maxHeight:o(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,n=s.minWidth/this.aspectRatio,i=s.maxHeight*this.aspectRatio,a=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),n>s.minHeight&&(s.minHeight=n),i<s.maxWidth&&(s.maxWidth=i),a<s.maxHeight&&(s.maxHeight=a)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),o(e.left)&&(this.position.left=e.left),o(e.top)&&(this.position.top=e.top),o(e.height)&&(this.size.height=e.height),o(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,n=this.axis;return o(e.height)?e.width=e.height*this.aspectRatio:o(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===n&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===n&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,n=o(e.width)&&t.maxWidth&&t.maxWidth<e.width,a=o(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=o(e.width)&&t.minWidth&&t.minWidth>e.width,r=o(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,d=/sw|nw|w/.test(i),h=/nw|ne|n/.test(i);return s&&(e.width=t.minWidth),r&&(e.height=t.minHeight),n&&(e.width=t.maxWidth),a&&(e.height=t.maxHeight),s&&d&&(e.left=l-t.minWidth),n&&d&&(e.left=l-t.maxWidth),r&&h&&(e.top=c-t.minHeight),a&&h&&(e.top=c-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,o,n,a=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(n=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],o=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(o[t],10)||0);n.css({height:a.height()-this.borderDif[0]-this.borderDif[2]||0,width:a.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize;return{left:this.originalPosition.left+t,width:i.width-t}},n:function(e,t,i){var o=this.originalSize;return{top:this.originalPosition.top+i,height:o.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,o){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,o]))},sw:function(t,i,o){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,o]))},ne:function(t,i,o){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,o]))},nw:function(t,i,o){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,o]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("ui-resizable"),o=i.options,n=i._proportionallyResizeElements,a=n.length&&/textarea/i.test(n[0].nodeName),s=a&&e.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-s},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,d=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,d&&c?{top:d,left:c}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var o={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:o.width,height:o.height}),i._updateCache(o),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,o,n,a,s,r,l,c=e(this).data("ui-resizable"),d=c.options,h=c.element,p=d.containment,u=p instanceof e?p.get(0):/parent/.test(p)?h.parent().get(0):p;u&&(c.containerElement=e(u),/document/.test(p)||p===document?(c.containerOffset={left:0,top:0},c.containerPosition={left:0,top:0},c.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(u),o=[],e(["Top","Right","Left","Bottom"]).each((function(e,n){o[e]=i(t.css("padding"+n))})),c.containerOffset=t.offset(),c.containerPosition=t.position(),c.containerSize={height:t.innerHeight()-o[3],width:t.innerWidth()-o[1]},n=c.containerOffset,a=c.containerSize.height,s=c.containerSize.width,r=e.ui.hasScroll(u,"left")?u.scrollWidth:s,l=e.ui.hasScroll(u)?u.scrollHeight:a,c.parentData={element:u,left:n.left,top:n.top,width:r,height:l}))},resize:function(t){var i,o,n,a,s=e(this).data("ui-resizable"),r=s.options,l=s.containerOffset,c=s.position,d=s._aspectRatio||t.shiftKey,h={top:0,left:0},p=s.containerElement;p[0]!==document&&/static/.test(p.css("position"))&&(h=l),c.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-h.left),d&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=r.helper?l.left:0),c.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),d&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper,s.offset.left-h.left+s.sizeDiff.width)),o=Math.abs((s._helper?s.offset.top-h.top:s.offset.top-l.top)+s.sizeDiff.height),n=s.containerElement.get(0)===s.element.parent().get(0),a=/relative|absolute/.test(s.containerElement.css("position")),n&&a&&(i-=Math.abs(s.parentData.left)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,d&&(s.size.height=s.size.width/s.aspectRatio)),o+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-o,d&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),i=t.options,o=t.containerOffset,n=t.containerPosition,a=t.containerElement,s=e(t.helper),r=s.offset(),l=s.outerWidth()-t.sizeDiff.width,c=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(a.css("position"))&&e(this).css({left:r.left-n.left-o.left,width:l,height:c}),t._helper&&!i.animate&&/static/.test(a.css("position"))&&e(this).css({left:r.left-n.left-o.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable").options,i=function(t){e(t).each((function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})}))};"object"!=typeof t.alsoResize||t.alsoResize.parentNode?i(t.alsoResize):t.alsoResize.length?(t.alsoResize=t.alsoResize[0],i(t.alsoResize)):e.each(t.alsoResize,(function(e){i(e)}))},resize:function(t,i){var o=e(this).data("ui-resizable"),n=o.options,a=o.originalSize,s=o.originalPosition,r={height:o.size.height-a.height||0,width:o.size.width-a.width||0,top:o.position.top-s.top||0,left:o.position.left-s.left||0},l=function(t,o){e(t).each((function(){var t=e(this),n=e(this).data("ui-resizable-alsoresize"),a={},s=o&&o.length?o:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,(function(e,t){var i=(n[t]||0)+(r[t]||0);i&&i>=0&&(a[t]=i||null)})),t.css(a)}))};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?l(n.alsoResize):e.each(n.alsoResize,(function(e,t){l(e,t)}))},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,o=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:o.height,width:o.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),i=t.options,o=t.size,n=t.originalSize,a=t.originalPosition,s=t.axis,r="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=r[0]||1,c=r[1]||1,d=Math.round((o.width-n.width)/l)*l,h=Math.round((o.height-n.height)/c)*c,p=n.width+d,u=n.height+h,f=i.maxWidth&&i.maxWidth<p,m=i.maxHeight&&i.maxHeight<u,g=i.minWidth&&i.minWidth>p,v=i.minHeight&&i.minHeight>u;i.grid=r,g&&(p+=l),v&&(u+=c),f&&(p-=l),m&&(u-=c),/^(se|s|e)$/.test(s)?(t.size.width=p,t.size.height=u):/^(ne)$/.test(s)?(t.size.width=p,t.size.height=u,t.position.top=a.top-h):/^(sw)$/.test(s)?(t.size.width=p,t.size.height=u,t.position.left=a.left-d):(u-c>0?(t.size.height=u,t.position.top=a.top-h):(t.size.height=c,t.position.top=a.top+n.height-c),p-l>0?(t.size.width=p,t.position.left=a.left-d):(t.size.width=l,t.position.left=a.left+n.width-l))}})}(jQuery),function(e,t){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(t=e(i.options.filter,i.element[0])).addClass("ui-selectee"),t.each((function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})}))},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,o=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(o.filter,this.element[0]),this._trigger("start",t),e(o.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),o.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each((function(){var o=e.data(this,"selectable-item");o.startselected=!0,t.metaKey||t.ctrlKey||(o.$element.removeClass("ui-selected"),o.selected=!1,o.$element.addClass("ui-unselecting"),o.unselecting=!0,i._trigger("unselecting",t,{unselecting:o.element}))})),e(t.target).parents().addBack().each((function(){var o,n=e.data(this,"selectable-item");if(n)return o=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(o?"ui-unselecting":"ui-selected").addClass(o?"ui-selecting":"ui-unselecting"),n.unselecting=!o,n.selecting=o,n.selected=o,o?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1})))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,o=this,n=this.options,a=this.opos[0],s=this.opos[1],r=t.pageX,l=t.pageY;return a>r&&(i=r,r=a,a=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:a,top:s,width:r-a,height:l-s}),this.selectees.each((function(){var i=e.data(this,"selectable-item"),c=!1;i&&i.element!==o.element[0]&&("touch"===n.tolerance?c=!(i.left>r||i.right<a||i.top>l||i.bottom<s):"fit"===n.tolerance&&(c=i.left>a&&i.right<r&&i.top>s&&i.bottom<l),c?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,o._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),o._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,o._trigger("unselecting",t,{unselecting:i.element})))))})),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each((function(){var o=e.data(this,"selectable-item");o.$element.removeClass("ui-unselecting"),o.unselecting=!1,o.startselected=!1,i._trigger("unselected",t,{unselected:o.element})})),e(".ui-selecting",this.element[0]).each((function(){var o=e.data(this,"selectable-item");o.$element.removeClass("ui-selecting").addClass("ui-selected"),o.selecting=!1,o.selected=!0,o.startselected=!0,i._trigger("selected",t,{selected:o.element})})),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e,t){function i(e,t,i){return e>t&&e<t+i}function o(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=!!this.items.length&&("x"===e.axis||o(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var o=null,n=!1,a=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each((function(){if(e.data(this,a.widgetName+"-item")===a)return o=e(this),!1})),e.data(t.target,a.widgetName+"-item")===a&&(o=e(t.target)),!!o&&(!(this.options.handle&&!i&&(e(this.options.handle,o).find("*").addBack().each((function(){this===t.target&&(n=!0)})),!n))&&(this.currentItem=o,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,i,o){var n,a,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(a)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!o)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,o,n,a,s=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-e(document).scrollTop()<s.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed)),t.pageX-e(document).scrollLeft()<s.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed))),!1!==r&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=(o=this.items[i]).item[0],(a=this._intersectsWithPointer(o))&&o.instance===this.currentContainer&&!(n===this.currentItem[0]||this.placeholder[1===a?"next":"prev"]()[0]===n||e.contains(this.placeholder[0],n)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],n))){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(o))break;this._rearrange(t,o),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var o=this,n=this.placeholder.offset(),a=this.options.axis,s={};a&&"x"!==a||(s.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(s.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,(function(){o._clear(t)}))}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),o=[];return t=t||{},e(i).each((function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&o.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))})),!o.length&&t.key&&o.push(t.key+"="),o.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),o=[];return t=t||{},i.each((function(){o.push(e(t.item||this).attr(t.attribute||"id")||"")})),o},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,o=this.positionAbs.top,n=o+this.helperProportions.height,a=e.left,s=a+e.width,r=e.top,l=r+e.height,c=this.offset.click.top,d=this.offset.click.left,h="x"===this.options.axis||o+c>r&&o+c<l,p="y"===this.options.axis||t+d>a&&t+d<s,u=h&&p;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?u:a<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&r<o+this.helperProportions.height/2&&n-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var t="x"===this.options.axis||i(this.positionAbs.top+this.offset.click.top,e.top,e.height),o="y"===this.options.axis||i(this.positionAbs.left+this.offset.click.left,e.left,e.width),n=t&&o,a=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return!!n&&(this.floating?s&&"right"===s||"down"===a?2:1:a&&("down"===a?2:1))},_intersectsWithSides:function(e){var t=i(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),o=i(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return this.floating&&a?"right"===a&&o||"left"===a&&!o:n&&("down"===n&&t||"up"===n&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,o,n,a,s=[],r=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(o=(n=e(l[i])).length-1;o>=0;o--)(a=e.data(n[o],this.widgetFullName))&&a!==this&&!a.options.disabled&&r.push([e.isFunction(a.options.items)?a.options.items.call(a.element):e(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);function c(){s.push(this)}for(r.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=r.length-1;i>=0;i--)r[i][0].each(c);return e(s)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,(function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0}))},_refreshItems:function(t){this.items=[],this.containers=[this];var i,o,n,a,s,r,l,c,d=this.items,h=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],p=this._connectWith();if(p&&this.ready)for(i=p.length-1;i>=0;i--)for(o=(n=e(p[i])).length-1;o>=0;o--)(a=e.data(n[o],this.widgetFullName))&&a!==this&&!a.options.disabled&&(h.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=h.length-1;i>=0;i--)for(s=h[i][1],o=0,c=(r=h[i][0]).length;o<c;o++)(l=e(r[o])).data(this.widgetName+"-item",s),d.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,o,n,a;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(o=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&o.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,o.item):o.item,t||(o.width=n.outerWidth(),o.height=n.outerHeight()),a=n.offset(),o.left=a.left,o.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,o=(t=t||this).options;o.placeholder&&o.placeholder.constructor!==String||(i=o.placeholder,o.placeholder={element:function(){var o=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+o+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===o?t.currentItem.children().each((function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n)})):"img"===o&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){i&&!o.forcePlaceholderSize||(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(o.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),o.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var n,a,s,r,l,c,d,h,p,u,f=null,m=null;for(n=this.containers.length-1;n>=0;n--)if(!e.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(f&&e.contains(this.containers[n].element[0],f.element[0]))continue;f=this.containers[n],m=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",t,this._uiHash(this)),this.containers[n].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",t,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(s=1e4,r=null,l=(u=f.floating||o(this.currentItem))?"left":"top",c=u?"width":"height",d=this.positionAbs[l]+this.offset.click[l],a=this.items.length-1;a>=0;a--)e.contains(this.containers[m].element[0],this.items[a].item[0])&&this.items[a].item[0]!==this.currentItem[0]&&(u&&!i(this.positionAbs.top+this.offset.click.top,this.items[a].top,this.items[a].height)||(h=this.items[a].item.offset()[l],p=!1,Math.abs(h-d)>Math.abs(h+this.items[a][c]-d)&&(p=!0,h+=this.items[a][c]),Math.abs(h-d)<s&&(s=Math.abs(h-d),r=this.items[a],this.direction=p?"up":"down")));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;r?this._rearrange(t,r,null,!0):this._rearrange(t,null,this.containers[m].element,!0),this._trigger("change",t,this._uiHash()),this.containers[m]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",t,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var i=this.options,o=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return o.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(o[0]),o[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),o[0].style.width&&!i.forceHelperSize||o.width(this.currentItem.width()),o[0].style.height&&!i.forceHelperSize||o.height(this.currentItem.height()),o},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,o,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),"document"!==n.containment&&"window"!==n.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),o="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(o?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(o?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var o="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*o+this.offset.parent.top*o-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*o,left:i.left+this.offset.relative.left*o+this.offset.parent.left*o-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*o}},_generatePosition:function(t){var i,o,n=this.options,a=t.pageX,s=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,o=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?o-this.offset.click.left>=this.containment[0]&&o-this.offset.click.left<=this.containment[2]?o:o-this.offset.click.left>=this.containment[0]?o-n.grid[0]:o+n.grid[0]:o)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(e,t,i,o){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay((function(){n===this.counter&&this.refreshPositions(!o)}))},_clear:function(e,t){this.reverting=!1;var i,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();function n(e,t,i){return function(o){i._trigger(e,o,t._uiHash(t))}}for(this.fromOutside&&!t&&o.push((function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))})),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||o.push((function(e){this._trigger("update",e,this._uiHash())})),this!==this.currentContainer&&(t||(o.push((function(e){this._trigger("remove",e,this._uiHash())})),o.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||o.push(n("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(o.push(n("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){var i=0,o={},n={};o.height=o.paddingTop=o.paddingBottom=o.borderTopWidth=o.borderBottomWidth="hide",n.height=n.paddingTop=n.paddingBottom=n.borderTopWidth=n.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.10.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e(),content:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each((function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")})),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each((function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")})),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){"active"!==e?("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t)):this._activate(t)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,o=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%o];break;case i.LEFT:case i.UP:a=this.headers[(n-1+o)%o];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[o-1]}a&&(e(t.target).attr("tabIndex",-1),e(a).attr("tabIndex",0),a.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),!1===t.active&&!0===t.collapsible||!this.headers.length?(t.active=!1,this.active=e()):!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var t,o=this.options,n=o.heightStyle,a=this.element.parent(),s=this.accordionId="ui-accordion-"+(this.element.attr("id")||++i);this.active=this._findActive(o.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each((function(t){var i=e(this),o=i.attr("id"),n=i.next(),a=n.attr("id");o||(o=s+"-header-"+t,i.attr("id",o)),a||(a=s+"-panel-"+t,n.attr("id",a)),i.attr("aria-controls",a),n.attr("aria-labelledby",o)})).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(o.event),"fill"===n?(t=a.height(),this.element.siblings(":visible").each((function(){var i=e(this),o=i.css("position");"absolute"!==o&&"fixed"!==o&&(t-=i.outerHeight(!0))})),this.headers.each((function(){t-=e(this).outerHeight(!0)})),this.headers.next().each((function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))})).css("overflow","auto")):"auto"===n&&(t=0,this.headers.next().each((function(){t=Math.max(t,e(this).css("height","").height())})).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),(function(e,t){i[t]="_eventHandler"})),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,o=this.active,n=e(t.currentTarget),a=n[0]===o[0],s=a&&i.collapsible,r=s?e():n.next(),l=o.next(),c={oldHeader:o,oldPanel:l,newHeader:s?e():n,newPanel:r};t.preventDefault(),a&&!i.collapsible||!1===this._trigger("beforeActivate",t,c)||(i.active=!s&&this.headers.index(n),this.active=a?e():n,this._toggle(c),o.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&o.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,o=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=o,this.options.animate?this._animate(i,o,t):(o.hide(),i.show(),this._toggleComplete(t)),o.attr({"aria-hidden":"true"}),o.prev().attr("aria-selected","false"),i.length&&o.length?o.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter((function(){return 0===e(this).attr("tabIndex")})).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_animate:function(e,t,i){var a,s,r,l=this,c=0,d=e.length&&(!t.length||e.index()<t.index()),h=this.options.animate||{},p=d&&h.down||h,u=function(){l._toggleComplete(i)};return"number"==typeof p&&(r=p),"string"==typeof p&&(s=p),s=s||p.easing||h.easing,r=r||p.duration||h.duration,t.length?e.length?(a=e.show().outerHeight(),t.animate(o,{duration:r,easing:s,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(n,{duration:r,easing:s,complete:u,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?c+=i.now:"content"!==l.options.heightStyle&&(i.now=Math.round(a-t.outerHeight()-c),c=0)}})):t.animate(o,r,s,u):e.animate(n,r,s,u)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(e,t){e.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,o,n=this.element[0].nodeName.toLowerCase(),a="textarea"===n,s="input"===n;this.isMultiLine=!!a||!s&&this.element.prop("isContentEditable"),this.valueMethod=this.element[a||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,o=!0,void(i=!0);t=!1,o=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move("previousPage",n);break;case a.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case a.UP:t=!0,this._keyEvent("previous",n);break;case a.DOWN:t=!0,this._keyEvent("next",n);break;case a.ENTER:case a.NUMPAD_ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&&this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(o){if(t)return t=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||o.preventDefault());if(!i){var n=e.ui.keyCode;switch(o.keyCode){case n.PAGE_UP:this._move("previousPage",o);break;case n.PAGE_DOWN:this._move("nextPage",o);break;case n.UP:this._keyEvent("previous",o);break;case n.DOWN:this._keyEvent("next",o)}}},input:function(e){if(o)return o=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur}));var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay((function(){var t=this;this.document.one("mousedown",(function(o){o.target===t.element[0]||o.target===i||e.contains(i,o.target)||t.close()}))}))},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",(function(){e(t.target).trigger(t.originalEvent)}));var o=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:o})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(o.value):this.liveRegion.text(o.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),o=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=o,this._delay((function(){this.previous=o,this.selectedItem=i}))),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,o=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,o){o(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){o.xhr&&o.xhr.abort(),o.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay((function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))}),this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy((function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")}),this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,(function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)}))},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var o=this;e.each(i,(function(e,i){o._renderItemData(t,i)}))},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){if(this.menu.element.is(":visible"))return this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),void this.menu.blur()):void this.menu[e](t);this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var o=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,(function(e){return o.test(e.label||e.value||e)}))}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e,t){var i,o="ui-button ui-widget ui-state-default ui-corner-all",n="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",a=function(){var t=e(this);setTimeout((function(){t.find(":ui-button").button("refresh")}),1)},s=function(t){var i=t.name,o=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=o?e(o).find("[name='"+i+"']"):e("[name='"+i+"']",t.ownerDocument).filter((function(){return!this.form}))),n};e.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,a),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,n=this.options,r="checkbox"===this.type||"radio"===this.type,l=r?"":"ui-state-active";null===n.label&&(n.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,(function(){n.disabled||this===i&&e(this).addClass("ui-state-active")})).bind("mouseleave"+this.eventNamespace,(function(){n.disabled||e(this).removeClass(l)})).bind("click"+this.eventNamespace,(function(e){n.disabled&&(e.preventDefault(),e.stopImmediatePropagation())})),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),r&&this.element.bind("change"+this.eventNamespace,(function(){t.refresh()})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,(function(){if(n.disabled)return!1})):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,(function(){if(n.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var i=t.element[0];s(i).not(i).map((function(){return e(this).button("widget")[0]})).removeClass("ui-state-active").attr("aria-pressed","false")})):(this.buttonElement.bind("mousedown"+this.eventNamespace,(function(){if(n.disabled)return!1;e(this).addClass("ui-state-active"),i=this,t.document.one("mouseup",(function(){i=null}))})).bind("mouseup"+this.eventNamespace,(function(){if(n.disabled)return!1;e(this).removeClass("ui-state-active")})).bind("keydown"+this.eventNamespace,(function(t){if(n.disabled)return!1;t.keyCode!==e.ui.keyCode.SPACE&&t.keyCode!==e.ui.keyCode.ENTER||e(this).addClass("ui-state-active")})).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,(function(){e(this).removeClass("ui-state-active")})),this.buttonElement.is("a")&&this.buttonElement.keyup((function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()}))),this._setOption("disabled",n.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" ui-state-active "+n).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){if(this._super(e,t),"disabled"===e)return this.element.prop("disabled",!!t),void(t&&this.buttonElement.removeClass("ui-state-focus"));this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?s(this.element[0]).each((function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")})):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var t=this.buttonElement.removeClass(n),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),o=this.options.icons,a=o.primary&&o.secondary,s=[];o.primary||o.secondary?(this.options.text&&s.push("ui-button-text-icon"+(a?"s":o.primary?"-primary":"-secondary")),o.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+o.primary+"'></span>"),o.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+o.secondary+"'></span>"),this.options.text||(s.push(a?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):s.push("ui-button-text-only"),t.addClass(s.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),e.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map((function(){return e(this).button("widget")[0]})).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map((function(){return e(this).button("widget")[0]})).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e,t){e.extend(e.ui,{datepicker:{version:"1.10.4"}});var i,o="datepicker";function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var o="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(o,"mouseout",(function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")})).delegate(o,"mouseover",(function(){e.datepicker._isDisabledDatepicker(i.inline?t.parent()[0]:i.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}))}function s(t,i){for(var o in e.extend(t,i),i)null==i[o]&&(t[o]=i[o]);return t}e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return s(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var o,n,a;n="div"===(o=t.nodeName.toLowerCase())||"span"===o,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(a=this._newInst(e(t),n)).settings=e.extend({},i||{}),"input"===o?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a)},_newInst:function(t,i){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var n=e(t);i.append=e([]),i.trigger=e([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,o,i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var o,n,a,s=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=e("<span class='"+this._appendClass+"'>"+s+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),"focus"!==(o=this._get(i,"showOn"))&&"both"!==o||t.focus(this._showDatepicker),"button"!==o&&"both"!==o||(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click((function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1})))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,o,n,a=new Date(2009,11,20),s=this._get(e,"dateFormat");s.match(/[DM]/)&&(t=function(e){for(i=0,o=0,n=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,o=n);return o},a.setMonth(t(this._get(e,s.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var n=e(t);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),e.data(t,o,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,n,a,r){var l,c,d,h,p,u=this._dialogInst;return u||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),(u=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],o,u)),s(u.settings,a||{}),i=i&&i.constructor===Date?this._formatDate(u,i):i,this._dialogInput.val(i),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,p=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[c/2-100+h,d/2-150+p]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),u.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],o,u),this},_destroyDatepicker:function(t){var i,n=e(t),a=e.data(t,o);n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,o),"input"===i?(a.append.remove(),a.trigger.remove(),n.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):"div"!==i&&"span"!==i||n.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,n,a=e(t),s=e.data(t,o);a.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,s.trigger.filter("button").each((function(){this.disabled=!1})).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||((n=a.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})))},_disableDatepicker:function(t){var i,n,a=e(t),s=e.data(t,o);a.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,s.trigger.filter("button").each((function(){this.disabled=!0})).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||((n=a.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,o)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,o,n){var a,r,l,c,d=this._getInst(i);if(2===arguments.length&&"string"==typeof o)return"defaults"===o?e.extend({},e.datepicker._defaults):d?"all"===o?e.extend({},d.settings):this._get(d,o):null;a=o||{},"string"==typeof o&&((a={})[o]=n),d&&(this._curInst===d&&this._hideDatepicker(),r=this._getDateDatepicker(i,!0),l=this._getMinMaxDate(d,"min"),c=this._getMinMaxDate(d,"max"),s(d.settings,a),null!==l&&a.dateFormat!==t&&a.minDate===t&&(d.settings.minDate=this._formatDate(d,l)),null!==c&&a.dateFormat!==t&&a.maxDate===t&&(d.settings.maxDate=this._formatDate(d,c)),"disabled"in a&&(a.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(e(i),d),this._autoSize(d),this._setDate(d,r),this._updateAlternate(d),this._updateDatepicker(d))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,o,n,a=e.datepicker._getInst(t.target),s=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),s=!1;break;case 13:return(n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv))[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),(i=e.datepicker._get(a,"onSelect"))?(o=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[o,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),s=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),s=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),s=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),s=t.ctrlKey||t.metaKey;break;default:s=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):s=!1;s&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,o,n=e.datepicker._getInst(t.target);if(e.datepicker._get(n,"constrainInput"))return i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),o=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||o<" "||!i||i.indexOf(o)>-1},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(t){var i,o,n,a,r,l,c;("input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t)||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(n=(o=e.datepicker._get(i,"beforeShow"))?o.apply(t,[t,i]):{})&&(s(i.settings,n),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),a=!1,e(t).parents().each((function(){return!(a|="fixed"===e(this).css("position"))})),r={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),r=e.datepicker._checkOffset(i,r,a),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":a?"fixed":"absolute",display:"none",left:r.left+"px",top:r.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),c=e.datepicker._get(i,"duration"),i.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),c):i.dpDiv[l||"show"](l?c:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,i=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var o,n=this._getNumberOfMonths(t),a=n[1],s=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),a>1&&t.dpDiv.addClass("ui-datepicker-multi-"+a).css("width",s*a+"em"),t.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(o=t.yearshtml,setTimeout((function(){o===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),o=t.yearshtml=null}),0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,o){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),s=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(o?0:e(document).scrollLeft()),c=document.documentElement.clientHeight+(o?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-s:0,i.left-=o&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=o&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+a>c&&c>a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,o=this._getInst(t),n=this._get(o,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,n,a,s,r=this._curInst;!r||t&&r!==e.data(t,o)||this._datepickerShowing&&(i=this._get(r,"showAnim"),n=this._get(r,"duration"),a=function(){e.datepicker._tidyDialog(r)},e.effects&&(e.effects.effect[i]||e.effects[i])?r.dpDiv.hide(i,e.datepicker._get(r,"showOptions"),n,a):r.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,a),i||a(),this._datepickerShowing=!1,(s=this._get(r,"onClose"))&&s.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),o=e.datepicker._getInst(i[0]);(i[0].id===e.datepicker._mainDivId||0!==i.parents("#"+e.datepicker._mainDivId).length||i.hasClass(e.datepicker.markerClassName)||i.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!i.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===o)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,o){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===o?this._get(a,"showCurrentAtPos"):0),o),this._updateDatepicker(a))},_gotoToday:function(t){var i,o=e(t),n=this._getInst(o[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(o)},_selectMonthYear:function(t,i,o){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===o?"Month":"Year")]=a["draw"+("M"===o?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,o,n){var a,s=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||((a=this._getInst(s[0])).selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=o,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var o,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),(o=this._get(a,"onSelect"))?o.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,o,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),o=this._getDate(t),n=this.formatDate(i,o,this._getFormatConfig(t)),e(a).each((function(){e(this).val(n)})))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,o){if(null==t||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?i.toString():i+""))return null;var n,a,s,r,l=0,c=(o?o.shortYearCutoff:null)||this._defaults.shortYearCutoff,d="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),h=(o?o.dayNamesShort:null)||this._defaults.dayNamesShort,p=(o?o.dayNames:null)||this._defaults.dayNames,u=(o?o.monthNamesShort:null)||this._defaults.monthNamesShort,f=(o?o.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,w=function(e){var i=n+1<t.length&&t.charAt(n+1)===e;return i&&n++,i},x=function(e){var t=w(e),o=new RegExp("^\\d{1,"+("@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2)+"}"),n=i.substring(l).match(o);if(!n)throw"Missing number at position "+l;return l+=n[0].length,parseInt(n[0],10)},T=function(t,o,n){var a=-1,s=e.map(w(t)?n:o,(function(e,t){return[[t,e]]})).sort((function(e,t){return-(e[1].length-t[1].length)}));if(e.each(s,(function(e,t){var o=t[1];if(i.substr(l,o.length).toLowerCase()===o.toLowerCase())return a=t[0],l+=o.length,!1})),-1!==a)return a+1;throw"Unknown name at position "+l},C=function(){if(i.charAt(l)!==t.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;n<t.length;n++)if(b)"'"!==t.charAt(n)||w("'")?C():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":T("D",h,p);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=T("M",u,f);break;case"y":m=x("y");break;case"@":m=(r=new Date(x("@"))).getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":m=(r=new Date((x("!")-this._ticksTo1970)/1e4)).getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":w("'")?C():b=!0;break;default:C()}if(l<i.length&&(s=i.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===m?m=(new Date).getFullYear():m<100&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(m<=d?0:-100)),y>-1)for(g=1,v=y;;){if(v<=(a=this._getDaysInMonth(m,g-1)))break;g++,v-=a}if((r=this._daylightSavingAdjust(new Date(m,g-1,v))).getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var o,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=o+1<e.length&&e.charAt(o+1)===t;return i&&o++,i},c=function(e,t,i){var o=""+t;if(l(e))for(;o.length<i;)o="0"+o;return o},d=function(e,t,i,o){return l(e)?o[t]:i[t]},h="",p=!1;if(t)for(o=0;o<e.length;o++)if(p)"'"!==e.charAt(o)||l("'")?h+=e.charAt(o):p=!1;else switch(e.charAt(o)){case"d":h+=c("d",t.getDate(),2);break;case"D":h+=d("D",t.getDay(),n,a);break;case"o":h+=c("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=c("m",t.getMonth()+1,2);break;case"M":h+=d("M",t.getMonth(),s,r);break;case"y":h+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":h+=t.getTime();break;case"!":h+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?h+="'":p=!0;break;default:h+=e.charAt(o)}return h},_possibleChars:function(e){var t,i="",o=!1,n=function(i){var o=t+1<e.length&&e.charAt(t+1)===i;return o&&t++,o};for(t=0;t<e.length;t++)if(o)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):o=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":o=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,i){return e.settings[i]!==t?e.settings[i]:this._defaults[i]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),o=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,s=this._getFormatConfig(e);try{a=this.parseDate(i,o,s)||n}catch(e){o=t?"":o}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=o?a.getDate():0,e.currentMonth=o?a.getMonth():0,e.currentYear=o?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,o){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(e){}for(var o=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,n=o.getFullYear(),a=o.getMonth(),s=o.getDate(),r=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=r.exec(i);l;){switch(l[2]||"d"){case"d":case"D":s+=parseInt(l[1],10);break;case"w":case"W":s+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),s=Math.min(s,e.datepicker._getDaysInMonth(n,a));break;case"y":case"Y":n+=parseInt(l[1],10),s=Math.min(s,e.datepicker._getDaysInMonth(n,a))}l=r.exec(i)}return new Date(n,a,s)},s=null==i||""===i?o:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?o:n(i):new Date(i.getTime());return(s=s&&"Invalid Date"===s.toString()?o:s)&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var o=!t,n=e.selectedMonth,a=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(o?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),o="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map((function(){var t={prev:function(){e.datepicker._adjustDate(o,-i,"M")},next:function(){e.datepicker._adjustDate(o,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(o)},selectDay:function(){return e.datepicker._selectDay(o,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(o,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(o,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])}))},_generateHTML:function(e){var t,i,o,n,a,s,r,l,c,d,h,p,u,f,m,g,v,y,b,w,x,T,C,k,$,S,_,E,D,N,I,O,M,F,R,L,j,A,P,U=new Date,H=this._daylightSavingAdjust(new Date(U.getFullYear(),U.getMonth(),U.getDate())),z=this._get(e,"isRTL"),V=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),B=this._get(e,"navigationAsDateFormat"),q=this._getNumberOfMonths(e),Y=this._get(e,"showCurrentAtPos"),X=this._get(e,"stepMonths"),G=1!==q[0]||1!==q[1],J=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),K=this._getMinMaxDate(e,"min"),Q=this._getMinMaxDate(e,"max"),Z=e.drawMonth-Y,ee=e.drawYear;if(Z<0&&(Z+=12,ee--),Q)for(t=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-q[0]*q[1]+1,Q.getDate())),t=K&&t<K?K:t;this._daylightSavingAdjust(new Date(ee,Z,1))>t;)--Z<0&&(Z=11,ee--);for(e.drawMonth=Z,e.drawYear=ee,i=this._get(e,"prevText"),i=B?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Z-X,1)),this._getFormatConfig(e)):i,o=this._canAdjustMonth(e,-1,ee,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=B?this.formatDate(n,this._daylightSavingAdjust(new Date(ee,Z+X,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,ee,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(z?"w":"e")+"'>"+n+"</span></a>",s=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?J:H,s=B?this.formatDate(s,r,this._getFormatConfig(e)):s,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",c=V?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(z?l:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(z?"":l)+"</div>":"",d=parseInt(this._get(e,"firstDay"),10),d=isNaN(d)?0:d,h=this._get(e,"showWeek"),p=this._get(e,"dayNames"),u=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),w="",T=0;T<q[0];T++){for(C="",this.maxRows=4,k=0;k<q[1];k++){if($=this._daylightSavingAdjust(new Date(ee,Z,e.selectedDay)),S=" ui-corner-all",_="",G){if(_+="<div class='ui-datepicker-group",q[1]>1)switch(k){case 0:_+=" ui-datepicker-group-first",S=" ui-corner-"+(z?"right":"left");break;case q[1]-1:_+=" ui-datepicker-group-last",S=" ui-corner-"+(z?"left":"right");break;default:_+=" ui-datepicker-group-middle",S=""}_+="'>"}for(_+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===T?z?a:o:"")+(/all|right/.test(S)&&0===T?z?o:a:"")+this._generateMonthYearHeader(e,Z,ee,K,Q,T>0||k>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead><tr>",E=h?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;x<7;x++)E+="<th"+((x+d+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+p[D=(x+d)%7]+"'>"+u[D]+"</span></th>";for(_+=E+"</tr></thead><tbody>",N=this._getDaysInMonth(ee,Z),ee===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,N)),I=(this._getFirstDayOfMonth(ee,Z)-d+7)%7,O=Math.ceil((I+N)/7),M=G&&this.maxRows>O?this.maxRows:O,this.maxRows=M,F=this._daylightSavingAdjust(new Date(ee,Z,1-I)),R=0;R<M;R++){for(_+="<tr>",L=h?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(F)+"</td>":"",x=0;x<7;x++)j=g?g.apply(e.input?e.input[0]:null,[F]):[!0,""],P=(A=F.getMonth()!==Z)&&!y||!j[0]||K&&F<K||Q&&F>Q,L+="<td class='"+((x+d+6)%7>=5?" ui-datepicker-week-end":"")+(A?" ui-datepicker-other-month":"")+(F.getTime()===$.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===F.getTime()&&b.getTime()===$.getTime()?" "+this._dayOverClass:"")+(P?" "+this._unselectableClass+" ui-state-disabled":"")+(A&&!v?"":" "+j[1]+(F.getTime()===J.getTime()?" "+this._currentClass:"")+(F.getTime()===H.getTime()?" ui-datepicker-today":""))+"'"+(A&&!v||!j[2]?"":" title='"+j[2].replace(/'/g,"&#39;")+"'")+(P?"":" data-handler='selectDay' data-event='click' data-month='"+F.getMonth()+"' data-year='"+F.getFullYear()+"'")+">"+(A&&!v?"&#xa0;":P?"<span class='ui-state-default'>"+F.getDate()+"</span>":"<a class='ui-state-default"+(F.getTime()===H.getTime()?" ui-state-highlight":"")+(F.getTime()===J.getTime()?" ui-state-active":"")+(A?" ui-priority-secondary":"")+"' href='#'>"+F.getDate()+"</a>")+"</td>",F.setDate(F.getDate()+1),F=this._daylightSavingAdjust(F);_+=L+"</tr>"}++Z>11&&(Z=0,ee++),C+=_+="</tbody></table>"+(G?"</div>"+(q[0]>0&&k===q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}w+=C}return w+=c,e._keyEvent=!1,w},_generateMonthYearHeader:function(e,t,i,o,n,a,s,r){var l,c,d,h,p,u,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",w="";if(a||!g)w+="<span class='ui-datepicker-month'>"+s[t]+"</span>";else{for(l=o&&o.getFullYear()===i,c=n&&n.getFullYear()===i,w+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",d=0;d<12;d++)(!l||d>=o.getMonth())&&(!c||d<=n.getMonth())&&(w+="<option value='"+d+"'"+(d===t?" selected='selected'":"")+">"+r[d]+"</option>");w+="</select>"}if(y||(b+=w+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(h=this._get(e,"yearRange").split(":"),p=(new Date).getFullYear(),f=(u=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?p+parseInt(e,10):parseInt(e,10);return isNaN(t)?p:t})(h[0]),m=Math.max(f,u(h[1]||"")),f=o?Math.max(f,o.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f<=m;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+w),b+="</div>"},_adjustInstDate:function(e,t,i){var o=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(o,n))+("D"===i?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(o,n,a)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),n=i&&t<i?i:t;return o&&n>o?o:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,o){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,o+(t<0?t:n[0]*n[1]),1));return t<0&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,o,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),s=null,r=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),o=(new Date).getFullYear(),s=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=o),i[1].match(/[+\-].*/)&&(r+=o)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!s||t.getFullYear()>=s)&&(!r||t.getFullYear()<=r)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,o){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(o,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each((function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)})):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.4"}(jQuery),function(e,t){var i={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},o={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;i<0&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,o=this;if(this._isOpen&&!1!==this._trigger("beforeClose",t)){if(this._isOpen=!1,this._destroyOverlay(),!this.opener.filter(":focusable").focus().length)try{(i=this.document[0].activeElement)&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(e){}this._hide(this.uiDialog,this.options.hide,(function(){o._trigger("close",t)}))}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!t&&this._trigger("focus",e),i},open:function(){var t=this;this._isOpen?this._moveToTop()&&this._focusTabbable():(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,(function(){t._focusTabbable(),t._trigger("focus")})),this._trigger("open"))},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement;this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),o=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==o[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(n.focus(1),t.preventDefault()):(o.focus(1),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(i,(function(i,o){var n,a;o=e.isFunction(o)?{click:o,text:i}:o,o=e.extend({type:"button"},o),n=o.click,o.click=function(){n.apply(t.element[0],arguments)},a={icons:o.icons,text:o.showText},delete o.icons,delete o.showText,e("<button></button>",o).button(a).appendTo(t.uiButtonSet)})),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){var t=this,i=this.options;function o(e){return{position:e.position,offset:e.offset}}this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(i,n){e(this).addClass("ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",i,o(n))},drag:function(e,i){t._trigger("drag",e,o(i))},stop:function(n,a){i.position=[a.position.left-t.document.scrollLeft(),a.position.top-t.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",n,o(a))}})},_makeResizable:function(){var t=this,i=this.options,o=i.resizable,n=this.uiDialog.css("position"),a="string"==typeof o?o:"n,e,s,w,se,sw,ne,nw";function s(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:this._minHeight(),handles:a,start:function(i,o){e(this).addClass("ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",i,s(o))},resize:function(e,i){t._trigger("resize",e,s(i))},stop:function(o,n){i.height=e(this).height(),i.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",o,s(n))}}).css("position",n)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var n=this,a=!1,s={};e.each(t,(function(e,t){n._setOption(e,t),e in i&&(a=!0),e in o&&(s[e]=t)})),a&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(e,t){var i,o,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&((i=n.is(":data(ui-draggable)"))&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((o=n.is(":data(ui-resizable)"))&&!t&&n.resizable("destroy"),o&&"string"==typeof t&&n.resizable("option","handles",t),o||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,o=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),o.minWidth>o.width&&(o.width=o.minWidth),e=this.uiDialog.css({height:"auto",width:o.width}).outerHeight(),t=Math.max(0,o.minHeight-e),i="number"==typeof o.maxHeight?Math.max(0,o.maxHeight-e):"none","auto"===o.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,o.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map((function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]}))},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,i=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay((function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",(function(o){t._allowInteraction(o)||(o.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())}))})),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,!1!==e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t,i=this.options.position,o=[],n=[0,0];i?(("string"==typeof i||"object"==typeof i&&"0"in i)&&(1===(o=i.split?i.split(" "):[i[0],i[1]]).length&&(o[1]=o[0]),e.each(["left","top"],(function(e,t){+o[e]===o[e]&&(n[e]=o[e],o[e]=t)})),i={my:o[0]+(n[0]<0?n[0]:"+"+n[0])+" "+o[1]+(n[1]<0?n[1]:"+"+n[1]),at:o.join(" ")}),i=e.extend({},e.ui.dialog.prototype.options.position,i)):i=e.ui.dialog.prototype.options.position,(t=this.uiDialog.is(":visible"))||this.uiDialog.show(),this.uiDialog.position(i),t||this.uiDialog.hide()}})}(jQuery),function(e,t){e.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy((function(e){this.options.disabled&&e.preventDefault()}),this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var i=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(t){this._delay((function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)}))},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each((function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()})),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,o,n,a,s,r=!0;function l(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:r=!1,o=this.previousFilter||"",n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===o?a=!0:n=o+n,s=new RegExp("^"+l(n),"i"),i=this.activeMenu.children(".ui-menu-item").filter((function(){return s.test(e(this).children("a").text())})),(i=a&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(t.keyCode),s=new RegExp("^"+l(n),"i"),i=this.activeMenu.children(".ui-menu-item").filter((function(){return s.test(e(this).children("a").text())}))),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=n,this.filterTimer=this._delay((function(){delete this.previousFilter}),1e3)):delete this.previousFilter):delete this.previousFilter}r&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i=this.options.icons.submenu,o=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),o.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each((function(){var t=e(this),o=t.prev("a"),n=e("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);o.attr("aria-haspopup","true").prepend(n),t.attr("aria-labelledby",o.attr("id"))})),(t=o.add(this.element)).children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each((function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")})),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var i,o;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),o=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",o.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay((function(){this._close()}),this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,o,n,a,s,r;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,o=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-o,a=this.activeMenu.scrollTop(),s=this.activeMenu.height(),r=t.height(),n<0?this.activeMenu.scrollTop(a+n):n+r>s&&this.activeMenu.scrollTop(a+n-s+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay((function(){this._close(),this._open(e)}),this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay((function(){var o=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));o.length||(o=this.element),this._close(o),this.blur(t),this.activeMenu=o}),this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay((function(){this.focus(e,t)})))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var o;this.active&&(o="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),o&&o.length&&this.active||(o=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,o)},nextPage:function(t){var i,o,n;this.active?this.isLastItem()||(this._hasScroll()?(o=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each((function(){return(i=e(this)).offset().top-o-n<0})),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())):this.next(t)},previousPage:function(t){var i,o,n;this.active?this.isFirstItem()||(this._hasScroll()?(o=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each((function(){return(i=e(this)).offset().top-o+n>0})),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())):this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.10.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){if(e===t)return this.options.value;this.options.value=this._constrainedValue(e),this._refreshValue()},_constrainedValue:function(e){return e===t&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})}(jQuery),function(e,t){var i=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,o=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",s=[];for(i=o.values&&o.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;t<i;t++)s.push(a);this.handles=n.add(e(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each((function(t){e(this).data("ui-slider-handle-index",t)}))},_createRange:function(){var t=this.options,i="";t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,o,n,a,s,r,l,c=this,d=this.options;return!d.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},o=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each((function(t){var i=Math.abs(o-c.values(t));(n>i||n===i&&(t===c._lastChangedValue||c.values(t)===d.min))&&(n=i,a=e(this),s=t)})),!1!==this._start(t,s)&&(this._mouseSliding=!0,this._handleIndex=s,a.addClass("ui-state-active").focus(),r=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-r.left-a.width()/2,top:t.pageY-r.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,o),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,o,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(o=i/t)>1&&(o=1),o<0&&(o=0),"vertical"===this.orientation&&(o=1-o),n=this._valueMax()-this._valueMin(),a=this._valueMin()+o*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var o,n,a;this.options.values&&this.options.values.length?(o=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&i>o||1===t&&i<o)&&(i=o),i!==this.values(t)&&((n=this.values())[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),o=this.values(t?0:1),!1!==a&&this.values(t,i))):i!==this.value()&&!1!==(a=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i)},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var o,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(o=this.options.values,n=arguments[0],a=0;a<o.length;a+=1)o[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var o,n=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),o=0;o<n;o+=1)this._change(null,o);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,o;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),o=0;o<i.length;o+=1)i[o]=this._trimAlignValue(i[o]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,o=e-i;return 2*Math.abs(i)>=t&&(o+=i>0?t:-t),parseFloat(o.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,o,n,a,s=this.options.range,r=this.options,l=this,c=!this._animateOff&&r.animate,d={};this.options.values&&this.options.values.length?this.handles.each((function(o){i=(l.values(o)-l._valueMin())/(l._valueMax()-l._valueMin())*100,d["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[c?"animate":"css"](d,r.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===o&&l.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},r.animate),1===o&&l.range[c?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===o&&l.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},r.animate),1===o&&l.range[c?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i})):(o=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?(o-n)/(a-n)*100:0,d["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[c?"animate":"css"](d,r.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},r.animate),"max"===s&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},r.animate),"max"===s&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var o,n,a,s=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),!1===this._start(t,s)))return}switch(a=this.options.step,o=n=this.options.values&&this.options.values.length?this.values(s):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(o+(this._valueMax()-this._valueMin())/i);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(o-(this._valueMax()-this._valueMin())/i);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(o===this._valueMax())return;n=this._trimAlignValue(o+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(o===this._valueMin())return;n=this._trimAlignValue(o-a)}this._slide(t,s,n)},click:function(e){e.preventDefault()},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.widget("ui.spinner",{version:"1.10.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],(function(e,o){var n=i.attr(o);void 0!==n&&n.length&&(t[o]=n)})),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay((function(){this.spinning&&this._stop(e)}),100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){var i;function o(){this.element[0]===this.document[0].activeElement||(this.element.focus(),this.previous=i,this._delay((function(){this.previous=i})))}i=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),o.call(this),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur,o.call(this)})),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,o=e.ui.keyCode;switch(t.keyCode){case o.UP:return this._repeat(null,1,t),!0;case o.DOWN:return this._repeat(null,-1,t),!0;case o.PAGE_UP:return this._repeat(null,i.page,t),!0;case o.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e))&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay((function(){this._repeat(40,t,i)}),e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,o=this.options;return i=e-(t=null!==o.min?o.min:0),e=t+(i=Math.round(i/o.step)*o.step),e=parseFloat(e.toFixed(this._precision())),null!==o.max&&e>o.max?o.max:null!==o.min&&e<o.min?o.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t((function(e){this._super(e),this._value(this.element.val())})),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t((function(e){this._stepUp(e)})),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t((function(e){this._stepDown(e)})),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t((function(e){this._stepUp((e||1)*this.options.page)})),pageDown:t((function(e){this._stepDown((e||1)*this.options.page)})),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){var i=0,o=/#.*$/;function n(){return++i}function a(e){return(e=e.cloneNode(!1)).hash.length>1&&decodeURIComponent(e.href.replace(o,""))===decodeURIComponent(location.href.replace(o,""))}e.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,(function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()})).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,(function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()})),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),(function(e){return t.tabs.index(e)})))).sort()),!1!==this.options.active&&this.anchors.length?this.active=this._findActive(i.active):this.active=e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,o=location.hash.substring(1);return null===t&&(o&&this.tabs.each((function(i,n){if(e(n).attr("aria-controls")===o)return t=i,!1})),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),null!==t&&-1!==t||(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),o=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:o++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,o--;break;case e.ui.keyCode.END:o=this.anchors.length-1;break;case e.ui.keyCode.HOME:o=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(o);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(o!==this.options.active&&o);default:return}t.preventDefault(),clearTimeout(this.activating),o=this._focusNextTab(o,n),t.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(o).attr("aria-selected","true"),this.activating=this._delay((function(){this.option("active",o)}),this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){var o=this.tabs.length-1;function n(){return t>o&&(t=0),t<0&&(t=o),t}for(;-1!==e.inArray(n(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){"active"!==e?"disabled"!==e?(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t)):this._setupDisabled(t):this._activate(t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+n()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),(function(e){return i.index(e)})),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map((function(){return e("a",this)[0]})).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each((function(i,o){var n,s,r,l=e(o).uniqueId().attr("id"),c=e(o).closest("li"),d=c.attr("aria-controls");a(o)?(n=o.hash,s=t.element.find(t._sanitizeSelector(n))):(n="#"+(r=t._tabId(c)),(s=t.element.find(n)).length||(s=t._createPanel(r)).insertAfter(t.panels[i-1]||t.tablist),s.attr("aria-live","polite")),s.length&&(t.panels=t.panels.add(s)),d&&c.data("ui-tabs-aria-controls",d),c.attr({"aria-controls":n.substring(1),"aria-labelledby":l}),s.attr("aria-labelledby",l)})),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,o=0;i=this.tabs[o];o++)!0===t||-1!==e.inArray(o,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),(function(e,t){i[t]="_eventHandler"})),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,o=this.element.parent();"fill"===t?(i=o.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each((function(){var t=e(this),o=t.css("position");"absolute"!==o&&"fixed"!==o&&(i-=t.outerHeight(!0))})),this.element.children().not(this.panels).each((function(){i-=e(this).outerHeight(!0)})),this.panels.each((function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))})).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each((function(){i=Math.max(i,e(this).height("").height())})).height(i))},_eventHandler:function(t){var i=this.options,o=this.active,n=e(t.currentTarget).closest("li"),a=n[0]===o[0],s=a&&i.collapsible,r=s?e():this._getPanelForTab(n),l=o.length?this._getPanelForTab(o):e(),c={oldTab:o,oldPanel:l,newTab:s?e():n,newPanel:r};t.preventDefault(),n.hasClass("ui-state-disabled")||n.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||!1===this._trigger("beforeActivate",t,c)||(i.active=!s&&this.tabs.index(n),this.active=a?e():n,this.xhr&&this.xhr.abort(),l.length||r.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),r.length&&this.load(this.tabs.index(n),t),this._toggle(t,c))},_toggle:function(t,i){var o=this,n=i.newPanel,a=i.oldPanel;function s(){o.running=!1,o._trigger("activate",t,i)}function r(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),n.length&&o.options.show?o._show(n,o.options.show,s):(n.show(),s())}this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,(function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r()})):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),r()),a.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),n.length&&a.length?i.oldTab.attr("tabIndex",-1):n.length&&this.tabs.filter((function(){return 0===e(this).attr("tabIndex")})).attr("tabIndex",-1),n.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var i,o=this._findActive(t);o[0]!==this.active[0]&&(o.length||(o=this.active),i=o.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each((function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")})),this.tabs.each((function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")})),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var o=this.options.disabled;!1!==o&&(i===t?o=!1:(i=this._getIndex(i),o=e.isArray(o)?e.map(o,(function(e){return e!==i?e:null})):e.map(this.tabs,(function(e,t){return t!==i?t:null}))),this._setupDisabled(o))},disable:function(i){var o=this.options.disabled;if(!0!==o){if(i===t)o=!0;else{if(i=this._getIndex(i),-1!==e.inArray(i,o))return;o=e.isArray(o)?e.merge([i],o).sort():[i]}this._setupDisabled(o)}},load:function(t,i){t=this._getIndex(t);var o=this,n=this.tabs.eq(t),s=n.find(".ui-tabs-anchor"),r=this._getPanelForTab(n),l={tab:n,panel:r};a(s[0])||(this.xhr=e.ajax(this._ajaxSettings(s,i,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),r.attr("aria-busy","true"),this.xhr.success((function(e){setTimeout((function(){r.html(e),o._trigger("load",i,l)}),1)})).complete((function(e,t){setTimeout((function(){"abort"===t&&o.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),r.removeAttr("aria-busy"),e===o.xhr&&delete o.xhr}),1)}))))},_ajaxSettings:function(t,i,o){var n=this;return{url:t.attr("href"),beforeSend:function(t,a){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:a},o))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(e){var t=0;function i(t,i){var o=(t.attr("aria-describedby")||"").split(/\s+/);o.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(o.join(" ")))}function o(t){var i=t.data("ui-tooltip-id"),o=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,o);-1!==n&&o.splice(n,1),t.removeData("ui-tooltip-id"),(o=e.trim(o.join(" ")))?t.attr("aria-describedby",o):t.removeAttr("aria-describedby")}e.widget("ui.tooltip",{version:"1.10.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var o=this;if("disabled"===t)return this[i?"_disable":"_enable"](),void(this.options[t]=i);this._super(t,i),"content"===t&&e.each(this.tooltips,(function(e,t){o._updateContent(t)}))},_disable:function(){var t=this;e.each(this.tooltips,(function(i,o){var n=e.Event("blur");n.target=n.currentTarget=o[0],t.close(n,!0)})),this.element.find(this.options.items).addBack().each((function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")}))},_enable:function(){this.element.find(this.options.items).addBack().each((function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))}))},open:function(t){var i=this,o=e(t?t.target:this.element).closest(this.options.items);o.length&&!o.data("ui-tooltip-id")&&(o.attr("title")&&o.data("ui-tooltip-title",o.attr("title")),o.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&o.parents().each((function(){var t,o=e(this);o.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),o.attr("title")&&(o.uniqueId(),i.parents[this.id]={element:this,title:o.attr("title")},o.attr("title",""))})),this._updateContent(o,t))},_updateContent:function(e,t){var i,o=this.options.content,n=this,a=t?t.type:null;if("string"==typeof o)return this._open(t,e,o);(i=o.call(e[0],(function(i){e.data("ui-tooltip-open")&&n._delay((function(){t&&(t.type=a),this._open(t,e,i)}))})))&&this._open(t,e,i)},_open:function(t,o,n){var a,s,r,l=e.extend({},this.options.position);function c(e){l.of=e,a.is(":hidden")||a.position(l)}n&&((a=this._find(o)).length?a.find(".ui-tooltip-content").html(n):(o.is("[title]")&&(t&&"mouseover"===t.type?o.attr("title",""):o.removeAttr("title")),a=this._tooltip(o),i(o,a.attr("id")),a.find(".ui-tooltip-content").html(n),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:c}),c(t)):a.position(e.extend({of:o},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval((function(){a.is(":visible")&&(c(l.of),clearInterval(r))}),e.fx.interval)),this._trigger("open",t,{tooltip:a}),s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=o[0],this.close(i,!0)}},remove:function(){this._removeTooltip(a)}},t&&"mouseover"!==t.type||(s.mouseleave="close"),t&&"focusin"!==t.type||(s.focusout="close"),this._on(!0,o,s)))},close:function(t){var i=this,n=e(t?t.currentTarget:this.element),a=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&n.attr("title",n.data("ui-tooltip-title")),o(n),a.stop(!0),this._hide(a,this.options.hide,(function(){i._removeTooltip(e(this))})),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,(function(t,o){e(o.element).attr("title",o.title),delete i.parents[t]})),this.closing=!0,this._trigger("close",t,{tooltip:a}),this.closing=!1)},_tooltip:function(i){var o="ui-tooltip-"+t++,n=e("<div>").attr({id:o,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(n),n.appendTo(this.document[0].body),this.tooltips[o]=i,n},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,(function(i,o){var n=e.Event("blur");n.target=n.currentTarget=o[0],t.close(n,!0),e("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}))}})}(jQuery),function(e,t){var i,o="ui-effects-";e.effects={effect:{}},function(e,t){var i,o="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",n=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],s=e.Color=function(t,i,o,n){return new e.Color.fn.parse(t,i,o,n)},r={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},l={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=s.support={},d=e("<p>")[0],h=e.each;function p(e,t,i){var o=l[t.type]||{};return null==e?i||!t.def?null:t.def:(e=o.floor?~~e:parseFloat(e),isNaN(e)?t.def:o.mod?(e+o.mod)%o.mod:0>e?0:o.max<e?o.max:e)}function u(t){var o=s(),n=o._rgba=[];return t=t.toLowerCase(),h(a,(function(e,i){var a,s=i.re.exec(t),l=s&&i.parse(s),c=i.space||"rgba";if(l)return a=o[c](l),o[r[c].cache]=a[r[c].cache],n=o._rgba=a._rgba,!1})),n.length?("0,0,0,0"===n.join()&&e.extend(n,i.transparent),o):i[t]}function f(e,t,i){return 6*(i=(i+1)%1)<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}d.style.cssText="background-color:rgba(1,1,1,.5)",c.rgba=d.style.backgroundColor.indexOf("rgba")>-1,h(r,(function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}})),s.fn=e.extend(s.prototype,{parse:function(o,n,a,l){if(o===t)return this._rgba=[null,null,null,null],this;(o.jquery||o.nodeType)&&(o=e(o).css(n),n=t);var c=this,d=e.type(o),f=this._rgba=[];return n!==t&&(o=[o,n,a,l],d="array"),"string"===d?this.parse(u(o)||i._default):"array"===d?(h(r.rgba.props,(function(e,t){f[t.idx]=p(o[t.idx],t)})),this):"object"===d?(h(r,o instanceof s?function(e,t){o[t.cache]&&(c[t.cache]=o[t.cache].slice())}:function(t,i){var n=i.cache;h(i.props,(function(e,t){if(!c[n]&&i.to){if("alpha"===e||null==o[e])return;c[n]=i.to(c._rgba)}c[n][t.idx]=p(o[e],t,!0)})),c[n]&&e.inArray(null,c[n].slice(0,3))<0&&(c[n][3]=1,i.from&&(c._rgba=i.from(c[n])))}),this):void 0},is:function(e){var t=s(e),i=!0,o=this;return h(r,(function(e,n){var a,s=t[n.cache];return s&&(a=o[n.cache]||n.to&&n.to(o._rgba)||[],h(n.props,(function(e,t){if(null!=s[t.idx])return i=s[t.idx]===a[t.idx]}))),i})),i},_space:function(){var e=[],t=this;return h(r,(function(i,o){t[o.cache]&&e.push(i)})),e.pop()},transition:function(e,t){var i=s(e),o=i._space(),n=r[o],a=0===this.alpha()?s("transparent"):this,c=a[n.cache]||n.to(a._rgba),d=c.slice();return i=i[n.cache],h(n.props,(function(e,o){var n=o.idx,a=c[n],s=i[n],r=l[o.type]||{};null!==s&&(null===a?d[n]=s:(r.mod&&(s-a>r.mod/2?a+=r.mod:a-s>r.mod/2&&(a-=r.mod)),d[n]=p((s-a)*t+a,o)))})),this[o](d)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),o=i.pop(),n=s(t)._rgba;return s(e.map(i,(function(e,t){return(1-o)*n[t]+o*e})))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,(function(e,t){return null==e?t>2?1:0:e}));return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),(function(e,t){return null==e&&(e=t>2?1:0),t&&t<3&&(e=Math.round(100*e)+"%"),e}));return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),o=i.pop();return t&&i.push(~~(255*o)),"#"+e.map(i,(function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e})).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),s.fn.parse.prototype=s.fn,r.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,o=e[0]/255,n=e[1]/255,a=e[2]/255,s=e[3],r=Math.max(o,n,a),l=Math.min(o,n,a),c=r-l,d=r+l,h=.5*d;return t=l===r?0:o===r?60*(n-a)/c+360:n===r?60*(a-o)/c+120:60*(o-n)/c+240,i=0===c?0:h<=.5?c/d:c/(2-d),[Math.round(t)%360,i,h,null==s?1:s]},r.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],o=e[2],n=e[3],a=o<=.5?o*(1+i):o+i-o*i,s=2*o-a;return[Math.round(255*f(s,a,t+1/3)),Math.round(255*f(s,a,t)),Math.round(255*f(s,a,t-1/3)),n]},h(r,(function(i,o){var a=o.props,r=o.cache,l=o.to,c=o.from;s.fn[i]=function(i){if(l&&!this[r]&&(this[r]=l(this._rgba)),i===t)return this[r].slice();var o,n=e.type(i),d="array"===n||"object"===n?i:arguments,u=this[r].slice();return h(a,(function(e,t){var i=d["object"===n?e:t.idx];null==i&&(i=u[t.idx]),u[t.idx]=p(i,t)})),c?((o=s(c(u)))[r]=u,o):s(u)},h(a,(function(t,o){s.fn[t]||(s.fn[t]=function(a){var s,r=e.type(a),l="alpha"===t?this._hsla?"hsla":"rgba":i,c=this[l](),d=c[o.idx];return"undefined"===r?d:("function"===r&&(a=a.call(this,d),r=e.type(a)),null==a&&o.empty?this:("string"===r&&(s=n.exec(a))&&(a=d+parseFloat(s[2])*("+"===s[1]?1:-1)),c[o.idx]=a,this[l](c)))})}))})),s.hook=function(t){var i=t.split(" ");h(i,(function(t,i){e.cssHooks[i]={set:function(t,o){var n,a,r="";if("transparent"!==o&&("string"!==e.type(o)||(n=u(o)))){if(o=s(n||o),!c.rgba&&1!==o._rgba[3]){for(a="backgroundColor"===i?t.parentNode:t;(""===r||"transparent"===r)&&a&&a.style;)try{r=e.css(a,"backgroundColor"),a=a.parentNode}catch(e){}o=o.blend(r&&"transparent"!==r?r:"_default")}o=o.toRgbaString()}try{t.style[i]=o}catch(e){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=s(t.elem,i),t.end=s(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}}))},s.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return h(["Top","Right","Bottom","Left"],(function(i,o){t["border"+o+"Color"]=e})),t}},i=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){var i,o=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function a(t){var i,o,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&&n.length&&n[0]&&n[n[0]])for(o=n.length;o--;)"string"==typeof n[i=n[o]]&&(a[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(a[i]=n[i]);return a}function s(t,i){var o,a,s={};for(o in i)a=i[o],t[o]!==a&&(n[o]||!e.fx.step[o]&&isNaN(parseFloat(a))||(s[o]=a));return s}e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],(function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}})),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,i,n,r){var l=e.speed(i,n,r);return this.queue((function(){var i,n=e(this),r=n.attr("class")||"",c=l.children?n.find("*").addBack():n;c=c.map((function(){return{el:e(this),start:a(this)}})),(i=function(){e.each(o,(function(e,i){t[i]&&n[i+"Class"](t[i])}))})(),c=c.map((function(){return this.end=a(this.el[0]),this.diff=s(this.start,this.end),this})),n.attr("class",r),c=c.map((function(){var t=this,i=e.Deferred(),o=e.extend({},l,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,o),i.promise()})),e.when.apply(e,c.get()).done((function(){i(),e.each(arguments,(function(){var t=this.el;e.each(this.diff,(function(e){t.css(e,"")}))})),l.complete.call(n[0])}))}))},e.fn.extend({addClass:(i=e.fn.addClass,function(t,o,n,a){return o?e.effects.animateClass.call(this,{add:t},o,n,a):i.apply(this,arguments)}),removeClass:function(t){return function(i,o,n,a){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},o,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(i){return function(o,n,a,s,r){return"boolean"==typeof n||n===t?a?e.effects.animateClass.call(this,n?{add:o}:{remove:o},a,s,r):i.apply(this,arguments):e.effects.animateClass.call(this,{toggle:o},n,a,s)}}(e.fn.toggleClass),switchClass:function(t,i,o,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},o,n,a)}})}(),function(){function i(t,i,o,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,o=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=o,o=i,i={}),e.isFunction(o)&&(n=o,o=null),i&&e.extend(t,i),o=o||i.duration,t.duration=e.fx.off?0:"number"==typeof o?o:o in e.fx.speeds?e.fx.speeds[o]:e.fx.speeds._default,t.complete=n||i.complete,t}function n(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||("string"==typeof t&&!e.effects.effect[t]||(!!e.isFunction(t)||"object"==typeof t&&!t.effect))}var a;e.extend(e.effects,{version:"1.10.4",save:function(e,t){for(var i=0;i<t.length;i++)null!==t[i]&&e.data(o+t[i],e[0].style[t[i]])},restore:function(e,i){var n,a;for(a=0;a<i.length;a++)null!==i[a]&&((n=e.data(o+i[a]))===t&&(n=""),e.css(i[a],n))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,o;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":o=0;break;case"center":o=.5;break;case"right":o=1;break;default:o=e[1]/t.width}return{x:o,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},o=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(e){a=document.body}return t.wrap(o),(t[0]===a||e.contains(t[0],a))&&e(a).focus(),o=t.parent(),"static"===t.css("position")?(o.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],(function(e,o){i[o]=t.css(o),isNaN(parseInt(i[o],10))&&(i[o]="auto")})),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),o.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,o,n){return n=n||{},e.each(i,(function(e,i){var a=t.cssUnit(i);a[0]>0&&(n[i]=a[0]*o+a[1])})),n}}),e.fn.extend({effect:function(){var t=i.apply(this,arguments),o=t.mode,n=t.queue,a=e.effects.effect[t.effect];if(e.fx.off||!a)return o?this[o](t.duration,t.complete):this.each((function(){t.complete&&t.complete.call(this)}));function s(i){var o=e(this),n=t.complete,s=t.mode;function r(){e.isFunction(n)&&n.call(o[0]),e.isFunction(i)&&i()}(o.is(":hidden")?"hide"===s:"show"===s)?(o[s](),r()):a.call(o[0],t,r)}return!1===n?this.each(s):this.queue(n||"fx",s)},show:(a=e.fn.show,function(e){if(n(e))return a.apply(this,arguments);var t=i.apply(this,arguments);return t.mode="show",this.effect.call(this,t)}),hide:function(e){return function(t){if(n(t))return e.apply(this,arguments);var o=i.apply(this,arguments);return o.mode="hide",this.effect.call(this,o)}}(e.fn.hide),toggle:function(e){return function(t){if(n(t)||"boolean"==typeof t)return e.apply(this,arguments);var o=i.apply(this,arguments);return o.mode="toggle",this.effect.call(this,o)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),o=[];return e.each(["em","px","%","pt"],(function(e,t){i.indexOf(t)>0&&(o=[parseFloat(i),t])})),o}})}(),i={},e.each(["Quad","Cubic","Quart","Quint","Expo"],(function(e,t){i[t]=function(t){return Math.pow(t,e+2)}})),e.extend(i,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(i,(function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return e<.5?i(2*e)/2:1-i(-2*e+2)/2}}))}(jQuery),function(e,t){var i=/up|down|vertical/,o=/up|left|vertical|horizontal/;e.effects.effect.blind=function(t,n){var a,s,r,l=e(this),c=["position","top","bottom","left","right","height","width"],d=e.effects.setMode(l,t.mode||"hide"),h=t.direction||"up",p=i.test(h),u=p?"height":"width",f=p?"top":"left",m=o.test(h),g={},v="show"===d;l.parent().is(".ui-effects-wrapper")?e.effects.save(l.parent(),c):e.effects.save(l,c),l.show(),s=(a=e.effects.createWrapper(l).css({overflow:"hidden"}))[u](),r=parseFloat(a.css(f))||0,g[u]=v?s:0,m||(l.css(p?"bottom":"right",0).css(p?"top":"left","auto").css({position:"absolute"}),g[f]=v?r:s+r),v&&(a.css(u,0),m||a.css(f,r+s)),a.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===d&&l.hide(),e.effects.restore(l,c),e.effects.removeWrapper(l),n()}})}}(jQuery),function(e,t){e.effects.effect.bounce=function(t,i){var o,n,a,s=e(this),r=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"effect"),c="hide"===l,d="show"===l,h=t.direction||"up",p=t.distance,u=t.times||5,f=2*u+(d||c?1:0),m=t.duration/f,g=t.easing,v="up"===h||"down"===h?"top":"left",y="up"===h||"left"===h,b=s.queue(),w=b.length;for((d||c)&&r.push("opacity"),e.effects.save(s,r),s.show(),e.effects.createWrapper(s),p||(p=s["top"===v?"outerHeight":"outerWidth"]()/3),d&&((a={opacity:1})[v]=0,s.css("opacity",0).css(v,y?2*-p:2*p).animate(a,m,g)),c&&(p/=Math.pow(2,u-1)),(a={})[v]=0,o=0;o<u;o++)(n={})[v]=(y?"-=":"+=")+p,s.animate(n,m,g).animate(a,m,g),p=c?2*p:p/2;c&&((n={opacity:0})[v]=(y?"-=":"+=")+p,s.animate(n,m,g)),s.queue((function(){c&&s.hide(),e.effects.restore(s,r),e.effects.removeWrapper(s),i()})),w>1&&b.splice.apply(b,[1,0].concat(b.splice(w,f+1))),s.dequeue()}}(jQuery),function(e,t){e.effects.effect.clip=function(t,i){var o,n,a,s=e(this),r=["position","top","bottom","left","right","height","width"],l="show"===e.effects.setMode(s,t.mode||"hide"),c="vertical"===(t.direction||"vertical"),d=c?"height":"width",h=c?"top":"left",p={};e.effects.save(s,r),s.show(),o=e.effects.createWrapper(s).css({overflow:"hidden"}),a=(n="IMG"===s[0].tagName?o:s)[d](),l&&(n.css(d,0),n.css(h,a/2)),p[d]=l?a:0,p[h]=l?0:a/2,n.animate(p,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||s.hide(),e.effects.restore(s,r),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e,t){e.effects.effect.drop=function(t,i){var o,n=e(this),a=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(n,t.mode||"hide"),r="show"===s,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",d="up"===l||"left"===l?"pos":"neg",h={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),o=t.distance||n["top"===c?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(c,"pos"===d?-o:o),h[c]=(r?"pos"===d?"+=":"-=":"pos"===d?"-=":"+=")+o,n.animate(h,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})}}(jQuery),function(e,t){e.effects.effect.explode=function(t,i){var o,n,a,s,r,l,c=t.pieces?Math.round(Math.sqrt(t.pieces)):3,d=c,h=e(this),p="show"===e.effects.setMode(h,t.mode||"hide"),u=h.show().css("visibility","hidden").offset(),f=Math.ceil(h.outerWidth()/d),m=Math.ceil(h.outerHeight()/c),g=[];function v(){g.push(this),g.length===c*d&&y()}for(o=0;o<c;o++)for(s=u.top+o*m,l=o-(c-1)/2,n=0;n<d;n++)a=u.left+n*f,r=n-(d-1)/2,h.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-n*f,top:-o*m}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:m,left:a+(p?r*f:0),top:s+(p?l*m:0),opacity:p?0:1}).animate({left:a+(p?0:r*f),top:s+(p?0:l*m),opacity:p?1:0},t.duration||500,t.easing,v);function y(){h.css({visibility:"visible"}),e(g).remove(),p||h.hide(),i()}}}(jQuery),function(e,t){e.effects.effect.fade=function(t,i){var o=e(this),n=e.effects.setMode(o,t.mode||"toggle");o.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}}(jQuery),function(e,t){e.effects.effect.fold=function(t,i){var o,n,a=e(this),s=["position","top","bottom","left","right","height","width"],r=e.effects.setMode(a,t.mode||"hide"),l="show"===r,c="hide"===r,d=t.size||15,h=/([0-9]+)%/.exec(d),p=!!t.horizFirst,u=l!==p,f=u?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(a,s),a.show(),o=e.effects.createWrapper(a).css({overflow:"hidden"}),n=u?[o.width(),o.height()]:[o.height(),o.width()],h&&(d=parseInt(h[1],10)/100*n[c?0:1]),l&&o.css(p?{height:0,width:d}:{height:d,width:0}),g[f[0]]=l?n[0]:d,v[f[1]]=l?n[1]:0,o.animate(g,m,t.easing).animate(v,m,t.easing,(function(){c&&a.hide(),e.effects.restore(a,s),e.effects.removeWrapper(a),i()}))}}(jQuery),function(e,t){e.effects.effect.highlight=function(t,i){var o=e(this),n=["backgroundImage","backgroundColor","opacity"],a=e.effects.setMode(o,t.mode||"show"),s={backgroundColor:o.css("backgroundColor")};"hide"===a&&(s.opacity=0),e.effects.save(o,n),o.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===a&&o.hide(),e.effects.restore(o,n),i()}})}}(jQuery),function(e,t){e.effects.effect.pulsate=function(t,i){var o,n=e(this),a=e.effects.setMode(n,t.mode||"show"),s="show"===a,r="hide"===a,l=s||"hide"===a,c=2*(t.times||5)+(l?1:0),d=t.duration/c,h=0,p=n.queue(),u=p.length;for(!s&&n.is(":visible")||(n.css("opacity",0).show(),h=1),o=1;o<c;o++)n.animate({opacity:h},d,t.easing),h=1-h;n.animate({opacity:h},d,t.easing),n.queue((function(){r&&n.hide(),i()})),u>1&&p.splice.apply(p,[1,0].concat(p.splice(u,c+1))),n.dequeue()}}(jQuery),function(e,t){e.effects.effect.puff=function(t,i){var o=e(this),n=e.effects.setMode(o,t.mode||"hide"),a="hide"===n,s=parseInt(t.percent,10)||150,r=s/100,l={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:a?s:100,from:a?l:{height:l.height*r,width:l.width*r,outerHeight:l.outerHeight*r,outerWidth:l.outerWidth*r}}),o.effect(t)},e.effects.effect.scale=function(t,i){var o=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(o,t.mode||"effect"),s=parseInt(t.percent,10)||(0===parseInt(t.percent,10)||"hide"===a?0:100),r=t.direction||"both",l=t.origin,c={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},d={y:"horizontal"!==r?s/100:1,x:"vertical"!==r?s/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==a&&(n.origin=l||["middle","center"],n.restore=!0),n.from=t.from||("show"===a?{height:0,width:0,outerHeight:0,outerWidth:0}:c),n.to={height:c.height*d.y,width:c.width*d.x,outerHeight:c.outerHeight*d.y,outerWidth:c.outerWidth*d.x},n.fade&&("show"===a&&(n.from.opacity=0,n.to.opacity=1),"hide"===a&&(n.from.opacity=1,n.to.opacity=0)),o.effect(n)},e.effects.effect.size=function(t,i){var o,n,a,s=e(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],c=["width","height","overflow"],d=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],p=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],u=e.effects.setMode(s,t.mode||"effect"),f=t.restore||"effect"!==u,m=t.scale||"both",g=t.origin||["middle","center"],v=s.css("position"),y=f?r:l,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===u&&s.show(),o={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===t.mode&&"show"===u?(s.from=t.to||b,s.to=t.from||o):(s.from=t.from||("show"===u?b:o),s.to=t.to||("hide"===u?b:o)),a={from:{y:s.from.height/o.height,x:s.from.width/o.width},to:{y:s.to.height/o.height,x:s.to.width/o.width}},"box"!==m&&"both"!==m||(a.from.y!==a.to.y&&(y=y.concat(h),s.from=e.effects.setTransition(s,h,a.from.y,s.from),s.to=e.effects.setTransition(s,h,a.to.y,s.to)),a.from.x!==a.to.x&&(y=y.concat(p),s.from=e.effects.setTransition(s,p,a.from.x,s.from),s.to=e.effects.setTransition(s,p,a.to.x,s.to))),"content"!==m&&"both"!==m||a.from.y!==a.to.y&&(y=y.concat(d).concat(c),s.from=e.effects.setTransition(s,d,a.from.y,s.from),s.to=e.effects.setTransition(s,d,a.to.y,s.to)),e.effects.save(s,y),s.show(),e.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),g&&(n=e.effects.getBaseline(g,o),s.from.top=(o.outerHeight-s.outerHeight())*n.y,s.from.left=(o.outerWidth-s.outerWidth())*n.x,s.to.top=(o.outerHeight-s.to.outerHeight)*n.y,s.to.left=(o.outerWidth-s.to.outerWidth)*n.x),s.css(s.from),"content"!==m&&"both"!==m||(h=h.concat(["marginTop","marginBottom"]).concat(d),p=p.concat(["marginLeft","marginRight"]),c=r.concat(h).concat(p),s.find("*[width]").each((function(){var i=e(this),o={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,c),i.from={height:o.height*a.from.y,width:o.width*a.from.x,outerHeight:o.outerHeight*a.from.y,outerWidth:o.outerWidth*a.from.x},i.to={height:o.height*a.to.y,width:o.width*a.to.x,outerHeight:o.height*a.to.y,outerWidth:o.width*a.to.x},a.from.y!==a.to.y&&(i.from=e.effects.setTransition(i,h,a.from.y,i.from),i.to=e.effects.setTransition(i,h,a.to.y,i.to)),a.from.x!==a.to.x&&(i.from=e.effects.setTransition(i,p,a.from.x,i.from),i.to=e.effects.setTransition(i,p,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,(function(){f&&e.effects.restore(i,c)}))}))),s.animate(s.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===u&&s.hide(),e.effects.restore(s,y),f||("static"===v?s.css({position:"relative",top:s.to.top,left:s.to.left}):e.each(["top","left"],(function(e,t){s.css(t,(function(t,i){var o=parseInt(i,10),n=e?s.to.left:s.to.top;return"auto"===i?n+"px":o+n+"px"}))}))),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e,t){e.effects.effect.shake=function(t,i){var o,n=e(this),a=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(n,t.mode||"effect"),r=t.direction||"left",l=t.distance||20,c=t.times||3,d=2*c+1,h=Math.round(t.duration/d),p="up"===r||"down"===r?"top":"left",u="up"===r||"left"===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[p]=(u?"-=":"+=")+l,m[p]=(u?"+=":"-=")+2*l,g[p]=(u?"-=":"+=")+2*l,n.animate(f,h,t.easing),o=1;o<c;o++)n.animate(m,h,t.easing).animate(g,h,t.easing);n.animate(m,h,t.easing).animate(f,h/2,t.easing).queue((function(){"hide"===s&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()})),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,d+1))),n.dequeue()}}(jQuery),function(e,t){e.effects.effect.slide=function(t,i){var o,n=e(this),a=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(n,t.mode||"show"),r="show"===s,l=t.direction||"left",c="up"===l||"down"===l?"top":"left",d="up"===l||"left"===l,h={};e.effects.save(n,a),n.show(),o=t.distance||n["top"===c?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(c,d?isNaN(o)?"-"+o:-o:o),h[c]=(r?d?"+=":"-=":d?"-=":"+=")+o,n.animate(h,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})}}(jQuery),function(e,t){e.effects.effect.transfer=function(t,i){var o=e(this),n=e(t.to),a="fixed"===n.css("position"),s=e("body"),r=a?s.scrollTop():0,l=a?s.scrollLeft():0,c=n.offset(),d={top:c.top-r,left:c.left-l,height:n.innerHeight(),width:n.innerWidth()},h=o.offset(),p=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:h.top-r,left:h.left-l,height:o.innerHeight(),width:o.innerWidth(),position:a?"fixed":"absolute"}).animate(d,t.duration,t.easing,(function(){p.remove(),i()}))}}(jQuery);i("./node_modules/script-loader/index.js!./src/lib/jqueryui/jquery-ui-i18n.js"),i("./node_modules/script-loader/index.js!./src/lib/jqueryui/jquery.ui.touch-punch.min.js"),i("./src/lib/excel/jszip.js");function o(e){var t,i,o,n,a,s,r,l,c,d,h,p,u,f,m,g,v,y,b,w,x,T,C,k,$,S,_,E,D,N,I,O,M,F,R,L=new JSZip,j=[[],[]],A=[],P=[],U=[],H=["General","0","0.00","#,##0","#,##0.00",,,,,"0%","0.00%","0.00E+00","# ?/?","# ??/??","mm-dd-yy","d-mmm-yy","d-mmm","mmm-yy","h:mm AM/PM","h:mm:ss AM/PM","h:mm","h:mm:ss","m/d/yy h:mm",,,,,,,,,,,,,,,"#,##0 ;(#,##0)","#,##0 ;[Red](#,##0)","#,##0.00;(#,##0.00)","#,##0.00;[Red](#,##0.00)",,,,,"mm:ss","[h]:mm:ss","mmss.0","##0.0E+0","@"],z="ABCDEFGHIJKLMNOPQRSTUVWXYZ",V="Calibri",W=11;function B(e){var t=Math.floor(e/26)-1;return(t>-1?B(t):"")+z.charAt(e%26)}function q(e){var t=0;return 2===e.length&&(t=q(e.charAt(0))+1),26*t+z.indexOf(e.substr(-1))}function Y(e){var t=new Date(1900,0,0),i="object"==typeof e,o=6e4*((i?e.getTimezoneOffset():(new Date).getTimezoneOffset())-t.getTimezoneOffset());return i?(e-t-o)/864e5+1:new Date(+t-o+864e5*(e-1))}function X(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function G(e,t){return(e=e.substr(e.indexOf(t+'="')+t.length+2)).substring(0,e.indexOf('"'))}function J(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"):""}function K(e){return"string"==typeof e?e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'"):""}if("string"==typeof e){if(i=Date.now(),L=L.load(e,{base64:!0}),t={worksheets:[],zipTime:Date.now()-i},o=Date.now(),p=[],u=[],n=L.file("xl/sharedStrings.xml"))for(s=(n=n.asText().split(/<t.*?>/g)).length;--s;)p[s-1]=K(n[s].substring(0,n[s].indexOf("</t>")));if((n=L.file("docProps/core.xml"))&&(n=(n=n.asText()).substr(n.indexOf("<dc:creator>")+12),t.creator=n.substring(0,n.indexOf("</dc:creator>")),n=n.substr(n.indexOf("<cp:lastModifiedBy>")+19),t.lastModifiedBy=n.substring(0,n.indexOf("</cp:lastModifiedBy>")),n=n.substr(n.indexOf('<dcterms:created xsi:type="dcterms:W3CDTF">')+43),t.created=new Date(n.substring(0,n.indexOf("</dcterms:created>"))),n=n.substr(n.indexOf('<dcterms:modified xsi:type="dcterms:W3CDTF">')+44),t.modified=new Date(n.substring(0,n.indexOf("</dcterms:modified>")))),n=L.file("xl/workbook.xml"))for((f=(n=n.asText()).indexOf('activeTab="'))>0?(n=n.substr(f+11),t.activeWorksheet=+n.substring(0,n.indexOf('"'))):t.activeWorksheet=0,s=(n=n.split("<sheet ")).length;--s;)E=n[s].substr(n[s].indexOf('name="')+6),t.worksheets.unshift({name:E.substring(0,E.indexOf('"')),data:[]});if(n=L.file("xl/styles.xml")){for(s=(n=n.asText().split("<numFmt ")).length;--s;)H[+G(d=n[s],"numFmtId")]=G(d,"formatCode");for(s=(n=(n=n[n.length-1]).substr(n.indexOf("cellXfs")).split("<xf ")).length;--s;)d=(a=H[E=G(n[s],"numFmtId")]).indexOf("m")>-1?"date":a.indexOf("0")>-1?"number":"@"===a?"string":"unknown",u.unshift({formatCode:a,type:d})}for(s=t.worksheets.length;s--;)for(n=L.file("xl/worksheets/sheet"+(s+1)+".xml").asText().split("<row "),(h=t.worksheets[s]).table=n[0].indexOf("<tableParts ")>0,d=(d=G(n[0].substr(n[0].indexOf("<dimension")),"ref")).substr(d.indexOf(":")+1),h.maxCol=q(d.match(/[a-zA-Z]*/g)[0])+1,h.maxRow=+d.match(/\d*/g).join(""),h=h.data,r=n.length;--r;)for(M=h[+G(n[r],"r")-1]=[],l=(D=n[r].split("<c ")).length;--l;){switch(a=u[+G(O=D[l],"s")]||{type:"General",formatCode:"General"},d=G(O,"t")||a.type,g=(g=O.substring(O.indexOf("<v>")+3,O.indexOf("</v>")))?+g:"",d){case"s":g=p[g];break;case"b":g=1===g;break;case"date":g=Y(g)}M[q(G(O,"r").match(/[a-zA-Z]*/g)[0])]={value:g,formatCode:a.formatCode}}t.processTime=Date.now()-o}else{o=Date.now(),p=[];var Q={};for(L.folder("_rels").file(".rels",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties" Target="docProps/app.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties" Target="docProps/core.xml"/><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>'),k=L.folder("docProps"),($=L.folder("xl")).folder("theme").file("theme1.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme"><a:themeElements><a:clrScheme name="Office"><a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1><a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1><a:dk2><a:srgbClr val="1F497D"/></a:dk2><a:lt2><a:srgbClr val="EEECE1"/></a:lt2><a:accent1><a:srgbClr val="4F81BD"/></a:accent1><a:accent2><a:srgbClr val="C0504D"/></a:accent2><a:accent3><a:srgbClr val="9BBB59"/></a:accent3><a:accent4><a:srgbClr val="8064A2"/></a:accent4><a:accent5><a:srgbClr val="4BACC6"/></a:accent5><a:accent6><a:srgbClr val="F79646"/></a:accent6><a:hlink><a:srgbClr val="0000FF"/></a:hlink><a:folHlink><a:srgbClr val="800080"/></a:folHlink></a:clrScheme><a:fontScheme name="Office"><a:majorFont><a:latin typeface="Cambria"/><a:ea typeface=""/><a:cs typeface=""/><a:font script="Jpan" typeface="MS P????"/><a:font script="Hang" typeface="?? ??"/><a:font script="Hans" typeface="??"/><a:font script="Hant" typeface="????"/><a:font script="Arab" typeface="Times New Roman"/><a:font script="Hebr" typeface="Times New Roman"/><a:font script="Thai" typeface="Tahoma"/><a:font script="Ethi" typeface="Nyala"/><a:font script="Beng" typeface="Vrinda"/><a:font script="Gujr" typeface="Shruti"/><a:font script="Khmr" typeface="MoolBoran"/><a:font script="Knda" typeface="Tunga"/><a:font script="Guru" typeface="Raavi"/><a:font script="Cans" typeface="Euphemia"/><a:font script="Cher" typeface="Plantagenet Cherokee"/><a:font script="Yiii" typeface="Microsoft Yi Baiti"/><a:font script="Tibt" typeface="Microsoft Himalaya"/><a:font script="Thaa" typeface="MV Boli"/><a:font script="Deva" typeface="Mangal"/><a:font script="Telu" typeface="Gautami"/><a:font script="Taml" typeface="Latha"/><a:font script="Syrc" typeface="Estrangelo Edessa"/><a:font script="Orya" typeface="Kalinga"/><a:font script="Mlym" typeface="Kartika"/><a:font script="Laoo" typeface="DokChampa"/><a:font script="Sinh" typeface="Iskoola Pota"/><a:font script="Mong" typeface="Mongolian Baiti"/><a:font script="Viet" typeface="Times New Roman"/><a:font script="Uigh" typeface="Microsoft Uighur"/><a:font script="Geor" typeface="Sylfaen"/></a:majorFont><a:minorFont><a:latin typeface="Calibri"/><a:ea typeface=""/><a:cs typeface=""/><a:font script="Jpan" typeface="MS P????"/><a:font script="Hang" typeface="?? ??"/><a:font script="Hans" typeface="??"/><a:font script="Hant" typeface="????"/><a:font script="Arab" typeface="Arial"/><a:font script="Hebr" typeface="Arial"/><a:font script="Thai" typeface="Tahoma"/><a:font script="Ethi" typeface="Nyala"/><a:font script="Beng" typeface="Vrinda"/><a:font script="Gujr" typeface="Shruti"/><a:font script="Khmr" typeface="DaunPenh"/><a:font script="Knda" typeface="Tunga"/><a:font script="Guru" typeface="Raavi"/><a:font script="Cans" typeface="Euphemia"/><a:font script="Cher" typeface="Plantagenet Cherokee"/><a:font script="Yiii" typeface="Microsoft Yi Baiti"/><a:font script="Tibt" typeface="Microsoft Himalaya"/><a:font script="Thaa" typeface="MV Boli"/><a:font script="Deva" typeface="Mangal"/><a:font script="Telu" typeface="Gautami"/><a:font script="Taml" typeface="Latha"/><a:font script="Syrc" typeface="Estrangelo Edessa"/><a:font script="Orya" typeface="Kalinga"/><a:font script="Mlym" typeface="Kartika"/><a:font script="Laoo" typeface="DokChampa"/><a:font script="Sinh" typeface="Iskoola Pota"/><a:font script="Mong" typeface="Mongolian Baiti"/><a:font script="Viet" typeface="Arial"/><a:font script="Uigh" typeface="Microsoft Uighur"/><a:font script="Geor" typeface="Sylfaen"/></a:minorFont></a:fontScheme><a:fmtScheme name="Office"><a:fillStyleLst><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs><a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs></a:gsLst><a:lin ang="16200000" scaled="1"/></a:gradFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:shade val="51000"/><a:satMod val="130000"/></a:schemeClr></a:gs><a:gs pos="80000"><a:schemeClr val="phClr"><a:shade val="93000"/><a:satMod val="130000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="94000"/><a:satMod val="135000"/></a:schemeClr></a:gs></a:gsLst><a:lin ang="16200000" scaled="0"/></a:gradFill></a:fillStyleLst><a:lnStyleLst><a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln><a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln><a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln></a:lnStyleLst><a:effectStyleLst><a:effectStyle><a:effectLst><a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw></a:effectLst></a:effectStyle><a:effectStyle><a:effectLst><a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw></a:effectLst></a:effectStyle><a:effectStyle><a:effectLst><a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw></a:effectLst><a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d><a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d></a:effectStyle></a:effectStyleLst><a:bgFillStyleLst><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs><a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs></a:gsLst><a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path></a:gradFill><a:gradFill rotWithShape="1"><a:gsLst><a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs><a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs></a:gsLst><a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path></a:gradFill></a:bgFillStyleLst></a:fmtScheme></a:themeElements><a:objectDefaults/><a:extraClrSchemeLst/></a:theme>'),S=$.folder("worksheets"),k.file("core.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><cp:coreProperties xmlns:cp="http://schemas.openxmlformats.org/package/2006/metadata/core-properties" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dcmitype="http://purl.org/dc/dcmitype/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><dc:creator>'+(e.creator||"XLSX.js")+"</dc:creator><cp:lastModifiedBy>"+(e.lastModifiedBy||"XLSX.js")+'</cp:lastModifiedBy><dcterms:created xsi:type="dcterms:W3CDTF">'+(e.created||new Date).toISOString()+'</dcterms:created><dcterms:modified xsi:type="dcterms:W3CDTF">'+(e.modified||new Date).toISOString()+"</dcterms:modified></cp:coreProperties>"),u=new Array(1),y=new Array(1),x=new Array(1),h=e.worksheets.length;h--;){for(E=h+1,n="",D=[],F=[],s=-1,c=(m=(_=e.worksheets[h]).data).length;++s<c;){for(r=-1,l=m[s].length,n+='<row r="'+(s+1)+'" x14ac:dyDescent="0.25">';++r<l;){if(g=(O=m[s][r]).hasOwnProperty("value")?O.value:O,d="",v={borders:O.borders,hAlign:O.hAlign,vAlign:O.vAlign,bold:O.bold,italic:O.italic,fontName:O.fontName,fontSize:O.fontSize,formatCode:O.formatCode||"General"},I=0,g&&"string"==typeof g?(void 0===(f=Q[g=J(g)])&&(f=p.length,p.push(g),Q[g]=f),I=g.length,g=f,d="s"):"boolean"==typeof g?(g=g?1:0,d="b",I=1):"date"===X(g)?(g=Y(g),v.formatCode=O.formatCode||"mm-dd-yy",I=g.length):"object"==typeof g?g=null:I=(""+g).length,v=JSON.stringify(v),v=(f=u.indexOf(v))<0?u.push(v)-1:f,null==D[r]&&(D[r]={autoWidth:!1,max:0}),O.autoWidth&&(D[r].autoWidth=!0),I>D[r].max&&(D[r].max=I),O.colSpan>1){F.push([B(r)+(s+1),B(r+O.colSpan-1)+(s+1)]),R=[r,0];for(var Z=0;Z<O.colSpan-1;Z++)R.push(O);m[s].splice.apply(m[s],R),l+=O.colSpan-1}else if(O.rowSpan>1){for(Z=1;Z<O.rowSpan;Z++){if(!m[s+Z]){O.rowSpan=Z;break}m[s+Z].splice(r,0,O)}F.push([B(r)+(s+1),B(r)+(s+O.rowSpan)])}(O.rowSpan>1||O.colSpan>1)&&(delete O.value,delete O.rowSpan,delete O.colSpan),n+='<c r="'+B(r)+(s+1)+'"'+(v?' s="'+v+'"':"")+(d?' t="'+d+'"':""),n+=null!=g?">"+(O.formula?"<f>"+O.formula+"</f>":"")+"<v>"+g+"</v></c>":"/>"}n+="</row>"}for(N=[],s=0;s<D.length;s++)D[s].autoWidth&&N.push('<col min="',s+1,'" max="',s+1,'" width="',D[s].max,'" bestFit="1"/>');if(N.length>0&&(N=["<cols>"].concat(N,["</cols>"]).join("")),n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"><dimension ref="A1:'+B(m[0].length-1)+m.length+'"/><sheetViews><sheetView '+(h===e.activeWorksheet?'tabSelected="1" ':"")+' workbookViewId="0"/></sheetViews><sheetFormatPr defaultRowHeight="15" x14ac:dyDescent="0.25"/>'+N+"<sheetData>"+n+"</sheetData>",F.length>0){for(n+='<mergeCells count="'+F.length+'">',s=0;s<F.length;s++)n+='<mergeCell ref="'+F[s].join(":")+'"/>';n+="</mergeCells>"}if(n+='<pageMargins left="0.7" right="0.7" top="0.75" bottom="0.75" header="0.3" footer="0.3"/>',_.table&&(n+='<tableParts count="1"><tablePart r:id="rId1"/></tableParts>'),S.file("sheet"+E+".xml",n+"</worksheet>"),_.table){for(s=-1,c=m[0].length,n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><table xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" id="'+E+'" name="Table'+E+'" displayName="Table'+E+'" ref="A1:'+(d=B(m[0].length-1)+m.length)+'" totalsRowShown="0"><autoFilter ref="A1:'+d+'"/><tableColumns count="'+m[0].length+'">';++s<c;)n+='<tableColumn id="'+(s+1)+'" name="'+(m[0][s].hasOwnProperty("value")?m[0][s].value:m[0][s])+'"/>';n+='</tableColumns><tableStyleInfo name="TableStyleMedium2" showFirstColumn="0" showLastColumn="0" showRowStripes="1" showColumnStripes="0"/></table>',$.folder("tables").file("table"+E+".xml",n),S.folder("_rels").file("sheet"+E+".xml.rels",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/table" Target="../tables/table'+E+'.xml"/></Relationships>'),j[1].unshift('<Override PartName="/xl/tables/table'+E+'.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml"/>')}j[0].unshift('<Override PartName="/xl/worksheets/sheet'+E+'.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/>'),A.unshift(J(_.name)||"Sheet"+E),P.unshift('<Relationship Id="rId'+E+'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet'+E+'.xml"/>'),U.unshift('<sheet name="'+(J(_.name)||"Sheet"+E)+'" sheetId="'+E+'" r:id="rId'+E+'"/>')}for(s=u.length,d=[];--s;){if("General"!==(v=JSON.parse(u[s])).formatCode?((f=H.indexOf(v.formatCode))<0&&(f=164+d.length,d.push('<numFmt formatCode="'+v.formatCode+'" numFmtId="'+f+'"/>')),v.formatCode=f):v.formatCode=0,w=0,v.borders){for(var ee in b=["<border>"],{left:0,right:0,top:0,bottom:0,diagonal:0})if(v.borders[ee]){var te=v.borders[ee];6===te.length&&(te="FF"+te),b.push("<",ee,' style="thin">','<color rgb="',v.borders[ee],'"/></',ee,">")}else b.push("<",ee,"/>");b.push("</border>"),b=b.join(""),(w=y.indexOf(b))<0&&(w=y.push(b)-1)}C=0,(v.bold||v.italic||v.fontSize||v.fontName)&&(T=["<font>"],v.bold&&T.push("<b/>"),v.italic&&T.push("<i/>"),T.push('<sz val="',v.fontSize||W,'"/>'),T.push('<color theme="1"/>'),T.push('<name val="',v.fontName||V,'"/>'),T.push('<family val="2"/>',"</font>"),T=T.join(""),(C=x.indexOf(T))<0&&(C=x.push(T)-1)),u[s]=['<xf xfId="0" fillId="0" borderId="',w,'" fontId="',C,'" numFmtId="',v.formatCode,'" ',v.hAlign||v.vAlign?'applyAlignment="1" ':" ",v.formatCode>0?'applyNumberFormat="1" ':" ",w>0?'applyBorder="1" ':" ",C>0?'applyFont="1" ':" ",">"],(v.hAlign||v.vAlign)&&(u[s].push("<alignment"),v.hAlign&&u[s].push(' horizontal="',v.hAlign,'"'),v.vAlign&&u[s].push(' vertical="',v.vAlign,'"'),u[s].push("/>")),u[s].push("</xf>"),u[s]=u[s].join("")}d=d.length?'<numFmts count="'+d.length+'">'+d.join("")+"</numFmts>":"",$.file("styles.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac">'+d+'<fonts count="'+x.length+'" x14ac:knownFonts="1"><font><sz val="'+W+'"/><color theme="1"/><name val="'+V+'"/><family val="2"/><scheme val="minor"/></font>'+x.join("")+'</fonts><fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills><borders count="'+y.length+'"><border><left/><right/><top/><bottom/><diagonal/></border>'+y.join("")+'</borders><cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs><cellXfs count="'+u.length+'"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0"/>'+u.join("")+'</cellXfs><cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles><dxfs count="0"/><tableStyles count="0" defaultTableStyle="TableStyleMedium2" defaultPivotStyle="PivotStyleLight16"/><extLst><ext uri="{EB79DEF2-80B8-43e5-95BD-54CBDDF9020C}" xmlns:x14="http://schemas.microsoft.com/office/spreadsheetml/2009/9/main"><x14:slicerStyles defaultSlicerStyle="SlicerStyleLight1"/></ext></extLst></styleSheet>'),L.file("[Content_Types].xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/><Default Extension="xml" ContentType="application/xml"/><Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/>'+j[0].join("")+'<Override PartName="/xl/theme/theme1.xml" ContentType="application/vnd.openxmlformats-officedocument.theme+xml"/><Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"/><Override PartName="/xl/sharedStrings.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"/>'+j[1].join("")+'<Override PartName="/docProps/core.xml" ContentType="application/vnd.openxmlformats-package.core-properties+xml"/><Override PartName="/docProps/app.xml" ContentType="application/vnd.openxmlformats-officedocument.extended-properties+xml"/></Types>'),k.file("app.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Properties xmlns="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties" xmlns:vt="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes"><Application>XLSX.js</Application><DocSecurity>0</DocSecurity><ScaleCrop>false</ScaleCrop><HeadingPairs><vt:vector size="2" baseType="variant"><vt:variant><vt:lpstr>Worksheets</vt:lpstr></vt:variant><vt:variant><vt:i4>'+e.worksheets.length+'</vt:i4></vt:variant></vt:vector></HeadingPairs><TitlesOfParts><vt:vector size="'+A.length+'" baseType="lpstr"><vt:lpstr>'+A.join("</vt:lpstr><vt:lpstr>")+"</vt:lpstr></vt:vector></TitlesOfParts><Manager></Manager><Company>Microsoft Corporation</Company><LinksUpToDate>false</LinksUpToDate><SharedDoc>false</SharedDoc><HyperlinksChanged>false</HyperlinksChanged><AppVersion>1.0</AppVersion></Properties>"),$.folder("_rels").file("workbook.xml.rels",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">'+P.join("")+'<Relationship Id="rId'+(P.length+1)+'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings" Target="sharedStrings.xml"/><Relationship Id="rId'+(P.length+2)+'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/><Relationship Id="rId'+(P.length+3)+'" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme" Target="theme/theme1.xml"/></Relationships>'),$.file("sharedStrings.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" count="'+p.length+'" uniqueCount="'+p.length+'"><si><t>'+p.join("</t></si><si><t>")+"</t></si></sst>"),$.file("workbook.xml",'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><fileVersion appName="xl" lastEdited="5" lowestEdited="5" rupBuild="9303"/><workbookPr defaultThemeVersion="124226"/><bookViews><workbookView '+(e.activeWorksheet?'activeTab="'+e.activeWorksheet+'" ':"")+'xWindow="480" yWindow="60" windowWidth="18195" windowHeight="8505"/></bookViews><sheets>'+U.join("")+'</sheets><calcPr fullCalcOnLoad="1"/></workbook>'),o=Date.now()-o,i=Date.now(),t={base64:L.generate({compression:"DEFLATE"}),zipTime:Date.now()-i,processTime:o,href:function(){return"data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;base64,"+this.base64}}}return t}i("./src/init_touch.js");var n,a,s=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),r=i.n(s),l=i("./src/react/util/commons.ts");class c{static makeCallback(e){Object(l.a)(e);const t=c.nextCallbackId++;return c.callbacks[t]=e,t}static callCallback(e,t,i){const o=c.callbacks[e];if(!o)throw new Error("Callback "+e+" not registered");delete c.callbacks[e],o(t,...i)}}r()(c,"callbacks",{}),r()(c,"nextCallbackId",1),window.NativeBridge=c,Object(l.a)(null===(n=window.webkit)||void 0===n||null===(a=n.messageHandlers)||void 0===a?void 0:a.NativeNinoxAddressBook);const d=window.webkit.messageHandlers.NativeNinoxAddressBook;class h{loadContacts(e){d.postMessage({method:"loadContacts",callback:c.makeCallback(e)})}}const p=new h;var u,f;window.NinoxAddressBook=p,Object(l.a)(null===(u=window.webkit)||void 0===u||null===(f=u.messageHandlers)||void 0===f?void 0:f.NativeNinoxAppStore);const m=window.webkit.messageHandlers.NativeNinoxAppStore;class g{isPremium(e){m.postMessage({callback:c.makeCallback(e),method:"isPremium"})}loadProducts(e){m.postMessage({callback:c.makeCallback(e),method:"loadProducts"})}restoreProducts(e){m.postMessage({callback:c.makeCallback(e),method:"restoreProducts"})}canOrderProduct(e){m.postMessage({callback:c.makeCallback(e),method:"canOrderProduct"})}orderProduct(e,t,i){m.postMessage({callback:c.makeCallback(i),params:[e,t],method:"orderProduct"})}onProductsChanged(e){m.postMessage({callback:c.makeCallback(e),method:"onProductsChanged"})}loadReceipt(e){m.postMessage({callback:c.makeCallback(e),method:"loadReceipt"})}pendingPurchases(e){m.postMessage({callback:c.makeCallback(e),method:"pendingPurchases"})}cancelPurchase(e){m.postMessage({callback:c.makeCallback(e),method:"cancelPurchase"})}refreshReceipt(e){m.postMessage({callback:c.makeCallback(e),method:"refreshReceipt"})}reset(e){m.postMessage({callback:c.makeCallback(e),method:"reset"})}}const v=new g;window.NinoxAppStore=v;var y=i("./src/js/helpers.ts");let b,w,x,T,C,k,S,_,E,D,N,I;function O(e,t){return(i,...o)=>{if(i)return t(i);e(...o)}}var M,F;b||(b={}),w||(w={}),x||(x={}),T||(T={}),C||(C={}),k||(k={}),S||(S={}),_||(_={}),E||(E={}),D||(D={}),N||(N={}),I||(I={}),Object(l.a)(null===(M=window.webkit)||void 0===M||null===(F=M.messageHandlers)||void 0===F?void 0:F.NativeCloudFileSystem);const R=window.webkit.messageHandlers.NativeCloudFileSystem;class L{constructor(){r()(this,"propClientId",void 0),r()(this,"propUbiquityUrl",void 0),r()(this,"propProxyUbiquityUrl",void 0)}log(e){R.postMessage({method:"log",params:[e]})}initWithNative(){return new Promise(e=>{R.postMessage({method:"fetchNativeProperties",callback:c.makeCallback((t,i)=>{void 0!==i&&(this.propClientId=i.clientId,this.propUbiquityUrl=i.ubiquityUrl,this.propProxyUbiquityUrl=i.ubiquityUrlProxy),e()})})})}readFile(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.readFile using callback");return new Promise("utf8"===t?(t,i)=>{const o=this.proxyUbiquityUrl()+Object(y.a)(e),n=$.get(o,()=>{t(n.responseText)}).fail(()=>{i("Failed to load "+e+": "+n.responseText)})}:(i,o)=>{R.postMessage({method:"readFile",params:[e,t],callback:c.makeCallback(O(i,o))})})}readFileUnsafe(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.readFileUnsafe using callback");return new Promise((i,o)=>{R.postMessage({method:"readFileUnsafe",params:[e,t],callback:c.makeCallback(O(i,o))})})}appendFile(e,t,i,o){if("function"==typeof o)throw new Error("NinoxCloudFileSystem.appendFile using callback");return new Promise((o,n)=>{R.postMessage({method:"appendFile",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}writeFile(e,t,i,o){if("function"==typeof o)throw new Error("NinoxCloudFileSystem.writeFile using callback");return new Promise((o,n)=>{R.postMessage({method:"writeFile",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}writeFileBase64(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.writeFileBase64 using callback");return new Promise((i,o)=>{R.postMessage({method:"writeFileBase64",params:[e,t],callback:c.makeCallback(O(i,o))})})}exists(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.exists using callback");return new Promise((t,i)=>{R.postMessage({method:"exists",params:[e],callback:c.makeCallback(O(t,i))})})}stats(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.stats using callback");return new Promise((t,i)=>{R.postMessage({method:"stats",params:[e],callback:c.makeCallback(O(t,i))})})}listFiles(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.listFiles using callback");return new Promise((t,i)=>{R.postMessage({method:"listFiles",params:[e],callback:c.makeCallback(O(t,i))})})}listFilesUnsafe(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.listFilesUnsafe using callback");return new Promise((t,i)=>{R.postMessage({method:"listFilesUnsafe",params:[e],callback:c.makeCallback(O(t,i))})})}countFiles(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.countFiles using callback");return new Promise((i,o)=>{R.postMessage({method:"countFiles",params:[e,t],callback:c.makeCallback(O(i,o))})})}mkdir(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.mkdir using callback");return new Promise((t,i)=>{R.postMessage({method:"mkdir",params:[e],callback:c.makeCallback(O(t,i))})})}remove(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.remove using callback");return new Promise((t,i)=>{R.postMessage({method:"remove",params:[e],callback:c.makeCallback(O(t,i))})})}removeThumbs(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.removeThumbs using callback");return new Promise((i,o)=>{R.postMessage({method:"removeThumbs",params:[e,t],callback:c.makeCallback(O(i,o))})})}removeFileAndThumbs(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.removeFileAndThumbs using callback");return new Promise((i,o)=>{R.postMessage({method:"removeFileAndThumbs",params:[e,t],callback:c.makeCallback(O(i,o))})})}move(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.move using callback");return new Promise((i,o)=>{R.postMessage({method:"move",params:[e,t],callback:c.makeCallback(O(i,o))})})}moveToLocal(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.moveToLocal using callback");return new Promise((i,o)=>{R.postMessage({method:"moveToLocal",params:[e,t],callback:c.makeCallback(O(i,o))})})}moveFromLocal(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.moveFromLocal using callback");return new Promise((i,o)=>{R.postMessage({method:"moveFromLocal",params:[e,t],callback:c.makeCallback(O(i,o))})})}copyFromLocal(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.copyFromLocal using callback");return new Promise((i,o)=>{R.postMessage({method:"copyFromLocal",params:[e,t],callback:c.makeCallback(O(i,o))})})}copyFromCloud(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.copyFromCloud using callback");return new Promise((i,o)=>{R.postMessage({method:"copyFromCloud",params:[e,t],callback:c.makeCallback(O(i,o))})})}copyToLocal(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.copyToLocal using callback");return new Promise((i,o)=>{R.postMessage({method:"copyToLocal",params:[e,t],callback:c.makeCallback(O(i,o))})})}importFile(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.importFile using callback");return new Promise((i,o)=>{R.postMessage({method:"importFile",params:[e,t],callback:c.makeCallback(O(i,o))})})}importFileWithName(e,t,i,o){if("function"==typeof o)throw new Error("NinoxCloudFileSystem.importFileWithName using callback");return new Promise((o,n)=>{R.postMessage({method:"importFileWithName",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}downloadFile(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.downloadFile using callback");return new Promise((i,o)=>{R.postMessage({method:"downloadFile",params:[e,t],callback:c.makeCallback(O(i,o))})})}importData(e,t,i){if("function"==typeof i)throw new Error("NinoxCloudFileSystem.importData using callback");return new Promise((i,o)=>{R.postMessage({method:"importData",params:[e,t],callback:c.makeCallback(O(i,o))})})}startDownload(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.startDownload using callback");return new Promise((t,i)=>{R.postMessage({method:"startDownload",params:[e],callback:c.makeCallback(O(t,i))})})}startDownloadAll(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.startDownloadAll using callback");return new Promise((t,i)=>{R.postMessage({method:"startDownloadAll",params:[e],callback:c.makeCallback(O(t,i))})})}evict(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.evict using callback");return new Promise((t,i)=>{R.postMessage({method:"evict",params:[e],callback:c.makeCallback(O(t,i))})})}fileURL(e,t){if("function"==typeof t)throw new Error("NinoxCloudFileSystem.fileURL using callback");return new Promise((t,i)=>{R.postMessage({method:"fileURL",params:[e],callback:c.makeCallback(O(t,i))})})}isAvailable(){return!!this.propUbiquityUrl}reconnect(e){if("function"==typeof e)throw new Error("NinoxCloudFileSystem.reconnect using callback");return new Promise((e,t)=>{R.postMessage({method:"reconnect",callback:c.makeCallback(O(e,t))})})}thumbURL(e,t,i,o){if("function"==typeof o)throw new Error("NinoxCloudFileSystem.thumbURL using callback");return new Promise((o,n)=>{R.postMessage({method:"thumbURL",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}clientId(){return this.propClientId}ubiquityUrl(){return this.propUbiquityUrl}proxyUbiquityUrl(){return this.propProxyUbiquityUrl}ensureLatestThumbnails(e){return new Promise((t,i)=>{R.postMessage({method:"ensureLatestThumbnails",params:[e],callback:c.makeCallback(O(t,i))})})}}const j=new L;var A,P;window.cloudFileSystem=j,Object(l.a)(null===(A=window.webkit)||void 0===A||null===(P=A.messageHandlers)||void 0===P?void 0:P.NativeLocalFileSystem);const U=window.webkit.messageHandlers.NativeLocalFileSystem;class H{constructor(){r()(this,"documentDirectory",""),r()(this,"proxyDocumentDirectory","")}initWithNative(){return new Promise(e=>{U.postMessage({method:"fetchNativeProperties",callback:c.makeCallback((t,i)=>{this.documentDirectory=i.documentDirectory.replace(/\/$/,""),this.proxyDocumentDirectory=i.proxyDocumentDirectory.replace(/\/$/,""),e()})})})}getDocumentDirectory(){return this.documentDirectory}getDocumentDirectoryProxy(){return this.proxyDocumentDirectory}openForAppend(e,t){if(t&&"function"==typeof t)throw new Error("openForAppend using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"openForAppend",params:[e],callback:c.makeCallback(O(t,i))})})}write(e,t,i){if(i&&"function"==typeof i)throw new Error("write using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"write",params:[e,t],callback:c.makeCallback(O(i,o))})})}close(e,t){if(t&&"function"==typeof t)throw new Error("close using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"close",params:[e],callback:c.makeCallback(O(t,i))})})}truncate(e,t){if(t&&"function"==typeof t)throw new Error("truncate using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"truncate",params:[e],callback:c.makeCallback(O(t,i))})})}readFile(e,t,i){if(i&&"function"==typeof i)throw new Error("readFile using callback"+i.toString());return new Promise("utf8"===t?(t,i)=>{const o=this.proxyDocumentDirectory+"/"+Object(y.a)(e),n=$.get(o,()=>{t(n.responseText)}).fail(()=>{i("Failed to load "+e+": "+n.responseText)})}:(i,o)=>{U.postMessage({method:"readFile",params:[e,t],callback:c.makeCallback(O(i,o))})})}writeFile(e,t,i,o){if(o&&"function"==typeof o)throw new Error("writeFile using callback"+o.toString());return new Promise((o,n)=>{U.postMessage({method:"writeFile",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}writeURL(e,t,i,o){if(o&&"function"==typeof o)throw new Error("writeURL using callback"+o.toString());return new Promise((o,n)=>{U.postMessage({method:"writeURL",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}writeFileBase64(e,t,i){if(i&&"function"==typeof i)throw new Error("writeFileBase64 using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"writeFileBase64",params:[e,t],callback:c.makeCallback(O(i,o))})})}writeURLBase64(e,t,i){if(i&&"function"==typeof i)throw new Error("writeURLBase64 using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"writeURLBase64",params:[e,t],callback:c.makeCallback(O(i,o))})})}mkdir(e,t){if(t&&"function"==typeof t)throw new Error("mkdir using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"mkdir",params:[e],callback:c.makeCallback(O(t,i))})})}readURL(e,t,i){if(i&&"function"==typeof i)throw new Error("readURL using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"readURL",params:[e,t],callback:c.makeCallback(O(i,o))})})}readURLBase64(e,t){if(t&&"function"==typeof t)throw new Error("readURLBase64 using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"readURLBase64",params:[e],callback:c.makeCallback(O(t,i))})})}listFileURLs(e,t){if(t&&"function"==typeof t)throw new Error("listFileURLs using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"listFileURLs",params:[e],callback:c.makeCallback(O(t,i))})})}listFiles(e,t){if(t&&"function"==typeof t)throw new Error("listFiles using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"listFiles",params:[e],callback:c.makeCallback(O(t,i))})})}listFilesAll(e,t){if(t&&"function"==typeof t)throw new Error("listFilesAll using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"listFilesAll",params:[e],callback:c.makeCallback(O(t,i))})})}countFiles(e,t,i){if(i&&"function"==typeof i)throw new Error("countFiles using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"countFiles",params:[e,t],callback:c.makeCallback(O(i,o))})})}exists(e,t){if(t&&"function"==typeof t)throw new Error("exists using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"exists",params:[e],callback:c.makeCallback(O(t,i))})})}stats(e,t){if(t&&"function"==typeof t)throw new Error("stats using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"stats",params:[e],callback:c.makeCallback(O(t,i))})})}ensureDirectory(e,t){if(t&&"function"==typeof t)throw new Error("ensureDirectory using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"ensureDirectory",params:[e],callback:c.makeCallback(O(t,i))})})}remove(e,t){if(t&&"function"==typeof t)throw new Error("remove using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"remove",params:[e],callback:c.makeCallback(O(t,i))})})}remove2(e,t){if(t&&"function"==typeof t)throw new Error("remove2 using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"remove2",params:[e],callback:c.makeCallback(O(t,i))})})}removeFileAndThumbs(e,t,i){if(i&&"function"==typeof i)throw new Error("removeFileAndThumbs using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"removeFileAndThumbs",params:[e,t],callback:c.makeCallback(O(i,o))})})}removeFileAndThumbsBatched(e,t){if(t&&"function"==typeof t)throw new Error("removeFileAndThumbsBatched using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"removeFileAndThumbsBatched",params:[e],callback:c.makeCallback(O(t,i))})})}removeThumbs(e,t,i){if(i&&"function"==typeof i)throw new Error("removeThumbs using callback"+i.toString());return new Promise((e,i)=>{U.postMessage({method:"removeThumbs",params:[name,t],callback:c.makeCallback(O(e,i))})})}removeURL(e,t){if(t&&"function"==typeof t)throw new Error("removeURL using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"removeURL",params:[e],callback:c.makeCallback(O(t,i))})})}move(e,t,i){if(i&&"function"==typeof i)throw new Error("move using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"move",params:[e,t],callback:c.makeCallback(O(i,o))})})}copy(e,t,i){if(i&&"function"==typeof i)throw new Error("copy using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"copy",params:[e,t],callback:c.makeCallback(O(i,o))})})}copyURL(e,t,i){if(i&&"function"==typeof i)throw new Error("copyURL using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"copyURL",params:[e,t],callback:c.makeCallback(O(i,o))})})}importFile(e,t,i){if(i&&"function"==typeof i)throw new Error("importFile using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"importFile",params:[e,t],callback:c.makeCallback(O(i,o))})})}importFileWithName(e,t,i,o){if(o&&"function"==typeof o)throw new Error("importFileWithName using callback"+o.toString());return new Promise((o,n)=>{U.postMessage({method:"importFileWithName",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}downloadFile(e,t,i){if(i&&"function"==typeof i)throw new Error("downloadFile using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"downloadFile",params:[e,t],callback:c.makeCallback(O(i,o))})})}importData(e,t,i){if(i&&"function"==typeof i)throw new Error("importData using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"importData",params:[e,t],callback:c.makeCallback(O(i,o))})})}fileURL(e,t){if(t&&"function"==typeof t)throw new Error("fileURL using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"fileURL",params:[e],callback:c.makeCallback(O(t,i))})})}fileURLProxy(e,t){if(t&&"function"==typeof t)throw new Error("fileURL using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"fileURLProxy",params:[e],callback:c.makeCallback(O(t,i))})})}tempURL(e,t){if(t&&"function"==typeof t)throw new Error("tempURL using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"tempURL",params:[e],callback:c.makeCallback(O(t,i))})})}resourceURL(e,t,i){if(i&&"function"==typeof i)throw new Error("resourceURL using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"resourceURL",params:[e,t],callback:c.makeCallback(O(i,o))})})}fontURL(e,t){if(t&&"function"==typeof t)throw new Error("fontURL using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"fontURL",params:[e],callback:c.makeCallback(O(t,i))})})}cancelTask(e,t){if(t&&"function"==typeof t)throw new Error("cancelTask using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"cancelTask",params:[e],callback:c.makeCallback(O(t,i))})})}download(){throw new Error("Use await execTask(await getDownloadTask()) instead")}getDownloadTask(e,t,i){return new Promise((o,n)=>{U.postMessage({method:"getDownloadTask",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}executeDownloadTask(e){return new Promise((t,i)=>{U.postMessage({method:"executeDownloadTask",params:[e],callback:c.makeCallback((e,o,n)=>{if(e)return i(e);t({code:o,destName:n})})})})}upload(){throw new Error("Use await execTask(await getDownloadTask()) instead")}getUploadTask(e,t,i){return new Promise((o,n)=>{U.postMessage({method:"getUploadTask",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}executeUploadTask(e){return new Promise((t,i)=>{U.postMessage({method:"executeUploadTask",params:[e],callback:c.makeCallback((e,o)=>{if(e)return i(e);t(o)})})})}cachedURL(e,t,i){if(i&&"function"==typeof i)throw new Error("cachedURL using callback"+i.toString());return new Promise((i,o)=>{U.postMessage({method:"cachedURL",params:[e,t],callback:c.makeCallback(O(i,o))})})}tempFile(e,t){if(t&&"function"==typeof t)throw new Error("tempFile using callback"+t.toString());return new Promise((t,i)=>{U.postMessage({method:"tempFile",params:[e],callback:c.makeCallback(O(t,i))})})}thumbURL(e,t,i,o){if(o&&"function"==typeof o)throw new Error("thumbURL using callback"+o.toString());return new Promise((o,n)=>{U.postMessage({method:"thumbURL",params:[e,t,i],callback:c.makeCallback(O(o,n))})})}ensureLatestThumbnails(e){return new Promise((t,i)=>{U.postMessage({method:"ensureLatestThumbnails",params:[e],callback:c.makeCallback(O(t,i))})})}}const z=new H;var V,W;window.localFileSystem=z,Object(l.a)(null===(V=window.webkit)||void 0===V||null===(W=V.messageHandlers)||void 0===W?void 0:W.NativeNinoxPrint);const B=window.webkit.messageHandlers.NativeNinoxPrint;class q{previewPDFDocumentRich(e){B.postMessage({method:"previewPDFDocumentRich",params:[e]})}savePDFDocumentRich(e,t){B.postMessage({method:"savePDFDocumentRich",params:[e],callback:c.makeCallback(t)})}previewPDFDocument(e){B.postMessage({method:"previewPDFDocument",params:[e]})}}const Y=new q;var X,G;window.NinoxPrint=Y,Object(l.a)(null===(X=window.webkit)||void 0===X||null===(G=X.messageHandlers)||void 0===G?void 0:G.NativeNinoxZIP);const J=window.webkit.messageHandlers.NativeNinoxZIP,K=(e,t)=>(i,...o)=>{i?t(i):e(...o)};class Q{unzip(e,t,i){return console.log("NinoxZIP.unzip"),"function"==typeof i?(console.warn("NinoxZIP.unzip using callback",i.toString()),J.postMessage({method:"unzip",params:[e,t],callback:c.makeCallback(i)})):new Promise((i,o)=>{J.postMessage({method:"unzip",params:[e,t],callback:c.makeCallback(K(i,o))})})}zip(e,t,i){return console.log("NinoxZIP.zip"),"function"==typeof i?(console.warn("NinoxZIP.zip using callback",i.toString()),J.postMessage({method:"zip",params:[e,t],callback:c.makeCallback(i)})):new Promise((i,o)=>{J.postMessage({method:"zip",params:[e,t],callback:c.makeCallback(K(i,o))})})}}const Z=new Q;var ee,te;function ie(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function oe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(i),!0).forEach((function(t){r()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ie(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}window.NinoxZIP=Z,Object(l.a)(null===(ee=window.webkit)||void 0===ee||null===(te=ee.messageHandlers)||void 0===te?void 0:te.NativeNinoxCalendar);const ne=window.webkit.messageHandlers.NativeNinoxCalendar,ae=(e,t)=>(i,...o)=>{if(i)return t(i);e(...o)};class se{enableCalendarSync(e){return console.log("NativeInterface -> NinoxCalendar.enableCalendarSync"),"function"==typeof e?(console.warn("NinoxCalendar.enableCalendarSync --\x3e using callback",e.toString()),ne.postMessage({method:"enableCalendarSync",callback:c.makeCallback(e)})):new Promise((e,t)=>{ne.postMessage({method:"enableCalendarSync",callback:c.makeCallback(ae(e,t))})})}calendarForDatabase(e,t){return console.log("NativeInterface -> NinoxCalendar.calendarForDatabase"),"function"==typeof t?(console.warn("NinoxCalendar.calendarForDatabase --\x3e using callback",t.toString()),ne.postMessage({method:"calendarForDatabase",params:[e],callback:c.makeCallback(t)})):new Promise((t,i)=>{ne.postMessage({method:"calendarForDatabase",params:[e],callback:c.makeCallback(ae(t,i))})})}removeEvents(e,t,i){console.log("NativeInterface -> NinoxCalendar.removeEvents"),ne.postMessage({method:"removeEvents",params:[e,t,i]})}removeEvent(e,t){console.log("NativeInterface -> NinoxCalendar.removeEvent"),ne.postMessage({method:"removeEvent",params:[e,t]})}addEvent(e,t,i,o,n,a){return console.log("NativeInterface -> NinoxCalendar.addEvent"),"function"==typeof a?(console.warn("NinoxCalendar.addEvent --\x3e using callback",a.toString()),ne.postMessage({method:"addEvent",params:[e,t,i,o,n],callback:c.makeCallback(a)})):new Promise((a,s)=>{ne.postMessage({method:"addEvent",params:[e,t,i,o,n],callback:c.makeCallback(ae(a,s))})})}addEvent2(e,t,i,o,n,a){return console.log("NativeInterface -> NinoxCalendar.addEvent2"),"function"==typeof a?(console.warn("NinoxCalendar.addEvent2 --\x3e using callback",a.toString()),ne.postMessage({method:"addEvent2",params:[e,t,i,o,n],callback:c.makeCallback(a)})):new Promise((a,s)=>{ne.postMessage({method:"addEvent2",params:[e,t,i,o,n],callback:c.makeCallback(ae(a,s))})})}addReminder2(e,t,i,o,n){return console.log("NativeInterface -> NinoxCalendar.addReminder2"),"function"==typeof n?(console.warn("NinoxCalendar.addReminder2 --\x3e using callback",n.toString()),ne.postMessage({method:"addReminder2",params:[e,t,i,o],callback:c.makeCallback(n)})):new Promise((n,a)=>{ne.postMessage({method:"addReminder2",params:[e,t,i,o],callback:c.makeCallback(ae(n,a))})})}commit(e){return console.log("NativeInterface -> NinoxCalendar.commit"),"function"==typeof e?(console.warn("NinoxCalendar.commit --\x3e using callback",e.toString()),ne.postMessage({method:"commit",callback:c.makeCallback(e)})):new Promise((e,t)=>{ne.postMessage({method:"commit",callback:c.makeCallback(ae(e,t))})})}getSources(e){return console.log("NativeInterface -> NinoxCalendar.getSources"),"function"==typeof e?(console.warn("NinoxCalendar.getSources --\x3e using callback",e.toString()),ne.postMessage({method:"getSources",callback:c.makeCallback(e)})):new Promise((e,t)=>{ne.postMessage({method:"getSources",callback:c.makeCallback(ae(e,t))})})}loadCalendar(e,t,i){return console.log("NativeInterface -> NinoxCalendar.loadCalendar"),"function"==typeof i?(console.warn("NinoxCalendar.loadCalendar --\x3e using callback",i.toString()),ne.postMessage({method:"loadCalendar",params:[e,t],callback:c.makeCallback(i)})):new Promise((i,o)=>{ne.postMessage({method:"loadCalendar",params:[e,t],callback:c.makeCallback(ae(i,o))})})}getEventCalendar(e,t){return console.log("NativeInterface -> NinoxCalendar.getEventCalendar"),"function"==typeof t?(console.warn("NinoxCalendar.getEventCalendar --\x3e using callback",t.toString()),ne.postMessage({method:"getEventCalendar",params:[e],callback:c.makeCallback(t)})):new Promise((t,i)=>{ne.postMessage({method:"getEventCalendar",params:[e],callback:c.makeCallback(ae(t,i))})})}getReminderCalendar(e,t){return console.log("NativeInterface -> NinoxCalendar.getReminderCalendar"),"function"==typeof t?(console.warn("NinoxCalendar.getReminderCalendar --\x3e using callback",t.toString()),ne.postMessage({method:"getReminderCalendar",params:[e],callback:c.makeCallback(t)})):new Promise((t,i)=>{ne.postMessage({method:"getReminderCalendar",params:[e],callback:c.makeCallback(ae(t,i))})})}loadEvents(e,t,i,o){console.log("NativeInterface -> NinoxCalendar.loadEvents");const n=e=>e.map(e=>oe({},e,{to:new Date(1e3*e.to),from:new Date(1e3*e.from)}));if("function"==typeof o){const a=(e,t)=>{if(e)return o(e);o(void 0,n(t))};return console.warn("NinoxCalendar.loadEvents --\x3e using callback",o.toString()),ne.postMessage({method:"loadEvents",params:[e,t,i],callback:c.makeCallback(a)})}return new Promise((o,a)=>{ne.postMessage({method:"loadEvents",params:[e,t,i],callback:c.makeCallback((e,t)=>{e?a(e):o(n(t))})})})}}const re=new se;window.NinoxCalendar=re;class le{constructor(e,t){r()(this,"pointer",void 0),r()(this,"nativeDBMS",void 0),this.pointer=e,this.nativeDBMS=t}syncInit(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"syncInit",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}exec(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"exec",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}execBatched(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"execBatched",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}exec2(e,t){return new Promise((i,o)=>{this.nativeDBMS.postMessage({method:"exec2",params:[this.pointer,e,t],callback:c.makeCallback(O(i,o))})})}exec2Batched(e,t){return new Promise((i,o)=>{this.nativeDBMS.postMessage({method:"exec2Batched",params:[this.pointer,e,t],callback:c.makeCallback(O(i,o))})})}exec3(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"exec3",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}insert(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"insert",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}insertBatched(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"insertBatched",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}query(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"query",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}query2(e,t){return new Promise((i,o)=>{this.nativeDBMS.postMessage({method:"query2",params:[this.pointer,e,t],callback:c.makeCallback(O(i,o))})})}queryScalar(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"queryScalar",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}queryScalar2(e,t){return new Promise((i,o)=>{this.nativeDBMS.postMessage({method:"queryScalar2",params:[this.pointer,e,t],callback:c.makeCallback(O(i,o))})})}queryOne(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"queryOne",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}queryOne2(e,t){return new Promise((i,o)=>{this.nativeDBMS.postMessage({method:"queryOne2",params:[this.pointer,e,t],callback:c.makeCallback(O(i,o))})})}queryOneScalar(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"queryOneScalar",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}queryOneScalar2(e,t){return new Promise((i,o)=>{this.nativeDBMS.postMessage({method:"queryOneScalar2",params:[this.pointer,e,t],callback:c.makeCallback(O(i,o))})})}setSchema(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"setSchema",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}queryNodes2(e){return new Promise((t,i)=>{this.nativeDBMS.postMessage({method:"queryNodes2",params:[this.pointer,e],callback:c.makeCallback(O(t,i))})})}}var ce,de;Object(l.a)(null===(ce=window.webkit)||void 0===ce||null===(de=ce.messageHandlers)||void 0===de?void 0:de.NativeNinoxSQLDBMS);const he=window.webkit.messageHandlers.NativeNinoxSQLDBMS;class pe{open(e,t){return new Promise((i,o)=>{he.postMessage({method:"open",callback:c.makeCallback((e,t)=>{if(e)return o(e);i(new le(t,he))}),params:[e,t]})})}close(e){return new Promise((t,i)=>{he.postMessage({method:"close",callback:c.makeCallback(e=>{if(e)return i(e);t()}),params:[e.pointer]})})}}const ue=new pe;var fe,me;window.NinoxSQLDBMS=ue,Object(l.a)(null===(fe=window.webkit)||void 0===fe||null===(me=fe.messageHandlers)||void 0===me?void 0:me.NativeNinoxDocumentInteraction);const ge=window.webkit.messageHandlers.NativeNinoxDocumentInteraction;class ve{constructor(){r()(this,"propAllUserDefaults",void 0),r()(this,"propGroupingSeparator",void 0),r()(this,"propDefaultDecimalSymbolIsComma",void 0),r()(this,"propDecimalSeparator",void 0),r()(this,"propWeekStartMonday",void 0),r()(this,"propFirstDayOfWeek",void 0),r()(this,"propDateFormat",void 0),r()(this,"propTimeFormat",void 0),r()(this,"propDateTimeFormat",void 0),r()(this,"propAvailableFontFamilies",void 0),r()(this,"propIsOnline",!0)}initWithNative(){return new Promise(e=>{ge.postMessage({method:"fetchNativeProperties",callback:c.makeCallback((t,i)=>{if(t)return console.info("Error while getting all user defaults",t),e(void 0);this.propIsOnline=i.isOnline,this.propAllUserDefaults=i.userDefaults,this.propGroupingSeparator=i.groupingSeparator,this.propDefaultDecimalSymbolIsComma=i.defaultDecimalSymbolIsComma,this.propDecimalSeparator=i.decimalSeparator,this.propWeekStartMonday=i.weekStartMonday,this.propFirstDayOfWeek=i.firstDayOfWeek,this.propDateFormat=i.dateFormat,this.propTimeFormat=i.timeFormat,this.propDateTimeFormat=i.dateTimeFormat,this.propAvailableFontFamilies=i.availableFontFamilies,e(void 0)})})})}showActivityIndicator(){ge.postMessage({method:"showActivityIndicator"})}hideActivityIndicator(){ge.postMessage({method:"hideActivityIndicator"})}openBrowser(e){ge.postMessage({method:"openBrowser",params:[e]})}chooseFile(e){ge.postMessage({method:"chooseFile",callback:c.makeCallback(e)})}previewDocument(e,t){ge.postMessage({method:"previewDocument",params:[e],callback:c.makeCallback(t)})}getUserDefault(e){return Object(l.a)(this.propAllUserDefaults),this.propAllUserDefaults[e]}setUserDefault(e,t){Object(l.a)(this.propAllUserDefaults),this.propAllUserDefaults[e]=t,ge.postMessage({method:"setUserDefault",params:[e,t]})}groupingSeparator(){return this.propGroupingSeparator}defaultDecimalSymbolIsComma(){return this.propDefaultDecimalSymbolIsComma}decimalSeparator(){return this.propDecimalSeparator}weekStartMonday(){return this.propWeekStartMonday}firstDayOfWeek(){return this.propFirstDayOfWeek}dateFormat(){return this.propDateFormat}timeFormat(){return this.propTimeFormat}dateTimeFormat(){return this.propDateTimeFormat}availableFontFamilies(){return this.propAvailableFontFamilies}openMap(e,t){ge.postMessage({method:"openMap",params:[e],callback:c.makeCallback(t)})}execCut(){ge.postMessage({method:"execCut"})}execCopy(){ge.postMessage({method:"execCopy"})}execPaste(){ge.postMessage({method:"execPaste"})}coordinatesForAddress(e,t){ge.postMessage({method:"coordinatesForAddress",params:[e],callback:c.makeCallback(t)})}isOnline(e){if(e)throw new Error("Call it synchronously");return this.propIsOnline}setIsOnline(e){this.propIsOnline=e}setWindowTitle(e){ge.postMessage({method:"setWindowTitle",params:[e]})}}var ye,be;Object(l.a)(null===(ye=window.webkit)||void 0===ye||null===(be=ye.messageHandlers)||void 0===be?void 0:be.NativeNinoxDocumentInteraction);const we=window.webkit.messageHandlers.NativeNinoxDocumentInteraction;class xe extends ve{chooseFileWithExtensions(e,t){we.postMessage({method:"chooseFileWithExtensions",params:[e],callback:c.makeCallback(t)})}saveFile(e,t,i){we.postMessage({method:"saveFile",params:[e,t],callback:c.makeCallback(i)})}}const Te=new xe;var Ce,ke;window.NinoxDocumentInteraction=Te,Object(l.a)(null===(Ce=window.webkit)||void 0===Ce||null===(ke=Ce.messageHandlers)||void 0===ke?void 0:ke.NativeNinoxUndoManager);const $e=window.webkit.messageHandlers.NativeNinoxUndoManager;class Se{execRedo(){$e.postMessage({method:"execRedo"})}execUndo(){$e.postMessage({method:"execUndo"})}cancelUndo(){$e.postMessage({method:"cancelUndo"})}canExecUndo(e){$e.postMessage({method:"canExecUndo",callback:c.makeCallback(e)})}canExecRedo(e){$e.postMessage({method:"canExecRedo",callback:c.makeCallback(e)})}pushUndoOperation(e){$e.postMessage({method:"pushUndoOperation",params:[e]})}}const _e=new Se;var Ee,De;Object(l.a)(null===(Ee=window.webkit)||void 0===Ee||null===(De=Ee.messageHandlers)||void 0===De?void 0:De.NativeNinoxViewController);const Ne=window.webkit.messageHandlers.NativeNinoxViewController,Ie=(e,t)=>(i,...o)=>{if(i)return t(i);e(...o)};class Oe{getInitializationParameters(e){Ne.postMessage({method:"getInitializationParameters",callback:c.makeCallback(e)})}clearLaunchURL(){Ne.postMessage({method:"clearLaunchURL"})}initializationDone(){Ne.postMessage({method:"initializationDone"})}isBarcodeScannerActive(e){if("function"==typeof e)throw new Error("callback passed - isBarcodeScannerActive "+e.toString());return new Promise((e,t)=>{Ne.postMessage({method:"isBarcodeScannerActive",callback:c.makeCallback(Ie(e,t))})})}enableBarcodeScanner(){Ne.postMessage({method:"enableBarcodeScanner"})}disableBarcodeScanner(){Ne.postMessage({method:"disableBarcodeScanner"})}everythingSaved(){Ne.postMessage({method:"everythingSaved"})}setNavigationProperty(e,t){Ne.postMessage({method:"setNavigationProperty",params:[e,t]})}getNavigationProperty(e,t){Ne.postMessage({method:"getNavigationProperty",params:[e],callback:c.makeCallback(t)})}clearNavigation(){Ne.postMessage({method:"clearNavigation"})}}const Me=new Oe;var Fe,Re;window.NinoxViewController=Me,Object(l.a)(null===(Fe=window.webkit)||void 0===Fe||null===(Re=Fe.messageHandlers)||void 0===Re?void 0:Re.NativeNinoxViewController);const Le=window.webkit.messageHandlers.NativeNinoxViewController;class je extends Oe{setMenuState(e){Le.postMessage({method:"setMenuState",params:[e]})}}const Ae=new je;window.NinoxViewController=Ae,function(){if("undefined"==typeof console&&(console={log:function(){},info:function(){},warn:function(){},error:function(){},trace:function(){}}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),$.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},!$.browser){var e=$.uaMatch(navigator.userAgent),t={};e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),$.browser=t}var i=window.navigator.userAgent,o=/Safari/.test(i),n=/iPad/i.test(i)||o&&document.documentElement&&null!=document.documentElement.ontouchstart,a=/iPhone/i.test(i),s=/Trident/.test(i),r=/Android/.test(i);window.NINOX_ANDROID=r,window.NINOX_IOS=n||a,window.NINOX_IPAD=n,window.NINOX_IPHONE=a,window.NINOX_IE=s,window.OSX_10_9_MODE=/OS X 10_9/.test(i),$.initTouchHandlers=function(){},$.getDevicePadding=function(){var e,t=!1,i=document.createElement("div");if(window.CSS&&window.CSS.supports("padding-bottom: env(safe-area-inset-bottom)")?(i.style.paddingBottom="env(safe-area-inset-bottom)",i.style.paddingLeft="env(safe-area-inset-left)",i.style.paddingRight="env(safe-area-inset-right)",i.style.paddingTop="env(safe-area-inset-top)",t=!0):window.CSS&&window.CSS.supports("padding-bottom: constant(safe-area-inset-bottom)")&&(i.style.paddingBottom="constant(safe-area-inset-bottom)",i.style.paddingLeft="constant(safe-area-inset-left)",i.style.paddingRight="constant(safe-area-inset-right)",i.style.paddingTop="constant(safe-area-inset-top)",t=!0),t){document.body.appendChild(i);var o=window.getComputedStyle(i);e={top:parseInt(o.paddingTop),left:parseInt(o.paddingLeft),right:parseInt(o.paddingRight),bottom:parseInt(o.paddingBottom)},document.body.removeChild(i)}else e={top:0,left:0,right:0,bottom:0};return e},window.TOUCH=window.NINOX_IOS||window.NINOX_ANDROID||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,$.initTouchHandlers(),$.fn.touch=$.fn.click,TOUCH?($(document.documentElement).addClass("touch"),$.fn.select=function(){if(this[0].setSelectionRange)try{this[0].setSelectionRange(0,9999)}catch(e){console.warn(e)}return this}):$(document.documentElement).addClass("no-touch"),$(document).keydown((function(e){13===e.which&&setTimeout((function(){var t=$(e.target);t.is("input")&&t.blur()}),0)})),window.devicePadding=$.getDevicePadding()}();i("./node_modules/script-loader/index.js!./src/lib/setprototypeof/setprototypeof.js"),i("./node_modules/script-loader/index.js!./node_modules/codemirror/lib/codemirror.js"),i("./node_modules/script-loader/index.js!./node_modules/codemirror/addon/mode/simple.js");var Pe=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),Ue=i("./src/js/printer/printTable.js");window.NINOX_VERSION="3.3.4",window.NINOX_WEB=!1,window.NINOX_APP=!0,window.NINOX_APP_MAC=!0,window.NINOX_APP_IOS=!1,window.NINOX_APP_IPHONE=!1,window.NINOX_APP_IPAD=!1,window.NINOX_PRODUCT="mac",window.NINOX_APP_ANDROID=!1,window.NINOX_APP_TAB=!1,window.NINOX_IOS=!1,window.NINOX_ENV="prod",window.xlsx=o,window.locale={},window.UNDO_IMPLEMENTATION=_e,function(e,t,i,o,n,a,s){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,a=t.createElement(i),s=t.getElementsByTagName(i)[0],a.async=1,a.src=o,s.parentNode.insertBefore(a,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-46256641-1","auto");const He={userEnvName:"mac",alert:(e,t)=>$.alert(e,t),loading:e=>$.loading(e),dialog:(e,t,i,o)=>{$.dialog({caption:e,message:t,buttons:i,zIndex:void 0})},openRecord:(e,t)=>ui.openRecord(e,t),popupRecord:(e,t)=>ui.popupRecord(e,t),openTable:(e,t,i,o)=>ui.openTable(e,t,i,o),closeRecord:()=>ui.closeRecord(),closeAllRecords:()=>ui.closeAllRecords(),openFullScreen:(e,t,i)=>ui.openFullscreen(e,t,i),closeFullScreen:()=>ui.closeFullscreen(),openDesigner:e=>{"undefined"!=typeof reports&&reports.openDesigner(e)},printTable:e=>Object(Ue.a)(e),sendEmail:(e,t)=>{database.sendEmail?database.sendEmail(e,e=>{e&&$.alert(e),t(e?String(e):void 0)}):t("Not supported on client side")},previewDocument:NinoxDocumentInteraction.previewDocument.bind(NinoxDocumentInteraction),barcodeScan:NinoxDocumentInteraction.barcodeScan?NinoxDocumentInteraction.barcodeScan.bind(NinoxDocumentInteraction):e=>"function"==typeof e?e(null,""):void 0,addCalendarEvent:NinoxCalendar.addEvent2.bind(NinoxCalendar),addCalendarReminder:NinoxCalendar.addReminder2.bind(NinoxCalendar),httpProvider:(e,t)=>{$.ajax({type:e.method,url:e.url,processData:!1,data:JSON.stringify(e.body),headers:e.headers,xhrFields:{withCredentials:!(!e.headers||!e.headers.Authorization)},success:function(e,i,o){t(void 0,i,e)},error:function(e,i,o){t("Request failed: "+i+" - "+o,i,void 0)}})},ninoxDocumentInteraction:NinoxDocumentInteraction,vault:{get:()=>{}},parseXML:e=>{try{return(new window.DOMParser).parseFromString(e,"text/xml")}catch(e){return console.warn(e),""}},getAppURL:()=>{{let e=He.ninoxDocumentInteraction.getUserDefault("nx.server");return e||(e="app.ninox.com"),"https://"+e}}};(async()=>{NinoxDocumentInteraction.initWithNative&&await NinoxDocumentInteraction.initWithNative(),void 0!==z&&z.initWithNative&&await z.initWithNative(),void 0!==j&&j.initWithNative&&await j.initWithNative(),Pe.coreInit(He),window.ninoxCore=Pe,window.locale=Pe.getLocale(),window.LOCALE=Pe.getUserLanguage(),i("./src/init.js")})()},"./src/init_styles.js":function(e,t,i){"use strict";i.r(t);i("./node_modules/codemirror/lib/codemirror.css"),i("./src/css/base.css"),i("./src/css/icons.css"),i("./src/css/iconset.css"),i("./src/css/database-icons.css"),i("./src/css/ui.css"),i("./src/css/navigation.css"),i("./src/css/widgets.css"),i("./src/css/calendar.css"),i("./src/css/charts.css"),i("./src/css/tables.css"),i("./src/css/admin.css"),i("./src/css/home.css"),i("./src/css/root_2.css"),i("./src/css/reports.css"),i("./node_modules/@zhyabs1314/react-image-lightbox/style.css"),i("./src/lib/jqueryui/ui-lightness/jquery-ui-1.10.4.custom.min.css"),i("./src/css/mac.css"),i("./src/assets/allIcons/icons-facelift.css"),i("./src/lib/nxwidgets/nxwidgets.css")},"./src/init_touch.js":function(e,t,i){window.EVENT_touchstart="touchstart",window.EVENT_touchmove="touchmove",window.EVENT_touchend="touchend",window.EVENT_target=function(e){return e.target},"undefined"!=typeof TouchEvent&&(Object.defineProperty(TouchEvent.prototype,"clientX",{get:function(){return this.touches.length?this.touches[0].clientX:this.changedTouches.length?this.changedTouches[0].clientX:0}}),Object.defineProperty(TouchEvent.prototype,"clientY",{get:function(){return this.touches.length?this.touches[0].clientY:this.changedTouches.length?this.changedTouches[0].clientY:0}}),Object.defineProperty(TouchEvent.prototype,"pageX",{get:function(){return this.touches.length?this.touches[0].pageX:this.changedTouches.length?this.changedTouches[0].pageX:0}}),Object.defineProperty(TouchEvent.prototype,"pageY",{get:function(){return this.touches.length?this.touches[0].pageY:this.changedTouches.length?this.changedTouches[0].pageY:0}}))},"./src/js/admin/AdminField.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return C}));var o=i("./node_modules/react/index.js"),n=i("./node_modules/react-dom/index.js"),a=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),s=i.n(a),r=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),l=i("./node_modules/react-sortable-hoc/dist/react-sortable-hoc.umd.js"),c=i("./node_modules/seamless-scroll-polyfill/dist/es5/seamless.js"),d=(i("./src/react/ChoiceEditorList.css"),i("./src/react/util/commons.ts")),h=i("./src/react/util/FastClickContainer.tsx"),p=i("./src/react/util/PositionedBackplane.tsx");const u=Object(l.SortableHandle)(()=>o.createElement("div",{style:{position:"relative"}},o.createElement("div",{className:"i-32-24 i-lighter-grey i-drag-handle"}))),f=Object(l.SortableElement)(({id:e,children:t})=>o.createElement("div",{id:e},t)),m=Object(l.SortableContainer)(({className:e,innerRef:t,children:i})=>o.createElement("div",{ref:t,className:e},i));class g extends o.Component{constructor(e){super(e),s()(this,"container",void 0),s()(this,"handleReorder",e=>{e.newIndex!==e.oldIndex&&this.props.onReorder(e.oldIndex,e.newIndex)}),s()(this,"handleRowChange",()=>{"NEW_INDEX"!==this.state.selectedIndex&&null!==this.state.selectedIndex&&this.props.onRowChange(this.state.currentText,this.state.selectedIndex)}),s()(this,"handleCreateValue",()=>{this.props.onCreateValue(this.state.currentText)}),s()(this,"keydown",(e,t)=>{if(null!==this.state.selectedIndex)switch(e.key){case"Tab":"NEW_INDEX"!==this.state.selectedIndex&&(e.preventDefault(),t(),this.moveToNextElement(this.state.selectedIndex));break;case"Enter":e.preventDefault(),this.setState({selectedIndex:null}),t();break;case"Escape":e.preventDefault(),this.setState({selectedIndex:null});break;case"ArrowUp":"NEW_INDEX"!==this.state.selectedIndex&&(e.preventDefault(),t(),this.moveToPreviousElement(this.state.selectedIndex));break;case"ArrowDown":"NEW_INDEX"!==this.state.selectedIndex&&(e.preventDefault(),this.moveToNextElement(this.state.selectedIndex),t())}}),s()(this,"handleDeleteClick",()=>{"NEW_INDEX"!==this.state.selectedIndex&&null!==this.state.selectedIndex&&this.props.onDeleteValueClick(this.props.rows[this.state.selectedIndex].id),this.setState({selectedIndex:null})}),s()(this,"handleAddItem",e=>{this.setState({selectedIndex:"NEW_INDEX",currentText:"",selectedElement:h.b.getTarget(e)})}),this.state={selectedIndex:null,currentText:"",selectedElement:null},this.container=o.createRef()}componentDidUpdate(e){this.props.rows.length>e.rows.length&&c.elementScrollBy(this.container.current,{top:this.container.current.scrollHeight,behavior:"smooth"})}render(){return o.createElement(o.Fragment,null,o.createElement("div",{className:"ChoiceEditorList_root"},o.createElement(m,{innerRef:this.container,useDragHandle:!0,axis:"y",lockAxis:"y",lockToContainerEdges:!0,onSortEnd:this.handleReorder,helperClass:"ChoiceEditorList_helperClass",className:"ChoiceEditorList_listContainer"},r.util.localeSortBy(this.props.rows,"order").map((e,t)=>o.createElement(f,{key:e.id,index:t,id:g.TARGET_ID+t},o.createElement(h.a,{onFastClick:i=>{const o=h.b.getTarget(i);this.setState({selectedIndex:t,currentText:e.caption,selectedElement:o.closest("#"+g.TARGET_ID+t)})},className:"choiceeditor-item"},o.createElement(h.a,{onFastClick:t=>{this.props.onColorClick(t,e)},className:"choiceeditor-item-color ",style:{background:e.color?e.color:void 0,color:e.textColor?e.textColor:void 0}}),o.createElement(h.a,{onFastClick:t=>this.props.onIconClick(t,e),className:"choiceeditor-item-icon "+(e.icon?"ic ic-"+e.icon:"")}),o.createElement("div",{className:"choiceeditor-item-label"},e.caption||""),o.createElement("div",{className:"choiceeditor-item-id"},e.id),o.createElement(u,null))))),this.newValBackplane(),o.createElement("div",{className:"ChoiceEditorList_buttonContainer",style:{padding:4}},o.createElement(h.a,{className:"ChoiceEditorList_addButton button text blue float-left",onFastClick:this.handleAddItem,style:{margin:0,width:this.props.rows.length>1?"":"100%",textAlign:"center"}},o.createElement("div",{className:"icon-big-white icon-big-add"}),o.createElement("span",null,Object(r.getLocale)().choiceAddValue)))),this.props.rows.length>1?o.createElement("div",{className:"ChoiceEditorList_sortButtonContainer"},o.createElement(h.a,{className:"button",onFastClick:this.props.onSortAscClick},o.createElement("div",{className:"icon-big-black icon-big-sort-asc"})),o.createElement(h.a,{className:"button",onFastClick:this.props.onSortDescClick},o.createElement("div",{className:"icon-big-black icon-big-sort-desc"}))):null)}resetState(){this.setState({selectedIndex:null,currentText:""})}newValBackplane(){return o.createElement(p.a,{show:null!==this.state.selectedIndex,clickTarget:this.state.selectedElement,settings:"NEW_INDEX"===this.state.selectedIndex?{style:"tooltip",arrowColor:"white"}:{style:"overlay"},className:"ChoiceEditorList_editContainer",onClick:()=>{"NEW_INDEX"===this.state.selectedIndex?""!==this.state.currentText&&this.props.onCreateValue(this.state.currentText):this.handleRowChange(),this.resetState()}},"NEW_INDEX"!==this.state.selectedIndex?this.editRow(this.handleRowChange):this.editRow(this.handleCreateValue))}moveToNextElement(e){const t=e+1;t<this.props.rows.length&&this.setState(e=>{const i=null===e.selectedElement?null:Object(d.c)(e.selectedElement,g.TARGET_ID+t);return this.scrollToSibling(i),{selectedIndex:t,currentText:this.props.rows[t].caption,selectedElement:i}})}moveToPreviousElement(e){const t=e-1;t>=0&&this.setState(e=>{const i=null===e.selectedElement?null:Object(d.d)(e.selectedElement,g.TARGET_ID+t);return this.scrollToSibling(i),{selectedIndex:t,currentText:this.props.rows[t].caption,selectedElement:i}})}scrollToSibling(e){null!==e&&c.elementScrollIntoView(e,{block:"nearest",behavior:"auto"})}editRow(e){return o.createElement("div",{className:"ChoiceEditorList_inputContainer "+("NEW_INDEX"===this.state.selectedIndex?"ChoiceEditorList_inputContainerNewRow":"")},o.createElement("input",{className:"ChoiceEditorList_input",tabIndex:0,onKeyDown:t=>this.keydown(t,e),type:"text",value:this.state.currentText,autoFocus:!0,onChange:e=>{this.setState({currentText:e.target.value})}}),o.createElement(h.a,{className:"ChoiceEditorList_trashIcon i-32-24 i-grey i-setting-trash",onFastClick:this.handleDeleteClick}))}}s()(g,"TARGET_ID","ChoiceEditorList_backplaneTarget");i("./node_modules/underscore/underscore.js");var v=i("./src/js/widgets/editors/ColorSelector.js"),y=i("./src/js/widgets/editors/IconSelector.js");function b(e,t,i){this.field=t,$('<label class="choiceeditor-values-label">').text(locale.choiceValues).appendTo(i),this.$values=$('<div class="choiceeditor-values">').appendTo(i),this.updateUI()}b.prototype.resizeHeight=function(e){this.$values.css("height",e-72)},b.prototype.destroy=function(){},b.prototype.updateUI=function(){const e=util.sortBy(this.field.getValues(),"order");n.render(o.createElement(g,{rows:e,onCreateValue:e=>{this.field.createValue().caption=e,this.changed()},onDeleteValueClick:e=>this.confirmRemove(e),onRowChange:(t,i)=>{const o=e[i];t!==o.caption&&(o.caption=t,this.changed())},onIconClick:(e,t)=>this.pickIcon(e,t),onColorClick:(e,t)=>this.pickColor(e,t),onReorder:(e,t)=>this.sorted(e,t),onSortAscClick:()=>this.sortAsc(),onSortDescClick:()=>this.sortDesc()}),this.$values[0])},b.prototype.confirmRemove=function(e){$.dialog({closable:!0,caption:locale.remove,message:locale.confirmRemoveChoiceValue,buttons:[{color:"red",caption:locale.remove,callback:()=>this.remove(e)}]})},b.prototype.remove=function(e){delete this.field.values[e],this.field.trigger("change"),this.field.schema.trigger("change"),this.updateUI()},b.prototype.pickColor=function(e,t){new v.a({$el:$(h.b.getTarget(e)),value:t.color,update:e=>{t.color=e,this.changed()}})},b.prototype.pickIcon=function(e,t){new y.a({$el:$(h.b.getTarget(e)),value:t.icon,update:e=>{t.icon=e,this.changed()}})},b.prototype.changed=function(){this.field.trigger("change"),this.field.schema.trigger("change"),this.updateUI()},b.prototype.sorted=function(e,t){const i=util.sortBy(this.field.getValues(),"order"),o=i[t].order;if(t>e)for(let o=t-1;o>=e;o--)i[o+1].order=i[o].order;else if(e>t)for(let o=t+1;o<=e;o++)i[o-1].order=i[o].order;i[e].order=o,this.field.trigger("change"),this.field.schema.trigger("change"),this.updateUI()},b.prototype.sortAsc=function(){for(var e=util.localeSortBy(this.field.values,"caption"),t=0;t<e.length;t++)e[t].order=t;this.field.trigger("change"),this.field.schema.trigger("change"),this.updateUI()},b.prototype.sortDesc=function(){for(var e=util.localeSortBy(this.field.values,"caption"),t=0;t<e.length;t++)e[t].order=e.length-1-t;this.field.trigger("change"),this.field.schema.trigger("change"),this.updateUI()};var w=i("./src/js/admin/ViewEditor.js"),x=i("./src/js/widgets/Field.js");let T=!1;class C{constructor(e,t,i){var o=this;this.field=t,this.components=[],this.$backplane=$.backplane({close:$.proxy(this.destroy,this),scrollable:!0});var n,a,s="choice"===t.base||"multi"===t.base,r=$('<div class="fieldeditor fieldeditor-'+(s?"choice":t.base)+'">').appendTo(this.$backplane).draggable({handle:".head"}),l=$('<div class="head">').mousedown(()=>l.css("background-color","rgba(199, 199, 199, 0.6)")).mouseup(()=>l.css("background-color","transparent")).appendTo(r);if(s){o.$paneContainer=$('<div class="Field_paneContainer">').appendTo(r);const e=window.getHeight()-200;n=$('<div class="pane" style="overflow:auto;max-height: '+(e-16)+'px">').appendTo(o.$paneContainer),a=$('<div class="pane2 component editor choiceeditor" style="padding-bottom: 32px; display: flex;display: -webkit-flex; flex-direction: column; -webkit-flex-direction: column; height:'+e+'px">').appendTo(o.$paneContainer)}else n=$('<div class="pane">').appendTo(r);var c,d=$('<div class="buttons">').appendTo(r);let h,p,u,f;$('<div class="nx-button-text red">').text(locale.removeField).appendTo(d).touch((function(){t.isUI?(t.type.schema.removeUI(t),o.$backplane.close((function(){o.destroy()}))):$.dialog({closable:!0,caption:locale.removeField,message:locale.removeFieldConfirm,buttons:[{color:"red",caption:locale.remove,callback:function(){t.type.schema.removeField(t),o.$backplane.close((function(){o.destroy()}))}}]})})),(t.isReverse||t.isReference)&&($('<div class="nx-hspace-small">').appendTo(d),$('<div class="nx-button-text grey">').text(locale.editColumns).appendTo(d).touch((function(){new w.a({config:{type:t.refType.id,cols:t.viewConfig.cols||[],sort:t.viewConfig.sort,descending:t.viewConfig.descending,group:t.viewConfig.group},save:function(e){var i=e.config;t.viewConfig.cols=i.cols,t.viewConfig.sort=i.sort,t.viewConfig.descending=i.descending,t.viewConfig.group=i.group,t.cachedViewConfig&&(t.cachedViewConfig=void 0),t.type.schema.trigger("change")}})}))),"view"!==t.base&&"chart"!==t.base||($('<div class="nx-hspace-small">').appendTo(d),$('<div class="nx-button-text grey">').text(locale.editColumns).appendTo(d).touch((function(){var e=t.exp&&t.exp.returnType;return e?("nid"!==e.base&&"rid"!==e.base||(e=e.type),e.isNodeType?t.exp.isMultiple()?void new w.a({config:{type:e,cols:t.viewConfig.cols||[],sort:t.viewConfig.sort,descending:t.viewConfig.descending,group:t.viewConfig.group},save:function(e){var i=e.config;t.viewConfig.cols=i.cols,t.viewConfig.sort=i.sort,t.viewConfig.descending=i.descending,t.viewConfig.group=i.group,t.type.schema.trigger("change")}}):$.alert("Expression does not return multiple records."):$.alert("Expression does not return records.")):$.alert("Please define a valid function.")}))),$('<div class="nx-hspace-flex">').appendTo(d),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(d).touch($.proxy(this.close,this)),c="ref"===t.base?locale.referenceLabelFrom+" "+t.type.caption+" "+locale.referenceLabelTo+" "+t.refType.caption+" "+locale.referenceLabelN1:"rev"===t.base?locale.referenceLabelFrom+" "+t.type.caption+" "+locale.referenceLabelTo+" "+t.refType.caption+" "+locale.referenceLabel1N:locale.types[t.base],l.append($('<div class="type-symbol-grey i-32-24 i-light-grey i-field-'+t.base+'">')).append($("<span>").text(c)),l.append($('<div class="i-32-24 i-lighter-grey i-drag-handle" style="cursor: move;position: absolute;top:21px;left:22px;">')),t.getCaptionModel&&(this.caption=this.createField(t.getCaptionModel(),n)),t.getLabelPositionModel&&this.createField(t.getLabelPositionModel(),n),t.getFunctionModel&&this.createField(t.getFunctionModel(),n),t.getStyleModel&&this.createField(t.getStyleModel(),n),t.getBGColorModel&&this.createField(t.getBGColorModel(),n),t.getButtonColorModel&&this.createField(t.getButtonColorModel(),n),(t.isField&&"fn"!==t.base||t.isReference)&&this.createField(t.getRequiredModel(),n),t.getStringDefaultModel&&this.createField(t.getStringDefaultModel(),n),t.getStringMinLengthModel&&this.createField(t.getStringMinLengthModel(),n),t.getStringMaxLengthModel&&this.createField(t.getStringMaxLengthModel(),n),t.getNumberDefaultModel&&this.createField(t.getNumberDefaultModel(),n),t.getNumberMinModel&&this.createField(t.getNumberMinModel(),n),t.getNumberMaxModel&&this.createField(t.getNumberMaxModel(),n),t.getNumberFormatModel&&this.createField(t.getNumberFormatModel(),n),t.getTimeFormatModel&&this.createField(t.getTimeFormatModel(),n),t.getDateDefaultModel&&this.createField(t.getDateDefaultModel(),n),t.getDateCalendarModel&&($("<div>").appendTo(n),this.createField(t.getDateCalendarModel(),n)),t.getDateCalendarColorModel&&this.createField(t.getDateCalendarColorModel(),n),t.getDateCalendarFormatModel&&this.createField(t.getDateCalendarFormatModel(),n),t.getDateYearlyModel&&this.createField(t.getDateYearlyModel(),n),t.getTimestampDefaultModel&&this.createField(t.getTimestampDefaultModel(),n),t.getTimeDefaultModel&&this.createField(t.getTimeDefaultModel(),n),t.getTimeintervalDefaultModel&&this.createField(t.getTimeintervalDefaultModel(),n),t.getTimeintervalFormatModel&&this.createField(t.getTimeintervalFormatModel(),n),t.getBooleanDefaultModel&&this.createField(t.getBooleanDefaultModel(),n),t.getBooleanRendererModel&&this.createField(t.getBooleanRendererModel(),n),t.getChoiceDefaultModel&&this.createField(t.getChoiceDefaultModel(),n),t.getChoiceRendererModel&&this.createField(t.getChoiceRendererModel(),n),t.getMultiDefaultModel&&this.createField(t.getMultiDefaultModel(),n),t.getMultiRendererModel&&this.createField(t.getMultiRendererModel(),n),s&&this.components.push(new b(this,t,a)),"email"===t.base&&(this.createField(t.getEmailDefaultModel(),n),this.createField(t.getEmailSubjectModel(),n),this.createField(t.getEmailBodyModel(),n)),t.getHtmlDefaultModel&&this.createField(t.getHtmlDefaultModel(),n),t.getFileHandlingModel&&this.createField(t.getFileHandlingModel(),n),t.getBGSizeModel&&this.createField(t.getBGSizeModel(),n),t.isReference&&this.createField(t.getCascadeModel(),n),t.getReferenceRendererModel&&this.createField(t.getReferenceRendererModel(),n),t.getReverseRendererModel&&this.createField(t.getReverseRendererModel(),n),"chart"===t.base&&(this.createField(t.getChartTypeModel(),n),this.createField(t.getChartDatasetsModel(),n),this.createField(t.getChartStackedModel(),n),this.createField(t.getChartLineTensionModel(),n),this.createField(t.getChartLegendModel(),n)),t.getDChoiceValuesModel&&(h=this.createField(t.getDChoiceValuesModel(),n),h.model.on("update",()=>{})),t.getDChoiceCaptionModel&&(p=this.createField(t.getDChoiceCaptionModel(),n)),t.getDChoiceColorModel&&(u=this.createField(t.getDChoiceColorModel(),n)),t.getDChoiceIconModel&&(f=this.createField(t.getDChoiceIconModel(),n));var m=$('<div class="button block" style="margin:8px">').appendTo(n),g=$("<div>").hide().appendTo(n),v=$('<div class="i-32-24 i-light-grey i-line-right">').appendTo(m);$("<span>").text(locale.showExtendedOptions).appendTo(m),m.touch(()=>{T=!T,v.toggleClass("i-line-right i-line-down"),g.toggle()}),T&&(v.toggleClass("i-line-right i-line-down"),g.show()),t.getTooltipModel&&this.createField(t.getTooltipModel(),g),t.getOnClickModel&&this.createField(t.getOnClickModel(),g),t.getReferenceFormatModel&&this.createField(t.getReferenceFormatModel(),g),t.getVisibilityModel&&this.createField(t.getVisibilityModel(),g),(t.isReference||t.isField)&&("fn"!==t.base&&this.createField(t.getAfterUpdateModel(),g),t.isReference&&this.createField(t.getConstraintModel(),g),database.supports.authentication&&(this.readRoles=new x.a(this,t.getReadRolesModel(),g),"fn"!==t.base&&this.createField(t.getWriteRolesModel(),g)),t.getCanWriteModel&&"fn"!==t.base&&this.createField(t.getCanWriteModel(),g)),database.supports.authentication&&t.isReverse&&(this.createField(t.reference.getReadRolesModel(),g),this.createField(t.reference.getWriteRolesModel(),g)),t.isReverse&&t.reference.getCanWriteModel&&this.createField(t.reference.getCanWriteModel(),g),t.getGlobalSearchModel&&this.createField(t.getGlobalSearchModel(),g),database.supports.indexes&&t.getHasIndexModel&&this.createField(t.getHasIndexModel(),g),t.getBindingModel&&this.createField(t.getBindingModel(),g),t.getBeforeShowModel&&this.createField(t.getBeforeShowModel(),g),t.getAfterHideModel&&this.createField(t.getAfterHideModel(),g),i&&this.caption&&setTimeout((function(){o.caption.focus()}),400)}createField(e,t){const i=new x.a(this,e,t);return this.components.push(i),i}destroy(){for(const e of this.components)e.destroy()}close(){var e=this;e.$backplane.close((function(){e.destroy()}))}}},"./src/js/admin/FunctionEditor.js":function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r}));i("./node_modules/core-js/modules/es.string.replace.js");var o=i("./node_modules/underscore/underscore.js"),n=i("./src/react/util/Track.ts");const a=!0;function s(){a&&CodeMirror.defineSimpleMode("nx",{start:[{regex:/"(?:[^"]|"")*?"/,token:"string"},{regex:/(function)(\s+)([a-z$][\w$]*)/,token:["keyword",null,"variable-2"]},{regex:/(?:true|false|null|void|and|or|not|like|select|create|delete|from|where|order|group|by|in|as|of|for|while|if|then|else|end|switch|case|default|do|each|let|this|record)\b/,token:"keyword"},{regex:/true|false|null/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/\/\/.*/,token:"comment"},{regex:/\/(?:[^\\]|\\.)*?\//,token:"variable-3"},{regex:/\/\*/,token:"comment",next:"comment"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0},{regex:/[a-z$][\w$]*/,token:"variable"},{regex:/<</,token:"meta",mode:{spec:"xml",end:/>>/}}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}],meta:{dontIndentStates:["comment"],lineComment:"//"}})}function r(e){this.value=e.value||"",this.isHuman=!!e.isHuman,this.schema=e.schema,this.type=e.type,this.variables=e.variables||{},this.supportsCommands=e.supportsCommands||!1,this.ownerField=e.ownerField,this.okay=e.okay,this.cancel=e.cancel,this.$backplane=$.backplane({closable:!1,cls:"opaq"}),"text"===NinoxDocumentInteraction.getUserDefault("ui.functionEditorMode")?this.openTextEditor():this.openVisualEditor()}r.prototype.openVisualEditor=function(){NinoxDocumentInteraction.setUserDefault("ui.functionEditorMode","visual");var e=this,t=this.schema,i=this.type,a=this.variables,s=this.supportsCommands,r=this.ownerField,l={block:";",add:"+",sub:"&minus;",mul:"&ast;",div:"/",mod:"%",and:locale.op_and,or:locale.op_or,not:locale.op_not,true:locale.op_true,false:locale.op_false,if:locale.op_if,eq:"=    ",ne:"&ne;",gt:"&gt;",lt:"&lt;",ge:"&ge;",le:"&le;",like:locale.op_like,round:locale.op_round,ceil:locale.op_ceil,floor:locale.op_floor,sqrt:"&radic;",sqr:"&sup2;",sign:locale.op_sign,abs:locale.op_abs,sin:"sin",cos:"cos",tan:"tan",asin:"asin",acos:"acos",atan:"atan",atan2:"atan&sup2;",pow:" ^ ",exp:"e ^ ",log:"log<sub>10<sub>",ln:"ln",year:locale.op_year,day:locale.op_day,month:locale.op_month,weekday:locale.op_weekday,age:locale.op_age,format:locale.op_format,today:locale.op_today,now:locale.op_now,yearmonth:locale.op_yearmonth,yearquater:locale.op_yearquater,yearquarter:locale.op_yearquater,start:locale.op_start,endof:locale.op_end,duration:locale.op_duration,text:locale.op_text,trim:locale.op_trim,lower:locale.op_lower,upper:locale.op_upper,lpad:locale.op_lpad,rpad:locale.op_rpad,substr:locale.op_substr,contains:locale.op_contains,index:locale.op_index,date:locale.op_date,number:locale.op_number,yearweek:locale.op_yearweek,week:locale.op_week,days:locale.op_days,workdays:locale.op_workdays},c={helper:"clone",opacity:.7,scroll:!1,appendTo:$(document.body),zIndex:1e3},d={helper:"clone",opacity:.7,appendTo:$(document.body),zIndex:1e3},h={accept:".fn-op, .fn-exp",hoverClass:"drop-hover",greedy:!0,tolerance:"pointer",drop:U},p={accept:".fn-exp",tolerance:"pointer",drop:X},u=this.$backplane,f=$('<div class="tab-selected-indicator">'),m=$('<div class="fn-function">').appendTo(u),g=$('<div class="fn-tabs">').appendTo(u),v=$('<div class="fn-operators">').appendTo(u),y=$("<div>").appendTo(v),b=$('<div class="fn-controls">').appendTo(u),w=$('<div class="fn-error-container">').hide().appendTo(u);$('<div class="i-32-12 i-red i-warning">').appendTo(w);var x=$("<div>").appendTo(w);$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(b).touch(ee),$('<div class="nx-hspace-flex">').appendTo(b);var T,C,k=$('<div class="fn-mode">').appendTo(b);$('<div class="button option first selected">').text(locale.modeVisual).appendTo(k),$('<div class="button option last">').text(locale.modeText).appendTo(k).click(Z);$('<div class="nx-hspace-flex">').appendTo(b),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(b).touch(te),u.droppable(p),m.droppable(h),s&&(T=$('<div class="fn-operators-pane">').hide().appendTo(y),C=$('<div class="tab">').text(locale.commands).appendTo(g).data("pane",T).click(R),i&&o.each(i.sorted,(function(e){e.isField&&"fn"!==e.base&&$('<div class="fn-op fn-op-assign">').text(e.caption+" :=").data("op","assign").data("field",e).draggable(c).appendTo(T)})),$("<br>").appendTo(T),$('<div class="fn-op fn-op-block">').html(l.block).data("op","block").draggable(c).appendTo(T));var S=$('<div class="fn-operators-pane">').hide().appendTo(y),_=$('<div class="tab">').text(locale.fields).appendTo(g).data("pane",S).click(R),E=$('<div class="fn-nav">').appendTo(S),D=$('<div class="fn-fields">').appendTo(S),N=[{type:i,variables:a}],I=$('<div class="fn-operators-pane">').hide().appendTo(y);$('<div class="fn-op fn-op-bin fn-op-bin-add">').html(l.add).data("op","add").draggable(c).appendTo(I),$('<div class="fn-op fn-op-bin fn-op-bin-sub">').html(l.sub).data("op","sub").draggable(c).appendTo(I),$('<div class="fn-op fn-op-bin fn-op-bin-mul">').html(l.mul).data("op","mul").draggable(c).appendTo(I),$('<div class="fn-op fn-op-bin fn-op-bin-div">').html(l.div).data("op","div").draggable(c).appendTo(I),$('<div class="fn-op fn-op-bin fn-op-bin-mod">').html(l.mod).data("op","mod").draggable(c).appendTo(I),$('<div class="fn-op fn-op-const fn-op-const-number">').html("1234").data("op","number").draggable(c).appendTo(I),$("<br>").appendTo(I),o.each([{fn:"number",params:1},{fn:"sqrt",params:1},{fn:"sqr",params:1},{fn:"pow",params:2},{fn:"exp",params:1},{fn:"log",params:1},{fn:"ln",params:1},{fn:"sin",params:1},{fn:"cos",params:1},{fn:"tan",params:1},{fn:"asin",params:1},{fn:"acos",params:1},{fn:"atan",params:1},{fn:"atan2",params:1},{fn:"round",params:1},{fn:"ceil",params:1},{fn:"floor",params:1},{fn:"sign",params:1},{fn:"abs",params:1}],(function(e){$('<div class="fn-op fn-op-fn">').html(l[e.fn]).data("op","fn").data("fn",e).draggable(c).appendTo(I)}));$('<div class="tab">').text(locale.calculate).appendTo(g).data("pane",I).click(R);var O=$('<div class="fn-operators-pane">').hide().appendTo(y);$('<div class="fn-op fn-op-if">').html(l.if).data("op","if").draggable(c).appendTo(O),$('<div class="fn-op fn-op-bin fn-op-bin-and">').html(l.and).data("op","and").draggable(c).appendTo(O),$('<div class="fn-op fn-op-bin fn-op-bin-or">').html(l.or).data("op","or").draggable(c).appendTo(O),$('<div class="fn-op fn-op-un fn-op-un-not">').html(l.not).data("op","not").draggable(c).appendTo(O),$('<div class="fn-op fn-op-const fn-op-const-true">').html(l.true).data("op","true").draggable(c).appendTo(O),$('<div class="fn-op fn-op-const fn-op-const-false">').html(l.false).data("op","false").draggable(c).appendTo(O),$("<br>").appendTo(O),o.each(["eq","ne","lt","le","ge","gt","like"],(function(e){$('<div class="fn-op fn-op-cmp fn-op-cmp-'+e+'">').html(l[e]).data("op",e).draggable(c).appendTo(O)}));$('<div class="tab">').text(locale.logic).appendTo(g).data("pane",O).click(R);var M=$('<div class="fn-operators-pane">').hide().appendTo(y);$('<div class="fn-op fn-op-const fn-op-const-string">').html(locale.op_string).data("op","string").draggable(c).appendTo(M),o.each([{fn:"text",params:1},{fn:"trim",params:1},{fn:"lower",params:1},{fn:"upper",params:1},{fn:"lpad",params:3},{fn:"rpad",params:3},{fn:"substr",params:3},{fn:"contains",params:2},{fn:"index",params:2}],(function(e){$('<div class="fn-op fn-op-fn">').html(l[e.fn]).data("op","fn").data("fn",e).draggable(c).appendTo(M)})),$("<br>").appendTo(M),o.each([{fn:"year",params:1},{fn:"day",params:1},{fn:"month",params:1},{fn:"weekday",params:1},{fn:"week",params:1},{fn:"yearmonth",params:1},{fn:"yearquarter",params:1},{fn:"yearweek",params:1},{fn:"start",params:1},{fn:"endof",params:1},{fn:"duration",params:1},{fn:"days",params:2},{fn:"workdays",params:2},{fn:"age",params:1},{fn:"today",params:0},{fn:"now",params:0},{fn:"date",params:3},{fn:"format",params:2}],(function(e){$('<div class="fn-op fn-op-fn">').html(l[e.fn]).data("op","fn").data("fn",e).draggable(c).appendTo(M)}));var F;$('<div class="tab">').text(locale.textAndDate).appendTo(g).data("pane",M).click(R);function R(e){F&&(F.data("pane").hide(),F.removeClass("selected"),f.detach()),(F=$(this)).data("pane").show(),F.addClass("selected"),f.appendTo(F)}R.call(C||_),A();try{if(this.value){var L=this.isHuman?queries.parseHuman(t,i,this.value,a):queries.parseSystem(t,i,this.value,a);m.append(W(L))}G()}catch(e){J(e)}function j(e){if(e.length){for(var t=e[0],i=t.isVariable?new queries.Parameter(t.id,t.returnType,!0===t.isMultiple):"fn"===t.base?new queries.Eval(t.type,t):new queries.Get(t.type,t),o=1;o<e.length;o++){var n=e[o],a=n.isVariable?new queries.Parameter(n.id,t.returnType,!0===n.isMultiple):"fn"===n.base?new queries.Eval(n.type,n):new queries.Get(n.type,n);i=new queries.Follow(i,a)}return i}}function A(){D.empty(),E.empty();var e=!1,t=[];o.each(N,(function(i,o){i.field?(i.field.isReverse&&(e=!0),t.push(i.field)):i.variable&&t.push(i.variable),i.type?$('<div class="fn-nav-item">').append($(`<div class="type-symbol i-32-24 ${o===N.length-1?"i-light-grey":"i-blue"} i-field-${i.field?i.field.base:"list"}">`)).append($('<div class="type-label">').text(i.field?i.field.caption:i.type.caption)).appendTo(E).touch((function(){N=N.slice(0,o+1),A()})):$('<div class="fn-nav-item">').append($('<div class="i-32-24 i-light-grey i-arrow-solid-right">')).appendTo(E).touch((function(){N=N.slice(0,o+1),A()}))}));var i=N[N.length-1],n=i.field,a=i.type,s=i.variables;s&&o.each(s,(function(e){$('<div class="fn-op fn-op-exp fn-op-more">').append($('<div class="type-symbol type-symbol-list">')).append($('<div class="type-label">').text(e.caption)).data("variable",e).touch(P).appendTo(D)})),a?o.each([a.field_id].concat(a.sorted),(function(i){try{if(i!==r)if(i.isField)if(e)$('<div class="fn-op fn-op-exp fn-op-more">').append($('<div class="type-symbol i-32-24 i-blue i-field-'+i.base+'">')).append($('<div class="type-label">').text(i.caption)).data("field",i).touch(P).appendTo(D);else{var o=j(t.concat([i]));$('<div class="fn-op fn-op-exp">').append($('<div class="type-symbol i-32-24 i-light-grey i-field-'+o.returnType.base+'">')).append($('<div class="type-label">').text(i.caption)).data("op","exp").data("exp",o).draggable(c).appendTo(D)}else i.isReference?$('<div class="fn-op fn-op-exp fn-op-more">').append($('<div class="type-symbol i-32-24 i-blue i-field-ref">')).append($('<div class="type-label">').text(i.caption)).data("field",i).touch(P).appendTo(D):i.isReverse&&$('<div class="fn-op fn-op-exp fn-op-more">').append($('<div class="type-symbol i-32-24 i-blue i-field-rev">')).append($('<div class="type-label">').text(i.caption)).data("field",i).touch(P).appendTo(D)}catch(e){console.log(e)}})):n&&e&&o.each(n.aggregations,(function(e){var i=j(t);i&&(i=new queries.Agg(queries.AGGS[e],[i]),$('<div class="fn-op fn-op-exp">').append($('<div class="symbol symbol-'+e+'">')).append($('<div class="type-label">').text(n.caption)).data("op","exp").data("exp",i).draggable(c).appendTo(D))}))}function P(e){var t=$(this),i=t.data("field"),o=t.data("variable");if(i){if(i.isField)N.push({field:i});else if(i.isReference||i.isReverse){var n=i.refType;if(!n)return;N.push({type:n,field:i})}}else o&&N.push({type:o.returnType,variable:o});A()}function U(e,t){var i=$(e.target),o=t.draggable;o.is(".fn-op")?H(i,o):o.is(".fn-exp")&&z(i,o),G()}function H(e,t){var i=e.children();if(!(i.length>1)){0===i.length&&(i=void 0);var o=B(t,i);o&&o.appendTo(e),G()}}function z(e,t){0===e.children().length&&t.appendTo(e),G()}function V(){}function W(e){if(e){var t,i,o,n,a,s,r,c=$('<div class="fn-exp">').draggable(d);switch(e.base){case"assign":i="assign",c.data("field",e.field),o=W(e.exp)||V(),$('<div class="fn-exp-label">').text(e.field.caption+" :=").appendTo(c),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o);break;case"block":for(i="block",t=0;t<e.exps.length;t++)o=W(e.exps[t])||V(),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o),$('<div class="fn-exp-label">').html(";<br>").appendTo(c);break;case"bin":if(!(i={"+":"add","-":"sub","*":"mul","/":"div","%":"mod"}[e.binop.op]))throw new Error("Unknown operator "+e.op);o=W(e.exprA)||V(),n=W(e.exprB)||V(),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o),$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(c).append(n);break;case"comp":if(!(i={"=":"eq","!=":"ne","<":"lt",">":"gt","<=":"le",">=":"ge",like:"like"}[e.cmp]))throw new Error("Unknown comparator "+e.cmp);o=W(e.exprA)||V(),n=W(e.exprB)||V(),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o),$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(c).append(n);break;case"and":i="and",o=W(e.exprA)||V(),n=W(e.exprB)||V(),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o),$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(c).append(n);break;case"or":i="or",o=W(e.exprA)||V(),n=W(e.exprB)||V(),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o),$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(c).append(n);break;case"not":i="not",o=W(e.expr)||V(),$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o);break;case"const":!0===(s=e.value)?(i="true",$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c)):!1===s?(i="false",$('<div class="fn-exp-label">').html(l[i]||i).appendTo(c)):"string"==typeof s?(i="string",$('<div class="fn-exp-value">').text(s).appendTo(c).click(Y)):"number"==typeof s?(i="number",$('<div class="fn-exp-value">').text(s).appendTo(c).click(q)):(i="exp",c.data("exp",e),$('<div class="fn-exp-label">').text(e.caption).appendTo(c));break;case"apply":for(i="fn",r=e.functor.id,c.data("fn",{fn:r,params:e.functor.argTypes.length}),$('<div class="fn-exp-label">').html(l[r]||r).appendTo(c),t=0;t<e.exprs.length;t++)o=W(e.exprs[t])||V(),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o);break;case"if":i="if",o=W(e.exprIf)||V(),n=W(e.exprThen)||V(),a=W(e.exprElse)||V(),$('<div class="fn-exp-label">').text(locale.op_if_if).appendTo(c),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(c).append(o),$('<div class="fn-exp-label">').text(locale.op_if_then).appendTo(c),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(c).append(n),$('<div class="fn-exp-label">').text(locale.op_if_else).appendTo(c),$('<div class="fn-exp-param fn-exp-param2">').droppable(h).appendTo(c).append(a);break;default:i="exp",c.data("exp",e),$('<div class="fn-exp-label">').text(e.toHumanString().replace(/\s+/g," ")).appendTo(c)}return c.addClass("fn-exp-op-"+i),c.data("op",i),c}}function B(e,t){var i=e.data("op"),o=$('<div class="fn-exp fn-exp-op-'+i+'">').data("op",i).draggable(d);switch(i){case"assign":var n=e.data("field");return o.data("field",n),$('<div class="fn-exp-label">').text(n.caption+" :=").appendTo(o),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V()),o;case"if":return $('<div class="fn-exp-label">').text(locale.op_if_if).appendTo(o),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V()),$('<div class="fn-exp-label">').text(locale.op_if_then).appendTo(o),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(o).append(V()),$('<div class="fn-exp-label">').text(locale.op_if_else).appendTo(o),$('<div class="fn-exp-param fn-exp-param2">').droppable(h).appendTo(o).append(V()),o;case"block":return $('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V()),$('<div class="fn-exp-label">').html(";<br>").appendTo(o),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(V()),o;case"add":case"sub":case"mul":case"div":case"mod":case"and":case"or":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":case"like":return $('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V()),$('<div class="fn-exp-label">').html(l[i]||i).appendTo(o),$('<div class="fn-exp-param fn-exp-param1">').droppable(h).appendTo(o).append(V()),o;case"not":return $('<div class="fn-exp-label">').html(l[i]||i).appendTo(o),$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V()),o;case"true":case"false":if(t)return;return $('<div class="fn-exp-label">').html(l[i]||i).appendTo(o),o;case"fn":var a=e.data("fn");switch(o.data("fn",a),a.fn){case"sqr":$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V()),$('<div class="fn-exp-label">').html(l.sqr).appendTo(o);break;default:$('<div class="fn-exp-label">').html(l[a.fn]||a.fn).appendTo(o),a.params>0&&$('<div class="fn-exp-param fn-exp-param0">').droppable(h).appendTo(o).append(t||V());for(var s=1;s<a.params;s++)$('<div class="fn-exp-param fn-exp-param'+s+'">').droppable(h).appendTo(o).append(V())}return o;case"number":if(t)return;return $('<div class="fn-exp-value">').text("1234").appendTo(o).click(q),o;case"string":if(t)return;return $('<div class="fn-exp-value">').text(locale.op_string).appendTo(o).click(Y),o;case"exp":if(t)return;var r=e.data("exp");return o.data("exp",r).append($('<div class="fn-exp-label">').text(r.toHumanString(0))),o}}function q(){var e=$(this),t=e.text();e.empty();var i=$('<input type="number" class="fn-exp-input fn-exp-input-number">').val(t).css("width",Math.max(10*t.length,50)).appendTo(e).focus().blur((function(){t=i.val(),i.remove(),e.text(t),G()}))}function Y(){var e=$(this),t=e.text();e.empty();var i=$('<input type="text" class="fn-exp-input fn-exp-input-string">').val(t).css("width",Math.max(10*t.length,50)).appendTo(e).focus().blur((function(){t=i.val(),i.remove(),e.text(t),G()}))}function X(e,t){t.draggable.remove(),setTimeout(G,0)}function G(){m.find(".error").removeClass("error");try{var e=Q(),o=e?e.toString():"",n=o?queries.parseSystem(t,i,o,a):void 0;return J(void 0),n}catch(e){return J(e),!1}}function J(e){if(e){e.$exp&&e.$exp.addClass("error");var t=(e.message?e.message:String(e))||locale.fnUnknowError;w.show(),x.text(t)}else w.hide(),x.empty()}function K(e,t,i){var o=e.children(".fn-exp-param")[t];if(!o)throw new Error("Parameter dom node not found "+t);var n=o.childNodes;if(0===n.length){if(i)return;throw{message:locale.fnMissingParameter,$exp:e}}if(n.length>1)throw{message:locale.fnInvalidParameter,$exp:e};if($(n[0]).is(".exp-param-placeholder")){if(i)return;throw{message:locale.fnMissingParameter,$exp:e}}return Q($(n[0]))}function Q(e){if(!e){if(0===(e=m.children()).length)return;if(e.length>1)throw{message:locale.fnInvalidExpression}}var t,i,o,n,a,s,r,l,c,d,h,p,u,f,g=e.data("op");switch(g){case"assign":i=e.data("field"),o=K(e,0);try{return new queries.Assign(i,o)}catch(t){throw{message:String(t),$exp:e}}break;case"block":for(r=e.children(".fn-exp-param"),s=[],t=0;t<r.length;t++)o=K(e,t),s.push(o);try{return new queries.Block(s)}catch(t){throw{message:String(t),$exp:e}}break;case"exp":return e.data("exp");case"add":case"sub":case"mul":case"div":case"mod":if(!(l={add:"+",sub:"-",mul:"*",div:"/",mod:"%"}[g]))throw{message:locale.fnInvalidOperator+' "'+g+'"',$exp:e};if(o=K(e,0),n=K(e,1),!(c=queries.getBinOp(o,l,n)))throw{message:locale.fnInvalidOperator+' "'+g+'"',$exp:e};try{return new queries.Bin(o,c,n)}catch(t){throw{message:String(t),$exp:e}}break;case"and":o=K(e,0),n=K(e,1);try{return new queries.And(o,n)}catch(t){throw{message:String(t),$exp:e}}break;case"or":o=K(e,0),n=K(e,1);try{return new queries.Or(o,n)}catch(t){throw{message:String(t),$exp:e}}break;case"not":o=K(e,0);try{return new queries.Not(o)}catch(t){throw{message:String(t),$exp:e}}break;case"eq":case"ne":case"lt":case"le":case"gt":case"ge":case"like":if(!(d={eq:"=",ne:"!=",lt:"<",le:"<=",gt:">",ge:">=",like:"like"}[g]))throw{message:locale.fnInvalidComparator+' "'+g+'"',$exp:e};o=K(e,0),n=K(e,1);try{return new queries.Comp(o,d,n)}catch(t){throw{message:String(t),$exp:e}}break;case"fn":for(h=e.data("fn"),s=[],t=0;t<h.params;t++)s.push(K(e,t));if(!(p=queries.getFunctor(h.fn,s)))throw{message:locale.fnUndefinedFunction,$exp:e};try{return new queries.ApplyFunction(p,s)}catch(t){throw{message:String(t),$exp:e}}break;case"if":o=K(e,0),n=K(e,1),a=K(e,2,!0);try{return new queries.If(o,n,a)}catch(t){throw{message:String(t),$exp:e}}break;case"true":try{return new queries.Const(!0)}catch(t){throw{message:String(t),$exp:e}}break;case"false":try{return new queries.Const(!1)}catch(t){throw{message:String(t),$exp:e}}break;case"string":u=e.find(".fn-exp-value").first().text()||"";try{return new queries.Const(u)}catch(t){throw{message:String(t),$exp:e}}break;case"number":if(u=e.find(".fn-exp-value").first().text(),f=Number(u),isNaN(f))throw{message:locale.fnInvalidNumber+' "'+u+'"',$exp:e};try{return new queries.Const(f)}catch(t){throw{message:String(t),$exp:e}}}}function Z(){Object(n.f)("Formula","Text");var t=G();!1!==t&&(e.value=t?t.toString():"",u.droppable("destroy"),u.empty(),e.openTextEditor())}function ee(){Object(n.f)("Formula","Cancel"),ie(),e.cancel&&e.cancel()}function te(){Object(n.f)("Formula","Confirm");var t=G();if(!1!==t){if(t&&t.isUpdating()&&!s)return $.alert(locale.updateExpressionNotAllowed);var i=t?t.toString():"";e.value=i,ie(),e.okay&&e.okay(i,t)}}function ie(){u.close()}},r.prototype.openTextEditor=function(){NinoxDocumentInteraction.setUserDefault("ui.functionEditorMode","text");var e=this,t=this.type,i=this.schema,s=this.variables,r=this.supportsCommands,l={},c=this.$backplane,d=$('<div class="fn-controls">').appendTo(c),h=$('<div class="fn-error-container">').hide().appendTo(c);$('<div class="i-32-12 i-red i-warning">').appendTo(h);var p=$("<div>").appendTo(h),u=$('<div class="fn-suggestions">').appendTo(c),f=$('<div class="fn-tools">').appendTo(c).touch(S);TOUCH||f.on("mousedown",(function(e){e.preventDefault()})),$('<div class="nx-button-text grey">').text(locale.cancel).appendTo(d).touch(D),$('<div class="nx-hspace-flex">').appendTo(d);var m=$('<div class="fn-mode">').appendTo(d);$('<div class="button option first">').text(locale.modeVisual).appendTo(m).click(_),$('<div class="button option last selected">').text(locale.modeText).appendTo(m);$('<div class="nx-hspace-flex">').appendTo(d),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(d).touch(E);var g=$('<div class="fn-textpane">').appendTo(c),v=$('<textarea class="fn-textarea no-barcode" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">').appendTo(g),y=$('<div style="position:absolute;right:0;bottom:0;z-index:1;height:20px;line-height:20px;width:60px;padding:0 4px 0 0;font-size:12px;text-align:right;cursor:default;background-color:rgba(255,255,255,.5);color:#555">').appendTo(g),b=null;if(a?((b=CodeMirror.fromTextArea(v[0],{lineNumbers:!0,mode:"nx",indentUnit:4,tabSize:4,smartIndent:!0,indentWithTabs:!0,electricChars:!0,lineWrapping:!0})).on("changes",x),b.on("cursorActivity",T)):v.on("keyup change",x),this.value)try{var w=this.isHuman?queries.parseHuman(i,t,this.value,s):queries.parseSystem(i,t,this.value,s);w&&(a?b.setValue(w.toHumanString()):v.val(w.toHumanString()),w.errors&&w.errors.length&&(h.show(),p.text(w.errors[0].message)))}catch(e){h.show(),p.text(e)}function x(){C()}function T(){var e=b.getCursor();y.text(e.line+1+" / "+e.ch)}function C(){u.empty();var e="";if(e=a?b.getValue():v.val(),!/^\s*$/.test(e))try{var n=queries.parseHuman(i,t,e,s);return n&&n.errors&&n.errors.length?(h.show(),p.text(n.errors[0].message),r(n.errors[0]),!1):(h.hide(),p.text(""),n)}catch(e){return h.show(),p.text(e),r(e),!1}function r(t){t.suggestions&&o.each(t.suggestions,(function(i){function o(){var o=e.substr(0,t.index),n=e.substr(t.index+t.length);if(e=o+i+n,a){var s=b.getCursor();b.setValue(e),s&&b.setCursor({line:s.line,ch:s.ch+i.length})}else v.val(e);return setTimeout(x,0),!1}$('<div class="fn-suggestion">').text(i).appendTo(u).on(TOUCH?EVENT_touchstart:"mousedown",o)}))}}function k(){var e="";function i(t,n){o.each(t.sorted,(function(t){var o=n.concat(util.escapeId(t.caption)),a=o.join(".");if(t.isField||t.isReference||t.isReverse){var s=t.isReference||t.isReverse,r=s&&l[a];e+='<div class="fn-tools-field" data-id="'+a+'"><div class="fn-tools-field-icon i-32-24 i-light-grey i-field-'+t.base+'"></div><div class="fn-tools-field-label">'+htmlEscape(t.caption)+"</div>"+(s?'<div class="fn-tools-field-expand i-32-16 i-grey i-line-up '+(r?"expanded":"collapsed")+'"></div>':"")+"</div>",r&&(e+='<div class="fn-tools-list">',i(t.refType,o),e+="</div>")}}))}s&&s&&o.each(s,(function(t){var o=t.id,n=[o],a=!0,s=l[o];e+='<div class="fn-tools-field" data-id="'+o+'"><div class="fn-tools-field-label">'+htmlEscape(o+" ("+t.caption+")")+"</div>"+(a?'<div class="fn-tools-field-expand i-32-16 i-grey i-line-down '+(s?"expanded":"collapsed")+'"></div>':"")+"</div>",s&&(e+='<div class="fn-tools-list">',i(t.returnType,n),e+="</div>")})),t&&i(t,[]),f.html(e)}function S(e){var t=$(e.target),i=t.closest(".fn-tools-field").attr("data-id");i&&(t.is(".fn-tools-field-expand")?(l[i]=!l[i],k()):a?(b.replaceSelection(i),x()):(v.replaceSelectedText(i),x()),TOUCH&&!a&&v.focus())}function _(){Object(n.f)("Formula","Visual");var t=C();!1!==t&&(e.value=t?t.toString():"",c.empty(),e.openVisualEditor())}function E(t){Object(n.f)("Formula","Confirm");var i=C();if(!1!==i){if(t.shiftKey&&console.log(i.getSyncJS()),i&&i.isUpdating()&&!r)return $.alert(locale.updateExpressionNotAllowed);var o=i?i.toString():"";N(),e.okay&&e.okay(o,i)}}function D(){Object(n.f)("Formula","Cancel"),N(),e.cancel&&e.cancel()}function N(){c.close()}C(),k()}},"./src/js/admin/ViewEditor.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i("./src/js/widgets/Field.js"),n=i("./node_modules/underscore/underscore.js");function a(e){var t=e.config,i=t.cols,a=t.type;if("string"==typeof a&&(a=database.schema.types[a]),a){var s=a.schema,r={},l=void 0!==t.sort?i[t.sort]:void 0,c=void 0!==t.sort?i[t.group]:void 0,d=t.descending,h=!1,p=$.backplane({enter:function(e){e.preventDefault(),L()}}),u=$('<div class="popupeditor nx-menu-popup vieweditor">').appendTo(p),f=e.hasTop,m=database.supports.authentication;if(f){var g=$('<div class="vieweditor-top">').appendTo(u),v=new util.SimpleModel(new schemas.TString(void 0,void 0,{caption:locale.enterViewName,width:m?3:4}));v.value=e.caption;var y=new o.a(void 0,v,g);if(m){var b=new util.SimpleModel(new schemas.TRoles(void 0,void 0,{caption:locale.readRoles,width:1}));b.value=e.readRoles;var w=new o.a(void 0,b,g)}}var x=$('<div class="vieweditor-left '+(f?"vieweditor-hastop ":"")+'accordion">').appendTo(u),T=$('<div class="vieweditor-right '+(f?"vieweditor-hastop ":"")+'accordion">').appendTo(u);j(),$(window).on("resize",j),$('<div class="accordion-head">').text(locale.visibleColumns).appendTo(x),$('<div class="accordion-head">').text(locale.availableColumns).appendTo(T);var C=$('<div class="vieweditor-bottom">').appendTo(u);$('<div class="nx-button-bar">').appendTo(C).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(A)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.okay).touch(L));var k=$('<div class="accordion-pane vieweditor-columns">').appendTo(x).mouseup(F),S=$('<div class="accordion-pane vieweditor-columns">').appendTo(T);k.sortable({start:function(){h=!0},stop:function(e){h=!1},beforeStop:function(){},receive:N,remove:I,sort:D,update:E,axis:"y",handle:TOUCH?".t-columneditor-icon, .t-columneditor-label":void 0}),O();var _=-1}function E(){i=[],n.each(k.children(),(function(e){var t=$(e).data("col");t?i.push(t):alert("col no data")}))}function D(e,t){_=t.placeholder.index()}function N(e,t){var o=t.item;if(o){var n=_,a=o.data("col");if(a){var s=Object.assign({},a);i.splice(n,0,s),console.log("A"),t.item.draggable("cancel"),console.log("B"),k.sortable("cancel"),console.log("C"),O()}}}function I(e,t){}function O(){M(),R()}function M(){k.empty();var e=0;r={};for(var t=0;t<i.length;t++){var o=i[t],n=o.expression,h=null;if(n){try{h=queries.parseSystem(s,a,n,{})}catch(e){console.warn(e,e.stack);continue}r[n]=o}var p=$('<div class="t-columneditor-column">').data("col",o).appendTo(k);$('<div class="t-columneditor-icon i-32-24 i-light-grey">').addClass("i-field-"+(h?h.returnType.base:"fn")).appendTo(p),$('<div class="t-columneditor-label">').text(o.caption||(h?h.caption:locale.unnamed)).appendTo(p),l===o&&(d?$('<div class="t-columneditor-icon i-24-12 i-light-grey i-line-down-thick">').appendTo(p):$('<div class="t-columneditor-icon i-24-12 i-light-grey i-line-up-thick">').appendTo(p)),c===o&&$('<div class="t-columneditor-icon i-24-16 i-light-grey i-table-group">').appendTo(p),o.filter&&$('<div class="t-columneditor-icon i-24-16 i-light-grey i-setting-filter">').appendTo(p),o.agg&&$('<div class="t-columneditor-icon symbol symbol-'+o.agg+'">').appendTo(p),e++}0===e&&k.text(locale.dragColumnsHereToDefineView)}function F(e){if(!h){var t=$(e.target).closest(".t-columneditor-column"),n=t.data("col");if(n){var r=$.backplane({close:f}),p=$('<div class="popupeditor nx-menu-popup grey width-4col" style="border-radius:4px">').appendTo(r);u(),p.center()}}function u(){p.empty();var e=new schemas.ExpressionModel(n,"expression",void 0,a,locale.function);e.on("change",(function(){setTimeout(u,0)}));var h=void 0;if(n.expression)try{h=queries.parseSystem(s,a,n.expression,{})}catch(e){console.warn(e,e.stack)}t.addClass("selected");var f=$('<div class="component editor editor-string editor-4col">').appendTo(p);$("<label>").text(locale.caption).appendTo(f);var m=$('<input type="text">').appendTo($('<div class="stringeditor">').appendTo(f)).attr("placeholder",h?h.caption:"").val(n.caption).change((function(){n.caption=m.val()||void 0,M()}));if(new o.a(void 0,e,p),h){var g=$('<div class="component editor editor-4col">').appendTo(p);$("<label>").text(locale.filter).appendTo(g);var v=tables.createFilterEditor({updateFilter:function(){n.filter=v.getFilter(),M()}},g,h.returnType,n.filter);v||g.hide()}var y=$('<div class="component editor editor-4col">').appendTo(p);$("<label>").text(locale.sort).appendTo(y);var b=$('<div class="choiceswitch">').appendTo(y);const w=$('<span class="i-32-16 i-light-grey i-line-up-thick"></span>'),x=$('<div class="choiceswitch-item"></div>').appendTo(b).touch((function(){l=l!==n||d?n:void 0,d=!1,F(),M()}));x.append(w),x.append("<span>"+locale.sortAscending+"</span>");const T=$('<span class="i-32-16 i-light-grey i-line-down-thick"></span>'),C=$('<div class="choiceswitch-item">').appendTo(b).touch((function(){l===n&&d?(l=void 0,d=!1):(l=n,d=!0),F(),M()}));C.append(T),C.append("<span>"+locale.sortDescending+"</span></div>");const k=$('<div class="component editor editor-4col">').appendTo(p);$("<label>").text(locale.grouping).appendTo(k);const S=$("<div>").appendTo(k),_=$('<div class="booleancheck-box"></div>'),E=$('<div class="booleancheck"></div>').appendTo(S).touch((function(){c=c===n?void 0:n,F(),M()}));E.append(_),E.append('<div class="booleancheck-text">'+locale.grouped+"</div>");var D=$('<div class="component editor editor-4col">').appendTo(p);$("<label>").text(locale.aggregation).appendTo(D);var N=$("<div>").appendTo(D);function I(){r.close(),i.splice(i.indexOf(n),1),M(),R()}function O(){N.empty();let e=N;if(h){const t=h.returnType.aggregations.length,i=t>4?Math.ceil(t/2):4;for(let o=0;o<t;o++){o%i==0&&(e=$('<div class="choiceswitch">'),N.append(e));const t=h.returnType.aggregations[o],a=$('<span style="margin-right: 4px;">'+({sum:"Σ",first:"⤒",last:"⤓",avg:"Ø",cnt:"#",min:"⬇",max:"⬆",concat:"&middot;&middot;&middot;"}[t]||"")+"</span>"),s=$('<div class="choiceswitch-item">').appendTo(e).append(a).append($("<span>").text(locale.agg[t])).touch((function(){n.agg===t?n.agg=void 0:n.agg=t,M(),O()}));t===n.agg?(s.addClass("selected"),a.addClass("white")):a.removeClass("white")}t>4&&(N.children().first().addClass("first"),N.children().last().addClass("last"))}}function F(){x.removeClass("selected"),w.removeClass("i-white"),w.addClass("i-light-grey"),C.removeClass("selected"),T.removeClass("i-white"),T.addClass("i-light-grey"),_.attr("class","booleancheck-box"),l===n&&(d?(T.removeClass("i-light-grey"),T.addClass("i-white"),C.addClass("selected")):(w.removeClass("i-light-grey"),w.addClass("i-white"),x.addClass("selected"))),c===n&&_.attr("class","booleancheck-box selected i-16-12 i-white i-check")}O(),$('<div class="nx-button-bar">').appendTo(p).append($('<div class="nx-button-text grey">').text(locale.hideColumn).touch(I)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.okay).touch((function(){r.close()}))),F()}function f(){t.removeClass("selected"),O()}}function R(){var e={connectToSortable:k,helper:"clone",handle:TOUCH?".t-columneditor-icon, .t-columneditor-label":void 0,appendTo:$(document.body),zIndex:11};S.empty(),$('<div class="t-columneditor-column">').data("col",{expression:"",caption:locale.function}).appendTo(S).draggable(e).append($('<div class="t-columneditor-label i-32-24 i-light-grey">').addClass("i-field-fn")).append($('<div class="t-columneditor-label">').text(locale.function)),r._id||$('<div class="t-columneditor-column">').data("col",{expression:"_id"}).appendTo(S).draggable(e).append($('<div class="t-columneditor-label i-32-24 i-light-grey">').addClass("i-field-string")).append($('<div class="t-columneditor-label">').text(locale.id));a.sorted;n.each(a.sorted,(function(t){if(t.isField){var i=t.id;if(!r[i]){var o={expression:i};$('<div class="t-columneditor-column">').data("col",o).appendTo(S).draggable(e).append($('<div class="t-columneditor-label i-32-24 i-light-grey ">').addClass("i-field-"+t.base)).append($('<div class="t-columneditor-label">').text(t.caption))}}if(t.isReference){var a=$('<div class="t-columneditor-icon i-32-24 i-light-grey i-line-right">'),s=$('<div class="t-columneditor-head">').append(a).append($('<div class="t-columneditor-label">').text(t.caption+" ("+t.refType.caption+")")).appendTo(S).click(),l=$('<div class="t-columneditor-group">').appendTo(S).hide(),c=t.refType;!function(){var i=c.field_id,o=t.id+"."+i.id;if(!r[o]){var n={expression:o},a=$('<div class="t-columneditor-column">').data("col",n).appendTo(l).draggable(e);$('<div class="t-columneditor-label i-32-24 i-light-grey ">').addClass("i-field-"+i.base).appendTo(a),$('<div class="t-columneditor-label">').text(i.caption).appendTo(a)}}(),n.each(c.sorted,(function(i){if(i.isField){var o=t.id+"."+i.id;if(!r[o]){var n={expression:o},a=$('<div class="t-columneditor-column">').data("col",n).appendTo(l).draggable(e);$('<div class="t-columneditor-label  i-32-24 i-light-grey">').addClass("i-field-"+i.base).appendTo(a),$('<div class="t-columneditor-label">').text(i.caption).appendTo(a)}}})),s.touch((function(){l.toggle(),s.toggleClass("expanded"),a.toggleClass("i-line-right i-line-down")}))}else if(t.isReverse){a=$('<div class="t-columneditor-icon i-32-24 i-light-grey i-line-right">'),s=$('<div class="t-columneditor-head">').append(a).append($('<div class="t-columneditor-label">').text(t.caption+" ("+t.refType.caption+")")).appendTo(S),l=$('<div class="t-columneditor-group">').appendTo(S).hide(),c=t.refType;n.each(c.sorted,(function(i){if(i.isField){var o=$('<div class="t-columneditor-icon i-32-24 i-light-grey i-line-right">'),a=$('<div class="t-columneditor-head">').append(o).append($('<div class="t-columneditor-label">').text(i.caption)).appendTo(l),s=$('<div class="t-columneditor-group">').appendTo(l).hide();n.each(i.aggregations,(function(o){var n=o+"("+t.id+"."+i.id+")";if(!r[n]){var a={expression:n},l=$('<div class="t-columneditor-column">').data("col",a).appendTo(s).draggable(e),c=aggregations.aggType(o,i);$('<div class="t-columneditor-icon i-32-24 i-light-grey">').addClass("i-field-"+c.base).appendTo(l),$('<div class="t-columneditor-label">').text(locale.agg[o]).appendTo(l)}})),a.touch((function(){s.toggle(),a.toggleClass("expanded"),o.toggleClass("i-line-right i-line-down")}))}})),s.touch((function(){l.toggle(),s.toggleClass("expanded"),a.toggleClass("i-line-right i-line-down")}))}})),database.supports.history&&(r._md||$('<div class="t-columneditor-column">').data("col",{expression:"_md"}).appendTo(S).draggable(e).append($('<div class="t-columneditor-label i-32-24 i-light-grey">').addClass("i-field-timestamp")).append($('<div class="t-columneditor-label">').text(locale.modifiedDate))),database.supports.authentication&&(r._mu||$('<div class="t-columneditor-column">').data("col",{expression:"_mu"}).appendTo(S).draggable(e).append($('<div class="t-columneditor-label i-32-24 i-light-grey">').addClass("i-field-user")).append($('<div class="t-columneditor-label">').text(locale.modifiedUser)),r._cu||$('<div class="t-columneditor-column">').data("col",{expression:"_cu"}).appendTo(S).draggable(e).append($('<div class="t-columneditor-label i-32-24 i-light-grey">').addClass("i-field-user")).append($('<div class="t-columneditor-label">').text(locale.createdUser)))}function L(){A();var i=[],o=0,a=0,s=void 0;n.each(k.children(),(function(e){var t=$(e).data("col");t&&(t===l&&(a=o),t===c&&(s=o),i.push(t),o++)})),t.cols=i,t.sort=a,t.descending=d,t.group=s,e.save({config:t,caption:f?v.value:void 0,readRoles:f&&m?b.value:void 0})}function j(){window.getWidth()<640?(u.css({left:0,marginLeft:0}),x.css({left:"3%",width:"45%"}),T.css({left:"52%",width:"45%"})):(u.css({left:"50%",marginLeft:-312}),x.css({left:16,width:292}),T.css({left:316,width:292}))}function A(){y&&y.destroy(),w&&w.destroy(),$(window).off("resize",j),p.close()}}},"./src/js/client/RemoteDB.js":function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return s}));i("./node_modules/core-js/modules/es.typed-array.uint8-array.js"),i("./node_modules/core-js/modules/web.immediate.js"),i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./node_modules/underscore/underscore.js");const n=schemas.RE_NID,a=schemas.RE_FILE_REF;function s(e,t,i){this.dbinfo=e,this.name=e.name,this.id=e.id,this.account=t,this.server=i,this.adminEnabled=!0,this.adminMode=!1,this.schema=void 0,this.views={},this.originalViews={},this.user=void 0,this.authorizationOpen=!1,this.authorizationPrint=!1,this.authorizationExport=!1,this.authorizationImport=!1,this.authorizationMassDataUpdate=!1,this.queryCache={},this.queryQueue={},this._evalCache={},this.memory={},this._cachedValues={},this.selectIsRunning=!1,this.nodes={},this.seq=0,this.listeners={},this.loadQueue={},this.loadDeps={},this.loadCallbacks=[],this._schedule=[],this._loadNodes=o.debounce($.proxy(this._loadNodes,this)),this.listenForChanges=$.proxy(this.listenForChanges,this),this.runSelect=$.proxy(this.runSelect,this)}Object.assign(s.prototype,schemas.AbstractDatabase.prototype),s.prototype.isSync=!1,s.prototype.supports={authentication:!0,files:!0,comments:!0,history:!0,chat:!1,sync:!0,reindex:!0,rebuildThumbs:!0,reIndexFiles:!0,backup:!0,backgroundImage:!0,root:!0,sharing:!0,indexes:!0},s.prototype.getUniqueID=function(){return"remote."+this.account.id+"."+this.id},s.prototype.typeOf=function(e){return this.schema.typeOf(e)},s.prototype.ridOf=schemas.ridOf,s.prototype.ridOfNode=schemas.ridOfNode,s.prototype.descriptor=function(){return{id:this.id,name:this.name,location:"remote",account:this.account.id,settings:this.settings}},s.prototype.closeDatabase=function(e){e()},s.prototype.openDatabase=function(e,t){var i=this;i.server.loadBootstrap((function(e,n){if(e)return t(e);i.seq=n.seq,i.name=n.dbname,i.settings=n.settings;var a=dbms.getRemoteConnection().getSessionInfo().getCurrentAccountUser(i.account.id),s={};o.each(dbms.getRemoteConnection().getSessionInfo().listAccountUsers(i.account.id),(function(e){s[e.id]=util.enrichUser(e)}));var r=1;o.each(util.localeSortBy(s,"caption"),(function(e){e.order=r++})),i.user=a,i.users=s,i.roles=Object.assign({},dbms.getRemoteConnection().getSessionInfo().getRoles(i.account.id)),i.setSchema(n.schema),i.updateAuthorization(),i.server.loadViews((function(e,o){if(e)return t(e);if(o){i.originalViews={},i.views={};for(var n=0;n<o.length;n++){var a=o[n];i.originalViews[a.id]=a,i.views[a.id]=util.getPersistentView(a)}}setTimeout(i.listenForChanges,0),t()}))}))},s.prototype.setAdminMode=function(e){this.adminMode=!!e,this._trigger("*:admin",["admin",this.adminMode])},s.prototype.setSchema=function(e){this.schema&&this.schema.off("change",this.schemaChanged,this),this.originalSchema=e,this.schema=new schemas.Schema(this,e),this.schema.on("change",this.schemaChanged,this)},s.prototype.saveSchema=function(e){this.updateSchema(this.schema,(function(t){t&&$.alert(t),e&&e()}))},s.prototype.resetSchema=function(e){this.setSchema(this.originalSchema),this._trigger("*:schema",["schema",!1,!0]),e&&e()},s.prototype.schemaChanged=function(){this._trigger("*:schema",["schema",!0,!1])},s.prototype.updateSchema_OLD=function(e,t){e.protectUpdated();var i=e.validate();if(i)return t(i);var o=e.toJSON();o.password=this.schemaPassword,this.setDirty(),this.server.sendUpdateSchema(o,t)},s.prototype.updateSchema=function(e,t){e.protectUpdated();var i=e.validate();if(i)return t(i);var o=e.toJSON();o.password=this.schemaPassword;var n=util.diff(this.originalSchema,o);if(console.log("SCHEMAPATCH",n),!n)return t();this.setDirty(),this.server.sendPatchSchema(n,t)},s.prototype.loadCalendar=function(e,t,i){this.server.loadCalendar(e,t,i)},s.prototype.loadHistory=function(e){this.server.loadHistory(e)},s.prototype.loadNodeHistory=function(e,t){this.server.loadNodeHistory(e,t)},s.prototype.loadViews=function(e){this.server.loadViews(e)},s.prototype.removeView=function(e,t){delete this.views[e],this.server.removeView(e,t)},s.prototype.loadComments=function(e,t){this.server.loadComments(e,t)},s.prototype.postComment=function(e,t,i,o){this.server.postComment(e,t,i,o)},s.prototype.removeComment=function(e,t,i){this.server.removeComment(e,t,i)},s.prototype.loadFiles=function(e,t){this.server.loadFiles(e,t)},s.prototype.removeFile=function(e,t,i){this.server.removeFile(e,t,i)},s.prototype.reindex=function(e){this.server.reindex(e)},s.prototype.reIndexFiles=function(e){this.server.reIndexFiles(e)},s.prototype.rebuildThumbs=function(e){this.server.rebuildThumbs(e)},s.prototype.clearHistory=function(e){this.server.clearHistory(e)},s.prototype.thumbURL1=function(e){return this.server.thumbURL1(e)},s.prototype.thumbURL2=function(e,t){return this.server.thumbURL2(e,t)},s.prototype.thumb2URL1=function(e){return this.server.thumb2URL1(e)},s.prototype.thumb2URL2=function(e,t){return this.server.thumb2URL2(e,t)},s.prototype.fileURL1=function(e){return this.server.fileURL1(e)},s.prototype.serverFileURL1=s.prototype.fileURL1,s.prototype.fileURL2=function(e,t){return this.server.fileURL2(e,t)},s.prototype.previewURL1=function(e){if(e){var t=a.exec(e);if(t){var i=t[1]+t[2],o=t[3];return this.server.previewURL(i,o)}}},s.prototype.previewURL=function(e,t){return this.server.previewURL(e,t)},s.prototype.downloadURL1=function(e){if(e){var t=a.exec(e);if(t){var i=t[1]+t[2],o=t[3];return this.server.downloadURL(i,o)}}},s.prototype.downloadURL=function(e,t){return this.server.downloadURL(e,t)},s.prototype.uploadURL=function(e){return this.server.uploadURL(e)},s.prototype.setBackgroundFile=function(e,t){var i=this;this.server.uploadBackground({file:e},(function(e,o){if(e)return t(e);i.settings=o,i.updateAuthorization(),ui.updateBackground(!0),t()}))},s.prototype.userName=function(e){if(void 0===e)return"";var t=this.users[e];return t?t.caption:locale.unknown},s.prototype.create=function(e,t,i){var o,n=this;if("string"==typeof e){if(o=e,!(e=n.schema.types[o]))return i("Type not found: "+o)}else o=e.id;var a=e.fields,s={};for(var r in a)if(a.hasOwnProperty(r)){var l=a[r];if((l.isField||l.isReference||l.isReverse)&&"fn"!==l.base){var c=t?t[r]:void 0;s[r]=void 0!==c?l.convert(c):l.create()}}n.setDirty(),n.server.sendCreate(o,s,(function(t,a){if(t)return i(t);if(!n.nodes[a._id]){n.nodes[a._id]=a;var s=["create",e.id,a._id];n.schedule("*:create",s),n.schedule(o+":create",s),n._simulateUpdates(a),n.triggerEvents()}i(void 0,a)}))},s.prototype._simulateUpdates=function(e){var t=e._id,i=n.exec(t);if(i){var a=i[1],s=parseInt(i[2]),r=this.schema.types[a];if(r){var l=r.fields;for(var c in e)if(e.hasOwnProperty(c)){var d=e[c],h=l[c];if(h&&h.isReference&&d){var p=h.refTypeId+d,u=this.nodes[p];if(u){var f=!1,m=u[h.refFieldId];if(m){var g=o.sortedIndex(m,s);m[g]!==s&&(m.splice(g,0,s),f=!0)}else u[h.refFieldId]=[s],f=!0;f&&this.schedule("*:change",["change",p])}}}}}},s.prototype.remove=function(e,t){this.setDirty(),this.server.sendRemove(e,(function(e){t(e)}))},s.prototype.removeAll=function(e,t){e&&e.length?(this.setDirty(),this.server.sendRemoveAll(e,(function(e){t&&t()}))):t&&t()},s.prototype.updateSync=function(e,t,i){throw new Error("Not supported")},s.prototype.update=function(e,t,i,o){var n=this,a=n.nodes[e],s=n.schema.typeOf(e);if(!s)return o();var r=s.fields[t];if(!r)return o();if(i=null==i?null:r.convert(i),"memory-global"===r.binding){const a=r.type.id+"."+r.id,s=n.memory[a];if(s!==i||null==s!=(null==i)){n.memory[a]=null==i?void 0:i,n.setDirty();const s=["update",e,t,i];n.schedule("*:update",s),n.schedule(e+":*",s),n.schedule(e+":update",s),n.schedule(e+":update:"+t,s),n.schedule(e+":change",["change",e]),n.schedule("*:change",["change",e]),n.executeMemoryTrigger(r.afterUpdateExp,e,()=>{n.suppressMemoryTriggers||n.triggerEvents(),o&&o()})}else o&&o()}else if("memory-record"===r.binding){const a=e+"."+r.id,s=n.memory[a];if(s!==i||null==s!=(null==i)){n.memory[a]=null==i?void 0:i,n.setDirty();const s=["update",e,t,i];n.schedule("*:update",s),n.schedule(e+":*",s),n.schedule("*:change",["change",e]),n.executeMemoryTrigger(r.afterUpdateExp,e,()=>{n.suppressMemoryTriggers||n.triggerEvents(),o&&o()})}else o&&o()}else if(a&&(a[t]===i||null==a[t]&&null==i))o&&o();else{a[t]=null==i?void 0:i,n.setDirty();var l=["update",e,t,i];n.schedule("*:update",l),n.schedule(e+":*",l),n.schedule(e+":update",l),n.schedule(e+":update:"+t,l),n.schedule(e+":change",["change",e]),n.schedule("*:change",["change",e]),n.triggerEvents(),n.server.sendUpdate(e,t,i,(function(e){e?($.alert(e),o&&o(e)):o&&o()}))}},s.prototype.executeMemoryTrigger=function(e,t,i){e?this.suppressMemoryTriggers?i():(this.suppressMemoryTriggers=!0,this.loadNode(t,(t,o)=>{t&&console.warn(t),e.evaluate(this,o,e=>{this.suppressMemoryTriggers=!1,e&&console.warn(e),i()})})):i()},s.prototype.updateNodes=function(e,t){this.setDirty(),this.server.sendUpdateNodes(e,t)},s.prototype.loadNode=function(e,t){var i=this.nodes,o=i[e];return null===o?t(locale.nodeNotFound+" ("+e+")"):void 0!==o?t(void 0,o):void this.loadNodes([e],(function(o){if(o)return t(o);var n=i[e];return n?n._error?t(n._error):void t(void 0,n):t(locale.nodeNotFound+" ("+e+")")}))},s.prototype.loadNode2=function(e,t,i){return this.loadNode(e+t,i)},s.prototype.loadNodeSync=function(e){return this.nodes[e]},s.prototype.loadNodeSync2=function(e,t){return this.nodes[e+t]},s.prototype.loadNodes=function(e,t){if(!e||0===e.length)return t();if(0===(e=this.filterUncached(e,{})).length)return t();for(var i=0;i<e.length;i++)this.loadQueue[e[i]]=!0;this.loadCallbacks.push(t),this._loadNodes()},s.prototype.loadNodes3=function(e,t,i){if(!t||0===t.length)return i();for(var o=this.loadQueue,n=this.nodes,a=0,s=0;s<t.length;s++){var r=e+t[s];n[r]||(o[r]=!0,a++)}if(0===a)return i();this.loadCallbacks.push(i),this._loadNodes()},s.prototype.loadNodes2=function(e,t,i){if(!e||0===e.length)return i();if(0===(e=this.filterUncached(e,t)).length)return i();for(var o=this.loadQueue,n=0;n<e.length;n++)o[e[n]]=!0;this.loadDeps=queries.extendDependencies(this.loadDeps,t),this.loadCallbacks.push(i),this._loadNodes()},s.prototype.filterUncached=function(e,t){e=e.slice(0);this.schema.types;for(var i=this.nodes,n={},a={},s=0;s<e.length;s++){var r=e[s];if(!n[r]){n[r]=!0;var l=i[r];if(l){var c=this.typeOf(r);if(c){var d=t[c.id];if(d)for(var h=0;h<d.length;h++){var p=d[h],u=c.fields[p];if(u)if(u.isReference){if(v=l[p])n[g=u.refType.id+v]||e.push(g)}else if(u.isReverse){var f=l[p];if(f)for(var m=0;m<f.length;m++){var g,v=f[m];n[g=u.refType.id+v]||e.push(g)}}}}}else a[r]=!0}}return o.keys(a).sort()},s.prototype._loadNodes=function(){var e=this.nodes;if(o.isEmpty(this.loadQueue)){var t=this.loadCallbacks;this.loadCallbacks=[];for(var i=0;i<t.length;i++)t[i]()}else{var n=Object.keys(this.loadQueue);this.loadQueue={};var a=this.loadDeps;this.loadDeps={};t=this.loadCallbacks;this.loadCallbacks=[],this.server.loadNodes(n,a,(function(i,o){if(!i)for(var n=0;n<o.length;n++){var a=o[n];a._error?(log("Failed to load node",a._id,a._error),e[a._id]=null):a._na?e[a._id]=null:e[a._id]=a}for(n=0;n<t.length;n++)t[n]()}))}},s.prototype.find=function(e,t,i){this.server.sendFind(e,t,i)},s.prototype.fastSearch=function(e,t,i){var o=this;o.server.sendFind(void 0,t,(function(e,t){if(e)return i(e);o.loadNodes(t,(function(){for(var e={},o=0;o<t.length;o++){var a=t[o],s=n.exec(a);if(s){var r=s[1],l=parseInt(s[2]),c=e[r];c||(c=e[r]=[]),c.push(l)}}i(void 0,e)}))}))},s.prototype.select=s.prototype.select_optimized=function(e,t){var i=this,o=i.queryCache[e];if(o)t(void 0,o);else{var n=i.queryQueue[e];n?n.push(t):n=i.queryQueue[e]=[t],i.runSelect()}},s.prototype.runSelect=function(){var t=this;if(!t.selectIsRunning){var i=t.queryQueue,o=t.queryCache,n=[];for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];s&&s.length&&n.push(a)}n.length&&(t.selectIsRunning=!0,t.server.sendSelects(n,(function(a,s){if(s)for(var r=0;r<n.length;r++){var l=n[r];(c=s[r])&&c.length&&t.loadNodes2(c,{},(function(){})),o[l]=c}for(r=0;r<n.length;r++){l=n[r];var c=o[l]||[],d=i[l];if(delete i[l],d&&d.length)for(var h=0;h<d.length;h++)d[h](void 0,c)}var p=!1;for(var l in i){if(i.hasOwnProperty(l))if((d=i[l])&&d.length){p=!0;break}}p&&e(t.runSelect,0),t.selectIsRunning=!1})))}},s.prototype.selectFind=function(e,t,i){this.select(e,i)},s.prototype.selectFromTypeWhere=function(e,t,i){var o=t?"select "+e+" where "+t.toString():"select "+e;this.select(o,i)},s.prototype.selectSyncJS=function(){return[]},s.prototype.on=function(e,t,i,o){var n=(t||"*")+":"+(e||"*"),a=this.listeners[n];this.listeners[n]=a?this.listeners[n].concat([{f:i,c:o}]):[{f:i,c:o}]},s.prototype.onCreate=function(e,t,i){this.on("create",e,t,i)},s.prototype.onRemove=function(e,t,i){this.on("remove",e,t,i)},s.prototype.onUpdate=function(e,t,i,o){this.on(t?"update:"+t:"update",e,i,o)},s.prototype.onChange=function(e,t,i){this.on("change",e,t,i)},s.prototype.onComment=function(e,t,i){this.on("comment",e,t,i)},s.prototype.onFile=function(e,t,i){this.on("file",e,t,i)},s.prototype.onView=function(e,t){this.on("view",void 0,e,t)},s.prototype.off=function(e,t,i,o){var n=(t||"*")+":"+(e||"*"),a=this.listeners[n];if(a){for(var s=[],r=0;r<a.length;r++){var l=a[r];(i&&l.f!==i||o&&l.c!==o)&&s.push(l)}this.listeners[n]=s}else log("Inconsistent RemoteDB.off")},s.prototype.offCreate=function(e,t,i){this.off("create",e,t,i)},s.prototype.offChange=function(e,t,i){this.off("change",e,t,i)},s.prototype.offRemove=function(e,t,i){this.off("remove",e,t,i)},s.prototype.offUpdate=function(e,t,i,o){this.off(t?"update:"+t:"update",e,i,o)},s.prototype.offComment=function(e,t,i){this.off("comment",e,t,i)},s.prototype.offFile=function(e,t,i){this.off("file",e,t,i)},s.prototype.offView=function(e,t){this.off("view",void 0,e,t)},s.prototype._trigger=function(e,t){var i=this.listeners[e];if(i)for(var o=0;o<i.length;o++)i[o].f.apply(i[o].c,t)},s.prototype.schedule=function(e,t){this._schedule.push([e,t])},s.prototype.triggerEvents=function(){var e=this._schedule;if(this._schedule=[],e&&e.length){this._trigger("*:*",[]);for(var t=0;t<e.length;t++)this._trigger(e[t][0],e[t][1])}},s.prototype.listenForChanges=function(){var e=this;e.server.loadChanges(e.seq,(function(t,i){t?setTimeout(e.listenForChanges,5e3):e.applyChanges(i,(function(t){t&&log(t),setTimeout(e.listenForChanges,0)}))}))},s.prototype.applyChanges=function(e,t){var i=e.results;if(i)for(var o=0;o<i.length;o++){var n=i[o];this.change(n)}else this.resync();this.seq!==e.last_seq&&(this.seq=e.last_seq,this.schedule("*:history")),this.triggerEvents(),t()},s.prototype.resync=function(){this.nodes={},this.queryCache={},this._evalCache={},this._trigger("resync",[]),this._trigger("*:schema",["schema",null,null])};var r={"schema-patch":function(e,t,i,o,n){this.setDirty(),this.setSchema(util.applyChange(this.schema.toJSON(),n));var a=["schema",!1,!0];this.schedule("*:schema",a)},schema:function(e,t,i,o,n){this.setDirty(),this.setSchema(n);var a=["schema",!1,!0];this.schedule("*:schema",a)},create:function(e,t,i,o,n,a){var s=this.typeOf(n);if(s){var r=s.id,l=!this.nodes[n];if(this.nodes[n]=a,this.setDirty(),l){var c=["create",r,n];this.schedule("*:create",c),this.schedule(r+":create",c)}}},remove:function(e,t,i,o,n){this.setDirty();var a=["remove",n];this.schedule("*:remove",a),this.schedule(n+":*",a),this.schedule(n+":remove",a),delete this.nodes[n]},update:function(e,t,i,n,a,s){this.setDirty();var r=this.nodes[a],l=this.typeOf(a);if(l){for(var c in s)if(s.hasOwnProperty(c)){var d=l.fields[c];if(d)if(d.isField){var h=!0;if(r){var p=r[c],u=s[c];r[c]=null==u?void 0:u,(p===u||null==p&&null==u)&&(h=!1)}if(h){var f=["update",a,c,s[c]];this.schedule("*:update",f),this.schedule(a+":*",f),this.schedule(a+":update",f),this.schedule(a+":update:"+c,f)}}else if(d.isReference){r&&(r[c]=null==s[c]?void 0:s[c]);f=["update",a,c,s[c]];this.schedule("*:update",f),this.schedule(a+":*",f),this.schedule(a+":update",f),this.schedule(a+":update:"+c,f)}else if(d.isReverse&&r){var m=r[c];m||(m=r[c]=[]);var g=s[c];for(var v in g){if(g.hasOwnProperty(v))if(!0===g[v=parseInt(v)])m[y=o.sortedIndex(m,v)]!==v&&m.splice(y,0,v);else if(!1===g[v]){var y;m[y=o.sortedIndex(m,v)]===v&&m.splice(y,1)}}}}r&&(r._mu=t,r._md=i)}this.schedule(a+":change",["change",a]),this.schedule("*:change",["change",a])},view:function(e,t,i,o,n){var a=this;n._deleted?(delete a.originalViews[n.id],delete a.views[n.id],a.schedule("*:view",["view",n.id,null])):(a.originalViews[n.id]=n,a.views[n.id]=util.getPersistentView(n),a.schedule("*:view",["view",n.id,n]))},comment:function(e,t,i,o,n){this.schedule(n+":comment",["comment"])},file:function(e,t,i,o,n){this.schedule(n+":file",["file"])}};function l(e,t){if(!t||0===t.length)return!0;if(e.roles.admin)return!0;for(var i=0;i<t.length;i++)if(e.roles[t[i]])return!0;return!1}s.prototype.change=function(e){var t=r[e[3]];t&&t.apply(this,e)},s.prototype.setBackground=function(e,t){var i=this;i.server.setBackground(e,(function(e,o){if(e)return t(e);i.settings=o,i.updateAuthorization(),ui.updateBackground(),t()}))},s.prototype.updateSettings=function(e,t){var i=this;i.server.updateSettings(e,(function(e,o){e?t&&t(e):(i.settings=o,i.updateAuthorization(),ui.updateBackground(),t&&t(void 0,o))}))},s.prototype.backgroundURL=function(e){return this.server.backgroundURL(e)},s.prototype.updateAuthorization=function(){this.authorizationOpen=l(this.user,this.settings.rolesOpen),this.authorizationHistory=l(this.user,this.settings.rolesHistory),this.authorizationPrint=l(this.user,this.settings.rolesPrint),this.authorizationExport=l(this.user,this.settings.rolesExport),this.authorizationImport=l(this.user,this.settings.rolesImport),this.authorizationMassDataUpdate=l(this.user,this.settings.rolesMassDataUpdate)},s.prototype.listReports=function(e){this.server.listReports(e)},s.prototype.updateReport=function(e,t){this.server.updateReport(e,t)},s.prototype.removeReport=function(e,t){this.server.removeReport(e,t)},s.prototype.saveReportFile=function(e,t,i,o){o("saveReportFile not implemented.")},s.prototype.removeReportFile=function(e,t,i){this.server.removeReportFile(e,t,i)},s.prototype.cleanReportFiles=function(e,t,i){this.server.cleanReportFiles(e,t,i)},s.prototype.copyReportFiles=function(e,t,i){this.server.copyReportFiles(e,t,i)},s.prototype.reportFileURL=function(e,t){return this.server.reportFileURL(e,t)},s.prototype.reportFileServerURL=s.prototype.reportFileURL,s.prototype.reportFileURLProxy=function(e,t){return this.reportFileURL(e,t)},s.prototype.importReportFile=function(e,t,i){this.server.importReportFile(e,t,i)},s.prototype.loadCalendarFromTo=function(e,t,i){var o=e.getFullYear(),n=t.getFullYear(),a=e.getMonth()+1,s=t.getMonth()+1,r=e.getDate(),l=t.getDate(),c=o+"-"+(a<10?"0":"")+a+"-"+(r<10?"0":"")+r,d=n+"-"+(s<10?"0":"")+s+"-"+(l<10?"0":"")+l;this.loadCalendar(c,d,i)},s.prototype.saveView=function(e,t){if(this.views[e.id]=e,!this.user.roles.admin)return t();var i=this.originalViews[e.id],o=util.getPersistentView(e);if(util.viewEquals(o,i))return t();this.originalViews[e.id]=o,this.server.saveView(o,(function(e){t(e)}))},s.prototype.duplicate=function(e,t){var i=this;i.setDirty(),i.server.sendDuplicate(e,(function(e,o){if(e)return t(e);if(!i.nodes[o._id]){i.nodes[o._id]=o;var n=schemas.tidOf(o._id),a=["create",n,o._id];i.schedule("*:create",a),i.schedule(n+":create",a),i._simulateUpdates(o),i.triggerEvents()}t(void 0,o._id)}))},s.prototype.setDirty=function(){this.queryCache={},this._evalCache={}},s.prototype.previewFile=function(e,t){var i=this.downloadURL(e,t);NinoxDocumentInteraction.previewDocument(i,(function(){}))},s.prototype.importFile=function(e,t,i){this.server.importFile(e,t,i)},s.prototype.importFileFromURL=function(e,t,i,o){this.server.importFileFromURL(e,t,i,o)},s.prototype.renameFile=function(e,t,i,o){this.server.renameFile(e,t,i,o)},s.prototype.saveFileURL=function(e,t,i){return this.server.saveFileURL(e,t,i)},s.prototype.saveFileBase64=function(e,t,i,o){o("Not implemented.")},s.prototype.saveFileDataURL=function(e,t,i,o){var n=t.split(",");if(2!==n.length)return o("Invalid data URL");var a=/:(.*?);/.exec(n[0]);if(!a)return o("Invalid data URL");var s=a[1];if(!s)return o("Invalid data URL");for(var r=n[1],l=atob(r),c=new ArrayBuffer(l.length),d=new Uint8Array(c),h=0;h<l.length;h++)d[h]=l.charCodeAt(h);var p=new Blob([c],{type:s});this.server.importFile(e,p,i,o)},s.prototype.loadFileURL=function(e,t,i,o){return this.server.loadFileURL(e,t,i,o)},s.prototype.printSimple=function(e,t){this.server.printSimple(e,t)},s.prototype.printRich=function(e,t){this.server.printRich(e,t)},s.prototype.evaluateOnServer=function(e,t,i){t.isUpdating()&&this.setDirty(),this.server.evaluateOnServer(e,t,(function(e,t){e?($.alert(e),i()):i(t)}))},s.prototype.sendEmail=function(e,t){this.server.sendEmail(e,t)},s.prototype.shareFile=function(e,t,i){this.server.shareFile(e,t,i)},s.prototype.unshareFile=function(e,t,i){this.server.unshareFile(e,t,i)},s.prototype.loadSharedFile=function(e,t,i){this.server.loadSharedFile(e,t,i)},s.prototype.shareView=function(e,t,i){this.server.shareView(e,t,i)},s.prototype.unshareView=function(e,t){this.server.unshareView(e,t)},s.prototype.loadSharedView=function(e,t){this.server.loadSharedView(e,t)},s.prototype.importSchema=function(e,t){this.server.importSchema(e,t)}}).call(this,i("./node_modules/node-libs-browser/node_modules/timers-browserify/main.js").setImmediate)},"./src/js/helpers.ts":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return n}));i("./node_modules/core-js/modules/es.string.replace.js");function o(e,t,i){if(e){const o=Math.max(t,i)-e.length+1;if(o>0)for(let t=0;t<o;t++)e.push(void 0);const n=e[t];e.splice(t,1),e.splice(i,0,n)}}function n(e){return encodeURI(e).replace(/[?#+:]/g,encodeURIComponent)}},"./src/js/printer/printNode.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("./src/js/printer/renderNodeHTML.js");function n(e){if(!database.authorizationPrint)return $.alert(locale.notAuthorized);"HTML"===database.settings.printTableRendering?a(e):s(e)}function a(e){Object(o.a)({nid:e},(async function(t,i){if(t)return $.alert(t);try{var o=util.escapeFileName(database.typeOf(e).caption+database.ridOf(e))+".html",n=await localFileSystem.tempURL(o);await localFileSystem.writeURL(n,i,"utf8"),NinoxDocumentInteraction.previewDocument(n,(function(){0}))}catch(t){$.alert(t)}}))}function s(e){if(database.typeOf(e)){database.ridOf(e);$.loading(!0);var t={ready:!1,canceled:!1,nid:e,fontSize:database.settings.printNodeFontSize||"9",printNodeImages:!0};NinoxPrint.previewPDFDocument_PREPARE&&NinoxPrint.previewPDFDocument_PREPARE(),r(t,(function(e,t){if($.loading(!1),e)return $.alert(e);NinoxPrint.previewPDFDocument(t)}))}}function r(e,t){var i=printer.MM,o=parseInt(e.fontSize)||10,n=e.nid,a=database.ridOf(n),s=database.typeOf(n),r={name:util.escapeFileName(s.caption+a)+".pdf",orientation:"portrait",width:210*i,height:297*i,marginLeft:10*i,marginTop:10*i,marginRight:10*i,marginBottom:10*i,headHeight:2*o,footHeight:2*o,fontSize:o,headLeft:s.caption+" "+a,headRight:database.name,footLeft:util.formatLocaleDateTime(new Date),footRight:"$page"},l=r.content=[];function c(e){database.loadNode(n,(function(t,i){if(t)return e(t);l.push({base:"h1",caption:s.caption+" "+a});var o=s.sorted,n=0;function r(){if(n>=o.length)return e();var t=o[n++];d(i,t,(function(t){if(t)return e(t);setTimeout(r,0)}))}setTimeout(r,0)}))}function d(e,t,i){if(t.isField){var o=e[t.id];if("file"===t.base)i();else if("fn"===t.base)t.exp.evaluate(database,e,(function(e,o){if(!e){var n=t.format(o)||"";n&&l.push({base:"field",caption:t.caption,value:n})}i()}));else if("html"===t.base)o&&l.push({base:"rich",caption:t.caption,value:o}),i();else{var n=t.format(o)||"";n&&l.push({base:"field",caption:t.caption,value:n}),i()}}else if(t.isReference){var a=e[t.id];if(a){var s=t.refTypeId+a;database.loadNode(s,(function(e,o){if(o){var n=t.refType.format(o)||"";l.push({base:"field",caption:t.caption,value:n})}i()}))}else i()}else t.isReverse?h(e,t,i):t.isUI&&(("tab"===t.base||"head"===t.base)&&l.push({base:"h2",caption:t.caption||""}),i())}function h(e,t,i){var o=new queries.QueryReverse(database,t,e._id);o.load((function(){var e=o.cols,n=o.rows,a=o.foot.values,s=o.models,r=o.groups,c=o.cidxGroup;if(!e.length||!n.length)return i();var d={base:"table",caption:t.caption};function h(){for(var t=d.head=[],i=0;i<e.length;i++){var o=e[i];t.push({caption:o.caption||o.expression.caption,width:o.width,align:printer.cellTypeAlign(o.field)})}}function p(){for(var t=d.rows=[],i=0;i<n.length;i++){var o=n[i],a=s[o]||r[o],l=!!r[o],h=[];t.push(h);for(var p=0;p<e.length;p++){var u=e[p],f=a.values[p],m=l&&p!==c?u.agg?printer.aggSymbol(u.agg)+u.aggType.format(f):"":u.field.format(f);h.push(m||"")}}}function u(){for(var t=d.foot=[],i=0;i<e.length;i++){var o=e[i];if(o.agg){var n=a[i],s=printer.aggSymbol(o.agg)+o.aggType.format(n)||"";t.push(s)}else t.push("")}}l.push(d),h(),p(),u(),i()}))}function p(e){database.loadFiles(n,(function(t,i){if(t)return e(t);var o=0;function n(){if(o>=i.length)return setTimeout(e,0);u(i[o++].name,(function(e){setTimeout(n,0)}))}setTimeout(n,0)}))}function u(t,i){if(!e.printNodeImages)return i();var o=database.downloadURL(n,t);o&&l.push({base:"img",url:o}),i()}c((function(i){if(!e.canceled)return i?t(i):void p((function(i){if(!e.canceled)return i?t(i):void t(void 0,r)}))}))}},"./src/js/printer/printTable.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("./src/js/printer/renderTableHTML.js");function n(e){if(!database.authorizationPrint)return $.alert(locale.notAuthorized);"HTML"===database.settings.printTableRendering?a(e):s(e)}async function a(e){var t=Object(o.a)(e),i=l(e.type);try{const e=await localFileSystem.tempURL(i);await localFileSystem.writeURL(e,t,"utf8"),NinoxDocumentInteraction.previewDocument(e,()=>{0})}catch(e){$.alert(e)}}function s(e){var t=c(e);NinoxPrint.previewPDFDocument(t)}function r(e){return util.escapeFileName(e)+".pdf"}function l(e){return util.escapeFileName(e.caption)+".html"}function c(e){var t=e.type&&e.type.caption||locale.unnamed,i=e.container&&e.container.getViewCaption()||void 0;i==locale.all&&(i=void 0);var o=t+(i?" - "+i:""),n=printer.MM,a=parseInt(database.settings.printTableFontSize)||10,s={name:r(o),orientation:"landscape",width:210*n,height:297*n,marginLeft:10*n,marginTop:10*n,marginRight:10*n,marginBottom:10*n,headHeight:2*a,footHeight:2*a,fontSize:a,headLeft:o,headRight:database.name,footLeft:util.formatLocaleDateTime(new Date),footRight:"$page"},l=e.cols,c=e.rows,d=e.models,h=e.groups,p=e.foot,u=e.cidxGroup,f=(e.type,{base:"table"}),m=f.head=[],g=f.rows=[],v=f.foot=[];s.content=[f];for(var y=0;y<l.length;y++){var b=l[y];m.push({caption:b.caption||b.expression.caption||locale.unnamed,width:b.width,align:printer.cellTypeAlign(b.field)})}for(y=0;y<c.length;y++){var w=c[y],x=h[w],T=[];if(g.push(T),x)for(var C=0;C<l.length;C++){b=l[C];if(C===u){var k=x.values[C],$=b.field.format(k)||"";T.push($)}else if(b.agg){k=x.values[C],$=printer.aggSymbol(b.agg)+b.aggType.format(k)||"";T.push($)}else T.push("")}else{var S=d[w];for(C=0;C<l.length;C++){b=l[C],k=S.values[C],$=b.field.format(k)||"";T.push($)}}}for(C=0;C<l.length;C++){if((b=l[C]).agg){k=p.values[C],$=printer.aggSymbol(b.agg)+b.aggType.format(k)||"";v.push($)}else v.push("")}return s}},"./src/js/printer/renderNodeHTML.js":function(e,t,i){"use strict";function o(e,t){var i=e.nid,o=database.ridOf(i),n=database.typeOf(i),a='<!DOCTYPE HTML><html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/><style type="text/css">body {font-family:Sans-Serif;font-size:10pt}h1 {text-align:center}h2 {font-size:1em;font-weight:bold;border-bottom:solid thin black;text-align:right}table {width:100%}ul {margin:0;list-style:decimal}li {margin:.5em}p.history {text-align:right;xborder-top:solid thin black;padding:.5em 0;font-style:italic}td {padding:.5em}td.caption {text-align:right;font-weight:bold}td.value {text-align:left}td.long-value {border-bottom:solid thin black;border-top:solid thin black}.head {position:fixed;top:0;left:0;width:100%;height:30pt;background-color:red}.foot {position:fixed;bottom:0;left:0;width:100%;height:30pt;background-color:blue}table.bordered {width:100%;empty-cells:show;border-spacing:0;border-collapse:collapse;border:solid thin black}table.bordered td, table.bordered th {padding:.5em;border:solid thin black}table.bordered tfoot tr {border-top:double}td.cell-number {text-align:right}td.cell-date {text-align:center}td.cell-boolean {text-align:center}td.cell-choice {text-align:left}td.cell-fn {text-align:right}</style></head><body>';function s(e){database.loadNode(i,(function(t,i){if(t)return e(t);a+="<h1>"+htmlEscape(n.caption+" "+o)+"</h1>",a+='<table><colgroup><col width="30%"/><col width="70%"/></colgroup><tbody>';var s=n.sorted,l=0;function c(){if(l>=s.length)return setTimeout(d,0);var t=s[l++];r(i,t,(function(t){if(t)return e(t);setTimeout(c,0)}))}function d(){a+="</tbody></table>",e()}setTimeout(c,0)}))}function r(e,t,i){if(t.isField){var o=e[t.id];if("file"===t.base)i();else if("fn"===t.base)t.exp.evaluate(database,e,(function(e,o){if(!e){var n=t.format(o);n&&(a+='<tr><td class="caption">'+htmlEscape(t.caption)+'</td><td class="value">'+htmlEscape(n)+"</td></tr>")}i()}));else if("html"===t.base)o&&(a+='<tr><td class="caption" colspan="2">'+htmlEscape(t.caption)+'</td></tr><tr><td class="long-value" colspan="2">'+o+"</td></tr>"),i();else{var n=t.format(o);n&&(a+='<tr><td class="caption">'+htmlEscape(t.caption)+'</td><td class="value">'+htmlEscape(n)+"</td></tr>"),i()}}else if(t.isReference){var s=e[t.id];if(s){var r=t.refTypeId+s;database.loadNode(r,(function(e,o){if(o){var n=t.refType.format(o);n&&(a+='<tr><td class="caption">'+htmlEscape(t.caption)+'</td><td class="value">'+htmlEscape(n)+"</td></tr>")}i()}))}else i()}else t.isReverse?l(e,t,i):t.isUI&&("tab"!==t.base&&"head"!==t.base||(a+='<tr><td colspan="2"><h2>'+htmlEscape(t.caption)+"</h2></td></tr>"),i())}function l(e,t,i){var o=new queries.QueryReverse(database,t,e._id);o.load((function(){var e=o.cols,n=o.rows,s=o.foot.values,r=o.models,l=o.groups,c=o.cidxGroup;if(!e.length||!n.length)return i();function d(){a+='<tr><td class="caption" colspan="2">'+htmlEscape(t.caption)+"</td></tr>",a+='<tr><td class="table-value" colspan="2"><table class="bordered">',a+="<thead><tr>";for(var i=0;i<e.length;i++){var o=e[i];a+="<th>"+htmlEscape(o.caption||o.expression.caption)+"</th>"}a+="</tr></thead>"}function h(){a+="<tbody>";for(var t=0;t<n.length;t++){a+="<tr>";for(var i=n[t],o=r[i]||l[i],s=!!l[i],d=0;d<e.length;d++){var h=e[d],p=o.values[d],u=s&&d!==c?h.agg?printer.aggSymbol(h.agg)+h.aggType.format(p):"":h.field.format(p);a+="<td>"+htmlEscape(u)+"</td>"}a+="</tr>"}a+="</tbody>"}function p(){a+="<tfoot><tr>";for(var t=0;t<e.length;t++){var i=e[t];if(i.agg){var o=s[t],n=printer.aggSymbol(i.agg)+i.aggType.format(o);a+="<td>"+htmlEscape(n)+"</td>"}else a+="<td></td>"}a+="</tr></tfoot>",a+="</table></td></tr>"}d(),h(),p(),i()}))}function c(e){database.loadFiles(i,(function(t,i){if(t)return e(t);var o=0;function n(){if(o>=i.length)return setTimeout(e,0);d(i[o++].name,(function(e){setTimeout(n,0)}))}setTimeout(n,0)}))}function d(t,o){if(!e.printNodeImages)return o();if(!util.RE_IMAGE_FILE_EXT.test(t))return o();var n=database.downloadURL(i,t);n?a+='<img src="'+n+'">':o()}s((function(i){if(!e.canceled)return i?t(i):void c((function(i){if(!e.canceled){if(i)return t(i);t(void 0,a+="</body></html>")}}))}))}i.d(t,"a",(function(){return o}))},"./src/js/printer/renderTableHTML.js":function(e,t,i){"use strict";function o(e){var t=e.cols,i=e.rows,o=e.models,n=e.groups,a=e.foot,s=e.cidxGroup,r=e.type,l="";l+='<!DOCTYPE HTML>\r\n<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"/><style type="text/css">body {font-family:Sans-Serif;font-size:10pt}h1 {text-align:center}table {width:100%;empty-cells:show;border-spacing:0;border-collapse:collapse;border:solid thin black}td, th {padding:.5em;border:solid thin black;height:1.5em}td.cell-number {text-align:right}td.cell-date {text-align:center}td.cell-boolean {text-align:center}td.cell-choice {text-align:left}td.cell-fn {text-align:right}tfoot tr {border-top:double}</style></head><body>',l+="<h1>"+htmlEscape(r.caption)+"</h1>",l+="<table>",l+="<thead>",l+="<tr>";for(var c=0;c<t.length;c++){var d=t[c];l+="<th>"+htmlEscape(d.caption||d.expression.caption)+"</th>"}l+="</tr>",l+="</thead>",l+="<tbody>";for(c=0;c<i.length;c++){var h=i[c],p=n[h];if(p){l+="<tr>";for(var u=0;u<t.length;u++){d=t[u];if(u===s){var f=p.values[u],m=d.field.format(f);l+='<td class="cell-'+d.field.base+'">'+htmlEscape(m)+"</td>"}else if(d.agg){f=p.values[u],m=d.aggType.format(f);l+='<td class="cell-'+d.aggType.base+'">',l+="<span>"+htmlEscape(m)+"</span>",l+="</td>"}else l+="<td></td>"}l+="</tr>"}else{var g=o[h];l+="<tr>";for(u=0;u<t.length;u++){d=t[u],f=g.values[u],m=d.field.format(f);l+='<td class="cell-'+d.field.base+'">'+htmlEscape(m)+"</td>"}l+="</tr>"}}l+="</tbody>",l+="<tfoot>",l+="<tr>";var v=0;for(u=0;u<t.length;u++){if((d=t[u]).agg){f=a.values[u],m=d.aggType.format(f);l+='<td class="cell-'+d.aggType.base+'">',l+="<span>"+htmlEscape(m)+"</span>",l+="</td>"}else l+="<td></td>"}return v>0&&$trfoot.appendTo($tfoot),l+="</tr>",l+="</tfoot>",l+="</table>",l+="</body></html>"}i.d(t,"a",(function(){return o}))},"./src/js/reports/ActionMenu.js":function(e,t,i){"use strict";function o(e){var t=this;this.designer=e,this.$actions=e.$titleMenuCenter,$('<div class="button i-40-24 i-light-grey i-plus" title="'+htmlEscape(locale.add)+'">').appendTo(this.$actions).click((function(t){e.insertObject(t)})),this.$trash=$('<div class="button i-40-24 i-light-grey i-setting-trash" title="'+htmlEscape(locale.remove)+'">').appendTo(this.$actions).click((function(){e.removeSelection()})),this.$moveToFront=$('<div class="button i-40-24 i-light-grey i-move-to-front" title="'+htmlEscape(locale.moveToFront)+'">').appendTo(this.$actions).click((function(){e.moveToFront()})),this.$moveToBack=$('<div class="button i-40-24 i-light-grey i-move-to-back" title="'+htmlEscape(locale.moveToBack)+'">').appendTo(this.$actions).click((function(){e.moveToBack()})),this.$select=$('<div class="button i-40-24 i-light-grey i-select" title="'+htmlEscape(locale.select)+'">').appendTo(this.$actions).click((function(){t.$select.addClass("active"),e.startSelect((function(){t.$select.removeClass("active")}))})),this.$duplicate=$('<div class="button i-40-24 i-light-grey i-setting-copy" title="'+htmlEscape(locale.duplicate)+'">').appendTo(this.$actions).click((function(){e.duplicate()})),this.updateUI()}i.d(t,"a",(function(){return o})),o.prototype.updateUI=function(){var e=this.designer,t=e.selection,i=e.multiSelection;t||i?(this.$trash.css("opacity","1"),this.$moveToFront.css("opacity","1"),this.$moveToBack.css("opacity","1")):(this.$trash.css("opacity","0.2"),this.$moveToFront.css("opacity","0.2"),this.$moveToBack.css("opacity","0.2")),t||i&&i.length?this.$duplicate.css("opacity","1"):this.$duplicate.css("opacity","0.2")}},"./src/js/reports/ColorMenu.js":function(e,t,i){"use strict";function o(e){var t=this;this.designer=e,this.$el=$('<div class="rd-menu-bar center">').appendTo(e.$menu),this.$bg=$('<div class="rd-menu-button rd-backgroundcolor">').hide().appendTo(this.$el).click((function(){new n({offset:t.$bg.offset(),update:function(i){e.selection&&e.selection.setBackgroundColor&&e.selection.setBackgroundColor(i),t.updateUI()}})})),this.$bgColor=$('<dic class="rd-backgroundcolor-color">').appendTo(this.$bg),this.$border=$('<div class="rd-menu-button rd-bordercolor">').hide().appendTo(this.$el).click((function(){t.popupBorder()})),this.$borderColor=$('<dic class="rd-bordercolor-color">').appendTo(this.$border),this.$text=$('<div class="rd-menu-button rd-textcolor">').hide().appendTo(this.$el).click((function(){new n({offset:t.$text.offset(),update:function(i){e.selection&&e.selection.setTextColor&&e.selection.setTextColor(i),t.updateUI()}})})),this.$textColor=$('<div class="rd-textcolor-color i-32-24 i-light-grey i-field-string">').appendTo(this.$text),this.updateUI()}function n(e){var t=e.update,i=12,o=12,n=i*o,a=$.backplane({autoClose:!0}),s=$('<div class="colorselector-menu">').appendTo(a),r=$('<table class="colorselector-table">').appendTo(s),l=$("<tbody>").appendTo(r),c=$("<tr>").appendTo(l),d=$('<td colspan="'+i+'">').appendTo(c);$('<div class="colorselector-default">').text(locale.noColor).appendTo(d).touch((function(){a.close(),t(null)}));for(var h=0;h<n;h++)h%i==0&&(c=$("<tr>").appendTo(l)),d=$("<td>").appendTo(c),$('<div class="color-icon">').css({backgroundColor:util.indexedColorRGBA(h,i,o)}).data("colorIndex",h).appendTo(d).click((function(){var e=util.indexedColorRGBA($(this).data("colorIndex"),i,o);a.close(),t(e)}));var p=s.outerWidth(),u=s.outerHeight(),f=e.offset;f.top+=32,f.left+p>window.getWidth()&&(f.left=window.getWidth()-p),f.top+u>window.getHeight()&&(f.top=window.getHeight()-u),s.offset(f)}i.d(t,"a",(function(){return o})),o.prototype.updateUI=function(){var e=this.designer.selection;if(e){if(e.setBackgroundColor?(this.$bgColor[0].style.backgroundColor=e.backgroundColor||"",this.$bg.show()):this.$bg.hide(),e.setBorder){var t=this.$border[0],i=this.$borderColor[0];t.style.backgroundColor=e.backgroundColor||"",i.style.borderColor=e.borderColor||"",i.style.borderWidth=e.borderWidth||"",i.style.borderStyle=e.borderStyle||"",i.style.borderRadius=e.borderRadius||"",this.$border.show()}else this.$border.hide();e.setTextColor?(this.$text[0].style.backgroundColor=e.backgroundColor||"",this.$textColor[0].style.color=e.textColor||"",this.$text.show()):this.$text.hide(),this.$el.show()}else this.$el.hide()},o.prototype.popupBorder=function(){var e=this,t=$.backplane({autoClose:!0}),i=$('<div class="nx-menu-popup grey" style="width:200px">').appendTo(t),o=$("<div>").appendTo(i);$('<div class="rd-menu-label" style="width:100px">').text(locale.border).appendTo(o);var a=$('<div class="rd-menu-button rd-backgroundcolor">').appendTo(o).click((function(){new n({offset:a.offset(),update:function(t){e.designer.setBorder(t,void 0,void 0,void 0),u()}})})),s=$("<div>").appendTo(i);$('<div class="rd-menu-label" style="width:100px">').text(locale.width).appendTo(s);var r=$('<input type="number" class="rd-borderwidth">').appendTo(s).change((function(){var t=Number(r.val());(isNaN(t)||t<=0)&&(t=1),e.designer.setBorder(void 0,void 0,t,void 0),u()})),l=$("<div>").appendTo(i);$('<div class="rd-menu-label" style="width:100px">').text(locale.radius).appendTo(l);var c=$('<input type="number" class="rd-borderradius">').appendTo(l).change((function(){var t=Number(c.val());(isNaN(t)||t<=0)&&(t=0),e.designer.setBorder(void 0,void 0,void 0,t),u()}));u();var d=i.outerWidth(),h=i.outerHeight(),p=e.$border.offset();function u(){e.updateUI();var t=e.designer.selection;a[0].style.backgroundColor=t&&t.borderColor||"",r.val(t&&t.borderWidth||""),c.val(t&&t.borderRadius||"0"),t&&t.borderColor?s.show():s.hide()}p.top+=32,p.left+d>window.getWidth()&&(p.left=window.getWidth()-d),p.top+h>window.getHeight()&&(p.top=window.getHeight()-h),i.offset(p)}},"./src/js/reports/Designer.jsx":function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return x}));i("./node_modules/core-js/modules/web.immediate.js"),i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./src/react/util/FastClickContainer.tsx"),n=i("./node_modules/react/index.js"),a=i("./node_modules/react-dom/index.js"),s=i("./src/react/SimpleTabSelectionRow.tsx"),r=i("./src/js/reports/ActionMenu.js"),l=i("./src/js/reports/ObjectMenu.js"),c=i("./src/js/reports/PaperMenu.js"),d=i("./src/js/reports/ColorMenu.js"),h=i("./src/js/reports/TextMenu.js"),p=i("./src/js/reports/RDHTML.js"),u=i("./src/js/reports/RDImage.js"),f=i("./src/js/reports/RDImageField.js"),m=i("./src/js/reports/RDReverse.js"),g=i("./src/js/reports/RDText.js"),v=i("./src/js/admin/FunctionEditor.js"),y=i("./src/js/widgets/Field.js"),b=i("./node_modules/underscore/underscore.js"),w=i("./src/react/util/Track.ts");function x(e,t){reports.designer&&reports.designer.destroy(),this.options=t,this.nid=t.nid,this.nids=t.nids||[];var i=t.empty;this.invisible=!!(t.printOneAndClose||t.printAllAndClose||t.saveToFileAndClose);var o=this;if(this.id=e.id||util.createUUID(12),this.tid=e.tid,this.type=database.schema.types[e.tid],this.type){this.caption=e.caption||this.type.caption,this.isEnabled=database.canSaveReport(),this.isDirty=!1,this.objects=[],this.paperWidth=void 0!==e.paperWidth?e.paperWidth:210,this.paperHeight=void 0!==e.paperHeight?e.paperHeight:297,this.marginL=void 0!==e.marginL?e.marginL:20,this.marginR=void 0!==e.marginR?e.marginR:20,this.marginT=void 0!==e.marginT?e.marginT:10,this.marginB=void 0!==e.marginB?e.marginB:10,this.footHeight=void 0!==e.footHeight?e.footHeight:10,this.headHeight=void 0!==e.headHeight?e.headHeight:10,this.printAttachments=!0===e.printAttachments,this.footY=this.paperHeight-this.marginB-this.footHeight,this.fontFamily=e.fontFamily||"Helvetica",this.fontSize=e.fontSize||10,this.reports=[],this.startSelectCallback=null,this.selection=null,this.multiSelection=null,this.multiSelectionX=null,this.multiSelectionY=null,this.mode=null,this.mouseState=null,this.mouseDirection=null,this.mouseDownX=0,this.mouseDownY=0,this.mouseObject=null,this.mouseObjectX=0,this.mouseObjectY=0,this.mouseObjectW=0,this.mouseObjectH=0,this.mouseObjectOldH=0,this.snapsX=[],this.snapsY=[],this.setupControls(),this.setupViewport(),this.isEnabled&&(this.actionMenu=new r.a(this),this.objectMenu=new l.a(this),this.colorMenu=new d.a(this),this.textMenu=new h.a(this),this.paperMenu=new c.a(this)),this.scale=this.paperWidth/this.$paper.width(),this.resize=$.proxy(this.resize,this),this.resize(),$(window).on("resize",this.resize);var n=e.objects;if(n)for(var a=0;a<n.length;a++)try{this.createObject(n[a])}catch(e){console.log(e)}else i||this.autoLayout();$.pushInputHandler(this),reports.designer=this,$.loading(!0),o.load((function(){o.init(),t.printOneAndClose?o.printSingle((function(){$.loading(!1),o.destroy(),"function"==typeof t.printOneAndClose&&t.printOneAndClose()})):t.printAllAndClose?o.printAll((function(){$.loading(!1),o.destroy(),"function"==typeof t.printAllAndClose&&t.printAllAndClose()})):t.saveToFileAndClose?o.printSingleToFile((function(e,i){$.loading(!1),o.destroy(),"function"==typeof t.saveToFileAndClose&&t.saveToFileAndClose(e,i)})):($.loading(!1),!e.id&&database.canSaveReport()?o.saveReport((function(e){e&&$.alert(e),o.loadReports()})):o.loadReports())})),this.rightOpen=ui.fullWidth>680,this.setRight()}}function T(e,t){var i=void 0,o=!0;return b.each(e,(function(e){void 0===i?i=e[t]:i!==e[t]&&(o=!1)})),o?i:void 0}function C(e,t){var i=!0;return b.each(e,(function(e){!0,i=i&&!0})),i}x.prototype.setupControls=function(){var e=this;this.$pane=$('<div class="rd-pane">').css("visibility",this.invisible?"hidden":"").appendTo($(document.body));var t=$('<div class="rd-title">').appendTo(this.$pane),i=$('<div class="rd-menu">').appendTo(this.$pane);this.$menu=i;var o=$('<div class="rd-title-menu-center">').appendTo(i);this.$titleMenuCenter=o,$('<div class="i-32-24 i-white i-line-left-medium">').touch((function(){e.destroyIfSaved((function(){}))})).appendTo($('<div style="border-right:solid 1px #FFFFFF22;margin:8px 0 8px 0;padding:0 8px 0 4px;height:32px">').appendTo(t)),this.$tabs=$("<div>").appendTo($('<div class="rd-tabs">').appendTo(t));var n=$('<div class="rd-title-buttons">').appendTo(t);$('<div class="nx-button-text grey" style="display:flex;display:-webkit-flex"><div class="i-32-24 i-light-grey i-setting-print" style="margin:0 4px 0 -8px"/><span>'+locale.print+"</span></div>").appendTo(n).touch(e=>this.print(e)),n.button2({icon:"i-32-24 i-white i-setting-side-menu-right",click:()=>this.toggleRight()})},x.prototype.toggleRight=function(){this.rightOpen=!this.rightOpen,this.setRight()},x.prototype.setRight=function(){this.rightOpen?(this.$menu.css("display",""),this.$viewport.css("right","256px")):(this.$menu.css("display","none"),this.$viewport.css("right","0"))},x.prototype.setupViewport=function(){this.$viewport=$('<div class="rd-viewport">').appendTo(this.$pane),this.isEnabled||(this.$menu.css("display","none"),this.$viewport.css("right","0")),this.$paper=$('<div class="rd-paper">').css({"font-family":this.fontFamily,"font-size":this.fontSize+"pt"}).appendTo(this.$viewport).click($.proxy(this.paperClicked,this)),this.$paper.on("mousedown touchstart",$.proxy(this.paperMousedown,this)).on("mouseup touchend",$.proxy(this.paperMouseup,this)).on("mousemove touchmove",$.proxy(this.paperMousemove,this)),this.$marginL=$('<div class="rd-paper-margin-l">').appendTo(this.$paper),this.$marginR=$('<div class="rd-paper-margin-r">').appendTo(this.$paper),this.$marginT=$('<div class="rd-paper-margin-t">').appendTo(this.$paper),this.$marginB=$('<div class="rd-paper-margin-b">').appendTo(this.$paper),this.$head=$('<div class="rd-paper-head">').appendTo(this.$paper),this.$foot=$('<div class="rd-paper-foot">').appendTo(this.$paper),this.$snapX=$('<div class="rd-paper-snap-x">').hide().appendTo(this.$paper),this.$snapY=$('<div class="rd-paper-snap-y">').hide().appendTo(this.$paper),this.$selector=$('<div class="rd-paper-selector">').hide().appendTo(this.$paper)},x.prototype.load=function(t){var i=this.objects;if(!i.length)return e(t);for(var o=0,n=0;n<i.length;n++)i[n].load((function(){++o===i.length&&e(t)}))},x.prototype.init=function(){for(var e=b.sortBy(this.objects,"y"),t=0;t<e.length;t++){var i=e[t];if(i.init(),!i.isHead()&&!i.isFoot()){var o=i.y+i.h;o>this.footY&&(this.footY=Math.ceil(o))}}for(let t=0;t<e.length;t++)e[t].updateAutoHeight();this.updatePaper(),this.updateMenus()},x.prototype.destroy=function(){$(window).off("resize",this.resize),$.popInputHandler(this),this.$pane.remove(),this.$tabs&&a.unmountComponentAtNode(this.$tabs[0]),reports.designer=void 0},x.prototype.destroyIfSaved=function(e){var t=this;t.saveIfUnsaved((function(i){i&&(t.destroy(),e())}))},x.prototype.saveIfUnsaved=function(e){if(!database.canSaveReport())return e(!0);var t=this;t.isDirty?$.dialog({closable:!1,caption:locale.saveReport,message:locale.confirmSaveReport,buttons:[{color:"grey float-left",caption:locale.cancel,callback:function(){e(!1)}},{color:"grey",caption:locale.no,callback:function(){e(!0)}},{color:"blue",caption:locale.yes,callback:function(){t.saveReport((function(t){t&&$.alert(t),e(!0)}))}}]}):e(!0)},x.prototype.loadReports=function(){var e=this;database.listReports((function(t,i){var o=[];b.each(util.localeSortBy(i,"caption"),(function(t){t.tid===e.type.id&&o.push(t)})),e.reports=o,e.updateUI()}))},x.prototype.updateUI=function(){if(!this.$tabs)return;const e=this.reports.map((e,t)=>({id:e.id,isSelected:e.id===this.id,text:e.caption}));a.render(n.createElement(s.a,{popupItemBackground:"OFF_WHITE",onNewItemClick:this.isEnabled?()=>this.createReport():null,items:e,currentItemId:this.id,onContextMenuClick:(e,t)=>this.tabsContextMenu(t,e),onItemSelect:(e,t)=>this.tabsClicked(t,e)}),this.$tabs[0])},x.prototype.tabsClicked=function(e,t){t===this.id?this.popupReportMenu(t,e):this.destroyIfSaved(()=>{reports.openDesigner({nid:this.nid,reportId:t,nids:this.nids})})},x.prototype.tabsContextMenu=function(e,t){TOUCH||(this.popupReportMenu(t,e),e.preventDefault())},x.prototype.popupReportMenu=function(e,t){if(this.isEnabled){var i=this,n=$.backplane({autoClose:!0});if(t){var a=$('<div class="nx-menu-popup" style="white-space:nowrap">').appendTo(n);$('<div class="nx-menu-item">').text(locale.new).appendTo(a).click(l),e===i.id&&($('<div class="nx-menu-item">').text(locale.save).appendTo(a).click(d),$('<div class="nx-menu-item">').text(locale.saveAs+"...").appendTo(a).click(h),$('<div class="nx-menu-item">').text(locale.rename+"...").appendTo(a).click(c)),$('<div class="nx-menu-item">').text(locale.remove).appendTo(a).click(p);var s=a.outerWidth(),r=a.outerHeight();const u=o.b.getPosition(t),f={left:u.x,top:u.y};f.left+s>window.getWidth()&&(f.left=window.getWidth()-s),f.top+r>window.getHeight()&&(f.top=window.getHeight()-r),a.offset(f)}}function l(){n.close(),i.createReport()}function c(){n.close(),i.renameReport()}function d(){n.close(),i.saveReport((function(e){e&&$.alert(e)}))}function h(){n.close(),i.saveReportAs()}function p(){n.close(),$.dialog({closable:!0,caption:locale.remove,message:locale.confirmRemoveFile,buttons:[{color:"red",caption:locale.remove,callback:function(){i.removeReport(e)}}]})}},x.prototype.setPaper=function(e,t,i,o,n,a,s,r){if(e>0&&t>0&&r>=0&&s>=0&&n>=0&&a>=0&&i>=0&&o>=0&&e>i+o&&t>a+n){for(var l=this.objects,c=n-this.marginT,d=n+s-(this.marginT+this.headHeight),h=i-this.marginL,p=0;p<l.length;p++){var u=l[p];u.isHead()?u.setRect(u.x+h,u.y+c,void 0,void 0,!0):u.isFoot()||u.setRect(u.x+h,u.y+d,void 0,void 0,!0)}this.marginT=n,this.marginB=a,this.marginL=i,this.marginR=o,this.paperWidth=e,this.paperHeight=t,this.headHeight=s,this.footHeight=r,this.updatePaper(),this.setDirty()}},x.prototype.autoHeightWillChange=function(e,t,i){if("resize"!==this.mouseState){var o=this.marginT,n=this.marginB,a=(this.marginL,this.marginR,this.paperWidth,this.paperHeight),s=this.headHeight,r=this.footHeight,l=this.footY,c=a-n-r,d=b.sortBy(this.objects,"y"),h=e.y,p=e.y+t,u=(e.y,i-t);if(!(h<o+s||h>=l)){var f=[],m=null,g=1/0,v=Math.ceil(u);if(u<0)for(var y=0;y<d.length;y++){var w=d[y];if(w!==e&&!w.isHead()&&!w.isFoot()){var x=w.y,T=w.y+w.h;x<p&&T>p&&T<g&&(m=w,g=T)}}for(let t=0;t<d.length;t++){const i=d[t],o=i.y,n=i.y+i.h;if(o<l&&n>c&&(c=Math.ceil(n)),i!==e&&i!==m)if(i.isHead());else if(i.isFoot())f.push(i);else if(o>=p&&o<g){var C=o+v,k=C+i.h;i.setRect(void 0,C,void 0,void 0,!0),k>c&&(c=Math.ceil(k))}}var $=c-l;for(let e=0;e<f.length;e++){const t=f[e];t.setRect(void 0,t.y+$,void 0,void 0,!0)}this.footY=c}}},x.prototype.updatePaper=function(){for(var e=this.objects,t=this.marginT,i=this.marginB,o=this.marginL,n=this.marginR,a=this.paperWidth,s=this.paperHeight,r=this.headHeight,l=this.footHeight,c=this.footY,d=s-i-l,h=0;h<e.length;h++){var p=e[h];if(!p.isHead()&&!p.isFoot()){p.y;var u=p.y+p.h;u>d&&(d=Math.ceil(u))}}var f=d-c;for(let t=0;t<e.length;t++){const i=e[t];i.isFoot()&&i.setRect(void 0,i.y+f)}this.footY=d,this.$paper.css({height:d+i+l+"mm",width:a+"mm"}),this.$marginL.css({top:t+"mm",bottom:i+"mm",left:o+"mm"}),this.$marginR.css({top:t+"mm",bottom:i+"mm",right:n+"mm"}),this.$marginT.css({left:o+"mm",right:n+"mm",top:t+"mm"}),this.$marginB.css({left:o+"mm",right:n+"mm",bottom:i+"mm"}),this.$head.css({top:t+r+"mm",left:o+"mm",right:n+"mm"}),this.$foot.css({bottom:i+l+"mm",left:o+"mm",right:n+"mm"})},x.prototype.autoLayout=function(){var e,t,i,o=this.type.sorted,n=20,a=this.paperWidth-this.marginL-this.marginR,s=this.marginL,r=Math.round(a/3)-2,l=s+r+4,c=this.marginL+a-l;console.log("auto layout");for(var d=0;d<o.length;d++)"file"===(e=o[d]).base?(t=this.createObject({base:"imagefield",position:"page",x:s,y:n,w:a,h:60,fid:e.id}),n+=Math.ceil(Math.max(0,t.h)+2)):"html"===e.base?(i=this.createObject({base:"text",isAutoHeight:!1,position:"page",x:s,y:n,w:r,h:6,text:e.caption,textAlign:"right",fontWeight:"bold"}),t=this.createObject({base:"html",isAutoHeight:!0,position:"page",x:l,y:n,w:c,h:6,fn:e.id}),n+=Math.ceil(Math.max(0,Math.max(t.h,i.h))+2)):e.isField?(i=this.createObject({base:"text",isAutoHeight:!1,position:"page",x:s,y:n,w:r,h:6,text:e.caption,textAlign:"right",fontWeight:"bold"}),t=this.createObject({base:"text",isAutoHeight:!!e.stringMultiline,position:"page",x:l,y:n,w:c,h:6,text:"{"+e.id+"}"}),n+=Math.ceil(Math.max(0,Math.max(t.h,i.h))+2)):e.isReverse?(i=this.createObject({base:"text",isAutoHeight:!1,position:"page",x:s,y:n,w:a,h:6,text:e.caption,textAlign:"left",fontWeight:"bold"}),n+=Math.ceil(Math.max(0,i.h)),t=this.createObject({base:"rev",position:"page",x:s,y:n,w:a,h:6,expression:e.id,tableBorderStyle:5}),n+=Math.ceil(Math.max(0,Math.max(t.h,i.h))+2)):"head"!==e.base&&"tab"!==e.base||(i=this.createObject({base:"text",isAutoHeight:!1,position:"page",x:s,y:n,w:a,h:6,text:e.caption,textAlign:"center",fontWeight:"bold"}),n+=Math.ceil(Math.max(0,i.h)+2));n>this.footY&&(this.footY=Math.ceil(n)),this.createObject({base:"text",isAutoHeight:!1,position:"head",x:this.marginL,y:this.marginT,w:a/3,h:6,text:this.type.caption+" {_id}",textAlign:"left"}),this.createObject({base:"text",isAutoHeight:!1,position:"head",x:this.paperWidth-this.marginR-a/3,y:this.marginT,w:a/3,h:6,text:database.name,textAlign:"right"}),this.createObject({base:"text",isAutoHeight:!1,position:"foot",x:this.marginL,y:this.footY,w:a/3,h:6,text:"{now()}",textAlign:"left"}),this.createObject({base:"text",isAutoHeight:!1,position:"foot",x:this.paperWidth-this.marginR-a/3,y:this.footY,w:a/3,h:6,text:"$page / $pages",textAlign:"right"})},x.prototype.createAndSelectObject=function(e){var t=this,i=t.createObject(e);i&&($.loading(!0),i.load((function(){i.init(),i.patchAutoHeight(),t.updatePaper(),t.select(i),t.setDirty(),$.loading(!1)})))},x.prototype.createObject=function(e){var t=null;switch(e.base){case"rev":t=new m.a(this,e);break;case"image":t=new u.a(this,e);break;case"imagefield":t=new f.a(this,e);break;case"text":t=new g.a(this,e);break;case"html":t=new p.a(this,e)}return t&&this.objects.push(t),t},x.prototype.resize=function(){var e=this.$viewport.width(),t=this.$paper.width(),i=Math.max(0,Math.round((e-t)/2));isNaN(i)&&(i=0),this.$paper[0].style.left=i+"px"},x.prototype.toJSON=function(){for(var e={id:this.id,tid:this.tid,caption:this.caption,paperWidth:this.paperWidth,paperHeight:this.paperHeight,marginL:this.marginL,marginR:this.marginR,marginT:this.marginT,marginB:this.marginB,headHeight:this.headHeight,footHeight:this.footHeight,fontFamily:this.fontFamily,fontSize:this.fontSize,printAttachments:this.printAttachments,objects:[]},t=0;t<this.objects.length;t++)e.objects.push(this.objects[t].toJSON());return e},x.prototype.paperClicked=function(e){},x.prototype.paperMousedown=function(e){if(this.isEnabled){if("edit"!==this.mouseState&&this.$menu.find(":focus").blur(),e.touches)if(this.mouseState){if("down"===this.mouseState){if(1!==e.touches.length)return this.mouseState=null,this.mouseObject=null,void(this.startSelectCallback&&(this.startSelectCallback(),this.startSelectCallback=null))}else if(1!==e.touches.length)return}else if(1!==e.touches.length)return;if("start-select"===this.mouseState){this.mouseState="select",this.mouseDownX=e.clientX,this.mouseDownY=e.clientY;var t=this.$selector[0],i=this.$paper.offset();t.style.left=this.mouseDownX-i.left+"px",t.style.top=this.mouseDownY-i.top+"px",t.style.width="0px",t.style.height="0px",t.style.display="block",e.preventDefault()}if(!this.mouseState){var o=$(e.target),n=o.closest(".rd-object").data("object");this.mouseDownX=e.clientX,this.mouseDownY=e.clientY,n?(this.mouseObject=n,o.is(".rd-object-resizer")?(this.mouseState="resize",this.mouseObjectX=this.mouseObject.x,this.mouseObjectY=this.mouseObject.y,this.mouseObjectW=this.mouseObject.w,this.mouseObjectH=this.mouseObject.h,this.mouseObjectOldH=this.mouseObjectH,this.mouseDirection=o.data("dir"),this.snapBegin()):this.mouseState="down",e.preventDefault()):TOUCH||(this.mouseState="down",this.mouseObject=null,e.preventDefault())}}},x.prototype.paperMousemove=function(e){if(this.isEnabled&&(!e.touches||1===e.touches.length)){var t=e.clientX,i=e.clientY,o=t-this.mouseDownX,n=i-this.mouseDownY;if("down"===this.mouseState){if(o*o+n*n>25)if(this.mouseObject)if(this.multiSelection&&-1!==this.multiSelection.indexOf(this.mouseObject)){this.mouseState="multi-drag";for(var a=this.multiSelection,s=this.multiSelectionX=[],r=this.multiSelectionY=[],l=0;l<a.length;l++)s[l]=a[l].x,r[l]=a[l].y}else TOUCH||this.selection===this.mouseObject||this.select(this.mouseObject),this.selection===this.mouseObject&&(this.mouseState="drag",this.mouseObjectX=this.mouseObject.x,this.mouseObjectY=this.mouseObject.y,this.snapBegin());else if(!TOUCH){this.mouseState="select";var c=this.$selector[0],d=this.$paper.offset();c.style.left=this.mouseDownX-d.left+"px",c.style.top=this.mouseDownY-d.top+"px",c.style.width="0px",c.style.height="0px",c.style.display="block"}e.preventDefault()}else if("drag"===this.mouseState)this.mouseObject.setRect(this.mouseObjectX+o*this.scale,this.mouseObjectY+n*this.scale),this.snap(),this.updateObjectMenu(),e.preventDefault();else if("multi-drag"===this.mouseState){const t=this.multiSelection,i=this.multiSelectionX,a=this.multiSelectionY;for(let e=0;e<t.length;e++)t[e].setRect(i[e]+o*this.scale,a[e]+n*this.scale);this.updateObjectMenu(),e.preventDefault()}else if("resize"===this.mouseState){var h=this.mouseDirection,p="l"===h||"tl"===h||"bl"===h,u="r"===h||"tr"===h||"br"===h,f="t"===h||"tl"===h||"tr"===h,m="b"===h||"bl"===h||"br"===h,g=p?this.mouseObjectX+o*this.scale:void 0,v=f?this.mouseObjectY+n*this.scale:void 0,y=p?this.mouseObjectW-o*this.scale:u?this.mouseObjectW+o*this.scale:void 0,b=f?this.mouseObjectH-n*this.scale:m?this.mouseObjectH+n*this.scale:void 0;this.rescale(this.mouseObject,g,v,y,b,!0),this.snap(),this.updateObjectMenu(),e.preventDefault()}else if("select"===this.mouseState){const a=this.$selector[0],s=this.$paper.offset();var w=(o<0?t:this.mouseDownX)-s.left,x=(n<0?i:this.mouseDownY)-s.top,T=Math.abs(o),C=Math.abs(n);a.style.left=w+"px",a.style.top=x+"px",a.style.width=T+"px",a.style.height=C+"px",e.preventDefault()}}},x.prototype.paperMouseup=function(e){if(this.isEnabled&&(!e.touches||!(e.touches.length>0||1!==e.changedTouches.length))){var t=e.clientX,i=e.clientY,o=t-this.mouseDownX,n=i-this.mouseDownY,a=this.mouseState,s=this.mouseObject;if("down"===a){if(e.shiftKey){var r=this.multiSelection,l=this.selection;if(r){var c=r.indexOf(s);if(-1!==c){const e=r.slice();e.splice(c,1),this.multiSelect(e)}else{const e=r.slice();e.push(s),this.multiSelect(e)}}else if(l&&l!==s){var d=[l,s];this.multiSelect(d)}this.mouseObject=null,this.mouseState=null}else s?s!==this.selection?(this.select(s),this.mouseObject=null,this.mouseState=null):s.startEdit?(s.startEdit(),TOUCH?(this.mouseObject=null,this.mouseState=null):this.mouseState="edit"):(this.mouseObject=null,this.mouseState=null):(this.select(null),this.mouseObject=null,this.mouseState=null);e.preventDefault()}else if("edit"===a){$(e.target).closest(".rd-object").data("object")!==s&&this.stopEdit()}else if("drag"===a)"page"===s.position?s.y<this.marginT+this.headHeight?s.position="head":s.y>this.footY&&(s.position="foot"):"head"===s.position?s.y>=this.marginT+this.headHeight&&(s.position="page"):"foot"===s.position&&s.y<this.footY&&(s.position="page"),this.rescale(s,s.x,s.y,s.w,s.h,!1),this.mouseObject=null,this.mouseState=null,this.snapDone(),this.updatePaper(),this.updateObjectMenu(),this.setDirty(),e.preventDefault();else if("multi-drag"===a)this.mouseObject=null,this.mouseState=null,this.multiSelectionX=null,this.multiSelectionY=null,this.snapDone(),this.updatePaper(),this.updateObjectMenu(),this.setDirty(),e.preventDefault();else if("resize"===a)this.rescale(s,s.x,s.y,s.w,s.h,!1),this.mouseObject=null,this.mouseState=null,this.snapDone(),this.updatePaper(),this.updateObjectMenu(),this.setDirty(),e.preventDefault();else if("select"===a){this.$selector[0].style.display="none",this.mouseState=null;var h=this.$paper.offset(),p=(o<0?t:this.mouseDownX)-h.left,u=(n<0?i:this.mouseDownY)-h.top,f=Math.abs(o),m=Math.abs(n),g=p*this.scale,v=u*this.scale,y=(p+f)*this.scale,b=(u+m)*this.scale;const a=[];var w=this.objects;for(let e=0;e<w.length;e++){const t=w[e];var x=t.x,T=t.y,C=t.x+t.w,k=t.y+t.h;x>y||C<g||T>b||k<v||a.push(t)}this.multiSelect(a,e.shiftKey),this.startSelectCallback&&(this.startSelectCallback(),this.startSelectCallback=null),e.preventDefault()}else this.select(null),e.preventDefault()}},x.prototype.stopEdit=function(){"edit"===this.mouseState&&(this.mouseObject.stopEdit(),this.mouseObject=null,this.mouseState=null,this.select(null))},x.prototype.snapBegin=function(){for(var e=this.mouseObject,t=this.objects,i=[0,this.marginL,this.paperWidth-this.marginR,this.paperWidth,this.marginL+(this.paperWidth-this.marginR-this.marginL)/2],o=[0,this.marginT,this.marginT+this.headHeight,this.footY,this.footY+this.footHeight,this.footY+this.footHeight+this.marginB],n=0;n<t.length;n++){var a=t[n];e!==a&&(i.push(Math.floor(a.x)),i.push(Math.round(a.x+a.w/2)),i.push(Math.ceil(a.x+a.w)),o.push(Math.floor(a.y)),o.push(Math.round(a.y+a.h/2)),o.push(Math.ceil(a.y+a.h)))}i.sort((function(e,t){return e-t})),o.sort((function(e,t){return e-t})),this.snapsX=i,this.snapsY=o},x.prototype.snapDone=function(){this.$snapX.hide(),this.$snapY.hide()},x.prototype.snap=function(){for(var e=.5,t=this.mouseObject,i=this.snapsX,o=t.x,n=t.x+t.w,a=t.x+t.w/2,s=null,r=void 0,l=void 0,c=void 0,d=void 0,h=this.mouseDirection,p="l"===h||"tl"===h||"bl"===h,u="r"===h||"tr"===h||"br"===h,f="t"===h||"tl"===h||"tr"===h,m="b"===h||"bl"===h||"br"===h,g=0;g<i.length;g++){var v=i[g];if(Math.abs(o-v)<e){if("drag"===this.mouseState){s=v,r=v;break}if("resize"===this.mouseState&&p){s=v,r=v,c=t.w+t.x-v;break}}if(Math.abs(a-v)<e&&"drag"===this.mouseState){s=v,r=v-t.w/2;break}if(Math.abs(n-v)<e){if("drag"===this.mouseState){s=v,r=v-t.w;break}if("resize"===this.mouseState&&u){s=v,c=v-t.x;break}}}null!==s?(this.$snapX[0].style.left=s+"mm",this.$snapX[0].style.display="block"):this.$snapX[0].style.display="none";var y=this.snapsY,b=t.y,w=t.y+t.h,x=t.y+t.h/2,T=null;for(let i=0;i<y.length;i++){var C=y[i];if(Math.abs(b-C)<e){if("drag"===this.mouseState){T=C,l=C;break}if("resize"===this.mouseState&&f){T=C,l=C,d=t.h+t.y-C;break}}if(Math.abs(x-C)<e&&"drag"===this.mouseState){T=C,l=C-t.h/2;break}if(Math.abs(w-C)<e){if("drag"===this.mouseState){T=C,l=C-t.h;break}if("resize"===this.mouseState&&m){T=C,d=C-t.y;break}}}null!==T?(this.$snapY[0].style.top=T+"mm",this.$snapY[0].style.display="block"):this.$snapY[0].style.display="none",this.rescale(t,r,l,c,d,!0)},x.prototype.select=function(e){this.multiUnselect(),this.selection&&this.selection.unselect(),this.selection=e,this.selection&&this.selection.select(),this.updateMenus()},x.prototype.multiSelect=function(e,t){if(t){var i=e,o=this.multiSelection;if(e=[],i)for(let t=0;t<i.length;t++){const o=i[t];o&&-1===e.indexOf(o)&&e.push(o)}if(o)for(let t=0;t<o.length;t++){const i=o[t];i&&-1===e.indexOf(i)&&e.push(i)}}if(this.multiUnselect(),e&&0!==e.length)if(1===e.length)this.select(e[0]);else{this.select(null),this.multiSelection=e;for(let t=0;t<e.length;t++)e[t].multiSelect()}else this.select(null);this.updateMenus()},x.prototype.multiUnselect=function(){var e=this.multiSelection;if(e){for(var t=0;t<e.length;t++)e[t].multiUnselect();this.multiSelection=null}this.updateMenus()},x.prototype.updateObjectMenu=function(){this.objectMenu&&this.objectMenu.updateUI()},x.prototype.updateMenus=function(){this.actionMenu&&this.actionMenu.updateUI(),this.objectMenu&&this.objectMenu.updateUI(),this.colorMenu&&this.colorMenu.updateUI(),this.textMenu&&this.textMenu.updateUI(),this.paperMenu&&this.paperMenu.updateUI()},x.prototype.insertObject=function(e){if(this.isEnabled){var t=this,i=t.marginL,o=t.marginR,n=t.paperWidth,a=n-i-o,s=n/t.$paper.width(),r=(t.$viewport.scrollTop()+t.$viewport.height()/2)*s,l=Math.round(a/2)+i,c=$(e.target),d=$.backplane({autoClose:!0}),h=$('<div class="nx-menu-popup" style="max-height:'+(window.getHeight()-64)+'px;overflow-y:auto">').appendTo(d);if($('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-string">')).append($('<div class="nx-menu-label">').text(locale.text)).appendTo(h).click((function(){d.close(),t.createAndSelectObject({base:"text",isAutoHeight:!1,position:"page",x:l-30,y:r-20,w:60,h:40})})),database.sql)$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-file">')).append($('<div class="nx-menu-label">').text(locale.staticImage)).appendTo(h),$('<input type="file" style="display:block;margin-top:-32px;z-index:1;opacity:0;height:32px;width:100%">').appendTo(h).change((function(e){d.close(),t.fileChosen(e)}));else $('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-file">')).append($('<div class="nx-menu-label">').text(locale.staticImage)).appendTo(h).click((function(){d.close(),t.chooseFile()}));$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-fn">')).append($('<div class="nx-menu-label">').text(locale.function)).appendTo(h).click((function(){d.close(),new v.a({schema:t.type.schema,type:t.type,okay:function(e,i){if(e&&i)if("file"!==i.returnType.base||i.isMultiple())if("html"===i.returnType.base)t.createAndSelectObject({base:"html",fn:e,isAutoHeight:!1,position:"page",x:l-30,y:r-20,w:60,h:40});else{var o="{"+e+"}";t.createAndSelectObject({base:"text",text:o,isAutoHeight:!1,position:"page",x:l-30,y:r-20,w:60,h:40})}else t.createAndSelectObject({base:"imagefield",fid:i.toString(),position:"page",x:l-20,y:r-20,w:40,h:40})},cancel:function(){}})})),$("<hr>").appendTo(h),b.each(this.type.sorted,(function(e){"file"===e.base?$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-'+e.base+'">')).append($('<div class="nx-menu-label">').text(e.caption)).appendTo(h).click((function(){d.close(),t.createAndSelectObject({base:"imagefield",fid:e.id,position:"page",x:l-20,y:r-20,w:40,h:40})})):"html"===e.base?$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-'+e.base+'">')).append($('<div class="nx-menu-label">').text(e.caption)).appendTo(h).click((function(){d.close(),t.createAndSelectObject({base:"html",isAutoHeight:!1,fn:e.id,position:"page",x:l-30,y:r-20,w:60,h:40})})):e.isField?$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-'+e.base+'">')).append($('<div class="nx-menu-label">').text(e.caption)).appendTo(h).click((function(){d.close(),"fn"===e.base&&e.exp&&"file"===e.exp.returnType.base&&!e.exp.isMultiple()?t.createAndSelectObject({base:"imagefield",fid:e.id,position:"page",x:l-20,y:r-20,w:40,h:40}):t.createAndSelectObject({base:"text",isAutoHeight:!1,text:"{"+e.id+"}",position:"page",x:l-30,y:r-20,w:60,h:40})})):e.isReference||e.isReverse&&$('<div class="nx-menu-item">').append($('<div class="nx-menu-icon i-32-24 i-light-grey i-field-list">')).append($('<div class="nx-menu-label">').text(e.caption)).appendTo(h).click((function(){d.close(),t.createAndSelectObject({base:"rev",expression:e.id,position:"page",x:i,y:r,w:a,h:1})}))}));var p=h.outerWidth(),u=h.outerHeight(),f=c.offset();f.top+=c.outerHeight(),f.left+p>window.getWidth()&&(f.left=window.getWidth()-p),f.top+u>window.getHeight()&&(f.top=window.getHeight()-u),h.offset(f)}},x.prototype.insertObject_PHONE=function(e){if(this.isEnabled){var t=this,i=t.marginL,o=t.marginR,n=t.paperWidth,a=n-i-o,s=n/t.$paper.width(),r=(t.$viewport.scrollTop()+t.$viewport.height()/2)*s,l=Math.round(a/2)+i,c=[];c.push({caption:locale.text,click:function(){t.createAndSelectObject({base:"text",isAutoHeight:!1,position:"page",x:l-30,y:r-20,w:60,h:40})}}),database.sql?c.push({caption:locale.staticImage,fileChosen:function(e){t.fileChosen(e)}}):(c.push({caption:locale.staticImage,click:function(e){t.chooseFile()}}),c.push({caption:locale.staticImagePhoto,fileChosen:function(e){t.choosePhoto(e)}})),c.push({caption:locale.function,icon:"type-symbol-fn",click:function(){new Function({schema:t.type.schema,type:t.type,okay:function(e){if(e)if("file"!==e.returnType.base||e.isMultiple())if("html"===e.returnType.base)t.createAndSelectObject({base:"html",fn:e.toString(),isAutoHeight:!1,position:"page",x:l-30,y:r-20,w:60,h:40});else{var i="{"+e.toString()+"}";t.createAndSelectObject({base:"text",text:i,isAutoHeight:!1,position:"page",x:l-30,y:r-20,w:60,h:40})}else t.createAndSelectObject({base:"imagefield",fid:e.toString(),position:"page",x:l-20,y:r-20,w:40,h:40})},cancel:function(){}})}}),b.each(this.type.sorted,(function(e){"file"===e.base?c.push({caption:e.caption,icon:"type-symbol-"+e.base,click:function(){t.createAndSelectObject({base:"imagefield",fid:e.id,position:"page",x:l-20,y:r-20,w:40,h:40})}}):"html"===e.base?c.push({caption:e.caption,icon:"type-symbol-"+e.base,click:function(){t.createAndSelectObject({base:"html",isAutoHeight:!1,fn:e.id,position:"page",x:l-30,y:r-20,w:60,h:40})}}):e.isField?c.push({caption:e.caption,icon:"type-symbol-"+e.base,click:function(){"fn"===e.base&&e.exp&&"file"===e.exp.returnType.base&&!e.exp.isMultiple()?t.createAndSelectObject({base:"imagefield",fid:e.id,position:"page",x:l-20,y:r-20,w:40,h:40}):t.createAndSelectObject({base:"text",isAutoHeight:!1,text:"{"+e.id+"}",position:"page",x:l-30,y:r-20,w:60,h:40})}}):e.isReference||e.isReverse&&c.push({caption:e.caption,icon:"type-symbol-list",click:function(){$backplane.close(),t.createAndSelectObject({base:"rev",expression:e.id,position:"page",x:i,y:r,w:a,h:1})}})})),new Menu({head:{caption:locale.createUI},items:c})}},x.prototype.choosePhoto=function(e){if(this.isEnabled){var t=this,i=t.$viewport.scrollLeft()+t.$viewport.width()/2,o=t.$viewport.scrollTop()+t.$viewport.height()/2,n=t.paperWidth/t.$paper.width(),a=e.target.files;if(a&&1===a.length){var s=a[0].name,r=/\.([a-zA-Z0-9]+)$/.exec(s);if(!r)return;var l=r[1],c=util.createLowerUUID(12)+"."+l;database.saveReportFile(t.id,a[0],c,(function(e){if(e)return $.alert(e);t.createAndSelectObject({base:"image",file:c,position:"page",x:Math.round(i*n-30),y:Math.round(o*n-20),w:60,h:40})}))}}},x.prototype.fileChosen=function(e){if(this.isEnabled){var t=this,i=t.$viewport.scrollLeft()+t.$viewport.width()/2,o=t.$viewport.scrollTop()+t.$viewport.height()/2,n=t.paperWidth/t.$paper.width(),a=e.target.files;a&&1===a.length&&database.importReportFile(t.id,a[0],(function(e,a){if(e)return $.alert(e);t.createAndSelectObject({base:"image",file:a,position:"page",x:Math.round(i*n-30),y:Math.round(o*n-20),w:60,h:40})}))}},x.prototype.chooseFile=function(){if(this.isEnabled){var e=this,t=e.$viewport.scrollLeft()+e.$viewport.width()/2,i=e.$viewport.scrollTop()+e.$viewport.height()/2,o=e.paperWidth/e.$paper.width();NinoxDocumentInteraction.chooseFile((function(n,a){if(n)return $.alert(n);a&&database.importReportFile(e.id,a,(function(n,a){if(n)return $.alert(n);e.createAndSelectObject({base:"image",file:a,position:"page",x:Math.round(t*o-30),y:Math.round(i*o-20),w:60,h:40})}))}))}},x.prototype.rescale=function(e,t,i,o,n,a){e.setRect(t,i,o,n,a)},x.prototype.getPosition=function(){var e=this.selection,t=this.multiSelection;if(e)return e.isHead()?"head":e.isFoot()?"foot":"page";if(t&&t.length>0){for(var i=t[0].isHead()?"head":t[0].isFoot()?"foot":"page",o=1;o<t.length;o++){(t[o].isHead()?"head":t[o].isFoot()?"foot":"page")!==i&&(i="")}return i}return""},x.prototype.setPosition=function(e){var t=this.selection,i=this.multiSelection;if(t)t.position=e;else if(i&&i.length>0)for(var o=0;o<i.length;o++)i[o].position=e;this.setDirty(),this.updatePaper()},x.prototype.setAutoHeight=function(e){e=!0===e;var t=this.selection,i=this.multiSelection;if(t)t.setAutoHeight(e);else for(var o=0;o<i.length;o++)i[o].setAutoHeight(e);this.setDirty()},x.prototype.isAutoHeight=function(){var e=this.selection,t=this.multiSelection;if(e)return e.isAutoHeight;if(t&&t.length>0){for(var i=t[0].isAutoHeight,o=1;o<t.length;o++)t[o].isAutoHeight!==i&&(i=void 0);return i}return""},x.prototype.getSelectedObjects=function(){return this.selection?[this.selection]:this.multiSelection},x.prototype.canSetPadding=function(){return C(this.getSelectedObjects(),"setPadding")},x.prototype.setPadding=function(e,t,i,o){b.each(this.getSelectedObjects(),(function(n){n.setPadding&&n.setPadding(e,t,i,o)})),this.setDirty(),this.updateObjectMenu()},x.prototype.getPaddingL=function(){return T(this.getSelectedObjects(),"paddingL")},x.prototype.getPaddingR=function(){return T(this.getSelectedObjects(),"paddingR")},x.prototype.getPaddingT=function(){return T(this.getSelectedObjects(),"paddingT")},x.prototype.getPaddingB=function(){return T(this.getSelectedObjects(),"paddingB")},x.prototype.setX=function(e){if(!(e<0)){var t=this.selection,i=this.multiSelection;if(t)t.setRect(e,void 0,void 0,void 0,!0);else if(i&&i.length>0){for(var o=i[0],n=1;n<i.length;n++)(t=i[n]).x<o.x&&(o=t);var a=e-o.x;for(let e=0;e<i.length;e++)(t=i[e]).setRect(t.x+a,void 0,void 0,void 0,!0)}this.setDirty(),this.updateObjectMenu()}},x.prototype.getX=function(){var e=this.selection,t=this.multiSelection;if(e)return e.x;if(t&&t.length>0){for(var i=t[0],o=1;o<t.length;o++)(e=t[o]).x<i.x&&(i=e);return i.x}},x.prototype.setY=function(e){if(!(e<0)){var t=this.selection,i=this.multiSelection;if(t)t.setRect(void 0,e,void 0,void 0,!0);else if(i&&i.length>0){for(var o=i[0],n=1;n<i.length;n++)(t=i[n]).y<o.y&&(o=t);var a=e-o.y;for(let e=0;e<i.length;e++)(t=i[e]).setRect(void 0,t.y+a,void 0,void 0,!0)}this.setDirty(),this.updateObjectMenu()}},x.prototype.getY=function(){let e=this.selection;var t=this.multiSelection;if(e)return e.y;if(t&&t.length>0){for(var i=t[0],o=1;o<t.length;o++)e=t[o],e.y<i.y&&(i=e);return i.y}},x.prototype.getW=function(){var e=this.selection,t=this.multiSelection;if(e)return e.w;if(t&&t.length>0){e=t[0];for(var i=1;i<t.length;i++)if(t[i].w!==e.w)return;return e.w}},x.prototype.setW=function(e){var t=this.selection,i=this.multiSelection;if(t)t.setRect(void 0,void 0,e,void 0,!0);else if(i&&i.length>0)for(let t=0;t<i.length;t++){i[t].setRect(void 0,void 0,e,void 0,!0)}this.setDirty(),this.updateObjectMenu()},x.prototype.getH=function(){var e=this.selection,t=this.multiSelection;if(e)return e.h;if(t&&t.length>0){e=t[0];for(var i=1;i<t.length;i++)if(t[i].h!==e.h)return;return e.h}},x.prototype.setH=function(e){var t=this.selection,i=this.multiSelection;if(t)t.setRect(void 0,void 0,void 0,e,!0);else if(i&&i.length>0)for(var o=0;o<i.length;o++){i[o].setRect(void 0,void 0,void 0,e,!0)}this.setDirty(),this.updateObjectMenu()},x.prototype.endEdit=function(){},x.prototype.moveToFront=function(){if(this.selection){var e=this.objects.indexOf(this.selection);if(e<0)throw new Error("Illegal state");this.objects.splice(e,1),this.objects.push(this.selection),this.selection.$object.appendTo(this.$paper)}else if(this.multiSelection){var t=this.objects,i=this.multiSelection.slice();i.sort((function(e,i){return t.indexOf(e)-t.indexOf(i)}));for(var o=0;o<i.length;o++){var n=i[o];const e=t.indexOf(n);t.splice(e,1),t.push(n),n.$object.appendTo(this.$paper)}}this.setDirty()},x.prototype.moveToBack=function(){var e=this.objects,t=this.selection,i=this.multiSelection;if(t){var o=e.indexOf(t);if(o<0)throw new Error("Illegal state");o>0&&(e.splice(o,1),e.unshift(t),t.$object.insertBefore(e[1].$object))}else if(i&&i.length<e.length){(i=i.slice()).sort((function(t,i){return e.indexOf(i)-e.indexOf(t)}));for(var n=0;n<i.length;n++){let t=i[n],o=e.indexOf(t);e.splice(o,1),e.unshift(t),t.$object.insertBefore(e[1].$object)}}this.setDirty()},x.prototype.removeSelection=function(){if(this.selection){var e=this.objects,t=this.selection;this.select(null);var i=e.indexOf(t);if(i<0)throw new Error("Illegal state");e.splice(i,1),t.destroy()}else if(this.multiSelection){let e=this.objects;var o=this.multiSelection;this.select(null);for(var n=0;n<o.length;n++){let t=o[n],i=e.indexOf(t);if(i<0)throw new Error("Illegal state");e.splice(i,1),t.destroy()}}this.setDirty()},x.prototype.duplicate=function(){var e=this,t=this.selection?[this.selection]:this.multiSelection;if(t&&t.length){var i=[];$.loading(!0),o()}function o(){for(var o=0;o<t.length;o++){var a=t[o].toJSON();a.x+=5,a.y+=5;var s=e.createObject(a);i.push(s)}n()}function n(){if(!i.length)return a();for(var e=0,t=0;t<i.length;t++)i[t].load((function(){++e===i.length&&a()}))}function a(){for(var e=0;e<i.length;e++)i[e].init();s()}function s(){e.updatePaper(),e.multiSelect(i),e.setDirty(),$.loading(!1)}},x.prototype.setBorder=function(e,t,i,o){var n=this.selection?[this.selection]:this.multiSelection;if(n){for(var a=0;a<n.length;a++)n[a].setBorder(e,t,i,o);this.setDirty()}},x.prototype.saveReportAs=function(e){var t=this,i=$.popdown({cls:"small"});$('<div class="nx-section-head">').text(e?locale.rename:locale.saveAs).appendTo(i.$pane);var o=$('<div class="nx-section-pane">').appendTo(i.$pane),n=$('<div class="component editor editor-string" style="width:100%">').appendTo(o);$("<label>").text(locale.name).appendTo(n);var a=$('<input type="text">').val(this.caption).appendTo($('<div class="stringeditor">').appendTo(n)).keydown((function(e){13===e.which&&s(),27===e.which&&r()}));function s(){var i=a.val().trim();if(i){r(),$.loading(!0);var o=t.toJSON();o.caption=i,e?database.updateReport(o,(function(e){if($.loading(!1),e)return $.alert(e);t.destroy(),reports.openDesigner({nid:t.nid,reportId:o.id,nids:t.nids})})):(o.id=util.createUUID(12),database.updateReport(o,(function(e){if(e)return $.loading(!1),$.alert(e);database.copyReportFiles(t.id,o.id,(function(){if($.loading(!1),e)return $.alert(e);t.destroy(),reports.openDesigner({nid:t.nid,reportId:o.id,nids:t.nids})}))})))}else a.focus()}function r(){i.close()}$('<div class="nx-button-bar">').appendTo(o).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(r)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.okay).touch(s)),setTimeout((function(){a.focus()}),400)},x.prototype.renameReport=function(){this.saveReportAs(!0)},x.prototype.getReportFiles=function(){for(var e=this.objects,t={},i=0;i<e.length;i++){var o=e[i];"image"===o.base&&(t[o.file]=!0)}return t},x.prototype.saveReport=function(e){if(!database.canSaveReport())return e("Not authorized.");var t=this;$.loading(!0);var i=t.toJSON();database.cleanReportFiles(t.id,t.getReportFiles(),(function(o){o&&console.log(o),database.updateReport(i,(function(i){$.loading(!1),t.setSaved(),e(i)}))}))},x.prototype.removeReport=function(e){var t=this;$.loading(!0),database.removeReport(e,(function(i){if($.loading(!1),i)return $.alert(i);e===t.id?(t.destroy(),reports.openDesigner({nid:t.nid,nids:t.nids})):t.loadReports()}))},x.prototype.renderPaper=function(e,t){var i=this.type,o=schemas.ridOf(this.nid);e||(e={name:util.escapeFileName(i.caption+o)+".pdf",orientation:"portrait",paperWidth:this.paperWidth*printer.MM,paperHeight:this.paperHeight*printer.MM,sections:[]});var n={marginL:this.marginL*printer.MM,marginR:this.marginR*printer.MM,marginT:this.marginT*printer.MM,marginB:this.marginB*printer.MM,headHeight:this.headHeight*printer.MM,footHeight:this.footHeight*printer.MM,objects:[]};e.sections.push(n);for(var a=this.objects,s=0;s<a.length;s++)n.objects.push(a[s].renderPaper());if(this.printAttachments){var r=this.nid,l=Math.ceil(this.footY),c=this.marginL,d=Math.floor((this.paperWidth-this.marginL-this.marginR)/2),h=d;database.loadNode(r,(function(o,a){if(o||!a)return t(void 0,e);for(var s={},p=i.sorted,u=0;u<p.length;u++){var f=p[u];if("file"===f.base){var m=a[f.id];m&&(s[m]=!0)}}console.log("LOADING FILES!!"),database.loadFiles(r,(function(i,o){if(o)for(var a=0,p=l,u=0;u<o.length;u++){var f=o[u].name;if(!s[f]&&util.RE_IMAGE_FILE_EXT.test(f)){var m=database.downloadURL(r,f),g=a%2==0?c:c+d;n.objects.push({base:"image",url:m,x:g*printer.MM,y:p*printer.MM,w:d*printer.MM,h:h*printer.MM,position:"page",borderWidth:.25,borderRadius:0,borderColor:"rgb(0,0,0)",backgroundColor:null}),a%2==1&&(p+=h),a++}}t(void 0,e)}))}))}else t(void 0,e);return e},x.prototype.print=function(e){if(Object(w.f)("Form","PrintConfirm"),this.nids&&this.nids.length){var t=this,i=$(e.target),o=i.offset();if(0!==o.top||0!==o.left){var n=$.backplane({autoClose:!0}),a=$('<div class="nx-menu-popup">').appendTo(n);$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.printOne)).appendTo(a).touch(m),$('<div class="nx-menu-item">').append($('<div class="nx-menu-label">').text(locale.printAll+" ("+t.nids.length+")")).appendTo(a).touch(g);var s,r,l=a.outerWidth(),c=a.outerHeight(),d=i.width(),h=i.height()+8,p=Math.max(0,Math.min(o.left+Math.round((d-l)/2),window.getWidth()-l)),u=o.top+h,f=o.left+Math.round(d/2)-12;u+c>window.getHeight()?(s="down",r=(u=Math.max(0,o.top-c))+c-.5):(s="up",r=u-23.5),a.offset({left:p,top:u}),$('<div class="marker-'+s+'" style="position:absolute;left:'+f+"px;top:"+r+'px">').appendTo(n)}}else this.printSingle();function m(){v(),t.printSingle()}function g(){v(),t.nids&&t.nids.length&&t.printAll()}function v(){n.remove()}},x.prototype.printSingle=function(e){Object(w.f)("Form","PrintConfirmSingle"),NinoxPrint.previewPDFDocument_PREPARE&&NinoxPrint.previewPDFDocument_PREPARE(),$.loading(!0),this.renderPaper(void 0,(function(t,i){if($.loading(!1),t)return $.alert(t);NinoxPrint.previewPDFDocumentRich(i),e&&e()}))},x.prototype.printSingleToFile=function(e){this.renderPaper(void 0,(function(t,i){if(t)return $.alert(t);NinoxPrint.savePDFDocumentRich(i,e)}))},x.prototype.printAll=function(t){Object(w.f)("Form","PrintConfirmAll");var i=this,o=this.nids;if(o&&o.length){NinoxPrint.previewPDFDocument_PREPARE&&NinoxPrint.previewPDFDocument_PREPARE();var n=void 0;$.loading(!0),e(a,0)}else t&&t();function a(t){if(t>=o.length)return e(s);var r=o[t];i.loadNid(r,(function(o){if(o)return $.alert(o);i.renderPaper(n,(function(i,o){if(i)return $.alert(i);n=o,e(a,t+1)}))}))}function s(){$.loading(!1),n&&(NinoxPrint.previewPDFDocumentRich(n),t&&t())}},x.prototype.setDirty=function(){this.isEnabled&&(this.isDirty=!0)},x.prototype.setSaved=function(){this.isDirty=!1},x.prototype.keydown=function(e){if(this.isEnabled&&e.target===document.body)switch(e.which){case 8:this.removeSelection(),e.preventDefault();break;case 37:this.setX(this.getX()-1);break;case 38:this.setY(this.getY()-1);break;case 39:this.setX(this.getX()+1);break;case 40:this.setY(this.getY()+1);break;case 27:this.select(null)}},x.prototype.startSelect=function(e){this.mouseState?e():(this.mouseState="start-select",this.startSelectCallback=e)},x.prototype.createReport=function(){this.createReport_DESKTOP()},x.prototype.createReport_PHONE=function(){var e=this;e.saveIfUnsaved((function(t){t&&new Popup({caption:locale.newReport,dismiss:!0,init:function(){var e=this;e.$name=$('<input type="text" class="no-barcode">').attr("placeholder",locale.name),$('<div class="editor-block no-label">').append(e.$name).appendTo(e.$pane),e.autoLayout="empty";var t=$('<div class="switch-item">').text(locale.emptyLayout).click((function(){e.autoLayout="empty",n()})),i=$('<div class="switch-item">').text(locale.automatic).click((function(){e.autoLayout="auto",n()})),o=$('<div class="switch-item">').text(locale.duplicate).click((function(){e.autoLayout="duplicate",n()}));function n(){t.toggleClass("selected","empty"===e.autoLayout),i.toggleClass("selected","auto"===e.autoLayout),o.toggleClass("selected","duplicate"===e.autoLayout)}$('<div class="editor-block" style="flex-wrap:wrap;-webkit-flex-wrap:wrap">').append($("<label>").text(locale.autoLayout)).append($('<div class="switch">').append(t).append(i).append(o)).appendTo(e.$pane),n()},buttons:[{caption:locale.okay,cls:"blue",click:function(){var t=this,i=t.$name.val().trim();if(i)if("duplicate"===t.autoLayout){var o=e.toJSON();o.caption=i,o.id=util.createUUID(12),database.updateReport(o,(function(i){if(i)return $.loading(!1),$.alert(i);database.copyReportFiles(e.id,o.id,(function(){if($.loading(!1),i)return $.alert(i);t.dismiss(),e.destroy(),reports.openDesigner({nid:e.nid,reportId:o.id,nids:e.nids})}))}))}else t.dismiss(),e.destroy(),reports.openDesigner({nid:e.nid,reportId:null,empty:"empty"===t.autoLayout,caption:i,nids:e.nids});else t.$name.focus();return!1}}]})}))},x.prototype.createReport_DESKTOP=function(){var e=this;e.saveIfUnsaved((function(t){if(t){var i=$.popdown({cls:"small"});$('<div class="nx-section-head">').text(locale.newReport).appendTo(i.$pane);var o=$('<div class="nx-section-pane">').appendTo(i.$pane),n=$('<div class="component editor editor-string" style="width:100%">').appendTo(o);$("<label>").text(locale.name).appendTo(n);var a=$('<input type="text">').appendTo($('<div class="stringeditor">').appendTo(n)).keydown((function(e){13===e.which&&l(),27===e.which&&c()})),s=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.autoLayout,required:!0,formWidth:1,choiceRenderer:"switch",values:{empty:{id:"empty",caption:locale.emptyLayout,order:1},auto:{id:"auto",caption:locale.automatic,order:2},duplicate:{id:"duplicate",caption:locale.duplicate,order:3}}}),"auto"),r=new y.a(void 0,s,o);$('<div class="nx-button-bar">').appendTo(o).append($('<div class="nx-button-text grey">').text(locale.cancel).touch(c)).append($('<div class="nx-hspace-flex">')).append($('<div class="nx-button-text blue">').text(locale.okay).touch(l)),setTimeout((function(){a.focus()}),400)}function l(){var t=a.val().trim();if(t)if("duplicate"===s.value){var i=e.toJSON();i.caption=t,i.id=util.createUUID(12),database.updateReport(i,(function(t){if(t)return $.loading(!1),$.alert(t);database.copyReportFiles(e.id,i.id,(function(){if($.loading(!1),t)return $.alert(t);c(),e.destroy(),reports.openDesigner({nid:e.nid,reportId:i.id,nids:e.nids})}))}))}else c(),e.destroy(),reports.openDesigner({nid:e.nid,reportId:null,empty:"empty"===s.value,caption:t,nids:e.nids});else a.focus()}function c(){r.destroy(),i.close()}}))},x.prototype.loadNid=function(e,t){this.nid=e;for(var i=this.objects,o=-1,n=0;n<i.length;n++){i[n].reload(a)}function a(){++o===i.length&&t()}a()},x.prototype.cutEnabled=function(){return!!this.selection||!!this.multiSelection&&this.multiSelection.length>0},x.prototype.cut=function(){var e=this.selection,t=this.multiSelection,i=this.objects;if(e){var o="["+JSON.stringify(e.toJSON())+"]";this.select(null);var n=i.indexOf(e);return n>=0&&i.splice(n,1),e.destroy(),this.setDirty(),o}if(t&&t.length>0){let o="[";for(var a=0;a<t.length;a++)e=t[a],o+=(a>0?",":"")+JSON.stringify(e.toJSON());o+="]",this.select(null);for(let e=0;e<t.length;e++){let o=t[e],n=i.indexOf(o);n>=0&&i.splice(n,1),o.destroy()}return this.setDirty(),o}return""},x.prototype.copyEnabled=function(){return!!this.selection||!!this.multiSelection},x.prototype.copy=function(){var e=this.selection,t=this.multiSelection;if(e)return"["+JSON.stringify(e.toJSON())+"]";if(t&&t.length>0){for(var i="[",o=0;o<t.length;o++)e=t[o],i+=(o>0?",":"")+JSON.stringify(e.toJSON());return i+="]"}return""},x.prototype.pasteEnabled=function(){return!0},x.prototype.paste=function(e){var t,i=this;try{t=JSON.parse(e)}catch(e){}if(Array.isArray(t)){var o=[];n()}function n(){for(var e=0;e<t.length;e++){var n=i.createObject(t[e]);n&&(n.x+=5,n.y+=5,o.push(n))}a()}function a(){if(!o.length)return s();for(var e=0,t=0;t<o.length;t++)o[t].load((function(){++e===o.length&&s()}))}function s(){for(var e=0;e<o.length;e++)o[e].init(),o[e].patchAutoHeight();r()}function r(){i.updatePaper(),i.multiSelect(o),i.setDirty()}}}).call(this,i("./node_modules/node-libs-browser/node_modules/timers-browserify/main.js").setImmediate)},"./src/js/reports/ObjectMenu.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("./src/js/widgets/Field.js");function n(e){var t=this;this.designer=e,this.$metrics=$('<div class="rd-menu-bar center">').hide().appendTo(e.$menu);var i=$("<div>").appendTo(this.$metrics);this.height=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:"",required:!0,values:{fix:{caption:locale.fixedHeight,order:1},auto:{caption:locale.autoHeight,order:2}}})),this.height.withoutLabel=!0,this.heightField=new o.a(this,this.height,i),this.height.on("update",(function(){e.setAutoHeight("auto"===t.height.value),t.updateUI()})),this.heightField.el.css({width:240});var n=$("<div>").appendTo(this.$metrics);this.position=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:"",required:!0,values:{head:{caption:locale.pageHead,order:1},page:{caption:locale.pageBody,order:2},foot:{caption:locale.pageFoot,order:3}}})),this.position.withoutLabel=!0,this.positionField=new o.a(this,this.position,n),this.position.on("update",(function(){e.setPosition(t.position.value),t.updateUI()})),this.positionField.el.css({width:240}),$('<div class="rd-menu-head">').text(locale.position).appendTo(this.$metrics),$('<div class="rd-metrics-label">').text("x").appendTo(this.$metrics);var a=this.$x=$('<input type="number" class="rd-metrics">').appendTo(this.$metrics).change((function(){e.setX(a.val()),t.updateUI()}));$('<div class="rd-metrics-label">').text("y").appendTo(this.$metrics);var s=this.$y=$('<input type="number" class="rd-metrics">').appendTo(this.$metrics).change((function(){e.setY(s.val()),t.updateUI()}));$('<div class="rd-metrics-label">').text("↔︎").appendTo(this.$metrics);var r=this.$w=$('<input type="number" class="rd-metrics">').appendTo(this.$metrics).change((function(){e.setW(r.val()),t.updateUI()}));$('<div class="rd-metrics-label">').text("↕︎").appendTo(this.$metrics);var l=this.$h=$('<input type="number" class="rd-metrics">').appendTo(this.$metrics).change((function(){e.setH(l.val()),t.updateUI()}));this.$padding=$("<div>").hide().appendTo(this.$metrics),$('<div class="rd-menu-head">').text(locale.padding).appendTo(this.$padding),$('<div class="rd-metrics-label">').text("↑").appendTo(this.$padding),this.$pt=$('<input type="number" class="rd-metrics">').appendTo(this.$padding).change((function(){t.updatePaddingT()})),$('<div class="rd-metrics-label">').text("↓").appendTo(this.$padding),this.$pb=$('<input type="number" class="rd-metrics">').appendTo(this.$padding).change((function(){t.updatePaddingB()})),$('<div class="rd-metrics-label">').text("←").appendTo(this.$padding),this.$pl=$('<input type="number" class="rd-metrics">').appendTo(this.$padding).change((function(){t.updatePaddingL()})),$('<div class="rd-metrics-label">').text("→").appendTo(this.$padding),this.$pr=$('<input type="number" class="rd-metrics">').appendTo(this.$padding).change((function(){t.updatePaddingR()})),this.updateUI()}function a(e){return null==e||isNaN(e)?null:Math.round(100*e)/100}function s(e){if(e){var t=Number(e);return t>0?t:0}}n.prototype.updateUI=function(){var e=this.designer,t=e.selection,i=e.multiSelection;if(t||i){var o=this.designer.isAutoHeight();this.height.value=!0===o?"auto":!1===o?"fix":void 0,this.heightField.editor.load(),this.position.value=this.designer.getPosition(),this.positionField.editor.load(),this.$x.val(a(this.designer.getX())),this.$y.val(a(this.designer.getY())),this.$w.val(a(this.designer.getW())),this.$h.val(a(this.designer.getH())),this.$metrics.show()}else this.$metrics.hide();e.canSetPadding()?(this.$pl.val(e.getPaddingL()||""),this.$pr.val(e.getPaddingR()||""),this.$pt.val(e.getPaddingT()||""),this.$pb.val(e.getPaddingB()||""),this.$padding.show()):this.$padding.hide()},n.prototype.updatePaddingL=function(){this.designer.setPadding(s(this.$pl.val()))},n.prototype.updatePaddingR=function(){this.designer.setPadding(void 0,s(this.$pr.val()),void 0,void 0)},n.prototype.updatePaddingT=function(){this.designer.setPadding(void 0,void 0,s(this.$pt.val()),void 0)},n.prototype.updatePaddingB=function(){this.designer.setPadding(void 0,void 0,void 0,s(this.$pb.val()))}},"./src/js/reports/PaperMenu.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("./src/js/widgets/Field.js");function n(e){var t=this;this.designer=e,this.$el=$('<div class="rd-menu-bar center">').hide().appendTo(e.$menu);var i=this.format=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.paperFormat,required:!0,values:{custom:{id:"custom",caption:locale.custom,order:1},"297x420":{id:"297x420",caption:"DIN A3 ↕︎",order:2},"210x297":{id:"210x297",caption:"DIN A4 ↕︎",order:3},"148x210":{id:"148x210",caption:"DIN A5 ↕︎",order:4},"420x297":{id:"420x297",caption:"DIN A3 ↔︎",order:5},"297x210":{id:"297x210",caption:"DIN A4 ↔︎",order:6},"210x148":{id:"210x148",caption:"DIN A5 ↔︎",order:7},"140x216":{id:"140x216",caption:"Invoice",order:8},"184x267":{id:"184x267",caption:"Executive",order:9},"216x356":{id:"216x356",caption:"Legal",order:10},"216x279":{id:"216x279",caption:"Letter",order:11}}}));i.value="custom",(this.formatField=new o.a(this,i,this.$el)).el.css({width:240,margin:"0 0 8px 0","vertical-align":"baseline"}),i.on("update",(function(){var e=i.value;if("custom"!==e){var o=e.split("x"),n=Number(o[0]),a=Number(o[1]);t.$pw.val(n),t.$ph.val(a),t.updatePaper()}})),$("<br>").appendTo(this.$el),$('<div class="rd-metrics-label">︎').text("↔︎").appendTo(this.$el),this.$pw=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-metrics-label">').text("↕︎").appendTo(this.$el),this.$ph=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-menu-head">').text(locale.headFoot).appendTo(this.$el),$('<div class="rd-metrics-label">').text("↑").appendTo(this.$el),this.$head=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-metrics-label">').text("↓").appendTo(this.$el),this.$foot=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-menu-head">').text(locale.margins).appendTo(this.$el),$('<div class="rd-metrics-label">').text("↑").appendTo(this.$el),this.$mt=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-metrics-label">').text("↓").appendTo(this.$el),this.$mb=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-metrics-label">').text("←").appendTo(this.$el),this.$ml=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()})),$('<div class="rd-metrics-label">').text("→").appendTo(this.$el),this.$mr=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change((function(){t.updatePaper()}));var n=this.printFiles=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{required:!0,caption:locale.printAttachments,booleanRenderer:"check"}));n.value=this.designer.printAttachments,n.withoutLabel=!0,(this.printAttachmentsField=new o.a(this,n,this.$el)).el.css({width:240,margin:"0 0 8px 0","vertical-align":"baseline","text-align":"left"}),n.on("update",(function(){t.designer.printAttachments=n.value}))}n.prototype.updateUI=function(){var e=this.designer;if(e.selection||e.multiSelection)this.$el.hide();else{var t=e.paperWidth+"x"+e.paperHeight,i=this.format.field.values[t];this.format.value=i?i.id:"custom",this.formatField.editor.load(),this.$pw.val(e.paperWidth),this.$ph.val(e.paperHeight),this.$head.val(e.headHeight),this.$foot.val(e.footHeight),this.$mt.val(e.marginT),this.$mb.val(e.marginB),this.$ml.val(e.marginL),this.$mr.val(e.marginR),this.$el.show()}},n.prototype.updatePaper=function(){this.designer.setPaper(Number(this.$pw.val()),Number(this.$ph.val()),Number(this.$ml.val()),Number(this.$mr.val()),Number(this.$mt.val()),Number(this.$mb.val()),Number(this.$head.val()),Number(this.$foot.val())),this.updateUI()}},"./src/js/reports/RDHTML.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./src/js/reports/RDObject.js"),n=i("./src/js/admin/FunctionEditor.js"),a=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js");function s(e,t){o.a.call(this,e,t),this.fn=t.fn,this.verticalAlign=t.verticalAlign||null,this.paddingL=t.paddingL||0,this.paddingR=t.paddingR||0,this.paddingT=t.paddingT||0,this.paddingB=t.paddingB||0;var i=null;try{i=queries.parseSystem(e.type.schema,e.type,this.fn,{})}catch(e){}this.exp=i,this.html="",this.$wrap=null,this.$text=null}Object.assign(s.prototype,o.a.prototype),s.prototype.base="html",s.prototype.toJSON=function(){return Object.assign(o.a.prototype.toJSON.apply(this),{base:"html",isAutoHeight:this.isAutoHeight||!1,fn:this.fn,verticalAlign:this.verticalAlign,paddingL:this.paddingL,paddingR:this.paddingR,paddingT:this.paddingT,paddingB:this.paddingB})},s.prototype.reload=function(e){var t=this;t.load((function(){t.$text.html(t.html),e()}))},s.prototype.load=function(e){var t=this,i=this.exp;if(!i)return e();var o=this.designer.nid;if(!o)return e();var n=database.loadNodeSync(o);if(!n)return e();i.evaluate(database,n,(function(i,o){t.html=o||"",i&&console.log("RDHTML.load err",i),e()}))},s.prototype.init=function(){o.a.prototype.init.call(this),this.$wrap=$('<div class="rd-object-html-wrap">').css({"-webkit-align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start","align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start"}).appendTo(this.$object),this.$text=$('<div class="rd-object-html-html">').css({"padding-left":this.paddingL?this.paddingL+"mm":"","padding-right":this.paddingR?this.paddingR+"mm":"","padding-top":this.paddingT?this.paddingT+"mm":"","padding-bottom":this.paddingB?this.paddingB+"mm":""}).appendTo(this.$wrap).html(this.html)},s.prototype.renderPaper=function(){return Object.assign(o.a.prototype.renderPaper.apply(this,arguments),{base:"text",text:this.html,verticalAlign:this.verticalAlign||"top",isHTML:!0,dynamicHeight:this.isAutoHeight||!1,paddingL:(this.paddingL||0)*printer.MM,paddingR:(this.paddingR||0)*printer.MM,paddingT:(this.paddingT||0)*printer.MM,paddingB:(this.paddingB||0)*printer.MM,textDecoration:"",fontStyle:"",fontWeight:"",lineHeight:1})},s.prototype.setPadding=function(e,t,i,o){void 0!==e&&(this.paddingL=e||0),void 0!==t&&(this.paddingR=t||0),void 0!==i&&(this.paddingT=i||0),void 0!==o&&(this.paddingB=o||0),this.$text.css({"padding-left":this.paddingL?this.paddingL+"mm":"","padding-right":this.paddingR?this.paddingR+"mm":"","padding-top":this.paddingT?this.paddingT+"mm":"","padding-bottom":this.paddingB?this.paddingB+"mm":""})},s.prototype.setVerticalAlign=function(e){this.verticalAlign=e||null,this.$wrap.css({"-webkit-align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start","align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start"}),this.designer.setDirty()},s.prototype.startEdit=function(){const e=this,t=e.designer;new n.a({value:e.exp.toHumanString(),schema:e.designer.type.schema,type:e.designer.type,okay:function(i,o){if("html"===o.returnType.base){const i={base:"html",position:e.position,x:e.x,y:e.y,w:e.w,h:e.h,fn:o.toString()};t.removeSelection(),t.createAndSelectObject(i)}else $.alert(Object(a.getLocale)().typeMissmatchHtml);t.mouseState=null},cancel:function(){t.mouseState=null}})}},"./src/js/reports/RDImage.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./src/js/reports/RDObject.js");function n(e,t){t.isAutoHeight=!1,o.a.call(this,e,t),this.file=t.file||null,this.printUrl=this.file?database.reportFileURL(this.designer.id,this.file):"",this.previewUrl=this.file?database.reportFileURLProxy(this.designer.id,this.file):"",this.img=null}Object.assign(n.prototype,o.a.prototype),n.prototype.base="image",n.prototype.setAutoHeight=function(){},n.prototype.setFontFamily=void 0,n.prototype.setFontSize=void 0,n.prototype.setTextAlign=void 0,n.prototype.setVerticalAlign=void 0,n.prototype.setTextColor=void 0,n.prototype.toJSON=function(){return Object.assign(o.a.prototype.toJSON.apply(this),{file:this.file})},n.prototype.load=function(e){var t=this;t.img=null;var i=new Image;i.src=t.previewUrl,i.complete?(t.img=i,e()):(i.onload=function(){t.img=i,e()},i.onerror=function(){e()})},n.prototype.init=function(){console.log("RDImage.init"),o.a.prototype.init.call(this),this.$img=$('<img style="width:100%">').appendTo(this.$object),this.$img[0].src=this.img?this.img.src:""},n.prototype.renderPaper=function(){return Object.assign(o.a.prototype.renderPaper.apply(this,arguments),{base:"image",url:this.printUrl,verticalAlign:"top"})}},"./src/js/reports/RDImageField.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./src/js/reports/RDObject.js"),n=i("./src/js/admin/FunctionEditor.js"),a=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js");i("./src/js/reports/RDImage.js");function s(e,t){t.isAutoHeight=!1,o.a.call(this,e,t),this.fid=t.fid,this.exp=void 0;var i=e.type;try{var n=queries.parseSystem(i.schema,i,this.fid,{},!1);n.isMultiple()||n.isUpdating()||"file"!==n.returnType.base||(this.exp=n)}catch(e){}this.previewURL="",this.renderURL="",this.img=null,this.$img=null}Object.assign(s.prototype,o.a.prototype),s.prototype.base="imagefield",s.prototype.setAutoHeight=function(){},s.prototype.setTextAlign=void 0,s.prototype.setTextColor=void 0,s.prototype.load=function(e){var t=this;if(!t.exp)return e();var i=t.designer.nid;if(!i)return e();database.loadNode(i,(i,o)=>{if(!o)return e();t.img=null,t.previewURL="",t.renderURL="",t.exp.evaluate(database,o,(function(i,o){t.val=o,o&&(t.previewURL=database.fileURL1(o),t.renderURL=database.downloadURL1(o));var n=new Image;n.src=t.previewURL,n.complete?(t.img=n,e()):(n.onload=function(){t.img=n,e()},n.onerror=function(){e()})}))})},s.prototype.init=function(){o.a.prototype.init.call(this),this.$img=$('<img style="width:100%">').appendTo(this.$object),this.$img[0].src=this.img?this.img.src:""},s.prototype.reload=function(e){var t=this;t.load((function(){t.$img[0].src=t.img?t.img.src:"",e()}))},s.prototype.toJSON=function(){return Object.assign(o.a.prototype.toJSON.apply(this),{fid:this.fid})},s.prototype.renderPaper=function(){return Object.assign(o.a.prototype.renderPaper.apply(this,arguments),{base:"image",url:this.renderURL})},s.prototype.startEdit=function(){const e=this,t=e.designer;new n.a({value:e.exp.toHumanString(),schema:e.designer.type.schema,type:e.designer.type,okay:function(i,o){if("file"===o.returnType.base){const i={base:"imagefield",position:e.position,x:e.x,y:e.y,w:e.w,h:e.h,fid:o.toString()};t.removeSelection(),t.createAndSelectObject(i)}else $.alert(Object(a.getLocale)().typeMissmatchImage);t.mouseState=null},cancel:function(){t.mouseState=null}})}},"./src/js/reports/RDObject.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("./node_modules/core-js/modules/web.url.to-json.js");function o(e,t){this.designer=e,this.isAutoHeight=!0===t.isAutoHeight,this.x=t.x||0,this.y=t.y||0,this.w=t.w||0,this.h=t.h||0,this.position=t.position,this.position||(this.y<e.marginT+e.headHeight?this.position="head":this.y>=e.paperHeight-e.footHeight-e.marginB?this.position="foot":this.position="page"),this.backgroundColor=t.backgroundColor||null,this.borderColor=t.borderColor||null,this.borderWidth=t.borderWidth||null,this.borderStyle=t.borderStyle||null,this.borderRadius=t.borderRadius||null,this.textColor=t.textColor||null,this.textAlign=t.textAlign||null,this.fontFamily=t.fontFamily||null,this.fontSize=t.fontSize||null,this.selected=!1,this.multiSelected=!1}o.prototype.isAutoHeight=!1,o.prototype.base="object",o.prototype.toJSON=function(){return{base:this.base,x:this.x,y:this.y,w:this.w,h:this.h,position:this.position,backgroundColor:this.backgroundColor,borderColor:this.borderColor,borderWidth:this.borderWidth,borderStyle:this.borderStyle,borderRadius:this.borderRadius,textColor:this.textColor,textAlign:this.textAlign,fontFamily:this.fontFamily,fontSize:this.fontSize}},o.prototype.reload=function(e){e()},o.prototype.isHead=function(){return"head"===this.position},o.prototype.isFoot=function(){return"foot"===this.position},o.prototype.renderPaper=function(){var e=this.isHead()||this.isFoot()?"head":"page",t=this.isFoot()?this.y-this.designer.footY+this.designer.paperHeight-this.designer.marginB-this.designer.footHeight:this.y;return{position:e,x:this.x*printer.MM,y:t*printer.MM,w:this.w*printer.MM,h:this.h*printer.MM,backgroundColor:this.backgroundColor,borderColor:this.borderColor,borderWidth:this.borderWidth||0,borderStyle:this.borderStyle||0,borderRadius:(this.borderRadius||0)*printer.MM,textColor:this.textColor,textAlign:this.textAlign,fontFamily:this.getFontFamily(),fontSize:this.getFontSize()}},o.prototype.destroy=function(){this.$object.remove()},o.prototype.load=function(e){e()},o.prototype.init=function(){var e=this.designer;this.$object=$('<div class="rd-object rd-object-'+this.base+'">').data("object",this).appendTo(e.$paper).css({"background-color":this.backgroundColor||"","border-color":this.borderColor||"",color:this.textColor||"","text-align":this.textAlign||"","font-family":this.fontFamily||"","font-size":this.fontSize?this.fontSize+"pt":""});var t=this.$object[0];t.style.left=this.x+"mm",t.style.top=this.y+"mm",t.style.width=this.w+"mm",this.isAutoHeight?(t.style.height="auto",this.$object.addClass("auto")):t.style.height=this.h+"mm",this.updateBorder()},o.prototype.setRect=function(e,t,i,o,n){var a=this.$object[0];void 0!==e&&(e=Number(e),e=n?e:Math.round(e),(isNaN(e)||e<0)&&(e=0),this.x=e,a.style.left=e+"mm"),void 0!==t&&(t=Number(t),t=n?t:Math.round(t),(isNaN(t)||t<0)&&(t=0),this.y=t,a.style.top=t+"mm"),void 0!==i&&(i=Number(i),i=n?i:Math.round(i),(isNaN(i)||i<1)&&(i=1),this.w=i,this.widthChanged(n),a.style.width=i+"mm",this.isAutoHeight&&this.updateAutoHeight()),this.isAutoHeight||void 0!==o&&(o=Number(o),o=n?o:Math.round(o),(isNaN(o)||o<1)&&(o=1),this.h=o,a.style.height=o+"mm")},o.prototype.widthChanged=function(e){},o.prototype.patchAutoHeight=function(){if(this.isAutoHeight){var e=this.h,t=this.$object[0].offsetHeight*this.designer.scale;e!==t&&(this.h=t)}},o.prototype.updateAutoHeight=function(){if(this.isAutoHeight){var e=this.h,t=this.$object[0].offsetHeight*this.designer.scale;e!==t&&(this.designer.autoHeightWillChange(this,e,t),this.h=t,this.designer.updatePaper())}},o.prototype.setAutoHeight=function(e){(e=!0===e)!==this.isAutoHeight&&(e?(this.$object[0].style.height="auto",this.$object.addClass("auto")):(this.$object[0].style.height=this.h+"mm",this.$object.removeClass("auto")),this.isAutoHeight=e,this.updateAutoHeight(),this.designer.setDirty())},o.prototype.select=function(){this.selected||(this.selected=!0,this.$object.addClass("selected"),this.showResizers(),this._select())},o.prototype._select=function(){},o.prototype.unselect=function(){this.selected&&(this.selected=!1,this.$object.removeClass("selected"),this.hideResizers(),this._unselect())},o.prototype._unselect=function(){},o.prototype.multiSelect=function(){this.multiSelected||(this.multiSelected=!0,this.$object.addClass("multi-selected"),this.showResizers())},o.prototype.multiUnselect=function(){this.multiSelected&&(this.multiSelected=!1,this.$object.removeClass("multi-selected"),this.hideResizers())},o.prototype.showResizers=function(){$('<div class="rd-object-resizer top">').data("dir","t").appendTo(this.$object),$('<div class="rd-object-resizer bottom">').data("dir","b").appendTo(this.$object),$('<div class="rd-object-resizer left">').data("dir","l").appendTo(this.$object),$('<div class="rd-object-resizer right">').data("dir","r").appendTo(this.$object),$('<div class="rd-object-resizer top-left">').data("dir","tl").appendTo(this.$object),$('<div class="rd-object-resizer top-right">').data("dir","tr").appendTo(this.$object),$('<div class="rd-object-resizer bottom-left">').data("dir","bl").appendTo(this.$object),$('<div class="rd-object-resizer bottom-right">').data("dir","br").appendTo(this.$object)},o.prototype.hideResizers=function(){this.$object.children(".rd-object-resizer").remove()},o.prototype.setBackgroundColor=function(e){this.backgroundColor=e,this.$object.css("background-color",e||""),this.designer.setDirty()},o.prototype.setBorderColor=function(e){this.borderColor=e,this.updateBorder(),this.designer.setDirty()},o.prototype.setTextColor=function(e){this.textColor=e,this.$object.css("color",e||""),this.designer.setDirty()},o.prototype.setTextAlign=function(e){this.textAlign=e||null,this.$object.css("text-align",e||""),this.updateAutoHeight(),this.designer.setDirty()},o.prototype.setFontFamily=function(e){e===this.designer.fontFamily&&(e=null),this.fontFamily=e||null,this.$object.css("font-family",e||""),this.updateAutoHeight(),this.designer.setDirty()},o.prototype.setFontSize=function(e){e===this.designer.fontSize&&(e=null),this.fontSize=e||null,this.$object.css("font-size",e?e+"pt":""),this.fontChanged(),this.updateAutoHeight(),this.designer.setDirty()},o.prototype.getFontFamily=function(){return this.fontFamily||this.designer.fontFamily},o.prototype.getFontSize=function(){return this.fontSize||this.designer.fontSize},o.prototype.setBorder=function(e,t,i,o){void 0!==e&&(this.borderColor=e),void 0!==t&&(this.borderStyle=t),void 0!==i&&(this.borderWidth=i),void 0!==o&&(this.borderRadius=o),this.updateBorder(),this.boundsChanged(),this.updateAutoHeight(),this.designer.setDirty()},o.prototype.updateBorder=function(){this.borderColor?(this.borderWidth||(this.borderWidth=1),this.borderStyle||(this.borderStyle="solid"),this.$object.css({"border-color":this.borderColor,"border-style":this.borderStyle,"border-width":this.borderWidth+"pt"})):(this.borderWidth=null,this.borderStyle=null,this.$object.css({"border-color":"","border-style":"","border-width":""})),this.$object.css({"border-radius":this.borderRadius?this.borderRadius+"mm":""})},o.prototype.boundsChanged=function(){},o.prototype.fontChanged=function(){},o.prototype.startEdit=function(){},o.prototype.stopEdit=function(){}},"./src/js/reports/RDReverse.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./src/js/reports/RDObject.js"),n=i("./src/js/admin/ViewEditor.js");function a(e,t){if(t.isAutoHeight=!0,this.nid=e.nid,this.expression=t.expression,this.field=e.type.fields[t.expression],!this.field)throw new Error("Field not found "+e.type.caption+"."+t.expression);this.type=this.field.refType,this.showHead=!1!==t.showHead,this.showFoot=!1!==t.showFoot,this.tableBorderStyle=t.tableBorderStyle||0,this.paddingL=void 0===t.paddingL?2:t.paddingL,this.paddingR=void 0===t.paddingR?2:t.paddingR,this.paddingT=void 0===t.paddingT?2:t.paddingT,this.paddingB=void 0===t.paddingB?2:t.paddingB,this.query=new queries.QueryReverse(database,this.field,this.nid,t.viewConfig),o.a.call(this,e,t),this.mode=null,this.selectedColIndex=void 0,this.tableMenu=null,this.columnMenu=null}function s(e){var t=this;this.reverse=e,this.$el=$('<div class="rd-menu-bar">').appendTo(e.designer.$menu);var i=$('<div style="padding:8px">').appendTo(this.$el);this.$showHead=$('<input type="checkbox">').appendTo(i).change((function(){e.showHead=t.$showHead.is(":checked"),e.updateUI()})),$("<label>").text(locale.header).appendTo(i),$("<br>").appendTo(i),this.$showFoot=$('<input type="checkbox">').appendTo(i).change((function(){e.showFoot=t.$showFoot.is(":checked"),e.updateUI()})),$("<label>").text(locale.footer).appendTo(i),$('<div style="text-align:center;padding:4px 0">').appendTo(this.$el).button(void 0,locale.editColumns,"grey",$.proxy(this.editColumns,this)),$('<div style="text-align:center;padding:4px 0">').appendTo(this.$el).button(void 0,locale.borderStyle+"...","grey",$.proxy(this.editBorder,this))}function r(e){this.reverse=e,this.$el=$('<div class="rd-menu-bar center">').hide().appendTo(e.designer.$menu),$('<div class="rd-metrics-label">').text("↔").appendTo(this.$el),this.$width=$('<input type="number" class="rd-metrics">').appendTo(this.$el).change($.proxy(this.widthChanged,this))}Object.assign(a.prototype,o.a.prototype),a.prototype.base="rev",a.prototype.isAutoHeight=!0,a.prototype.setAutoHeight=function(){},a.prototype.setTextAlign=void 0,a.prototype.setVerticalAlign=void 0,a.prototype.setBorder=void 0,a.prototype.toJSON=function(){return Object.assign(o.a.prototype.toJSON.call(this),{expression:this.expression,viewConfig:this.query.getConfig(),showHead:this.showHead,showFoot:this.showFoot,tableBorderStyle:this.tableBorderStyle,paddingL:this.paddingL,paddingR:this.paddingR,paddingT:this.paddingT,paddingB:this.paddingB})},a.prototype.init=function(){o.a.prototype.init.call(this),this.$wrap=$('<div class="rd-rev">').appendTo(this.$object),this.$object.click($.proxy(this.click,this)),this.updateTable(),this._resize()},a.prototype.load=function(e){this.query.load((function(){e()}))},a.prototype.reload=function(e){var t=this;t.nid=t.designer.nid,t.query.nid=t.nid,t.query.load((function(){t.updateTable(),t._resize(),e()}))},a.prototype.renderPaper=function(){for(var e=[],t=[],i=[],n=[],a=this.query.cols,s=this.query.rows,r=this.query.models,l=this.query.groups,c=this.query.foot.values,d=0;d<a.length;d++){var h=a[d];e.push({width:h.width*printer.MM,cellPaddingL:this.paddingL*printer.MM,cellPaddingR:this.paddingR*printer.MM,cellPaddingT:this.paddingT*printer.MM,cellPaddingB:this.paddingB*printer.MM,headAlign:"center",headIsHTML:!1,headFontFamily:this.getFontFamily(),headFontSize:this.getFontSize(),headFontBold:!0,headFontItalic:!1,headFontUnderline:!1,headTextColor:"rgb(0,0,0)",cellAlign:h.expression.returnType.columnAlign,cellIsHTML:"html"===h.expression.returnType.base,cellFontFamily:this.getFontFamily(),cellFontSize:this.getFontSize(),cellFontBold:!1,cellFontItalic:!1,cellFontUnderline:!1,cellTextColor:"rgb(0,0,0)",footAlign:h.aggType?h.aggType.columnAlign:"left",footIsHTML:!1,footFontFamily:this.getFontFamily(),footFontSize:this.getFontSize(),footFontBold:!1,footFontItalic:!1,footFontUnderline:!1,footTextColor:"rgb(0,0,0)",base:h.expression.returnType.base})}for(d=0;d<a.length;d++){h=a[d];t[d]=h.caption||h.expression.caption||""}for(var p=0;p<s.length;p++){var u=s[p],f=(r[u]||l[u]).values,m=[];i.push(m);for(d=0;d<a.length;d++){if((h=a[d]).isReadable){var g=f[d],v=h.expression.returnType;"html"===v.base?m[d]=null!=g?String(g):"":"file"===v.base?m[d]=g&&database.downloadURL1(g)||"":m[d]=v.format(g)}else m[d]=""}}for(d=0;d<a.length;d++){(h=a[d]).isReadable?n[d]=h.agg?h.aggType.format(c[d]):"":n[d]=""}return Object.assign(o.a.prototype.renderPaper.apply(this,arguments),{base:"table",showHead:this.showHead,showFoot:this.showFoot,borderStyle:this.tableBorderStyle,cols:e,head:t,rows:i,foot:n})},a.prototype.setPadding=function(e,t,i,o){void 0!==e&&(this.paddingL=e||0),void 0!==t&&(this.paddingR=t||0),void 0!==i&&(this.paddingT=i||0),void 0!==o&&(this.paddingB=o||0),this.updateUI()},a.prototype.widthChanged=function(e){this.resize(e)},a.prototype.updateUI=function(){this.updateTable(),this.resize()},a.prototype.updateTable=function(){for(var e=this.$wrap,t=this.query.cols||[],i=this.query.rows||[],o=this.query.models||{},n=this.query.groups||{},a=this.query.foot.values,s="padding:"+this.paddingT+"mm "+this.paddingR+"mm "+this.paddingB+"mm "+this.paddingL+"mm",r='<table class="rd-rev-table rd-table-border-style'+this.tableBorderStyle+'"><colgroup>',l=0;l<t.length;l++){var c=t[l];r+="<col>"}if(r+="</colgroup>",this.showHead){r+="<thead><tr>";for(l=0;l<t.length;l++){c=t[l];r+='<th style="'+s+'">'+htmlEscape(c.caption||c.expression.caption)+"</th>"}r+="</tr></thead>"}r+="<tbody>";for(var d=0;d<i.length&&d<6;d++){var h=i[d],p=(o[h]||n[h]).values;r+="<tr>";for(l=0;l<t.length;l++){if((c=t[l]).isReadable){var u=p[l],f=c.expression.returnType;if("html"===f.base)r+='<td class="html" style="'+s+'">'+(g=u||"")+"</td>";else if("file"===f.base){var m=u?database.thumbURL1(u):void 0;r+=m?'<td style="background-image:url(&quot;'+m+'&quot;);background-repeat:no-repeat;background-position:center;background-size:contain"></td>':"<td></td>"}else{var g=f.format(u);r+='<td style="text-align:'+f.columnAlign+";"+s+'">'+htmlEscape(g)+"</td>"}}else r+="<td></td>"}r+="</tr>"}if(r+="</tbody>",this.showFoot){r+="<tfoot><tr>";for(l=0;l<t.length;l++){if((c=t[l]).isReadable){g="";if(c.agg){var v=c.aggType;v.base;g=v.format(a[l]),r+='<td style="text-align:'+v.columnAlign+";"+s+'">'+htmlEscape(g)+"</td>"}else r+="<td></td>"}else r+="<td></td>"}r+="</tr></tfoot>"}e.html(r)},a.prototype._resize=function(e){var t=this.$wrap,i=this.query.cols,o=this.w;if(i.length>0){for(var n=0,a=0;a<i.length;a++)i[a].width<1&&(i[a].width=1),n+=i[a].width;var s=o/n;n=0;for(a=0;a<i.length-1;a++){var r=e?i[a].width*s:Math.round(i[a].width*s);i[a].width=r,n+=r}i[i.length-1].width=o-n,n=0;var l=t.children("table").children("colgroup").children();for(a=0;a<i.length;a++){var c=i[a];l[a].style.width=c.width+"mm",n+=c.width,c.$resize&&(c.$resize[0].style.left=n+"mm")}}t.children()[0].style.width=o+"mm"},a.prototype.resize=function(e){this._resize(e),this.updateAutoHeight(),this.tableMenu&&this.tableMenu.updateUI(),this.columnMenu&&this.columnMenu.updateUI()},a.prototype._select=function(){this.tableMenu=new s(this),this.tableMenu.updateUI()},a.prototype._unselect=function(){this.tableMenu.destroy(),this.tableMenu=null},a.prototype.startEdit=function(){null===this.mode&&(this.mode="edit",this.selected&&this.hideResizers(),this.showRulers(),this.columnMenu=new r(this))},a.prototype.stopEdit=function(){"edit"===this.mode&&(this.mode=null,this.selected&&this.showResizers(),this.hideRulers(),void 0!==this.selectedColIndex&&(this.$col(this.selectedColIndex).removeClass("selected"),this.selectedColIndex=void 0),this.columnMenu.destroy(),this.columnMenu=null)},a.prototype.$col=function(e){return $(this.$wrap.children("table").children("colgroup").children()[e])},a.prototype.showRulers=function(){for(var e=this,t=this.query.cols,i=0,o=this.designer,n=0;n<t.length;n++){var a=t[n];i+=a.width,a.$resize=$('<div class="rd-rev-ctrl-resize">').data("col",a).css({top:"-12px",left:i+"mm"}).appendTo(this.$object),TOUCH?a.$resize[0].addEventListener(EVENT_touchstart,s):a.$resize.mousedown(s)}function s(t){if(!TOUCH||1===t.touches.length){var i=$(t.target).data("col"),n=TOUCH?t.touches[0].clientX:t.clientX;return TOUCH?(document.addEventListener(EVENT_touchmove,a),document.addEventListener(EVENT_touchend,s)):$(document).on("mousemove",a).on("mouseup",s),t.preventDefault(),!1}function a(t){if(!TOUCH||1===t.touches.length){var a=TOUCH?t.touches[0].clientX:t.clientX,s=(a-n)*o.scale;return i.width+s>=5&&(i.width=i.width+s,e.w=e.w+s,e.$object[0].style.width=e.w+"mm"),e.resize(!0),n=a,t.preventDefault(),!1}}function s(t){if(!TOUCH||0===t.touches.length)return TOUCH?(document.removeEventListener(EVENT_touchmove,a),document.removeEventListener(EVENT_touchend,s)):$(document).off("mousemove",a).off("mouseup",s),e.w=Math.round(e.w),e.$object[0].style.width=e.w+"mm",e.resize(!1),e.designer.setDirty(),t.preventDefault(),!1}}},a.prototype.hideRulers=function(){for(var e=this.query.cols,t=0;t<e.length;t++){var i=e[t];i.$resize.remove(),i.$resize=void 0}},a.prototype.click=function(e){if("edit"===this.mode){var t=$(e.target).closest("th,td");if(t.length){void 0!==this.selectedColIndex&&this.$col(this.selectedColIndex).removeClass("selected");var i=t.index();this.query.cols[i];this.$col(i).addClass("selected"),this.selectedColIndex=i,this.columnMenu.updateUI()}}},a.prototype.updateAutoHeight=function(){o.a.prototype.updateAutoHeight.apply(this,arguments)},a.prototype.fontChanged=function(){this.updateUI()},s.prototype.updateUI=function(){this.$showHead.prop("checked",this.reverse.showHead),this.$showFoot.prop("checked",this.reverse.showFoot)},s.prototype.editColumns=function(){var e=this.reverse;new n.a({config:e.query.getConfig(),save:function(t){var i=t.config,o="edit"===e.mode;o&&e.stopEdit(),e.designer.setDirty(),e.query.setConfig(i),e.query.load((function(){e.updateTable(),e.resize(),o&&e.startEdit()}))}})},s.prototype.editBorder=function(){for(var e=this.reverse,t=$.backplane({autoClose:!0}),i=$('<div class="nx-menu-popup grey">').appendTo(t),o=0;o<6;o++)!function(o){$('<div class="rd-table-border-option rd-table-border-style'+o+'"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody><tfoot><tr><td></td><td></td><td></td></tr></tfoot></div>').appendTo(i).click((function(){e.tableBorderStyle=o,e.updateUI(),e.designer.setDirty(),t.close()})),(o+1)%3==0&&$("<br>").appendTo(i)}(o);i.center()},s.prototype.destroy=function(){this.$el.remove()},r.prototype.updateUI=function(){var e=this.reverse.query.cols[this.reverse.selectedColIndex];e?(this.$width.val(e.width),this.$el.show()):this.$el.hide()},r.prototype.widthChanged=function(){var e=this.reverse.query.cols[this.reverse.selectedColIndex];if(e){var t=Math.round(Number(this.$width.val()));if(t>0){var i=t-e.width;e.width=t,this.reverse.setRect(void 0,void 0,this.reverse.w+i,void 0,!1),this.reverse.designer.setDirty()}}},r.prototype.destroy=function(){this.$el.remove()}},"./src/js/reports/RDText.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));i("./node_modules/core-js/modules/es.string.replace.js"),i("./node_modules/core-js/modules/web.url.to-json.js");var o=i("./src/js/reports/RDObject.js"),n=i("./src/js/admin/FunctionEditor.js");function a(e){return e<1?1.25:e+.25/e}function s(e,t){o.a.call(this,e,t),this.text=t.text||"",this.verticalAlign=t.verticalAlign||null,this.paddingL=t.paddingL||0,this.paddingR=t.paddingR||0,this.paddingT=t.paddingT||0,this.paddingB=t.paddingB||0,this.lineHeight=t.lineHeight||1,this.textDecoration=t.textDecoration||null,this.fontStyle=t.fontStyle||null,this.fontWeight=t.fontWeight||null,this.displayText="",this.printableText="",this.$wrap=null,this.$text=null}Object.assign(s.prototype,o.a.prototype),s.prototype.base="text",s.prototype.toJSON=function(){return Object.assign(o.a.prototype.toJSON.apply(this),{base:"text",isAutoHeight:this.isAutoHeight||!1,text:this.text,verticalAlign:this.verticalAlign,paddingL:this.paddingL,paddingR:this.paddingR,paddingT:this.paddingT,paddingB:this.paddingB,textDecoration:this.textDecoration,fontStyle:this.fontStyle,fontWeight:this.fontWeight,lineHeight:this.lineHeight})},s.prototype.reload=function(e){var t=this;t.load((function(){t.$text.text(t.displayText||" "),t.updateAutoHeight(),e()}))},s.prototype.load=function(e){var t=this,i=this.designer.type.schema,o=this.designer.type,n=this.designer.nid,a=t.text.replace(/\$pages/g,"99").replace(/\$page/g,"1"),s=t.text,r=null;try{r=queries.parseSystemStringTemplate(i,o,a,{})}catch(e){console.warn(e)}var l=null;try{l=queries.parseSystemStringTemplate(i,o,s,{})}catch(e){console.warn(e)}var c=database.loadNodeSync(n);r&&l?database.canRead(r)?r.evaluate(database,c,(function(i,o){l.evaluate(database,c,(function(i,n){t.displayText=o,t.printableText=n,e()}))})):(t.displayText="",t.printableText="",e()):(t.displayText=a,t.printableText=s,e())},s.prototype.init=function(){o.a.prototype.init.call(this),this.$wrap=$('<div class="rd-object-text-wrap">').css({"-webkit-align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start","align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start"}).appendTo(this.$object),this.$text=$('<div class="rd-object-text-text">').css({"padding-left":this.paddingL?this.paddingL+"mm":"","padding-right":this.paddingR?this.paddingR+"mm":"","padding-top":this.paddingT?this.paddingT+"mm":"","padding-bottom":this.paddingB?this.paddingB+"mm":"","text-decoration":this.textDecoration||"","font-weight":this.fontWeight||"","font-style":this.fontStyle||"","line-height":a(this.lineHeight)}).appendTo(this.$wrap).text(this.displayText||" ")},s.prototype.renderPaper=function(){return Object.assign(o.a.prototype.renderPaper.apply(this,arguments),{base:"text",text:this.printableText||" ",verticalAlign:this.verticalAlign||"top",isHTML:!1,dynamicHeight:this.isAutoHeight||!1,paddingL:(this.paddingL||0)*printer.MM,paddingR:(this.paddingR||0)*printer.MM,paddingT:(this.paddingT||0)*printer.MM,paddingB:(this.paddingB||0)*printer.MM,textDecoration:this.textDecoration,fontStyle:this.fontStyle,fontWeight:this.fontWeight,lineHeight:this.lineHeight})},s.prototype.setPadding=function(e,t,i,o){void 0!==e&&(this.paddingL=e||0),void 0!==t&&(this.paddingR=t||0),void 0!==i&&(this.paddingT=i||0),void 0!==o&&(this.paddingB=o||0),this.$text.css({"padding-left":this.paddingL?this.paddingL+"mm":"","padding-right":this.paddingR?this.paddingR+"mm":"","padding-top":this.paddingT?this.paddingT+"mm":"","padding-bottom":this.paddingB?this.paddingB+"mm":""}),this.updateAutoHeight(),this.designer.setDirty()},s.prototype.startEdit=function(){TOUCH?this.startEdit_TOUCH():this.startEdit_DESKTOP()},s.prototype.startEdit_DESKTOP=function(){var e=this;this.$object.addClass("editing"),this.$text.remove(),this.$text=$("<textarea>").attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false").css({"vertical-align":this.verticalAlign||"","padding-left":this.paddingL?this.paddingL+"mm":"","padding-right":this.paddingR?this.paddingR+"mm":"","padding-top":this.paddingT?this.paddingT+"mm":"","padding-bottom":this.paddingB?this.paddingB+"mm":"","text-decoration":this.textDecoration||"","font-weight":this.fontWeight||"","font-style":this.fontStyle||"","line-height":a(this.lineHeight),height:this.h+6+"mm","background-color":"#fff",color:"#000"}).val(this.getEditableText()||"").appendTo(this.$wrap).focus();var t=this.$text.position();function i(){var t=e.$text[0].selectionStart;(!t||t<0)&&(t=0);var i=e.$text.val(),o=i.substr(0,t),a=i.substr(t),s=/\{([^\}]*)$/.exec(o),r=/^([^\{]*)\}/.exec(a),l="";s&&r&&(o=o.substr(0,s.index),a=a.substr(r[0].length),l=s[1]+r[1]),new n.a({value:l,isHuman:!0,schema:e.designer.type.schema,type:e.designer.type,okay:function(t,i){t&&i?e.$text.val(o+"{"+i.toHumanString()+"}"+a).focus():e.$text.val(o+a).focus()},cancel:function(){e.$text.focus()}})}t.top-=32,t.left+=this.$text.width()-16,this.$button=$('<div class="button blue icon i-32-24 i-white i-setting-settings" style="position:absolute;border-radius:2px;z-index:2">').offset(t).appendTo(this.$object).on(TOUCH?EVENT_touchstart:"mousedown",i)},s.prototype.startEdit_TOUCH=function(){var e=this,t=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)),i=$('<div class="nx-menu-popup grey" style="left:64px;top:20px;right:64px;bottom:0px">').appendTo(t),o=$('<div class="nx-button-bar" style="position:absolute;left:8px;top:-32px;right:8px">').appendTo(i);$('<div class="nx-button-text grey">').text(locale.function+"...").appendTo(o).click(l),$('<div class="nx-hspace-flex">').appendTo(o),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(o).click(s);var a=$('<textarea style="position:absolute;left:16px;right:16px;bottom:16px;top:64px;height:auto;padding:8px;border:none;border-radius:4px;margin:0;height:auto;font-size:inherit;font-family:inherit">').attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false").val(this.getEditableText()||"").appendTo(i).focus();function s(){var t=e.text,i=queries.formatHumanStringTemplateSystem(a.val(),e.designer.type);t!==i?(e.text=i,$.loading(!0),e.load((function(){$.loading(!1),e.$text.text(e.displayText||" "),e.updateAutoHeight(),e.designer.setDirty(),r()}))):r()}function r(){t.remove()}function l(){var t=a[0].selectionStart;(!t||t<0)&&(t=0);var i=a.val(),o=i.substr(0,t),s=i.substr(t),r=/\{([^\}]*)$/.exec(o),l=/^([^\{]*)\}/.exec(s),c="";r&&l&&(o=o.substr(0,r.index),s=s.substr(l[0].length),c=r[1]+l[1]),new n.a({value:c,schema:e.designer.type.schema,type:e.designer.type,okay:function(e,t){e&&t?a.val(o+"{"+t.toHumanString()+"}"+s).focus():a.val(o+s).focus()},cancel:function(){a.focus()}})}},s.prototype.stopEdit=function(){TOUCH?this.stopEdit_TOUCH():this.stopEdit_DESKTOP()},s.prototype.stopEdit_TOUCH=function(){},s.prototype.stopEdit_DESKTOP=function(){var e=this;this.$object.removeClass("editing");var t=this.text,i=queries.formatHumanStringTemplateSystem(this.$text.val(),this.designer.type);this.$text.remove(),this.$button&&this.$button.remove(),this.$text=$('<div class="rd-object-text-text">').css({"vertical-align":this.verticalAlign||"","padding-left":this.paddingL?this.paddingL+"mm":"","padding-right":this.paddingR?this.paddingR+"mm":"","padding-top":this.paddingT?this.paddingT+"mm":"","padding-bottom":this.paddingB?this.paddingB+"mm":"","text-decoration":this.textDecoration||"","font-weight":this.fontWeight||"","font-style":this.fontStyle||"","line-height":a(this.lineHeight)}).text(this.displayText||" ").appendTo(this.$wrap),t!==i&&(e.text=i,$.loading(!0),e.load((function(){$.loading(!1),e.$text.text(e.displayText||" "),e.updateAutoHeight(),e.designer.setDirty()})))},s.prototype.setVerticalAlign=function(e){this.verticalAlign=e||null,this.$wrap.css({"-webkit-align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start","align-items":"middle"===this.verticalAlign?"center":"bottom"===this.verticalAlign?"flex-end":"flex-start"}),this.designer.setDirty()},s.prototype.setLineHeight=function(e){(e=Number(e))>=1&&(this.lineHeight=e,this.$text.css("line-height",a(e)),this.updateAutoHeight(),this.designer.setDirty())},s.prototype.getEditableText=function(){var e=this.text;return queries.formatSystemStringTemplateHuman(e,this.designer.type)},s.prototype.setTextDecoration=function(e){this.textDecoration=e||null,this.$text.css("text-decoration",e||""),this.updateAutoHeight(),this.designer.setDirty()},s.prototype.setFontStyle=function(e){this.fontStyle=e||null,this.$text.css("font-style",e||""),this.updateAutoHeight(),this.designer.setDirty()},s.prototype.setFontWeight=function(e){this.fontWeight=e||null,this.$text.css("font-weight",e||""),this.updateAutoHeight(),this.designer.setDirty()}},"./src/js/reports/TextMenu.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i("./src/js/widgets/Field.js"),n=i("./node_modules/underscore/underscore.js");function a(e){var t=this;this.designer=e,this.silent=!1,this.$el=$('<div class="rd-menu-bar center">').hide().appendTo(e.$menu);var i=NinoxDocumentInteraction.availableFontFamilies(),a={};n.each(util.localeSort(i),(function(e){a[e]={id:e,caption:e,font:e}}));var s=this.font=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{required:!0,values:a}));s.withoutLabel=!0,(this.fontField=new o.a(this,s,this.$el)).el.css({width:140,margin:0,"vertical-align":"baseline"}),s.on("update",(function(){e.selection&&e.selection.setFontFamily&&e.selection.setFontFamily(s.value)}));for(var r={},l=1;l<=36;l++){var c=String(l);r[c]={caption:c,id:c,order:l}}this.sizeModel=new util.SimpleModel(new schemas.TNumber(void 0,void 0,{required:!0,numberMin:1,numberMax:256})),this.sizeModel.withoutLabel=!0,this.sizeField=new o.a(this,this.sizeModel,this.$el),this.sizeField.el.css({width:80,margin:0,"vertical-align":"baseline"}),this.sizeModel.on("update",(function(){if(!t.silent&&e.selection&&e.selection.setFontFamily){var i=t.sizeModel.value;(isNaN(i)||i<0)&&(i=null),e.selection.setFontSize(i)}})),$("<br>").appendTo(this.$el),this.$bold=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-bold">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setFontWeight&&e.selection.setFontWeight(e.selection.fontWeight?null:"bold")})),this.$italic=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-italic">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setFontStyle&&e.selection.setFontStyle(e.selection.fontStyle?null:"italic")})),this.$underline=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-underline">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setTextDecoration&&e.selection.setTextDecoration(e.selection.textDecoration?null:"underline")})),$("<br>").appendTo(this.$el),this.$lhPane=$("<div>").appendTo(this.$el),$("<span>").text(locale.lineHeight+" ").appendTo(this.$lhPane),this.lhModel=new util.SimpleModel(new schemas.TNumber(void 0,void 0,{required:!0,numberMin:1})),this.lhModel.withoutLabel=!0,this.lhModel.on("update",(function(){!t.silent&&e.selection&&e.selection.setFontFamily&&e.selection&&e.selection.setLineHeight&&e.selection.setLineHeight(t.lhModel.value||1)})),this.lhField=new o.a(this,this.lhModel,this.$lhPane),this.lhField.el.css({width:80,margin:0,"vertical-align":"baseline"}),this.$alignLeft=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-h-align-left">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setTextAlign&&e.selection.setTextAlign("left")})),this.$alignCenter=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-h-align-center">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setTextAlign&&e.selection.setTextAlign("center")})),this.$alignRight=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-h-align-right">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setTextAlign&&e.selection.setTextAlign("right")})),this.$alignJustify=$('<div class="rd-menu-button">').append($('<div class="i-32-24 i-light-grey i-h-align-justify">')).appendTo(this.$el).click((function(){e.selection&&e.selection.setTextAlign&&e.selection.setTextAlign("justify")})),$("<br>").appendTo(this.$el),this.$valignTop=$('<div class="button i-32-24 i-light-grey i-v-align-top">').appendTo(this.$el).click((function(){e.selection&&e.selection.setVerticalAlign&&e.selection.setVerticalAlign(null)})),this.$valignMiddle=$('<div class="button i-32-24 i-light-grey i-v-align-middle">').appendTo(this.$el).click((function(){e.selection&&e.selection.setVerticalAlign&&e.selection.setVerticalAlign("middle")})),this.$valignBottom=$('<div class="button i-32-24 i-light-grey i-v-align-bottom">').appendTo(this.$el).click((function(){e.selection&&e.selection.setVerticalAlign&&e.selection.setVerticalAlign("bottom")}))}a.prototype.updateUI=function(){this.silent=!0;var e=this.designer.selection;e?(e.setFontFamily?(this.font.value=e.getFontFamily(),this.fontField.editor.load(),this.fontField.el.css({display:""})):this.fontField.el.css({display:"none"}),e.setFontSize?(this.sizeModel.setValue(e.getFontSize()),this.sizeField.el.css({display:""})):this.sizeField.el.css({display:"none"}),e.setFontWeight?this.$bold.show():this.$bold.hide(),e.setFontStyle?this.$italic.show():this.$italic.hide(),e.setTextDecoration?this.$underline.show():this.$underline.hide(),e.setLineHeight?(this.$lhPane.show(),this.lhModel.setValue(e.lineHeight||1)):this.$lhPane.hide(),e.setTextAlign?(this.$alignLeft.show(),this.$alignCenter.show(),this.$alignRight.show(),this.$alignJustify.show()):(this.$alignLeft.hide(),this.$alignCenter.hide(),this.$alignRight.hide(),this.$alignJustify.hide()),e.setVerticalAlign?(this.$valignTop.show(),this.$valignMiddle.show(),this.$valignBottom.show()):(this.$valignTop.hide(),this.$valignMiddle.hide(),this.$valignBottom.hide()),this.$el.show()):this.$el.hide(),this.silent=!1}},"./src/js/ui/ui-util.js":function(e,t,i){"use strict";i.d(t,"h",(function(){return l})),i.d(t,"f",(function(){return c})),i.d(t,"c",(function(){return d})),i.d(t,"i",(function(){return p})),i.d(t,"j",(function(){return u})),i.d(t,"b",(function(){return f})),i.d(t,"a",(function(){return m})),i.d(t,"k",(function(){return g})),i.d(t,"d",(function(){return v})),i.d(t,"g",(function(){return y})),i.d(t,"e",(function(){return b})),i.d(t,"l",(function(){return w}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),n=i.n(o),a=i("./src/js/printer/printNode.js");function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){n()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t,i){database.loadFiles(e,(function(e,o){var n,a={};if(o)for(var s=0;s<o.length;s++){var r=o[s].name,l=/\.[^\.]*$/.exec(r);l&&(r=r.substr(0,l.index)),a[r]=!0}if(!a[t])return i(void 0,t);var c=/\s*([0-9]+)$/.exec(t);for(c?(t=t.substr(0,c.index),n=parseInt(c[1])+1):(t+=" ",n=2);a[t+n];)n++;i(void 0,t+n)}))}function c(){return!!NinoxDocumentInteraction.getUserDefault("nx.server")}function d(e,t,i){if(i=i||function(){},!e)return i();var o;try{o=queries.parseSystem(database.schema,database.schema.typeOf(t),e,{})}catch(e){return $.alert(e),i()}return o?o.hasErrors()?($.alert(o.errorMessage()),i()):void h(t,(function(e){$.loading(!0),database.evaluate?database.evaluate(o,e,(function(e,t){return $.loading(!1),i(e,t)})):o.evaluate(database,e,(function(e,t){return $.loading(!1),i(e,t)}))})):i()}function h(e,t){return e?"object"==typeof e?t(e):void database.loadNode(e,(function(e,i){t(i)})):t()}function p(e,t){e&&(window.reports?reports.openDesigner({nid:e,nids:t}):Object(a.a)(e))}function u(e){if(e){var t=database.typeOf(e);if(t)return database.canDelete(t)?void $.dialog({closable:!0,caption:locale.remove,message:locale.confirmRemove,buttons:[{color:"red",caption:locale.remove,callback:function(){database.remove(e,(function(e){e&&$.alert(e)}))}}]}):$.alert(locale.errorNotAuthorized)}}function f(e,t){if(e){var i=database.typeOf(e);if(i)return i.isNew?$.alert(locale.schemaSaveRequired):database.canCreate(i)?void database.duplicate(e,(function(e,i){if(e)return $.alert(e);t&&t(i)})):$.alert(locale.errorNotAuthorized)}}function m(e,t){return e.isNew?$.alert(locale.schemaSaveRequired):database.canCreate(e)?void database.create(e,{},(function(e,i){if(e)return $.alert(e);i&&t&&t(i._id)})):$.alert(locale.errorNotAuthorized)}function g(e){if(window._serverConfig={},!c())return e();dbms.getRemoteConnection().getServerConfig((t,i)=>{window._serverConfig=i||{},e()})}function v(e=""){const t=window._serverConfig||{};return e?t[e]:t}function y(){return c()&&v("saml")}function b(e){let t=null;const i=v("passwordPolicy")||{};function o(){NinoxDocumentInteraction.setUserDefault("nx.lastActivityAt",Date.now()),clearTimeout(t),t=setTimeout(n,e)}function n(){var e=NinoxDocumentInteraction.getUserDefault("nx.lastActivityAt");e&&(Date.now()-parseInt(e)>60*parseInt(i.idleTimeoutInMinutes)*1e3&&"#NO-USER-ID#"!=dbms.getRemoteConnection().getSessionInfo().user.id&&dbms.getRemoteConnection().logout((function(e){e&&$.alert(e)})))}o(),window.onmousemove=o,window.onmousedown=o,window.onkeydown=o,window.onwheel=o,window.ontouchstart=o,window.ontouchmove=o,window.onclick=o,window.onscroll=o}function w(){{const e=e=>{var t=$.currentInputHandler();return!(!t||"function"!=typeof t[e+"Enabled"])&&t[e+"Enabled"]()},t={menuNewDatabase:!1,menuImportArchive:!1,menuSaveArchiveAs:!1,menuDuplicateDatabase:!1,menuRenameDatabase:!1,menuDeleteDatabase:!1,menuCloseDatabase:!1,menuReorganizeDatabase:!1,menuNewTable:!1,menuEditTable:!1,menuDeleteTable:!1,menuNewView:!1,menuRenameView:!1,menuDeleteView:!1,menuEditColumns:!1,menuShowViewAsForm:!1,menuShowViewAsTable:!1,menuShowViewAsChart:!1,menuFindInView:!1,menuSelectAllRecords:!1,menuClearSelection:!1,menuToggleSelection:!1,menuShowAllRecords:!1,menuShowSelectedRecords:!1,menuExpandAllGroups:!1,menuCollapseAllGroups:!1,menuPrintView:!1,menuImportData:!1,menuExportData:!1,menuMassDataUpdate:!1,menuReloadView:!1,menuNextRecord:!1,menuPrevRecord:!1,menuFirstRecord:!1,menuLastRecord:!1,menuCreateRecord:!1,menuDuplicateRecord:!1,menuDeleteRecord:!1,menuUnlinkRecord:!1,menuPrintRecord:!1,menuCloseRecord:!1,menuPageUp:!1,menuPageDown:!1,menuPrevGroup:!1,menuNextGroup:!1,menuExpandGroup:!1,menuCollapseGroup:!1,menuToggleGroup:!1};for(const i in t)t[i]=e(i);NinoxViewController.setMenuState({nionx_cutEnabled:window.ninox_cutEnabled(),ninox_copyEnabled:window.ninox_copyEnabled(),ninox_pasteEnabled:window.ninox_pasteEnabled(),ninox_menuEnabled:r({},t,{menuNewDatabase:!ui.isInitialized,menuImportArchive:!ui.isInitialized,menuSaveArchiveAs:!!ui.isInitialized&&window.database&&!window.database.sql,menuDuplicateDatabase:!!ui.isInitialized&&window.database&&!window.database.sql,menuRenameDatabase:!!ui.isInitialized,menuReorganizeDatabase:!!(ui.isInitialized&&window.database&&database.cloud),menuDeleteDatabase:!!ui.isInitialized,menuCloseDatabase:!!ui.isInitialized})})}}},"./src/js/widgets/Component.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("./src/js/admin/AdminField.js");function n(){}n.prototype._isWritable=!1,n.prototype.destroy=function(){this.el.remove()},n.prototype.isWidthAdjustable=function(){return!0},n.prototype.updateElementWidth=function(){if(this.field){var e=4/(this.container&&this.container.columns||4),t=Math.min(1,Math.max(0,e*this.field.formWidth));this.el.css("width",100*t+"%")}},n.prototype.setWidth=function(e,t){this.field&&(this.field.formWidth=t,this.field.width=e),this.updateElementWidth(),this.widthChanged()},n.prototype.widthChanged=function(){},n.prototype.isHeightAdjustable=function(){return!1},n.prototype.setHeight=function(e){},n.prototype.updateStructure=function(){},n.prototype.next=function(){return this.el.next(".component").data("component")||this.el.siblings(".component").first().data("component")},n.prototype.prev=function(){return this.el.prev(".component").data("component")||this.el.siblings(".component").last().data("component")},n.prototype.blur=function(){},n.prototype.focus=function(){return!1},n.prototype.focusNext=function(){this.blur();for(var e=this;;){var t=e.next();if(!t)break;if(t===this)break;if(t.focus())break;e=t}},n.prototype.focusPrev=function(){this.blur();for(var e=this;;){var t=e.prev();if(!t)break;if(t===this)break;if(t.focus())break;e=t}},n.prototype.nodeChanged=function(){this.updateIsWritable(),this.updateVisibility()},n.prototype.setVisible=function(e){this.visible=e,e?this.el[0].style.display="":(this.blur(),this.el[0].style.display="none")},n.prototype.updateVisibility=function(){if(this.field.visibilityExp){var e=this,t=this._updateVisibilityId=Math.random();database.loadNode(e.container.nid,(function(i,o){o&&e.field.visibilityExp.evaluate(database,o,(function(i,o){t===e._updateVisibilityId&&e.setVisible(!(!i&&!o))}))}))}else this.visible||this.setVisible(!0)},n.prototype.isWritable=function(){return this._isWritable},n.prototype.updateIsWritable=function(){this._isWritable=this.container.isWritable()&&database.canWriteNodeField(this.container.nid,this.field.id)},n.prototype.bind=function(e){this.updateIsWritable(),this.updateVisibility()},n.prototype.popup=function(e){new o.a(this,this.field,e)},n.prototype.setError=function(e){(e=e||this.getError())?(this.error||(this.error=$('<div class="editor-error">').appendTo(this.el)),this.error.html('<div class="editor-error-text"><div class="editor-error-icon i-red i-16-12 i-warning"></div>'+htmlEscape(e)+"</div>"),this.el.addClass("error")):(this.error&&this.error.remove(),this.error=void 0,this.el.removeClass("error"))},n.prototype.getError=function(){},n.prototype.isFullscreen=function(){return this.container&&this.container.isFullscreen&&this.container.isFullscreen()}},"./src/js/widgets/Field.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var o=i("./src/js/widgets/Component.js"),n=i("./src/js/widgets/widgets.js");function a(e,t,i,o){o=o||{},this.container=e,this.model=t,this.visible=!0;var a=t.field,s=a.getEditorClass();this.el=$('<div class="component">').data("component",this).appendTo(i||e.containerEl||e.el),o.cls&&this.el.addClass(o.cls),this.el.toggleClass("label-left","left"===a.labelPosition),this.label=$("<label>").text(t.caption||"").css("display",t.withoutLabel||widgets.DONT_SHOW_LABEL[s]||"placeholder"===a.labelPosition||"none"===a.labelPosition?"none":"").appendTo(this.el),this.el.addClass(Object(n.d)(t.field)),this.el.css("width",100*(o.formWidth||t.field.formWidth)+"%"),this.editor=Object(n.c)(this,t),this.editor.load(!0)}a.prototype.next=o.a.prototype.next,a.prototype.prev=o.a.prototype.prev,a.prototype.focusNext=o.a.prototype.focusNext,a.prototype.focusPrev=o.a.prototype.focusPrev,a.prototype.setError=o.a.prototype.setError,a.prototype.getError=o.a.prototype.getError,a.prototype.focus=function(){if(!this.visible)return!1;if(!this.isWritable())return!1;var e=this;if(e.editor.focus){var t=e.container&&e.container.el||e.el.parent(),i=t.offset().top,o=i+t.height(),n=t.scrollTop(),a=e.el.offset().top,s=e.el.height()+a+8;return a<i?t.scrollTop(n-(i-a)):s>o&&t.scrollTop(n+(s-o)),setTimeout((function(){e.editor.focus()}),0),!0}return!1},a.prototype.blur=function(){this.editor.blur&&this.editor.blur()},a.prototype.destroy=function(){this.editor.destroy(),this.el.remove()},a.prototype.getModel=function(){return this.model},a.prototype.show=function(){this.el.css("display","")},a.prototype.hide=function(){this.el.css("display","none")},a.prototype.editorUp=function(){this.container.editorUp&&this.container.editorUp()},a.prototype.editorDown=function(){console.log("Field.editorDown"),this.container.editorDown&&this.container.editorDown()},a.prototype.widthChanged=function(){this.container.widthChanged&&this.editor.widthChanged()},a.prototype.isWritable=function(){return!0}},"./src/js/widgets/editors/ChoiceEditor.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r}));var o=i("./src/js/widgets/editors/StringEditor.js"),n=i("./node_modules/underscore/underscore.js");function a(e,t){this.orderedValues=[],this.visibleValues=[],this.selectedValueId=void 0,this.filterString="",this.currentString="",this.index0=0,this.index1=0,o.a.apply(this,arguments)}function s(e,t){const i=Math.min(e.length,t.length);for(var o=0;o<i;o++)if(e[o]!==t[o])return o;return i}function r(){a.apply(this,arguments)}function l(e,t){for(var i=0;i<e.length;i++){if(e[i].id===t)return i}return-1}Object.assign(a.prototype,o.a.prototype),a.prototype.editorClass="choice",a.prototype.hideButtonOnEmpty=!1,a.prototype.createRenderer=function(){this.text=$('<div class="choice text-selectable">').appendTo(this.el).touch($.proxy(this.container.focus,this.container)),this.button=$('<div class="choice-dropdown">').appendTo(this.el).touch($.proxy(this.container.focus,this.container))},a.prototype.destroyRenderer=function(){this.text&&(this.text.remove(),this.text=void 0),this.button&&(this.button.remove(),this.button=void 0)},a.prototype.showAux=function(){if(this.$aux)return;var e=this,t=this.model.field;this.selectedValueId=null==this.value?"###NULL###":this.value,this.orderedValues=[],this.filterString="",this.currentString=this.input.val(),this.visibleValues=[];let i=!0;function o(t){e.updating=!0,e.updateModel(t,(function(t){e.updating=!1,e.stopEdit()}))}this.$view=$('<div style="position:relative;left:0;top:0;height:100%;min-width:'+this.el.outerWidth()+'px">'),this.$items=$('<div style="position:relative;left:0;top:0;min-width:100%">').appendTo(this.$view),this.$aux=$('<div class="choice-menu" style="min-width:'+this.el.outerWidth()+'px;overflow-y:auto;z-index:12">').append(this.$view).appendTo($(document.body)).on("scroll",()=>{this.updateView()}).on(EVENT_touchmove,()=>{TOUCH&&(i=!1)}).on(TOUCH?EVENT_touchend:"mousedown",(function(e){if(!TOUCH||i){var n=$(e.target).closest(".choice-menu-item").attr("data-id");null!=n&&o("###NULL###"===n?null:t.convert(n))}else i=!0})).on(TOUCH?EVENT_touchend:"mousedown",(function(e){if(!TOUCH||i){var t=$(e.target).closest(".choice-menu-item").attr("data-id");null!=t&&o("###NULL###"===t?null:t)}else i=!0})),this.reloadValues()},a.prototype.reloadValues=function(){if(!this.$aux)return;const e=Date.now();this.model.field.loadValuesSorted(this.getNid(),t=>{const i=Date.now();console.log("ChoiceEditor.reloadValues",i-e+"ms",JSON.stringify(t)),this.orderedValues=t,this.updateAux(!0)})},a.prototype.hideAux=function(){this.$aux&&(this.$aux.remove(),this.$aux=null,this.$view=null,this.$items=null,this.orderedValues=[],this.visibleValues=[],this.selectedValueId=void 0)},a.prototype.afterLoaded=function(){"dchoice"===this.model.field.base&&this.reloadValues()},a.prototype.updateAux=function(e){const t=Date.now();var i=this,o=this.$aux,a=this.model.field;if(!o)return;var s=0,r=this.filterString,l=!r,c=this.visibleValues=[];!a.required&&l&&(c.push({id:"###NULL###"}),s++),n.each(this.orderedValues,(function(e){(l||0===(e.caption||"").toLocaleLowerCase().indexOf(r))&&(c.push(e),s++)}));const d=Date.now();this.$view[0].style.height=32*s+"px";const h=Date.now();function p(){var e=i.el.offset(),t=window.getWidth(),n=window.getHeight(),a=e.left,r=e.top+36,l=o.outerWidth(),c=32*s;c>n-r&&(n-r>=e.top-4?c=n-r:(c=Math.min(e.top-4,c),r=e.top-4-c)),a+l>t&&(a=t-l),o.css({left:a,top:r,height:c});var d=o.children(".selected");if(d.length){var h=d.offset().top,p=h+32;h<r?o.scrollTop(o.scrollTop()+h-r):p>r+c&&o.scrollTop(o.scrollTop()+p-r-c)}}console.log("ChoiceEditor.update",d-t+"ms",h-d+"ms"),p(),this.index0=0,this.index1=0,this.updateView(),e&&(this.$items[0].style.width=this.$items.width()+"px")},a.prototype.updateView=function(){if(this.$view){const t=this.$aux[0].scrollTop,i=this.$aux.height(),o=Math.max(0,Math.floor(t/32)),n=Math.min(this.visibleValues.length,Math.floor((t+i)/32));if(o<this.index0||n>this.index1){const t=Math.max(0,o-16),i=Math.min(this.visibleValues.length,n+16);this.index0=t,this.index1=i;let a="";for(var e=t;e<i;e++){const t=this.visibleValues[e];if(t){const e=t.id===this.selectedValueId;"###NULL###"===t.id?a+='<div class="choice-menu-item" data-id="###NULL###"><div class="choice-indicator'+(e?" selected":"")+'"></div><div class="choice-label">'+htmlEscape(locale.empty)+"</div></div>":a+='<div data-id="'+t.id+'" class="choice-menu-item" style="'+(t.color?"background-color:"+t.color+";color:"+t.textColor:"")+'"><div class="choice-indicator'+(e?" selected":"")+'"></div><div class="multicombo-item" style="background-color:transparent;color:'+t.textColor+'">'+(t.icon?'<div class="choice-symbol ic ic-'+t.icon+'"></div>':"")+"<span>"+htmlEscape(t.caption||"")+"</span></div></div>"}}this.$items[0].style.top=32*t+"px",this.$items[0].innerHTML=a}}},a.prototype.keyupCallback=function(e){switch(e.which){case 38:case 40:return e.preventDefault(),e.stopPropagation(),this.updateAux(),!1;default:var t=this.input.val();return t!==this.currentString&&(this.filterString=t.toLocaleLowerCase(),this.currentString=t,this.updateAux()),!0}},a.prototype.keydownCallback=function(e){switch(e.which){case 38:if((i=this.visibleValues)&&i.length){if(-1===(o=l(i,this.selectedValueId))){var t=i[i.length-1];this.selectedValueId=t.id,this.input.val(t.caption)}else if(o>0){t=i[o-1];this.selectedValueId=t.id,this.input.val(t.caption)}}else this.selectedValueId=void 0;return this.updateAux(),e.preventDefault(),e.stopPropagation(),!1;case 40:var i,o;if((i=this.visibleValues)&&i.length){if(-1===(o=l(i,this.selectedValueId))){t=i[0];this.selectedValueId=t.id,this.input.val(t.caption)}else if(o<i.length-1){t=i[o+1];this.selectedValueId=t.id,this.input.val(t.caption)}}else this.selectedValueId=void 0;return this.updateAux(),e.preventDefault(),e.stopPropagation(),!1}},a.prototype.parseEditorValue=function(e){if("dchoice"===this.model.field.base||"ref"===this.model.field.base){const t=e.toLocaleLowerCase();let i=0,o=void 0;for(const n of this.orderedValues){if(e===n.caption)return n.id;let a=s(t,(n.caption||"").toLocaleLowerCase());a>i&&(i=a,o=n)}return o?o.id:void 0}return this.model.field.parseEditor(e)},Object.assign(r.prototype,a.prototype),r.prototype.editorClass="user"},"./src/js/widgets/editors/ColorSelector.js":function(e,t,i){"use strict";i.d(t,"b",(function(){return c})),i.d(t,"a",(function(){return d}));var o=i("./src/js/widgets/editors/Editor.js");let n="presets";const a=8,s=8,r=a*s,l=["#FF7F66","#FFB450","#FADA33","#52CC74","#64C1FA","#6691FF","#9485F2","#EC87E2","#B7C0DB","#8594C2","#5E6E9C","#37405B"];function c(e,t){o.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el).touch($.proxy(this.popup,this)),this.text=$('<div class="input-text">').appendTo(this.el)}function d(e){var t=e.value?util.parseColor(e.value):[255,255,255],i=$.backplane({}),o=$('<div class="cs-menu">').appendTo(i),c=$('<div class="cs-tabs">').appendTo(o).touch(I),d=$('<div class="cs-tabs-selected-indicator">'),p=$('<div class="cs-tab" data-mode="presets">').text(locale.presets).appendTo(c),u=$('<div class="cs-tab" data-mode="palette">').text(locale.palette).appendTo(c),f=$('<div class="cs-tab" data-mode="custom">').text("RGB").appendTo(c),m=$('<div class="cs-pane cs-presets">').appendTo(o).touch(O),g=$('<div class="cs-pane cs-palette">').appendTo(o).touch(O),v=$('<div class="cs-pane cs-custom">').appendTo(o),y=$('<div class="cs-controls">').appendTo(o);e.required||$('<div class="nx-button-text-small blue">').text(locale.transparent).appendTo(y).touch((function(){M(null)}));var b=$('<div class="cs-custom-left">').appendTo(v),w=$('<div class="cs-custom-right">').appendTo(v),x=$('<div class="cs-color">').appendTo(b).touch(N),T=new h({$parent:w,min:0,max:255,val:t[0],round:!0,label:"R",update:D}),C=new h({$parent:w,min:0,max:255,val:t[1],round:!0,label:"G",update:D}),k=new h({$parent:w,min:0,max:255,val:t[2],round:!0,label:"B",update:D});function S(){d.detach(),"presets"===n?d.appendTo(p):"palette"===n?d.appendTo(u):d.appendTo(f),p.toggleClass("selected","presets"===n),u.toggleClass("selected","palette"===n),f.toggleClass("selected","custom"===n),m.css("display","presets"===n?"":"none"),g.css("display","palette"===n?"":"none"),v.css("display","custom"===n?"":"none");var t=o.outerWidth(),i=o.outerHeight(),a=e.$el.offset();a.top+=32,a.left+t>window.getWidth()&&(a.left=window.getWidth()-t),a.top+i>window.getHeight()&&(a.top=window.getHeight()-i),o.offset(a)}function _(){for(var e=0;e<l.length;e++){var t=l[e];$('<div class="cs-color'+("#FFFFFF"===t?" cs-color-bordered":"")+'">').css("background-color",t).attr("data-color",t).appendTo(m)}}function E(){for(var e=0;e<r;e++){var t=util.indexedColor(e,a,s);$('<div class="cs-color'+("#FFFFFF"===t?" cs-color-bordered":"")+'">').css("background-color",t).attr("data-color",t).appendTo(g)}}function D(){x.css("background-color",util.formatColor([T.getVal(),C.getVal(),k.getVal()]))}function N(){M(util.formatColor([T.getVal(),C.getVal(),k.getVal()]))}function I(e){var t=$(e.target);t.is(".cs-tab")&&(n=t.attr("data-mode"),S())}function O(e){var t=$(e.target);t.is(".cs-color")&&M(t.attr("data-color"))}function M(t){e.update(t),F()}function F(){i.close()}_(),E(),D(),S()}function h(e){var t=$('<div class="cs-slider">').appendTo(e.$parent),i=($('<div class="cs-slider-label">').text(e.label).appendTo(t),$('<div class="cs-slider-pane">').appendTo(t)),o=($('<div class="cs-slider-bar">').appendTo(i),$('<div class="cs-slider-knob">').appendTo(i)),n=$('<div class="cs-slider-text">').appendTo(t),a=$('<input type="number">').appendTo(n).change(d).blur(d);o[0].addEventListener(TOUCH?EVENT_touchstart:"mousedown",h);var s=e.min,r=e.max,l=e.val;function c(){var e=(l-s)/(r-s)*(i.width()-24);o.css("left",e+"px"),a.val(l)}function d(){var t=l,i=Number(a.val());isNaN(i)||(l=Math.max(s,Math.min(r,i)),e.round&&(l=Math.round(l))),c(),t!==l&&e.update&&e.update(l)}function h(t){if(TOUCH){if(1!==t.touches.length)return;EVENT_target(t).addEventListener(EVENT_touchmove,a,!1),EVENT_target(t).addEventListener(EVENT_touchend,d,!1)}else window.addEventListener("mousemove",a,!1),window.addEventListener("mouseup",d,!1);var o=TOUCH?t.touches[0].clientX:t.clientX,n=l;function a(t){if(!TOUCH||1===t.touches.length){var a=TOUCH?t.touches[0].clientX:t.clientX,d=n+(a-o)/(i.width()-24)*(r-s);l=Math.max(s,Math.min(r,d)),e.round&&(l=Math.round(l)),c(),e.update(l),t.preventDefault()}}function d(e){if(TOUCH){if(0!==e.touches.length)return;EVENT_target(e).removeEventListener(EVENT_touchmove,a,!1),EVENT_target(e).removeEventListener(EVENT_touchend,d,!1)}else window.removeEventListener("mousemove",a,!1),window.removeEventListener("mouseup",d,!1);e.preventDefault()}t.preventDefault()}c(),this.getVal=function(){return l}}Object.assign(c.prototype,o.a.prototype),c.prototype.editorClass="color",c.prototype.destroy=function(){this.el.remove()},c.prototype.updateUI=function(){this.text.css({backgroundColor:this.value||"#fff"})},c.prototype.popup=function(){var e=this;new d({value:e.value,$el:e.el,required:e.model.field.required,update:function(t){e.updateModel(t)}})}},"./src/js/widgets/editors/Editor.js":function(e,t,i){"use strict";function o(e,t){this.container=e,this.model=t,t.onUpdate(this.onUpdate,this)}i.d(t,"a",(function(){return o})),o.prototype.destroy=function(){this.model.offUpdate(this.updateUI,this)},o.prototype.isHeightAdjustable=function(){return!1},o.prototype.setHeight=function(){},o.prototype.updateStructure=function(){},o.prototype.load=function(e){console.log("Editor.load",this.model.field.caption);var t=this;this.model.getValue((function(i,o){i?t.setError(i):(!e&&util.equals(t.value,o)||(t.value=o,t.validate(o),t.updateUI()),t.afterLoaded())}))},o.prototype.afterLoaded=function(){},o.prototype.onUpdate=function(e,t,i,o){this.load(!1)},o.prototype.updateUI=function(){},o.prototype.updateModel=function(e,t){var i=this;i.model.isWritable()?util.equals(e,i.value)?t&&t():i.model.setValue(e,(function(e){e?(i.setError(e),t&&t(e)):t&&t()})):t&&t()},o.prototype.validate=function(e){var t=this.model.field.validate(e);return t?(this.setError(t),!1):(this.setError(void 0),!0)},o.prototype.setError=function(e){this.container.setError(e)},o.prototype.createField=function(e){log("Cannot create field")},o.prototype.editorUp=function(){this.container.editorUp&&this.container.editorUp()},o.prototype.editorDown=function(){console.log("Editor.editorDown"),this.container.editorDown&&this.container.editorDown()},o.prototype.getNid=function(){return this.container.getNid?this.container.getNid():this.container.nid}},"./src/js/widgets/editors/IconSelector.js":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return s}));var o=i("./src/js/widgets/editors/Editor.js");const n={ic:{prefix:"ic",columns:16,width:24,height:24,margin:4,background:"#fff"},dbicon:{prefix:"dbicon",columns:8,width:48,height:48,margin:0,background:"#3df"}};function a(e,t){o.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el).touch($.proxy(this.popup,this)),this.text=$('<div class="input-text">').appendTo(this.el);var i=t.field.iconset||"ic";this.iconset=n[i]||n.ic,"ic"!==i&&(this.text[0].style.height=this.iconset.height+2*this.iconset.margin+4+"px")}function s(e){var t=e.iconset||n.ic,i=$.backplane({}),o=$('<div class="iconselector-menu" style="width:'+(t.width+2*t.margin+8)*t.columns+"px;background-color:"+(e.background||t.background)+'">').appendTo(i).touch(u),a='style="width:'+t.width+"px;height:"+t.height+"px;margin:"+t.margin+'px"',s="";s+='<div class="iconselector-item" data-id="###NULL###" '+a+"></div>";for(var r=t.icons,l=0;l<r.length;l++){var c=r[l];s+='<div class="iconselector-item" data-id="'+c+'" '+a+'><div class="'+t.prefix+" "+t.prefix+"-"+c+'"></div></div>'}o.html(s);var d=o.outerWidth(),h=o.outerHeight(),p=e.$el.offset();function u(t){var o=$(t.target).closest(".iconselector-item").attr("data-id");o&&(i.close(),e.update("###NULL###"===o?void 0:o))}p.top+=32,p.left+d>window.getWidth()&&(p.left=window.getWidth()-d),p.top+h>window.getHeight()&&(p.top=window.getHeight()-h),o.offset(p)}n.ic.icons=["check","x","question2","stop","go","power","info","heart","location","idea","filter","sun","star","forbidden","reload","recycle","option","gear","warn2","percent","piechart","barchart","question3","dialog","star2","pencil","pencil-ruler","tools","hammer","waterdrop","goal","disclosed","home","cart","key","money","moneybag","trash","world","lock","lock2","key2","cart2","add-to-cart","present","binoculars","palette","camera","facebook","linkedin","twitter","apple","paypal","googleplus","instagram","youtube","dropbox","playstation","messenger","appstore","google","photos","phone","calendar","calendar2","letter","phone2","smartphone","display","heartbeat","download","headset","printer","sdcard","gamepad","cube","cardgame","tentacle","music","bell","books","book","clock","instrument","speaker","microphone","megaphone","record","guitar","sound","reel","flap","movie","iso","bookmark","landscape","at","html","calendar3","note","glider","document","checklist","checklist2","list","video","call-accept","call-end","battery","face","face2","person-paper","man","man2","woman1","man3","person","people","graduate","discussion","face-idea","bball","whistle","thumb-up","thumb-down","point-up","point-down","point-left","calculate","shake-hands","get-money","pay-money","pay-card","sign","creditcard","banknotes","qna","delivery","plane","truck","digger","car","light","rack","factory","robot","forklift","football","tennis","basketball","bike","running","holiday","burger","pizza","grocery","coffee","cherry","raspberry","banana","whine-cheese","plate","balloon","highheel","shoe","shirt","tie","umbrella","tube","emergency","stroke","brain","lunges","shot","cancer","male","female","dog","bird","fish","horse","pig","chicken","elephant","fish2","butterfly","cat","plant","arrow1","arrow2","arrow3","arrow4","arrow5","arrow6","arrow7","arrow8","percent0","percent25","percent50","percent75","percent100","yinyang","happy","unhappy","loughing","astounded","irritated","cool","silent","joking","sad","crying","loving","evil","attachment","linked","quote","mailbox","folder","folder-documents","folder-downloads","folder-pictures","folder-people","folder-music","folder-world","folder-burning","folder-heart","folder-tile","play","play2","pause","stop2","rec","arrow-n","arrow-ne","arrow-e","arrow-se","arrow-s","arrow-sw","arrow-w","arrow-nw","ball-0","ball-25","ball-50","ball-75","ball-100","warn","question","done","smile-happy","smile-not-amused","smile-unhappy","smile-astonished","smile-blink"],n.dbicon.icons=["database","person","team","location","info","document","chart","folder","clipboard"],Object.assign(a.prototype,o.a.prototype),a.prototype.editorClass="icon",a.prototype.destroy=function(){this.el.remove(),o.a.prototype.destroy.apply(this,arguments)},a.prototype.updateUI=function(){var e=this.iconset;this.value?this.text[0].innerHTML='<div class="choice-icon '+e.prefix+" "+e.prefix+"-"+this.value+'"></div>':this.text[0].innerHTML="",this.text[0].style.backgroundColor=this.model.field.background||""},a.prototype.popup=function(){var e=this;new s({iconset:e.iconset,background:e.model.field.background,$el:e.el,update:function(t){e.updateModel(t)}})}},"./src/js/widgets/editors/StringEditor.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var o=i("./src/js/widgets/editors/Editor.js");function n(e,t){o.a.apply(this,arguments),this.updating=!1,this.editing=!1,this.isBarcode=!1,this.el=$('<div class="stringeditor">').appendTo(e.el),this.originalString=null,this.input=null,this.$aux=null,this.button=null,this._showAuxTimer=null,this.createRenderer()}Object.assign(n.prototype,o.a.prototype),n.prototype.editorClass="string",n.prototype.hideButtonOnEmpty=!0,n.prototype.inputType="text",n.prototype.inputStyle=null,n.prototype.destroy=function(){this.stopEdit(),this.el.remove(),o.a.prototype.destroy.apply(this,arguments)},n.prototype.focus=function(){console.log("string editor -> focus"),this.startEdit()},n.prototype.blur=function(){if(console.log("string editor -> blur"),this.editing)try{this.input.blur()}catch(e){console.log("StringEditor failed to blur",e)}},n.prototype.startEdit=function(){if(console.log("string editor -> startEdit"),!this.editing&&this.model.isWritable()){var e=this.model.field;this.editing=!0,this.createEditor(),this.updateUI(),this.input.focus(),e.stringMultiline||TOUCH||this.input.select()}},n.prototype.stopEdit=function(){console.log("string editor -> stopEdit"),this.editing&&(this.editing=!1,this.destroyEditor(),this.updateUI())},n.prototype.updateStructure=function(){var e=this.model.field;e.base===this.base&&e.stringMultiline===this.stringMultiline||(this.destroyRenderer(),this.createRenderer())},n.prototype.createRenderer=function(){if(!this.text){var e=this.model.field,t=e.base;this.base=t,this.editorClass=t,this.stringMultiline=e.stringMultiline,e.stringMultiline?this.text=$('<div class="input-text text-selectable multiline" style="height:'+(24*e.height+8)+'px">').appendTo(this.el).touch($.proxy(this.container.focus,this.container)):this.text=$('<div class="input-text text-selectable">').appendTo(this.el).touch($.proxy(this.container.focus,this.container)),this.createButton()}},n.prototype.destroyRenderer=function(){this.text&&(this.text.remove(),this.text=void 0),this.destroyButton()},n.prototype.createButton=function(){},n.prototype.destroyButton=function(){this.button&&(this.button.remove(),this.button=void 0)},n.prototype.isHeightAdjustable=function(){return"string"===this.model.field.base},n.prototype.setHeight=function(e){var t=this.model.field;if("string"===t.base){var i=t.height,o=t.stringMultiline,n=Math.max(1,Math.round((e-42)/24)),a=1!==n;a!==o?(t.stringMultiline=a,t.height=n,this.destroyRenderer(),this.createRenderer(),this.updateUI()):n!==i&&(this.text.css("height",24*n+8),t.height=n)}},n.prototype.createEditor=function(){var e=this.model.field,t=e.base;if(this.text.css("display","none"),e.stringMultiline)this.input=$('<textarea rows="'+e.height+'">').insertAfter(this.text).keydown($.proxy(this.keydown,this)).keyup($.proxy(this.keyup,this)).change($.proxy(this.onChange,this)),this.input[0].addEventListener("focusout",$.proxy(this.onBlur,this),!1),e.stringAutocorrect||this.input.attr("autocomplete","off").attr("autocorrect","off").attr("spellcheck","false");else{var i=this.inputType,o=this.inputStyle?' style="'+this.inputStyle+'"':"",n=e.stringAutocorrect&&"string"===t?"":' autocomplete="off" autocorrect="off" spellcheck="false"';this.input=$('<input type="'+i+'"'+o+n+">").insertAfter(this.text).keydown($.proxy(this.keydown,this)).keyup($.proxy(this.keyup,this)).change($.proxy(this.onChange,this)),this.input[0].addEventListener("focusin",$.proxy(this.onFocus,this),!1),this.input[0].addEventListener("focusout",$.proxy(this.onBlur,this),!1)}$.pushInputHandler(this)},n.prototype.keydown=function(e){if(!1!==this.keydownCallback(e))switch(e.which){case 9:e.shiftKey?this.container.focusPrev():this.container.focusNext(),e.preventDefault();break;case 13:this.stringMultiline||(this.blur(),this.model.onReturn&&this.model.onReturn());break;case 27:this.stopEdit(),this.model.onReturn&&this.model.onEscape();break;case 38:this.stringMultiline||(this.editorUp(),e.preventDefault());break;case 40:this.stringMultiline||(this.editorDown(),e.preventDefault())}},n.prototype.keydownCallback=function(e){},n.prototype.keyup=function(e){this.keyupCallback(e)},n.prototype.keyupCallback=function(e){},n.prototype.destroyEditor=function(){this.model.field.base;this.input&&this.input.remove(),this.input=null,$.popInputHandler(this),this.text.css("display",""),this.stopShowAux()},n.prototype.showAux=function(){},n.prototype.startShowAux=function(){var e=this;e.$aux||e.showAux()},n.prototype.stopShowAux=function(){this.$aux&&this.hideAux()},n.prototype.hideAux=function(){},n.prototype.updateUI=function(){var e=this.model.field,t=e.base;if(!this.updating)if(this.editing)if("choice"===t||"boolean"===t||"user"===t||"dchoice"===t||"ref"===t)e.loadValue(this.getNid(),this.value,e=>{var t=e?e.caption||String(e.id):"";this.originalString=t,this.input.val(t),this.button&&(this.button[0].style.display="none"),this.startShowAux()});else{var i=this.formatEditorValue(this.value);this.originalString=i,this.input.val(i),this.button&&(this.button[0].style.display="none"),this.startShowAux()}else{var o=this.el[0],n=this.text[0];if("choice"===t||"boolean"===t||"user"===t||"dchoice"===t||"ref"===t)e.loadValue(this.getNid(),this.value,e=>{var t="",i="",a="";void 0!==e?(e.icon&&(t+='<div class="choice-icon ic ic-'+e.icon+'"></div>'),t+="<span>"+htmlEscape(e.caption)+"</span>",i=e.color||"",a=e.textColor||""):"placeholder"===this.model.field.labelPosition&&(t=htmlEscape(this.model.field.caption),a="#999"),n.innerHTML=t,o.style.backgroundColor=i,o.style.color=a});else(i=this.model.field.format(this.value))?(n.innerHTML=htmlEscape(i),n.style.color=""):"placeholder"===this.model.field.labelPosition?(n.innerHTML=htmlEscape(this.model.field.caption),n.style.color="#999"):(n.innerHTML="",n.style.color="");this.button&&(this.value||!this.hideButtonOnEmpty?this.button[0].style.display="":this.button[0].style.display="none")}},n.prototype.onChange=function(){this.isBarcode&&(this.isBarcode=!1,this._onBlur())},n.prototype.onFocus=function(){},n.prototype.onBlur=async function(){await NinoxViewController.isBarcodeScannerActive()?this.isBarcode=!0:this._onBlur()},n.prototype._onBlur=function(){if(!this.updating&&this.editing){var e=this.input.val();if(e===this.originalString)this.stopEdit();else{this.updating=!0;var t=this.parseEditorValue(e),i=this;i.updateModel(t,(function(e){i.updating=!1,i.stopEdit()}))}}},n.prototype.save=function(){if(!this.updating&&this.editing&&this.input.is(":focus")){var e=this.input.val();if(e!==this.originalString){var t=this.parseEditorValue(e);this.updateModel(t,(function(e){}))}}},n.prototype.parseEditorValue=function(e){return this.model.field.parseEditor(e)},n.prototype.formatEditorValue=function(e){return this.model.field.formatEditor(e)},n.prototype.resizeAux=function(){var e=this.$aux;if(e){var t=this.el.offset(),i=window.getWidth(),o=window.getHeight(),n=t.left,a=t.top+36,s=e.outerWidth(),r=e.outerHeight();r>o-a&&(o-a>=t.top-4?r=o-a:(r=Math.min(t.top-4,r),a=t.top-4-r)),n+s>i&&(n=i-s),e.css({left:n,top:a,height:r})}}},"./src/js/widgets/widgets.js":function(e,t,i){"use strict";i.d(t,"a",(function(){return K})),i.d(t,"b",(function(){return Q})),i.d(t,"c",(function(){return Z})),i.d(t,"d",(function(){return ee}));var o=i("./src/js/widgets/editors/StringEditor.js");function n(e,t){o.a.apply(this,arguments)}function a(e,t){o.a.apply(this,arguments)}function s(e,t){o.a.apply(this,arguments)}function r(e,t){o.a.apply(this,arguments)}Object.assign(n.prototype,o.a.prototype),n.prototype.editorClass="appointment",n.prototype.showAux=function(){if(!this.$aux){var e=this,t=this.model.field,i=t.base,o=this.input,n=this.$aux=$('<div class="stringeditor-aux appointment-picker">').on(TOUCH?EVENT_touchstart:"mousedown",(function(e){e.preventDefault()})).appendTo($(document.body)),a=$('<div class="appointment-picker-start">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",(function(e){b=!0,T(),e.preventDefault()})),s=$('<div class="appointment-picker-end">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",(function(e){b=!1,T(),e.preventDefault()})),r=$('<div class="appointment-picker-dp dp timestamp">').appendTo(n),l=$('<div class="dp-head">').appendTo(r),c=$('<div class="dp-days">').appendTo(r),d=$('<div class="dp-month">').appendTo(r).on(TOUCH?EVENT_touchstart:"mousedown",S);$('<div class="i-48-24 i-light-grey i-arrow-solid-left dp-prev">').appendTo(l).on(TOUCH?EVENT_touchstart:"mousedown",N),$('<div class="i-48-24 i-light-grey i-arrow-solid-right dp-next">').appendTo(l).on(TOUCH?EVENT_touchstart:"mousedown",D);for(var h=$('<div class="dp-title">Oktober 2015</div>').appendTo(l),p=0;p<7;p++){var u=(locale.firstDayOfWeek+p)%7;$('<div class="dp-days-day">'+htmlEscape(locale.dayNamesShort[u])+"</div>").appendTo(c)}var f=$('<div class="dp-time">').appendTo(r).on(TOUCH?EVENT_touchstart:"mousedown",E),m=new Date,g=new Date,v=null,y=null,b=!0;this.resizeAux=w,window.addEventListener("resize",this.resizeAux,!1),this.$scrollPane=e.el.closest(".object")[0],this.$scrollPane&&this.$scrollPane.addEventListener("scroll",this.resizeAux,!1),w(),x(),o.keyup(x).change(x)}function w(){const t=372,i=452;var o,a,s=e.el.offset(),r=window.getWidth(),l=window.getHeight(),c=i;s.top+36+t>l?s.top-t<20?(a=20,o=s.left-c-8>=0?s.left-c-8:s.left+e.el.width()+8):(a=s.top-t,o=s.left+c>r?r-c:s.left):(a=s.top+36,o=s.left+c>r?r-c:s.left),n.css({left:o,top:a})}function x(){var e=o.val(),i=e?t.parseEditor(e):void 0;if(v=null,y=null,i){var n=i.split("/");if(2===n.length){var a=Number(n[0]),s=a+Number(n[1]);v=new Date(a),y=new Date(s)}}T()}function T(){b?(a.addClass("selected"),s.removeClass("selected")):(a.removeClass("selected"),s.addClass("selected")),a.text(v?util.formatLocaleDateTime(v):locale.appointmentBegin),s.text(y?util.formatLocaleDateTime(y):locale.appointmentEnd),C(),k()}function C(){var e=b?v:y,t=g.getFullYear(),o=g.getMonth(),n=(g.getDate(),new Date(t,o,1)),a=(util.getWeek(n),n.getDay()),s=locale.firstDayOfWeek,r=a>s?s-a+1:s-a-6,l=new Date(n.getFullYear(),n.getMonth(),r);h.text(locale.monthNames[o]+" "+t);for(var c="",p=0;p<6;p++){c+='<div class="dp-month-week">';for(var u=0;u<7;u++){var f=new Date(l.getFullYear(),l.getMonth(),l.getDate()+7*p+u);c+='<div class="dp-month-week-day'+(f.getMonth()===o?" current-month":" other-month")+(f.getFullYear()===m.getFullYear()&&f.getMonth()===m.getMonth()&&f.getDate()===m.getDate()?" today":"")+(e&&f.getFullYear()===e.getFullYear()&&f.getMonth()===e.getMonth()&&f.getDate()===e.getDate()?" selected":"")+'" data-date="'+util.formatISODate(f)+'">'+f.getDate()+"</div>"}c+="</div>"}d.html(c),"timestamp"===i&&updateTime()}function k(){var e=b?v:y,t=null,i=null;e&&(t=e.getHours(),i=e.getMinutes(),e.getSeconds());var o=t<12,n=null==i?null:5*Math.round(i/5),a="";a+='<div class="dp-time-ampm"><div class="dp-time-am'+(o?" selected":"")+'">am</div><div class="dp-time-pm'+(o?"":" selected")+'">pm</div></div>',a+='<div class="dp-time-hour">';for(var s=0;s<6;s++){var r=2*s+(o?0:12),l=r+1,c=locale.time24Hours?r:r%12==0?12:r%12,d=locale.time24Hours?l:l%12==0?12:l%12;a+='<div class="dp-time-row"><div class="dp-time-cell'+(r===t?" selected":"")+'" data-h="'+r+'">'+(c<10?"0":"")+c+'</div><div class="dp-time-cell'+(l===t?" selected":"")+'" data-h="'+l+'">'+(d<10?"0":"")+d+"</div></div>"}a+="</div>",a+='<div class="dp-time-minute">';for(s=0;s<6;s++){var h=10*s,p=h+5;a+='<div class="dp-time-row"><div class="dp-time-cell'+(h===n?" selected":"")+'" data-m="'+h+'">'+(h<10?"0":"")+h+'</div><div class="dp-time-cell'+(p===n?" selected":"")+'" data-m="'+p+'">'+(p<10?"0":"")+p+"</div></div>"}a+="</div>",f.html(a)}function S(e){var t=$(e.target).attr("data-date");if(t){var i=b?v:y,o=util.parseISODate(t),n=new Date(o),a=i?new Date(i):new Date;_(new Date(n.getFullYear(),n.getMonth(),n.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds())),e.preventDefault()}}function _(e){if(b){var i=null!=v&&null!=y?y.getTime()-v.getTime():36e5;(a=(s=e.getTime())+i)<s&&(a=s);var n=s+"/"+(a-s);o.val(t.formatEditor(n)),x()}else{var a,s;(a=e.getTime())<(s=null!=v?v.getTime():a)&&(a=s);n=s+"/"+(a-s);o.val(t.formatEditor(n)),x()}}function E(e){var t=b?v:y,i=$(e.target);if(i.is(".dp-time-am"))(o=(a=t?new Date(t):new Date).getHours())>=12&&(o-=12,a.setHours(o)),_(a),e.preventDefault();else if(i.is(".dp-time-pm")){(o=(a=t?new Date(t):new Date).getHours())<12&&(o+=12,a.setHours(o)),_(a),e.preventDefault()}else if(i.is(".dp-time-cell")){var o=i.attr("data-h"),n=i.attr("data-m");if(o)(a=t?new Date(t):new Date).setHours(Number(o)),_(a);else if(n){var a;(a=t?new Date(t):new Date).setMinutes(Number(n)),_(a)}e.preventDefault()}}function D(e){g=new Date(g.getFullYear(),g.getMonth()+1,g.getDate()),T(),e.preventDefault()}function N(e){g=new Date(g.getFullYear(),g.getMonth()-1,g.getDate()),T(),e.preventDefault()}},n.prototype.hideAux=function(){this.$aux&&(window.removeEventListener("resize",this.resizeAux,!1),this.$scrollPane&&this.$scrollPane.removeEventListener("scroll",this.resizeAux,!1),this.$scrollPane=void 0,this.resizeAux=void 0,this.$aux.remove(),this.$aux=null)},Object.assign(a.prototype,o.a.prototype),a.prototype.inputType="number",a.prototype.editorClass="number",a.prototype.parseEditorValue=function(e){return e?Number(e):null},a.prototype.formatEditorValue=function(e){return null!=e?String(e):""},Object.assign(s.prototype,o.a.prototype),s.prototype.editorClass="number",Object.assign(r.prototype,o.a.prototype),r.prototype.inputType="email",r.prototype.editorClass="email",r.prototype.createButton=function(){this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-email"></div></div>').css("display","none").click($.proxy(this.sendMail,this)).appendTo(this.el)},r.prototype.sendMail=async function(){if(this.value){var e=database.loadNodeSync(this.model.container.nid);if(e){var t=this.model.field,i="",o="";if(t.emailSubject)try{var n=queries.parseSystemStringTemplate(t.type.schema,t.type,t.emailSubject,{});i=await n.promise(database,e)}catch(e){return $.alert(e)}if(t.emailBody)try{n=queries.parseSystemStringTemplate(t.type.schema,t.type,t.emailBody,{});o=await n.promise(database,e)}catch(e){return $.alert(e)}var a="mailto:"+encodeURIComponent(this.value);(i||o)&&(a+="?",i&&(a+="subject="+encodeURIComponent(String(i)),o&&(a+="&")),o&&(a+="body="+encodeURIComponent(String(o)))),NinoxDocumentInteraction.openBrowser(a)}}};i("./node_modules/core-js/modules/es.string.replace.js");function l(e,t){o.a.apply(this,arguments)}function c(e,t){o.a.apply(this,arguments)}function d(e,t){o.a.apply(this,arguments)}Object.assign(l.prototype,o.a.prototype),l.prototype.editorClass="phone",l.prototype.inputType="tel",l.prototype.createButton=function(){this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-phone"></div></div>').css("display","none").click($.proxy(this.openPhone,this)).appendTo(this.el)},l.prototype.openPhone=function(){if(this.value){var e=String(this.value).replace(/[\/]/g,"-");NinoxDocumentInteraction.openBrowser("tel://"+encodeURIComponent(e))}},Object.assign(c.prototype,o.a.prototype),c.prototype.editorClass="date",c.prototype.showAux=function(){if(!this.$aux){var e=this,t=this.model.field,i=t.base,o="datx"===i?"date":i,n=this.input,a=this.$aux=$('<div class="stringeditor-aux dp '+o+'">').on(TOUCH?EVENT_touchstart:"mousedown",(function(e){e.preventDefault()})).appendTo($(document.body)),s=$('<div class="dp-head">').appendTo(a),r=$('<div class="dp-days">').appendTo(a),l=$('<div class="dp-month">').appendTo(a).on(TOUCH?EVENT_touchstart:"mousedown",T),c=$('<div class="dp-foot">').appendTo(a);$('<div class="nx-button-text grey">').text(locale.clear).appendTo(c).on(TOUCH?EVENT_touchstart:"mousedown",C),$('<div class="nx-hspace-flex">').appendTo(c),$('<div class="nx-button-text blue">').text("timestamp"===i?locale.op_now:locale.op_today).appendTo(c).on(TOUCH?EVENT_touchstart:"mousedown",k),$('<div class="i-48-24 i-light-grey i-arrow-solid-left dp-prev">').appendTo(s).on(TOUCH?EVENT_touchstart:"mousedown",_),$('<div class="i-48-24 i-light-grey i-arrow-solid-right dp-next">').appendTo(s).on(TOUCH?EVENT_touchstart:"mousedown",S);for(var d=$('<div class="dp-title">Oktober 2015</div>').appendTo(s),h=0;h<7;h++){var p=(locale.firstDayOfWeek+h)%7;$('<div class="dp-days-day">'+htmlEscape(locale.dayNamesShort[p])+"</div>").appendTo(r)}var u=new Date,f=new Date,m=null,g=null;"timestamp"===i&&(g=$('<div class="dp-time">').appendTo(a).on(TOUCH?EVENT_touchstart:"mousedown",y)),this.resizeAux=b,window.addEventListener("resize",this.resizeAux,!1),this.$scrollPane=e.el.closest(".object")[0],this.$scrollPane&&this.$scrollPane.addEventListener("scroll",this.resizeAux,!1),b(),w(),n.keyup(w).change(w)}function v(){var e=null,t=null;m&&(e=m.getHours(),t=m.getMinutes(),m.getSeconds());var i=e<12,o=null==t?null:5*Math.round(t/5),n="";n+='<div class="dp-time-ampm"><div class="dp-time-am'+(i?" selected":"")+'">am</div><div class="dp-time-pm'+(i?"":" selected")+'">pm</div></div>',n+='<div class="dp-time-hour">';for(var a=0;a<6;a++){var s=2*a+(i?0:12),r=s+1,l=locale.time24Hours?s:s%12==0?12:s%12,c=locale.time24Hours?r:r%12==0?12:r%12;n+='<div class="dp-time-row"><div class="dp-time-cell'+(s===e?" selected":"")+'" data-h="'+s+'">'+(l<10?"0":"")+l+'</div><div class="dp-time-cell'+(r===e?" selected":"")+'" data-h="'+r+'">'+(c<10?"0":"")+c+"</div></div>"}n+="</div>",n+='<div class="dp-time-minute">';for(a=0;a<6;a++){var d=10*a,h=d+5;n+='<div class="dp-time-row"><div class="dp-time-cell'+(d===o?" selected":"")+'" data-m="'+d+'">'+(d<10?"0":"")+d+'</div><div class="dp-time-cell'+(h===o?" selected":"")+'" data-m="'+h+'">'+(h<10?"0":"")+h+"</div></div>"}n+="</div>",g.html(n)}function y(e){var i=$(e.target);if(i.is(".dp-time-am"))(o=(s=m?new Date(m):new Date).getHours())>=12&&(o-=12,s.setHours(o)),n.val(t.formatEditor(s.getTime())),w(),e.preventDefault();else if(i.is(".dp-time-pm")){(o=(s=m?new Date(m):new Date).getHours())<12&&(o+=12,s.setHours(o)),n.val(t.formatEditor(s.getTime())),w(),e.preventDefault()}else if(i.is(".dp-time-cell")){var o=i.attr("data-h"),a=i.attr("data-m");if(o)(s=m?new Date(m):new Date).setHours(Number(o)),n.val(t.formatEditor(s.getTime())),w();else if(a){var s;(s=m?new Date(m):new Date).setMinutes(Number(a)),n.val(t.formatEditor(s.getTime())),w()}e.preventDefault()}}function b(){const t=372,i="date"===o?280:452;var n,s,r=e.el.offset(),l=window.getWidth(),c=window.getHeight(),d=i;r.top+36+t>c?r.top-t<20?(s=r.top+t+20>c?0:20,n=r.left-d-8>=0?r.left-d-8:r.left+e.el.width()+8+d<=l?r.left+e.el.width()+8:r.left):(s=r.top-t,n=r.left+d>l?l-d:r.left):(s=r.top+36,n=r.left+d>l?l-d:r.left),a.css({left:n,top:s})}function w(){var e=n.val(),o=e?t.parseEditor(e):void 0;if(null!=o){var a=new Date(o);"datx"===i&&(a=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())),isNaN(a.getTime())||(f=a,m=a)}x()}function x(){var e=f.getFullYear(),t=f.getMonth(),o=(f.getDate(),new Date(e,t,1)),n=(util.getWeek(o),o.getDay()),a=locale.firstDayOfWeek,s=n>a?a-n+1:a-n-6,r=new Date(o.getFullYear(),o.getMonth(),s);d.text(locale.monthNames[t]+" "+e);for(var c="",h=0;h<6;h++){c+='<div class="dp-month-week">';for(var p=0;p<7;p++){var g=new Date(r.getFullYear(),r.getMonth(),r.getDate()+7*h+p);c+='<div class="dp-month-week-day'+(g.getMonth()===t?" current-month":" other-month")+(g.getFullYear()===u.getFullYear()&&g.getMonth()===u.getMonth()&&g.getDate()===u.getDate()?" today":"")+(m&&g.getFullYear()===m.getFullYear()&&g.getMonth()===m.getMonth()&&g.getDate()===m.getDate()?" selected":"")+'" data-date="'+util.formatISODate(g)+'">'+g.getDate()+"</div>"}c+="</div>"}l.html(c),"timestamp"===i&&v()}function T(e){var o=$(e.target).attr("data-date");if(o)if("datx"===i){var a=util.parseISODatx(o);n.val(t.formatEditor(a)),n.blur()}else if("date"===i){a=util.parseISODate(o);n.val(t.formatEditor(a)),n.blur()}else if("timestamp"===i){a=util.parseISODate(o);var s=new Date(a),r=m?new Date(m):new Date,l=new Date(s.getFullYear(),s.getMonth(),s.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds());n.val(t.formatEditor(l.getTime())),w(),e.preventDefault()}}function C(e){n.val(""),n.blur()}function k(e){var o=new Date;if("datx"===i)n.val(t.formatEditor(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),0,0,0,0)));else{var a="timestamp"===i?o:new Date(o.getFullYear(),o.getMonth(),o.getDate());n.val(t.formatEditor(a.getTime()))}n.blur()}function S(){f=new Date(f.getFullYear(),f.getMonth()+1,f.getDate()),x()}function _(){f=new Date(f.getFullYear(),f.getMonth()-1,f.getDate()),x()}},c.prototype.hideAux=function(){this.$aux&&(window.removeEventListener("resize",this.resizeAux,!1),this.$scrollPane&&this.$scrollPane.removeEventListener("scroll",this.resizeAux,!1),this.$scrollPane=void 0,this.resizeAux=void 0,this.$aux.remove(),this.$aux=null)},Object.assign(d.prototype,o.a.prototype),d.prototype.editorClass="time",d.prototype.showAux=function(){if(!this.$aux){var e=this,t=this.model.field,i=t.base,o=this.input,n=this.$aux=$('<div class="stringeditor-aux dp '+i+'">').on(TOUCH?EVENT_touchstart:"mousedown",(function(e){e.preventDefault()})).appendTo($(document.body)),a=null,s=$('<div class="dp-time">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",l);this.resizeAux=d,window.addEventListener("resize",this.resizeAux,!1),this.$scrollPane=e.el.closest(".object")[0],this.$scrollPane&&this.$scrollPane.addEventListener("scroll",this.resizeAux,!1),d(),h(),o.keyup(h).change(h)}function r(){var e=null,t=null;null!=a&&(e=Math.floor(a/36e5),t=Math.floor(a%36e5/6e4));var i=e<12,o=null==t?null:5*Math.round(t/5),n="";n+='<div class="dp-time-ampm"><div class="dp-time-am'+(i?" selected":"")+'">am</div><div class="dp-time-pm'+(i?"":" selected")+'">pm</div></div>',n+='<div class="dp-time-hour">';for(var r=0;r<6;r++){var l=2*r+(i?0:12),c=l+1,d=locale.time24Hours?l:l%12==0?12:l%12,h=locale.time24Hours?c:c%12==0?12:c%12;n+='<div class="dp-time-row"><div class="dp-time-cell'+(l===e?" selected":"")+'" data-h="'+l+'">'+(d<10?"0":"")+d+'</div><div class="dp-time-cell'+(c===e?" selected":"")+'" data-h="'+c+'">'+(h<10?"0":"")+h+"</div></div>"}n+="</div>",n+='<div class="dp-time-minute">';for(r=0;r<6;r++){var p=10*r,u=p+5;n+='<div class="dp-time-row"><div class="dp-time-cell'+(p===o?" selected":"")+'" data-m="'+p+'">'+(p<10?"0":"")+p+'</div><div class="dp-time-cell'+(u===o?" selected":"")+'" data-m="'+u+'">'+(u<10?"0":"")+u+"</div></div>"}n+="</div>",n+='<div id="dp-time-now" class="dp-time-now"><div id="dp-time-now" class="nx-button-text blue">'+htmlEscape(locale.op_now)+"</div>",s.html(n)}function l(e){var t=$(e.target);if(console.log("$target",t),t.is(".dp-time-am")){var i=null!=a?a:0;(n=Math.floor(i/36e5))>=12&&(n-=12),c(n,Math.floor(a%36e5/6e4)),e.preventDefault()}else if(t.is(".dp-time-pm")){var n;i=null!=a?a:0;(n=Math.floor(i/36e5))<12&&(n+=12),c(n,Math.floor(a%36e5/6e4)),e.preventDefault()}else if(t.is(".dp-time-cell")){i=null!=a?a:0;var s=Math.floor(i/36e5),r=Math.floor(a%36e5/6e4),l=t.attr("data-h"),d=t.attr("data-m");l?c(l,r):d&&c(s,d),e.preventDefault()}else if(t.is("#dp-time-now")){var h=new Date;c(h.getHours(),h.getMinutes()),o.blur()}}function c(e,i){o.val(t.formatEditor(36e5*e+6e4*i)),h()}function d(){const t=180,i=308;var o,a,s=e.el.offset(),r=window.getWidth(),l=window.getHeight(),c=t;s.top+36+i>l?s.top-i<20?(a=20,o=s.left-c-8>=0?s.left-c-8:s.left+e.el.width()+8):(a=s.top-i,o=s.left+c>r?r-c:s.left):(a=s.top+36,o=s.left+c>r?r-c:s.left),n.css({left:o,top:a})}function h(){var e=o.val(),i=e?t.parseEditor(e):void 0;a=null!=i?i:null,r()}},d.prototype.hideAux=function(){this.$aux&&(window.removeEventListener("resize",this.resizeAux,!1),this.$scrollPane&&this.$scrollPane.removeEventListener("scroll",this.resizeAux,!1),this.$scrollPane=void 0,this.resizeAux=void 0,this.$aux.remove(),this.$aux=null)};var h=i("./node_modules/react-dom/index.js"),p=i("./node_modules/react/index.js"),u=i("./src/react/LightboxComponent.tsx"),f=(i("./src/react/PdfRenderer.tsx"),i("./src/js/widgets/editors/Editor.js")),m=i("./node_modules/underscore/underscore.js"),g=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),v=i("./src/js/ui/ui-util.js");function y(e,t){var i=t.field;switch(this.base=i.exp?i.exp.returnType.base:"string",this.base){case"color":case"icon":this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="input-text">').appendTo(this.el);break;case"choice":case"styled":this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="choice text-selectable">').appendTo(this.el);break;case"multi":this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="input-text multicombo text-selectable">').appendTo(this.el);break;case"html":this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="html text-selectable">').appendTo(this.el);break;case"file":var o=e.el.width();this.el=$('<div class="editor-file-file" style="text-align:center;display:table-cell;vertical-align:middle;width:'+o+"px;max-width:"+o+'px">').appendTo(e.el);break;case"email":this.el=$('<div class="stringeditor stringeditor-fn">').appendTo(e.el),this.text=$('<div class="input-text text-selectable">').appendTo(this.el),this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-email"></div></div>').appendTo(this.el).touch($.proxy(this.sendEmail,this));break;case"phone":this.el=$('<div class="stringeditor stringeditor-fn">').appendTo(e.el),this.text=$('<div class="input-text text-selectable">').appendTo(this.el),this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-phone"></div></div>').appendTo(this.el).touch($.proxy(this.openPhone,this));break;case"link":this.el=$('<div class="stringeditor stringeditor-fn">').appendTo(e.el),this.text=$('<div class="input-text text-selectable">').appendTo(this.el),this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-link"></div></div>').appendTo(this.el).touch($.proxy(this.openURL,this));break;default:this.el=$('<div class="stringeditor stringeditor-fn">').appendTo(e.el),this.text=$('<div class="input-text text-selectable">').appendTo(this.el)}this.el.touch($.proxy(this.onClick,this)),this.text?(i.height>1?this.text.addClass("multiline"):this.text.removeClass("multiline"),this.text.css({height:24*i.height+8})):this.el.css({height:24*i.height+10}),f.a.apply(this,arguments)}function b(e,t){o.a.apply(this,arguments)}Object.assign(y.prototype,f.a.prototype),y.prototype.editorClass="fn",y.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},y.prototype.updateUI=function(){switch(this.updateUIStyle(),this.base){case"color":this.el.css({backgroundColor:this.value||""});break;case"icon":this.value?this.text.html('<div class="iconselector-icon ic ic-'+htmlEscape(this.value)+'">'):this.text.html("");break;case"choice":case"dchoice":this.model.field.exp.returnType.loadValue(this.getNid(),this.value,e=>{let t="",i="";void 0!==e&&(e.icon&&(t+='<div class="choice-icon ic ic-'+e.icon+'"></div>'),t+='<span style="color:'+(e.textColor||"")+'">'+htmlEscape(e.caption)+"</span>",e.color&&(i=e.color)),this.el.css({"background-color":i}),this.text.html(t)});break;case"styled":{let e="",t="";this.value&&(this.value.icon&&(e+='<div class="choice-icon ic ic-'+this.value.icon+'"></div>'),e+='<span style="color:'+(this.value.color||"")+'">'+htmlEscape(this.value.text)+"</span>",this.value.background&&(t=this.value.background)),this.el.css({"background-color":t}),this.text.html(e);break}case"multi":case"dmulti":this.model.field.exp.returnType.loadValuesSorted(this.getNid(),e=>{const t=util.multiDecode(this.value);let i="";for(var o=0;o<e.length;o++){const n=e[o],a=-1!==t.indexOf(parseInt(n.id,10));a&&(i+='<div class="multicombo-item" style="'+(a&&n.color?"background-color:"+n.color+";color:"+n.textColor:"")+'" data-id="'+n.id+'">'+(n.icon?'<div class="choice-symbol ic ic-'+n.icon+'"></div>':"")+"<span>"+htmlEscape(n.caption||"")+"</span></div>")}this.text.html(i)});break;case"html":try{this.text.html(this.value||"")}catch(e){this.text.html("INVALID HTML: "+htmlEscape(this.value))}break;case"file":{if(this.value){const e=database.thumb2URL1(this.value);e?this.el.html('<img src="'+e+'">'):this.el.html("")}else this.el.html("");const e=this.container.el.width();this.el.css({width:e,"max-width":e});break}default:this.text.text(this.model.field.format(this.value))}},y.prototype.updateUIStyle=function(){var e=this.model.field.style&&JSON.parse(this.model.field.style);this.text&&this.text.css({"text-align":e&&e.textAlign||"","font-size":e&&e.fontSize||"","font-weight":e&&util.multiHasOne(e.fontStyle,[1])?"bold":"","font-style":e&&util.multiHasOne(e.fontStyle,[2])?"italic":"",color:e&&e.color||"","background-color":e&&e.backgroundColor||""}),this.el&&this.el.css({"background-color":e&&e.backgroundColor||"","border-width":e&&e.borderWidth||"","border-color":e&&e.borderColor||"","border-left-style":e&&(util.multiHasOne(e.borderSides,[1])?e.borderStyle:"none")||"","border-top-style":e&&(util.multiHasOne(e.borderSides,[2])?e.borderStyle:"none")||"","border-bottom-style":e&&(util.multiHasOne(e.borderSides,[3])?e.borderStyle:"none")||"","border-right-style":e&&(util.multiHasOne(e.borderSides,[4])?e.borderStyle:"none")||""})},y.prototype.isHeightAdjustable=function(){return!0},y.prototype.setHeight=function(e){var t=this.model.field,i=t.height,o=Math.max(1,Math.round((e-42)/24));o!==i?(this.text&&(o>1?this.text.addClass("multiline"):this.text.removeClass("multiline"),this.text.css({height:24*o+8}),this.el.css({height:""})),t.height=o):this.el.css({height:24*t.height+10})},y.prototype.widthChanged=function(){this.updateUI()},y.prototype.openURL=function(){this.value&&NinoxDocumentInteraction.previewDocument(this.value,(function(){}))},y.prototype.sendEmail=function(){if(this.value){var e="mailto:"+encodeURIComponent(this.value);NinoxDocumentInteraction.openBrowser(e)}},y.prototype.openPhone=function(){if(this.value){var e=String(this.value).replace(/[\/]/g,"-");NinoxDocumentInteraction.openBrowser("tel://"+encodeURIComponent(e))}},y.prototype.openFile=function(){if(this.value){var e=database.fileURL1(this.value);if(!e)return;const o=g.schemas.RE_FILE_REF.exec(this.value);if(!o)return;const n=o[1]+o[2],a=o[3];function t(){database.previewFile(n,a)}if(/\.(png|jpg|jpeg|gif)$/i.test(this.value)||(/\.(png|jpg|jpeg|gif)$/i.test(this.value),0)){var i=$("<div>").appendTo(document.body);h.render(p.createElement(u.a,{images:[{file:e,name:a}],initialImageIndex:0,closeLightBox:()=>{h.unmountComponentAtNode(i[0]),i.remove()},downloadUrl:t}),i[0])}else{/\.(pdf)$/i.test(this.value),t()}}},y.prototype.onClick=function(e){var t=this.model.field;if(t.onClick){var i=this.container.getNid();this.el.addClass("clicked"),Object(v.c)(t.onClick,i,e=>{this.el.removeClass("clicked"),e&&$.alert(e)})}else"file"===this.base&&this.openFile(e)},Object.assign(b.prototype,o.a.prototype),b.prototype.inputType="url",b.prototype.editorClass="link",b.prototype.createButton=function(){this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-link"></div></div>').css("display","none").click($.proxy(this.openURL,this)).appendTo(this.el)},b.prototype.openURL=function(){this.value&&NinoxDocumentInteraction.previewDocument(this.value,(function(){}))};var w=i("./src/js/widgets/editors/ChoiceEditor.js");function x(e,t){f.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el).touch($.proxy(this.popup,this)),this.text=$('<div class="choice">').appendTo(this.el),this.button=$('<div class="choice-dropdown">').appendTo(this.el)}function T(){x.apply(this,arguments)}function C(e,t){f.a.apply(this,arguments),this.el=$('<div class="choiceswitch">').appendTo(e.el).touch($.proxy(this.clicked,this))}function k(){C.apply(this,arguments)}function S(e,t){f.a.apply(this,arguments),this.el=$('<div class="choiceradio">').appendTo(e.el).touch($.proxy(this.clicked,this)),this.updateHeight()}function _(){S.apply(this,arguments)}function E(e,t){f.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="input-text multicombo">').appendTo(this.el).click($.proxy(e.focus,e)),this.button=$('<div class="choice-dropdown">').appendTo(this.el).touch($.proxy(this.container.focus,this.container)),this.$backplane=null}function D(e,t){f.a.apply(this,arguments),this.el=$('<div class="multiradio">').appendTo(e.el).touch($.proxy(this.clicked,this)),this.updateHeight()}function N(e,t){f.a.apply(this,arguments),this.el=$('<div class="choiceswitch">').appendTo(e.el).touch($.proxy(this.clicked,this))}function I(e,t){f.a.apply(this,arguments),this.el=$('<div class="choiceswitch">').appendTo(e.el).touch($.proxy(this.clicked,this))}function O(e,t){f.a.apply(this,arguments),this.el=$('<div class="booleancheck">').appendTo(e.el).touch($.proxy(this.clicked,this))}function M(e,t){f.a.apply(this,arguments),this.el=$('<div class="booleanslide"><div class="booleanslide-text"></div><div class="booleanslide-slide"><div class="booleanslide-knob"></div></div></div>').appendTo(e.el).touch($.proxy(this.clicked,this))}Object.assign(x.prototype,f.a.prototype),x.prototype.editorClass="choice",x.prototype.destroy=function(){this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},x.prototype.updateUI=function(){this.model.field.loadValue(this.getNid(),this.value,e=>{void 0!==e?(this.text[0].innerHTML=(e.icon?'<div class="choice-icon ic ic-'+e.icon+'"></div>':"")+'<span style="color:'+e.textColor+'">'+htmlEscape(e.caption)+"</span>",this.el[0].style.backgroundColor=e.color||""):(this.text[0].innerHTML="",this.el[0].style.backgroundColor="")})},x.prototype.popup=function(){var e=this,t=this.model;t.field.loadValuesSorted(this.getNid(),i=>{var o=$.backplane({}),n=$('<div class="choice-menu" style="min-width:'+this.el.outerWidth()+"px;max-height:"+(window.getHeight()-64)+'px;overflow:auto">').appendTo(o).touch(d),a="";if(!t.field.required){var s=null==this.value;a+='<div class="choice-menu-item" data-id="###NULL###"><div class="choice-indicator'+(s?" selected":"")+'"></div><div class="choice-label">'+htmlEscape(locale.empty)+"</div></div>"}m.each(i,(function(t){var i=t.id===e.value;a+='<div data-id="'+t.id+'" class="choice-menu-item" style="'+(t.color?"background-color:"+t.color+";color:"+t.textColor:"")+'"><div class="choice-indicator'+(i?" selected":"")+'"></div><div class="multicombo-item" style="background-color:transparent;color:'+t.textColor+'">'+(t.icon?'<div class="choice-symbol ic ic-'+t.icon+'"></div>':"")+"<span>"+htmlEscape(t.caption||"")+"</span></div></div>"})),n.html(a);var r=n.outerWidth(),l=n.outerHeight(),c=this.el.offset();function d(t){var i=$(t.target).closest(".choice-menu-item").attr("data-id");i&&("###NULL###"===i?(e.updateModel(null),o.close()):(e.updateModel(i),o.close()))}c.top+=32,c.left+r>window.getWidth()&&(c.left=window.getWidth()-r),c.top+l>window.getHeight()-32&&(c.top=window.getHeight()-l-32),n.offset(c)})},Object.assign(T.prototype,x.prototype),T.prototype.editorClass="user",Object.assign(C.prototype,f.a.prototype),C.prototype.editorClass="choice-switch",C.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},C.prototype.updateUI=function(){var e=this.value;this.model.field.loadValuesSorted(this.getNid(),t=>{for(var i="",o=0;o<t.length;o++){var n=t[o],a=e===n.id;i+='<div class="choiceswitch-item'+(a?" selected":"")+'" style="'+(a&&n.color?"background-color:"+n.color+";color:"+n.textColor:"")+'" data-id="'+n.id+'">'+(n.icon?'<div class="choice-symbol ic ic-'+n.icon+'"></div>':"")+"<span>"+htmlEscape(n.caption||"")+"</span></div>"}this.el.html(i)})},C.prototype.clicked=function(e){var t=$(e.target).closest(".choiceswitch-item").attr("data-id");if(t){var i=this.model.field;t===this.value?i.required||this.updateModel(null):this.updateModel(t)}},C.prototype.afterLoaded=function(){"dchoice"===this.model.field.base&&this.updateUI()},Object.assign(k.prototype,C.prototype),k.prototype.editorClass="user-switch",Object.assign(S.prototype,f.a.prototype),S.prototype.editorClass="choice-radio",S.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},S.prototype.updateStructure=function(){this.updateHeight()},S.prototype.updateUI=function(){var e=this.value;this.model.field.loadValuesSorted(this.getNid(),t=>{for(var i="",o=0;o<t.length;o++){var n=t[o],a=e===n.id;i+=`<div \n                    class="choiceradio-item ${a?"selected":""}"\n                    style="${a&&n.color?"background-color:"+n.color+";color:"+n.textColor:""}" \n                    data-id="${n.id}"\n                >\n                <div class="choiceradio-item-radio-container">\n                    <div class="choiceradio-item-radio"/>\n                </div>\n                ${n.icon?`<div class="choice-symbol ic ic-${n.icon}"></div>`:""}\n                <div class="choiceradio-item-text">\n                    ${htmlEscape(n.caption||"")}\n                </div>\n                </div>`}this.el.html(i),this.updateHeightWithCount(t.length)})},S.prototype.clicked=function(e){var t=$(e.target);if(t.closest(".choiceradio-item-radio-container").length){var i=t.closest(".choiceradio-item").attr("data-id");if(i){var o=this.model.field;i===this.value?o.required||this.updateModel(null):this.updateModel(i)}}},S.prototype.isHeightAdjustable=function(){return!0},S.prototype.setHeight=function(e){const t=this.model.field;t.loadValuesSorted(this.getNid(),i=>{const o=i.length,n=Math.ceil(o/4),a=o,s=t.height,r=Math.min(a,Math.max(n,Math.round((e-42)/24)));s!==r&&(t.height=r===o?void 0:r),this.updateHeightWithCount(i.length)})},S.prototype.updateHeight=function(){this.model.field.loadValuesSorted(this.getNid(),e=>{this.updateHeightWithCount(e.length)})},S.prototype.updateHeightWithCount=function(e){const t=this.model.field,i=Math.ceil(e/4),o=e,n=t.height,a=null==n?e:Math.min(o,Math.max(i,n)),s=Math.ceil(e/a);this.el.css({"column-count":s,height:24*a+"px"})},S.prototype.afterLoaded=function(){"dchoice"===this.model.field.base&&this.updateUI()},Object.assign(_.prototype,S.prototype),_.prototype.editorClass="user-radio",Object.assign(E.prototype,f.a.prototype),E.prototype.editorClass="multi-combo",E.prototype.destroy=function(){this.el&&(this.el.remove(),this.el=null),this.$backplane&&(this.$backplane.remove(),this.$backplane=null),f.a.prototype.destroy.apply(this,arguments)},E.prototype.updateUI=function(){var e=util.multiDecode(this.value);this.model.field.loadValuesSorted(this.getNid(),t=>{for(var i="",o=0;o<t.length;o++){var n=t[o],a=-1!==e.indexOf(parseInt(n.id));a&&(i+='<div class="multicombo-item" style="'+(a&&n.color?"background-color:"+n.color+";color:"+n.textColor:"")+'" data-id="'+n.id+'">'+(n.icon?'<div class="choice-symbol ic ic-'+n.icon+'"></div>':"")+"<span>"+htmlEscape(n.caption||"")+"</span></div>")}this.text.html(i)})},E.prototype.focus=function(){if(!this.$backplane){this.$backplane=$.backplane({close:()=>{this.$backplane=null}});var e=this;this.model.field.loadValuesSorted(this.getNid(),t=>{if(this.$backplane){var i=$('<div class="choice-menu" style="min-width:'+this.el.outerWidth()+'px;overflow:auto;z-index:12">').appendTo(this.$backplane).touch(n);o(),a()}function o(){for(var o=util.multiDecode(e.value),n='<div class="choice-menu-head"><div data-id="#all" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.all)+'</div></div><div data-id="#none" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.none)+"</div></div></div>",a=0;a<t.length;a++){var s=t[a],r=-1!==o.indexOf(parseInt(s.id));n+='<div data-id="'+s.id+'" class="choice-menu-item"><div class="choice-indicator'+(r?" selected":"")+'"></div><div class="multicombo-item" style="'+(s.color?"background-color:"+s.color+";color:"+s.textColor:"")+'" data-id="'+s.id+'">'+(s.icon?'<div class="choice-symbol ic ic-'+s.icon+'"></div>':"")+"<span>"+htmlEscape(s.caption||"")+"</span></div></div>"}i.html(n)}function n(i){var n=util.multiDecode(e.value),a=$(i.target).closest(".choice-menu-item").attr("data-id");if(a){if("#all"===a){n=[];for(var s=0;s<t.length;s++)n.push(t[s].id)}else if("#none"===a)n=[];else{var r=parseInt(a),l=n.indexOf(r);-1===l?n.push(r):n.splice(l,1)}e.updateModel(util.multiEncode(n)||null,(function(){o()}))}}function a(){var o=e.el.offset(),n=window.getWidth(),a=window.getHeight(),s=o.left,r=o.top+36,l=i.outerWidth(),c=32*(t.length+1);c>a-r&&(a-r>=o.top-4?c=a-r:(c=Math.min(o.top-4,c),r=o.top-4-c)),s+l>n&&(s=n-l),i.css({left:s,top:r,height:c})}})}},Object.assign(D.prototype,f.a.prototype),D.prototype.editorClass="multi-radio",D.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},D.prototype.updateStructure=function(){this.updateHeight()},D.prototype.updateUI=function(){var e=util.multiDecode(this.value);this.model.field.loadValuesSorted(this.getNid(),t=>{for(var i="",o=0;o<t.length;o++){var n=t[o],a=-1!==e.indexOf(parseInt(n.id));i+=`\n                <div \n                    class="multiradio-item ${a?"selected":""}"\n                    style="${a&&n.color?"background-color:"+n.color:""}" \n                    data-id="${n.id}"\n                >\n                    <div class="multiradio-item-box ${a?"selected i-16-12 i-white i-check":""}"></div>\n                    ${n.icon?`<div class="choice-symbol ic ic-${n.icon}"></div>`:""}\n                    <div class="multiradio-item-text" style="color:${a?n.textColor:""}">\n                        ${htmlEscape(n.caption||"")}\n                    </div>\n            </div>`}this.el.html(i),this.updateHeightWithCount(t.length)})},D.prototype.clicked=function(e){var t=util.multiDecode(this.value),i=$(e.target).closest(".multiradio-item").attr("data-id");if(i){var o=parseInt(i),n=(this.model.field,t.indexOf(o));-1===n?t.push(o):t.splice(n,1),this.updateModel(util.multiEncode(t)||null)}},D.prototype.isHeightAdjustable=function(){return!0},D.prototype.setHeight=function(e){const t=this.model.field;t.loadValuesSorted(this.getNid(),i=>{const o=i.length,n=Math.ceil(o/4),a=o,s=t.height,r=Math.min(a,Math.max(n,Math.round((e-42)/24)));s!==r&&(t.height=r===o?void 0:r),this.updateHeightWithCount(i.length)})},D.prototype.updateHeight=function(){this.model.field.loadValuesSorted(this.getNid(),e=>{this.updateHeightWithCount(e.length)})},D.prototype.updateHeightWithCount=function(e){const t=this.model.field,i=Math.ceil(e/4),o=e,n=t.height,a=null==n?e:Math.min(o,Math.max(i,n)),s=Math.ceil(e/a);this.el.css({"column-count":s,height:24*a+"px"})},Object.assign(N.prototype,f.a.prototype),N.prototype.editorClass="multi-switch",N.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},N.prototype.updateUI=function(){var e=util.multiDecode(this.value);this.model.field.loadValuesSorted(this.getNid(),t=>{for(var i="",o=0;o<t.length;o++){var n=t[o],a=-1!==e.indexOf(parseInt(n.id));i+='<div class="choiceswitch-item'+(a?" selected":"")+'" style="'+(a&&n.color?"background-color:"+n.color+";color:"+n.textColor:"")+'" data-id="'+n.id+'">'+(n.icon?'<div class="choice-symbol ic ic-'+n.icon+'"></div>':"")+"<span>"+htmlEscape(n.caption||"")+"</span></div>"}this.el.html(i)})},N.prototype.clicked=function(e){var t=util.multiDecode(this.value),i=$(e.target).closest(".choiceswitch-item").attr("data-id");if(i){var o=parseInt(i),n=t.indexOf(o);-1===n?t.push(o):t.splice(n,1),this.updateModel(util.multiEncode(t)||null)}},Object.assign(I.prototype,f.a.prototype),I.prototype.editorClass="boolean-switch",I.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},I.prototype.updateUI=function(){var e=this.value,t=(this.model.field,'<div class="choiceswitch-item'+(!1===e?" selected":"")+'" style="width:50%" data-id="false">'+htmlEscape(locale.no)+'</div><div class="choiceswitch-item'+(!0===e?" selected":"")+'" style="width:50%" data-id="true">'+htmlEscape(locale.yes)+"</div>");this.el.html(t)},I.prototype.clicked=function(e){var t=$(e.target).closest(".choiceswitch-item").attr("data-id");if(t){var i="false"!==t&&("true"===t||null),o=this.model.field;i===this.value?o.required||this.updateModel(null):this.updateModel(i)}},Object.assign(O.prototype,f.a.prototype),O.prototype.editorClass="boolean-check",O.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},O.prototype.updateUI=function(){var e=this.value,t=this.model.field,i='<div class="booleancheck-box'+(e?" selected i-16-12 i-white i-check":"")+'"></div><div class="booleancheck-text" style="display:'+("none"===this.model.field.labelPosition?"none":"")+'">'+htmlEscape(t.caption)+"</div>";this.el.html(i)},O.prototype.clicked=function(e){var t=!this.value;this.updateModel(t)},Object.assign(M.prototype,f.a.prototype),M.prototype.editorClass="boolean-slide",M.prototype.destroy=function(){this.el&&this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},M.prototype.updateUI=function(){this.el.toggleClass("active",!!this.value),this.el.find(".booleanslide-text").text(this.model.field.caption).css("display","none"===this.model.field.labelPosition?"none":"")},M.prototype.clicked=function(e){$(e.target).closest(".booleanslide-slide").length&&this.updateModel(!this.value)};var F=i("./src/js/widgets/editors/IconSelector.js"),R=i("./src/js/widgets/editors/ColorSelector.js");function L(e){return util.localeSortBy(m.map(e,(function(e){return{id:e.id,caption:e.caption}})),"caption")}function j(e,t){f.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el).click($.proxy(this.popup,this)),this.text=$('<div class="input-text">').appendTo(this.el),this.button=$('<div class="choice-dropdown">').appendTo(this.el)}function A(e,t){this.editing=!1,this.el=$('<div class="html">').appendTo(e.containerEl||e.el).click($.proxy(this.startEdit,this)),this.el.css({height:24*t.field.height}),f.a.apply(this,arguments)}Object.assign(j.prototype,f.a.prototype),j.prototype.editorClass="roles",j.prototype.destroy=function(){this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},j.prototype.updateUI=function(){var e=L(this.model.roles||database.roles),t=this.value||[],i=[];m.each(e,(function(e){-1!==t.indexOf(e.id)&&i.push(e.caption)}));var o=0===i.length?locale.everybody:i.join(", ");this.text.text(o)},j.prototype.popup=function(){var e=this,t=(this.model,{});$.pushInputHandler(t);var i=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)).touch((function(e){$(e.target).is(".nx-backplane")&&c()})),o=$('<div class="choice-menu">').css({"min-width":this.el.width()}).appendTo(i),n=this.value||[],a=L(this.model.roles||database.roles);m.each(a,(function(e){e.selected=-1!==n.indexOf(e.id);var t=$('<div class="choice-menu-item">').data("role",e).appendTo(o),i=$('<div class="placeholder">').appendTo(t),a=$('<div class="type-symbol">').appendTo(i);function s(){e.selected?a.attr("class","booleancheck-box selected i-16-12 i-white i-check"):a.attr("class","booleancheck-box")}$('<div class="booleancheck-text">').text(e.caption).appendTo(t),t.click((function(){e.selected=!e.selected,s()})),s()}));var s=o.outerWidth(),r=o.outerHeight(),l=this.el.offset();function c(){n=[],m.each(a,(function(e){e.selected&&n.push(e.id)})),e.updateModel(0===n.length?void 0:n),e.updateUI(),i.remove(),$.popInputHandler(t)}l.top+=32,l.left+s>window.getWidth()&&(l.left=window.getWidth()-s),l.top+r>window.getHeight()&&(l.top=window.getHeight()-r),o.offset(l)},Object.assign(A.prototype,f.a.prototype),A.prototype.editorClass="html",A.prototype.isHeightAdjustable=function(){return!0},A.prototype.setHeight=function(e){var t=this.model.field,i=t.height,o=Math.max(1,Math.round((e-40)/24));i!==o&&(t.height=o,this.el.css({height:24*o}))},A.prototype.updateStructur=function(){this.model.field;this.el.css({height:24*newHeight})},A.prototype.destroy=function(){this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},A.prototype.updateUI=function(){this.el[0].innerHTML=this.value||""},A.prototype.startEdit=function(){if(this.editing)return;if(!this.model.isWritable())return;this.editing=!0;var e=this;window.registerSaveListener(g);var t={keydown:y};$.pushInputHandler(t);var i=$('<div class="nx-backplane nx-backplane-dark">').appendTo($(document.body)).click((function(e){$(e.target).is(".nx-backplane")&&v()})),o=$('<div class="html-pane">').appendTo(i);$('<div class="html-caption nx-section-head">').text(e.model.field.caption).appendTo(o);var n=$('<div class="html-controls">').appendTo(o);$('<div class="button i-32-18 i-light-grey i-head-1">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",r),$('<div class="button i-32-18 i-light-grey i-head-2">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",l),$('<div class="button i-32-18 i-light-grey i-head-3">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",c),$('<div class="button i-32-18 i-light-grey i-ul">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",f),$('<div class="button i-32-18 i-light-grey i-one-two-three">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",m),$('<div class="button i-32-18 i-light-grey i-field-br">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",d),$('<div class="button i-32-18 i-light-grey i-bold">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",h),$('<div class="button i-32-18 i-light-grey i-italic">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",p),$('<div class="button i-32-18 i-light-grey i-underline">').appendTo(n).on(TOUCH?EVENT_touchstart:"mousedown",u);var a=$('<div class="contenteditable html-editor no-richtexteditor needsfocus" contenteditable="true">').appendTo(o);const s=$('<div class="nx-button-bar html-button-bar">').appendTo(o);function r(){return document.execCommand("formatBlock",!1,NINOX_IE?"<H1>":"H1"),!1}function l(){return document.execCommand("formatBlock",!1,NINOX_IE?"<H2>":"H2"),!1}function c(){return document.execCommand("formatBlock",!1,NINOX_IE?"<H3>":"H3"),!1}function d(){return document.execCommand("formatBlock",!1,NINOX_IE?"<P>":"P"),!1}function h(){return document.execCommand("bold",!1,null),!1}function p(){return document.execCommand("italic",!1,null),!1}function u(){return document.execCommand("underline",!1,null),!1}function f(){return document.execCommand("insertUnorderedList",!1,null),!1}function m(){return document.execCommand("insertOrderedList",!1,null),!1}function g(){e.updateModel(a.html())}function v(){g(),b()}function y(e){if(27===e.which)return v(),!1}function b(){$.popInputHandler(t),window.unregisterSaveListener(g),e.editing=!1,i.remove()}$('<div class="nx-button-text grey" style="float:right"><span>'+htmlEscape(locale.cancel)+"</span></div>").appendTo(s).click(b),$('<div class="nx-hspace-flex">').appendTo(s),$('<div class="nx-button-text blue" style="float:right"><span>'+htmlEscape(locale.okay)+"</span></div>").appendTo(s).click(v),a.keydown(y),a.html(e.value),a.focus()},A.prototype.endEdit=function(){};var P=i("./src/js/widgets/Field.js");function U(e,t){this.el=$('<div class="stringeditor">').appendTo(e.el).click($.proxy(this.popup,this)),this.text=$('<div class="input-text">').appendTo(this.el),f.a.apply(this,arguments)}Object.assign(U.prototype,f.a.prototype),U.prototype.editorClass="numberformat",U.prototype.destroy=function(){this.model.off("update",this.update,this),this.el.remove()},U.prototype.updateUI=function(){this.text.text(this.value||"")},U.prototype.focus=function(){this.popup()},U.prototype.popup=function(){var e=this,t={};$.pushInputHandler(t);var i=$('<div class="nx-backplane nx-backplane-dark">').touch((function(e){$(e.target).is(".nx-backplane")&&S()})),o=$('<div class="nx-menu-popup grey width-3col" style="padding:16px;">').appendTo(i),n=util.parseNumberFormat(this.value),a=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.numberFormatDigits,required:!1,formWidth:2/3,choiceRenderer:"switch",values:{0:{caption:"0",order:0},1:{caption:"1",order:1},2:{caption:"2",order:2},3:{caption:"3",order:3},4:{caption:"4",order:4},5:{caption:"5",order:5},6:{caption:"6",order:6},7:{caption:"7",order:7},8:{caption:"8",order:8}}}),n.allDigits?void 0:String(n.trailingZeros)),s=new util.SimpleModel(new schemas.TBoolean(void 0,void 0,{caption:locale.numberFormatGroup,required:!0,booleanDefault:!1,formWidth:1/3,booleanRenderer:"switch"}),n.group),r=new util.SimpleModel(new schemas.TString(void 0,void 0,{caption:locale.numberFormatPrefix,required:!1,formWidth:.5}),n.prefix),l=new util.SimpleModel(new schemas.TString(void 0,void 0,{caption:locale.numberFormatUnit,required:!1,formWidth:.5}),n.suffix);function c(e,t){if(t)return"a";const i={'"':"q"," ":"w"}[e];return void 0===i?e:i}var d=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.decimalSeparatorLabel,required:!0,formWidth:.5,choiceRenderer:"switch",values:{a:{caption:"auto",order:1},".":{caption:".",order:2},",":{caption:",",order:3},"'":{caption:"'",order:4},q:{caption:'"',order:5}}}),c(n.decimalSeparator,n.decimalSeparatorAuto)),h=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.groupingSeparatorLabel,required:!0,formWidth:.5,choiceRenderer:"switch",values:{a:{caption:"auto",order:1},".":{caption:".",order:2},",":{caption:",",order:3},"'":{caption:"'",order:4},q:{caption:'"',order:5},w:{caption:"␣",order:6}}}),c(n.groupingSeparator,n.groupingSeparatorAuto));s.on("update",k),a.on("update",k),r.on("update",k),l.on("update",k),d.on("update",k),h.on("update",k);var p=new P.a(this,a,o),u=new P.a(this,s,o),f=new P.a(this,r,o),g=new P.a(this,l,o),v=new P.a(this,d,o),y=new P.a(this,h,o),b=$('<div class="component editor">').appendTo(o);$("<label>Group separator</label>").appendTo(b);var w=$('<div style="margin: -4px">').appendTo(b);m.each([{fmt:void 0,caption:locale.empty},{fmt:"0",caption:util.formatNumber("0",1023.42)},{fmt:"0.00",caption:util.formatNumber("0.00",1023.42)},{fmt:"#,##0.00",caption:util.formatNumber("#,##0.00",1023.42)},{fmt:"0 %",caption:util.formatNumber("0 %",23.42)},{fmt:"0.00 %",caption:util.formatNumber("0.00 %",23.42)},{fmt:"$#,##0.00",caption:util.formatNumber("$#,##0.00",1023.42)},{fmt:"#,##0.00 €",caption:util.formatNumber("#,##0.00 €",1023.42)},{fmt:"¥#,##0.00",caption:util.formatNumber("¥#,##0.00",1023.42)},{fmt:"£#,##0.00",caption:util.formatNumber("£#,##0.00",1023.42)}],(function(t){$('<div class="button text grey" style="width:73px;margin:4px">').text(t.caption).appendTo(w).click((function(){S(),e.updateModel(t.fmt)}))})),i.appendTo($(document.body));var x=o.outerWidth(),T=o.outerHeight(),C=this.el.offset();function k(){function t(e){const t={q:'"',w:" ",a:""}[e];return void 0===t?e:t}var i={group:!!s.value,groupLength:3,leadingZeros:1,trailingZeros:a.value?parseInt(a.value,10):0,allDigits:!a.value,prefix:r.value||"",suffix:l.value||"",decimalSeparator:t(d.value),groupingSeparator:t(h.value)};e.updateModel(util.formatNumberFormat(i))}function S(){k(),u.destroy(),p.destroy(),f.destroy(),g.destroy(),v.destroy(),y.destroy(),i.remove(),$.popInputHandler(t)}C.top+=this.el.outerHeight(),C.left+x>window.getWidth()&&(C.left=window.getWidth()-x),C.top+T>window.getHeight()&&(C.top=window.getHeight()-T),o.offset(C)};var H=i("./src/js/admin/FunctionEditor.js");function z(e,t){f.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el).touch($.proxy(this.startEdit,this)),this.text=$('<div class="input-text">').appendTo(this.el),this.createButton()}function V(e,t){var i,o=this;(i=t.field.stringMultiline?this.input=$('<textarea rows="4">'):this.input=$('<input type="text">')).appendTo($('<div class="stringeditor">').appendTo(e.el)).attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false").focus(r).change(s).blur(l);var n=!1;function a(){n=!0;var e=i[0].selectionStart;(!e||e<0)&&(e=0);var a=i.val(),s=a.substr(0,e),r=a.substr(e),l=/\{([^\}]*)$/.exec(s),c=/^([^\{]*)\}/.exec(r),d="";l&&c&&(s=s.substr(0,l.index),r=r.substr(c[0].length),d=l[1]+c[1]),new H.a({value:d,schema:t.type.schema,type:t.type,okay:function(e,t){var a;n=!1,a=t?s+"{"+t.toHumanString()+"}"+r:s+r,o.updateModel(a,(function(e){i.focus()}))},cancel:function(){i.focus(),n=!1}})}function s(){if(!n){n=!0;var e=i.val();o.updateModel(e,(function(e){n=!1}))}}function r(){if(!o.$button){var t=i.position();t.top-=32,t.left+=i.width()-32,o.$button=$('<div class="button icon i-32-24 i-grey i-setting-settings" style="position:absolute">').offset(t).appendTo(e.el).on(TOUCH?EVENT_touchstart:"mousedown",a)}}function l(){o.$button&&(o.$button.remove(),o.$button=void 0)}f.a.apply(this,arguments)}function W(e,t){this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="input-text">').click($.proxy(this.openMap,this)).appendTo(this.el),this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-location"></div></div>').click($.proxy(this.openMap,this)).appendTo(this.el),this.mapLoadErrors=!1,this.editing=!1,this.updating=!1,this.updateEditor=null,this.saveEditor=null,this.applyEditor=null,this.destroyEditor=null,f.a.apply(this,arguments)}function B(e,t){f.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el),this.text=$('<div class="input-text multicombo">').appendTo(this.el).click($.proxy(e.focus,e)),this.button=$('<div class="choice-dropdown">').appendTo(this.el).touch($.proxy(this.container.focus,this.container))}function q(e,t){f.a.apply(this,arguments),this.el=$('<div class="stringeditor">').appendTo(e.el).touch($.proxy(this.popup,this)),this.text=$('<div class="input-text">').appendTo(this.el)}Object.assign(z.prototype,f.a.prototype),z.prototype.editorClass="exp",z.prototype.destroy=function(){this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},z.prototype.updateUI=function(){this.text.text(this.model.field.format(this.value))},z.prototype.startEdit=function(){var e=this;new H.a({schema:e.model.schema,type:e.model.type,variables:e.model.field.getVariables?e.model.field.getVariables():{},supportsCommands:e.model.field.supportsCommands,ownerField:e.model.field,value:e.value,okay:function(t){e.updateModel(t)},cancel:function(){}})},z.prototype.createButton=function(){this.button=$('<div class="stringeditor-button"><div class="i-32-18 i-light-grey i-field-fn"></div></div>').click($.proxy(this.openURL,this)).appendTo(this.el)},Object.assign(V.prototype,f.a.prototype),V.prototype.editorClass="stringtemplate",V.prototype.destroy=function(){this.input&&this.input.remove(),this.$button&&this.$button.remove(),f.a.prototype.destroy.apply(this,arguments)},V.prototype.updateUI=function(){var e=this.model,t=this.value,i=queries.formatSystemStringTemplateHuman(t,e.type);this.input.val(i)},V.prototype.updateModel=function(e,t){var i=this.model,o=queries.formatHumanStringTemplateSystem(e,i.type);f.a.prototype.updateModel.call(this,o,t)},Object.assign(W.prototype,f.a.prototype),W.prototype.editorClass="location",W.prototype.destroy=function(){this.el.remove(),this.editing&&this.destroyEditor(),f.a.prototype.destroy.apply(this,arguments)},W.prototype.save=function(){this.editing&&this.saveEditor()},W.prototype.updateUI=function(){this.value?(this.text.text(this.model.field.format(this.value)),this.text[0].style.color=""):"placeholder"===this.model.field.labelPosition?(this.text.text(this.model.field.caption),this.text[0].style.color="#999"):(this.text.text(""),this.text[0].style.color=""),this.editing&&this.updateEditor()},W.prototype.focus=function(){var e=this;if(!e.editing&&!e.updating){e.editing=!0,e.updateEditor=f,e.saveEditor=b,e.applyEditor=y,e.destroyEditor=w;var t="",i="",o="",n={};$.pushInputHandler(n);var a=$('<div class="nx-backplane">').appendTo($(document.body)).touch((function(e){$(e.target).is(".nx-backplane")&&y()}));e.$focusedBackPlane=a;var s=$('<div class="nx-menu-popup grey" style="width:432px">').appendTo(a),r=e.text.offset(),l=e.el.width(),c=$('<input type="text" class="input-location" style="z-index: 0;position:absolute;left:'+r.left+"px;top:"+r.top+"px;width:"+l+'px">').appendTo(a).keydown(m);this.$title=c;var d=$('<div class="editor" style="width:180px;display:inline-block">').appendTo(s);$("<label>").text(locale.latitude).appendTo(d);var h=$('<input type="text" class= "lat" >').appendTo(d).keydown(m);this.$latitude=h;var p=$('<div class="editor" style="width:180px;display:inline-block">').appendTo(s);$("<label>").text(locale.longitude).appendTo(p);var u=$('<input type="text" class="lng">').appendTo(p).keydown(m);this.$longitude=u,$('<div class="icon-big-grey icon-big-search" style="position:absolute;left:368px;top:26px">').appendTo(s).on(TOUCH?EVENT_touchstart:"mousedown",(function(e){e.preventDefault(),v((function(){}))})),$('<div class="icon-big-grey icon-big-location" style="position:absolute;left:400px;top:26px">').appendTo(s).touch((function(){y((function(){e.openMap()}))})),c.focus(),c.select(),f(),g()}function f(){var n=util.parseLocation(e.value);t=n?n.title:"",i=n?util.formatNumber(null,n.longitude):"",o=n?util.formatNumber(null,n.latitude):"",c.val(t),u.val(i),h.val(o)}function m(t){9===t.which?t.shiftKey?t.target===c[0]&&(t.preventDefault(),y((function(){setTimeout((function(){e.container.focusPrev()}),0)}))):t.target===c[0]&&(t.preventDefault(),y((function(){setTimeout((function(){e.container.focusNext()}),0)}))):13===t.which?(t.preventDefault(),y()):27===t.which&&(t.preventDefault(),w())}function g(){var t=e.el.offset(),i=window.getWidth(),o=window.getHeight(),n=s.outerWidth(),a=s.outerHeight(),r=t.left+n>i?i-n:t.left,l=t.top+36+a>o?t.top-a-4:t.top+36;s.css({left:r,top:l})}function v(e){if(!c.val())return u.val(""),h.val(""),e();$.loading(!0),NinoxDocumentInteraction.coordinatesForAddress(c.val(),(function(t,i){$.loading(!1),i&&(c.val(i.title||c.val()||""),u.val(util.formatNumber(null,i.longitude)),h.val(util.formatNumber(null,i.latitude))),e()}))}function y(e){w(),b(e)}function b(n){var a=c.val(),s=u.val(),r=h.val();if(a!=t||s!=i||r!=o){var l=util.formatLocation({title:a,longitude:util.parseNumber(s),latitude:util.parseNumber(r)});e.updating=!0,e.updateModel(l,(function(t){e.updating=!1,n&&n()}))}else n&&n()}function w(){a.remove(),$.popInputHandler(n),e.editing=!1,e.updateEditor=null,e.saveEditor=null,e.applyEditor=null,e.destroyEditor=null,e.$focusedBackPlane=null}},W.prototype.blur=function(){this.editing&&this.applyEditor()},W.prototype.openMap=function(){var e=this,t=util.parseLocation(this.value);NinoxDocumentInteraction.openMap(t,(function(t,i){var o=util.formatLocation(i);e.updateModel(o)}))},Object.assign(B.prototype,f.a.prototype),B.prototype.editorClass="choice",B.prototype.destroy=function(){this.el.remove(),f.a.prototype.destroy.apply(this,arguments)},B.prototype.updateUI=function(){for(var e=this.model.field,t=m.sortBy(e.getValues(),"order"),i="",o=0;o<t.length;o++){var n=t[o],a=this.value&&this.value[n.id];a&&(i+='<div class="multicombo-item" style="'+(a&&n.color?"background-color:"+n.color+";color:"+n.textColor:"")+'" data-id="'+n.id+'">'+(n.icon?'<div class="choice-symbol ic ic-'+n.icon+'"></div>':"")+"<span>"+htmlEscape(n.caption||"")+"</span></div>")}this.text.html(i)},B.prototype.focus=function(){var e=this,t=m.sortBy(e.model.field.getValues(),"order"),i=$.backplane({}),o=$('<div class="choice-menu" style="min-width:'+this.el.outerWidth()+'px;overflow:auto;z-index:12">').appendTo(i).touch(a);function n(){for(var i='<div class="choice-menu-head"><div data-id="#all" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.all)+'</div></div><div data-id="#none" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.none)+'</div></div><div data-id="#new" class="choice-menu-item"><div class="choice-label">'+htmlEscape(locale.addRole)+"</div></div></div>",n=0;n<t.length;n++){var a=t[n],s=e.value&&e.value[a.id];i+='<div data-id="'+a.id+'" class="choice-menu-item"><div class="choice-indicator'+(s?" selected":"")+'"></div><div class="multicombo-item" style="'+(a.color?"background-color:"+a.color+";color:"+a.textColor:"")+'" data-id="'+a.id+'">'+(a.icon?'<div class="choice-symbol ic ic-'+a.icon+'"></div>':"")+"<span>"+htmlEscape(a.caption||"")+"</span></div></div>"}o.html(i)}function a(o){$(o.target);var a,s=$(o.target).closest(".choice-menu-item").attr("data-id");if(s){if("#new"===s&&(e.addValue(),i.close()),"#all"===s){a={};for(var r=0;r<t.length;r++)a[t[r].id]=!0}else"#none"===s?a={}:(a=Object.assign({},e.value))[s]?delete a[s]:a[s]=!0;e.updateModel(a),n()}}function s(){var i=e.el.offset(),n=window.getWidth(),a=window.getHeight(),s=i.left,r=i.top+36,l=o.outerWidth(),c=32*(t.length+1);c>a-r&&(a-r>=i.top-4?c=a-r:(c=Math.min(i.top-4,c),r=i.top-4-c)),s+l>n&&(s=n-l),o.css({left:s,top:r,height:c})}n(),s()},B.prototype.addValue=function(){var e=this,t=this.model,i=$.popdown({cls:"small",head:locale.addRole,buttons:["cancel","-",{caption:locale.okay,cls:"blue",click:n}]}),o=$.input({caption:locale.roleCaption,$container:i.$content,focus:!0});function n(){var n=o.val().trim();n&&t.field.createValue(n,(function(t,o){if(t)return $.alert(t);var n={};n[o.id]=!0,e.updateModel(n),e.updateUI(),i.close()}))}},Object.assign(q.prototype,f.a.prototype),q.prototype.editorClass="color",q.prototype.destroy=function(){this.el.remove()},q.prototype.updateUI=function(){var e;try{this.value&&(e=JSON.parse(this.value))}catch(e){}this.el.css({color:e&&e.color||"","background-color":e&&e.backgroundColor||"","text-align":e&&e.textAlign||"","font-size":e&&e.fontSize||"","font-weight":e&&util.multiHasOne(e.fontStyle,[1])?"bold":"","font-style":e&&util.multiHasOne(e.fontStyle,[2])?"italic":""}),this.text.text(e?locale.text:locale.none)},q.prototype.popup=function(){var e=this,t={};try{this.value&&(t=JSON.parse(this.value))}catch(e){}var i=$.backplane({}),o=$('<div class="styleeditor-menu">').appendTo(i),n=o,a=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.color,width:2}),t.color);a.on("update",g);var s=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.backgroundColor,width:2}),t.backgroundColor);s.on("update",g);var r=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.printFontSize,required:!0,choiceDefault:"1em",width:2,values:{".9em":{id:".9em",caption:locale.fontSmall,order:1},"1em":{id:"1em",caption:locale.fontNormal,order:2},"1.2em":{id:"1.2em",caption:locale.fontLarge,order:3},"1.5em":{id:"1.5em",caption:locale.fontVeryLarge,order:4}}}),t.fontSize||"1em");r.on("update",g);var l=new util.SimpleModel(new schemas.TMulti(void 0,void 0,{caption:locale.fontStyle,width:2,values:{1:{id:"1",caption:locale.bold,order:1},2:{id:"2",caption:locale.italic,order:2}}}),t.fontStyle);l.on("update",g);var c=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.textAlign,required:!0,choiceDefault:"left",choiceRenderer:"switch",width:4,values:{left:{id:"left",caption:locale.left,order:1},center:{id:"center",caption:locale.center,order:2},right:{id:"right",caption:locale.right,order:3}}}),t.textAlign||"left");c.on("update",g);var d=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.borderStyle,required:!0,choiceDefault:"none",formWidth:.35,values:{none:{id:"none",caption:locale.none,order:1},solid:{id:"solid",caption:locale.solid,order:2},double:{id:"double",caption:locale.double,order:3},dotted:{id:"dotted",caption:locale.dotted,order:4},dashed:{id:"dashed",caption:locale.dashed,order:5}}}),t.borderStyle||"none");d.on("update",g);var h=new util.SimpleModel(new schemas.TChoice(void 0,void 0,{caption:locale.borderWidth,required:!0,choiceDefault:"none",formWidth:.35,values:{thin:{id:"thin",caption:locale.thin,order:1},medium:{id:"medium",caption:locale.medium,order:2},thick:{id:"thick",caption:locale.thick,order:3}}}),t.borderWidth||"thin");h.on("update",g);var p=new util.SimpleModel(new schemas.TColor(void 0,void 0,{caption:locale.borderColor,formWidth:.3}),t.borderColor||"#000");p.on("update",g);var u=new util.SimpleModel(new schemas.TMulti(void 0,void 0,{caption:locale.borderSides,width:4,values:{1:{id:"1",caption:locale.left,order:1},2:{id:"2",caption:locale.top,order:2},3:{id:"3",caption:locale.bottom,order:3},4:{id:"4",caption:locale.right,order:4}}}),t.borderSides||util.multiEncode([1,2,3,4]));u.on("update",g);new P.a(void 0,a,n),new P.a(void 0,s,n),new P.a(void 0,r,n),new P.a(void 0,l,n),new P.a(void 0,c,n),new P.a(void 0,d,n),new P.a(void 0,h,n),new P.a(void 0,p,n),new P.a(void 0,u,n);var f=$('<div class="styleeditor-controls">').appendTo(n);function m(){var t=o.outerWidth(),i=o.outerHeight(),n=e.el.offset();n.top+=32,n.left+t>window.getWidth()&&(n.left=window.getWidth()-t),n.top+i>window.getHeight()&&(n.top=window.getHeight()-i),o.offset(n)}function g(){e.updateModel(JSON.stringify({color:a.value,backgroundColor:s.value,fontSize:r.value,fontStyle:l.value,textAlign:c.value,borderStyle:d.value,borderWidth:h.value,borderColor:p.value,borderSides:u.value}))}function v(){e.updateModel(null)}function y(){i.close()}$('<div class="nx-button-text grey">').text(locale.clear).appendTo(f).touch((function(){v(),y()})),$('<div class="nx-hspace-flex">').appendTo(f),$('<div class="nx-button-text blue">').text(locale.okay).appendTo(f).touch((function(){g(),y()})),m()};const Y=window.NINOX_IOS||window.NINOX_ANDROID?x:w.a,X=window.NINOX_IOS||window.NINOX_ANDROID?a:s,G=window.NINOX_IOS||window.NINOX_ANDROID?T:w.b,J={choice:Y,"choice-combo":Y,boolean:Y,"boolean-combo":Y,appointment:n,string:o.a,timeinterval:o.a,email:r,phone:l,link:b,fn:y,date:c,datx:c,time:d,timestamp:c,dchoice:Y,"dchoice-combo":Y,"choice-switch":C,"dchoice-switch":C,"user-switch":k,"choice-radio":S,"dchoice-radio":S,"user-radio":_,dmulti:E,"multi-combo":E,"dmulti-combo":E,"multi-radio":D,"multi-switch":N,"dmulti-switch":N,"dmulti-radio":D,"boolean-switch":I,"boolean-check":O,"boolean-slide":M,icon:F.b,color:R.b,roles:j,html:A,number:X,numberformat:U,exp:z,stringtemplate:V,location:W,extchoice:B,style:q,user:G,"user-combo":G};function K(){const e={popupEditorStack:[],DONT_SHOW_LABEL:{"boolean-check":!0,"boolean-slide":!0}};return e}function Q(){return database.adminMode&&database.isAdminEnabled()}function Z(e,t){var i=t.field;return new(J[i.getEditorClass()]||J.string)(e,t)}function ee(e){return"editor editor-"+("fn"===e.base?e.exp?e.exp.returnType.base:"fn":e.base)}},"./src/lib/excel/jszip.js":function(e,t,i){"use strict";(function(e,t){var o;i("./node_modules/core-js/modules/es.string.replace.js"),i("./node_modules/core-js/modules/es.typed-array.int32-array.js"),i("./node_modules/core-js/modules/es.typed-array.uint8-array.js"),i("./node_modules/core-js/modules/es.typed-array.uint16-array.js"),i("./node_modules/core-js/modules/es.typed-array.uint32-array.js"),i("./node_modules/core-js/modules/web.immediate.js");!function(o){if("object"==typeof exports&&void 0!==e)e.exports=o();else if("function"==typeof define&&i("./node_modules/webpack/buildin/amd-options.js"))define([],o);else{var n;"undefined"!=typeof window?n=window:void 0!==t?n=t:"undefined"!=typeof self&&(n=self),n.JSZip=o()}}((function(){return function e(t,i,n){function a(r,l){if(!i[r]){if(!t[r]){if(!l&&("function"==typeof o&&o))return o(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};t[r][0].call(c.exports,(function(e){var i=t[r][1][e];return a(i||e)}),c,c.exports,e,t,i,n)}return i[r].exports}for(var s="function"==typeof o&&o,r=0;r<n.length;r++)a(n[r]);return a}({1:[function(e,t,i){var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e,t){for(var i,n,a,s,r,l,c,d="",h=0;h<e.length;)s=(i=e.charCodeAt(h++))>>2,r=(3&i)<<4|(n=e.charCodeAt(h++))>>4,l=(15&n)<<2|(a=e.charCodeAt(h++))>>6,c=63&a,isNaN(n)?l=c=64:isNaN(a)&&(c=64),d=d+o.charAt(s)+o.charAt(r)+o.charAt(l)+o.charAt(c);return d},i.decode=function(e,t){var i,n,a,s,r,l,c="",d=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)i=o.indexOf(e.charAt(d++))<<2|(s=o.indexOf(e.charAt(d++)))>>4,n=(15&s)<<4|(r=o.indexOf(e.charAt(d++)))>>2,a=(3&r)<<6|(l=o.indexOf(e.charAt(d++))),c+=String.fromCharCode(i),64!=r&&(c+=String.fromCharCode(n)),64!=l&&(c+=String.fromCharCode(a));return c}},{}],2:[function(e,t,i){function o(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}o.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=o},{}],3:[function(e,t,i){i.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},i.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t,i){var o=e("./utils"),n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var i="string"!==o.getTypeOf(e);void 0===t&&(t=0);var a=0;t^=-1;for(var s=0,r=e.length;s<r;s++)a=i?e[s]:e.charCodeAt(s),t=t>>>8^n[255&(t^a)];return-1^t}},{"./utils":19}],5:[function(e,t,i){var o=e("./utils");function n(e){this.data=null,this.length=0,this.index=0}n.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return o.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=n},{"./utils":19}],6:[function(e,t,i){i.base64=!1,i.binary=!1,i.dir=!1,i.date=null,i.compression=null,i.comment=null},{}],7:[function(e,t,i){var o=e("./utils");i.string2binary=function(e){return o.string2binary(e)},i.string2Uint8Array=function(e){return o.transformTo("uint8array",e)},i.uint8Array2String=function(e){return o.transformTo("string",e)},i.string2Blob=function(e){var t=o.transformTo("arraybuffer",e);return o.arrayBuffer2Blob(t)},i.arrayBuffer2Blob=function(e){return o.arrayBuffer2Blob(e)},i.transformTo=function(e,t){return o.transformTo(e,t)},i.getTypeOf=function(e){return o.getTypeOf(e)},i.checkSupport=function(e){return o.checkSupport(e)},i.MAX_VALUE_16BITS=o.MAX_VALUE_16BITS,i.MAX_VALUE_32BITS=o.MAX_VALUE_32BITS,i.pretty=function(e){return o.pretty(e)},i.findCompression=function(e){return o.findCompression(e)},i.isRegExp=function(e){return o.isRegExp(e)}},{"./utils":19}],8:[function(e,t,i){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,n=e("pako");i.uncompressInputType=o?"uint8array":"array",i.compressInputType=o?"uint8array":"array",i.magic="\b\0",i.compress=function(e){return n.deflateRaw(e)},i.uncompress=function(e){return n.inflateRaw(e)}},{pako:24}],9:[function(e,t,i){var o=e("./base64");function n(e,t){if(!(this instanceof n))return new n(e,t);this.files={},this.comment=null,this.root="",e&&this.load(e,t),this.clone=function(){var e=new n;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}n.prototype=e("./object"),n.prototype.load=e("./load"),n.support=e("./support"),n.defaults=e("./defaults"),n.utils=e("./deprecatedPublicUtils"),n.base64={encode:function(e){return o.encode(e)},decode:function(e){return o.decode(e)}},n.compressions=e("./compressions"),t.exports=n},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":11,"./support":15}],10:[function(e,t,i){var o=e("./base64"),n=e("./zipEntries");t.exports=function(e,t){var i,a,s,r;for((t=t||{}).base64&&(e=o.decode(e)),i=(a=new n(e,t)).files,s=0;s<i.length;s++)r=i[s],this.file(r.fileName,r.decompressed,{binary:!0,optimizedBinaryString:!0,date:r.date,dir:r.dir,comment:r.fileComment.length?r.fileComment:null});return a.zipComment.length&&(this.comment=a.zipComment),this}},{"./base64":1,"./zipEntries":20}],11:[function(e,t,i){var o,n=e("./support"),a=e("./utils"),s=e("./crc32"),r=e("./signature"),l=e("./defaults"),c=e("./base64"),d=e("./compressions"),h=e("./compressedObject"),p=e("./nodeBuffer"),u=e("./utf8"),f=e("./stringWriter"),m=e("./uint8ArrayWriter");n.uint8array&&"function"==typeof TextEncoder&&(o=new TextEncoder("utf-8"));var g=function(e){if(e._data instanceof h&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===a.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},v=function(e){var t=g(e);if("string"===a.getTypeOf(t)){if(!e.options.binary){if(o)return o.encode(t);if(n.nodebuffer)return p(t,"utf-8")}return e.asBinary()}return t},y=function(e){var t=g(this);return null==t?"":(this.options.base64&&(t=c.decode(t)),t=e&&this.options.binary?_.utf8decode(t):a.transformTo("string",t),e||this.options.binary||(t=a.transformTo("string",_.utf8encode(t))),t)},b=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this._data=t,this.options=i,this._initialMetadata={dir:i.dir,date:i.date}};b.prototype={asText:function(){return y.call(this,!0)},asBinary:function(){return y.call(this,!1)},asNodeBuffer:function(){var e=v(this);return a.transformTo("nodebuffer",e)},asUint8Array:function(){var e=v(this);return a.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var w=function(e,t){var i,o="";for(i=0;i<t;i++)o+=String.fromCharCode(255&e),e>>>=8;return o},x=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===i[t]&&(i[t]=arguments[e][t]);return i},T=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=x(e,l)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},C=function(e,t,i){var o=a.getTypeOf(t);if((i=T(i)).dir||null==t)i.base64=!1,i.binary=!1,t=null;else if("string"===o)i.binary&&!i.base64&&!0!==i.optimizedBinaryString&&(t=a.string2binary(t));else{if(i.base64=!1,i.binary=!0,!(o||t instanceof h))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===o&&(t=a.transformTo("uint8array",t))}var n=new b(e,t,i);return this.files[e]=n,n},k=function(e){return"/"!=e.slice(-1)&&(e+="/"),this.files[e]||C.call(this,e,null,{dir:!0}),this.files[e]},$=function(e,t){var i,o=new h;return e._data instanceof h?(o.uncompressedSize=e._data.uncompressedSize,o.crc32=e._data.crc32,0===o.uncompressedSize||e.dir?(t=d.STORE,o.compressedContent="",o.crc32=0):e._data.compressionMethod===t.magic?o.compressedContent=e._data.getCompressedContent():(i=e._data.getContent(),o.compressedContent=t.compress(a.transformTo(t.compressInputType,i)))):((i=v(e))&&0!==i.length&&!e.dir||(t=d.STORE,i=""),o.uncompressedSize=i.length,o.crc32=s(i),o.compressedContent=t.compress(a.transformTo(t.compressInputType,i))),o.compressedSize=o.compressedContent.length,o.compressionMethod=t.magic,o},S=function(e,t,i,o){i.compressedContent;var n,l,c,d,h=a.transformTo("string",u.utf8encode(t.name)),p=t.comment||"",f=a.transformTo("string",u.utf8encode(p)),m=h.length!==t.name.length,g=f.length!==p.length,v=t.options,y="",b="",x="";c=t._initialMetadata.dir!==t.dir?t.dir:v.dir,n=(d=t._initialMetadata.date!==t.date?t.date:v.date).getHours(),n<<=6,n|=d.getMinutes(),n<<=5,n|=d.getSeconds()/2,l=d.getFullYear()-1980,l<<=4,l|=d.getMonth()+1,l<<=5,l|=d.getDate(),m&&(b=w(1,1)+w(s(h),4)+h,y+="up"+w(b.length,2)+b),g&&(x=w(1,1)+w(this.crc32(f),4)+f,y+="uc"+w(x.length,2)+x);var T="";return T+="\n\0",T+=m||g?"\0\b":"\0\0",T+=i.compressionMethod,T+=w(n,2),T+=w(l,2),T+=w(i.crc32,4),T+=w(i.compressedSize,4),T+=w(i.uncompressedSize,4),T+=w(h.length,2),T+=w(y.length,2),{fileRecord:r.LOCAL_FILE_HEADER+T+h+y,dirRecord:r.CENTRAL_FILE_HEADER+"\0"+T+w(f.length,2)+"\0\0\0\0"+(!0===c?"\0\0\0":"\0\0\0\0")+w(o,4)+h+y+f,compressedObject:i}},_={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,i,o,n,a=[];for(t in this.files)this.files.hasOwnProperty(t)&&(o=this.files[t],n=new b(o.name,o._data,x(o.options)),i=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(i,n)&&a.push(n));return a},file:function(e,t,i){if(1===arguments.length){if(a.isRegExp(e)){var o=e;return this.filter((function(e,t){return!t.dir&&o.test(e)}))}return this.filter((function(t,i){return!i.dir&&t===e}))[0]||null}return e=this.root+e,C.call(this,e,t,i),this},folder:function(e){if(!e)return this;if(a.isRegExp(e))return this.filter((function(t,i){return i.dir&&e.test(t)}));var t=this.root+e,i=k.call(this,t),o=this.clone();return o.root=i.name,o},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter((function(t,i){return i.name.slice(0,e.length)===e})),o=0;o<i.length;o++)delete this.files[i[o].name];return this},generate:function(e){e=x(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),a.checkSupport(e.type);var t,i,o=[],n=0,s=0,l=a.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var h in this.files)if(this.files.hasOwnProperty(h)){var p=this.files[h],u=p.options.compression||e.compression.toUpperCase(),g=d[u];if(!g)throw new Error(u+" is not a valid compression method !");var v=$.call(this,p,g),y=S.call(this,h,p,v,n);n+=y.fileRecord.length+v.compressedSize,s+=y.dirRecord.length,o.push(y)}var b="";b=r.CENTRAL_DIRECTORY_END+"\0\0\0\0"+w(o.length,2)+w(o.length,2)+w(s,4)+w(n,4)+w(l.length,2)+l;var T=e.type.toLowerCase();for(t="uint8array"===T||"arraybuffer"===T||"blob"===T||"nodebuffer"===T?new m(n+s+b.length):new f(n+s+b.length),i=0;i<o.length;i++)t.append(o[i].fileRecord),t.append(o[i].compressedObject.compressedContent);for(i=0;i<o.length;i++)t.append(o[i].dirRecord);t.append(b);var C=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return a.transformTo(e.type.toLowerCase(),C);case"blob":return a.arrayBuffer2Blob(a.transformTo("arraybuffer",C));case"base64":return e.base64?c.encode(C):C;default:return C}},crc32:function(e,t){return s(e,t)},utf8encode:function(e){return a.transformTo("string",u.utf8encode(e))},utf8decode:function(e){return u.utf8decode(e)}};t.exports=_},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":22,"./signature":12,"./stringWriter":14,"./support":15,"./uint8ArrayWriter":17,"./utf8":18,"./utils":19}],12:[function(e,t,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],13:[function(e,t,i){var o=e("./dataReader"),n=e("./utils");function a(e,t){this.data=e,t||(this.data=n.string2binary(this.data)),this.length=this.data.length,this.index=0}a.prototype=new o,a.prototype.byteAt=function(e){return this.data.charCodeAt(e)},a.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},a.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=a},{"./dataReader":5,"./utils":19}],14:[function(e,t,i){var o=e("./utils"),n=function(){this.data=[]};n.prototype={append:function(e){e=o.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=n},{"./utils":19}],15:[function(e,t,i){(function(e){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=!e.browser,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var t=new ArrayBuffer(0);try{i.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var o=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);o.append(t),i.blob=0===o.getBlob("application/zip").size}catch(e){i.blob=!1}}}}).call(this,e("FWaASH"))},{FWaASH:23}],16:[function(e,t,i){var o=e("./dataReader");function n(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}n.prototype=new o,n.prototype.byteAt=function(e){return this.data[e]},n.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),o=e.charCodeAt(2),n=e.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===t&&this.data[a+1]===i&&this.data[a+2]===o&&this.data[a+3]===n)return a;return-1},n.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=n},{"./dataReader":5}],17:[function(e,t,i){var o=e("./utils"),n=function(e){this.data=new Uint8Array(e),this.index=0};n.prototype={append:function(e){0!==e.length&&(e=o.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=n},{"./utils":19}],18:[function(e,t,i){var o,n,a=e("./utils"),s=e("./support"),r=e("./nodeBuffer");s.uint8array&&"function"==typeof TextEncoder&&"function"==typeof TextDecoder&&(o=new TextEncoder("utf-8"),n=new TextDecoder("utf-8"));for(var l=new Array(256),c=0;c<256;c++)l[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;l[254]=l[254]=1;var d=function(e){var t,i,o,n,a,r=e.length,l=0;for(n=0;n<r;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<r&&56320==(64512&(o=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(o-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=s.uint8array?new Uint8Array(l):new Array(l),a=0,n=0;a<l;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<r&&56320==(64512&(o=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(o-56320),n++),i<128?t[a++]=i:i<2048?(t[a++]=192|i>>>6,t[a++]=128|63&i):i<65536?(t[a++]=224|i>>>12,t[a++]=128|i>>>6&63,t[a++]=128|63&i):(t[a++]=240|i>>>18,t[a++]=128|i>>>12&63,t[a++]=128|i>>>6&63,t[a++]=128|63&i);return t},h=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+l[e[i]]>t?i:t},p=function(e){var t,i,o,n,s=e.length,r=new Array(2*s);for(i=0,t=0;t<s;)if((o=e[t++])<128)r[i++]=o;else if((n=l[o])>4)r[i++]=65533,t+=n-1;else{for(o&=2===n?31:3===n?15:7;n>1&&t<s;)o=o<<6|63&e[t++],n--;n>1?r[i++]=65533:o<65536?r[i++]=o:(o-=65536,r[i++]=55296|o>>10&1023,r[i++]=56320|1023&o)}return r.length!==i&&(r.subarray?r=r.subarray(0,i):r.length=i),a.applyFromCharCode(r)};i.utf8encode=function(e){return o?o.encode(e):s.nodebuffer?r(e,"utf-8"):d(e)},i.utf8decode=function(e){if(n)return n.decode(a.transformTo("uint8array",e));if(s.nodebuffer)return a.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],i=0,o=(e=a.transformTo(s.uint8array?"uint8array":"array",e)).length,r=65536;i<o;){var l=h(e,Math.min(i+r,o));s.uint8array?t.push(p(e.subarray(i,l))):t.push(p(e.slice(i,l))),i=l}return t.join("")}},{"./nodeBuffer":22,"./support":15,"./utils":19}],19:[function(e,t,i){var o=e("./support"),n=e("./compressions"),a=e("./nodeBuffer");function s(e){return e}function r(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}function l(e){var t=65536,o=[],n=e.length,s=i.getTypeOf(e),r=0,l=!0;try{switch(s){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,a(0))}}catch(e){l=!1}if(!l){for(var c="",d=0;d<e.length;d++)c+=String.fromCharCode(e[d]);return c}for(;r<n&&t>1;)try{"array"===s||"nodebuffer"===s?o.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+t,n)))):o.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+t,n)))),r+=t}catch(e){t=Math.floor(t/2)}return o.join("")}function c(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}i.string2binary=function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(255&e.charCodeAt(i));return t},i.arrayBuffer2Blob=function(e){i.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(i){try{var t=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return t.append(e),t.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},i.applyFromCharCode=l;var d={};d.string={string:s,array:function(e){return r(e,new Array(e.length))},arraybuffer:function(e){return d.string.uint8array(e).buffer},uint8array:function(e){return r(e,new Uint8Array(e.length))},nodebuffer:function(e){return r(e,a(e.length))}},d.array={string:l,array:s,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a(e)}},d.arraybuffer={string:function(e){return l(new Uint8Array(e))},array:function(e){return c(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:s,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return a(new Uint8Array(e))}},d.uint8array={string:l,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:s,nodebuffer:function(e){return a(e)}},d.nodebuffer={string:l,array:function(e){return c(e,new Array(e.length))},arraybuffer:function(e){return d.nodebuffer.uint8array(e).buffer},uint8array:function(e){return c(e,new Uint8Array(e.length))},nodebuffer:s},i.transformTo=function(e,t){if(t||(t=""),!e)return t;i.checkSupport(e);var o=i.getTypeOf(t);return d[o][e](t)},i.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":o.nodebuffer&&a.test(e)?"nodebuffer":o.uint8array&&e instanceof Uint8Array?"uint8array":o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(e){if(!o[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(e){var t,i,o="";for(i=0;i<(e||"").length;i++)o+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return o},i.findCompression=function(e){for(var t in n)if(n.hasOwnProperty(t)&&n[t].magic===e)return n[t];return null},i.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":22,"./support":15}],20:[function(e,t,i){var o=e("./stringReader"),n=e("./nodeBufferReader"),a=e("./uint8ArrayReader"),s=e("./utils"),r=e("./signature"),l=e("./zipEntry"),c=e("./support"),d=e("./object");function h(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}h.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+s.pretty(t)+", expected "+s.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=d.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,o=this.zip64EndOfCentralSize-44,n=0;n<o;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===r.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=s.getTypeOf(e);"string"!==t||c.uint8array?this.reader="nodebuffer"===t?new n(e):new a(s.transformTo("uint8array",e)):this.reader=new o(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=h},{"./nodeBufferReader":22,"./object":11,"./signature":12,"./stringReader":13,"./support":15,"./uint8ArrayReader":16,"./utils":19,"./zipEntry":21}],21:[function(e,t,i){var o=e("./stringReader"),n=e("./utils"),a=e("./compressedObject"),s=e("./object");function r(e,t){this.options=e,this.loadOptions=t}r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,i){return function(){var o=e.index;e.setIndex(t);var n=e.readData(i);return e.setIndex(o),n}},prepareContent:function(e,t,i,o,a){return function(){var e=n.transformTo(o.uncompressInputType,this.getCompressedContent()),t=o.uncompress(e);if(t.length!==a)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(i),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=n.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new a,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=n.transformTo("string",this.decompressed.getContent()),s.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=new o(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,i,o,n=e.index;for(this.extraFields=this.extraFields||{};e.index<n+this.extraFieldsLength;)t=e.readInt(2),i=e.readInt(2),o=e.readString(i),this.extraFields[t]={id:t,length:i,value:o}},handleUTF8:function(){if(this.useUTF8())this.fileName=s.utf8decode(this.fileName),this.fileComment=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new o(e.value);return 1!==t.readInt(1)||s.crc32(this.fileName)!==t.readInt(4)?null:s.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new o(e.value);return 1!==t.readInt(1)||s.crc32(this.fileComment)!==t.readInt(4)?null:s.utf8decode(t.readString(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./object":11,"./stringReader":13,"./utils":19}],22:[function(e,t,i){},{}],23:[function(e,t,i){var o=t.exports={};function n(){}o.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var i=[];return window.addEventListener("message",(function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),i.length>0&&i.shift()())}),!0),function(e){i.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=n,o.addListener=n,o.once=n,o.off=n,o.removeListener=n,o.removeAllListeners=n,o.emit=n,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],24:[function(e,t,i){var o={};(0,e("./lib/utils/common").assign)(o,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=o},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,i){var o=e("./zlib/deflate.js"),n=e("./utils/common"),a=e("./utils/strings"),s=e("./zlib/messages"),r=e("./zlib/zstream"),l=0,c=4,d=0,h=1,p=-1,u=0,f=8,m=function(e){this.options=n.assign({level:p,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var i=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==d)throw new Error(s[i]);t.header&&o.deflateSetHeader(this.strm,t.header)};function g(e,t){var i=new m(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function v(e,t){return(t=t||{}).raw=!0,g(e,t)}function y(e,t){return(t=t||{}).gzip=!0,g(e,t)}m.prototype.push=function(e,t){var i,s,r=this.strm,p=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?c:l,r.input="string"==typeof e?a.string2buf(e):e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new n.Buf8(p),r.next_out=0,r.avail_out=p),(i=o.deflate(r,s))!==h&&i!==d)return this.onEnd(i),this.ended=!0,!1;(0===r.avail_out||0===r.avail_in&&s===c)&&("string"===this.options.to?this.onData(a.buf2binstring(n.shrinkBuf(r.output,r.next_out))):this.onData(n.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&i!==h);return s!==c||(i=o.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===d)},m.prototype.onData=function(e){this.chunks.push(e)},m.prototype.onEnd=function(e){e===d&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=m,i.deflate=g,i.deflateRaw=v,i.gzip=y},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,i){var o=e("./zlib/inflate.js"),n=e("./utils/common"),a=e("./utils/strings"),s=e("./zlib/constants"),r=e("./zlib/messages"),l=e("./zlib/zstream"),c=e("./zlib/gzheader"),d=function(e){this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==s.Z_OK)throw new Error(r[i]);this.header=new c,o.inflateGetHeader(this.strm,this.header)};function h(e,t){var i=new d(t);if(i.push(e,!0),i.err)throw i.msg;return i.result}function p(e,t){return(t=t||{}).raw=!0,h(e,t)}d.prototype.push=function(e,t){var i,r,l,c,d,h=this.strm,p=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,h.input="string"==typeof e?a.binstring2buf(e):e,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new n.Buf8(p),h.next_out=0,h.avail_out=p),(i=o.inflate(h,s.Z_NO_FLUSH))!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),this.ended=!0,!1;h.next_out&&(0===h.avail_out||i===s.Z_STREAM_END||0===h.avail_in&&r===s.Z_FINISH)&&("string"===this.options.to?(l=a.utf8border(h.output,h.next_out),c=h.next_out-l,d=a.buf2string(h.output,l),h.next_out=c,h.avail_out=p-c,c&&n.arraySet(h.output,h.output,l,c,0),this.onData(d)):this.onData(n.shrinkBuf(h.output,h.next_out)))}while((h.avail_in>0||0===h.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(r=s.Z_FINISH),r!==s.Z_FINISH||(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK)},d.prototype.onData=function(e){this.chunks.push(e)},d.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=d,i.inflate=h,i.inflateRaw=p,i.ungzip=h},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,i){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)i.hasOwnProperty(o)&&(e[o]=i[o])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,o,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+o),n);else for(var a=0;a<o;a++)e[n+a]=t[i+a]},flattenChunks:function(e){var t,i,o,n,a,s;for(o=0,t=0,i=e.length;t<i;t++)o+=e[t].length;for(s=new Uint8Array(o),n=0,t=0,i=e.length;t<i;t++)a=e[t],s.set(a,n),n+=a.length;return s}},a={arraySet:function(e,t,i,o,n){for(var a=0;a<o;a++)e[n+a]=t[i+a]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(o)},{}],28:[function(e,t,i){var o=e("./common"),n=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var s=new o.Buf8(256),r=0;r<256;r++)s[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;function l(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&n))return String.fromCharCode.apply(null,o.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}s[254]=s[254]=1,i.string2buf=function(e){var t,i,n,a,s,r=e.length,l=0;for(a=0;a<r;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<r&&56320==(64512&(n=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new o.Buf8(l),s=0,a=0;s<l;a++)55296==(64512&(i=e.charCodeAt(a)))&&a+1<r&&56320==(64512&(n=e.charCodeAt(a+1)))&&(i=65536+(i-55296<<10)+(n-56320),a++),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},i.buf2binstring=function(e){return l(e,e.length)},i.binstring2buf=function(e){for(var t=new o.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,o,n,a,r=t||e.length,c=new Array(2*r);for(o=0,i=0;i<r;)if((n=e[i++])<128)c[o++]=n;else if((a=s[n])>4)c[o++]=65533,i+=a-1;else{for(n&=2===a?31:3===a?15:7;a>1&&i<r;)n=n<<6|63&e[i++],a--;a>1?c[o++]=65533:n<65536?c[o++]=n:(n-=65536,c[o++]=55296|n>>10&1023,c[o++]=56320|1023&n)}return l(c,o)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+s[e[i]]>t?i:t}},{"./common":27}],29:[function(e,t,i){function o(e,t,i,o){for(var n=65535&e|0,a=e>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{a=a+(n=n+t[o++]|0)|0}while(--s);n%=65521,a%=65521}return n|a<<16|0}t.exports=o},{}],30:[function(e,t,i){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t,i){function o(){for(var e,t=[],i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}var n=o();function a(e,t,i,o){var a=n,s=o+i;e^=-1;for(var r=o;r<s;r++)e=e>>>8^a[255&(e^t[r])];return-1^e}t.exports=a},{}],32:[function(e,t,i){var o=e("../utils/common"),n=e("./trees"),a=e("./adler32"),s=e("./crc32"),r=e("./messages"),l=0,c=1,d=3,h=4,p=5,u=0,f=1,m=-2,g=-3,v=-5,y=-1,b=1,w=2,x=3,T=4,C=0,k=2,$=8,S=9,_=15,E=8,D=256+1+29,N=30,I=19,O=2*D+1,M=15,F=3,R=258,L=R+F+1,j=32,A=42,P=69,U=73,H=91,z=103,V=113,W=666,B=1,q=2,Y=3,X=4,G=3;function J(e,t){return e.msg=r[t],t}function K(e){return(e<<1)-(e>4?9:0)}function Q(e){for(var t=e.length;--t>=0;)e[t]=0}function Z(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(o.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function ee(e,t){n._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Z(e.strm)}function te(e,t){e.pending_buf[e.pending++]=t}function ie(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function oe(e,t,i,n){var r=e.avail_in;return r>n&&(r=n),0===r?0:(e.avail_in-=r,o.arraySet(t,e.input,e.next_in,r,i),1===e.state.wrap?e.adler=a(e.adler,t,r,i):2===e.state.wrap&&(e.adler=s(e.adler,t,r,i)),e.next_in+=r,e.total_in+=r,r)}function ne(e,t){var i,o,n=e.max_chain_length,a=e.strstart,s=e.prev_length,r=e.nice_match,l=e.strstart>e.w_size-L?e.strstart-(e.w_size-L):0,c=e.window,d=e.w_mask,h=e.prev,p=e.strstart+R,u=c[a+s-1],f=c[a+s];e.prev_length>=e.good_match&&(n>>=2),r>e.lookahead&&(r=e.lookahead);do{if(c[(i=t)+s]===f&&c[i+s-1]===u&&c[i]===c[a]&&c[++i]===c[a+1]){a+=2,i++;do{}while(c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&c[++a]===c[++i]&&a<p);if(o=R-(p-a),a=p-R,o>s){if(e.match_start=t,s=o,o>=r)break;u=c[a+s-1],f=c[a+s]}}}while((t=h[t&d])>l&&0!=--n);return s<=e.lookahead?s:e.lookahead}function ae(e){var t,i,n,a,s,r=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-L)){o.arraySet(e.window,e.window,r,r,0),e.match_start-=r,e.strstart-=r,e.block_start-=r,t=i=e.hash_size;do{n=e.head[--t],e.head[t]=n>=r?n-r:0}while(--i);t=i=r;do{n=e.prev[--t],e.prev[t]=n>=r?n-r:0}while(--i);a+=r}if(0===e.strm.avail_in)break;if(i=oe(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=i,e.lookahead+e.insert>=F)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+F-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<F)););}while(e.lookahead<L&&0!==e.strm.avail_in)}function se(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===l)return B;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+i;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,ee(e,!1),0===e.strm.avail_out))return B;if(e.strstart-e.block_start>=e.w_size-L&&(ee(e,!1),0===e.strm.avail_out))return B}return e.insert=0,t===h?(ee(e,!0),0===e.strm.avail_out?Y:X):(e.strstart>e.block_start&&(ee(e,!1),e.strm.avail_out),B)}function re(e,t){for(var i,o;;){if(e.lookahead<L){if(ae(e),e.lookahead<L&&t===l)return B;if(0===e.lookahead)break}if(i=0,e.lookahead>=F&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-L&&(e.match_length=ne(e,i)),e.match_length>=F)if(o=n._tr_tally(e,e.strstart-e.match_start,e.match_length-F),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=F){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(ee(e,!1),0===e.strm.avail_out))return B}return e.insert=e.strstart<F-1?e.strstart:F-1,t===h?(ee(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?B:q}function le(e,t){for(var i,o,a;;){if(e.lookahead<L){if(ae(e),e.lookahead<L&&t===l)return B;if(0===e.lookahead)break}if(i=0,e.lookahead>=F&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=F-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-L&&(e.match_length=ne(e,i),e.match_length<=5&&(e.strategy===b||e.match_length===F&&e.strstart-e.match_start>4096)&&(e.match_length=F-1)),e.prev_length>=F&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-F,o=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-F),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+F-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=F-1,e.strstart++,o&&(ee(e,!1),0===e.strm.avail_out))return B}else if(e.match_available){if((o=n._tr_tally(e,0,e.window[e.strstart-1]))&&ee(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return B}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<F-1?e.strstart:F-1,t===h?(ee(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?B:q}function ce(e,t){for(var i,o,a,s,r=e.window;;){if(e.lookahead<=R){if(ae(e),e.lookahead<=R&&t===l)return B;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=F&&e.strstart>0&&(o=r[a=e.strstart-1])===r[++a]&&o===r[++a]&&o===r[++a]){s=e.strstart+R;do{}while(o===r[++a]&&o===r[++a]&&o===r[++a]&&o===r[++a]&&o===r[++a]&&o===r[++a]&&o===r[++a]&&o===r[++a]&&a<s);e.match_length=R-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=F?(i=n._tr_tally(e,1,e.match_length-F),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(ee(e,!1),0===e.strm.avail_out))return B}return e.insert=0,t===h?(ee(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?B:q}function de(e,t){for(var i;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===l)return B;break}if(e.match_length=0,i=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(ee(e,!1),0===e.strm.avail_out))return B}return e.insert=0,t===h?(ee(e,!0),0===e.strm.avail_out?Y:X):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?B:q}var he,pe=function(e,t,i,o,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=o,this.func=n};function ue(e){e.window_size=2*e.w_size,Q(e.head),e.max_lazy_match=he[e.level].max_lazy,e.good_match=he[e.level].good_length,e.nice_match=he[e.level].nice_length,e.max_chain_length=he[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=F-1,e.match_available=0,e.ins_h=0}function fe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*O),this.dyn_dtree=new o.Buf16(2*(2*N+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(M+1),this.heap=new o.Buf16(2*D+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*D+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function me(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=k,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?A:V,e.adler=2===t.wrap?0:1,t.last_flush=l,n._tr_init(t),u):J(e,m)}function ge(e){var t=me(e);return t===u&&ue(e.state),t}function ve(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,u):m}function ye(e,t,i,n,a,s){if(!e)return m;var r=1;if(t===y&&(t=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),a<1||a>S||i!==$||n<8||n>15||t<0||t>9||s<0||s>T)return J(e,m);8===n&&(n=9);var l=new fe;return e.state=l,l.strm=e,l.wrap=r,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+F-1)/F),l.window=new o.Buf8(2*l.w_size),l.head=new o.Buf16(l.hash_size),l.prev=new o.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new o.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=i,ge(e)}function be(e,t){return ye(e,t,$,_,E,C)}function we(e,t){var i,o,a,r;if(!e||!e.state||t>p||t<0)return e?J(e,m):m;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===W&&t!==h)return J(e,0===e.avail_out?v:m);if(o.strm=e,i=o.last_flush,o.last_flush=t,o.status===A)if(2===o.wrap)e.adler=0,te(o,31),te(o,139),te(o,8),o.gzhead?(te(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),te(o,255&o.gzhead.time),te(o,o.gzhead.time>>8&255),te(o,o.gzhead.time>>16&255),te(o,o.gzhead.time>>24&255),te(o,9===o.level?2:o.strategy>=w||o.level<2?4:0),te(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(te(o,255&o.gzhead.extra.length),te(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=s(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=P):(te(o,0),te(o,0),te(o,0),te(o,0),te(o,0),te(o,9===o.level?2:o.strategy>=w||o.level<2?4:0),te(o,G),o.status=V);else{var g=$+(o.w_bits-8<<4)<<8;g|=(o.strategy>=w||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(g|=j),g+=31-g%31,o.status=V,ie(o,g),0!==o.strstart&&(ie(o,e.adler>>>16),ie(o,65535&e.adler)),e.adler=1}if(o.status===P)if(o.gzhead.extra){for(a=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),Z(e),a=o.pending,o.pending!==o.pending_buf_size));)te(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=U)}else o.status=U;if(o.status===U)if(o.gzhead.name){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),Z(e),a=o.pending,o.pending===o.pending_buf_size)){r=1;break}r=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,te(o,r)}while(0!==r);o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),0===r&&(o.gzindex=0,o.status=H)}else o.status=H;if(o.status===H)if(o.gzhead.comment){a=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),Z(e),a=o.pending,o.pending===o.pending_buf_size)){r=1;break}r=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,te(o,r)}while(0!==r);o.gzhead.hcrc&&o.pending>a&&(e.adler=s(e.adler,o.pending_buf,o.pending-a,a)),0===r&&(o.status=z)}else o.status=z;if(o.status===z&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&Z(e),o.pending+2<=o.pending_buf_size&&(te(o,255&e.adler),te(o,e.adler>>8&255),e.adler=0,o.status=V)):o.status=V),0!==o.pending){if(Z(e),0===e.avail_out)return o.last_flush=-1,u}else if(0===e.avail_in&&K(t)<=K(i)&&t!==h)return J(e,v);if(o.status===W&&0!==e.avail_in)return J(e,v);if(0!==e.avail_in||0!==o.lookahead||t!==l&&o.status!==W){var y=o.strategy===w?de(o,t):o.strategy===x?ce(o,t):he[o.level].func(o,t);if(y!==Y&&y!==X||(o.status=W),y===B||y===Y)return 0===e.avail_out&&(o.last_flush=-1),u;if(y===q&&(t===c?n._tr_align(o):t!==p&&(n._tr_stored_block(o,0,0,!1),t===d&&(Q(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),Z(e),0===e.avail_out))return o.last_flush=-1,u}return t!==h?u:o.wrap<=0?f:(2===o.wrap?(te(o,255&e.adler),te(o,e.adler>>8&255),te(o,e.adler>>16&255),te(o,e.adler>>24&255),te(o,255&e.total_in),te(o,e.total_in>>8&255),te(o,e.total_in>>16&255),te(o,e.total_in>>24&255)):(ie(o,e.adler>>>16),ie(o,65535&e.adler)),Z(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?u:f)}function xe(e){var t;return e&&e.state?(t=e.state.status)!==A&&t!==P&&t!==U&&t!==H&&t!==z&&t!==V&&t!==W?J(e,m):(e.state=null,t===V?J(e,g):u):m}he=[new pe(0,0,0,0,se),new pe(4,4,8,4,re),new pe(4,5,16,8,re),new pe(4,6,32,32,re),new pe(4,4,16,16,le),new pe(8,16,32,32,le),new pe(8,16,128,128,le),new pe(8,32,128,256,le),new pe(32,128,258,1024,le),new pe(32,258,258,4096,le)],i.deflateInit=be,i.deflateInit2=ye,i.deflateReset=ge,i.deflateResetKeep=me,i.deflateSetHeader=ve,i.deflate=we,i.deflateEnd=xe,i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t,i){function o(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=o},{}],34:[function(e,t,i){var o=30,n=12;t.exports=function(e,t){var i,a,s,r,l,c,d,h,p,u,f,m,g,v,y,b,w,x,T,C,k,$,S,_,E;i=e.state,a=e.next_in,_=e.input,s=a+(e.avail_in-5),r=e.next_out,E=e.output,l=r-(t-e.avail_out),c=r+(e.avail_out-257),d=i.dmax,h=i.wsize,p=i.whave,u=i.wnext,f=i.window,m=i.hold,g=i.bits,v=i.lencode,y=i.distcode,b=(1<<i.lenbits)-1,w=(1<<i.distbits)-1;e:do{g<15&&(m+=_[a++]<<g,g+=8,m+=_[a++]<<g,g+=8),x=v[m&b];t:for(;;){if(m>>>=T=x>>>24,g-=T,0===(T=x>>>16&255))E[r++]=65535&x;else{if(!(16&T)){if(0==(64&T)){x=v[(65535&x)+(m&(1<<T)-1)];continue t}if(32&T){i.mode=n;break e}e.msg="invalid literal/length code",i.mode=o;break e}C=65535&x,(T&=15)&&(g<T&&(m+=_[a++]<<g,g+=8),C+=m&(1<<T)-1,m>>>=T,g-=T),g<15&&(m+=_[a++]<<g,g+=8,m+=_[a++]<<g,g+=8),x=y[m&w];i:for(;;){if(m>>>=T=x>>>24,g-=T,!(16&(T=x>>>16&255))){if(0==(64&T)){x=y[(65535&x)+(m&(1<<T)-1)];continue i}e.msg="invalid distance code",i.mode=o;break e}if(k=65535&x,g<(T&=15)&&(m+=_[a++]<<g,(g+=8)<T&&(m+=_[a++]<<g,g+=8)),(k+=m&(1<<T)-1)>d){e.msg="invalid distance too far back",i.mode=o;break e}if(m>>>=T,g-=T,k>(T=r-l)){if((T=k-T)>p&&i.sane){e.msg="invalid distance too far back",i.mode=o;break e}if($=0,S=f,0===u){if($+=h-T,T<C){C-=T;do{E[r++]=f[$++]}while(--T);$=r-k,S=E}}else if(u<T){if($+=h+u-T,(T-=u)<C){C-=T;do{E[r++]=f[$++]}while(--T);if($=0,u<C){C-=T=u;do{E[r++]=f[$++]}while(--T);$=r-k,S=E}}}else if($+=u-T,T<C){C-=T;do{E[r++]=f[$++]}while(--T);$=r-k,S=E}for(;C>2;)E[r++]=S[$++],E[r++]=S[$++],E[r++]=S[$++],C-=3;C&&(E[r++]=S[$++],C>1&&(E[r++]=S[$++]))}else{$=r-k;do{E[r++]=E[$++],E[r++]=E[$++],E[r++]=E[$++],C-=3}while(C>2);C&&(E[r++]=E[$++],C>1&&(E[r++]=E[$++]))}break}}break}}while(a<s&&r<c);a-=C=g>>3,m&=(1<<(g-=C<<3))-1,e.next_in=a,e.next_out=r,e.avail_in=a<s?s-a+5:5-(a-s),e.avail_out=r<c?c-r+257:257-(r-c),i.hold=m,i.bits=g}},{}],35:[function(e,t,i){var o=e("../utils/common"),n=e("./adler32"),a=e("./crc32"),s=e("./inffast"),r=e("./inftrees"),l=0,c=1,d=2,h=4,p=5,u=6,f=0,m=1,g=2,v=-2,y=-3,b=-4,w=-5,x=8,T=1,C=2,k=3,$=4,S=5,_=6,E=7,D=8,N=9,I=10,O=11,M=12,F=13,R=14,L=15,j=16,A=17,P=18,U=19,H=20,z=21,V=22,W=23,B=24,q=25,Y=26,X=27,G=28,J=29,K=30,Q=31,Z=32,ee=852,te=592,ie=15;function oe(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ne(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ae(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=T,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new o.Buf32(ee),t.distcode=t.distdyn=new o.Buf32(te),t.sane=1,t.back=-1,f):v}function se(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ae(e)):v}function re(e,t){var i,o;return e&&e.state?(o=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?v:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=i,o.wbits=t,se(e))):v}function le(e,t){var i,o;return e?(o=new ne,e.state=o,o.window=null,(i=re(e,t))!==f&&(e.state=null),i):v}function ce(e){return le(e,ie)}var de,he,pe=!0;function ue(e){if(pe){var t;for(de=new o.Buf32(512),he=new o.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(r(c,e.lens,0,288,de,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;r(d,e.lens,0,32,he,0,e.work,{bits:5}),pe=!1}e.lencode=de,e.lenbits=9,e.distcode=he,e.distbits=5}function fe(e,t,i,n){var a,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new o.Buf8(s.wsize)),n>=s.wsize?(o.arraySet(s.window,t,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((a=s.wsize-s.wnext)>n&&(a=n),o.arraySet(s.window,t,i-n,a,s.wnext),(n-=a)?(o.arraySet(s.window,t,i-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0}function me(e,t){var i,ee,te,ie,ne,ae,se,re,le,ce,de,he,pe,me,ge,ve,ye,be,we,xe,Te,Ce,ke,$e,Se=0,_e=new o.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return v;(i=e.state).mode===M&&(i.mode=F),ne=e.next_out,te=e.output,se=e.avail_out,ie=e.next_in,ee=e.input,ae=e.avail_in,re=i.hold,le=i.bits,ce=ae,de=se,Ce=f;e:for(;;)switch(i.mode){case T:if(0===i.wrap){i.mode=F;break}for(;le<16;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(2&i.wrap&&35615===re){i.check=0,_e[0]=255&re,_e[1]=re>>>8&255,i.check=a(i.check,_e,2,0),re=0,le=0,i.mode=C;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&re)<<8)+(re>>8))%31){e.msg="incorrect header check",i.mode=K;break}if((15&re)!==x){e.msg="unknown compression method",i.mode=K;break}if(le-=4,Te=8+(15&(re>>>=4)),0===i.wbits)i.wbits=Te;else if(Te>i.wbits){e.msg="invalid window size",i.mode=K;break}i.dmax=1<<Te,e.adler=i.check=1,i.mode=512&re?I:M,re=0,le=0;break;case C:for(;le<16;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(i.flags=re,(255&i.flags)!==x){e.msg="unknown compression method",i.mode=K;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=K;break}i.head&&(i.head.text=re>>8&1),512&i.flags&&(_e[0]=255&re,_e[1]=re>>>8&255,i.check=a(i.check,_e,2,0)),re=0,le=0,i.mode=k;case k:for(;le<32;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}i.head&&(i.head.time=re),512&i.flags&&(_e[0]=255&re,_e[1]=re>>>8&255,_e[2]=re>>>16&255,_e[3]=re>>>24&255,i.check=a(i.check,_e,4,0)),re=0,le=0,i.mode=$;case $:for(;le<16;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}i.head&&(i.head.xflags=255&re,i.head.os=re>>8),512&i.flags&&(_e[0]=255&re,_e[1]=re>>>8&255,i.check=a(i.check,_e,2,0)),re=0,le=0,i.mode=S;case S:if(1024&i.flags){for(;le<16;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}i.length=re,i.head&&(i.head.extra_len=re),512&i.flags&&(_e[0]=255&re,_e[1]=re>>>8&255,i.check=a(i.check,_e,2,0)),re=0,le=0}else i.head&&(i.head.extra=null);i.mode=_;case _:if(1024&i.flags&&((he=i.length)>ae&&(he=ae),he&&(i.head&&(Te=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),o.arraySet(i.head.extra,ee,ie,he,Te)),512&i.flags&&(i.check=a(i.check,ee,he,ie)),ae-=he,ie+=he,i.length-=he),i.length))break e;i.length=0,i.mode=E;case E:if(2048&i.flags){if(0===ae)break e;he=0;do{Te=ee[ie+he++],i.head&&Te&&i.length<65536&&(i.head.name+=String.fromCharCode(Te))}while(Te&&he<ae);if(512&i.flags&&(i.check=a(i.check,ee,he,ie)),ae-=he,ie+=he,Te)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=D;case D:if(4096&i.flags){if(0===ae)break e;he=0;do{Te=ee[ie+he++],i.head&&Te&&i.length<65536&&(i.head.comment+=String.fromCharCode(Te))}while(Te&&he<ae);if(512&i.flags&&(i.check=a(i.check,ee,he,ie)),ae-=he,ie+=he,Te)break e}else i.head&&(i.head.comment=null);i.mode=N;case N:if(512&i.flags){for(;le<16;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(re!==(65535&i.check)){e.msg="header crc mismatch",i.mode=K;break}re=0,le=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=M;break;case I:for(;le<32;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}e.adler=i.check=oe(re),re=0,le=0,i.mode=O;case O:if(0===i.havedict)return e.next_out=ne,e.avail_out=se,e.next_in=ie,e.avail_in=ae,i.hold=re,i.bits=le,g;e.adler=i.check=1,i.mode=M;case M:if(t===p||t===u)break e;case F:if(i.last){re>>>=7&le,le-=7&le,i.mode=X;break}for(;le<3;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}switch(i.last=1&re,le-=1,3&(re>>>=1)){case 0:i.mode=R;break;case 1:if(ue(i),i.mode=H,t===u){re>>>=2,le-=2;break e}break;case 2:i.mode=A;break;case 3:e.msg="invalid block type",i.mode=K}re>>>=2,le-=2;break;case R:for(re>>>=7&le,le-=7&le;le<32;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if((65535&re)!=(re>>>16^65535)){e.msg="invalid stored block lengths",i.mode=K;break}if(i.length=65535&re,re=0,le=0,i.mode=L,t===u)break e;case L:i.mode=j;case j:if(he=i.length){if(he>ae&&(he=ae),he>se&&(he=se),0===he)break e;o.arraySet(te,ee,ie,he,ne),ae-=he,ie+=he,se-=he,ne+=he,i.length-=he;break}i.mode=M;break;case A:for(;le<14;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(i.nlen=257+(31&re),re>>>=5,le-=5,i.ndist=1+(31&re),re>>>=5,le-=5,i.ncode=4+(15&re),re>>>=4,le-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=K;break}i.have=0,i.mode=P;case P:for(;i.have<i.ncode;){for(;le<3;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}i.lens[Ee[i.have++]]=7&re,re>>>=3,le-=3}for(;i.have<19;)i.lens[Ee[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ke={bits:i.lenbits},Ce=r(l,i.lens,0,19,i.lencode,0,i.work,ke),i.lenbits=ke.bits,Ce){e.msg="invalid code lengths set",i.mode=K;break}i.have=0,i.mode=U;case U:for(;i.have<i.nlen+i.ndist;){for(;ve=(Se=i.lencode[re&(1<<i.lenbits)-1])>>>16&255,ye=65535&Se,!((ge=Se>>>24)<=le);){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(ye<16)re>>>=ge,le-=ge,i.lens[i.have++]=ye;else{if(16===ye){for($e=ge+2;le<$e;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(re>>>=ge,le-=ge,0===i.have){e.msg="invalid bit length repeat",i.mode=K;break}Te=i.lens[i.have-1],he=3+(3&re),re>>>=2,le-=2}else if(17===ye){for($e=ge+3;le<$e;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}le-=ge,Te=0,he=3+(7&(re>>>=ge)),re>>>=3,le-=3}else{for($e=ge+7;le<$e;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}le-=ge,Te=0,he=11+(127&(re>>>=ge)),re>>>=7,le-=7}if(i.have+he>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=K;break}for(;he--;)i.lens[i.have++]=Te}}if(i.mode===K)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=K;break}if(i.lenbits=9,ke={bits:i.lenbits},Ce=r(c,i.lens,0,i.nlen,i.lencode,0,i.work,ke),i.lenbits=ke.bits,Ce){e.msg="invalid literal/lengths set",i.mode=K;break}if(i.distbits=6,i.distcode=i.distdyn,ke={bits:i.distbits},Ce=r(d,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ke),i.distbits=ke.bits,Ce){e.msg="invalid distances set",i.mode=K;break}if(i.mode=H,t===u)break e;case H:i.mode=z;case z:if(ae>=6&&se>=258){e.next_out=ne,e.avail_out=se,e.next_in=ie,e.avail_in=ae,i.hold=re,i.bits=le,s(e,de),ne=e.next_out,te=e.output,se=e.avail_out,ie=e.next_in,ee=e.input,ae=e.avail_in,re=i.hold,le=i.bits,i.mode===M&&(i.back=-1);break}for(i.back=0;ve=(Se=i.lencode[re&(1<<i.lenbits)-1])>>>16&255,ye=65535&Se,!((ge=Se>>>24)<=le);){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(ve&&0==(240&ve)){for(be=ge,we=ve,xe=ye;ve=(Se=i.lencode[xe+((re&(1<<be+we)-1)>>be)])>>>16&255,ye=65535&Se,!(be+(ge=Se>>>24)<=le);){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}re>>>=be,le-=be,i.back+=be}if(re>>>=ge,le-=ge,i.back+=ge,i.length=ye,0===ve){i.mode=Y;break}if(32&ve){i.back=-1,i.mode=M;break}if(64&ve){e.msg="invalid literal/length code",i.mode=K;break}i.extra=15&ve,i.mode=V;case V:if(i.extra){for($e=i.extra;le<$e;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}i.length+=re&(1<<i.extra)-1,re>>>=i.extra,le-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=W;case W:for(;ve=(Se=i.distcode[re&(1<<i.distbits)-1])>>>16&255,ye=65535&Se,!((ge=Se>>>24)<=le);){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(0==(240&ve)){for(be=ge,we=ve,xe=ye;ve=(Se=i.distcode[xe+((re&(1<<be+we)-1)>>be)])>>>16&255,ye=65535&Se,!(be+(ge=Se>>>24)<=le);){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}re>>>=be,le-=be,i.back+=be}if(re>>>=ge,le-=ge,i.back+=ge,64&ve){e.msg="invalid distance code",i.mode=K;break}i.offset=ye,i.extra=15&ve,i.mode=B;case B:if(i.extra){for($e=i.extra;le<$e;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}i.offset+=re&(1<<i.extra)-1,re>>>=i.extra,le-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=K;break}i.mode=q;case q:if(0===se)break e;if(he=de-se,i.offset>he){if((he=i.offset-he)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=K;break}he>i.wnext?(he-=i.wnext,pe=i.wsize-he):pe=i.wnext-he,he>i.length&&(he=i.length),me=i.window}else me=te,pe=ne-i.offset,he=i.length;he>se&&(he=se),se-=he,i.length-=he;do{te[ne++]=me[pe++]}while(--he);0===i.length&&(i.mode=z);break;case Y:if(0===se)break e;te[ne++]=i.length,se--,i.mode=z;break;case X:if(i.wrap){for(;le<32;){if(0===ae)break e;ae--,re|=ee[ie++]<<le,le+=8}if(de-=se,e.total_out+=de,i.total+=de,de&&(e.adler=i.check=i.flags?a(i.check,te,de,ne-de):n(i.check,te,de,ne-de)),de=se,(i.flags?re:oe(re))!==i.check){e.msg="incorrect data check",i.mode=K;break}re=0,le=0}i.mode=G;case G:if(i.wrap&&i.flags){for(;le<32;){if(0===ae)break e;ae--,re+=ee[ie++]<<le,le+=8}if(re!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=K;break}re=0,le=0}i.mode=J;case J:Ce=m;break e;case K:Ce=y;break e;case Q:return b;case Z:default:return v}return e.next_out=ne,e.avail_out=se,e.next_in=ie,e.avail_in=ae,i.hold=re,i.bits=le,(i.wsize||de!==e.avail_out&&i.mode<K&&(i.mode<X||t!==h))&&fe(e,e.output,e.next_out,de-e.avail_out)?(i.mode=Q,b):(ce-=e.avail_in,de-=e.avail_out,e.total_in+=ce,e.total_out+=de,i.total+=de,i.wrap&&de&&(e.adler=i.check=i.flags?a(i.check,te,de,e.next_out-de):n(i.check,te,de,e.next_out-de)),e.data_type=i.bits+(i.last?64:0)+(i.mode===M?128:0)+(i.mode===H||i.mode===L?256:0),(0===ce&&0===de||t===h)&&Ce===f&&(Ce=w),Ce)}function ge(e){if(!e||!e.state)return v;var t=e.state;return t.window&&(t.window=null),e.state=null,f}function ve(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?v:(i.head=t,t.done=!1,f):v}i.inflateReset=se,i.inflateReset2=re,i.inflateResetKeep=ae,i.inflateInit=ce,i.inflateInit2=le,i.inflate=me,i.inflateEnd=ge,i.inflateGetHeader=ve,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t,i){var o=e("../utils/common"),n=15,a=852,s=592,r=0,l=1,c=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],p=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,f,m,g,v,y){var b,w,x,T,C,k,$,S,_,E=y.bits,D=0,N=0,I=0,O=0,M=0,F=0,R=0,L=0,j=0,A=0,P=null,U=0,H=new o.Buf16(n+1),z=new o.Buf16(n+1),V=null,W=0;for(D=0;D<=n;D++)H[D]=0;for(N=0;N<f;N++)H[t[i+N]]++;for(M=E,O=n;O>=1&&0===H[O];O--);if(M>O&&(M=O),0===O)return m[g++]=20971520,m[g++]=20971520,y.bits=1,0;for(I=1;I<O&&0===H[I];I++);for(M<I&&(M=I),L=1,D=1;D<=n;D++)if(L<<=1,(L-=H[D])<0)return-1;if(L>0&&(e===r||1!==O))return-1;for(z[1]=0,D=1;D<n;D++)z[D+1]=z[D]+H[D];for(N=0;N<f;N++)0!==t[i+N]&&(v[z[t[i+N]]++]=N);switch(e){case r:P=V=v,k=19;break;case l:P=d,U-=257,V=h,W-=257,k=256;break;default:P=p,V=u,k=-1}if(A=0,N=0,D=I,C=g,F=M,R=0,x=-1,T=(j=1<<M)-1,e===l&&j>a||e===c&&j>s)return 1;for(;;){$=D-R,v[N]<k?(S=0,_=v[N]):v[N]>k?(S=V[W+v[N]],_=P[U+v[N]]):(S=96,_=0),b=1<<D-R,I=w=1<<F;do{m[C+(A>>R)+(w-=b)]=$<<24|S<<16|_|0}while(0!==w);for(b=1<<D-1;A&b;)b>>=1;if(0!==b?(A&=b-1,A+=b):A=0,N++,0==--H[D]){if(D===O)break;D=t[i+v[N]]}if(D>M&&(A&T)!==x){for(0===R&&(R=M),C+=I,L=1<<(F=D-R);F+R<O&&!((L-=H[F+R])<=0);)F++,L<<=1;if(j+=1<<F,e===l&&j>a||e===c&&j>s)return 1;m[x=A&T]=M<<24|F<<16|C-g|0}}return 0!==A&&(m[C+A]=D-R<<24|64<<16|0),y.bits=M,0}},{"../utils/common":27}],37:[function(e,t,i){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,i){var o=e("../utils/common"),n=4,a=0,s=1,r=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var c=0,d=1,h=2,p=3,u=258,f=29,m=256,g=m+1+f,v=30,y=19,b=2*g+1,w=15,x=16,T=7,C=256,k=16,$=17,S=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],D=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=512,O=new Array(2*(g+2));l(O);var M=new Array(2*v);l(M);var F=new Array(I);l(F);var R=new Array(u-p+1);l(R);var L=new Array(f);l(L);var j=new Array(v);l(j);var A,P,U,H=function(e,t,i,o,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=o,this.max_length=n,this.has_stree=e&&e.length},z=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t};function V(e){return e<256?F[e]:F[256+(e>>>7)]}function W(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function B(e,t,i){e.bi_valid>x-i?(e.bi_buf|=t<<e.bi_valid&65535,W(e,e.bi_buf),e.bi_buf=t>>x-e.bi_valid,e.bi_valid+=i-x):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function q(e,t,i){B(e,i[2*t],i[2*t+1])}function Y(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function X(e){16===e.bi_valid?(W(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function G(e,t){var i,o,n,a,s,r,l=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,h=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,u=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(a=0;a<=w;a++)e.bl_count[a]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<b;i++)(a=l[2*l[2*(o=e.heap[i])+1]+1]+1)>f&&(a=f,m++),l[2*o+1]=a,o>c||(e.bl_count[a]++,s=0,o>=u&&(s=p[o-u]),r=l[2*o],e.opt_len+=r*(a+s),h&&(e.static_len+=r*(d[2*o+1]+s)));if(0!==m){do{for(a=f-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(a=f;0!==a;a--)for(o=e.bl_count[a];0!==o;)(n=e.heap[--i])>c||(l[2*n+1]!==a&&(e.opt_len+=(a-l[2*n+1])*l[2*n],l[2*n+1]=a),o--)}}function J(e,t,i){var o,n,a=new Array(w+1),s=0;for(o=1;o<=w;o++)a[o]=s=s+i[o-1]<<1;for(n=0;n<=t;n++){var r=e[2*n+1];0!==r&&(e[2*n]=Y(a[r]++,r))}}function K(){var e,t,i,o,n,a=new Array(w+1);for(i=0,o=0;o<f-1;o++)for(L[o]=i,e=0;e<1<<_[o];e++)R[i++]=o;for(R[i-1]=o,n=0,o=0;o<16;o++)for(j[o]=n,e=0;e<1<<E[o];e++)F[n++]=o;for(n>>=7;o<v;o++)for(j[o]=n<<7,e=0;e<1<<E[o]-7;e++)F[256+n++]=o;for(t=0;t<=w;t++)a[t]=0;for(e=0;e<=143;)O[2*e+1]=8,e++,a[8]++;for(;e<=255;)O[2*e+1]=9,e++,a[9]++;for(;e<=279;)O[2*e+1]=7,e++,a[7]++;for(;e<=287;)O[2*e+1]=8,e++,a[8]++;for(J(O,g+1,a),e=0;e<v;e++)M[2*e+1]=5,M[2*e]=Y(e,5);A=new H(O,_,m+1,g,w),P=new H(M,E,0,v,w),U=new H(new Array(0),D,0,y,T)}function Q(e){var t;for(t=0;t<g;t++)e.dyn_ltree[2*t]=0;for(t=0;t<v;t++)e.dyn_dtree[2*t]=0;for(t=0;t<y;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*C]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?W(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ee(e,t,i,n){Z(e),n&&(W(e,i),W(e,~i)),o.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}function te(e,t,i,o){var n=2*t,a=2*i;return e[n]<e[a]||e[n]===e[a]&&o[t]<=o[i]}function ie(e,t,i){for(var o=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&te(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!te(t,o,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=o}function oe(e,t,i){var o,n,a,s,r=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],n=e.pending_buf[e.l_buf+r],r++,0===o?q(e,n,t):(q(e,(a=R[n])+m+1,t),0!==(s=_[a])&&B(e,n-=L[a],s),q(e,a=V(--o),i),0!==(s=E[a])&&B(e,o-=j[a],s))}while(r<e.last_lit);q(e,C,t)}function ne(e,t){var i,o,n,a=t.dyn_tree,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,l=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=b,i=0;i<l;i++)0!==a[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):a[2*i+1]=0;for(;e.heap_len<2;)a[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,r&&(e.static_len-=s[2*n+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)ie(e,a,i);n=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ie(e,a,1),o=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=o,a[2*n]=a[2*i]+a[2*o],e.depth[n]=(e.depth[i]>=e.depth[o]?e.depth[i]:e.depth[o])+1,a[2*i+1]=a[2*o+1]=n,e.heap[1]=n++,ie(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],G(e,t),J(a,c,e.bl_count)}function ae(e,t,i){var o,n,a=-1,s=t[1],r=0,l=7,c=4;for(0===s&&(l=138,c=3),t[2*(i+1)+1]=65535,o=0;o<=i;o++)n=s,s=t[2*(o+1)+1],++r<l&&n===s||(r<c?e.bl_tree[2*n]+=r:0!==n?(n!==a&&e.bl_tree[2*n]++,e.bl_tree[2*k]++):r<=10?e.bl_tree[2*$]++:e.bl_tree[2*S]++,r=0,a=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4))}function se(e,t,i){var o,n,a=-1,s=t[1],r=0,l=7,c=4;for(0===s&&(l=138,c=3),o=0;o<=i;o++)if(n=s,s=t[2*(o+1)+1],!(++r<l&&n===s)){if(r<c)do{q(e,n,e.bl_tree)}while(0!=--r);else 0!==n?(n!==a&&(q(e,n,e.bl_tree),r--),q(e,k,e.bl_tree),B(e,r-3,2)):r<=10?(q(e,$,e.bl_tree),B(e,r-3,3)):(q(e,S,e.bl_tree),B(e,r-11,7));r=0,a=n,0===s?(l=138,c=3):n===s?(l=6,c=3):(l=7,c=4)}}function re(e){var t;for(ae(e,e.dyn_ltree,e.l_desc.max_code),ae(e,e.dyn_dtree,e.d_desc.max_code),ne(e,e.bl_desc),t=y-1;t>=3&&0===e.bl_tree[2*N[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function le(e,t,i,o){var n;for(B(e,t-257,5),B(e,i-1,5),B(e,o-4,4),n=0;n<o;n++)B(e,e.bl_tree[2*N[n]+1],3);se(e,e.dyn_ltree,t-1),se(e,e.dyn_dtree,i-1)}function ce(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return a;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return s;for(t=32;t<m;t++)if(0!==e.dyn_ltree[2*t])return s;return a}var de=!1;function he(e){de||(K(),de=!0),e.l_desc=new z(e.dyn_ltree,A),e.d_desc=new z(e.dyn_dtree,P),e.bl_desc=new z(e.bl_tree,U),e.bi_buf=0,e.bi_valid=0,Q(e)}function pe(e,t,i,o){B(e,(c<<1)+(o?1:0),3),ee(e,t,i,!0)}function ue(e){B(e,d<<1,3),q(e,C,O),X(e)}function fe(e,t,i,o){var a,s,l=0;e.level>0?(e.strm.data_type===r&&(e.strm.data_type=ce(e)),ne(e,e.l_desc),ne(e,e.d_desc),l=re(e),a=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=a&&(a=s)):a=s=i+5,i+4<=a&&-1!==t?pe(e,t,i,o):e.strategy===n||s===a?(B(e,(d<<1)+(o?1:0),3),oe(e,O,M)):(B(e,(h<<1)+(o?1:0),3),le(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),oe(e,e.dyn_ltree,e.dyn_dtree)),Q(e),o&&Z(e)}function me(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(R[i]+m+1)]++,e.dyn_dtree[2*V(t)]++),e.last_lit===e.lit_bufsize-1}i._tr_init=he,i._tr_stored_block=pe,i._tr_flush_block=fe,i._tr_tally=me,i._tr_align=ue},{"../utils/common":27}],39:[function(e,t,i){function o(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=o},{}]},{},[9])(9)}))}).call(this,i("./node_modules/webpack/buildin/harmony-module.js")(e),i("./node_modules/webpack/buildin/global.js"))},"./src/lib/jqueryui/ui-lightness/jquery-ui-1.10.4.custom.min.css":function(e,t,i){},"./src/react/LightboxComponent.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var o=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),n=i("./node_modules/@zhyabs1314/react-image-lightbox/dist/main.js"),a=i.n(n),s=i("./node_modules/react/index.js"),r=(i("./src/react/LightboxComponent.css"),i("./src/react/util/FastClickContainer.tsx"));class l extends s.Component{constructor(e){super(e),this.state={photoIndex:this.props.initialImageIndex,className:"LightboxComponent_initial"}}render(){const e=this.state.photoIndex;let t,i;return this.props.images.length>1&&(t=this.props.images[(e+1)%this.props.images.length].file,i=this.props.images[(e+this.props.images.length-1)%this.props.images.length].file),s.createElement(a.a,{wrapperClassName:this.state.className,onImageLoad:()=>this.setState({className:void 0}),mainSrc:this.props.images[e].file,nextSrc:t,prevSrc:i,imageTitle:this.props.images[e].name,onCloseRequest:this.props.closeLightBox,toolbarButtons:[s.createElement(r.a,{key:e,className:"lightbox-download",onFastClick:()=>this.props.downloadUrl(this.props.images[e])},Object(o.getLocale)().download)],onMovePrevRequest:()=>this.setState({photoIndex:(e+this.props.images.length-1)%this.props.images.length}),onMoveNextRequest:()=>this.setState({photoIndex:(e+1)%this.props.images.length})})}}},"./src/react/PdfRenderer.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),n=i.n(o),a=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),s=i("./node_modules/react/index.js"),r=i("./node_modules/react-pdf/dist/entry.js"),l=(i("./src/react/PdfRenderer.css"),i("./src/react/util/FastClickContainer.tsx"));class c{constructor(){n()(this,"dummy",void 0)}}const d=new c;function h(){return d}function p(e){return e===d}function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){n()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}r.pdfjs.GlobalWorkerOptions.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${r.pdfjs.version}/pdf.worker.js`;class m extends s.Component{constructor(e){super(e),n()(this,"HEADER_HEIGHT",50),n()(this,"ZOOM_STEP",.3),n()(this,"MAX_ZOOM",2.8),n()(this,"MIN_ZOOM",.7),n()(this,"resize",()=>{this.setState({width:.9*window.getWidth(),height:window.getHeight()})}),n()(this,"onZoomInClick",()=>{this.setState(e=>f({},e,{scale:Math.min(e.scale+this.ZOOM_STEP,this.MAX_ZOOM)}))}),n()(this,"onZoomOutClick",()=>{this.setState(e=>f({},e,{scale:Math.max(e.scale-this.ZOOM_STEP,this.MIN_ZOOM)}))}),n()(this,"onDocumentLoad",({numPages:e})=>{this.setState({numPages:e})}),this.state={numLoadedPages:0,numPages:h(),height:0,width:0,scale:1}}componentWillMount(){window.addEventListener("resize",this.resize),this.resize()}componentWillUnmount(){window.removeEventListener("resize",this.resize)}render(){return s.createElement("div",{className:p(this.state.numPages)?"PdfRenderer_rootLoading":""},s.createElement(r.Document,{className:"PdfRenderer_document",file:this.props.pdfUrl,loading:"Loading...",onLoadSuccess:this.onDocumentLoad},p(this.state.numPages)?"Loading...":this.renderPages(this.state.numPages)),s.createElement("div",{className:"PdfRenderer_header",style:{height:this.HEADER_HEIGHT}},s.createElement("div",{className:"PdfRenderer_headerNameContainer"},s.createElement("div",{className:"PdfRenderer_headerItem"},this.props.fileName)),s.createElement("div",{className:"PdfRenderer_headerButtonContainer"},s.createElement(l.a,{onFastClick:this.props.onDownloadClick,className:"PdfRenderer_headerItem PdfRenderer_headerButton"},Object(a.getLocale)().download),s.createElement(l.a,{className:"ril__zoomInButton ril__builtinButton"+(this.state.scale===this.MAX_ZOOM?" ril__builtinButtonDisabled":""),onFastClick:this.onZoomInClick}),s.createElement(l.a,{className:"ril__zoomOutButton ril__builtinButton"+(this.state.scale===this.MIN_ZOOM?" ril__builtinButtonDisabled":""),onFastClick:this.onZoomOutClick}),s.createElement(l.a,{className:"ril__closeButton ril__builtinButton",onFastClick:this.props.onCloseClick}))))}renderPages(e){const t=[];for(let i=0;i<=this.state.numLoadedPages;i++)t.push(s.createElement("div",{className:"PdfRenderer_page",style:{paddingTop:0===i?this.HEADER_HEIGHT+10:10,alignItems:this.state.scale<=1?"center":"flex-start"},key:i},s.createElement("div",{style:{width:this.state.width*this.state.scale,fontSize:16*this.state.scale}},i+1," / ",e),s.createElement(r.Page,{scale:this.state.scale,height:this.state.height,renderTextLayer:!1,pageNumber:i+1,width:this.state.width,loading:"Loading...",onRenderSuccess:()=>{this.state.numLoadedPages<e-1&&this.setState(e=>({numLoadedPages:e.numLoadedPages+1}))}})));return s.createElement("div",{style:{height:this.state.height,overflow:"auto"}},t.map(e=>e))}}},"./src/react/SimpleTabSelectionRow.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),n=i.n(o),a=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),s=i("./node_modules/react/index.js"),r=(i("./src/react/SimpleTablSelectionRow.css"),i("./src/react/tableView/PopupMenu.tsx")),l=i("./src/react/util/FastClickContainer.tsx"),c=i("./src/react/util/general.ts"),d=i("./src/react/util/HorizontalScrollContainer/HorizontalScrollContainer.tsx"),h=i("./src/react/util/HorizontalScrollContainer/HorizontalScrollItem.tsx");class p extends s.Component{constructor(e){super(e),n()(this,"handleScrollStateChange",e=>{this.setState({isScrollable:e,isOpen:!1})}),n()(this,"handleShowAllItems",e=>{this.setState({isOpen:!0,clickTarget:l.b.getTarget(e)})}),this.state={isScrollable:!1,isOpen:!1,clickTarget:null}}render(){return s.createElement("div",{className:"SimpleTablSelectionRow_root"},s.createElement(d.a,{controlsConfig:{left:{visibility:window.TOUCH?"NONE":"AUTO",innerElement:this.getElementBeforeControls()},right:{visibility:window.TOUCH?"NONE":"AUTO"},position:"AFTER_CHILD"},selectedItemId:this.props.currentItemId,onScrollStateChange:this.handleScrollStateChange},this.props.items.map((e,t)=>s.createElement(h.a,{className:"SimpleTabSelectionRow_itemContainer",id:""+e.id,key:e.id},s.createElement(l.a,{className:Object(c.a)("SimpleTabSelectionRow_view ",this.props.currentItemId===e.id?"SimpleTabSelectionRow_viewSelected":""),onFastClick:t=>this.props.onItemSelect(e.id,t),onFastContextMenu:t=>{this.props.onContextMenuClick(e.id,t)}},this.props.currentItemId===e.id?s.createElement("div",{className:"SimpleTabSelectionRow_selectionIndicator"}):null,this.getItemName(e)))),this.props.onNewItemClick&&!this.state.isScrollable?this.newItemButton():null),this.state.isScrollable?s.createElement(s.Fragment,null,s.createElement("div",{className:"SimpleTabSelectionRow_showAllButtonContainer"},s.createElement(l.a,{className:"i-32-16 i-white i-items",onFastClick:this.handleShowAllItems})),s.createElement(r.a,{itemBackground:this.props.popupItemBackground,show:this.state.isOpen,clickTarget:this.state.clickTarget,items:this.props.items,onClick:(e,t)=>{null!==e&&this.props.onItemSelect(this.props.items[e].id,t),this.setState({isOpen:!1})}})):null)}getItemName(e){return""===e.text?Object(a.getLocale)().unknown:e.text}getElementBeforeControls(){return this.props.onNewItemClick&&this.state.isScrollable?this.newItemButton():null}newItemButton(){return null===this.props.onNewItemClick?null:this.props.newButtonText?s.createElement(l.a,{className:"secondary-tab",onFastClick:this.props.onNewItemClick},this.props.newButtonText):s.createElement(l.a,{onFastClick:this.props.onNewItemClick,className:"SimpleTabSelectionRow_newItemButton"},s.createElement("div",{className:"i-32-16 i-light-grey i-plus"}))}}},"./src/react/credentials/Credentials.scss":function(e,t,i){},"./src/react/tableView/PopupMenu.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return x}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),n=i.n(o),a=i("./node_modules/@ninox/ninox-core/dist/ninox-core.es5.js"),s=i("./node_modules/react/index.js"),r=i("./node_modules/react-sortable-hoc/dist/react-sortable-hoc.umd.js"),l=i("./src/react/util/commons.ts");function c(e=!0){let t;const[i,o]=Object(s.useState)([window.getWidth(),window.getHeight()]),n=Object(s.useRef)(!1);return Object(s.useLayoutEffect)(()=>{function i(){clearTimeout(t),t=setTimeout(()=>{o([window.getWidth(),window.getHeight()])},50)}return e&&!n.current&&(window.addEventListener("resize",i),i(),n.current=e),()=>{n.current&&(window.removeEventListener("resize",i),n.current=!1)}},[e]),i}var d=i("./src/react/util/PositionedBackplane.tsx"),h=i("./src/react/util/FastClickContainer.tsx"),p=i("./src/react/util/general.ts");i("./src/react/util/SearchBarWithX.css");class u extends s.Component{constructor(e){super(e),this.state={filterBy:void 0===e.defaultFilter?"":e.defaultFilter,isSelected:!1}}onInputChange(e){this.setState({filterBy:e}),this.props.onFilterChange(e.trim())}render(){return s.createElement("div",{className:"SearchBarWithX_root "+this.props.className},s.createElement("input",{type:"text",value:this.state.filterBy,onChange:e=>this.onInputChange(e.target.value),placeholder:this.props.placeholder,onFocus:()=>this.setState({isSelected:!0}),onBlur:()=>this.setState({isSelected:!1}),autoFocus:!window.TOUCH,className:Object(p.a)("SearchBarWithX_input",this.state.isSelected?"SearchBarWithX_inputSelected":"")}),""!==this.state.filterBy?s.createElement(h.a,{onFastClick:()=>this.onInputChange(""),className:"i-32-16 i-light-grey i-close SearchWithX_resetSearch"}):null)}}i("./src/react/tableView/PopupMenu.css"),i("./src/react/tableView/PopupMenuTab.css");function f(e){return s.createElement(h.a,{className:Object(p.a)("PopupMenuTab",{PopupMenuTab_Selected:!!e.item.isSelected,PopupMenuTab_Sorting:e.isSorting,PopupMenuTab_small:e.isSmall,PopupMenuTab_sortable:void 0!==e.onReorder||"OFF_WHITE"===e.background}),onFastClick:t=>e.handleClick(t)},s.createElement("div",{className:"PopupMenuTab_container"},e.item.iconClass?s.createElement("div",{className:"PopupMenuTab_iconContainer"},s.createElement("div",{className:e.item.iconClass})):null,s.createElement("div",{className:"PopupMenuTab_Text"},e.item.text?e.item.text:Object(a.getLocale)().unnamed)),void 0!==e.onReorder?s.createElement(m,null):null)}const m=Object(r.SortableHandle)(()=>s.createElement("span",{className:"PopupMenuTab_sortingHandleContainer"},s.createElement("span",{className:"i-32-24 i-lighter-grey i-drag-handle"})));function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){n()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const y=640,b=Object(r.SortableElement)(({children:e})=>e),w=Object(r.SortableContainer)(({style:e,className:t,children:i})=>s.createElement("div",{style:e,className:t},i));function x(e){const[t,i]=s.useState({isSorting:!1,filterBy:"",didShow:!1}),[o,n]=c(t.didShow),r=o<=y,h=r?100:164,p=r?4:16,m=e=>{i(v({},t,{filterBy:e}))},g=()=>{const t=Math.max(1,Math.floor((o-p)/h));let i;i=void 0!==e.maxColumns?Math.min(e.maxColumns,t):t;const n=Math.ceil(Math.sqrt(e.items.length));return Math.min(n,i)*h};return s.createElement(d.a,{clickTarget:e.clickTarget,show:e.show,settings:{style:"tooltip",arrowColor:"white"},onDidShow:()=>i(v({},t,{didShow:!1,filterBy:""})),onDidHide:()=>i(v({},t,{didShow:!0})),onClick:t=>e.onClick(null,t)},s.createElement("div",{className:"PopupMenu_root"},!1!==e.renderSearch?s.createElement(u,{onFilterChange:m,placeholder:Object(a.getLocale)().search,className:"PopupMenu_searchBar"}):null,s.createElement(w,{style:{maxHeight:n-140,width:g()},onSortStart:()=>i(v({},t,{isSorting:!0})),onSortEnd:o=>{i(v({},t,{isSorting:!1})),Object(l.a)(e.onReorder),e.onReorder(o.oldIndex,o.newIndex)},axis:"xy",useDragHandle:!0,className:"PopupMenu_body",helperClass:"PopupMenu_helperClass"},e.items.reduce((i,o,n)=>((""===t.filterBy||(o.text||"").toLowerCase().includes(t.filterBy.toLowerCase()))&&i.push(s.createElement(b,{index:n,key:o.id},s.createElement(f,{background:e.itemBackground,isSmall:r,item:o,handleClick:t=>e.onClick(n,t),isSorting:t.isSorting,onReorder:e.onReorder}))),i),[]))))}},"./src/react/util/FastClickContainer.tsx":function(e,t,i){"use strict";i.d(t,"b",(function(){return f})),i.d(t,"a",(function(){return m}));var o=i("./node_modules/@babel/runtime/helpers/extends.js"),n=i.n(o),a=i("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),s=i.n(a),r=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),l=i.n(r),c=i("./node_modules/assert-never/index.js"),d=i.n(c),h=i("./node_modules/react/index.js");i("./src/react/util/FastClickContainer.css");function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){l()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}let f;!function(e){function t(e){switch(e.kind){case"MouseDown":case"MouseUp":return{x:e.event.clientX,y:e.event.clientY};case"TouchEnd":return{x:e.event.changedTouches[0].clientX,y:e.event.changedTouches[0].clientY};case"TouchStart":return{x:e.event.touches[0].clientX,y:e.event.touches[0].clientY};default:return d()(e)}}function i(e){switch(e.kind){case"MouseDown":case"MouseUp":return e.event.target;case"TouchEnd":return e.event.changedTouches[0].target;case"TouchStart":return e.event.touches[0].target;default:return d()(e)}}e.getPosition=t,e.getTarget=i}(f||(f={}));class m extends h.Component{constructor(e){super(e),l()(this,"shouldCountAsClick",void 0),l()(this,"rippleTimeoutId",void 0),l()(this,"longPressTimeoutId",void 0),l()(this,"initialCoords",void 0),l()(this,"longPressOccurred",!1),l()(this,"handleContextMenu",e=>{void 0!==this.props.onFastContextMenu&&(e.preventDefault(),e.stopPropagation(),this.props.onFastContextMenu({event:e,kind:"MouseDown"})),this.shouldCountAsClick=!1}),l()(this,"handleTouchEnd",e=>{clearTimeout(this.longPressTimeoutId),this.longPressOccurred?this.handleLongPressOccurred(e):this.shouldCountAsClick&&0===e.touches.length&&1===e.changedTouches.length&&(e.stopPropagation(),e.preventDefault(),this.props.onFastClick({kind:"TouchEnd",event:e})),this.shouldCountAsClick=!1}),l()(this,"handleMouseUp",e=>{clearTimeout(this.longPressTimeoutId),this.longPressOccurred?this.handleLongPressOccurred(e):this.shouldCountAsClick&&(e.stopPropagation(),e.preventDefault(),this.props.onFastClick({kind:"MouseUp",event:e})),this.shouldCountAsClick=!1}),l()(this,"handleTouchMove",e=>{if(!this.shouldCountAsClick)return;const t=e.touches[0].clientX,i=e.touches[0].clientY,o=100,n=t-this.initialCoords.x,a=i-this.initialCoords.y;n*n+a*a>o&&(this.cleanUp(),this.shouldCountAsClick=!1)}),l()(this,"handleMouseLeave",()=>{this.shouldCountAsClick&&(this.cleanUp(),this.shouldCountAsClick=!1)}),l()(this,"handleTouchStart",e=>{if(e.touches.length>1)return;const t={event:e,kind:"TouchStart"};this.setInitialCoords(t),this.startClick(t),"PREVENT_RIPPLE"!==this.props.behaviour&&this.showRipple(t),void 0!==this.props.onTouchStart&&this.props.onTouchStart(e)}),l()(this,"handleMouseDown",e=>{if(0!==e.button)return;const t={event:e,kind:"MouseDown"};this.startClick(t),"FORCE_RIPPLE"===this.props.behaviour&&this.showRipple(t),void 0!==this.props.onMouseDown&&this.props.onMouseDown(e)}),l()(this,"showRipple",e=>{this.callCleanUp(500);const t=e.event.currentTarget,i=t.offsetWidth,o=t.getBoundingClientRect();let{x:n,y:a}=f.getPosition(e);a=a-o.y-i/2,n=n-o.x-i/2;const s={top:a+"px",left:n+"px",height:i+"px",width:i+"px"};this.setState({spanStyles:this.state.spanStyles.concat(s)})}),l()(this,"renderRippleSpan",()=>this.state.spanStyles.length>0?this.state.spanStyles.map((e,t)=>h.createElement("span",{key:"spanCount_"+t,style:e,className:"FastClickContainer_ripple "+("LIGHT"===this.props.rippleStyle?"FastClickContainer_rippleLight":"FastClickContainer_rippleDark")})):null),l()(this,"cleanUp",()=>{this.setState({spanStyles:[]})}),l()(this,"callCleanUp",e=>{"PREVENT_RIPPLE"!==this.props.behaviour&&(clearTimeout(this.rippleTimeoutId),this.rippleTimeoutId=window.setTimeout(this.cleanUp,e))}),this.shouldCountAsClick=!1,this.initialCoords={x:0,y:0},this.state={spanStyles:[]}}componentWillUnmount(){clearTimeout(this.rippleTimeoutId),clearTimeout(this.longPressTimeoutId)}render(){const e=u({},this.props),{onFastClick:t,innerRef:i,rippleStyle:o,behaviour:a,preventLongPress:r,onFastContextMenu:l}=e,c=s()(e,["onFastClick","innerRef","rippleStyle","behaviour","preventLongPress","onFastContextMenu"]),d=void 0!==this.props.className?this.props.className+" FastClickContainer_root":"FastClickContainer_root";return h.createElement("div",n()({},c,{className:d,ref:this.props.innerRef,onTouchStart:this.handleTouchStart,onContextMenu:this.handleContextMenu,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onMouseDown:this.handleMouseDown,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp}),h.createElement("div",{className:"FastClickContainer_rippleContainer"},this.renderRippleSpan()),this.props.children)}setInitialCoords(e){const t=f.getPosition(e);this.initialCoords={x:t.x,y:t.y}}startClick(e){this.shouldCountAsClick=!0,e.event.persist(),this.longPressTimer(e),e.event.stopPropagation()}longPressTimer(e){clearTimeout(this.longPressTimeoutId),this.longPressTimeoutId=window.setTimeout(()=>{this.shouldCountAsClick&&void 0!==this.props.onFastContextMenu&&!0!==this.props.preventLongPress&&(e.event.cancelable?e.event.preventDefault():this.longPressOccurred=!0,e.event.stopPropagation(),this.props.onFastContextMenu(e),this.shouldCountAsClick=!1)},200)}handleLongPressOccurred(e){e.stopPropagation(),e.preventDefault(),this.longPressOccurred=!1}}},"./src/react/util/HorizontalScrollContainer/HorizontalScrollContainer.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var o=i("./node_modules/@babel/runtime/helpers/extends.js"),n=i.n(o),a=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),s=i.n(a),r=i("./node_modules/assert-never/index.js"),l=i.n(r),c=i("./node_modules/react/index.js"),d=i("./node_modules/seamless-scroll-polyfill/dist/es5/seamless.js"),h=i("./src/react/util/commons.ts"),p=(i("./src/react/util/HorizontalScrollContainer/HorizontalScrollContainer.css"),i("./src/react/util/HorizontalScrollContainer/HorizontalScrollItem.tsx"));function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){s()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class m extends c.Component{constructor(e){super(e),s()(this,"SCROLL_TIMEOUT_INTO_VIEW",50),s()(this,"SCROLL_TIMEOUT_WHEEL",100),s()(this,"SCROLL_TIMEOUT_ARROWS",30),s()(this,"scrollableContainer",c.createRef()),s()(this,"selectedItem",c.createRef()),s()(this,"wasScrollable",void 0),s()(this,"scrollTimeoutId",void 0),s()(this,"resizeTimeoutId",void 0),s()(this,"scrollTimeoutTimer",void 0),s()(this,"isScrolling",void 0),s()(this,"lastSelectedItemId",void 0),s()(this,"handleWheel",e=>{if(0===e.deltaY||0!==e.deltaX||!0===this.props.removeMouseWheelOverride)return;const t=this.scrollableContainer.current,i=e.deltaY>0?"RIGHT":"LEFT";this.canScrollToSide(t,i)&&(this.scrollTimeoutTimer=this.SCROLL_TIMEOUT_WHEEL,d.elementScrollBy(t,{top:0,left:e.deltaY}))}),s()(this,"handleScrollEnd",()=>{if(this.isScrolling=!1,void 0===this.props.onScrollEnd)return;const e=this.scrollableContainer.current;let t=null;this.canScrollToSide(e,"LEFT")?this.canScrollToSide(e,"RIGHT")||(t="RIGHT"):t="LEFT",this.props.onScrollEnd(t)}),s()(this,"handleScroll",()=>{clearTimeout(this.scrollTimeoutId),this.scrollStart(),this.scrollTimeoutId=window.setTimeout(this.handleScrollEnd,this.scrollTimeoutTimer)}),s()(this,"resize",()=>{clearTimeout(this.resizeTimeoutId),this.resizeTimeoutId=window.setTimeout(this.resizeListener,50)}),s()(this,"resizeListener",()=>{const e=this.scrollableContainer.current;if(null===e)return;const t=Math.floor(e.scrollWidth)>Math.ceil(e.getBoundingClientRect().width)+1;this.wasScrollable!==t&&(this.wasScrollable=t,this.setState({isScrollable:t}),this.handleScrollStateChange(t)),this.scrollIntoViewIfNeeded()}),this.isScrolling=!1,this.scrollTimeoutTimer=this.SCROLL_TIMEOUT_INTO_VIEW,this.state={shaking:null,isScrollable:!1}}componentDidMount(){!0!==this.props.useExternalResizeListener&&window.addEventListener("resize",this.resize),this.resize()}componentWillUnmount(){window.removeEventListener("resize",this.resize)}componentDidUpdate(e,t){this.resize()}render(){const e="BEFORE_CHILD"===this.props.controlsConfig.position||"SEPARATED"===this.props.controlsConfig.position,t="AFTER_CHILD"===this.props.controlsConfig.position||"SEPARATED"===this.props.controlsConfig.position;return c.createElement("div",{onWheel:this.handleWheel,onScroll:this.handleScroll,className:"HorizontalScrollContainer_root"},this.state.isScrollable&&e?this.renderControls("BEFORE_CHILD"):null,c.createElement("div",{className:this.getChildrenContainerClass(),ref:this.scrollableContainer,onAnimationEnd:()=>this.setState({shaking:null})},!this.state.isScrollable&&e?this.renderControls("BEFORE_CHILD"):null,this.renderChildren(),!this.state.isScrollable&&t?this.renderControls("AFTER_CHILD"):null),this.state.isScrollable&&t?this.renderControls("AFTER_CHILD"):null)}renderControls(e){if(!this.isControlVisible())return null;let t=null;const i=f({},this.props.controlsConfig.right,{direction:"RIGHT"}),o=f({},this.props.controlsConfig.left,{direction:"LEFT"});switch(this.props.controlsConfig.position){case"BEFORE_CHILD":"BEFORE_CHILD"===e&&(t=c.createElement(c.Fragment,null,this.isMovementControlsVisible(o)?this.renderMovementControl(o):null,o.innerElement,this.isMovementControlsVisible(i)?this.renderMovementControl(i):null,i.innerElement));break;case"AFTER_CHILD":"AFTER_CHILD"===e&&(t=c.createElement(c.Fragment,null,o.innerElement,this.isMovementControlsVisible(o)?this.renderMovementControl(o):null,i.innerElement,this.isMovementControlsVisible(i)?this.renderMovementControl(i):null));break;case"SEPARATED":"BEFORE_CHILD"===e&&(t=c.createElement(c.Fragment,null,this.isMovementControlsVisible(o)?this.renderMovementControl(o):null,i.innerElement)),"AFTER_CHILD"===e&&(t=c.createElement(c.Fragment,null,o.innerElement,this.isMovementControlsVisible(i)?this.renderMovementControl(i):null));break;default:l()(this.props.controlsConfig.position)}return c.createElement("div",{className:"HorizontalScrollContainer_buttonsContainer"+(null!==this.state.shaking?" HorizontalScrollContainer_buttonsContainerShaking":"")},t)}scrollIntoViewIfNeeded(){null!==this.selectedItem.current&&this.lastSelectedItemId!==this.props.selectedItemId&&(this.lastSelectedItemId=this.props.selectedItemId,this.scrollTimeoutTimer=this.SCROLL_TIMEOUT_INTO_VIEW,d.elementScrollIntoView(this.selectedItem.current,{behavior:"smooth"}))}scrollStart(){this.isScrolling||(this.isScrolling=!0,void 0!==this.props.onScrollStart&&this.props.onScrollStart())}renderMovementControl(e){const t=void 0!==e.iconClassName?e.iconClassName:"LEFT"===e.direction?"i-32-16 i-white i-line-left-medium":"i-32-16 i-white i-line-right-medium";return c.createElement("div",{onClick:()=>this.scrollStep(e.direction),className:e.containerClassName},c.createElement("div",{className:t}))}renderChildren(){let e=this.props.children;return void 0!==this.props.selectedItemId&&(e=this.getChildren(e)),e}getChildren(e){return c.Children.map(e,e=>Object(h.b)(e,p.a)?c.createElement("div",n()({},e.props,{ref:this.props.selectedItemId===e.props.id?this.selectedItem:null})):c.isValidElement(e)?c.cloneElement(e,{children:this.getChildren(e.props.children)}):e)}isControlVisible(){const e=this.props.controlsConfig.right,t=this.props.controlsConfig.left;return void 0===t||void 0===e||this.isMovementControlsVisible(e)||this.isMovementControlsVisible(t)||t.innerElement||e.innerElement}isMovementControlsVisible(e){return void 0===e||"ALWAYS"===e.visibility||this.state.isScrollable&&"NONE"!==e.visibility}handleScrollStateChange(e){void 0!==this.props.onScrollStateChange&&this.props.onScrollStateChange(e)}getChildrenContainerClass(){let e="HorizontalScrollContainer_itemsContainer";return this.state.isScrollable&&(e+=" HorizontalScrollContainer_tabsContainerIESupportWhenScrolling"),"LEFT"===this.state.shaking?e+=" HorizontalScrollContainer_shakeLeft":"RIGHT"===this.state.shaking&&(e+=" HorizontalScrollContainer_shakeRight"),e}canScrollToSide(e,t){return"LEFT"===t?e.scrollLeft>0:Math.ceil(e.scrollLeft)<Math.floor(e.scrollWidth-e.clientWidth)}getScrollBy(e,t){const i="LEFT"===t?-1:1;if(void 0!==this.props.customScrollBy)return i*this.props.customScrollBy(e.clientWidth);{const t=208;return i*Math.max(e.clientWidth/2,t)}}scrollStep(e){const t=this.scrollableContainer.current;!this.state.isScrollable||!this.canScrollToSide(t,e)&&null===this.state.shaking?this.setState({shaking:e}):this.isScrolling||(this.scrollTimeoutTimer=this.SCROLL_TIMEOUT_ARROWS,d.elementScrollBy(t,{top:0,left:this.getScrollBy(t,e),behavior:"smooth"}))}}},"./src/react/util/HorizontalScrollContainer/HorizontalScrollItem.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),n=i.n(o),a=i("./node_modules/react/index.js");class s extends a.PureComponent{constructor(e){super(e)}render(){return a.createElement("div",this.props)}}n()(s,"displayName","NinoxHorizontalScrollItem")},"./src/react/util/PositionedBackplane.tsx":function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var o=i("./node_modules/@babel/runtime/helpers/defineProperty.js"),n=i.n(o),a=i("./node_modules/assert-never/index.js"),s=i.n(a),r=i("./node_modules/react/index.js"),l=i("./node_modules/seamless-scroll-polyfill/dist/es5/seamless.js"),c=i("./node_modules/react-dom/index.js"),d=(i("./src/react/util/Backplane.css"),i("./src/react/util/FastClickContainer.tsx"));class h extends r.Component{constructor(e){super(e),n()(this,"backplane",void 0),n()(this,"modalRoot",document.body),n()(this,"handleClick",e=>{void 0!==this.props.onClick&&this.props.onClick(e)}),n()(this,"unmount",()=>{this.props.show||(this.setState({shouldRenderChildren:!1}),this.modalRoot.removeChild(this.backplane),void 0!==this.props.onDidHide&&this.props.onDidHide())}),this.backplane=document.createElement("div"),this.state={shouldRenderChildren:!1}}componentDidUpdate(e,t,i){this.props.show&&!e.show&&(this.modalRoot.appendChild(this.backplane),this.setState({shouldRenderChildren:!0},this.props.onDidShow))}componentDidMount(){this.props.show&&(this.modalRoot.appendChild(this.backplane),this.setState({shouldRenderChildren:!0},this.props.onDidShow))}componentWillUnmount(){null!==this.backplane.parentElement&&(this.modalRoot.removeChild(this.backplane),void 0!==this.props.onDidHide&&this.props.onDidHide())}render(){if(!this.state.shouldRenderChildren)return null;const e=r.createElement("div",{ref:this.props.innerRef,className:"Backplane_root "+(void 0===this.props.className?"":this.props.className)+(this.props.show?"":" Backplane_rootFadeOut"),onAnimationEnd:this.unmount},r.createElement(d.a,{onFastClick:()=>{},onMouseDown:this.handleClick,onTouchStart:this.handleClick,onFastContextMenu:()=>{},behaviour:"PREVENT_RIPPLE",className:"Backplane_clickable"}),this.props.children);return c.createPortal(e,this.backplane)}}i("./src/react/util/PositionedBackplane.css");var p=i("./node_modules/react-popper/lib/esm/Popper.js");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){n()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}class m extends r.Component{render(){return r.createElement(p.a,{placement:this.props.customPlacement,referenceElement:this.props.target,modifiers:{computeStyle:{gpuAcceleration:!1},preventOverflow:{boundariesElement:null===this.props.boundariesElement?"scrollParent":this.props.boundariesElement,escapeWithReference:!1}}},({ref:e,style:{top:t,left:i,position:o},placement:n,arrowProps:a})=>{const s=this.getCustomStyle(i,t,n),l=f({position:o},void 0===this.props.positionAdjustment?{top:0,left:0}:this.props.positionAdjustment,{transform:`translate3d(${s.wrapperStyle.left}px, ${s.wrapperStyle.top}px, 0)`,WebkitTransform:`translate3d(${s.wrapperStyle.left}px, ${s.wrapperStyle.top}px, 0)`});return r.createElement("div",{ref:e,style:l,"data-placement":n,className:this.props.className},this.props.children,r.createElement("div",{ref:a.ref,style:f({},a.style,{},s.arrow.style),className:"PositionedBackplane_arrow "+s.arrow.className}))})}getCustomStyle(e,t,i){const o=m.ARROW_HEIGHT,n={borderWidth:o,borderColor:void 0===this.props.arrowColor?"#ddd":this.props.arrowColor};switch(i){case"top-start":case"top":case"top-end":return{wrapperStyle:{left:e,top:t-o},arrow:{style:n,className:"PositionedBackplane_arrowTop"}};case"right-start":case"right":case"right-end":return{wrapperStyle:{left:e-o,top:t},arrow:{style:f({left:-o},n),className:"PositionedBackplane_arrowRight"}};case"bottom-end":case"bottom":case"bottom-start":return{wrapperStyle:{left:e,top:t+o},arrow:{style:f({top:-o},n),className:"PositionedBackplane_arrowBottom"}};case"left-end":case"left":case"left-start":return{wrapperStyle:{left:e+o,top:t},arrow:{style:n,className:"PositionedBackplane_arrowLeft"}};case"auto-start":case"auto":case"auto-end":case void 0:return{wrapperStyle:{left:0,top:0},arrow:{style:{},className:""}};default:return s()(i)}}}function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){n()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}n()(m,"ARROW_HEIGHT",15);class y extends r.Component{render(){return r.createElement(p.a,{referenceElement:this.props.target,modifiers:{computeStyle:{gpuAcceleration:!1},preventOverflow:{boundariesElement:"window",escapeWithReference:!1},flip:{enabled:!1}}},({ref:e,style:{top:t,left:i,position:o}})=>{const n=this.props.target.getBoundingClientRect(),a=void 0===this.props.positionAdjustment?{top:0,left:0}:this.props.positionAdjustment,s=v({position:o,width:n.width,height:n.height},a,{transform:`translate3d(${i}px, ${t-n.height}px, 0)`,WebkitTransform:`translate3d(${i}px, ${t-n.height}px, 0)`});return r.createElement("div",{ref:e,style:s},this.props.children)})}}class b extends r.Component{constructor(e){super(e),n()(this,"resizeTimeout",void 0),n()(this,"containerElement",r.createRef()),n()(this,"target",null),n()(this,"currentSettings",void 0),n()(this,"onParentMount",()=>{this.setState({didParentShow:!0}),this.props.onDidShow&&this.props.onDidShow()}),n()(this,"resize",()=>{null!==this.target&&this.props.show&&l.elementScrollIntoView(this.target,{block:"nearest",behavior:"auto"})}),n()(this,"resizeDebounce",()=>{clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,50)}),this.currentSettings=e.settings,this.state={didParentShow:!1}}componentDidMount(){window.addEventListener("resize",this.resizeDebounce)}componentWillUnmount(){window.removeEventListener("resize",this.resizeDebounce)}render(){return this.props.show?(this.currentSettings=this.props.settings,this.target=this.props.clickTarget):!0===this.props.killWhenTargetIsNull&&(this.target=this.props.clickTarget),r.createElement(h,{innerRef:this.containerElement,onDidShow:this.onParentMount,onDidHide:this.props.onDidHide,show:this.props.show,onClick:this.props.onClick},this.state.didParentShow&&null!==this.target?this.renderPositionedChildren(this.target):null)}renderPositionedChildren(e){switch(this.currentSettings.style){case"overlay":return r.createElement(y,{positionAdjustment:this.props.positionAdjustment,target:e},this.props.children);case"tooltip":return r.createElement(m,{positionAdjustment:this.props.positionAdjustment,boundariesElement:this.containerElement.current,arrowColor:this.currentSettings.arrowColor,target:e,className:this.props.className,customPlacement:this.currentSettings.customPlacement},this.props.children);default:return Object(a.assertNever)(this.currentSettings)}}}},"./src/react/util/Track.ts":function(e,t,i){"use strict";i.d(t,"d",(function(){return r})),i.d(t,"c",(function(){return l})),i.d(t,"a",(function(){return c})),i.d(t,"e",(function(){return h})),i.d(t,"f",(function(){return p})),i.d(t,"b",(function(){return u}));var o=i("./node_modules/mixpanel-browser/build/mixpanel.cjs.js"),n=i("./src/js/ui/ui-util.js");let a="qs"===window.NINOX_ENV;function s(e){return!a&&e.journey.showUserLane&&"en"===window.LOCALE&&window.Userlane&&window.NINOX_WEB}function r(){if(f())try{"prod"===window.NINOX_ENV?o.init("6a0067315a2bfdbf3b1c30dc02b72bc0"):o.init("8eff22a6476c6715d6e44be8d9e81e70")}catch(e){console.warn(e)}}function l(e){d(e);try{(window.NinoxTracking||{}).trackLogin&&window.NinoxTracking.trackLogin(e.id,e.email)}catch(e){console.warn(e)}if(f()){try{o.identify(e.id),o.people.set({userId:e.id,userCreatedAt:new Date(e.createdAt),userVerified:e.verified,userPlanName:e.plan&&e.plan.name?e.plan.name:"null",userLanguage:e.language})}catch(e){console.warn(e)}try{window.Appcues&&window.Appcues.identify(e.id,{})}catch(e){console.warn(e)}try{window.Userlane&&window.Userlane("user",e.id)}catch(e){console.warn(e)}}}function c(e){d(e);try{(window.NinoxTracking||{}).trackSignup&&window.NinoxTracking.trackSignup(e.id,e.email)}catch(e){console.warn(e)}if(f()){try{o.alias(e.id)}catch(e){console.warn(e)}try{window.Appcues&&window.Appcues.identify(e.id,{})}catch(e){console.warn(e)}try{window.Userlane&&window.Userlane("user",e.id)}catch(e){console.warn(e)}}}function d(e){if(s(e)&&window.Userlane){a=!0;const t=window.Userlane;t("init","m6we5"),t("lang",window.LOCALE),t("identify",e.id,{email:e.email}),t("onStart",e=>{switch(e){case"36630":case"36627":window.ui.isInitialized&&window.ui.backToRoot()}})}}function h(e){if(f())try{o.register(e)}catch(e){console.warn(e)}}function p(e,t,i){if(f())try{o.track("App "+e+" "+t,i)}catch(e){console.warn(e)}}function u(e){if(!(window.NinoxTracking||{}).getIadAttributionDetails)return e("",null);window.NinoxTracking.getIadAttributionDetails(e)}function f(){return!Object(n.f)()}},"./src/react/util/commons.ts":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"a",(function(){return r}));var o=i("./node_modules/assert/assert.js");function n(e,t){return null!=e&&null!=e.type&&null!=e.type.displayName&&e.type.displayName===t.displayName}function a(e,t){const i=e.nextElementSibling;return null===i?null:i.id===t?i:a(i,t)}function s(e,t){const i=e.previousElementSibling;return null===i?null:i.id===t?i:s(i,t)}function r(e){l(null!=e,`Expected 'val' to be defined, but received ${e}`)}function l(e,t){if(!e)throw new o.AssertionError({message:t})}},"./src/react/util/general.ts":function(e,t,i){"use strict";function o(...e){const t=[];for(const i of e)if("string"==typeof i)t.push(i);else if("object"==typeof i)for(const e in i)i[e]&&t.push(e);return t.join(" ")}i.d(t,"a",(function(){return o}))},"./src/react/views/BrowserNotSupportedView.scss":function(e,t,i){},0:function(e,t,i){i("./src/init_styles.js"),e.exports=i("./src/init_lib.js")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){}});
//# sourceMappingURL=main.ebe87b9cd647a7471241.js.map
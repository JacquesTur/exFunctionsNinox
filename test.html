<div id='version'>sortir du mode Admin pour charger exFonctions</div>
<div>exFunctions par Robert et Jacques.</div>
<div id="exInit">
  </dvi>
  <script>

    var GitHubAdr = "https://raw.githubusercontent.com/JacquesTur/exFunctionsNinox/master"
    function ChargerModule(AdrModule, Module) {

      try {
        var xhr = new XMLHttpRequest();
        var timeStart = new Date().getTime();
        var adr = AdrModule ? AdrModule : GitHubAdr;
        var Script = "";
        xhr.addEventListener('load', function (e) {
          Script = e.target.responseText;
          var timeStop = new Date().getTime();
          debugger;
          if (e.target.status == 200) {
            var fn = Function("rootAddress", Script);
            fn(adr);
            console.log("chargé : (" + (timeStop - timeStart).toString() + "ms) " + e.target.responseURL);
          } else {
            console.log("erreur sur : " + adr + '/' + Module + " : " + e.target.status + " = " + e.target.responseURL);
          }
        });
        xhr.addEventListener('error', function (e) {

          console.error('Request error with status', e.target.status);
        });
        xhr.open('get', adr + '/' + Module, true);
        //   xhr.setRequestHeader('Content-Type', 'application/javascript');
        xhr.send(null);
      } catch (err) {
        var msgErr =
          err.message + " à la ligne " + err.line + ", colonne " + err.column;
        console.log(" erreur au chargement de " + Script + " : " + err);
      }
    }

    function exInit(AdresseDeBase) {

      debugger;
      ChargerModule(AdresseDeBase, 'exVersion.js',);
      ChargerModule(AdresseDeBase, 'Modules/exUtils.js',);
      ChargerModule(AdresseDeBase, 'Modules/exModule.js',);
      ChargerModule(AdresseDeBase, 'exFonctions.js',);
      ChargerModule(AdresseDeBase, 'Modules/exFnJT.js',);
      ChargerModule(AdresseDeBase, 'Modules/exFnRT.js',);

      document.getElementById('exInit').innerText = 'version : ' + exRevision;

      // IMPORTANT : force la mise à jour de Ninox pour prendre en compte les fonctions étendues
      if (!database.adminMode) {
        window.database.setSchema(window.database.originalSchema);
      }




    }
    exInit();
  </script>
  <script>
    debugger;
    patt = /\/node\/HB2/g;
    patt.compile(patt);
    var demPreCharge = patt.test(document.URL);

    patt = /\/node\/SB1/g;
    patt.compile(patt);
    var initPreCharge = patt.test(document.URL);


    patt = /\/node\/\w+\d+/g;
    patt.compile(patt);
    var autrePreCharge = patt.test(document.URL) & !initPreCharge & !demPreCharge;

    //$.loading(!0);
    // Affichage de Charmgement en cours...
    document.getElementById('version').innerText = 'chargement en cours...';

    exInit('https://raw.githubusercontent.com/JacquesTur/exFunctionsNinox/master');

    //Affichage du numéro de version une fois le code de chargement exéctué	
    document.getElementById('version').innerText = 'ver : ' + exRevision;


    //Vérifie si une autre fenêtre popup n'était pas déjà préchargée lors de l'appel à Ninox 
    //if (ui.sideEditor.nid && ui.sideEditor.nid != 'SB1' )  {
    debugger;
    ui.closeRecord();

    //$.loading(!1);

    if (!autrePreCharge && !demPreCharge) {
      //Si c'est le cas, alors fermeture de la fenêtre d'initialisation pour laisser apparaitre la fenêtre en dessous
      //debugger;
      ui.popupRecord('HB2');
    }



  </script>